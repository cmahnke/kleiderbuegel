(()=>{var d3=Object.create;var Rx=Object.defineProperty;var h3=Object.getOwnPropertyDescriptor;var p3=Object.getOwnPropertyNames;var f3=Object.getPrototypeOf,m3=Object.prototype.hasOwnProperty;var ot=(d,h)=>()=>(h||d((h={exports:{}}).exports,h),h.exports),g3=(d,h)=>{for(var v in h)Rx(d,v,{get:h[v],enumerable:!0})},_3=(d,h,v,y)=>{if(h&&typeof h=="object"||typeof h=="function")for(let T of p3(h))!m3.call(d,T)&&T!==v&&Rx(d,T,{get:()=>h[T],enumerable:!(y=h3(h,T))||y.enumerable});return d};var Fn=(d,h,v)=>(v=d!=null?d3(f3(d)):{},_3(h||!d||!d.__esModule?Rx(v,"default",{value:d,enumerable:!0}):v,d));var jx=ot((Oq,k2)=>{"use strict";var x3=void 0;k2.exports=function(d){return d!==x3&&d!==null}});var P2=ot((Rq,I2)=>{"use strict";var b3=jx(),w3={object:!0,function:!0,undefined:!0};I2.exports=function(d){return b3(d)?hasOwnProperty.call(w3,typeof d):!1}});var z2=ot((Dq,L2)=>{"use strict";var S3=P2();L2.exports=function(d){if(!S3(d))return!1;try{return d.constructor?d.constructor.prototype===d:!1}catch{return!1}}});var O2=ot((Bq,M2)=>{"use strict";var T3=z2();M2.exports=function(d){if(typeof d!="function"||!hasOwnProperty.call(d,"length"))return!1;try{if(typeof d.length!="number"||typeof d.call!="function"||typeof d.apply!="function")return!1}catch{return!1}return!T3(d)}});var D2=ot((Fq,R2)=>{"use strict";var C3=O2(),E3=/^\s*class[\s{/}]/,A3=Function.prototype.toString;R2.exports=function(d){return!(!C3(d)||E3.test(A3.call(d)))}});var F2=ot((Nq,B2)=>{"use strict";B2.exports=function(){var d=Object.assign,h;return typeof d!="function"?!1:(h={foo:"raz"},d(h,{bar:"dwa"},{trzy:"trzy"}),h.foo+h.bar+h.trzy==="razdwatrzy")}});var j2=ot((jq,N2)=>{"use strict";N2.exports=function(){try{return Object.keys("primitive"),!0}catch{return!1}}});var U2=ot((Vq,V2)=>{"use strict";V2.exports=function(){}});var rp=ot((Uq,q2)=>{"use strict";var k3=U2()();q2.exports=function(d){return d!==k3&&d!==null}});var G2=ot((qq,W2)=>{"use strict";var I3=rp(),P3=Object.keys;W2.exports=function(d){return P3(I3(d)?Object(d):d)}});var Z2=ot((Wq,H2)=>{"use strict";H2.exports=j2()()?Object.keys:G2()});var F_=ot((Gq,$2)=>{"use strict";var L3=rp();$2.exports=function(d){if(!L3(d))throw new TypeError("Cannot use null or undefined");return d}});var Y2=ot((Hq,X2)=>{"use strict";var z3=Z2(),M3=F_(),O3=Math.max;X2.exports=function(d,h){var v,y,T=O3(arguments.length,2),n;for(d=Object(M3(d)),n=function(R){try{d[R]=h[R]}catch(j){v||(v=j)}},y=1;y<T;++y)h=arguments[y],z3(h).forEach(n);if(v!==void 0)throw v;return d}});var J2=ot((Zq,K2)=>{"use strict";K2.exports=F2()()?Object.assign:Y2()});var eC=ot(($q,Q2)=>{"use strict";var R3=rp(),D3=Array.prototype.forEach,B3=Object.create,F3=function(d,h){var v;for(v in d)h[v]=d[v]};Q2.exports=function(d){var h=B3(null);return D3.call(arguments,function(v){R3(v)&&F3(Object(v),h)}),h}});var iC=ot((Xq,tC)=>{"use strict";var Vx="razdwatrzy";tC.exports=function(){return typeof Vx.contains!="function"?!1:Vx.contains("dwa")===!0&&Vx.contains("foo")===!1}});var nC=ot((Yq,rC)=>{"use strict";var N3=String.prototype.indexOf;rC.exports=function(d){return N3.call(this,d,arguments[1])>-1}});var sC=ot((Kq,oC)=>{"use strict";oC.exports=iC()()?String.prototype.contains:nC()});var Ld=ot((Jq,uC)=>{"use strict";var N_=jx(),aC=D2(),lC=J2(),cC=eC(),_m=sC(),j3=uC.exports=function(d,h){var v,y,T,n,R;return arguments.length<2||typeof d!="string"?(n=h,h=d,d=null):n=arguments[2],N_(d)?(v=_m.call(d,"c"),y=_m.call(d,"e"),T=_m.call(d,"w")):(v=T=!0,y=!1),R={value:h,configurable:v,enumerable:y,writable:T},n?lC(cC(n),R):R};j3.gs=function(d,h,v){var y,T,n,R;return typeof d!="string"?(n=v,v=h,h=d,d=null):n=arguments[3],N_(h)?aC(h)?N_(v)?aC(v)||(n=v,v=void 0):v=void 0:(n=h,h=v=void 0):h=void 0,N_(d)?(y=_m.call(d,"c"),T=_m.call(d,"e")):(y=!0,T=!1),R={get:h,set:v,configurable:y,enumerable:T},n?lC(cC(n),R):R}});var Ux=ot((Qq,dC)=>{"use strict";dC.exports=function(d){if(typeof d!="function")throw new TypeError(d+" is not a function");return d}});var Bu=ot((Kx,gC)=>{"use strict";var j_=Ld(),Hx=Ux(),Gx=Function.prototype.apply,qx=Function.prototype.call,hC=Object.create,V3=Object.defineProperty,pC=Object.defineProperties,Zx=Object.prototype.hasOwnProperty,Wx={configurable:!0,enumerable:!1,writable:!0},V_,$x,U_,Xx,fC,Yx,mC;V_=function(d,h){var v;return Hx(h),Zx.call(this,"__ee__")?v=this.__ee__:(v=Wx.value=hC(null),V3(this,"__ee__",Wx),Wx.value=null),v[d]?typeof v[d]=="object"?v[d].push(h):v[d]=[v[d],h]:v[d]=h,this};$x=function(d,h){var v,y;return Hx(h),y=this,V_.call(this,d,v=function(){U_.call(y,d,v),Gx.call(h,this,arguments)}),v.__eeOnceListener__=h,this};U_=function(d,h){var v,y,T,n;if(Hx(h),!Zx.call(this,"__ee__"))return this;if(v=this.__ee__,!v[d])return this;if(y=v[d],typeof y=="object")for(n=0;T=y[n];++n)(T===h||T.__eeOnceListener__===h)&&(y.length===2?v[d]=y[n?0:1]:y.splice(n,1));else(y===h||y.__eeOnceListener__===h)&&delete v[d];return this};Xx=function(d){var h,v,y,T,n;if(Zx.call(this,"__ee__")&&(T=this.__ee__[d],!!T))if(typeof T=="object"){for(v=arguments.length,n=new Array(v-1),h=1;h<v;++h)n[h-1]=arguments[h];for(T=T.slice(),h=0;y=T[h];++h)Gx.call(y,this,n)}else switch(arguments.length){case 1:qx.call(T,this);break;case 2:qx.call(T,this,arguments[1]);break;case 3:qx.call(T,this,arguments[1],arguments[2]);break;default:for(v=arguments.length,n=new Array(v-1),h=1;h<v;++h)n[h-1]=arguments[h];Gx.call(T,this,n)}};fC={on:V_,once:$x,off:U_,emit:Xx};Yx={on:j_(V_),once:j_($x),off:j_(U_),emit:j_(Xx)};mC=pC({},Yx);gC.exports=Kx=function(d){return d==null?hC(mC):pC(Object(d),Yx)};Kx.methods=fC});var zd=ot((x8,TC)=>{function Vc(d){return{prev:null,next:null,data:d}}function op(d,h,v){var y;return np!==null?(y=np,np=np.cursor,y.prev=h,y.next=v,y.cursor=d.cursor):y={prev:h,next:v,cursor:d.cursor},d.cursor=y,y}function sp(d){var h=d.cursor;d.cursor=h.cursor,h.prev=null,h.next=null,h.cursor=np,np=h}var np=null,br=function(){this.cursor=null,this.head=null,this.tail=null};br.createItem=Vc;br.prototype.createItem=Vc;br.prototype.updateCursors=function(d,h,v,y){for(var T=this.cursor;T!==null;)T.prev===d&&(T.prev=h),T.next===v&&(T.next=y),T=T.cursor};br.prototype.getSize=function(){for(var d=0,h=this.head;h;)d++,h=h.next;return d};br.prototype.fromArray=function(d){var h=null;this.head=null;for(var v=0;v<d.length;v++){var y=Vc(d[v]);h!==null?h.next=y:this.head=y,y.prev=h,h=y}return this.tail=h,this};br.prototype.toArray=function(){for(var d=this.head,h=[];d;)h.push(d.data),d=d.next;return h};br.prototype.toJSON=br.prototype.toArray;br.prototype.isEmpty=function(){return this.head===null};br.prototype.first=function(){return this.head&&this.head.data};br.prototype.last=function(){return this.tail&&this.tail.data};br.prototype.each=function(d,h){var v;h===void 0&&(h=this);for(var y=op(this,null,this.head);y.next!==null;)v=y.next,y.next=v.next,d.call(h,v.data,v,this);sp(this)};br.prototype.forEach=br.prototype.each;br.prototype.eachRight=function(d,h){var v;h===void 0&&(h=this);for(var y=op(this,this.tail,null);y.prev!==null;)v=y.prev,y.prev=v.prev,d.call(h,v.data,v,this);sp(this)};br.prototype.forEachRight=br.prototype.eachRight;br.prototype.reduce=function(d,h,v){var y;v===void 0&&(v=this);for(var T=op(this,null,this.head),n=h;T.next!==null;)y=T.next,T.next=y.next,n=d.call(v,n,y.data,y,this);return sp(this),n};br.prototype.reduceRight=function(d,h,v){var y;v===void 0&&(v=this);for(var T=op(this,this.tail,null),n=h;T.prev!==null;)y=T.prev,T.prev=y.prev,n=d.call(v,n,y.data,y,this);return sp(this),n};br.prototype.nextUntil=function(d,h,v){if(d!==null){var y;v===void 0&&(v=this);for(var T=op(this,null,d);T.next!==null&&(y=T.next,T.next=y.next,!h.call(v,y.data,y,this)););sp(this)}};br.prototype.prevUntil=function(d,h,v){if(d!==null){var y;v===void 0&&(v=this);for(var T=op(this,d,null);T.prev!==null&&(y=T.prev,T.prev=y.prev,!h.call(v,y.data,y,this)););sp(this)}};br.prototype.some=function(d,h){var v=this.head;for(h===void 0&&(h=this);v!==null;){if(d.call(h,v.data,v,this))return!0;v=v.next}return!1};br.prototype.map=function(d,h){var v=new br,y=this.head;for(h===void 0&&(h=this);y!==null;)v.appendData(d.call(h,y.data,y,this)),y=y.next;return v};br.prototype.filter=function(d,h){var v=new br,y=this.head;for(h===void 0&&(h=this);y!==null;)d.call(h,y.data,y,this)&&v.appendData(y.data),y=y.next;return v};br.prototype.clear=function(){this.head=null,this.tail=null};br.prototype.copy=function(){for(var d=new br,h=this.head;h!==null;)d.insert(Vc(h.data)),h=h.next;return d};br.prototype.prepend=function(d){return this.updateCursors(null,d,this.head,d),this.head!==null?(this.head.prev=d,d.next=this.head):this.tail=d,this.head=d,this};br.prototype.prependData=function(d){return this.prepend(Vc(d))};br.prototype.append=function(d){return this.insert(d)};br.prototype.appendData=function(d){return this.insert(Vc(d))};br.prototype.insert=function(d,h){if(h!=null)if(this.updateCursors(h.prev,d,h,d),h.prev===null){if(this.head!==h)throw new Error("before doesn't belong to list");this.head=d,h.prev=d,d.next=h,this.updateCursors(null,d)}else h.prev.next=d,d.prev=h.prev,h.prev=d,d.next=h;else this.updateCursors(this.tail,d,null,d),this.tail!==null?(this.tail.next=d,d.prev=this.tail):this.head=d,this.tail=d;return this};br.prototype.insertData=function(d,h){return this.insert(Vc(d),h)};br.prototype.remove=function(d){if(this.updateCursors(d,d.prev,d,d.next),d.prev!==null)d.prev.next=d.next;else{if(this.head!==d)throw new Error("item doesn't belong to list");this.head=d.next}if(d.next!==null)d.next.prev=d.prev;else{if(this.tail!==d)throw new Error("item doesn't belong to list");this.tail=d.prev}return d.prev=null,d.next=null,d};br.prototype.push=function(d){this.insert(Vc(d))};br.prototype.pop=function(){if(this.tail!==null)return this.remove(this.tail)};br.prototype.unshift=function(d){this.prepend(Vc(d))};br.prototype.shift=function(){if(this.head!==null)return this.remove(this.head)};br.prototype.prependList=function(d){return this.insertList(d,this.head)};br.prototype.appendList=function(d){return this.insertList(d)};br.prototype.insertList=function(d,h){return d.head===null?this:(h!=null?(this.updateCursors(h.prev,d.tail,h,d.head),h.prev!==null?(h.prev.next=d.head,d.head.prev=h.prev):this.head=d.head,h.prev=d.tail,d.tail.next=h):(this.updateCursors(this.tail,d.tail,null,d.head),this.tail!==null?(this.tail.next=d.head,d.head.prev=this.tail):this.head=d.head,this.tail=d.tail),d.head=null,d.tail=null,this)};br.prototype.replace=function(d,h){"head"in h?this.insertList(h,d):this.insert(h,d),this.remove(d)};TC.exports=br});var Z_=ot((b8,CC)=>{CC.exports=function(h,v){var y=Object.create(SyntaxError.prototype),T=new Error;return y.name=h,y.message=v,Object.defineProperty(y,"stack",{get:function(){return(T.stack||"").replace(/^(.+\n){1,3}/,h+": "+v+`
`)}}),y}});var n0=ot((w8,IC)=>{var W3=Z_(),r0=100,EC=60,AC="    ";function kC(d,h){function v(be,oe){return y.slice(be,oe).map(function(Se,Re){for(var tt=String(be+Re+1);tt.length<Y;)tt=" "+tt;return tt+" |"+Se}).join(`
`)}var y=d.source.split(/\r\n?|\n|\f/),T=d.line,n=d.column,R=Math.max(1,T-h)-1,j=Math.min(T+h,y.length+1),Y=Math.max(4,String(j).length)+1,re=0;n+=(AC.length-1)*(y[T-1].substr(0,n-1).match(/\t/g)||[]).length,n>r0&&(re=n-EC+3,n=EC-2);for(var me=R;me<=j;me++)me>=0&&me<y.length&&(y[me]=y[me].replace(/\t/g,AC),y[me]=(re>0&&y[me].length>re?"\u2026":"")+y[me].substr(re,r0-2)+(y[me].length>re+r0-1?"\u2026":""));return[v(R,T),new Array(n+Y+2).join("-")+"^",v(T,j)].filter(Boolean).join(`
`)}var G3=function(d,h,v,y,T){var n=W3("SyntaxError",d);return n.source=h,n.offset=v,n.line=y,n.column=T,n.sourceFragment=function(R){return kC(n,isNaN(R)?0:R)},Object.defineProperty(n,"formattedMessage",{get:function(){return"Parse error: "+n.message+`
`+kC(n,2)}}),n.parseError={offset:v,line:y,column:T},n};IC.exports=G3});var ym=ot((S8,PC)=>{var o0={EOF:0,Ident:1,Function:2,AtKeyword:3,Hash:4,String:5,BadString:6,Url:7,BadUrl:8,Delim:9,Number:10,Percentage:11,Dimension:12,WhiteSpace:13,CDO:14,CDC:15,Colon:16,Semicolon:17,Comma:18,LeftSquareBracket:19,RightSquareBracket:20,LeftParenthesis:21,RightParenthesis:22,LeftCurlyBracket:23,RightCurlyBracket:24,Comment:25},H3=Object.keys(o0).reduce(function(d,h){return d[o0[h]]=h,d},{});PC.exports={TYPE:o0,NAME:H3}});var l0=ot((T8,BC)=>{var Z3=0;function Fu(d){return d>=48&&d<=57}function $3(d){return Fu(d)||d>=65&&d<=70||d>=97&&d<=102}function LC(d){return d>=65&&d<=90}function zC(d){return d>=97&&d<=122}function MC(d){return LC(d)||zC(d)}function OC(d){return d>=128}function vm(d){return MC(d)||OC(d)||d===95}function X3(d){return vm(d)||Fu(d)||d===45}function RC(d){return d>=0&&d<=8||d===11||d>=14&&d<=31||d===127}function a0(d){return d===10||d===13||d===12}function DC(d){return a0(d)||d===32||d===9}function s0(d,h){return!(d!==92||a0(h)||h===Z3)}function Y3(d,h,v){return d===45?vm(h)||h===45||s0(h,v):vm(d)?!0:d===92?s0(d,h):!1}function K3(d,h,v){return d===43||d===45?Fu(h)?2:h===46&&Fu(v)?3:0:d===46?Fu(h)?2:0:Fu(d)?1:0}function J3(d){return d===65279||d===65534?1:0}var Md=new Array(128);Wa.Eof=128;Wa.WhiteSpace=130;Wa.Digit=131;Wa.NameStart=132;Wa.NonPrintable=133;for(wa=0;wa<Md.length;wa++)switch(!0){case DC(wa):Md[wa]=Wa.WhiteSpace;break;case Fu(wa):Md[wa]=Wa.Digit;break;case vm(wa):Md[wa]=Wa.NameStart;break;case RC(wa):Md[wa]=Wa.NonPrintable;break;default:Md[wa]=wa||Wa.Eof}var wa;function Wa(d){return d<128?Md[d]:Wa.NameStart}BC.exports={isDigit:Fu,isHexDigit:$3,isUppercaseLetter:LC,isLowercaseLetter:zC,isLetter:MC,isNonAscii:OC,isNameStart:vm,isName:X3,isNonPrintable:RC,isNewline:a0,isWhiteSpace:DC,isValidEscape:s0,isIdentifierStart:Y3,isNumberStart:K3,isBOM:J3,charCodeCategory:Wa}});var cp=ot((C8,qC)=>{var lp=l0(),$_=lp.isDigit,FC=lp.isHexDigit,NC=lp.isUppercaseLetter,Q3=lp.isName,u0=lp.isWhiteSpace,jC=lp.isValidEscape;function ap(d,h){return h<d.length?d.charCodeAt(h):0}function VC(d,h,v){return v===13&&ap(d,h+1)===10?2:1}function UC(d,h,v){var y=d.charCodeAt(h);return NC(y)&&(y=y|32),y===v}function eF(d,h,v,y){if(v-h!==y.length||h<0||v>d.length)return!1;for(var T=h;T<v;T++){var n=d.charCodeAt(T),R=y.charCodeAt(T-h);if(NC(n)&&(n=n|32),n!==R)return!1}return!0}function tF(d,h){for(;h>=0&&u0(d.charCodeAt(h));h--);return h+1}function iF(d,h){for(;h<d.length&&u0(d.charCodeAt(h));h++);return h}function c0(d,h){for(;h<d.length&&$_(d.charCodeAt(h));h++);return h}function d0(d,h){if(h+=2,FC(ap(d,h-1))){for(var v=Math.min(d.length,h+5);h<v&&FC(ap(d,h));h++);var y=ap(d,h);u0(y)&&(h+=VC(d,h,y))}return h}function rF(d,h){for(;h<d.length;h++){var v=d.charCodeAt(h);if(!Q3(v)){if(jC(v,ap(d,h+1))){h=d0(d,h)-1;continue}break}}return h}function nF(d,h){var v=d.charCodeAt(h);if((v===43||v===45)&&(v=d.charCodeAt(h+=1)),$_(v)&&(h=c0(d,h+1),v=d.charCodeAt(h)),v===46&&$_(d.charCodeAt(h+1))&&(v=d.charCodeAt(h+=2),h=c0(d,h)),UC(d,h,101)){var y=0;v=d.charCodeAt(h+1),(v===45||v===43)&&(y=1,v=d.charCodeAt(h+2)),$_(v)&&(h=c0(d,h+1+y+1))}return h}function oF(d,h){for(;h<d.length;h++){var v=d.charCodeAt(h);if(v===41){h++;break}jC(v,ap(d,h+1))&&(h=d0(d,h))}return h}qC.exports={consumeEscaped:d0,consumeName:rF,consumeNumber:nF,consumeBadUrlRemnants:oF,cmpChar:UC,cmpStr:eF,getNewlineLength:VC,findWhiteSpaceStart:tF,findWhiteSpaceEnd:iF}});var bm=ot((E8,$C)=>{var HC=ym(),xm=HC.TYPE,sF=HC.NAME,aF=cp(),lF=aF.cmpStr,WC=xm.EOF,GC=xm.WhiteSpace,cF=xm.Comment,bl=16777215,up=24,ZC=function(){this.offsetAndType=null,this.balance=null,this.reset()};ZC.prototype={reset:function(){this.eof=!1,this.tokenIndex=-1,this.tokenType=0,this.tokenStart=this.firstCharOffset,this.tokenEnd=this.firstCharOffset},lookupType:function(d){return d+=this.tokenIndex,d<this.tokenCount?this.offsetAndType[d]>>up:WC},lookupOffset:function(d){return d+=this.tokenIndex,d<this.tokenCount?this.offsetAndType[d-1]&bl:this.source.length},lookupValue:function(d,h){return d+=this.tokenIndex,d<this.tokenCount?lF(this.source,this.offsetAndType[d-1]&bl,this.offsetAndType[d]&bl,h):!1},getTokenStart:function(d){return d===this.tokenIndex?this.tokenStart:d>0?d<this.tokenCount?this.offsetAndType[d-1]&bl:this.offsetAndType[this.tokenCount]&bl:this.firstCharOffset},getRawLength:function(d,h){var v=d,y,T=this.offsetAndType[Math.max(v-1,0)]&bl,n;e:for(;v<this.tokenCount;v++){if(y=this.balance[v],y<d)break e;switch(n=this.offsetAndType[v]>>up,h(n,this.source,T)){case 1:break e;case 2:v++;break e;default:this.balance[y]===v&&(v=y),T=this.offsetAndType[v]&bl}}return v-this.tokenIndex},isBalanceEdge:function(d){return this.balance[this.tokenIndex]<d},isDelim:function(d,h){return h?this.lookupType(h)===xm.Delim&&this.source.charCodeAt(this.lookupOffset(h))===d:this.tokenType===xm.Delim&&this.source.charCodeAt(this.tokenStart)===d},getTokenValue:function(){return this.source.substring(this.tokenStart,this.tokenEnd)},getTokenLength:function(){return this.tokenEnd-this.tokenStart},substrToCursor:function(d){return this.source.substring(d,this.tokenStart)},skipWS:function(){for(var d=this.tokenIndex,h=0;d<this.tokenCount&&this.offsetAndType[d]>>up===GC;d++,h++);h>0&&this.skip(h)},skipSC:function(){for(;this.tokenType===GC||this.tokenType===cF;)this.next()},skip:function(d){var h=this.tokenIndex+d;h<this.tokenCount?(this.tokenIndex=h,this.tokenStart=this.offsetAndType[h-1]&bl,h=this.offsetAndType[h],this.tokenType=h>>up,this.tokenEnd=h&bl):(this.tokenIndex=this.tokenCount,this.next())},next:function(){var d=this.tokenIndex+1;d<this.tokenCount?(this.tokenIndex=d,this.tokenStart=this.tokenEnd,d=this.offsetAndType[d],this.tokenType=d>>up,this.tokenEnd=d&bl):(this.tokenIndex=this.tokenCount,this.eof=!0,this.tokenType=WC,this.tokenStart=this.tokenEnd=this.source.length)},forEachToken(d){for(var h=0,v=this.firstCharOffset;h<this.tokenCount;h++){var y=v,T=this.offsetAndType[h],n=T&bl,R=T>>up;v=n,d(R,y,n,h)}},dump(){var d=new Array(this.tokenCount);return this.forEachToken((h,v,y,T)=>{d[T]={idx:T,type:sF[h],chunk:this.source.substring(v,y),balance:this.balance[T]}}),d}};$C.exports=ZC});var X_=ot((A8,XC)=>{function uF(d){return d}function dF(d){return d.min===0&&d.max===0?"*":d.min===0&&d.max===1?"?":d.min===1&&d.max===0?d.comma?"#":"+":d.min===1&&d.max===1?"":(d.comma?"#":"")+(d.min===d.max?"{"+d.min+"}":"{"+d.min+","+(d.max!==0?d.max:"")+"}")}function hF(d){switch(d.type){case"Range":return" ["+(d.min===null?"-\u221E":d.min)+","+(d.max===null?"\u221E":d.max)+"]";default:throw new Error("Unknown node type `"+d.type+"`")}}function pF(d,h,v,y){var T=d.combinator===" "||y?d.combinator:" "+d.combinator+" ",n=d.terms.map(function(R){return h0(R,h,v,y)}).join(T);return(d.explicit||v)&&(n=(y||n[0]===","?"[":"[ ")+n+(y?"]":" ]")),n}function h0(d,h,v,y){var T;switch(d.type){case"Group":T=pF(d,h,v,y)+(d.disallowEmpty?"!":"");break;case"Multiplier":return h0(d.term,h,v,y)+h(dF(d),d);case"Type":T="<"+d.name+(d.opts?h(hF(d.opts),d.opts):"")+">";break;case"Property":T="<'"+d.name+"'>";break;case"Keyword":T=d.name;break;case"AtKeyword":T="@"+d.name;break;case"Function":T=d.name+"(";break;case"String":case"Token":T=d.value;break;case"Comma":T=",";break;default:throw new Error("Unknown node type `"+d.type+"`")}return h(T,d)}XC.exports=function(d,h){var v=uF,y=!1,T=!1;return typeof h=="function"?v=h:h&&(y=!!h.forceBraces,T=!!h.compact,typeof h.decorate=="function"&&(v=h.decorate)),h0(d,v,y,T)}});var p0=ot((k8,JC)=>{var KC=Z_(),fF=X_(),YC={offset:0,line:1,column:1};function mF(d,h){let v=d.tokens,y=d.longestMatch,T=y<v.length&&v[y].node||null,n=T!==h?T:null,R=0,j=0,Y=0,re="",me,be;for(let oe=0;oe<v.length;oe++){let Se=v[oe].value;oe===y&&(j=Se.length,R=re.length),n!==null&&v[oe].node===n&&(oe<=y?Y++:Y=0),re+=Se}return y===v.length||Y>1?(me=Y_(n||h,"end")||wm(YC,re),be=wm(me)):(me=Y_(n,"start")||wm(Y_(h,"start")||YC,re.slice(0,R)),be=Y_(n,"end")||wm(me,re.substr(R,j))),{css:re,mismatchOffset:R,mismatchLength:j,start:me,end:be}}function Y_(d,h){let v=d&&d.loc&&d.loc[h];return v?"line"in v?wm(v):v:null}function wm({offset:d,line:h,column:v},y){let T={offset:d,line:h,column:v};if(y){let n=y.split(/\n|\r\n?|\f/);T.offset+=y.length,T.line+=n.length-1,T.column=n.length===1?T.column+y.length:n.pop().length+1}return T}var gF=function(d,h){let v=KC("SyntaxReferenceError",d+(h?" `"+h+"`":""));return v.reference=h,v},_F=function(d,h,v,y){let T=KC("SyntaxMatchError",d),{css:n,mismatchOffset:R,mismatchLength:j,start:Y,end:re}=mF(y,v);return T.rawMessage=d,T.syntax=h?fF(h):"<generic>",T.css=n,T.mismatchOffset=R,T.mismatchLength=j,T.message=d+`
  syntax: `+T.syntax+`
   value: `+(n||"<empty string>")+`
  --------`+new Array(T.mismatchOffset+1).join("-")+"^",Object.assign(T,Y),T.loc={source:v&&v.loc&&v.loc.source||"<unknown>",start:Y,end:re},T};JC.exports={SyntaxReferenceError:gF,SyntaxMatchError:_F}});var Q_=ot((I8,QC)=>{var K_=Object.prototype.hasOwnProperty,dp=Object.create(null),hp=Object.create(null),J_=45;function f0(d,h){return h=h||0,d.length-h>=2&&d.charCodeAt(h)===J_&&d.charCodeAt(h+1)===J_}function m0(d,h){if(h=h||0,d.length-h>=3&&d.charCodeAt(h)===J_&&d.charCodeAt(h+1)!==J_){var v=d.indexOf("-",h+2);if(v!==-1)return d.substring(h,v+1)}return""}function yF(d){if(K_.call(dp,d))return dp[d];var h=d.toLowerCase();if(K_.call(dp,h))return dp[d]=dp[h];var v=f0(h,0),y=v?"":m0(h,0);return dp[d]=Object.freeze({basename:h.substr(y.length),name:h,vendor:y,prefix:y,custom:v})}function vF(d){if(K_.call(hp,d))return hp[d];var h=d,v=d[0];v==="/"?v=d[1]==="/"?"//":"/":v!=="_"&&v!=="*"&&v!=="$"&&v!=="#"&&v!=="+"&&v!=="&"&&(v="");var y=f0(h,v.length);if(!y&&(h=h.toLowerCase(),K_.call(hp,h)))return hp[d]=hp[h];var T=y?"":m0(h,v.length),n=h.substr(0,v.length+T.length);return hp[d]=Object.freeze({basename:h.substr(n.length),name:h.substr(v.length),hack:v,vendor:T,prefix:n,custom:y})}QC.exports={keyword:yF,property:vF,isCustomProperty:f0,vendorPrefix:m0}});var g0=ot((P8,eE)=>{var xF=16384,bF=typeof Uint32Array<"u"?Uint32Array:Array;eE.exports=function(h,v){return h===null||h.length<v?new bF(Math.max(v+1024,xF)):h}});var Ei=ot((L8,sE)=>{var wF=bm(),tE=g0(),x0=ym(),Tr=x0.TYPE,Uc=l0(),iE=Uc.isNewline,SF=Uc.isName,ey=Uc.isValidEscape,_0=Uc.isNumberStart,y0=Uc.isIdentifierStart,Ga=Uc.charCodeCategory,TF=Uc.isBOM,qc=cp(),CF=qc.cmpStr,rE=qc.getNewlineLength,ty=qc.findWhiteSpaceEnd,nE=qc.consumeEscaped,iy=qc.consumeName,EF=qc.consumeNumber,v0=qc.consumeBadUrlRemnants,oE=16777215,pp=24;function ry(d,h){function v(St){return St<j?d.charCodeAt(St):0}function y(){if(oe=EF(d,oe),y0(v(oe),v(oe+1),v(oe+2))){qe=Tr.Dimension,oe=iy(d,oe);return}if(v(oe)===37){qe=Tr.Percentage,oe++;return}qe=Tr.Number}function T(){let St=oe;if(oe=iy(d,oe),CF(d,St,oe,"url")&&v(oe)===40){if(oe=ty(d,oe+1),v(oe)===34||v(oe)===39){qe=Tr.Function,oe=St+4;return}R();return}if(v(oe)===40){qe=Tr.Function,oe++;return}qe=Tr.Ident}function n(St){for(St||(St=v(oe++)),qe=Tr.String;oe<d.length;oe++){var ai=d.charCodeAt(oe);switch(Ga(ai)){case St:oe++;return;case Ga.Eof:return;case Ga.WhiteSpace:if(iE(ai)){oe+=rE(d,oe,ai),qe=Tr.BadString;return}break;case 92:if(oe===d.length-1)break;var pi=v(oe+1);iE(pi)?oe+=rE(d,oe+1,pi):ey(ai,pi)&&(oe=nE(d,oe)-1);break}}}function R(){for(qe=Tr.Url,oe=ty(d,oe);oe<d.length;oe++){var St=d.charCodeAt(oe);switch(Ga(St)){case 41:oe++;return;case Ga.Eof:return;case Ga.WhiteSpace:if(oe=ty(d,oe),v(oe)===41||oe>=d.length){oe<d.length&&oe++;return}oe=v0(d,oe),qe=Tr.BadUrl;return;case 34:case 39:case 40:case Ga.NonPrintable:oe=v0(d,oe),qe=Tr.BadUrl;return;case 92:if(ey(St,v(oe+1))){oe=nE(d,oe)-1;break}oe=v0(d,oe),qe=Tr.BadUrl;return}}}h||(h=new wF),d=String(d||"");for(var j=d.length,Y=tE(h.offsetAndType,j+1),re=tE(h.balance,j+1),me=0,be=TF(v(0)),oe=be,Se=0,Re=0,tt=0;oe<j;){var yt=d.charCodeAt(oe),qe=0;switch(re[me]=j,Ga(yt)){case Ga.WhiteSpace:qe=Tr.WhiteSpace,oe=ty(d,oe+1);break;case 34:n();break;case 35:SF(v(oe+1))||ey(v(oe+1),v(oe+2))?(qe=Tr.Hash,oe=iy(d,oe+1)):(qe=Tr.Delim,oe++);break;case 39:n();break;case 40:qe=Tr.LeftParenthesis,oe++;break;case 41:qe=Tr.RightParenthesis,oe++;break;case 43:_0(yt,v(oe+1),v(oe+2))?y():(qe=Tr.Delim,oe++);break;case 44:qe=Tr.Comma,oe++;break;case 45:_0(yt,v(oe+1),v(oe+2))?y():v(oe+1)===45&&v(oe+2)===62?(qe=Tr.CDC,oe=oe+3):y0(yt,v(oe+1),v(oe+2))?T():(qe=Tr.Delim,oe++);break;case 46:_0(yt,v(oe+1),v(oe+2))?y():(qe=Tr.Delim,oe++);break;case 47:v(oe+1)===42?(qe=Tr.Comment,oe=d.indexOf("*/",oe+2)+2,oe===1&&(oe=d.length)):(qe=Tr.Delim,oe++);break;case 58:qe=Tr.Colon,oe++;break;case 59:qe=Tr.Semicolon,oe++;break;case 60:v(oe+1)===33&&v(oe+2)===45&&v(oe+3)===45?(qe=Tr.CDO,oe=oe+4):(qe=Tr.Delim,oe++);break;case 64:y0(v(oe+1),v(oe+2),v(oe+3))?(qe=Tr.AtKeyword,oe=iy(d,oe+1)):(qe=Tr.Delim,oe++);break;case 91:qe=Tr.LeftSquareBracket,oe++;break;case 92:ey(yt,v(oe+1))?T():(qe=Tr.Delim,oe++);break;case 93:qe=Tr.RightSquareBracket,oe++;break;case 123:qe=Tr.LeftCurlyBracket,oe++;break;case 125:qe=Tr.RightCurlyBracket,oe++;break;case Ga.Digit:y();break;case Ga.NameStart:T();break;case Ga.Eof:break;default:qe=Tr.Delim,oe++}switch(qe){case Se:for(tt=Re&oE,Re=re[tt],Se=Re>>pp,re[me]=tt,re[tt++]=me;tt<me;tt++)re[tt]===j&&(re[tt]=me);break;case Tr.LeftParenthesis:case Tr.Function:re[me]=Re,Se=Tr.RightParenthesis,Re=Se<<pp|me;break;case Tr.LeftSquareBracket:re[me]=Re,Se=Tr.RightSquareBracket,Re=Se<<pp|me;break;case Tr.LeftCurlyBracket:re[me]=Re,Se=Tr.RightCurlyBracket,Re=Se<<pp|me;break}Y[me++]=qe<<pp|oe}for(Y[me]=Tr.EOF<<pp|oe,re[me]=j,re[j]=j;Re!==0;)tt=Re&oE,Re=re[tt],re[tt]=j;return h.source=d,h.firstCharOffset=be,h.offsetAndType=Y,h.tokenCount=me,h.balance=re,h.reset(),h.next(),h}Object.keys(x0).forEach(function(d){ry[d]=x0[d]});Object.keys(Uc).forEach(function(d){ry[d]=Uc[d]});Object.keys(qc).forEach(function(d){ry[d]=qc[d]});sE.exports=ry});var cE=ot((z8,lE)=>{var aE=Ei().isDigit,b0=Ei().cmpChar,mp=Ei().TYPE,AF=mp.Delim,kF=mp.WhiteSpace,IF=mp.Comment,ny=mp.Ident,T0=mp.Number,PF=mp.Dimension,Tm=43,nc=45,w0=110,fp=!0,LF=!1;function C0(d,h){return d!==null&&d.type===AF&&d.value.charCodeAt(0)===h}function Sm(d,h,v){for(;d!==null&&(d.type===kF||d.type===IF);)d=v(++h);return h}function Nu(d,h,v,y){if(!d)return 0;var T=d.value.charCodeAt(h);if(T===Tm||T===nc){if(v)return 0;h++}for(;h<d.value.length;h++)if(!aE(d.value.charCodeAt(h)))return 0;return y+1}function S0(d,h,v){var y=!1,T=Sm(d,h,v);if(d=v(T),d===null)return h;if(d.type!==T0)if(C0(d,Tm)||C0(d,nc)){if(y=!0,T=Sm(v(++T),T,v),d=v(T),d===null&&d.type!==T0)return 0}else return h;if(!y){var n=d.value.charCodeAt(0);if(n!==Tm&&n!==nc)return 0}return Nu(d,y?0:1,y,T)}lE.exports=function(h,v){var y=0;if(!h)return 0;if(h.type===T0)return Nu(h,0,LF,y);if(h.type===ny&&h.value.charCodeAt(0)===nc){if(!b0(h.value,1,w0))return 0;switch(h.value.length){case 2:return S0(v(++y),y,v);case 3:return h.value.charCodeAt(2)!==nc?0:(y=Sm(v(++y),y,v),h=v(y),Nu(h,0,fp,y));default:return h.value.charCodeAt(2)!==nc?0:Nu(h,3,fp,y)}}else if(h.type===ny||C0(h,Tm)&&v(y+1).type===ny){if(h.type!==ny&&(h=v(++y)),h===null||!b0(h.value,0,w0))return 0;switch(h.value.length){case 1:return S0(v(++y),y,v);case 2:return h.value.charCodeAt(1)!==nc?0:(y=Sm(v(++y),y,v),h=v(y),Nu(h,0,fp,y));default:return h.value.charCodeAt(1)!==nc?0:Nu(h,2,fp,y)}}else if(h.type===PF){for(var T=h.value.charCodeAt(0),n=T===Tm||T===nc?1:0,R=n;R<h.value.length&&aE(h.value.charCodeAt(R));R++);return R===n||!b0(h.value,R,w0)?0:R+1===h.value.length?S0(v(++y),y,v):h.value.charCodeAt(R+1)!==nc?0:R+2===h.value.length?(y=Sm(v(++y),y,v),h=v(y),Nu(h,0,fp,y)):Nu(h,R+2,fp,y)}return 0}});var gE=ot((M8,mE)=>{var zF=Ei().isHexDigit,MF=Ei().cmpChar,sy=Ei().TYPE,uE=sy.Ident,OF=sy.Delim,dE=sy.Number,hE=sy.Dimension,E0=43,pE=45,fE=63,RF=117;function k0(d,h){return d!==null&&d.type===OF&&d.value.charCodeAt(0)===h}function A0(d,h){return d.value.charCodeAt(0)===h}function Cm(d,h,v){for(var y=h,T=0;y<d.value.length;y++){var n=d.value.charCodeAt(y);if(n===pE&&v&&T!==0)return Cm(d,h+T+1,!1)>0?6:0;if(!zF(n)||++T>6)return 0}return T}function oy(d,h,v){if(!d)return 0;for(;k0(v(h),fE);){if(++d>6)return 0;h++}return h}mE.exports=function(h,v){var y=0;if(h===null||h.type!==uE||!MF(h.value,0,RF)||(h=v(++y),h===null))return 0;if(k0(h,E0))return h=v(++y),h===null?0:h.type===uE?oy(Cm(h,0,!0),++y,v):k0(h,fE)?oy(1,++y,v):0;if(h.type===dE){if(!A0(h,E0))return 0;var T=Cm(h,1,!0);return T===0?0:(h=v(++y),h===null?y:h.type===hE||h.type===dE?!A0(h,pE)||!Cm(h,1,!1)?0:y+1:oy(T,y,v))}return h.type===hE&&A0(h,E0)?oy(Cm(h,1,!0),++y,v):0}});var TE=ot((O8,SE)=>{var gp=Ei(),DF=gp.isIdentifierStart,BF=gp.isHexDigit,yE=gp.isDigit,FF=gp.cmpStr,vE=gp.consumeNumber,ar=gp.TYPE,NF=cE(),jF=gE(),VF=["unset","initial","inherit"],UF=["calc(","-moz-calc(","-webkit-calc("],qF={px:!0,mm:!0,cm:!0,in:!0,pt:!0,pc:!0,q:!0,em:!0,ex:!0,ch:!0,rem:!0,vh:!0,vw:!0,vmin:!0,vmax:!0,vm:!0},WF={deg:!0,grad:!0,rad:!0,turn:!0},GF={s:!0,ms:!0},HF={hz:!0,khz:!0},ZF={dpi:!0,dpcm:!0,dppx:!0,x:!0},$F={fr:!0},XF={db:!0},YF={st:!0};function Em(d,h){return h<d.length?d.charCodeAt(h):0}function I0(d,h){return FF(d,0,d.length,h)}function xE(d,h){for(var v=0;v<h.length;v++)if(I0(d,h[v]))return!0;return!1}function bE(d,h){return h!==d.length-2?!1:d.charCodeAt(h)===92&&yE(d.charCodeAt(h+1))}function ay(d,h,v){if(d&&d.type==="Range"){var y=Number(v!==void 0&&v!==h.length?h.substr(0,v):h);if(isNaN(y)||d.min!==null&&y<d.min||d.max!==null&&y>d.max)return!0}return!1}function wE(d,h){var v=d.index,y=0;do if(y++,d.balance<=v)break;while(d=h(y));return y}function Ha(d){return function(h,v,y){return h===null?0:h.type===ar.Function&&xE(h.value,UF)?wE(h,v):d(h,v,y)}}function Nn(d){return function(h){return h===null||h.type!==d?0:1}}function KF(d){return d=d+"(",function(h,v){return h!==null&&I0(h.value,d)?wE(h,v):0}}function JF(d){if(d===null||d.type!==ar.Ident)return 0;var h=d.value.toLowerCase();return xE(h,VF)||I0(h,"default")?0:1}function QF(d){return d===null||d.type!==ar.Ident||Em(d.value,0)!==45||Em(d.value,1)!==45?0:1}function e5(d){if(d===null||d.type!==ar.Hash)return 0;var h=d.value.length;if(h!==4&&h!==5&&h!==7&&h!==9)return 0;for(var v=1;v<h;v++)if(!BF(d.value.charCodeAt(v)))return 0;return 1}function t5(d){return d===null||d.type!==ar.Hash||!DF(Em(d.value,1),Em(d.value,2),Em(d.value,3))?0:1}function i5(d,h){if(!d)return 0;var v=0,y=0,T=d.index;e:do{switch(d.type){case ar.BadString:case ar.BadUrl:break e;case ar.RightCurlyBracket:case ar.RightParenthesis:case ar.RightSquareBracket:if(d.balance>d.index||d.balance<T)break e;y--;break;case ar.Semicolon:if(y===0)break e;break;case ar.Delim:if(d.value==="!"&&y===0)break e;break;case ar.Function:case ar.LeftParenthesis:case ar.LeftSquareBracket:case ar.LeftCurlyBracket:y++;break}if(v++,d.balance<=T)break}while(d=h(v));return v}function r5(d,h){if(!d)return 0;var v=d.index,y=0;e:do{switch(d.type){case ar.BadString:case ar.BadUrl:break e;case ar.RightCurlyBracket:case ar.RightParenthesis:case ar.RightSquareBracket:if(d.balance>d.index||d.balance<v)break e;break}if(y++,d.balance<=v)break}while(d=h(y));return y}function Wc(d){return function(h,v,y){if(h===null||h.type!==ar.Dimension)return 0;var T=vE(h.value,0);if(d!==null){var n=h.value.indexOf("\\",T),R=n===-1||!bE(h.value,n)?h.value.substr(T):h.value.substring(T,n);if(d.hasOwnProperty(R.toLowerCase())===!1)return 0}return ay(y,h.value,T)?0:1}}function n5(d,h,v){return d===null||d.type!==ar.Percentage||ay(v,d.value,d.value.length-1)?0:1}function _E(d){return typeof d!="function"&&(d=function(){return 0}),function(h,v,y){return h!==null&&h.type===ar.Number&&Number(h.value)===0?1:d(h,v,y)}}function o5(d,h,v){if(d===null)return 0;var y=vE(d.value,0),T=y===d.value.length;return!T&&!bE(d.value,y)||ay(v,d.value,y)?0:1}function s5(d,h,v){if(d===null||d.type!==ar.Number)return 0;for(var y=d.value.charCodeAt(0)===43||d.value.charCodeAt(0)===45?1:0;y<d.value.length;y++)if(!yE(d.value.charCodeAt(y)))return 0;return ay(v,d.value,y)?0:1}SE.exports={"ident-token":Nn(ar.Ident),"function-token":Nn(ar.Function),"at-keyword-token":Nn(ar.AtKeyword),"hash-token":Nn(ar.Hash),"string-token":Nn(ar.String),"bad-string-token":Nn(ar.BadString),"url-token":Nn(ar.Url),"bad-url-token":Nn(ar.BadUrl),"delim-token":Nn(ar.Delim),"number-token":Nn(ar.Number),"percentage-token":Nn(ar.Percentage),"dimension-token":Nn(ar.Dimension),"whitespace-token":Nn(ar.WhiteSpace),"CDO-token":Nn(ar.CDO),"CDC-token":Nn(ar.CDC),"colon-token":Nn(ar.Colon),"semicolon-token":Nn(ar.Semicolon),"comma-token":Nn(ar.Comma),"[-token":Nn(ar.LeftSquareBracket),"]-token":Nn(ar.RightSquareBracket),"(-token":Nn(ar.LeftParenthesis),")-token":Nn(ar.RightParenthesis),"{-token":Nn(ar.LeftCurlyBracket),"}-token":Nn(ar.RightCurlyBracket),string:Nn(ar.String),ident:Nn(ar.Ident),"custom-ident":JF,"custom-property-name":QF,"hex-color":e5,"id-selector":t5,"an-plus-b":NF,urange:jF,"declaration-value":i5,"any-value":r5,dimension:Ha(Wc(null)),angle:Ha(Wc(WF)),decibel:Ha(Wc(XF)),frequency:Ha(Wc(HF)),flex:Ha(Wc($F)),length:Ha(_E(Wc(qF))),resolution:Ha(Wc(ZF)),semitones:Ha(Wc(YF)),time:Ha(Wc(GF)),percentage:Ha(n5),zero:_E(),number:Ha(o5),integer:Ha(s5),"-ms-legacy-expression":KF("expression")}});var P0=ot((R8,CE)=>{var a5=Z_();CE.exports=function(h,v,y){var T=a5("SyntaxError",h);return T.input=v,T.offset=y,T.rawMessage=h,T.message=T.rawMessage+`
  `+T.input+`
--`+new Array((T.offset||T.input.length)+1).join("-")+"^",T}});var kE=ot((D8,AE)=>{var l5=P0(),c5=9,u5=10,d5=12,h5=13,p5=32,EE=function(d){this.str=d,this.pos=0};EE.prototype={charCodeAt:function(d){return d<this.str.length?this.str.charCodeAt(d):0},charCode:function(){return this.charCodeAt(this.pos)},nextCharCode:function(){return this.charCodeAt(this.pos+1)},nextNonWsCode:function(d){return this.charCodeAt(this.findWsEnd(d))},findWsEnd:function(d){for(;d<this.str.length;d++){var h=this.str.charCodeAt(d);if(h!==h5&&h!==u5&&h!==d5&&h!==p5&&h!==c5)break}return d},substringToPos:function(d){return this.str.substring(this.pos,this.pos=d)},eat:function(d){this.charCode()!==d&&this.error("Expect `"+String.fromCharCode(d)+"`"),this.pos++},peek:function(){return this.pos<this.str.length?this.str.charAt(this.pos++):""},error:function(d){throw new l5(d,this.str,this.pos)}};AE.exports=EE});var fy=ot((B8,GE)=>{var f5=kE(),m5=9,g5=10,_5=12,y5=13,v5=32,DE=33,BE=35,IE=38,ly=39,FE=40,x5=41,NE=42,jE=43,M0=44,PE=45,O0=60,VE=62,UE=63,b5=64,hy=91,R0=93,cy=123,LE=124,zE=125,ME=8734,z0=w5(function(d){return/[a-zA-Z0-9\-]/.test(d)}),OE={" ":1,"&&":2,"||":3,"|":4};function w5(d){for(var h=typeof Uint32Array=="function"?new Uint32Array(128):new Array(128),v=0;v<128;v++)h[v]=d(String.fromCharCode(v))?1:0;return h}function uy(d){return d.substringToPos(d.findWsEnd(d.pos))}function py(d){for(var h=d.pos;h<d.str.length;h++){var v=d.str.charCodeAt(h);if(v>=128||z0[v]===0)break}return d.pos===h&&d.error("Expect a keyword"),d.substringToPos(h)}function dy(d){for(var h=d.pos;h<d.str.length;h++){var v=d.str.charCodeAt(h);if(v<48||v>57)break}return d.pos===h&&d.error("Expect a number"),d.substringToPos(h)}function S5(d){var h=d.str.indexOf("'",d.pos+1);return h===-1&&(d.pos=d.str.length,d.error("Expect an apostrophe")),d.substringToPos(h+1)}function RE(d){var h=null,v=null;return d.eat(cy),h=dy(d),d.charCode()===M0?(d.pos++,d.charCode()!==zE&&(v=dy(d))):v=h,d.eat(zE),{min:Number(h),max:v?Number(v):0}}function T5(d){var h=null,v=!1;switch(d.charCode()){case NE:d.pos++,h={min:0,max:0};break;case jE:d.pos++,h={min:1,max:0};break;case UE:d.pos++,h={min:0,max:1};break;case BE:d.pos++,v=!0,d.charCode()===cy?h=RE(d):h={min:1,max:0};break;case cy:h=RE(d);break;default:return null}return{type:"Multiplier",comma:v,min:h.min,max:h.max,term:null}}function Am(d,h){var v=T5(d);return v!==null?(v.term=h,v):h}function L0(d){var h=d.peek();return h===""?null:{type:"Token",value:h}}function C5(d){var h;return d.eat(O0),d.eat(ly),h=py(d),d.eat(ly),d.eat(VE),Am(d,{type:"Property",name:h})}function E5(d){var h=null,v=null,y=1;return d.eat(hy),d.charCode()===PE&&(d.peek(),y=-1),y==-1&&d.charCode()===ME?d.peek():h=y*Number(dy(d)),uy(d),d.eat(M0),uy(d),d.charCode()===ME?d.peek():(y=1,d.charCode()===PE&&(d.peek(),y=-1),v=y*Number(dy(d))),d.eat(R0),h===null&&v===null?null:{type:"Range",min:h,max:v}}function A5(d){var h,v=null;return d.eat(O0),h=py(d),d.charCode()===FE&&d.nextCharCode()===x5&&(d.pos+=2,h+="()"),d.charCodeAt(d.findWsEnd(d.pos))===hy&&(uy(d),v=E5(d)),d.eat(VE),Am(d,{type:"Type",name:h,opts:v})}function k5(d){var h;return h=py(d),d.charCode()===FE?(d.pos++,{type:"Function",name:h}):Am(d,{type:"Keyword",name:h})}function I5(d,h){function v(j,Y){return{type:"Group",terms:j,combinator:Y,disallowEmpty:!1,explicit:!1}}for(h=Object.keys(h).sort(function(j,Y){return OE[j]-OE[Y]});h.length>0;){for(var y=h.shift(),T=0,n=0;T<d.length;T++){var R=d[T];R.type==="Combinator"&&(R.value===y?(n===-1&&(n=T-1),d.splice(T,1),T--):(n!==-1&&T-n>1&&(d.splice(n,T-n,v(d.slice(n,T),y)),T=n+1),n=-1))}n!==-1&&h.length&&d.splice(n,T-n,v(d.slice(n,T),y))}return y}function qE(d){for(var h=[],v={},y,T=null,n=d.pos;y=L5(d);)y.type!=="Spaces"&&(y.type==="Combinator"?((T===null||T.type==="Combinator")&&(d.pos=n,d.error("Unexpected combinator")),v[y.value]=!0):T!==null&&T.type!=="Combinator"&&(v[" "]=!0,h.push({type:"Combinator",value:" "})),h.push(y),T=y,n=d.pos);return T!==null&&T.type==="Combinator"&&(d.pos-=n,d.error("Unexpected combinator")),{type:"Group",terms:h,combinator:I5(h,v)||" ",disallowEmpty:!1,explicit:!1}}function P5(d){var h;return d.eat(hy),h=qE(d),d.eat(R0),h.explicit=!0,d.charCode()===DE&&(d.pos++,h.disallowEmpty=!0),h}function L5(d){var h=d.charCode();if(h<128&&z0[h]===1)return k5(d);switch(h){case R0:break;case hy:return Am(d,P5(d));case O0:return d.nextCharCode()===ly?C5(d):A5(d);case LE:return{type:"Combinator",value:d.substringToPos(d.nextCharCode()===LE?d.pos+2:d.pos+1)};case IE:return d.pos++,d.eat(IE),{type:"Combinator",value:"&&"};case M0:return d.pos++,{type:"Comma"};case ly:return Am(d,{type:"String",value:S5(d)});case v5:case m5:case g5:case y5:case _5:return{type:"Spaces",value:uy(d)};case b5:return h=d.nextCharCode(),h<128&&z0[h]===1?(d.pos++,{type:"AtKeyword",name:py(d)}):L0(d);case NE:case jE:case UE:case BE:case DE:break;case cy:if(h=d.nextCharCode(),h<48||h>57)return L0(d);break;default:return L0(d)}}function WE(d){var h=new f5(d),v=qE(h);return h.pos!==d.length&&h.error("Unexpected input"),v.terms.length===1&&v.terms[0].type==="Group"&&(v=v.terms[0]),v}WE("[a&&<b>#|<'c'>*||e() f{2} /,(% g#{1,2} h{2,})]!");GE.exports=WE});var D0=ot((F8,ZE)=>{var km=function(){};function HE(d){return typeof d=="function"?d:km}ZE.exports=function(d,h,v){function y(R){switch(T.call(v,R),R.type){case"Group":R.terms.forEach(y);break;case"Multiplier":y(R.term);break;case"Type":case"Property":case"Keyword":case"AtKeyword":case"Function":case"String":case"Token":case"Comma":break;default:throw new Error("Unknown type: "+R.type)}n.call(v,R)}var T=km,n=km;if(typeof h=="function"?T=h:h&&(T=HE(h.enter),n=HE(h.leave)),T===km&&n===km)throw new Error("Neither `enter` nor `leave` walker handler is set or both aren't a function");y(d,v)}});var YE=ot((N8,XE)=>{var z5=Ei(),M5=bm(),Gc=new M5,O5={decorator:function(d){var h=null,v={len:0,node:null},y=[v],T="";return{children:d.children,node:function(n){var R=h;h=n,d.node.call(this,n),h=R},chunk:function(n){T+=n,v.node!==h?y.push({len:n.length,node:h}):v.len+=n.length},result:function(){return $E(T,y)}}}};function $E(d,h){var v=[],y=0,T=0,n=h?h[T].node:null;for(z5(d,Gc);!Gc.eof;){if(h)for(;T<h.length&&y+h[T].len<=Gc.tokenStart;)y+=h[T++].len,n=h[T].node;v.push({type:Gc.tokenType,value:Gc.getTokenValue(),index:Gc.tokenIndex,balance:Gc.balance[Gc.tokenIndex],node:n}),Gc.next()}return v}XE.exports=function(d,h){return typeof d=="string"?$E(d,null):h.generate(d,O5)}});var j0=ot((j8,QE)=>{var R5=fy(),po={type:"Match"},js={type:"Mismatch"},F0={type:"DisallowEmpty"},D5=40,B5=41;function hs(d,h,v){return h===po&&v===js||d===po&&h===po&&v===po?d:(d.type==="If"&&d.else===js&&h===po&&(h=d.then,d=d.match),{type:"If",match:d,then:h,else:v})}function JE(d){return d.length>2&&d.charCodeAt(d.length-2)===D5&&d.charCodeAt(d.length-1)===B5}function KE(d){return d.type==="Keyword"||d.type==="AtKeyword"||d.type==="Function"||d.type==="Type"&&JE(d.name)}function B0(d,h,v){switch(d){case" ":for(var Y=po,y=h.length-1;y>=0;y--){var T=h[y];Y=hs(T,Y,js)}return Y;case"|":for(var Y=js,n=null,y=h.length-1;y>=0;y--){var T=h[y];if(KE(T)&&(n===null&&y>0&&KE(h[y-1])&&(n=Object.create(null),Y=hs({type:"Enum",map:n},po,Y)),n!==null)){var R=(JE(T.name)?T.name.slice(0,-1):T.name).toLowerCase();if(!(R in n)){n[R]=T;continue}}n=null,Y=hs(T,po,Y)}return Y;case"&&":if(h.length>5)return{type:"MatchOnce",terms:h,all:!0};for(var Y=js,y=h.length-1;y>=0;y--){var T=h[y],j;h.length>1?j=B0(d,h.filter(function(be){return be!==T}),!1):j=po,Y=hs(T,j,Y)}return Y;case"||":if(h.length>5)return{type:"MatchOnce",terms:h,all:!1};for(var Y=v?po:js,y=h.length-1;y>=0;y--){var T=h[y],j;h.length>1?j=B0(d,h.filter(function(oe){return oe!==T}),!0):j=po,Y=hs(T,j,Y)}return Y}}function F5(d){var h=po,v=N0(d.term);if(d.max===0)v=hs(v,F0,js),h=hs(v,null,js),h.then=hs(po,po,h),d.comma&&(h.then.else=hs({type:"Comma",syntax:d},h,js));else for(var y=d.min||1;y<=d.max;y++)d.comma&&h!==po&&(h=hs({type:"Comma",syntax:d},h,js)),h=hs(v,hs(po,po,h),js);if(d.min===0)h=hs(po,po,h);else for(var y=0;y<d.min-1;y++)d.comma&&h!==po&&(h=hs({type:"Comma",syntax:d},h,js)),h=hs(v,h,js);return h}function N0(d){if(typeof d=="function")return{type:"Generic",fn:d};switch(d.type){case"Group":var h=B0(d.combinator,d.terms.map(N0),!1);return d.disallowEmpty&&(h=hs(h,F0,js)),h;case"Multiplier":return F5(d);case"Type":case"Property":return{type:d.type,name:d.name,syntax:d};case"Keyword":return{type:d.type,name:d.name.toLowerCase(),syntax:d};case"AtKeyword":return{type:d.type,name:"@"+d.name.toLowerCase(),syntax:d};case"Function":return{type:d.type,name:d.name.toLowerCase()+"(",syntax:d};case"String":return d.value.length===3?{type:"Token",value:d.value.charAt(1),syntax:d}:{type:d.type,value:d.value.substr(1,d.value.length-2).replace(/\\'/g,"'"),syntax:d};case"Token":return{type:d.type,value:d.value,syntax:d};case"Comma":return{type:d.type,syntax:d};default:throw new Error("Unknown node type:",d.type)}}QE.exports={MATCH:po,MISMATCH:js,DISALLOW_EMPTY:F0,buildMatchGraph:function(d,h){return typeof d=="string"&&(d=R5(d)),{type:"MatchGraph",match:N0(d),syntax:h||null,source:d}}}});var uA=ot((V8,cA)=>{var eA=Object.prototype.hasOwnProperty,U0=j0(),wl=U0.MATCH,ta=U0.MISMATCH,N5=U0.DISALLOW_EMPTY,ia=ym().TYPE,oA=0,j5=1,my=2,q0=3,tA="Match",V5="Mismatch",U5="Maximum iteration number exceeded (please fill an issue on https://github.com/csstree/csstree/issues)",iA=15e3,sA=0;function aA(d){for(var h=null,v=null,y=d;y!==null;)v=y.prev,y.prev=h,h=y,y=v;return h}function V0(d,h){if(d.length!==h.length)return!1;for(var v=0;v<d.length;v++){var y=d.charCodeAt(v),T=h.charCodeAt(v);if(y>=65&&y<=90&&(y=y|32),y!==T)return!1}return!0}function q5(d){return d.type!==ia.Delim?!1:d.value!=="?"}function rA(d){return d===null?!0:d.type===ia.Comma||d.type===ia.Function||d.type===ia.LeftParenthesis||d.type===ia.LeftSquareBracket||d.type===ia.LeftCurlyBracket||q5(d)}function nA(d){return d===null?!0:d.type===ia.RightParenthesis||d.type===ia.RightSquareBracket||d.type===ia.RightCurlyBracket||d.type===ia.Delim}function lA(d,h,v){function y(){do St++,qe=St<d.length?d[St]:null;while(qe!==null&&(qe.type===ia.WhiteSpace||qe.type===ia.Comment))}function T(Ai){var oi=St+Ai;return oi<d.length?d[oi]:null}function n(Ai,oi){return{nextState:Ai,matchStack:pi,syntaxStack:be,thenStack:oe,tokenIndex:St,prev:oi}}function R(Ai){oe={nextState:Ai,matchStack:pi,syntaxStack:be,prev:oe}}function j(Ai){Se=n(Ai,Se)}function Y(){pi={type:j5,syntax:h.syntax,token:qe,prev:pi},y(),Re=null,St>ai&&(ai=St)}function re(){be={syntax:h.syntax,opts:h.syntax.opts||be!==null&&be.opts||null,prev:be},pi={type:my,syntax:h.syntax,token:pi.token,prev:pi}}function me(){pi.type===my?pi=pi.prev:pi={type:q0,syntax:be.syntax,token:pi.token,prev:pi},be=be.prev}var be=null,oe=null,Se=null,Re=null,tt=0,yt=null,qe=null,St=-1,ai=0,pi={type:oA,syntax:null,token:null,prev:null};for(y();yt===null&&++tt<iA;)switch(h.type){case"Match":if(oe===null){if(qe!==null&&(St!==d.length-1||qe.value!=="\\0"&&qe.value!=="\\9")){h=ta;break}yt=tA;break}if(h=oe.nextState,h===N5)if(oe.matchStack===pi){h=ta;break}else h=wl;for(;oe.syntaxStack!==be;)me();oe=oe.prev;break;case"Mismatch":if(Re!==null&&Re!==!1)(Se===null||St>Se.tokenIndex)&&(Se=Re,Re=!1);else if(Se===null){yt=V5;break}h=Se.nextState,oe=Se.thenStack,be=Se.syntaxStack,pi=Se.matchStack,St=Se.tokenIndex,qe=St<d.length?d[St]:null,Se=Se.prev;break;case"MatchGraph":h=h.match;break;case"If":h.else!==ta&&j(h.else),h.then!==wl&&R(h.then),h=h.match;break;case"MatchOnce":h={type:"MatchOnceBuffer",syntax:h,index:0,mask:0};break;case"MatchOnceBuffer":var Cr=h.syntax.terms;if(h.index===Cr.length){if(h.mask===0||h.syntax.all){h=ta;break}h=wl;break}if(h.mask===(1<<Cr.length)-1){h=wl;break}for(;h.index<Cr.length;h.index++){var lr=1<<h.index;if((h.mask&lr)===0){j(h),R({type:"AddMatchOnce",syntax:h.syntax,mask:h.mask|lr}),h=Cr[h.index++];break}}break;case"AddMatchOnce":h={type:"MatchOnceBuffer",syntax:h.syntax,index:0,mask:h.mask};break;case"Enum":if(qe!==null){var Di=qe.value.toLowerCase();if(Di.indexOf("\\")!==-1&&(Di=Di.replace(/\\[09].*$/,"")),eA.call(h.map,Di)){h=h.map[Di];break}}h=ta;break;case"Generic":var bt=be!==null?be.opts:null,Wt=St+Math.floor(h.fn(qe,T,bt));if(!isNaN(Wt)&&Wt>St){for(;St<Wt;)Y();h=wl}else h=ta;break;case"Type":case"Property":var li=h.type==="Type"?"types":"properties",Hi=eA.call(v,li)?v[li][h.name]:null;if(!Hi||!Hi.match)throw new Error("Bad syntax reference: "+(h.type==="Type"?"<"+h.name+">":"<'"+h.name+"'>"));if(Re!==!1&&qe!==null&&h.type==="Type"){var hi=h.name==="custom-ident"&&qe.type===ia.Ident||h.name==="length"&&qe.value==="0";if(hi){Re===null&&(Re=n(h,Se)),h=ta;break}}re(),h=Hi.match;break;case"Keyword":var Di=h.name;if(qe!==null){var kr=qe.value;if(kr.indexOf("\\")!==-1&&(kr=kr.replace(/\\[09].*$/,"")),V0(kr,Di)){Y(),h=wl;break}}h=ta;break;case"AtKeyword":case"Function":if(qe!==null&&V0(qe.value,h.name)){Y(),h=wl;break}h=ta;break;case"Token":if(qe!==null&&qe.value===h.value){Y(),h=wl;break}h=ta;break;case"Comma":qe!==null&&qe.type===ia.Comma?rA(pi.token)?h=ta:(Y(),h=nA(qe)?ta:wl):h=rA(pi.token)||nA(qe)?wl:ta;break;case"String":for(var Si="",Wt=St;Wt<d.length&&Si.length<h.value.length;Wt++)Si+=d[Wt].value;if(V0(Si,h.value)){for(;St<Wt;)Y();h=wl}else h=ta;break;default:throw new Error("Unknown node type: "+h.type)}switch(sA+=tt,yt){case null:console.warn("[csstree-match] BREAK after "+iA+" iterations"),yt=U5,pi=null;break;case tA:for(;be!==null;)me();break;default:pi=null}return{tokens:d,reason:yt,iterations:tt,match:pi,longestMatch:ai}}function W5(d,h,v){var y=lA(d,h,v||{});if(y.match!==null){var T=aA(y.match).prev;for(y.match=[];T!==null;){switch(T.type){case oA:break;case my:case q0:y.match.push({type:T.type,syntax:T.syntax});break;default:y.match.push({token:T.token.value,node:T.token.node});break}T=T.prev}}return y}function G5(d,h,v){var y=lA(d,h,v||{});if(y.match===null)return y;var T=y.match,n=y.match={syntax:h.syntax||null,match:[]},R=[n];for(T=aA(T).prev;T!==null;){switch(T.type){case my:n.match.push(n={syntax:T.syntax,match:[]}),R.push(n);break;case q0:R.pop(),n=R[R.length-1];break;default:n.match.push({syntax:T.syntax||null,token:T.token.value,node:T.token.node})}T=T.prev}return y}cA.exports={matchAsList:W5,matchAsTree:G5,getTotalIterationCount:function(){return sA}}});var pA=ot((U8,hA)=>{function dA(d){function h(T){return T===null?!1:T.type==="Type"||T.type==="Property"||T.type==="Keyword"}function v(T){if(Array.isArray(T.match)){for(var n=0;n<T.match.length;n++)if(v(T.match[n]))return h(T.syntax)&&y.unshift(T.syntax),!0}else if(T.node===d)return y=h(T.syntax)?[T.syntax]:[],!0;return!1}var y=null;return this.matched!==null&&v(this.matched),y}function W0(d,h,v){var y=dA.call(d,h);return y===null?!1:y.some(v)}function H5(d,h){return W0(this,d,function(v){return v.type==="Type"&&v.name===h})}function Z5(d,h){return W0(this,d,function(v){return v.type==="Property"&&v.name===h})}function $5(d){return W0(this,d,function(h){return h.type==="Keyword"})}hA.exports={getTrace:dA,isType:H5,isProperty:Z5,isKeyword:$5}});var _A=ot((q8,gA)=>{var X5=zd();function fA(d){return"node"in d?d.node:fA(d.match[0])}function mA(d){return"node"in d?d.node:mA(d.match[d.match.length-1])}function Y5(d,h,v,y,T){function n(j){if(j.syntax!==null&&j.syntax.type===y&&j.syntax.name===T){var Y=fA(j),re=mA(j);d.syntax.walk(h,function(me,be,oe){if(me===Y){var Se=new X5;do{if(Se.appendData(be.data),be.data===re)break;be=be.next}while(be!==null);R.push({parent:oe,nodes:Se})}})}Array.isArray(j.match)&&j.match.forEach(n)}var R=[];return v.matched!==null&&n(v.matched),R}gA.exports={matchFragments:Y5}});var xA=ot((W8,vA)=>{var K5=zd(),Im=Object.prototype.hasOwnProperty;function G0(d){return typeof d=="number"&&isFinite(d)&&Math.floor(d)===d&&d>=0}function yA(d){return!!d&&G0(d.offset)&&G0(d.line)&&G0(d.column)}function J5(d,h){return function(y,T){if(!y||y.constructor!==Object)return T(y,"Type of node should be an Object");for(var n in y){var R=!0;if(Im.call(y,n)!==!1){if(n==="type")y.type!==d&&T(y,"Wrong node type `"+y.type+"`, expected `"+d+"`");else if(n==="loc"){if(y.loc===null)continue;if(y.loc&&y.loc.constructor===Object)if(typeof y.loc.source!="string")n+=".source";else if(!yA(y.loc.start))n+=".start";else if(!yA(y.loc.end))n+=".end";else continue;R=!1}else if(h.hasOwnProperty(n))for(var j=0,R=!1;!R&&j<h[n].length;j++){var Y=h[n][j];switch(Y){case String:R=typeof y[n]=="string";break;case Boolean:R=typeof y[n]=="boolean";break;case null:R=y[n]===null;break;default:typeof Y=="string"?R=y[n]&&y[n].type===Y:Array.isArray(Y)&&(R=y[n]instanceof K5)}}else T(y,"Unknown field `"+n+"` for "+d+" node type");R||T(y,"Bad value for `"+d+"."+n+"`")}}for(var n in h)Im.call(h,n)&&Im.call(y,n)===!1&&T(y,"Field `"+d+"."+n+"` is missed")}}function Q5(d,h){var v=h.structure,y={type:String,loc:!0},T={type:'"'+d+'"'};for(var n in v)if(Im.call(v,n)!==!1){for(var R=[],j=y[n]=Array.isArray(v[n])?v[n].slice():[v[n]],Y=0;Y<j.length;Y++){var re=j[Y];if(re===String||re===Boolean)R.push(re.name);else if(re===null)R.push("null");else if(typeof re=="string")R.push("<"+re+">");else if(Array.isArray(re))R.push("List");else throw new Error("Wrong value `"+re+"` in `"+d+"."+n+"` structure definition")}T[n]=R.join(" | ")}return{docs:T,check:J5(d,y)}}vA.exports={getStructureFromConfig:function(d){var h={};if(d.node){for(var v in d.node)if(Im.call(d.node,v)){var y=d.node[v];if(y.structure)h[v]=Q5(v,y);else throw new Error("Missed `structure` field in `"+v+"` node type definition")}}return h}}});var EA=ot((G8,CA)=>{var Pm=p0().SyntaxReferenceError,e4=p0().SyntaxMatchError,Lm=Q_(),H0=TE(),t4=fy(),SA=X_(),i4=D0(),r4=YE(),_y=j0().buildMatchGraph,bA=uA().matchAsTree,gy=pA(),wA=_A(),n4=xA().getStructureFromConfig,o4=_y("inherit | initial | unset"),s4=_y("inherit | initial | unset | <-ms-legacy-expression>");function Z0(d,h,v){var y={};for(var T in d)d[T].syntax&&(y[T]=v?d[T].syntax:SA(d[T].syntax,{compact:h}));return y}function a4(d,h,v){let y={};for(let[T,n]of Object.entries(d))y[T]={prelude:n.prelude&&(v?n.prelude.syntax:SA(n.prelude.syntax,{compact:h})),descriptors:n.descriptors&&Z0(n.descriptors,h,v)};return y}function l4(d){for(var h=0;h<d.length;h++)if(d[h].value.toLowerCase()==="var(")return!0;return!1}function oc(d,h,v){return{matched:d,iterations:v,error:h,getTrace:gy.getTrace,isType:gy.isType,isProperty:gy.isProperty,isKeyword:gy.isKeyword}}function zm(d,h,v,y){var T=r4(v,d.syntax),n;return l4(T)?oc(null,new Error("Matching for a tree with var() is not supported")):(y&&(n=bA(T,d.valueCommonSyntax,d)),(!y||!n.match)&&(n=bA(T,h.match,d),!n.match)?oc(null,new e4(n.reason,h.syntax,v,n),n.iterations):oc(n.match,null,n.iterations))}var TA=function(d,h,v){if(this.valueCommonSyntax=o4,this.syntax=h,this.generic=!1,this.atrules={},this.properties={},this.types={},this.structure=v||n4(d),d){if(d.types)for(var y in d.types)this.addType_(y,d.types[y]);if(d.generic){this.generic=!0;for(var y in H0)this.addType_(y,H0[y])}if(d.atrules)for(var y in d.atrules)this.addAtrule_(y,d.atrules[y]);if(d.properties)for(var y in d.properties)this.addProperty_(y,d.properties[y])}};TA.prototype={structure:{},checkStructure:function(d){function h(T,n){y.push({node:T,message:n})}var v=this.structure,y=[];return this.syntax.walk(d,function(T){v.hasOwnProperty(T.type)?v[T.type].check(T,h):h(T,"Unknown node type `"+T.type+"`")}),y.length?y:!1},createDescriptor:function(d,h,v,y=null){var T={type:h,name:v},n={type:h,name:v,parent:y,syntax:null,match:null};return typeof d=="function"?n.match=_y(d,T):(typeof d=="string"?Object.defineProperty(n,"syntax",{get:function(){return Object.defineProperty(n,"syntax",{value:t4(d)}),n.syntax}}):n.syntax=d,Object.defineProperty(n,"match",{get:function(){return Object.defineProperty(n,"match",{value:_y(n.syntax,T)}),n.match}})),n},addAtrule_:function(d,h){h&&(this.atrules[d]={type:"Atrule",name:d,prelude:h.prelude?this.createDescriptor(h.prelude,"AtrulePrelude",d):null,descriptors:h.descriptors?Object.keys(h.descriptors).reduce((v,y)=>(v[y]=this.createDescriptor(h.descriptors[y],"AtruleDescriptor",y,d),v),{}):null})},addProperty_:function(d,h){h&&(this.properties[d]=this.createDescriptor(h,"Property",d))},addType_:function(d,h){h&&(this.types[d]=this.createDescriptor(h,"Type",d),h===H0["-ms-legacy-expression"]&&(this.valueCommonSyntax=s4))},checkAtruleName:function(d){if(!this.getAtrule(d))return new Pm("Unknown at-rule","@"+d)},checkAtrulePrelude:function(d,h){let v=this.checkAtruleName(d);if(v)return v;var y=this.getAtrule(d);if(!y.prelude&&h)return new SyntaxError("At-rule `@"+d+"` should not contain a prelude");if(y.prelude&&!h)return new SyntaxError("At-rule `@"+d+"` should contain a prelude")},checkAtruleDescriptorName:function(d,h){let v=this.checkAtruleName(d);if(v)return v;var y=this.getAtrule(d),T=Lm.keyword(h);if(!y.descriptors)return new SyntaxError("At-rule `@"+d+"` has no known descriptors");if(!y.descriptors[T.name]&&!y.descriptors[T.basename])return new Pm("Unknown at-rule descriptor",h)},checkPropertyName:function(d){var h=Lm.property(d);if(h.custom)return new Error("Lexer matching doesn't applicable for custom properties");if(!this.getProperty(d))return new Pm("Unknown property",d)},matchAtrulePrelude:function(d,h){var v=this.checkAtrulePrelude(d,h);return v?oc(null,v):h?zm(this,this.getAtrule(d).prelude,h,!1):oc(null,null)},matchAtruleDescriptor:function(d,h,v){var y=this.checkAtruleDescriptorName(d,h);if(y)return oc(null,y);var T=this.getAtrule(d),n=Lm.keyword(h);return zm(this,T.descriptors[n.name]||T.descriptors[n.basename],v,!1)},matchDeclaration:function(d){return d.type!=="Declaration"?oc(null,new Error("Not a Declaration node")):this.matchProperty(d.property,d.value)},matchProperty:function(d,h){var v=this.checkPropertyName(d);return v?oc(null,v):zm(this,this.getProperty(d),h,!0)},matchType:function(d,h){var v=this.getType(d);return v?zm(this,v,h,!1):oc(null,new Pm("Unknown type",d))},match:function(d,h){return typeof d!="string"&&(!d||!d.type)?oc(null,new Pm("Bad syntax")):((typeof d=="string"||!d.match)&&(d=this.createDescriptor(d,"Type","anonymous")),zm(this,d,h,!1))},findValueFragments:function(d,h,v,y){return wA.matchFragments(this,h,this.matchProperty(d,h),v,y)},findDeclarationValueFragments:function(d,h,v){return wA.matchFragments(this,d.value,this.matchDeclaration(d),h,v)},findAllFragments:function(d,h,v){var y=[];return this.syntax.walk(d,{visit:"Declaration",enter:function(T){y.push.apply(y,this.findDeclarationValueFragments(T,h,v))}.bind(this)}),y},getAtrule:function(d,h=!0){var v=Lm.keyword(d),y=v.vendor&&h?this.atrules[v.name]||this.atrules[v.basename]:this.atrules[v.name];return y||null},getAtrulePrelude:function(d,h=!0){let v=this.getAtrule(d,h);return v&&v.prelude||null},getAtruleDescriptor:function(d,h){return this.atrules.hasOwnProperty(d)&&this.atrules.declarators&&this.atrules[d].declarators[h]||null},getProperty:function(d,h=!0){var v=Lm.property(d),y=v.vendor&&h?this.properties[v.name]||this.properties[v.basename]:this.properties[v.name];return y||null},getType:function(d){return this.types.hasOwnProperty(d)?this.types[d]:null},validate:function(){function d(T,n,R,j){if(R.hasOwnProperty(n))return R[n];R[n]=!1,j.syntax!==null&&i4(j.syntax,function(Y){if(!(Y.type!=="Type"&&Y.type!=="Property")){var re=Y.type==="Type"?T.types:T.properties,me=Y.type==="Type"?h:v;(!re.hasOwnProperty(Y.name)||d(T,Y.name,me,re[Y.name]))&&(R[n]=!0)}},this)}var h={},v={};for(var y in this.types)d(this,y,h,this.types[y]);for(var y in this.properties)d(this,y,v,this.properties[y]);return h=Object.keys(h).filter(function(T){return h[T]}),v=Object.keys(v).filter(function(T){return v[T]}),h.length||v.length?{types:h,properties:v}:null},dump:function(d,h){return{generic:this.generic,types:Z0(this.types,!h,d),properties:Z0(this.properties,!h,d),atrules:a4(this.atrules,!h,d)}},toString:function(){return JSON.stringify(this.dump())}};CA.exports=TA});var kA=ot((H8,AA)=>{AA.exports={SyntaxError:P0(),parse:fy(),generate:X_(),walk:D0()}});var OA=ot((Z8,MA)=>{var IA=g0(),c4=Ei().isBOM,PA=10,u4=12,LA=13;function d4(d,h){for(var v=h.length,y=IA(d.lines,v),T=d.startLine,n=IA(d.columns,v),R=d.startColumn,j=h.length>0?c4(h.charCodeAt(0)):0,Y=j;Y<v;Y++){var re=h.charCodeAt(Y);y[Y]=T,n[Y]=R++,(re===PA||re===LA||re===u4)&&(re===LA&&Y+1<v&&h.charCodeAt(Y+1)===PA&&(Y++,y[Y]=T,n[Y]=R),T++,R=1)}y[Y]=T,n[Y]=R,d.lines=y,d.columns=n}var zA=function(){this.lines=null,this.columns=null,this.linesAndColumnsComputed=!1};zA.prototype={setSource:function(d,h,v,y){this.source=d,this.startOffset=typeof h>"u"?0:h,this.startLine=typeof v>"u"?1:v,this.startColumn=typeof y>"u"?1:y,this.linesAndColumnsComputed=!1},ensureLinesAndColumnsComputed:function(){this.linesAndColumnsComputed||(d4(this,this.source),this.linesAndColumnsComputed=!0)},getLocation:function(d,h){return this.ensureLinesAndColumnsComputed(),{source:h,offset:this.startOffset+d,line:this.lines[d],column:this.columns[d]}},getLocationRange:function(d,h,v){return this.ensureLinesAndColumnsComputed(),{source:v,start:{offset:this.startOffset+d,line:this.lines[d],column:this.columns[d]},end:{offset:this.startOffset+h,line:this.lines[h],column:this.columns[h]}}}};MA.exports=zA});var BA=ot(($8,DA)=>{var RA=Ei().TYPE,h4=RA.WhiteSpace,p4=RA.Comment;DA.exports=function(h){var v=this.createList(),y=null,T={recognizer:h,space:null,ignoreWS:!1,ignoreWSAfter:!1};for(this.scanner.skipSC();!this.scanner.eof;){switch(this.scanner.tokenType){case p4:this.scanner.next();continue;case h4:T.ignoreWS?this.scanner.next():T.space=this.WhiteSpace();continue}if(y=h.getNode.call(this,T),y===void 0)break;T.space!==null&&(v.push(T.space),T.space=null),v.push(y),T.ignoreWSAfter?(T.ignoreWSAfter=!1,T.ignoreWS=!0):T.ignoreWS=!1}return v}});var WA=ot((X8,qA)=>{var f4=OA(),m4=n0(),g4=bm(),FA=zd(),_4=Ei(),UA=ym(),{findWhiteSpaceStart:y4,cmpStr:v4}=cp(),x4=BA(),NA=function(){},ju=UA.TYPE,b4=UA.NAME,w4=ju.WhiteSpace,S4=ju.Comment,T4=ju.Ident,jA=ju.Function,C4=ju.Url,E4=ju.Hash,A4=ju.Percentage,k4=ju.Number,I4=35,VA=0;function P4(d){return function(){return this[d]()}}function L4(d){var h={context:{},scope:{},atrule:{},pseudo:{}};if(d.parseContext)for(var v in d.parseContext)switch(typeof d.parseContext[v]){case"function":h.context[v]=d.parseContext[v];break;case"string":h.context[v]=P4(d.parseContext[v]);break}if(d.scope)for(var v in d.scope)h.scope[v]=d.scope[v];if(d.atrule)for(var v in d.atrule){var y=d.atrule[v];y.parse&&(h.atrule[v]=y.parse)}if(d.pseudo)for(var v in d.pseudo){var T=d.pseudo[v];T.parse&&(h.pseudo[v]=T.parse)}if(d.node)for(var v in d.node)h[v]=d.node[v].parse;return h}qA.exports=function(h){var v={scanner:new g4,locationMap:new f4,filename:"<unknown>",needPositions:!1,onParseError:NA,onParseErrorThrow:!1,parseAtrulePrelude:!0,parseRulePrelude:!0,parseValue:!0,parseCustomProperty:!1,readSequence:x4,createList:function(){return new FA},createSingleNodeList:function(T){return new FA().appendData(T)},getFirstListNode:function(T){return T&&T.first()},getLastListNode:function(T){return T.last()},parseWithFallback:function(T,n){var R=this.scanner.tokenIndex;try{return T.call(this)}catch(Y){if(this.onParseErrorThrow)throw Y;var j=n.call(this,R);return this.onParseErrorThrow=!0,this.onParseError(Y,j),this.onParseErrorThrow=!1,j}},lookupNonWSType:function(T){do{var n=this.scanner.lookupType(T++);if(n!==w4)return n}while(n!==VA);return VA},eat:function(T){if(this.scanner.tokenType!==T){var n=this.scanner.tokenStart,R=b4[T]+" is expected";switch(T){case T4:this.scanner.tokenType===jA||this.scanner.tokenType===C4?(n=this.scanner.tokenEnd-1,R="Identifier is expected but function found"):R="Identifier is expected";break;case E4:this.scanner.isDelim(I4)&&(this.scanner.next(),n++,R="Name is expected");break;case A4:this.scanner.tokenType===k4&&(n=this.scanner.tokenEnd,R="Percent sign is expected");break;default:this.scanner.source.charCodeAt(this.scanner.tokenStart)===T&&(n=n+1)}this.error(R,n)}this.scanner.next()},consume:function(T){var n=this.scanner.getTokenValue();return this.eat(T),n},consumeFunctionName:function(){var T=this.scanner.source.substring(this.scanner.tokenStart,this.scanner.tokenEnd-1);return this.eat(jA),T},getLocation:function(T,n){return this.needPositions?this.locationMap.getLocationRange(T,n,this.filename):null},getLocationFromList:function(T){if(this.needPositions){var n=this.getFirstListNode(T),R=this.getLastListNode(T);return this.locationMap.getLocationRange(n!==null?n.loc.start.offset-this.locationMap.startOffset:this.scanner.tokenStart,R!==null?R.loc.end.offset-this.locationMap.startOffset:this.scanner.tokenStart,this.filename)}return null},error:function(T,n){var R=typeof n<"u"&&n<this.scanner.source.length?this.locationMap.getLocation(n):this.scanner.eof?this.locationMap.getLocation(y4(this.scanner.source,this.scanner.source.length-1)):this.locationMap.getLocation(this.scanner.tokenStart);throw new m4(T||"Unexpected input",this.scanner.source,R.offset,R.line,R.column)}};h=L4(h||{});for(var y in h)v[y]=h[y];return function(T,n){n=n||{};var R=n.context||"default",j=n.onComment,Y;if(_4(T,v.scanner),v.locationMap.setSource(T,n.offset,n.line,n.column),v.filename=n.filename||"<unknown>",v.needPositions=!!n.positions,v.onParseError=typeof n.onParseError=="function"?n.onParseError:NA,v.onParseErrorThrow=!1,v.parseAtrulePrelude="parseAtrulePrelude"in n?!!n.parseAtrulePrelude:!0,v.parseRulePrelude="parseRulePrelude"in n?!!n.parseRulePrelude:!0,v.parseValue="parseValue"in n?!!n.parseValue:!0,v.parseCustomProperty="parseCustomProperty"in n?!!n.parseCustomProperty:!1,!v.context.hasOwnProperty(R))throw new Error("Unknown context `"+R+"`");return typeof j=="function"&&v.scanner.forEachToken((re,me,be)=>{if(re===S4){let oe=v.getLocation(me,be),Se=v4(T,be-2,be,"*/")?T.slice(me+2,be-2):T.slice(me+2,be);j(Se,oe)}}),Y=v.context[R].call(v,n),v.scanner.eof||v.error(),Y}}});var HA=ot($0=>{var GA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");$0.encode=function(d){if(0<=d&&d<GA.length)return GA[d];throw new TypeError("Must be between 0 and 63: "+d)};$0.decode=function(d){var h=65,v=90,y=97,T=122,n=48,R=57,j=43,Y=47,re=26,me=52;return h<=d&&d<=v?d-h:y<=d&&d<=T?d-y+re:n<=d&&d<=R?d-n+me:d==j?62:d==Y?63:-1}});var KA=ot(Y0=>{var ZA=HA(),X0=5,$A=1<<X0,XA=$A-1,YA=$A;function z4(d){return d<0?(-d<<1)+1:(d<<1)+0}function M4(d){var h=(d&1)===1,v=d>>1;return h?-v:v}Y0.encode=function(h){var v="",y,T=z4(h);do y=T&XA,T>>>=X0,T>0&&(y|=YA),v+=ZA.encode(y);while(T>0);return v};Y0.decode=function(h,v,y){var T=h.length,n=0,R=0,j,Y;do{if(v>=T)throw new Error("Expected more digits in base 64 VLQ value.");if(Y=ZA.decode(h.charCodeAt(v++)),Y===-1)throw new Error("Invalid base64 digit: "+h.charAt(v-1));j=!!(Y&YA),Y&=XA,n=n+(Y<<R),R+=X0}while(j);y.value=M4(n),y.rest=v}});var yy=ot(ps=>{function O4(d,h,v){if(h in d)return d[h];if(arguments.length===3)return v;throw new Error('"'+h+'" is a required argument.')}ps.getArg=O4;var JA=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,R4=/^data:.+\,.+$/;function Mm(d){var h=d.match(JA);return h?{scheme:h[1],auth:h[2],host:h[3],port:h[4],path:h[5]}:null}ps.urlParse=Mm;function _p(d){var h="";return d.scheme&&(h+=d.scheme+":"),h+="//",d.auth&&(h+=d.auth+"@"),d.host&&(h+=d.host),d.port&&(h+=":"+d.port),d.path&&(h+=d.path),h}ps.urlGenerate=_p;function K0(d){var h=d,v=Mm(d);if(v){if(!v.path)return d;h=v.path}for(var y=ps.isAbsolute(h),T=h.split(/\/+/),n,R=0,j=T.length-1;j>=0;j--)n=T[j],n==="."?T.splice(j,1):n===".."?R++:R>0&&(n===""?(T.splice(j+1,R),R=0):(T.splice(j,2),R--));return h=T.join("/"),h===""&&(h=y?"/":"."),v?(v.path=h,_p(v)):h}ps.normalize=K0;function QA(d,h){d===""&&(d="."),h===""&&(h=".");var v=Mm(h),y=Mm(d);if(y&&(d=y.path||"/"),v&&!v.scheme)return y&&(v.scheme=y.scheme),_p(v);if(v||h.match(R4))return h;if(y&&!y.host&&!y.path)return y.host=h,_p(y);var T=h.charAt(0)==="/"?h:K0(d.replace(/\/+$/,"")+"/"+h);return y?(y.path=T,_p(y)):T}ps.join=QA;ps.isAbsolute=function(d){return d.charAt(0)==="/"||JA.test(d)};function D4(d,h){d===""&&(d="."),d=d.replace(/\/$/,"");for(var v=0;h.indexOf(d+"/")!==0;){var y=d.lastIndexOf("/");if(y<0||(d=d.slice(0,y),d.match(/^([^\/]+:\/)?\/*$/)))return h;++v}return Array(v+1).join("../")+h.substr(d.length+1)}ps.relative=D4;var ek=(function(){var d=Object.create(null);return!("__proto__"in d)})();function tk(d){return d}function B4(d){return ik(d)?"$"+d:d}ps.toSetString=ek?tk:B4;function F4(d){return ik(d)?d.slice(1):d}ps.fromSetString=ek?tk:F4;function ik(d){if(!d)return!1;var h=d.length;if(h<9||d.charCodeAt(h-1)!==95||d.charCodeAt(h-2)!==95||d.charCodeAt(h-3)!==111||d.charCodeAt(h-4)!==116||d.charCodeAt(h-5)!==111||d.charCodeAt(h-6)!==114||d.charCodeAt(h-7)!==112||d.charCodeAt(h-8)!==95||d.charCodeAt(h-9)!==95)return!1;for(var v=h-10;v>=0;v--)if(d.charCodeAt(v)!==36)return!1;return!0}function N4(d,h,v){var y=yp(d.source,h.source);return y!==0||(y=d.originalLine-h.originalLine,y!==0)||(y=d.originalColumn-h.originalColumn,y!==0||v)||(y=d.generatedColumn-h.generatedColumn,y!==0)||(y=d.generatedLine-h.generatedLine,y!==0)?y:yp(d.name,h.name)}ps.compareByOriginalPositions=N4;function j4(d,h,v){var y=d.generatedLine-h.generatedLine;return y!==0||(y=d.generatedColumn-h.generatedColumn,y!==0||v)||(y=yp(d.source,h.source),y!==0)||(y=d.originalLine-h.originalLine,y!==0)||(y=d.originalColumn-h.originalColumn,y!==0)?y:yp(d.name,h.name)}ps.compareByGeneratedPositionsDeflated=j4;function yp(d,h){return d===h?0:d===null?1:h===null?-1:d>h?1:-1}function V4(d,h){var v=d.generatedLine-h.generatedLine;return v!==0||(v=d.generatedColumn-h.generatedColumn,v!==0)||(v=yp(d.source,h.source),v!==0)||(v=d.originalLine-h.originalLine,v!==0)||(v=d.originalColumn-h.originalColumn,v!==0)?v:yp(d.name,h.name)}ps.compareByGeneratedPositionsInflated=V4;function U4(d){return JSON.parse(d.replace(/^\)]}'[^\n]*\n/,""))}ps.parseSourceMapInput=U4;function q4(d,h,v){if(h=h||"",d&&(d[d.length-1]!=="/"&&h[0]!=="/"&&(d+="/"),h=d+h),v){var y=Mm(v);if(!y)throw new Error("sourceMapURL could not be parsed");if(y.path){var T=y.path.lastIndexOf("/");T>=0&&(y.path=y.path.substring(0,T+1))}h=QA(_p(y),h)}return K0(h)}ps.computeSourceURL=q4});var nk=ot(rk=>{var J0=yy(),Q0=Object.prototype.hasOwnProperty,Od=typeof Map<"u";function Hc(){this._array=[],this._set=Od?new Map:Object.create(null)}Hc.fromArray=function(h,v){for(var y=new Hc,T=0,n=h.length;T<n;T++)y.add(h[T],v);return y};Hc.prototype.size=function(){return Od?this._set.size:Object.getOwnPropertyNames(this._set).length};Hc.prototype.add=function(h,v){var y=Od?h:J0.toSetString(h),T=Od?this.has(h):Q0.call(this._set,y),n=this._array.length;(!T||v)&&this._array.push(h),T||(Od?this._set.set(h,n):this._set[y]=n)};Hc.prototype.has=function(h){if(Od)return this._set.has(h);var v=J0.toSetString(h);return Q0.call(this._set,v)};Hc.prototype.indexOf=function(h){if(Od){var v=this._set.get(h);if(v>=0)return v}else{var y=J0.toSetString(h);if(Q0.call(this._set,y))return this._set[y]}throw new Error('"'+h+'" is not in the set.')};Hc.prototype.at=function(h){if(h>=0&&h<this._array.length)return this._array[h];throw new Error("No element indexed by "+h)};Hc.prototype.toArray=function(){return this._array.slice()};rk.ArraySet=Hc});var ak=ot(sk=>{var ok=yy();function W4(d,h){var v=d.generatedLine,y=h.generatedLine,T=d.generatedColumn,n=h.generatedColumn;return y>v||y==v&&n>=T||ok.compareByGeneratedPositionsInflated(d,h)<=0}function vy(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}vy.prototype.unsortedForEach=function(h,v){this._array.forEach(h,v)};vy.prototype.add=function(h){W4(this._last,h)?(this._last=h,this._array.push(h)):(this._sorted=!1,this._array.push(h))};vy.prototype.toArray=function(){return this._sorted||(this._array.sort(ok.compareByGeneratedPositionsInflated),this._sorted=!0),this._array};sk.MappingList=vy});var ck=ot(lk=>{var Om=KA(),Eo=yy(),xy=nk().ArraySet,G4=ak().MappingList;function Za(d){d||(d={}),this._file=Eo.getArg(d,"file",null),this._sourceRoot=Eo.getArg(d,"sourceRoot",null),this._skipValidation=Eo.getArg(d,"skipValidation",!1),this._sources=new xy,this._names=new xy,this._mappings=new G4,this._sourcesContents=null}Za.prototype._version=3;Za.fromSourceMap=function(h){var v=h.sourceRoot,y=new Za({file:h.file,sourceRoot:v});return h.eachMapping(function(T){var n={generated:{line:T.generatedLine,column:T.generatedColumn}};T.source!=null&&(n.source=T.source,v!=null&&(n.source=Eo.relative(v,n.source)),n.original={line:T.originalLine,column:T.originalColumn},T.name!=null&&(n.name=T.name)),y.addMapping(n)}),h.sources.forEach(function(T){var n=T;v!==null&&(n=Eo.relative(v,T)),y._sources.has(n)||y._sources.add(n);var R=h.sourceContentFor(T);R!=null&&y.setSourceContent(T,R)}),y};Za.prototype.addMapping=function(h){var v=Eo.getArg(h,"generated"),y=Eo.getArg(h,"original",null),T=Eo.getArg(h,"source",null),n=Eo.getArg(h,"name",null);this._skipValidation||this._validateMapping(v,y,T,n),T!=null&&(T=String(T),this._sources.has(T)||this._sources.add(T)),n!=null&&(n=String(n),this._names.has(n)||this._names.add(n)),this._mappings.add({generatedLine:v.line,generatedColumn:v.column,originalLine:y!=null&&y.line,originalColumn:y!=null&&y.column,source:T,name:n})};Za.prototype.setSourceContent=function(h,v){var y=h;this._sourceRoot!=null&&(y=Eo.relative(this._sourceRoot,y)),v!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Eo.toSetString(y)]=v):this._sourcesContents&&(delete this._sourcesContents[Eo.toSetString(y)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))};Za.prototype.applySourceMap=function(h,v,y){var T=v;if(v==null){if(h.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);T=h.file}var n=this._sourceRoot;n!=null&&(T=Eo.relative(n,T));var R=new xy,j=new xy;this._mappings.unsortedForEach(function(Y){if(Y.source===T&&Y.originalLine!=null){var re=h.originalPositionFor({line:Y.originalLine,column:Y.originalColumn});re.source!=null&&(Y.source=re.source,y!=null&&(Y.source=Eo.join(y,Y.source)),n!=null&&(Y.source=Eo.relative(n,Y.source)),Y.originalLine=re.line,Y.originalColumn=re.column,re.name!=null&&(Y.name=re.name))}var me=Y.source;me!=null&&!R.has(me)&&R.add(me);var be=Y.name;be!=null&&!j.has(be)&&j.add(be)},this),this._sources=R,this._names=j,h.sources.forEach(function(Y){var re=h.sourceContentFor(Y);re!=null&&(y!=null&&(Y=Eo.join(y,Y)),n!=null&&(Y=Eo.relative(n,Y)),this.setSourceContent(Y,re))},this)};Za.prototype._validateMapping=function(h,v,y,T){if(v&&typeof v.line!="number"&&typeof v.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(h&&"line"in h&&"column"in h&&h.line>0&&h.column>=0&&!v&&!y&&!T)){if(h&&"line"in h&&"column"in h&&v&&"line"in v&&"column"in v&&h.line>0&&h.column>=0&&v.line>0&&v.column>=0&&y)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:h,source:y,original:v,name:T}))}};Za.prototype._serializeMappings=function(){for(var h=0,v=1,y=0,T=0,n=0,R=0,j="",Y,re,me,be,oe=this._mappings.toArray(),Se=0,Re=oe.length;Se<Re;Se++){if(re=oe[Se],Y="",re.generatedLine!==v)for(h=0;re.generatedLine!==v;)Y+=";",v++;else if(Se>0){if(!Eo.compareByGeneratedPositionsInflated(re,oe[Se-1]))continue;Y+=","}Y+=Om.encode(re.generatedColumn-h),h=re.generatedColumn,re.source!=null&&(be=this._sources.indexOf(re.source),Y+=Om.encode(be-R),R=be,Y+=Om.encode(re.originalLine-1-T),T=re.originalLine-1,Y+=Om.encode(re.originalColumn-y),y=re.originalColumn,re.name!=null&&(me=this._names.indexOf(re.name),Y+=Om.encode(me-n),n=me)),j+=Y}return j};Za.prototype._generateSourcesContent=function(h,v){return h.map(function(y){if(!this._sourcesContents)return null;v!=null&&(y=Eo.relative(v,y));var T=Eo.toSetString(y);return Object.prototype.hasOwnProperty.call(this._sourcesContents,T)?this._sourcesContents[T]:null},this)};Za.prototype.toJSON=function(){var h={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(h.file=this._file),this._sourceRoot!=null&&(h.sourceRoot=this._sourceRoot),this._sourcesContents&&(h.sourcesContent=this._generateSourcesContent(h.sources,h.sourceRoot)),h};Za.prototype.toString=function(){return JSON.stringify(this.toJSON())};lk.SourceMapGenerator=Za});var hk=ot((iW,dk)=>{var H4=ck().SourceMapGenerator,uk={Atrule:!0,Selector:!0,Declaration:!0};dk.exports=function(h){var v=new H4,y=1,T=0,n={line:1,column:0},R={line:0,column:0},j=!1,Y={line:1,column:0},re={generated:Y},me=h.node;h.node=function(Se){if(Se.loc&&Se.loc.start&&uk.hasOwnProperty(Se.type)){var Re=Se.loc.start.line,tt=Se.loc.start.column-1;(R.line!==Re||R.column!==tt)&&(R.line=Re,R.column=tt,n.line=y,n.column=T,j&&(j=!1,(n.line!==Y.line||n.column!==Y.column)&&v.addMapping(re)),j=!0,v.addMapping({source:Se.loc.source,original:R,generated:n}))}me.call(this,Se),j&&uk.hasOwnProperty(Se.type)&&(Y.line=y,Y.column=T)};var be=h.chunk;h.chunk=function(Se){for(var Re=0;Re<Se.length;Re++)Se.charCodeAt(Re)===10?(y++,T=0):T++;be(Se)};var oe=h.result;return h.result=function(){return j&&v.addMapping(re),{css:oe(),map:v}},h}});var fk=ot((rW,pk)=>{var Z4=hk(),$4=Object.prototype.hasOwnProperty;function X4(d,h){var v=d.children,y=null;typeof h!="function"?v.forEach(this.node,this):v.forEach(function(T){y!==null&&h.call(this,y),this.node(T),y=T},this)}pk.exports=function(h){function v(n){if($4.call(y,n.type))y[n.type].call(this,n);else throw new Error("Unknown node type: "+n.type)}var y={};if(h.node)for(var T in h.node)y[T]=h.node[T].generate;return function(n,R){var j="",Y={children:X4,node:v,chunk:function(re){j+=re},result:function(){return j}};return R&&(typeof R.decorator=="function"&&(Y=R.decorator(Y)),R.sourceMap&&(Y=Z4(Y))),Y.node(n),Y.result()}}});var gk=ot((nW,mk)=>{var eb=zd();mk.exports=function(h){return{fromPlainObject:function(v){return h(v,{enter:function(y){y.children&&!(y.children instanceof eb)&&(y.children=new eb().fromArray(y.children))}}),v},toPlainObject:function(v){return h(v,{leave:function(y){y.children&&y.children instanceof eb&&(y.children=y.children.toArray())}}),v}}}});var wk=ot((oW,bk)=>{var tb=Object.prototype.hasOwnProperty,Rm=function(){};function _k(d){return typeof d=="function"?d:Rm}function yk(d,h){return function(v,y,T){v.type===h&&d.call(this,v,y,T)}}function Y4(d,h){var v=h.structure,y=[];for(var T in v)if(tb.call(v,T)!==!1){var n=v[T],R={name:T,type:!1,nullable:!1};Array.isArray(v[T])||(n=[v[T]]);for(var j=0;j<n.length;j++){var Y=n[j];Y===null?R.nullable=!0:typeof Y=="string"?R.type="node":Array.isArray(Y)&&(R.type="list")}R.type&&y.push(R)}return y.length?{context:h.walkContext,fields:y}:null}function K4(d){var h={};for(var v in d.node)if(tb.call(d.node,v)){var y=d.node[v];if(!y.structure)throw new Error("Missed `structure` field in `"+v+"` node type definition");h[v]=Y4(v,y)}return h}function vk(d,h){var v=d.fields.slice(),y=d.context,T=typeof y=="string";return h&&v.reverse(),function(n,R,j,Y){var re;T&&(re=R[y],R[y]=n);for(var me=0;me<v.length;me++){var be=v[me],oe=n[be.name];if(!be.nullable||oe){if(be.type==="list"){var Se=h?oe.reduceRight(Y,!1):oe.reduce(Y,!1);if(Se)return!0}else if(j(oe))return!0}}T&&(R[y]=re)}}function xk(d){return{Atrule:{StyleSheet:d.StyleSheet,Atrule:d.Atrule,Rule:d.Rule,Block:d.Block},Rule:{StyleSheet:d.StyleSheet,Atrule:d.Atrule,Rule:d.Rule,Block:d.Block},Declaration:{StyleSheet:d.StyleSheet,Atrule:d.Atrule,Rule:d.Rule,Block:d.Block,DeclarationList:d.DeclarationList}}}bk.exports=function(h){var v=K4(h),y={},T={},n=Symbol("break-walk"),R=Symbol("skip-node");for(var j in v)tb.call(v,j)&&v[j]!==null&&(y[j]=vk(v[j],!1),T[j]=vk(v[j],!0));var Y=xk(y),re=xk(T),me=function(be,oe){function Se(ai,pi,Cr){var lr=tt.call(St,ai,pi,Cr);if(lr===n){debugger;return!0}return lr===R?!1:!!(qe.hasOwnProperty(ai.type)&&qe[ai.type](ai,St,Se,Re)||yt.call(St,ai,pi,Cr)===n)}var Re=(ai,pi,Cr,lr)=>ai||Se(pi,Cr,lr),tt=Rm,yt=Rm,qe=y,St={break:n,skip:R,root:be,stylesheet:null,atrule:null,atrulePrelude:null,rule:null,selector:null,block:null,declaration:null,function:null};if(typeof oe=="function")tt=oe;else if(oe&&(tt=_k(oe.enter),yt=_k(oe.leave),oe.reverse&&(qe=T),oe.visit)){if(Y.hasOwnProperty(oe.visit))qe=oe.reverse?re[oe.visit]:Y[oe.visit];else if(!v.hasOwnProperty(oe.visit))throw new Error("Bad value `"+oe.visit+"` for `visit` option (should be: "+Object.keys(v).join(", ")+")");tt=yk(tt,oe.visit),yt=yk(yt,oe.visit)}if(tt===Rm&&yt===Rm)throw new Error("Neither `enter` nor `leave` walker handler is set or both aren't a function");Se(be)};return me.break=n,me.skip=R,me.find=function(be,oe){var Se=null;return me(be,function(Re,tt,yt){if(oe.call(this,Re,tt,yt))return Se=Re,n}),Se},me.findLast=function(be,oe){var Se=null;return me(be,{reverse:!0,enter:function(Re,tt,yt){if(oe.call(this,Re,tt,yt))return Se=Re,n}}),Se},me.findAll=function(be,oe){var Se=[];return me(be,function(Re,tt,yt){oe.call(this,Re,tt,yt)&&Se.push(Re)}),Se},me}});var Tk=ot((sW,Sk)=>{var J4=zd();Sk.exports=function d(h){var v={};for(var y in h){var T=h[y];T&&(Array.isArray(T)||T instanceof J4?T=T.map(d):T.constructor===Object&&(T=d(T))),v[y]=T}return v}});var Ik=ot((aW,kk)=>{var vp=Object.prototype.hasOwnProperty,Q4={generic:!0,types:rb,atrules:{prelude:Ek,descriptors:Ek},properties:rb,parseContext:eN,scope:Ak,atrule:["parse"],pseudo:["parse"],node:["name","structure","parse","generate","walkContext"]};function by(d){return d&&d.constructor===Object}function ib(d){return by(d)?Object.assign({},d):d}function eN(d,h){return Object.assign(d,h)}function Ak(d,h){for(let v in h)vp.call(h,v)&&(by(d[v])?Ak(d[v],ib(h[v])):d[v]=ib(h[v]));return d}function Ck(d,h){return typeof h=="string"&&/^\s*\|/.test(h)?typeof d=="string"?d+h:h.replace(/^\s*\|\s*/,""):h||null}function rb(d,h){if(typeof h=="string")return Ck(d,h);let v=Object.assign({},d);for(let y in h)vp.call(h,y)&&(v[y]=Ck(vp.call(d,y)?d[y]:void 0,h[y]));return v}function Ek(d,h){let v=rb(d,h);return!by(v)||Object.keys(v).length?v:null}function Dm(d,h,v){for(let y in v)if(vp.call(v,y)!==!1){if(v[y]===!0)y in h&&vp.call(h,y)&&(d[y]=ib(h[y]));else if(v[y]){if(typeof v[y]=="function"){let T=v[y];d[y]=T({},d[y]),d[y]=T(d[y]||{},h[y])}else if(by(v[y])){let T={};for(let n in d[y])T[n]=Dm({},d[y][n],v[y]);for(let n in h[y])T[n]=Dm(T[n]||{},h[y][n],v[y]);d[y]=T}else if(Array.isArray(v[y])){let T={},n=v[y].reduce(function(R,j){return R[j]=!0,R},{});for(let[R,j]of Object.entries(d[y]||{}))T[R]={},j&&Dm(T[R],j,n);for(let R in h[y])vp.call(h[y],R)&&(T[R]||(T[R]={}),h[y]&&h[y][R]&&Dm(T[R],h[y][R],n));d[y]=T}}}return d}kk.exports=(d,h)=>Dm(d,h,Q4)});var Lk=ot(Pk=>{var tN=zd(),iN=n0(),rN=bm(),nb=EA(),nN=kA(),oN=Ei(),sN=WA(),aN=fk(),lN=gk(),cN=wk(),uN=Tk(),wy=Q_(),Sy=Ik();function ob(d){var h=sN(d),v=cN(d),y=aN(d),T=lN(v),n={List:tN,SyntaxError:iN,TokenStream:rN,Lexer:nb,vendorPrefix:wy.vendorPrefix,keyword:wy.keyword,property:wy.property,isCustomProperty:wy.isCustomProperty,definitionSyntax:nN,lexer:null,createLexer:function(R){return new nb(R,n,n.lexer.structure)},tokenize:oN,parse:h,walk:v,generate:y,find:v.find,findLast:v.findLast,findAll:v.findAll,clone:uN,fromPlainObject:T.fromPlainObject,toPlainObject:T.toPlainObject,createSyntax:function(R){return ob(Sy({},R))},fork:function(R){var j=Sy({},d);return ob(typeof R=="function"?R(j,Object.assign):Sy(j,R))}};return n.lexer=new nb({generic:!0,types:d.types,atrules:d.atrules,properties:d.properties,node:d.node},n),n}Pk.create=function(d){return ob(Sy({},d))}});var zk=ot((cW,dN)=>{dN.exports={"@charset":{syntax:'@charset "<charset>";',groups:["CSS Charsets"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@charset"},"@counter-style":{syntax:`@counter-style <counter-style-name> {
  [ system: <counter-system>; ] ||
  [ symbols: <counter-symbols>; ] ||
  [ additive-symbols: <additive-symbols>; ] ||
  [ negative: <negative-symbol>; ] ||
  [ prefix: <prefix>; ] ||
  [ suffix: <suffix>; ] ||
  [ range: <range>; ] ||
  [ pad: <padding>; ] ||
  [ speak-as: <speak-as>; ] ||
  [ fallback: <counter-style-name>; ]
}`,interfaces:["CSSCounterStyleRule"],groups:["CSS Counter Styles"],descriptors:{"additive-symbols":{syntax:"[ <integer> && <symbol> ]#",media:"all",initial:"n/a (required)",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},fallback:{syntax:"<counter-style-name>",media:"all",initial:"decimal",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},negative:{syntax:"<symbol> <symbol>?",media:"all",initial:'"-" hyphen-minus',percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},pad:{syntax:"<integer> && <symbol>",media:"all",initial:'0 ""',percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},prefix:{syntax:"<symbol>",media:"all",initial:'""',percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},range:{syntax:"[ [ <integer> | infinite ]{2} ]# | auto",media:"all",initial:"auto",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},"speak-as":{syntax:"auto | bullets | numbers | words | spell-out | <counter-style-name>",media:"all",initial:"auto",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},suffix:{syntax:"<symbol>",media:"all",initial:'". "',percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},symbols:{syntax:"<symbol>+",media:"all",initial:"n/a (required)",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},system:{syntax:"cyclic | numeric | alphabetic | symbolic | additive | [ fixed <integer>? ] | [ extends <counter-style-name> ]",media:"all",initial:"symbolic",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"}},status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@counter-style"},"@document":{syntax:`@document [ <url> | url-prefix(<string>) | domain(<string>) | media-document(<string>) | regexp(<string>) ]# {
  <group-rule-body>
}`,interfaces:["CSSGroupingRule","CSSConditionRule"],groups:["CSS Conditional Rules"],status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@document"},"@font-face":{syntax:`@font-face {
  [ font-family: <family-name>; ] ||
  [ src: <src>; ] ||
  [ unicode-range: <unicode-range>; ] ||
  [ font-variant: <font-variant>; ] ||
  [ font-feature-settings: <font-feature-settings>; ] ||
  [ font-variation-settings: <font-variation-settings>; ] ||
  [ font-stretch: <font-stretch>; ] ||
  [ font-weight: <font-weight>; ] ||
  [ font-style: <font-style>; ]
}`,interfaces:["CSSFontFaceRule"],groups:["CSS Fonts"],descriptors:{"font-display":{syntax:"[ auto | block | swap | fallback | optional ]",media:"visual",percentages:"no",initial:"auto",computed:"asSpecified",order:"uniqueOrder",status:"experimental"},"font-family":{syntax:"<family-name>",media:"all",initial:"n/a (required)",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"font-feature-settings":{syntax:"normal | <feature-tag-value>#",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},"font-variation-settings":{syntax:"normal | [ <string> <number> ]#",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},"font-stretch":{syntax:"<font-stretch-absolute>{1,2}",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"font-style":{syntax:"normal | italic | oblique <angle>{0,2}",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"font-weight":{syntax:"<font-weight-absolute>{1,2}",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"font-variant":{syntax:"normal | none | [ <common-lig-values> || <discretionary-lig-values> || <historical-lig-values> || <contextual-alt-values> || stylistic(<feature-value-name>) || historical-forms || styleset(<feature-value-name>#) || character-variant(<feature-value-name>#) || swash(<feature-value-name>) || ornaments(<feature-value-name>) || annotation(<feature-value-name>) || [ small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps ] || <numeric-figure-values> || <numeric-spacing-values> || <numeric-fraction-values> || ordinal || slashed-zero || <east-asian-variant-values> || <east-asian-width-values> || ruby ]",media:"all",initial:"normal",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},src:{syntax:"[ <url> [ format( <string># ) ]? | local( <family-name> ) ]#",media:"all",initial:"n/a (required)",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},"unicode-range":{syntax:"<unicode-range>#",media:"all",initial:"U+0-10FFFF",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"}},status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@font-face"},"@font-feature-values":{syntax:`@font-feature-values <family-name># {
  <feature-value-block-list>
}`,interfaces:["CSSFontFeatureValuesRule"],groups:["CSS Fonts"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@font-feature-values"},"@import":{syntax:"@import [ <string> | <url> ] [ <media-query-list> ]?;",groups:["Media Queries"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@import"},"@keyframes":{syntax:`@keyframes <keyframes-name> {
  <keyframe-block-list>
}`,interfaces:["CSSKeyframeRule","CSSKeyframesRule"],groups:["CSS Animations"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@keyframes"},"@media":{syntax:`@media <media-query-list> {
  <group-rule-body>
}`,interfaces:["CSSGroupingRule","CSSConditionRule","CSSMediaRule","CSSCustomMediaRule"],groups:["CSS Conditional Rules","Media Queries"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@media"},"@namespace":{syntax:"@namespace <namespace-prefix>? [ <string> | <url> ];",groups:["CSS Namespaces"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@namespace"},"@page":{syntax:`@page <page-selector-list> {
  <page-body>
}`,interfaces:["CSSPageRule"],groups:["CSS Pages"],descriptors:{bleed:{syntax:"auto | <length>",media:["visual","paged"],initial:"auto",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},marks:{syntax:"none | [ crop || cross ]",media:["visual","paged"],initial:"none",percentages:"no",computed:"asSpecified",order:"orderOfAppearance",status:"standard"},size:{syntax:"<length>{1,2} | auto | [ <page-size> || [ portrait | landscape ] ]",media:["visual","paged"],initial:"auto",percentages:"no",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"orderOfAppearance",status:"standard"}},status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@page"},"@property":{syntax:`@property <custom-property-name> {
  <declaration-list>
}`,interfaces:["CSS","CSSPropertyRule"],groups:["CSS Houdini"],descriptors:{syntax:{syntax:"<string>",media:"all",percentages:"no",initial:"n/a (required)",computed:"asSpecified",order:"uniqueOrder",status:"experimental"},inherits:{syntax:"true | false",media:"all",percentages:"no",initial:"auto",computed:"asSpecified",order:"uniqueOrder",status:"experimental"},"initial-value":{syntax:"<string>",media:"all",initial:"n/a (required)",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"experimental"}},status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@property"},"@supports":{syntax:`@supports <supports-condition> {
  <group-rule-body>
}`,interfaces:["CSSGroupingRule","CSSConditionRule","CSSSupportsRule"],groups:["CSS Conditional Rules"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@supports"},"@viewport":{syntax:`@viewport {
  <group-rule-body>
}`,interfaces:["CSSViewportRule"],groups:["CSS Device Adaptation"],descriptors:{height:{syntax:"<viewport-length>{1,2}",media:["visual","continuous"],initial:["min-height","max-height"],percentages:["min-height","max-height"],computed:["min-height","max-height"],order:"orderOfAppearance",status:"standard"},"max-height":{syntax:"<viewport-length>",media:["visual","continuous"],initial:"auto",percentages:"referToHeightOfInitialViewport",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard"},"max-width":{syntax:"<viewport-length>",media:["visual","continuous"],initial:"auto",percentages:"referToWidthOfInitialViewport",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard"},"max-zoom":{syntax:"auto | <number> | <percentage>",media:["visual","continuous"],initial:"auto",percentages:"the zoom factor itself",computed:"autoNonNegativeOrPercentage",order:"uniqueOrder",status:"standard"},"min-height":{syntax:"<viewport-length>",media:["visual","continuous"],initial:"auto",percentages:"referToHeightOfInitialViewport",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard"},"min-width":{syntax:"<viewport-length>",media:["visual","continuous"],initial:"auto",percentages:"referToWidthOfInitialViewport",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard"},"min-zoom":{syntax:"auto | <number> | <percentage>",media:["visual","continuous"],initial:"auto",percentages:"the zoom factor itself",computed:"autoNonNegativeOrPercentage",order:"uniqueOrder",status:"standard"},orientation:{syntax:"auto | portrait | landscape",media:["visual","continuous"],initial:"auto",percentages:"referToSizeOfBoundingBox",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"user-zoom":{syntax:"zoom | fixed",media:["visual","continuous"],initial:"zoom",percentages:"referToSizeOfBoundingBox",computed:"asSpecified",order:"uniqueOrder",status:"standard"},"viewport-fit":{syntax:"auto | contain | cover",media:["visual","continuous"],initial:"auto",percentages:"no",computed:"asSpecified",order:"uniqueOrder",status:"standard"},width:{syntax:"<viewport-length>{1,2}",media:["visual","continuous"],initial:["min-width","max-width"],percentages:["min-width","max-width"],computed:["min-width","max-width"],order:"orderOfAppearance",status:"standard"},zoom:{syntax:"auto | <number> | <percentage>",media:["visual","continuous"],initial:"auto",percentages:"the zoom factor itself",computed:"autoNonNegativeOrPercentage",order:"uniqueOrder",status:"standard"}},status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/@viewport"}}});var Mk=ot((uW,hN)=>{hN.exports={"--*":{syntax:"<declaration-value>",media:"all",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Variables"],initial:"seeProse",appliesto:"allElements",computed:"asSpecifiedWithVarsSubstituted",order:"perGrammar",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/--*"},"-ms-accelerator":{syntax:"false | true",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"false",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-accelerator"},"-ms-block-progression":{syntax:"tb | rl | bt | lr",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"tb",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-block-progression"},"-ms-content-zoom-chaining":{syntax:"none | chained",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-chaining"},"-ms-content-zooming":{syntax:"none | zoom",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"zoomForTheTopLevelNoneForTheRest",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zooming"},"-ms-content-zoom-limit":{syntax:"<'-ms-content-zoom-limit-min'> <'-ms-content-zoom-limit-max'>",media:"interactive",inherited:!1,animationType:"discrete",percentages:["-ms-content-zoom-limit-max","-ms-content-zoom-limit-min"],groups:["Microsoft Extensions"],initial:["-ms-content-zoom-limit-max","-ms-content-zoom-limit-min"],appliesto:"nonReplacedBlockAndInlineBlockElements",computed:["-ms-content-zoom-limit-max","-ms-content-zoom-limit-min"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-limit"},"-ms-content-zoom-limit-max":{syntax:"<percentage>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"maxZoomFactor",groups:["Microsoft Extensions"],initial:"400%",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-limit-max"},"-ms-content-zoom-limit-min":{syntax:"<percentage>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"minZoomFactor",groups:["Microsoft Extensions"],initial:"100%",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-limit-min"},"-ms-content-zoom-snap":{syntax:"<'-ms-content-zoom-snap-type'> || <'-ms-content-zoom-snap-points'>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:["-ms-content-zoom-snap-type","-ms-content-zoom-snap-points"],appliesto:"nonReplacedBlockAndInlineBlockElements",computed:["-ms-content-zoom-snap-type","-ms-content-zoom-snap-points"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-snap"},"-ms-content-zoom-snap-points":{syntax:"snapInterval( <percentage>, <percentage> ) | snapList( <percentage># )",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"snapInterval(0%, 100%)",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-snap-points"},"-ms-content-zoom-snap-type":{syntax:"none | proximity | mandatory",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-content-zoom-snap-type"},"-ms-filter":{syntax:"<string>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:'""',appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-filter"},"-ms-flow-from":{syntax:"[ none | <custom-ident> ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"nonReplacedElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-flow-from"},"-ms-flow-into":{syntax:"[ none | <custom-ident> ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"iframeElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-flow-into"},"-ms-grid-columns":{syntax:"none | <track-list> | <auto-track-list>",media:"visual",inherited:!1,animationType:"simpleListOfLpcDifferenceLpc",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"none",appliesto:"gridContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-grid-columns"},"-ms-grid-rows":{syntax:"none | <track-list> | <auto-track-list>",media:"visual",inherited:!1,animationType:"simpleListOfLpcDifferenceLpc",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"none",appliesto:"gridContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-grid-rows"},"-ms-high-contrast-adjust":{syntax:"auto | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-high-contrast-adjust"},"-ms-hyphenate-limit-chars":{syntax:"auto | <integer>{1,3}",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-hyphenate-limit-chars"},"-ms-hyphenate-limit-lines":{syntax:"no-limit | <integer>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"no-limit",appliesto:"blockContainerElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-hyphenate-limit-lines"},"-ms-hyphenate-limit-zone":{syntax:"<percentage> | <length>",media:"visual",inherited:!0,animationType:"discrete",percentages:"referToLineBoxWidth",groups:["Microsoft Extensions"],initial:"0",appliesto:"blockContainerElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-hyphenate-limit-zone"},"-ms-ime-align":{syntax:"auto | after",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-ime-align"},"-ms-overflow-style":{syntax:"auto | none | scrollbar | -ms-autohiding-scrollbar",media:"interactive",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-overflow-style"},"-ms-scrollbar-3dlight-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"dependsOnUserAgent",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-3dlight-color"},"-ms-scrollbar-arrow-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"ButtonText",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-arrow-color"},"-ms-scrollbar-base-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"dependsOnUserAgent",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-base-color"},"-ms-scrollbar-darkshadow-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"ThreeDDarkShadow",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-darkshadow-color"},"-ms-scrollbar-face-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"ThreeDFace",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-face-color"},"-ms-scrollbar-highlight-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"ThreeDHighlight",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-highlight-color"},"-ms-scrollbar-shadow-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"ThreeDDarkShadow",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-shadow-color"},"-ms-scrollbar-track-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"Scrollbar",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scrollbar-track-color"},"-ms-scroll-chaining":{syntax:"chained | none",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"chained",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-chaining"},"-ms-scroll-limit":{syntax:"<'-ms-scroll-limit-x-min'> <'-ms-scroll-limit-y-min'> <'-ms-scroll-limit-x-max'> <'-ms-scroll-limit-y-max'>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:["-ms-scroll-limit-x-min","-ms-scroll-limit-y-min","-ms-scroll-limit-x-max","-ms-scroll-limit-y-max"],appliesto:"nonReplacedBlockAndInlineBlockElements",computed:["-ms-scroll-limit-x-min","-ms-scroll-limit-y-min","-ms-scroll-limit-x-max","-ms-scroll-limit-y-max"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-limit"},"-ms-scroll-limit-x-max":{syntax:"auto | <length>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-limit-x-max"},"-ms-scroll-limit-x-min":{syntax:"<length>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"0",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-limit-x-min"},"-ms-scroll-limit-y-max":{syntax:"auto | <length>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-limit-y-max"},"-ms-scroll-limit-y-min":{syntax:"<length>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"0",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-limit-y-min"},"-ms-scroll-rails":{syntax:"none | railed",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"railed",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-rails"},"-ms-scroll-snap-points-x":{syntax:"snapInterval( <length-percentage>, <length-percentage> ) | snapList( <length-percentage># )",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"snapInterval(0px, 100%)",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-snap-points-x"},"-ms-scroll-snap-points-y":{syntax:"snapInterval( <length-percentage>, <length-percentage> ) | snapList( <length-percentage># )",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"snapInterval(0px, 100%)",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-snap-points-y"},"-ms-scroll-snap-type":{syntax:"none | proximity | mandatory",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-snap-type"},"-ms-scroll-snap-x":{syntax:"<'-ms-scroll-snap-type'> <'-ms-scroll-snap-points-x'>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:["-ms-scroll-snap-type","-ms-scroll-snap-points-x"],appliesto:"nonReplacedBlockAndInlineBlockElements",computed:["-ms-scroll-snap-type","-ms-scroll-snap-points-x"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-snap-x"},"-ms-scroll-snap-y":{syntax:"<'-ms-scroll-snap-type'> <'-ms-scroll-snap-points-y'>",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:["-ms-scroll-snap-type","-ms-scroll-snap-points-y"],appliesto:"nonReplacedBlockAndInlineBlockElements",computed:["-ms-scroll-snap-type","-ms-scroll-snap-points-y"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-snap-y"},"-ms-scroll-translation":{syntax:"none | vertical-to-horizontal",media:"interactive",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-scroll-translation"},"-ms-text-autospace":{syntax:"none | ideograph-alpha | ideograph-numeric | ideograph-parenthesis | ideograph-space",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-text-autospace"},"-ms-touch-select":{syntax:"grippers | none",media:"interactive",inherited:!0,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"grippers",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-touch-select"},"-ms-user-select":{syntax:"none | element | text",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"text",appliesto:"nonReplacedElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-user-select"},"-ms-wrap-flow":{syntax:"auto | both | start | end | maximum | clear",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"auto",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-wrap-flow"},"-ms-wrap-margin":{syntax:"<length>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"0",appliesto:"exclusionElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-wrap-margin"},"-ms-wrap-through":{syntax:"wrap | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Microsoft Extensions"],initial:"wrap",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-ms-wrap-through"},"-moz-appearance":{syntax:"none | button | button-arrow-down | button-arrow-next | button-arrow-previous | button-arrow-up | button-bevel | button-focus | caret | checkbox | checkbox-container | checkbox-label | checkmenuitem | dualbutton | groupbox | listbox | listitem | menuarrow | menubar | menucheckbox | menuimage | menuitem | menuitemtext | menulist | menulist-button | menulist-text | menulist-textfield | menupopup | menuradio | menuseparator | meterbar | meterchunk | progressbar | progressbar-vertical | progresschunk | progresschunk-vertical | radio | radio-container | radio-label | radiomenuitem | range | range-thumb | resizer | resizerpanel | scale-horizontal | scalethumbend | scalethumb-horizontal | scalethumbstart | scalethumbtick | scalethumb-vertical | scale-vertical | scrollbarbutton-down | scrollbarbutton-left | scrollbarbutton-right | scrollbarbutton-up | scrollbarthumb-horizontal | scrollbarthumb-vertical | scrollbartrack-horizontal | scrollbartrack-vertical | searchfield | separator | sheet | spinner | spinner-downbutton | spinner-textfield | spinner-upbutton | splitter | statusbar | statusbarpanel | tab | tabpanel | tabpanels | tab-scroll-arrow-back | tab-scroll-arrow-forward | textfield | textfield-multiline | toolbar | toolbarbutton | toolbarbutton-dropdown | toolbargripper | toolbox | tooltip | treeheader | treeheadercell | treeheadersortarrow | treeitem | treeline | treetwisty | treetwistyopen | treeview | -moz-mac-unified-toolbar | -moz-win-borderless-glass | -moz-win-browsertabbar-toolbox | -moz-win-communicationstext | -moz-win-communications-toolbox | -moz-win-exclude-glass | -moz-win-glass | -moz-win-mediatext | -moz-win-media-toolbox | -moz-window-button-box | -moz-window-button-box-maximized | -moz-window-button-close | -moz-window-button-maximize | -moz-window-button-minimize | -moz-window-button-restore | -moz-window-frame-bottom | -moz-window-frame-left | -moz-window-frame-right | -moz-window-titlebar | -moz-window-titlebar-maximized",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"noneButOverriddenInUserAgentCSS",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/appearance"},"-moz-binding":{syntax:"<url> | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElementsExceptGeneratedContentOrPseudoElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-binding"},"-moz-border-bottom-colors":{syntax:"<color>+ | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-border-bottom-colors"},"-moz-border-left-colors":{syntax:"<color>+ | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-border-left-colors"},"-moz-border-right-colors":{syntax:"<color>+ | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-border-right-colors"},"-moz-border-top-colors":{syntax:"<color>+ | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-border-top-colors"},"-moz-context-properties":{syntax:"none | [ fill | fill-opacity | stroke | stroke-opacity ]#",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElementsThatCanReferenceImages",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-context-properties"},"-moz-float-edge":{syntax:"border-box | content-box | margin-box | padding-box",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"content-box",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-float-edge"},"-moz-force-broken-image-icon":{syntax:"<integer [0,1]>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"0",appliesto:"images",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-force-broken-image-icon"},"-moz-image-region":{syntax:"<shape> | auto",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"auto",appliesto:"xulImageElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-image-region"},"-moz-orient":{syntax:"inline | block | horizontal | vertical",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"inline",appliesto:"anyElementEffectOnProgressAndMeter",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-orient"},"-moz-outline-radius":{syntax:"<outline-radius>{1,4} [ / <outline-radius>{1,4} ]?",media:"visual",inherited:!1,animationType:["-moz-outline-radius-topleft","-moz-outline-radius-topright","-moz-outline-radius-bottomright","-moz-outline-radius-bottomleft"],percentages:["-moz-outline-radius-topleft","-moz-outline-radius-topright","-moz-outline-radius-bottomright","-moz-outline-radius-bottomleft"],groups:["Mozilla Extensions"],initial:["-moz-outline-radius-topleft","-moz-outline-radius-topright","-moz-outline-radius-bottomright","-moz-outline-radius-bottomleft"],appliesto:"allElements",computed:["-moz-outline-radius-topleft","-moz-outline-radius-topright","-moz-outline-radius-bottomright","-moz-outline-radius-bottomleft"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-outline-radius"},"-moz-outline-radius-bottomleft":{syntax:"<outline-radius>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["Mozilla Extensions"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-outline-radius-bottomleft"},"-moz-outline-radius-bottomright":{syntax:"<outline-radius>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["Mozilla Extensions"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-outline-radius-bottomright"},"-moz-outline-radius-topleft":{syntax:"<outline-radius>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["Mozilla Extensions"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-outline-radius-topleft"},"-moz-outline-radius-topright":{syntax:"<outline-radius>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["Mozilla Extensions"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-outline-radius-topright"},"-moz-stack-sizing":{syntax:"ignore | stretch-to-fit",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"stretch-to-fit",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-stack-sizing"},"-moz-text-blink":{syntax:"none | blink",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-text-blink"},"-moz-user-focus":{syntax:"ignore | normal | select-after | select-before | select-menu | select-same | select-all | none",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-user-focus"},"-moz-user-input":{syntax:"auto | none | enabled | disabled",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-user-input"},"-moz-user-modify":{syntax:"read-only | read-write | write-only",media:"interactive",inherited:!0,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"read-only",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-user-modify"},"-moz-window-dragging":{syntax:"drag | no-drag",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"drag",appliesto:"allElementsCreatingNativeWindows",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-window-dragging"},"-moz-window-shadow":{syntax:"default | menu | tooltip | sheet | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"default",appliesto:"allElementsCreatingNativeWindows",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-moz-window-shadow"},"-webkit-appearance":{syntax:"none | button | button-bevel | caret | checkbox | default-button | inner-spin-button | listbox | listitem | media-controls-background | media-controls-fullscreen-background | media-current-time-display | media-enter-fullscreen-button | media-exit-fullscreen-button | media-fullscreen-button | media-mute-button | media-overlay-play-button | media-play-button | media-seek-back-button | media-seek-forward-button | media-slider | media-sliderthumb | media-time-remaining-display | media-toggle-closed-captions-button | media-volume-slider | media-volume-slider-container | media-volume-sliderthumb | menulist | menulist-button | menulist-text | menulist-textfield | meter | progress-bar | progress-bar-value | push-button | radio | searchfield | searchfield-cancel-button | searchfield-decoration | searchfield-results-button | searchfield-results-decoration | slider-horizontal | slider-vertical | sliderthumb-horizontal | sliderthumb-vertical | square-button | textarea | textfield | -apple-pay-button",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"noneButOverriddenInUserAgentCSS",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/appearance"},"-webkit-border-before":{syntax:"<'border-width'> || <'border-style'> || <'color'>",media:"visual",inherited:!0,animationType:"discrete",percentages:["-webkit-border-before-width"],groups:["WebKit Extensions"],initial:["border-width","border-style","color"],appliesto:"allElements",computed:["border-width","border-style","color"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-border-before"},"-webkit-border-before-color":{syntax:"<'color'>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"nonstandard"},"-webkit-border-before-style":{syntax:"<'border-style'>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard"},"-webkit-border-before-width":{syntax:"<'border-width'>",media:"visual",inherited:!0,animationType:"discrete",percentages:"logicalWidthOfContainingBlock",groups:["WebKit Extensions"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"nonstandard"},"-webkit-box-reflect":{syntax:"[ above | below | right | left ]? <length>? <image>?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-box-reflect"},"-webkit-line-clamp":{syntax:"none | <integer>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["WebKit Extensions","CSS Overflow"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-line-clamp"},"-webkit-mask":{syntax:"[ <mask-reference> || <position> [ / <bg-size> ]? || <repeat-style> || [ <box> | border | padding | content | text ] || [ <box> | border | padding | content ] ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:["-webkit-mask-image","-webkit-mask-repeat","-webkit-mask-attachment","-webkit-mask-position","-webkit-mask-origin","-webkit-mask-clip"],appliesto:"allElements",computed:["-webkit-mask-image","-webkit-mask-repeat","-webkit-mask-attachment","-webkit-mask-position","-webkit-mask-origin","-webkit-mask-clip"],order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask"},"-webkit-mask-attachment":{syntax:"<attachment>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"scroll",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-attachment"},"-webkit-mask-clip":{syntax:"[ <box> | border | padding | content | text ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"border",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-clip"},"-webkit-mask-composite":{syntax:"<composite-style>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"source-over",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-composite"},"-webkit-mask-image":{syntax:"<mask-reference>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"none",appliesto:"allElements",computed:"absoluteURIOrNone",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-image"},"-webkit-mask-origin":{syntax:"[ <box> | border | padding | content ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"padding",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-origin"},"-webkit-mask-position":{syntax:"<position>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToSizeOfElement",groups:["WebKit Extensions"],initial:"0% 0%",appliesto:"allElements",computed:"absoluteLengthOrPercentage",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-position"},"-webkit-mask-position-x":{syntax:"[ <length-percentage> | left | center | right ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToSizeOfElement",groups:["WebKit Extensions"],initial:"0%",appliesto:"allElements",computed:"absoluteLengthOrPercentage",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-position-x"},"-webkit-mask-position-y":{syntax:"[ <length-percentage> | top | center | bottom ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToSizeOfElement",groups:["WebKit Extensions"],initial:"0%",appliesto:"allElements",computed:"absoluteLengthOrPercentage",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-position-y"},"-webkit-mask-repeat":{syntax:"<repeat-style>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"repeat",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-repeat"},"-webkit-mask-repeat-x":{syntax:"repeat | no-repeat | space | round",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"repeat",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-repeat-x"},"-webkit-mask-repeat-y":{syntax:"repeat | no-repeat | space | round",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"repeat",appliesto:"allElements",computed:"absoluteLengthOrPercentage",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-mask-repeat-y"},"-webkit-mask-size":{syntax:"<bg-size>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"relativeToBackgroundPositioningArea",groups:["WebKit Extensions"],initial:"auto auto",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-size"},"-webkit-overflow-scrolling":{syntax:"auto | touch",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"auto",appliesto:"scrollingBoxes",computed:"asSpecified",order:"orderOfAppearance",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-overflow-scrolling"},"-webkit-tap-highlight-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"black",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-tap-highlight-color"},"-webkit-text-fill-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"color",percentages:"no",groups:["WebKit Extensions"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-text-fill-color"},"-webkit-text-stroke":{syntax:"<length> || <color>",media:"visual",inherited:!0,animationType:["-webkit-text-stroke-width","-webkit-text-stroke-color"],percentages:"no",groups:["WebKit Extensions"],initial:["-webkit-text-stroke-width","-webkit-text-stroke-color"],appliesto:"allElements",computed:["-webkit-text-stroke-width","-webkit-text-stroke-color"],order:"canonicalOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-text-stroke"},"-webkit-text-stroke-color":{syntax:"<color>",media:"visual",inherited:!0,animationType:"color",percentages:"no",groups:["WebKit Extensions"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-text-stroke-color"},"-webkit-text-stroke-width":{syntax:"<length>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"0",appliesto:"allElements",computed:"absoluteLength",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-text-stroke-width"},"-webkit-touch-callout":{syntax:"default | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"default",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/-webkit-touch-callout"},"-webkit-user-modify":{syntax:"read-only | read-write | read-write-plaintext-only",media:"interactive",inherited:!0,animationType:"discrete",percentages:"no",groups:["WebKit Extensions"],initial:"read-only",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard"},"align-content":{syntax:"normal | <baseline-position> | <content-distribution> | <overflow-position>? <content-position>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"normal",appliesto:"multilineFlexContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/align-content"},"align-items":{syntax:"normal | stretch | <baseline-position> | [ <overflow-position>? <self-position> ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/align-items"},"align-self":{syntax:"auto | normal | stretch | <baseline-position> | <overflow-position>? <self-position>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"auto",appliesto:"flexItemsGridItemsAndAbsolutelyPositionedBoxes",computed:"autoOnAbsolutelyPositionedElementsValueOfAlignItemsOnParent",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/align-self"},"align-tracks":{syntax:"[ normal | <baseline-position> | <content-distribution> | <overflow-position>? <content-position> ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"normal",appliesto:"gridContainersWithMasonryLayoutInTheirBlockAxis",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/align-tracks"},all:{syntax:"initial | inherit | unset | revert",media:"noPracticalMedia",inherited:!1,animationType:"eachOfShorthandPropertiesExceptUnicodeBiDiAndDirection",percentages:"no",groups:["CSS Miscellaneous"],initial:"noPracticalInitialValue",appliesto:"allElements",computed:"asSpecifiedAppliesToEachProperty",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/all"},animation:{syntax:"<single-animation>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:["animation-name","animation-duration","animation-timing-function","animation-delay","animation-iteration-count","animation-direction","animation-fill-mode","animation-play-state"],appliesto:"allElementsAndPseudos",computed:["animation-name","animation-duration","animation-timing-function","animation-delay","animation-direction","animation-iteration-count","animation-fill-mode","animation-play-state"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation"},"animation-delay":{syntax:"<time>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"0s",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-delay"},"animation-direction":{syntax:"<single-animation-direction>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"normal",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-direction"},"animation-duration":{syntax:"<time>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"0s",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-duration"},"animation-fill-mode":{syntax:"<single-animation-fill-mode>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"none",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-fill-mode"},"animation-iteration-count":{syntax:"<single-animation-iteration-count>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"1",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-iteration-count"},"animation-name":{syntax:"[ none | <keyframes-name> ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"none",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-name"},"animation-play-state":{syntax:"<single-animation-play-state>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"running",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-play-state"},"animation-timing-function":{syntax:"<timing-function>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Animations"],initial:"ease",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/animation-timing-function"},appearance:{syntax:"none | auto | textfield | menulist-button | <compat-auto>",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/appearance"},"aspect-ratio":{syntax:"auto | <ratio>",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"allElementsExceptInlineBoxesAndInternalRubyOrTableBoxes",computed:"asSpecified",order:"perGrammar",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/aspect-ratio"},azimuth:{syntax:"<angle> | [ [ left-side | far-left | left | center-left | center | center-right | right | far-right | right-side ] || behind ] | leftwards | rightwards",media:"aural",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Speech"],initial:"center",appliesto:"allElements",computed:"normalizedAngle",order:"orderOfAppearance",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/azimuth"},"backdrop-filter":{syntax:"none | <filter-function-list>",media:"visual",inherited:!1,animationType:"filterList",percentages:"no",groups:["Filter Effects"],initial:"none",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/backdrop-filter"},"backface-visibility":{syntax:"visible | hidden",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transforms"],initial:"visible",appliesto:"transformableElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/backface-visibility"},background:{syntax:"[ <bg-layer> , ]* <final-bg-layer>",media:"visual",inherited:!1,animationType:["background-color","background-image","background-clip","background-position","background-size","background-repeat","background-attachment"],percentages:["background-position","background-size"],groups:["CSS Backgrounds and Borders"],initial:["background-image","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","background-color"],appliesto:"allElements",computed:["background-image","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","background-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background"},"background-attachment":{syntax:"<attachment>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"scroll",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-attachment"},"background-blend-mode":{syntax:"<blend-mode>#",media:"none",inherited:!1,animationType:"discrete",percentages:"no",groups:["Compositing and Blending"],initial:"normal",appliesto:"allElementsSVGContainerGraphicsAndGraphicsReferencingElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-blend-mode"},"background-clip":{syntax:"<box>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"border-box",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-clip"},"background-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"transparent",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-color"},"background-image":{syntax:"<bg-image>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"asSpecifiedURLsAbsolute",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-image"},"background-origin":{syntax:"<box>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"padding-box",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-origin"},"background-position":{syntax:"<bg-position>#",media:"visual",inherited:!1,animationType:"repeatableListOfSimpleListOfLpc",percentages:"referToSizeOfBackgroundPositioningAreaMinusBackgroundImageSize",groups:["CSS Backgrounds and Borders"],initial:"0% 0%",appliesto:"allElements",computed:"listEachItemTwoKeywordsOriginOffsets",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-position"},"background-position-x":{syntax:"[ center | [ [ left | right | x-start | x-end ]? <length-percentage>? ]! ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToWidthOfBackgroundPositioningAreaMinusBackgroundImageHeight",groups:["CSS Backgrounds and Borders"],initial:"left",appliesto:"allElements",computed:"listEachItemConsistingOfAbsoluteLengthPercentageAndOrigin",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-position-x"},"background-position-y":{syntax:"[ center | [ [ top | bottom | y-start | y-end ]? <length-percentage>? ]! ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToHeightOfBackgroundPositioningAreaMinusBackgroundImageHeight",groups:["CSS Backgrounds and Borders"],initial:"top",appliesto:"allElements",computed:"listEachItemConsistingOfAbsoluteLengthPercentageAndOrigin",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-position-y"},"background-repeat":{syntax:"<repeat-style>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"repeat",appliesto:"allElements",computed:"listEachItemHasTwoKeywordsOnePerDimension",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-repeat"},"background-size":{syntax:"<bg-size>#",media:"visual",inherited:!1,animationType:"repeatableListOfSimpleListOfLpc",percentages:"relativeToBackgroundPositioningArea",groups:["CSS Backgrounds and Borders"],initial:"auto auto",appliesto:"allElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/background-size"},"block-overflow":{syntax:"clip | ellipsis | <string>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"clip",appliesto:"blockContainers",computed:"asSpecified",order:"perGrammar",status:"experimental"},"block-size":{syntax:"<'width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"blockSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"sameAsWidthAndHeight",computed:"sameAsWidthAndHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/block-size"},border:{syntax:"<line-width> || <line-style> || <color>",media:"visual",inherited:!1,animationType:["border-color","border-style","border-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-width","border-style","border-color"],appliesto:"allElements",computed:["border-width","border-style","border-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border"},"border-block":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:["border-top-width","border-top-style","border-top-color"],appliesto:"allElements",computed:["border-top-width","border-top-style","border-top-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block"},"border-block-color":{syntax:"<'border-top-color'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-color"},"border-block-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-style"},"border-block-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-width"},"border-block-end":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:["border-block-end-color","border-block-end-style","border-block-end-width"],percentages:"no",groups:["CSS Logical Properties"],initial:["border-top-width","border-top-style","border-top-color"],appliesto:"allElements",computed:["border-top-width","border-top-style","border-top-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-end"},"border-block-end-color":{syntax:"<'border-top-color'>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-end-color"},"border-block-end-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-end-style"},"border-block-end-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-end-width"},"border-block-start":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:["border-block-start-color","border-block-start-style","border-block-start-width"],percentages:"no",groups:["CSS Logical Properties"],initial:["border-width","border-style","color"],appliesto:"allElements",computed:["border-width","border-style","border-block-start-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-start"},"border-block-start-color":{syntax:"<'border-top-color'>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-start-color"},"border-block-start-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-start-style"},"border-block-start-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-block-start-width"},"border-bottom":{syntax:"<line-width> || <line-style> || <color>",media:"visual",inherited:!1,animationType:["border-bottom-color","border-bottom-style","border-bottom-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-bottom-width","border-bottom-style","border-bottom-color"],appliesto:"allElements",computed:["border-bottom-width","border-bottom-style","border-bottom-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom"},"border-bottom-color":{syntax:"<'border-top-color'>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom-color"},"border-bottom-left-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Backgrounds and Borders"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom-left-radius"},"border-bottom-right-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Backgrounds and Borders"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom-right-radius"},"border-bottom-style":{syntax:"<line-style>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom-style"},"border-bottom-width":{syntax:"<line-width>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthOr0IfBorderBottomStyleNoneOrHidden",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-bottom-width"},"border-collapse":{syntax:"collapse | separate",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Table"],initial:"separate",appliesto:"tableElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-collapse"},"border-color":{syntax:"<color>{1,4}",media:"visual",inherited:!1,animationType:["border-bottom-color","border-left-color","border-right-color","border-top-color"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-top-color","border-right-color","border-bottom-color","border-left-color"],appliesto:"allElements",computed:["border-bottom-color","border-left-color","border-right-color","border-top-color"],order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-color"},"border-end-end-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-end-end-radius"},"border-end-start-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-end-start-radius"},"border-image":{syntax:"<'border-image-source'> || <'border-image-slice'> [ / <'border-image-width'> | / <'border-image-width'>? / <'border-image-outset'> ]? || <'border-image-repeat'>",media:"visual",inherited:!1,animationType:"discrete",percentages:["border-image-slice","border-image-width"],groups:["CSS Backgrounds and Borders"],initial:["border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat"],appliesto:"allElementsExceptTableElementsWhenCollapse",computed:["border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width"],order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image"},"border-image-outset":{syntax:"[ <length> | <number> ]{1,4}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"0",appliesto:"allElementsExceptTableElementsWhenCollapse",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image-outset"},"border-image-repeat":{syntax:"[ stretch | repeat | round | space ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"stretch",appliesto:"allElementsExceptTableElementsWhenCollapse",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image-repeat"},"border-image-slice":{syntax:"<number-percentage>{1,4} && fill?",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"referToSizeOfBorderImage",groups:["CSS Backgrounds and Borders"],initial:"100%",appliesto:"allElementsExceptTableElementsWhenCollapse",computed:"oneToFourPercentagesOrAbsoluteLengthsPlusFill",order:"percentagesOrLengthsFollowedByFill",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image-slice"},"border-image-source":{syntax:"none | <image>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElementsExceptTableElementsWhenCollapse",computed:"noneOrImageWithAbsoluteURI",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image-source"},"border-image-width":{syntax:"[ <length-percentage> | <number> | auto ]{1,4}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"referToWidthOrHeightOfBorderImageArea",groups:["CSS Backgrounds and Borders"],initial:"1",appliesto:"allElementsExceptTableElementsWhenCollapse",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-image-width"},"border-inline":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:["border-top-width","border-top-style","border-top-color"],appliesto:"allElements",computed:["border-top-width","border-top-style","border-top-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline"},"border-inline-end":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:["border-inline-end-color","border-inline-end-style","border-inline-end-width"],percentages:"no",groups:["CSS Logical Properties"],initial:["border-width","border-style","color"],appliesto:"allElements",computed:["border-width","border-style","border-inline-end-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-end"},"border-inline-color":{syntax:"<'border-top-color'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-color"},"border-inline-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-style"},"border-inline-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-width"},"border-inline-end-color":{syntax:"<'border-top-color'>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-end-color"},"border-inline-end-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-end-style"},"border-inline-end-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-end-width"},"border-inline-start":{syntax:"<'border-top-width'> || <'border-top-style'> || <'color'>",media:"visual",inherited:!1,animationType:["border-inline-start-color","border-inline-start-style","border-inline-start-width"],percentages:"no",groups:["CSS Logical Properties"],initial:["border-width","border-style","color"],appliesto:"allElements",computed:["border-width","border-style","border-inline-start-color"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-start"},"border-inline-start-color":{syntax:"<'border-top-color'>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Logical Properties"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-start-color"},"border-inline-start-style":{syntax:"<'border-top-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Logical Properties"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-start-style"},"border-inline-start-width":{syntax:"<'border-top-width'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthZeroIfBorderStyleNoneOrHidden",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-inline-start-width"},"border-left":{syntax:"<line-width> || <line-style> || <color>",media:"visual",inherited:!1,animationType:["border-left-color","border-left-style","border-left-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-left-width","border-left-style","border-left-color"],appliesto:"allElements",computed:["border-left-width","border-left-style","border-left-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-left"},"border-left-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-left-color"},"border-left-style":{syntax:"<line-style>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-left-style"},"border-left-width":{syntax:"<line-width>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthOr0IfBorderLeftStyleNoneOrHidden",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-left-width"},"border-radius":{syntax:"<length-percentage>{1,4} [ / <length-percentage>{1,4} ]?",media:"visual",inherited:!1,animationType:["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"],percentages:"referToDimensionOfBorderBox",groups:["CSS Backgrounds and Borders"],initial:["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"],appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:["border-bottom-left-radius","border-bottom-right-radius","border-top-left-radius","border-top-right-radius"],order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-radius"},"border-right":{syntax:"<line-width> || <line-style> || <color>",media:"visual",inherited:!1,animationType:["border-right-color","border-right-style","border-right-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-right-width","border-right-style","border-right-color"],appliesto:"allElements",computed:["border-right-width","border-right-style","border-right-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-right"},"border-right-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-right-color"},"border-right-style":{syntax:"<line-style>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-right-style"},"border-right-width":{syntax:"<line-width>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthOr0IfBorderRightStyleNoneOrHidden",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-right-width"},"border-spacing":{syntax:"<length> <length>?",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Table"],initial:"0",appliesto:"tableElements",computed:"twoAbsoluteLengths",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-spacing"},"border-start-end-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-start-end-radius"},"border-start-start-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-start-start-radius"},"border-style":{syntax:"<line-style>{1,4}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-top-style","border-right-style","border-bottom-style","border-left-style"],appliesto:"allElements",computed:["border-bottom-style","border-left-style","border-right-style","border-top-style"],order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-style"},"border-top":{syntax:"<line-width> || <line-style> || <color>",media:"visual",inherited:!1,animationType:["border-top-color","border-top-style","border-top-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-top-width","border-top-style","border-top-color"],appliesto:"allElements",computed:["border-top-width","border-top-style","border-top-color"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top"},"border-top-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top-color"},"border-top-left-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Backgrounds and Borders"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top-left-radius"},"border-top-right-radius":{syntax:"<length-percentage>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfBorderBox",groups:["CSS Backgrounds and Borders"],initial:"0",appliesto:"allElementsUAsNotRequiredWhenCollapse",computed:"twoAbsoluteLengthOrPercentages",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top-right-radius"},"border-top-style":{syntax:"<line-style>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top-style"},"border-top-width":{syntax:"<line-width>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"medium",appliesto:"allElements",computed:"absoluteLengthOr0IfBorderTopStyleNoneOrHidden",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-top-width"},"border-width":{syntax:"<line-width>{1,4}",media:"visual",inherited:!1,animationType:["border-bottom-width","border-left-width","border-right-width","border-top-width"],percentages:"no",groups:["CSS Backgrounds and Borders"],initial:["border-top-width","border-right-width","border-bottom-width","border-left-width"],appliesto:"allElements",computed:["border-bottom-width","border-left-width","border-right-width","border-top-width"],order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/border-width"},bottom:{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToContainingBlockHeight",groups:["CSS Positioning"],initial:"auto",appliesto:"positionedElements",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/bottom"},"box-align":{syntax:"start | center | end | baseline | stretch",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"stretch",appliesto:"elementsWithDisplayBoxOrInlineBox",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-align"},"box-decoration-break":{syntax:"slice | clone",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"slice",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-decoration-break"},"box-direction":{syntax:"normal | reverse | inherit",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"normal",appliesto:"elementsWithDisplayBoxOrInlineBox",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-direction"},"box-flex":{syntax:"<number>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"0",appliesto:"directChildrenOfElementsWithDisplayMozBoxMozInlineBox",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-flex"},"box-flex-group":{syntax:"<integer>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"1",appliesto:"inFlowChildrenOfBoxElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-flex-group"},"box-lines":{syntax:"single | multiple",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"single",appliesto:"boxElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-lines"},"box-ordinal-group":{syntax:"<integer>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"1",appliesto:"childrenOfBoxElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-ordinal-group"},"box-orient":{syntax:"horizontal | vertical | inline-axis | block-axis | inherit",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"inlineAxisHorizontalInXUL",appliesto:"elementsWithDisplayBoxOrInlineBox",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-orient"},"box-pack":{syntax:"start | center | end | justify",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions","WebKit Extensions"],initial:"start",appliesto:"elementsWithDisplayMozBoxMozInlineBox",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-pack"},"box-shadow":{syntax:"none | <shadow>#",media:"visual",inherited:!1,animationType:"shadowList",percentages:"no",groups:["CSS Backgrounds and Borders"],initial:"none",appliesto:"allElements",computed:"absoluteLengthsSpecifiedColorAsSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-shadow"},"box-sizing":{syntax:"content-box | border-box",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"content-box",appliesto:"allElementsAcceptingWidthOrHeight",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/box-sizing"},"break-after":{syntax:"auto | avoid | always | all | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"auto",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/break-after"},"break-before":{syntax:"auto | avoid | always | all | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"auto",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/break-before"},"break-inside":{syntax:"auto | avoid | avoid-page | avoid-column | avoid-region",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"auto",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/break-inside"},"caption-side":{syntax:"top | bottom | block-start | block-end | inline-start | inline-end",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Table"],initial:"top",appliesto:"tableCaptionElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/caption-side"},"caret-color":{syntax:"auto | <color>",media:"interactive",inherited:!0,animationType:"color",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"allElements",computed:"asAutoOrColor",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/caret-color"},clear:{syntax:"none | left | right | both | inline-start | inline-end",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Positioning"],initial:"none",appliesto:"blockLevelElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/clear"},clip:{syntax:"<shape> | auto",media:"visual",inherited:!1,animationType:"rectangle",percentages:"no",groups:["CSS Masking"],initial:"auto",appliesto:"absolutelyPositionedElements",computed:"autoOrRectangle",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/clip"},"clip-path":{syntax:"<clip-source> | [ <basic-shape> || <geometry-box> ] | none",media:"visual",inherited:!1,animationType:"basicShapeOtherwiseNo",percentages:"referToReferenceBoxWhenSpecifiedOtherwiseBorderBox",groups:["CSS Masking"],initial:"none",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedURLsAbsolute",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/clip-path"},color:{syntax:"<color>",media:"visual",inherited:!0,animationType:"color",percentages:"no",groups:["CSS Color"],initial:"variesFromBrowserToBrowser",appliesto:"allElements",computed:"translucentValuesRGBAOtherwiseRGB",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/color"},"color-adjust":{syntax:"economy | exact",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Color"],initial:"economy",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/color-adjust"},"column-count":{syntax:"<integer> | auto",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["CSS Columns"],initial:"auto",appliesto:"blockContainersExceptTableWrappers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-count"},"column-fill":{syntax:"auto | balance | balance-all",media:"visualInContinuousMediaNoEffectInOverflowColumns",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Columns"],initial:"balance",appliesto:"multicolElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-fill"},"column-gap":{syntax:"normal | <length-percentage>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfContentArea",groups:["CSS Box Alignment"],initial:"normal",appliesto:"multiColumnElementsFlexContainersGridContainers",computed:"asSpecifiedWithLengthsAbsoluteAndNormalComputingToZeroExceptMultiColumn",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-gap"},"column-rule":{syntax:"<'column-rule-width'> || <'column-rule-style'> || <'column-rule-color'>",media:"visual",inherited:!1,animationType:["column-rule-color","column-rule-style","column-rule-width"],percentages:"no",groups:["CSS Columns"],initial:["column-rule-width","column-rule-style","column-rule-color"],appliesto:"multicolElements",computed:["column-rule-color","column-rule-style","column-rule-width"],order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-rule"},"column-rule-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Columns"],initial:"currentcolor",appliesto:"multicolElements",computed:"computedColor",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-rule-color"},"column-rule-style":{syntax:"<'border-style'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Columns"],initial:"none",appliesto:"multicolElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-rule-style"},"column-rule-width":{syntax:"<'border-width'>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Columns"],initial:"medium",appliesto:"multicolElements",computed:"absoluteLength0IfColumnRuleStyleNoneOrHidden",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-rule-width"},"column-span":{syntax:"none | all",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Columns"],initial:"none",appliesto:"inFlowBlockLevelElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-span"},"column-width":{syntax:"<length> | auto",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Columns"],initial:"auto",appliesto:"blockContainersExceptTableWrappers",computed:"absoluteLengthZeroOrLarger",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-width"},columns:{syntax:"<'column-width'> || <'column-count'>",media:"visual",inherited:!1,animationType:["column-width","column-count"],percentages:"no",groups:["CSS Columns"],initial:["column-width","column-count"],appliesto:"blockContainersExceptTableWrappers",computed:["column-width","column-count"],order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/columns"},contain:{syntax:"none | strict | content | [ size || layout || style || paint ]",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Containment"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/contain"},content:{syntax:"normal | none | [ <content-replacement> | <content-list> ] [/ <string> ]?",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Generated Content"],initial:"normal",appliesto:"beforeAndAfterPseudos",computed:"normalOnElementsForPseudosNoneAbsoluteURIStringOrAsSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/content"},"counter-increment":{syntax:"[ <custom-ident> <integer>? ]+ | none",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Counter Styles"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/counter-increment"},"counter-reset":{syntax:"[ <custom-ident> <integer>? ]+ | none",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Counter Styles"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/counter-reset"},"counter-set":{syntax:"[ <custom-ident> <integer>? ]+ | none",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Counter Styles"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/counter-set"},cursor:{syntax:"[ [ <url> [ <x> <y> ]? , ]* [ auto | default | none | context-menu | help | pointer | progress | wait | cell | crosshair | text | vertical-text | alias | copy | move | no-drop | not-allowed | e-resize | n-resize | ne-resize | nw-resize | s-resize | se-resize | sw-resize | w-resize | ew-resize | ns-resize | nesw-resize | nwse-resize | col-resize | row-resize | all-scroll | zoom-in | zoom-out | grab | grabbing ] ]",media:["visual","interactive"],inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"allElements",computed:"asSpecifiedURLsAbsolute",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/cursor"},direction:{syntax:"ltr | rtl",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Writing Modes"],initial:"ltr",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/direction"},display:{syntax:"[ <display-outside> || <display-inside> ] | <display-listitem> | <display-internal> | <display-box> | <display-legacy>",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Display"],initial:"inline",appliesto:"allElements",computed:"asSpecifiedExceptPositionedFloatingAndRootElementsKeywordMaybeDifferent",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/display"},"empty-cells":{syntax:"show | hide",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Table"],initial:"show",appliesto:"tableCellElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/empty-cells"},filter:{syntax:"none | <filter-function-list>",media:"visual",inherited:!1,animationType:"filterList",percentages:"no",groups:["Filter Effects"],initial:"none",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/filter"},flex:{syntax:"none | [ <'flex-grow'> <'flex-shrink'>? || <'flex-basis'> ]",media:"visual",inherited:!1,animationType:["flex-grow","flex-shrink","flex-basis"],percentages:"no",groups:["CSS Flexible Box Layout"],initial:["flex-grow","flex-shrink","flex-basis"],appliesto:"flexItemsAndInFlowPseudos",computed:["flex-grow","flex-shrink","flex-basis"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex"},"flex-basis":{syntax:"content | <'width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToFlexContainersInnerMainSize",groups:["CSS Flexible Box Layout"],initial:"auto",appliesto:"flexItemsAndInFlowPseudos",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"lengthOrPercentageBeforeKeywordIfBothPresent",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-basis"},"flex-direction":{syntax:"row | row-reverse | column | column-reverse",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Flexible Box Layout"],initial:"row",appliesto:"flexContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-direction"},"flex-flow":{syntax:"<'flex-direction'> || <'flex-wrap'>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Flexible Box Layout"],initial:["flex-direction","flex-wrap"],appliesto:"flexContainers",computed:["flex-direction","flex-wrap"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-flow"},"flex-grow":{syntax:"<number>",media:"visual",inherited:!1,animationType:"number",percentages:"no",groups:["CSS Flexible Box Layout"],initial:"0",appliesto:"flexItemsAndInFlowPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-grow"},"flex-shrink":{syntax:"<number>",media:"visual",inherited:!1,animationType:"number",percentages:"no",groups:["CSS Flexible Box Layout"],initial:"1",appliesto:"flexItemsAndInFlowPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-shrink"},"flex-wrap":{syntax:"nowrap | wrap | wrap-reverse",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Flexible Box Layout"],initial:"nowrap",appliesto:"flexContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/flex-wrap"},float:{syntax:"left | right | none | inline-start | inline-end",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Positioning"],initial:"none",appliesto:"allElementsNoEffectIfDisplayNone",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/float"},font:{syntax:"[ [ <'font-style'> || <font-variant-css21> || <'font-weight'> || <'font-stretch'> ]? <'font-size'> [ / <'line-height'> ]? <'font-family'> ] | caption | icon | menu | message-box | small-caption | status-bar",media:"visual",inherited:!0,animationType:["font-style","font-variant","font-weight","font-stretch","font-size","line-height","font-family"],percentages:["font-size","line-height"],groups:["CSS Fonts"],initial:["font-style","font-variant","font-weight","font-stretch","font-size","line-height","font-family"],appliesto:"allElements",computed:["font-style","font-variant","font-weight","font-stretch","font-size","line-height","font-family"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font"},"font-family":{syntax:"[ <family-name> | <generic-family> ]#",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"dependsOnUserAgent",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-family"},"font-feature-settings":{syntax:"normal | <feature-tag-value>#",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-feature-settings"},"font-kerning":{syntax:"auto | normal | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-kerning"},"font-language-override":{syntax:"normal | <string>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-language-override"},"font-optical-sizing":{syntax:"auto | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-optical-sizing"},"font-variation-settings":{syntax:"normal | [ <string> <number> ]#",media:"visual",inherited:!0,animationType:"transform",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variation-settings"},"font-size":{syntax:"<absolute-size> | <relative-size> | <length-percentage>",media:"visual",inherited:!0,animationType:"length",percentages:"referToParentElementsFontSize",groups:["CSS Fonts"],initial:"medium",appliesto:"allElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-size"},"font-size-adjust":{syntax:"none | <number>",media:"visual",inherited:!0,animationType:"number",percentages:"no",groups:["CSS Fonts"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-size-adjust"},"font-smooth":{syntax:"auto | never | always | <absolute-size> | <length>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-smooth"},"font-stretch":{syntax:"<font-stretch-absolute>",media:"visual",inherited:!0,animationType:"fontStretch",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-stretch"},"font-style":{syntax:"normal | italic | oblique <angle>?",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-style"},"font-synthesis":{syntax:"none | [ weight || style ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"weight style",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-synthesis"},"font-variant":{syntax:"normal | none | [ <common-lig-values> || <discretionary-lig-values> || <historical-lig-values> || <contextual-alt-values> || stylistic( <feature-value-name> ) || historical-forms || styleset( <feature-value-name># ) || character-variant( <feature-value-name># ) || swash( <feature-value-name> ) || ornaments( <feature-value-name> ) || annotation( <feature-value-name> ) || [ small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps ] || <numeric-figure-values> || <numeric-spacing-values> || <numeric-fraction-values> || ordinal || slashed-zero || <east-asian-variant-values> || <east-asian-width-values> || ruby ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant"},"font-variant-alternates":{syntax:"normal | [ stylistic( <feature-value-name> ) || historical-forms || styleset( <feature-value-name># ) || character-variant( <feature-value-name># ) || swash( <feature-value-name> ) || ornaments( <feature-value-name> ) || annotation( <feature-value-name> ) ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-alternates"},"font-variant-caps":{syntax:"normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-caps"},"font-variant-east-asian":{syntax:"normal | [ <east-asian-variant-values> || <east-asian-width-values> || ruby ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-east-asian"},"font-variant-ligatures":{syntax:"normal | none | [ <common-lig-values> || <discretionary-lig-values> || <historical-lig-values> || <contextual-alt-values> ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-ligatures"},"font-variant-numeric":{syntax:"normal | [ <numeric-figure-values> || <numeric-spacing-values> || <numeric-fraction-values> || ordinal || slashed-zero ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-numeric"},"font-variant-position":{syntax:"normal | sub | super",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-variant-position"},"font-weight":{syntax:"<font-weight-absolute> | bolder | lighter",media:"visual",inherited:!0,animationType:"fontWeight",percentages:"no",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"keywordOrNumericalValueBolderLighterTransformedToRealValue",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/font-weight"},gap:{syntax:"<'row-gap'> <'column-gap'>?",media:"visual",inherited:!1,animationType:["row-gap","column-gap"],percentages:"no",groups:["CSS Box Alignment"],initial:["row-gap","column-gap"],appliesto:"multiColumnElementsFlexContainersGridContainers",computed:["row-gap","column-gap"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/gap"},grid:{syntax:"<'grid-template'> | <'grid-template-rows'> / [ auto-flow && dense? ] <'grid-auto-columns'>? | [ auto-flow && dense? ] <'grid-auto-rows'>? / <'grid-template-columns'>",media:"visual",inherited:!1,animationType:"discrete",percentages:["grid-template-rows","grid-template-columns","grid-auto-rows","grid-auto-columns"],groups:["CSS Grid Layout"],initial:["grid-template-rows","grid-template-columns","grid-template-areas","grid-auto-rows","grid-auto-columns","grid-auto-flow","grid-column-gap","grid-row-gap","column-gap","row-gap"],appliesto:"gridContainers",computed:["grid-template-rows","grid-template-columns","grid-template-areas","grid-auto-rows","grid-auto-columns","grid-auto-flow","grid-column-gap","grid-row-gap","column-gap","row-gap"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid"},"grid-area":{syntax:"<grid-line> [ / <grid-line> ]{0,3}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:["grid-row-start","grid-column-start","grid-row-end","grid-column-end"],appliesto:"gridItemsAndBoxesWithinGridContainer",computed:["grid-row-start","grid-column-start","grid-row-end","grid-column-end"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-area"},"grid-auto-columns":{syntax:"<track-size>+",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridContainers",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-auto-columns"},"grid-auto-flow":{syntax:"[ row | column ] || dense",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"row",appliesto:"gridContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-auto-flow"},"grid-auto-rows":{syntax:"<track-size>+",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridContainers",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-auto-rows"},"grid-column":{syntax:"<grid-line> [ / <grid-line> ]?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:["grid-column-start","grid-column-end"],appliesto:"gridItemsAndBoxesWithinGridContainer",computed:["grid-column-start","grid-column-end"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-column"},"grid-column-end":{syntax:"<grid-line>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridItemsAndBoxesWithinGridContainer",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-column-end"},"grid-column-gap":{syntax:"<length-percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"0",appliesto:"gridContainers",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/column-gap"},"grid-column-start":{syntax:"<grid-line>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridItemsAndBoxesWithinGridContainer",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-column-start"},"grid-gap":{syntax:"<'grid-row-gap'> <'grid-column-gap'>?",media:"visual",inherited:!1,animationType:["grid-row-gap","grid-column-gap"],percentages:"no",groups:["CSS Grid Layout"],initial:["grid-row-gap","grid-column-gap"],appliesto:"gridContainers",computed:["grid-row-gap","grid-column-gap"],order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/gap"},"grid-row":{syntax:"<grid-line> [ / <grid-line> ]?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:["grid-row-start","grid-row-end"],appliesto:"gridItemsAndBoxesWithinGridContainer",computed:["grid-row-start","grid-row-end"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-row"},"grid-row-end":{syntax:"<grid-line>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridItemsAndBoxesWithinGridContainer",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-row-end"},"grid-row-gap":{syntax:"<length-percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"0",appliesto:"gridContainers",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/row-gap"},"grid-row-start":{syntax:"<grid-line>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"auto",appliesto:"gridItemsAndBoxesWithinGridContainer",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-row-start"},"grid-template":{syntax:"none | [ <'grid-template-rows'> / <'grid-template-columns'> ] | [ <line-names>? <string> <track-size>? <line-names>? ]+ [ / <explicit-track-list> ]?",media:"visual",inherited:!1,animationType:"discrete",percentages:["grid-template-columns","grid-template-rows"],groups:["CSS Grid Layout"],initial:["grid-template-columns","grid-template-rows","grid-template-areas"],appliesto:"gridContainers",computed:["grid-template-columns","grid-template-rows","grid-template-areas"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-template"},"grid-template-areas":{syntax:"none | <string>+",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"none",appliesto:"gridContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-template-areas"},"grid-template-columns":{syntax:"none | <track-list> | <auto-track-list> | subgrid <line-name-list>?",media:"visual",inherited:!1,animationType:"simpleListOfLpcDifferenceLpc",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"none",appliesto:"gridContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-template-columns"},"grid-template-rows":{syntax:"none | <track-list> | <auto-track-list> | subgrid <line-name-list>?",media:"visual",inherited:!1,animationType:"simpleListOfLpcDifferenceLpc",percentages:"referToDimensionOfContentArea",groups:["CSS Grid Layout"],initial:"none",appliesto:"gridContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/grid-template-rows"},"hanging-punctuation":{syntax:"none | [ first || [ force-end | allow-end ] || last ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/hanging-punctuation"},height:{syntax:"auto | <length> | <percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"regardingHeightOfGeneratedBoxContainingBlockPercentagesRelativeToContainingBlock",groups:["CSS Box Model"],initial:"auto",appliesto:"allElementsButNonReplacedAndTableColumns",computed:"percentageAutoOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/height"},hyphens:{syntax:"none | manual | auto",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"manual",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/hyphens"},"image-orientation":{syntax:"from-image | <angle> | [ <angle>? flip ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Images"],initial:"from-image",appliesto:"allElements",computed:"angleRoundedToNextQuarter",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/image-orientation"},"image-rendering":{syntax:"auto | crisp-edges | pixelated",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Images"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/image-rendering"},"image-resolution":{syntax:"[ from-image || <resolution> ] && snap?",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Images"],initial:"1dppx",appliesto:"allElements",computed:"asSpecifiedWithExceptionOfResolution",order:"uniqueOrder",status:"experimental"},"ime-mode":{syntax:"auto | normal | active | inactive | disabled",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"textFields",computed:"asSpecified",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/ime-mode"},"initial-letter":{syntax:"normal | [ <number> <integer>? ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Inline"],initial:"normal",appliesto:"firstLetterPseudoElementsAndInlineLevelFirstChildren",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/initial-letter"},"initial-letter-align":{syntax:"[ auto | alphabetic | hanging | ideographic ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Inline"],initial:"auto",appliesto:"firstLetterPseudoElementsAndInlineLevelFirstChildren",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/initial-letter-align"},"inline-size":{syntax:"<'width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"inlineSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"sameAsWidthAndHeight",computed:"sameAsWidthAndHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inline-size"},inset:{syntax:"<'top'>{1,4}",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalHeightOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset"},"inset-block":{syntax:"<'top'>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalHeightOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-block"},"inset-block-end":{syntax:"<'top'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalHeightOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-block-end"},"inset-block-start":{syntax:"<'top'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalHeightOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-block-start"},"inset-inline":{syntax:"<'top'>{1,2}",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-inline"},"inset-inline-end":{syntax:"<'top'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-inline-end"},"inset-inline-start":{syntax:"<'top'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"auto",appliesto:"positionedElements",computed:"sameAsBoxOffsets",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/inset-inline-start"},isolation:{syntax:"auto | isolate",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Compositing and Blending"],initial:"auto",appliesto:"allElementsSVGContainerGraphicsAndGraphicsReferencingElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/isolation"},"justify-content":{syntax:"normal | <content-distribution> | <overflow-position>? [ <content-position> | left | right ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"normal",appliesto:"flexContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/justify-content"},"justify-items":{syntax:"normal | stretch | <baseline-position> | <overflow-position>? [ <self-position> | left | right ] | legacy | legacy && [ left | right | center ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"legacy",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/justify-items"},"justify-self":{syntax:"auto | normal | stretch | <baseline-position> | <overflow-position>? [ <self-position> | left | right ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"auto",appliesto:"blockLevelBoxesAndAbsolutelyPositionedBoxesAndGridItems",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/justify-self"},"justify-tracks":{syntax:"[ normal | <content-distribution> | <overflow-position>? [ <content-position> | left | right ] ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"normal",appliesto:"gridContainersWithMasonryLayoutInTheirInlineAxis",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/justify-tracks"},left:{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Positioning"],initial:"auto",appliesto:"positionedElements",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/left"},"letter-spacing":{syntax:"normal | <length>",media:"visual",inherited:!0,animationType:"length",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"allElements",computed:"optimumValueOfAbsoluteLengthOrNormal",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/letter-spacing"},"line-break":{syntax:"auto | loose | normal | strict | anywhere",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/line-break"},"line-clamp":{syntax:"none | <integer>",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["CSS Overflow"],initial:"none",appliesto:"blockContainersExceptMultiColumnContainers",computed:"asSpecified",order:"perGrammar",status:"experimental"},"line-height":{syntax:"normal | <number> | <length> | <percentage>",media:"visual",inherited:!0,animationType:"numberOrLength",percentages:"referToElementFontSize",groups:["CSS Fonts"],initial:"normal",appliesto:"allElements",computed:"absoluteLengthOrAsSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/line-height"},"line-height-step":{syntax:"<length>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fonts"],initial:"0",appliesto:"blockContainers",computed:"absoluteLength",order:"perGrammar",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/line-height-step"},"list-style":{syntax:"<'list-style-type'> || <'list-style-position'> || <'list-style-image'>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Lists and Counters"],initial:["list-style-type","list-style-position","list-style-image"],appliesto:"listItems",computed:["list-style-image","list-style-position","list-style-type"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/list-style"},"list-style-image":{syntax:"<url> | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Lists and Counters"],initial:"none",appliesto:"listItems",computed:"noneOrImageWithAbsoluteURI",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/list-style-image"},"list-style-position":{syntax:"inside | outside",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Lists and Counters"],initial:"outside",appliesto:"listItems",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/list-style-position"},"list-style-type":{syntax:"<counter-style> | <string> | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Lists and Counters"],initial:"disc",appliesto:"listItems",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/list-style-type"},margin:{syntax:"[ <length> | <percentage> | auto ]{1,4}",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:["margin-bottom","margin-left","margin-right","margin-top"],appliesto:"allElementsExceptTableDisplayTypes",computed:["margin-bottom","margin-left","margin-right","margin-top"],order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin"},"margin-block":{syntax:"<'margin-left'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-block"},"margin-block-end":{syntax:"<'margin-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-block-end"},"margin-block-start":{syntax:"<'margin-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-block-start"},"margin-bottom":{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-bottom"},"margin-inline":{syntax:"<'margin-left'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-inline"},"margin-inline-end":{syntax:"<'margin-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-inline-end"},"margin-inline-start":{syntax:"<'margin-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"dependsOnLayoutModel",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsMargin",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-inline-start"},"margin-left":{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-left"},"margin-right":{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-right"},"margin-top":{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-top"},"margin-trim":{syntax:"none | in-flow | all",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"none",appliesto:"blockContainersAndMultiColumnContainers",computed:"asSpecified",order:"perGrammar",alsoAppliesTo:["::first-letter","::first-line"],status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/margin-trim"},mask:{syntax:"<mask-layer>#",media:"visual",inherited:!1,animationType:["mask-image","mask-mode","mask-repeat","mask-position","mask-clip","mask-origin","mask-size","mask-composite"],percentages:["mask-position"],groups:["CSS Masking"],initial:["mask-image","mask-mode","mask-repeat","mask-position","mask-clip","mask-origin","mask-size","mask-composite"],appliesto:"allElementsSVGContainerElements",computed:["mask-image","mask-mode","mask-repeat","mask-position","mask-clip","mask-origin","mask-size","mask-composite"],order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask"},"mask-border":{syntax:"<'mask-border-source'> || <'mask-border-slice'> [ / <'mask-border-width'>? [ / <'mask-border-outset'> ]? ]? || <'mask-border-repeat'> || <'mask-border-mode'>",media:"visual",inherited:!1,animationType:["mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width"],percentages:["mask-border-slice","mask-border-width"],groups:["CSS Masking"],initial:["mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width"],appliesto:"allElementsSVGContainerElements",computed:["mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width"],order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border"},"mask-border-mode":{syntax:"luminance | alpha",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"alpha",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-mode"},"mask-border-outset":{syntax:"[ <length> | <number> ]{1,4}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"0",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-outset"},"mask-border-repeat":{syntax:"[ stretch | repeat | round | space ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"stretch",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-repeat"},"mask-border-slice":{syntax:"<number-percentage>{1,4} fill?",media:"visual",inherited:!1,animationType:"discrete",percentages:"referToSizeOfMaskBorderImage",groups:["CSS Masking"],initial:"0",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-slice"},"mask-border-source":{syntax:"none | <image>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"none",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedURLsAbsolute",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-source"},"mask-border-width":{syntax:"[ <length-percentage> | <number> | auto ]{1,4}",media:"visual",inherited:!1,animationType:"discrete",percentages:"relativeToMaskBorderImageArea",groups:["CSS Masking"],initial:"auto",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-border-width"},"mask-clip":{syntax:"[ <geometry-box> | no-clip ]#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"border-box",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-clip"},"mask-composite":{syntax:"<compositing-operator>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"add",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-composite"},"mask-image":{syntax:"<mask-reference>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"none",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedURLsAbsolute",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-image"},"mask-mode":{syntax:"<masking-mode>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"match-source",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-mode"},"mask-origin":{syntax:"<geometry-box>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"border-box",appliesto:"allElementsSVGContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-origin"},"mask-position":{syntax:"<position>#",media:"visual",inherited:!1,animationType:"repeatableListOfSimpleListOfLpc",percentages:"referToSizeOfMaskPaintingArea",groups:["CSS Masking"],initial:"center",appliesto:"allElementsSVGContainerElements",computed:"consistsOfTwoKeywordsForOriginAndOffsets",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-position"},"mask-repeat":{syntax:"<repeat-style>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"no-repeat",appliesto:"allElementsSVGContainerElements",computed:"consistsOfTwoDimensionKeywords",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-repeat"},"mask-size":{syntax:"<bg-size>#",media:"visual",inherited:!1,animationType:"repeatableListOfSimpleListOfLpc",percentages:"no",groups:["CSS Masking"],initial:"auto",appliesto:"allElementsSVGContainerElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-size"},"mask-type":{syntax:"luminance | alpha",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Masking"],initial:"luminance",appliesto:"maskElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mask-type"},"masonry-auto-flow":{syntax:"[ pack | next ] || [ definite-first | ordered ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Grid Layout"],initial:"pack",appliesto:"gridContainersWithMasonryLayout",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/masonry-auto-flow"},"math-style":{syntax:"normal | compact",media:"visual",inherited:!0,animationType:"notAnimatable",percentages:"no",groups:["MathML"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/math-style"},"max-block-size":{syntax:"<'max-width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"blockSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsWidthAndHeight",computed:"sameAsMaxWidthAndMaxHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/max-block-size"},"max-height":{syntax:"none | <length-percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"regardingHeightOfGeneratedBoxContainingBlockPercentagesNone",groups:["CSS Box Model"],initial:"none",appliesto:"allElementsButNonReplacedAndTableColumns",computed:"percentageAsSpecifiedAbsoluteLengthOrNone",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/max-height"},"max-inline-size":{syntax:"<'max-width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"inlineSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsWidthAndHeight",computed:"sameAsMaxWidthAndMaxHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/max-inline-size"},"max-lines":{syntax:"none | <integer>",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["CSS Overflow"],initial:"none",appliesto:"blockContainersExceptMultiColumnContainers",computed:"asSpecified",order:"perGrammar",status:"experimental"},"max-width":{syntax:"none | <length-percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"none",appliesto:"allElementsButNonReplacedAndTableRows",computed:"percentageAsSpecifiedAbsoluteLengthOrNone",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/max-width"},"min-block-size":{syntax:"<'min-width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"blockSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsWidthAndHeight",computed:"sameAsMinWidthAndMinHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/min-block-size"},"min-height":{syntax:"auto | <length> | <percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"regardingHeightOfGeneratedBoxContainingBlockPercentages0",groups:["CSS Box Model"],initial:"auto",appliesto:"allElementsButNonReplacedAndTableColumns",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/min-height"},"min-inline-size":{syntax:"<'min-width'>",media:"visual",inherited:!1,animationType:"lpc",percentages:"inlineSizeOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"sameAsWidthAndHeight",computed:"sameAsMinWidthAndMinHeight",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/min-inline-size"},"min-width":{syntax:"auto | <length> | <percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"auto",appliesto:"allElementsButNonReplacedAndTableRows",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/min-width"},"mix-blend-mode":{syntax:"<blend-mode>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Compositing and Blending"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/mix-blend-mode"},"object-fit":{syntax:"fill | contain | cover | none | scale-down",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Images"],initial:"fill",appliesto:"replacedElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/object-fit"},"object-position":{syntax:"<position>",media:"visual",inherited:!0,animationType:"repeatableListOfSimpleListOfLpc",percentages:"referToWidthAndHeightOfElement",groups:["CSS Images"],initial:"50% 50%",appliesto:"replacedElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/object-position"},offset:{syntax:"[ <'offset-position'>? [ <'offset-path'> [ <'offset-distance'> || <'offset-rotate'> ]? ]? ]! [ / <'offset-anchor'> ]?",media:"visual",inherited:!1,animationType:["offset-position","offset-path","offset-distance","offset-anchor","offset-rotate"],percentages:["offset-position","offset-distance","offset-anchor"],groups:["CSS Motion Path"],initial:["offset-position","offset-path","offset-distance","offset-anchor","offset-rotate"],appliesto:"transformableElements",computed:["offset-position","offset-path","offset-distance","offset-anchor","offset-rotate"],order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/offset"},"offset-anchor":{syntax:"auto | <position>",media:"visual",inherited:!1,animationType:"position",percentages:"relativeToWidthAndHeight",groups:["CSS Motion Path"],initial:"auto",appliesto:"transformableElements",computed:"forLengthAbsoluteValueOtherwisePercentage",order:"perGrammar",status:"standard"},"offset-distance":{syntax:"<length-percentage>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToTotalPathLength",groups:["CSS Motion Path"],initial:"0",appliesto:"transformableElements",computed:"forLengthAbsoluteValueOtherwisePercentage",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/offset-distance"},"offset-path":{syntax:"none | ray( [ <angle> && <size> && contain? ] ) | <path()> | <url> | [ <basic-shape> || <geometry-box> ]",media:"visual",inherited:!1,animationType:"angleOrBasicShapeOrPath",percentages:"no",groups:["CSS Motion Path"],initial:"none",appliesto:"transformableElements",computed:"asSpecified",order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/offset-path"},"offset-position":{syntax:"auto | <position>",media:"visual",inherited:!1,animationType:"position",percentages:"referToSizeOfContainingBlock",groups:["CSS Motion Path"],initial:"auto",appliesto:"transformableElements",computed:"forLengthAbsoluteValueOtherwisePercentage",order:"perGrammar",status:"experimental"},"offset-rotate":{syntax:"[ auto | reverse ] || <angle>",media:"visual",inherited:!1,animationType:"angleOrBasicShapeOrPath",percentages:"no",groups:["CSS Motion Path"],initial:"auto",appliesto:"transformableElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/offset-rotate"},opacity:{syntax:"<alpha-value>",media:"visual",inherited:!1,animationType:"number",percentages:"no",groups:["CSS Color"],initial:"1.0",appliesto:"allElements",computed:"specifiedValueClipped0To1",order:"uniqueOrder",alsoAppliesTo:["::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/opacity"},order:{syntax:"<integer>",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["CSS Flexible Box Layout"],initial:"0",appliesto:"flexItemsGridItemsAbsolutelyPositionedContainerChildren",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/order"},orphans:{syntax:"<integer>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"2",appliesto:"blockContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/orphans"},outline:{syntax:"[ <'outline-color'> || <'outline-style'> || <'outline-width'> ]",media:["visual","interactive"],inherited:!1,animationType:["outline-color","outline-width","outline-style"],percentages:"no",groups:["CSS Basic User Interface"],initial:["outline-color","outline-style","outline-width"],appliesto:"allElements",computed:["outline-color","outline-width","outline-style"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/outline"},"outline-color":{syntax:"<color> | invert",media:["visual","interactive"],inherited:!1,animationType:"color",percentages:"no",groups:["CSS Basic User Interface"],initial:"invertOrCurrentColor",appliesto:"allElements",computed:"invertForTranslucentColorRGBAOtherwiseRGB",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/outline-color"},"outline-offset":{syntax:"<length>",media:["visual","interactive"],inherited:!1,animationType:"length",percentages:"no",groups:["CSS Basic User Interface"],initial:"0",appliesto:"allElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/outline-offset"},"outline-style":{syntax:"auto | <'border-style'>",media:["visual","interactive"],inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/outline-style"},"outline-width":{syntax:"<line-width>",media:["visual","interactive"],inherited:!1,animationType:"length",percentages:"no",groups:["CSS Basic User Interface"],initial:"medium",appliesto:"allElements",computed:"absoluteLength0ForNone",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/outline-width"},overflow:{syntax:"[ visible | hidden | clip | scroll | auto ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"visible",appliesto:"blockContainersFlexContainersGridContainers",computed:["overflow-x","overflow-y"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overflow"},"overflow-anchor":{syntax:"auto | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Anchoring"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard"},"overflow-block":{syntax:"visible | hidden | clip | scroll | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"auto",appliesto:"blockContainersFlexContainersGridContainers",computed:"asSpecifiedButVisibleOrClipReplacedToAutoOrHiddenIfOtherValueDifferent",order:"perGrammar",status:"standard"},"overflow-clip-box":{syntax:"padding-box | content-box",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Mozilla Extensions"],initial:"padding-box",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Mozilla/CSS/overflow-clip-box"},"overflow-inline":{syntax:"visible | hidden | clip | scroll | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"auto",appliesto:"blockContainersFlexContainersGridContainers",computed:"asSpecifiedButVisibleOrClipReplacedToAutoOrHiddenIfOtherValueDifferent",order:"perGrammar",status:"standard"},"overflow-wrap":{syntax:"normal | break-word | anywhere",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"nonReplacedInlineElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overflow-wrap"},"overflow-x":{syntax:"visible | hidden | clip | scroll | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"visible",appliesto:"blockContainersFlexContainersGridContainers",computed:"asSpecifiedButVisibleOrClipReplacedToAutoOrHiddenIfOtherValueDifferent",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overflow-x"},"overflow-y":{syntax:"visible | hidden | clip | scroll | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"visible",appliesto:"blockContainersFlexContainersGridContainers",computed:"asSpecifiedButVisibleOrClipReplacedToAutoOrHiddenIfOtherValueDifferent",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overflow-y"},"overscroll-behavior":{syntax:"[ contain | none | auto ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overscroll-behavior"},"overscroll-behavior-block":{syntax:"contain | none | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overscroll-behavior-block"},"overscroll-behavior-inline":{syntax:"contain | none | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overscroll-behavior-inline"},"overscroll-behavior-x":{syntax:"contain | none | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overscroll-behavior-x"},"overscroll-behavior-y":{syntax:"contain | none | auto",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Model"],initial:"auto",appliesto:"nonReplacedBlockAndInlineBlockElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overscroll-behavior-y"},padding:{syntax:"[ <length> | <percentage> ]{1,4}",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:["padding-bottom","padding-left","padding-right","padding-top"],appliesto:"allElementsExceptInternalTableDisplayTypes",computed:["padding-bottom","padding-left","padding-right","padding-top"],order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding"},"padding-block":{syntax:"<'padding-left'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-block"},"padding-block-end":{syntax:"<'padding-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-block-end"},"padding-block-start":{syntax:"<'padding-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-block-start"},"padding-bottom":{syntax:"<length> | <percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptInternalTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-bottom"},"padding-inline":{syntax:"<'padding-left'>{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-inline"},"padding-inline-end":{syntax:"<'padding-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-inline-end"},"padding-inline-start":{syntax:"<'padding-left'>",media:"visual",inherited:!1,animationType:"length",percentages:"logicalWidthOfContainingBlock",groups:["CSS Logical Properties"],initial:"0",appliesto:"allElements",computed:"asLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-inline-start"},"padding-left":{syntax:"<length> | <percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptInternalTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-left"},"padding-right":{syntax:"<length> | <percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptInternalTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-right"},"padding-top":{syntax:"<length> | <percentage>",media:"visual",inherited:!1,animationType:"length",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"0",appliesto:"allElementsExceptInternalTableDisplayTypes",computed:"percentageAsSpecifiedOrAbsoluteLength",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/padding-top"},"page-break-after":{syntax:"auto | always | avoid | left | right | recto | verso",media:["visual","paged"],inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Pages"],initial:"auto",appliesto:"blockElementsInNormalFlow",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/page-break-after"},"page-break-before":{syntax:"auto | always | avoid | left | right | recto | verso",media:["visual","paged"],inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Pages"],initial:"auto",appliesto:"blockElementsInNormalFlow",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/page-break-before"},"page-break-inside":{syntax:"auto | avoid",media:["visual","paged"],inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Pages"],initial:"auto",appliesto:"blockElementsInNormalFlow",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/page-break-inside"},"paint-order":{syntax:"normal | [ fill || stroke || markers ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"textElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/paint-order"},perspective:{syntax:"none | <length>",media:"visual",inherited:!1,animationType:"length",percentages:"no",groups:["CSS Transforms"],initial:"none",appliesto:"transformableElements",computed:"absoluteLengthOrNone",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/perspective"},"perspective-origin":{syntax:"<position>",media:"visual",inherited:!1,animationType:"simpleListOfLpc",percentages:"referToSizeOfBoundingBox",groups:["CSS Transforms"],initial:"50% 50%",appliesto:"transformableElements",computed:"forLengthAbsoluteValueOtherwisePercentage",order:"oneOrTwoValuesLengthAbsoluteKeywordsPercentages",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/perspective-origin"},"place-content":{syntax:"<'align-content'> <'justify-content'>?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:"normal",appliesto:"multilineFlexContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/place-content"},"place-items":{syntax:"<'align-items'> <'justify-items'>?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:["align-items","justify-items"],appliesto:"allElements",computed:["align-items","justify-items"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/place-items"},"place-self":{syntax:"<'align-self'> <'justify-self'>?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Box Alignment"],initial:["align-self","justify-self"],appliesto:"blockLevelBoxesAndAbsolutelyPositionedBoxesAndGridItems",computed:["align-self","justify-self"],order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/place-self"},"pointer-events":{syntax:"auto | none | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | inherit",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["Pointer Events"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/pointer-events"},position:{syntax:"static | relative | absolute | sticky | fixed",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Positioning"],initial:"static",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/position"},quotes:{syntax:"none | auto | [ <string> <string> ]+",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Generated Content"],initial:"dependsOnUserAgent",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/quotes"},resize:{syntax:"none | both | horizontal | vertical | block | inline",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"none",appliesto:"elementsWithOverflowNotVisibleAndReplacedElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/resize"},right:{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Positioning"],initial:"auto",appliesto:"positionedElements",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/right"},rotate:{syntax:"none | <angle> | [ x | y | z | <number>{3} ] && <angle>",media:"visual",inherited:!1,animationType:"transform",percentages:"no",groups:["CSS Transforms"],initial:"none",appliesto:"transformableElements",computed:"asSpecified",order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/rotate"},"row-gap":{syntax:"normal | <length-percentage>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToDimensionOfContentArea",groups:["CSS Box Alignment"],initial:"normal",appliesto:"multiColumnElementsFlexContainersGridContainers",computed:"asSpecifiedWithLengthsAbsoluteAndNormalComputingToZeroExceptMultiColumn",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/row-gap"},"ruby-align":{syntax:"start | center | space-between | space-around",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Ruby"],initial:"space-around",appliesto:"rubyBasesAnnotationsBaseAnnotationContainers",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/ruby-align"},"ruby-merge":{syntax:"separate | collapse | auto",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Ruby"],initial:"separate",appliesto:"rubyAnnotationsContainers",computed:"asSpecified",order:"uniqueOrder",status:"experimental"},"ruby-position":{syntax:"over | under | inter-character",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Ruby"],initial:"over",appliesto:"rubyAnnotationsContainers",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/ruby-position"},scale:{syntax:"none | <number>{1,3}",media:"visual",inherited:!1,animationType:"transform",percentages:"no",groups:["CSS Transforms"],initial:"none",appliesto:"transformableElements",computed:"asSpecified",order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scale"},"scrollbar-color":{syntax:"auto | dark | light | <color>{2}",media:"visual",inherited:!0,animationType:"color",percentages:"no",groups:["CSS Scrollbars"],initial:"auto",appliesto:"scrollingBoxes",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scrollbar-color"},"scrollbar-gutter":{syntax:"auto | [ stable | always ] && both? && force?",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Overflow"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scrollbar-gutter"},"scrollbar-width":{syntax:"auto | thin | none",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scrollbars"],initial:"auto",appliesto:"scrollingBoxes",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scrollbar-width"},"scroll-behavior":{syntax:"auto | smooth",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSSOM View"],initial:"auto",appliesto:"scrollingBoxes",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-behavior"},"scroll-margin":{syntax:"<length>{1,4}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin"},"scroll-margin-block":{syntax:"<length>{1,2}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-block"},"scroll-margin-block-start":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-block-start"},"scroll-margin-block-end":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-block-end"},"scroll-margin-bottom":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-bottom"},"scroll-margin-inline":{syntax:"<length>{1,2}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-inline"},"scroll-margin-inline-start":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-inline-start"},"scroll-margin-inline-end":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-inline-end"},"scroll-margin-left":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-left"},"scroll-margin-right":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-right"},"scroll-margin-top":{syntax:"<length>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"no",groups:["CSS Scroll Snap"],initial:"0",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-margin-top"},"scroll-padding":{syntax:"[ auto | <length-percentage> ]{1,4}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding"},"scroll-padding-block":{syntax:"[ auto | <length-percentage> ]{1,2}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-block"},"scroll-padding-block-start":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-block-start"},"scroll-padding-block-end":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-block-end"},"scroll-padding-bottom":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-bottom"},"scroll-padding-inline":{syntax:"[ auto | <length-percentage> ]{1,2}",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-inline"},"scroll-padding-inline-start":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-inline-start"},"scroll-padding-inline-end":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-inline-end"},"scroll-padding-left":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-left"},"scroll-padding-right":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-right"},"scroll-padding-top":{syntax:"auto | <length-percentage>",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"relativeToTheScrollContainersScrollport",groups:["CSS Scroll Snap"],initial:"auto",appliesto:"scrollContainers",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-padding-top"},"scroll-snap-align":{syntax:"[ none | start | end | center ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Snap"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-align"},"scroll-snap-coordinate":{syntax:"none | <position>#",media:"interactive",inherited:!1,animationType:"position",percentages:"referToBorderBox",groups:["CSS Scroll Snap"],initial:"none",appliesto:"allElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-coordinate"},"scroll-snap-destination":{syntax:"<position>",media:"interactive",inherited:!1,animationType:"position",percentages:"relativeToScrollContainerPaddingBoxAxis",groups:["CSS Scroll Snap"],initial:"0px 0px",appliesto:"scrollContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-destination"},"scroll-snap-points-x":{syntax:"none | repeat( <length-percentage> )",media:"interactive",inherited:!1,animationType:"discrete",percentages:"relativeToScrollContainerPaddingBoxAxis",groups:["CSS Scroll Snap"],initial:"none",appliesto:"scrollContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-points-x"},"scroll-snap-points-y":{syntax:"none | repeat( <length-percentage> )",media:"interactive",inherited:!1,animationType:"discrete",percentages:"relativeToScrollContainerPaddingBoxAxis",groups:["CSS Scroll Snap"],initial:"none",appliesto:"scrollContainers",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-points-y"},"scroll-snap-stop":{syntax:"normal | always",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Snap"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-stop"},"scroll-snap-type":{syntax:"none | [ x | y | block | inline | both ] [ mandatory | proximity ]?",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Snap"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-type"},"scroll-snap-type-x":{syntax:"none | mandatory | proximity",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Snap"],initial:"none",appliesto:"scrollContainers",computed:"asSpecified",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-type-x"},"scroll-snap-type-y":{syntax:"none | mandatory | proximity",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Scroll Snap"],initial:"none",appliesto:"scrollContainers",computed:"asSpecified",order:"uniqueOrder",status:"obsolete",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/scroll-snap-type-y"},"shape-image-threshold":{syntax:"<alpha-value>",media:"visual",inherited:!1,animationType:"number",percentages:"no",groups:["CSS Shapes"],initial:"0.0",appliesto:"floats",computed:"specifiedValueNumberClipped0To1",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/shape-image-threshold"},"shape-margin":{syntax:"<length-percentage>",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Shapes"],initial:"0",appliesto:"floats",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/shape-margin"},"shape-outside":{syntax:"none | <shape-box> || <basic-shape> | <image>",media:"visual",inherited:!1,animationType:"basicShapeOtherwiseNo",percentages:"no",groups:["CSS Shapes"],initial:"none",appliesto:"floats",computed:"asDefinedForBasicShapeWithAbsoluteURIOtherwiseAsSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/shape-outside"},"tab-size":{syntax:"<integer> | <length>",media:"visual",inherited:!0,animationType:"length",percentages:"no",groups:["CSS Text"],initial:"8",appliesto:"blockContainers",computed:"specifiedIntegerOrAbsoluteLength",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/tab-size"},"table-layout":{syntax:"auto | fixed",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Table"],initial:"auto",appliesto:"tableElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/table-layout"},"text-align":{syntax:"start | end | left | right | center | justify | match-parent",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"startOrNamelessValueIfLTRRightIfRTL",appliesto:"blockContainers",computed:"asSpecifiedExceptMatchParent",order:"orderOfAppearance",alsoAppliesTo:["::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-align"},"text-align-last":{syntax:"auto | start | end | left | right | center | justify",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"auto",appliesto:"blockContainers",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-align-last"},"text-combine-upright":{syntax:"none | all | [ digits <integer>? ]",media:"visual",inherited:!0,animationType:"notAnimatable",percentages:"no",groups:["CSS Writing Modes"],initial:"none",appliesto:"nonReplacedInlineElements",computed:"keywordPlusIntegerIfDigits",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-combine-upright"},"text-decoration":{syntax:"<'text-decoration-line'> || <'text-decoration-style'> || <'text-decoration-color'> || <'text-decoration-thickness'>",media:"visual",inherited:!1,animationType:["text-decoration-color","text-decoration-style","text-decoration-line","text-decoration-thickness"],percentages:"no",groups:["CSS Text Decoration"],initial:["text-decoration-color","text-decoration-style","text-decoration-line"],appliesto:"allElements",computed:["text-decoration-line","text-decoration-style","text-decoration-color","text-decoration-thickness"],order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration"},"text-decoration-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Text Decoration"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-color"},"text-decoration-line":{syntax:"none | [ underline || overline || line-through || blink ] | spelling-error | grammar-error",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-line"},"text-decoration-skip":{syntax:"none | [ objects || [ spaces | [ leading-spaces || trailing-spaces ] ] || edges || box-decoration ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"objects",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-skip"},"text-decoration-skip-ink":{syntax:"auto | all | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-skip-ink"},"text-decoration-style":{syntax:"solid | double | dotted | dashed | wavy",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"solid",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-style"},"text-decoration-thickness":{syntax:"auto | from-font | <length> | <percentage> ",media:"visual",inherited:!1,animationType:"byComputedValueType",percentages:"referToElementFontSize",groups:["CSS Text Decoration"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-decoration-thickness"},"text-emphasis":{syntax:"<'text-emphasis-style'> || <'text-emphasis-color'>",media:"visual",inherited:!1,animationType:["text-emphasis-color","text-emphasis-style"],percentages:"no",groups:["CSS Text Decoration"],initial:["text-emphasis-style","text-emphasis-color"],appliesto:"allElements",computed:["text-emphasis-style","text-emphasis-color"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-emphasis"},"text-emphasis-color":{syntax:"<color>",media:"visual",inherited:!1,animationType:"color",percentages:"no",groups:["CSS Text Decoration"],initial:"currentcolor",appliesto:"allElements",computed:"computedColor",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-emphasis-color"},"text-emphasis-position":{syntax:"[ over | under ] && [ right | left ]",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"over right",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-emphasis-position"},"text-emphasis-style":{syntax:"none | [ [ filled | open ] || [ dot | circle | double-circle | triangle | sesame ] ] | <string>",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-emphasis-style"},"text-indent":{syntax:"<length-percentage> && hanging? && each-line?",media:"visual",inherited:!0,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Text"],initial:"0",appliesto:"blockContainers",computed:"percentageOrAbsoluteLengthPlusKeywords",order:"lengthOrPercentageBeforeKeywords",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-indent"},"text-justify":{syntax:"auto | inter-character | inter-word | none",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"auto",appliesto:"inlineLevelAndTableCellElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-justify"},"text-orientation":{syntax:"mixed | upright | sideways",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Writing Modes"],initial:"mixed",appliesto:"allElementsExceptTableRowGroupsRowsColumnGroupsAndColumns",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-orientation"},"text-overflow":{syntax:"[ clip | ellipsis | <string> ]{1,2}",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"clip",appliesto:"blockContainerElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-overflow"},"text-rendering":{syntax:"auto | optimizeSpeed | optimizeLegibility | geometricPrecision",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Miscellaneous"],initial:"auto",appliesto:"textElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-rendering"},"text-shadow":{syntax:"none | <shadow-t>#",media:"visual",inherited:!0,animationType:"shadowList",percentages:"no",groups:["CSS Text Decoration"],initial:"none",appliesto:"allElements",computed:"colorPlusThreeAbsoluteLengths",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-shadow"},"text-size-adjust":{syntax:"none | auto | <percentage>",media:"visual",inherited:!0,animationType:"discrete",percentages:"referToSizeOfFont",groups:["CSS Text"],initial:"autoForSmartphoneBrowsersSupportingInflation",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"experimental",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-size-adjust"},"text-transform":{syntax:"none | capitalize | uppercase | lowercase | full-width | full-size-kana",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"none",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-transform"},"text-underline-offset":{syntax:"auto | <length> | <percentage> ",media:"visual",inherited:!0,animationType:"byComputedValueType",percentages:"referToElementFontSize",groups:["CSS Text Decoration"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-underline-offset"},"text-underline-position":{syntax:"auto | from-font | [ under || [ left | right ] ]",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text Decoration"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/text-underline-position"},top:{syntax:"<length> | <percentage> | auto",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToContainingBlockHeight",groups:["CSS Positioning"],initial:"auto",appliesto:"positionedElements",computed:"lengthAbsolutePercentageAsSpecifiedOtherwiseAuto",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/top"},"touch-action":{syntax:"auto | none | [ [ pan-x | pan-left | pan-right ] || [ pan-y | pan-up | pan-down ] || pinch-zoom ] | manipulation",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["Pointer Events"],initial:"auto",appliesto:"allElementsExceptNonReplacedInlineElementsTableRowsColumnsRowColumnGroups",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/touch-action"},transform:{syntax:"none | <transform-list>",media:"visual",inherited:!1,animationType:"transform",percentages:"referToSizeOfBoundingBox",groups:["CSS Transforms"],initial:"none",appliesto:"transformableElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transform"},"transform-box":{syntax:"content-box | border-box | fill-box | stroke-box | view-box",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transforms"],initial:"view-box",appliesto:"transformableElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transform-box"},"transform-origin":{syntax:"[ <length-percentage> | left | center | right | top | bottom ] | [ [ <length-percentage> | left | center | right ] && [ <length-percentage> | top | center | bottom ] ] <length>?",media:"visual",inherited:!1,animationType:"simpleListOfLpc",percentages:"referToSizeOfBoundingBox",groups:["CSS Transforms"],initial:"50% 50% 0",appliesto:"transformableElements",computed:"forLengthAbsoluteValueOtherwisePercentage",order:"oneOrTwoValuesLengthAbsoluteKeywordsPercentages",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transform-origin"},"transform-style":{syntax:"flat | preserve-3d",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transforms"],initial:"flat",appliesto:"transformableElements",computed:"asSpecified",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transform-style"},transition:{syntax:"<single-transition>#",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transitions"],initial:["transition-delay","transition-duration","transition-property","transition-timing-function"],appliesto:"allElementsAndPseudos",computed:["transition-delay","transition-duration","transition-property","transition-timing-function"],order:"orderOfAppearance",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transition"},"transition-delay":{syntax:"<time>#",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transitions"],initial:"0s",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transition-delay"},"transition-duration":{syntax:"<time>#",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transitions"],initial:"0s",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transition-duration"},"transition-property":{syntax:"none | <single-transition-property>#",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transitions"],initial:"all",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transition-property"},"transition-timing-function":{syntax:"<timing-function>#",media:"interactive",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Transitions"],initial:"ease",appliesto:"allElementsAndPseudos",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/transition-timing-function"},translate:{syntax:"none | <length-percentage> [ <length-percentage> <length>? ]?",media:"visual",inherited:!1,animationType:"transform",percentages:"referToSizeOfBoundingBox",groups:["CSS Transforms"],initial:"none",appliesto:"transformableElements",computed:"asSpecifiedRelativeToAbsoluteLengths",order:"perGrammar",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/translate"},"unicode-bidi":{syntax:"normal | embed | isolate | bidi-override | isolate-override | plaintext",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Writing Modes"],initial:"normal",appliesto:"allElementsSomeValuesNoEffectOnNonInlineElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/unicode-bidi"},"user-select":{syntax:"auto | text | none | contain | all",media:"visual",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Basic User Interface"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/user-select"},"vertical-align":{syntax:"baseline | sub | super | text-top | text-bottom | middle | top | bottom | <percentage> | <length>",media:"visual",inherited:!1,animationType:"length",percentages:"referToLineHeight",groups:["CSS Table"],initial:"baseline",appliesto:"inlineLevelAndTableCellElements",computed:"absoluteLengthOrKeyword",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/vertical-align"},visibility:{syntax:"visible | hidden | collapse",media:"visual",inherited:!0,animationType:"visibility",percentages:"no",groups:["CSS Box Model"],initial:"visible",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/visibility"},"white-space":{syntax:"normal | pre | nowrap | pre-wrap | pre-line | break-spaces",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/white-space"},widows:{syntax:"<integer>",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Fragmentation"],initial:"2",appliesto:"blockContainerElements",computed:"asSpecified",order:"perGrammar",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/widows"},width:{syntax:"auto | <length> | <percentage> | min-content | max-content | fit-content(<length-percentage>)",media:"visual",inherited:!1,animationType:"lpc",percentages:"referToWidthOfContainingBlock",groups:["CSS Box Model"],initial:"auto",appliesto:"allElementsButNonReplacedAndTableRows",computed:"percentageAutoOrAbsoluteLength",order:"lengthOrPercentageBeforeKeywordIfBothPresent",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/width"},"will-change":{syntax:"auto | <animateable-feature>#",media:"all",inherited:!1,animationType:"discrete",percentages:"no",groups:["CSS Will Change"],initial:"auto",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/will-change"},"word-break":{syntax:"normal | break-all | keep-all | break-word",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/word-break"},"word-spacing":{syntax:"normal | <length-percentage>",media:"visual",inherited:!0,animationType:"length",percentages:"referToWidthOfAffectedGlyph",groups:["CSS Text"],initial:"normal",appliesto:"allElements",computed:"optimumMinAndMaxValueOfAbsoluteLengthPercentageOrNormal",order:"uniqueOrder",alsoAppliesTo:["::first-letter","::first-line","::placeholder"],status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/word-spacing"},"word-wrap":{syntax:"normal | break-word",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Text"],initial:"normal",appliesto:"nonReplacedInlineElements",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/overflow-wrap"},"writing-mode":{syntax:"horizontal-tb | vertical-rl | vertical-lr | sideways-rl | sideways-lr",media:"visual",inherited:!0,animationType:"discrete",percentages:"no",groups:["CSS Writing Modes"],initial:"horizontal-tb",appliesto:"allElementsExceptTableRowColumnGroupsTableRowsColumns",computed:"asSpecified",order:"uniqueOrder",status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/writing-mode"},"z-index":{syntax:"auto | <integer>",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["CSS Positioning"],initial:"auto",appliesto:"positionedElements",computed:"asSpecified",order:"uniqueOrder",stacking:!0,status:"standard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/z-index"},zoom:{syntax:"normal | reset | <number> | <percentage>",media:"visual",inherited:!1,animationType:"integer",percentages:"no",groups:["Microsoft Extensions"],initial:"normal",appliesto:"allElements",computed:"asSpecified",order:"uniqueOrder",status:"nonstandard",mdn_url:"https://developer.mozilla.org/docs/Web/CSS/zoom"}}});var Ok=ot((dW,pN)=>{pN.exports={"absolute-size":{syntax:"xx-small | x-small | small | medium | large | x-large | xx-large | xxx-large"},"alpha-value":{syntax:"<number> | <percentage>"},"angle-percentage":{syntax:"<angle> | <percentage>"},"angular-color-hint":{syntax:"<angle-percentage>"},"angular-color-stop":{syntax:"<color> && <color-stop-angle>?"},"angular-color-stop-list":{syntax:"[ <angular-color-stop> [, <angular-color-hint>]? ]# , <angular-color-stop>"},"animateable-feature":{syntax:"scroll-position | contents | <custom-ident>"},attachment:{syntax:"scroll | fixed | local"},"attr()":{syntax:"attr( <attr-name> <type-or-unit>? [, <attr-fallback> ]? )"},"attr-matcher":{syntax:"[ '~' | '|' | '^' | '$' | '*' ]? '='"},"attr-modifier":{syntax:"i | s"},"attribute-selector":{syntax:"'[' <wq-name> ']' | '[' <wq-name> <attr-matcher> [ <string-token> | <ident-token> ] <attr-modifier>? ']'"},"auto-repeat":{syntax:"repeat( [ auto-fill | auto-fit ] , [ <line-names>? <fixed-size> ]+ <line-names>? )"},"auto-track-list":{syntax:`[ <line-names>? [ <fixed-size> | <fixed-repeat> ] ]* <line-names>? <auto-repeat>
[ <line-names>? [ <fixed-size> | <fixed-repeat> ] ]* <line-names>?`},"baseline-position":{syntax:"[ first | last ]? baseline"},"basic-shape":{syntax:"<inset()> | <circle()> | <ellipse()> | <polygon()> | <path()>"},"bg-image":{syntax:"none | <image>"},"bg-layer":{syntax:"<bg-image> || <bg-position> [ / <bg-size> ]? || <repeat-style> || <attachment> || <box> || <box>"},"bg-position":{syntax:"[ [ left | center | right | top | bottom | <length-percentage> ] | [ left | center | right | <length-percentage> ] [ top | center | bottom | <length-percentage> ] | [ center | [ left | right ] <length-percentage>? ] && [ center | [ top | bottom ] <length-percentage>? ] ]"},"bg-size":{syntax:"[ <length-percentage> | auto ]{1,2} | cover | contain"},"blur()":{syntax:"blur( <length> )"},"blend-mode":{syntax:"normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity"},box:{syntax:"border-box | padding-box | content-box"},"brightness()":{syntax:"brightness( <number-percentage> )"},"calc()":{syntax:"calc( <calc-sum> )"},"calc-sum":{syntax:"<calc-product> [ [ '+' | '-' ] <calc-product> ]*"},"calc-product":{syntax:"<calc-value> [ '*' <calc-value> | '/' <number> ]*"},"calc-value":{syntax:"<number> | <dimension> | <percentage> | ( <calc-sum> )"},"cf-final-image":{syntax:"<image> | <color>"},"cf-mixing-image":{syntax:"<percentage>? && <image>"},"circle()":{syntax:"circle( [ <shape-radius> ]? [ at <position> ]? )"},"clamp()":{syntax:"clamp( <calc-sum>#{3} )"},"class-selector":{syntax:"'.' <ident-token>"},"clip-source":{syntax:"<url>"},color:{syntax:"<rgb()> | <rgba()> | <hsl()> | <hsla()> | <hex-color> | <named-color> | currentcolor | <deprecated-system-color>"},"color-stop":{syntax:"<color-stop-length> | <color-stop-angle>"},"color-stop-angle":{syntax:"<angle-percentage>{1,2}"},"color-stop-length":{syntax:"<length-percentage>{1,2}"},"color-stop-list":{syntax:"[ <linear-color-stop> [, <linear-color-hint>]? ]# , <linear-color-stop>"},combinator:{syntax:"'>' | '+' | '~' | [ '||' ]"},"common-lig-values":{syntax:"[ common-ligatures | no-common-ligatures ]"},"compat-auto":{syntax:"searchfield | textarea | push-button | slider-horizontal | checkbox | radio | square-button | menulist | listbox | meter | progress-bar | button"},"composite-style":{syntax:"clear | copy | source-over | source-in | source-out | source-atop | destination-over | destination-in | destination-out | destination-atop | xor"},"compositing-operator":{syntax:"add | subtract | intersect | exclude"},"compound-selector":{syntax:"[ <type-selector>? <subclass-selector>* [ <pseudo-element-selector> <pseudo-class-selector>* ]* ]!"},"compound-selector-list":{syntax:"<compound-selector>#"},"complex-selector":{syntax:"<compound-selector> [ <combinator>? <compound-selector> ]*"},"complex-selector-list":{syntax:"<complex-selector>#"},"conic-gradient()":{syntax:"conic-gradient( [ from <angle> ]? [ at <position> ]?, <angular-color-stop-list> )"},"contextual-alt-values":{syntax:"[ contextual | no-contextual ]"},"content-distribution":{syntax:"space-between | space-around | space-evenly | stretch"},"content-list":{syntax:"[ <string> | contents | <image> | <quote> | <target> | <leader()> ]+"},"content-position":{syntax:"center | start | end | flex-start | flex-end"},"content-replacement":{syntax:"<image>"},"contrast()":{syntax:"contrast( [ <number-percentage> ] )"},"counter()":{syntax:"counter( <custom-ident>, <counter-style>? )"},"counter-style":{syntax:"<counter-style-name> | symbols()"},"counter-style-name":{syntax:"<custom-ident>"},"counters()":{syntax:"counters( <custom-ident>, <string>, <counter-style>? )"},"cross-fade()":{syntax:"cross-fade( <cf-mixing-image> , <cf-final-image>? )"},"cubic-bezier-timing-function":{syntax:"ease | ease-in | ease-out | ease-in-out | cubic-bezier(<number [0,1]>, <number>, <number [0,1]>, <number>)"},"deprecated-system-color":{syntax:"ActiveBorder | ActiveCaption | AppWorkspace | Background | ButtonFace | ButtonHighlight | ButtonShadow | ButtonText | CaptionText | GrayText | Highlight | HighlightText | InactiveBorder | InactiveCaption | InactiveCaptionText | InfoBackground | InfoText | Menu | MenuText | Scrollbar | ThreeDDarkShadow | ThreeDFace | ThreeDHighlight | ThreeDLightShadow | ThreeDShadow | Window | WindowFrame | WindowText"},"discretionary-lig-values":{syntax:"[ discretionary-ligatures | no-discretionary-ligatures ]"},"display-box":{syntax:"contents | none"},"display-inside":{syntax:"flow | flow-root | table | flex | grid | ruby"},"display-internal":{syntax:"table-row-group | table-header-group | table-footer-group | table-row | table-cell | table-column-group | table-column | table-caption | ruby-base | ruby-text | ruby-base-container | ruby-text-container"},"display-legacy":{syntax:"inline-block | inline-list-item | inline-table | inline-flex | inline-grid"},"display-listitem":{syntax:"<display-outside>? && [ flow | flow-root ]? && list-item"},"display-outside":{syntax:"block | inline | run-in"},"drop-shadow()":{syntax:"drop-shadow( <length>{2,3} <color>? )"},"east-asian-variant-values":{syntax:"[ jis78 | jis83 | jis90 | jis04 | simplified | traditional ]"},"east-asian-width-values":{syntax:"[ full-width | proportional-width ]"},"element()":{syntax:"element( <id-selector> )"},"ellipse()":{syntax:"ellipse( [ <shape-radius>{2} ]? [ at <position> ]? )"},"ending-shape":{syntax:"circle | ellipse"},"env()":{syntax:"env( <custom-ident> , <declaration-value>? )"},"explicit-track-list":{syntax:"[ <line-names>? <track-size> ]+ <line-names>?"},"family-name":{syntax:"<string> | <custom-ident>+"},"feature-tag-value":{syntax:"<string> [ <integer> | on | off ]?"},"feature-type":{syntax:"@stylistic | @historical-forms | @styleset | @character-variant | @swash | @ornaments | @annotation"},"feature-value-block":{syntax:"<feature-type> '{' <feature-value-declaration-list> '}'"},"feature-value-block-list":{syntax:"<feature-value-block>+"},"feature-value-declaration":{syntax:"<custom-ident>: <integer>+;"},"feature-value-declaration-list":{syntax:"<feature-value-declaration>"},"feature-value-name":{syntax:"<custom-ident>"},"fill-rule":{syntax:"nonzero | evenodd"},"filter-function":{syntax:"<blur()> | <brightness()> | <contrast()> | <drop-shadow()> | <grayscale()> | <hue-rotate()> | <invert()> | <opacity()> | <saturate()> | <sepia()>"},"filter-function-list":{syntax:"[ <filter-function> | <url> ]+"},"final-bg-layer":{syntax:"<'background-color'> || <bg-image> || <bg-position> [ / <bg-size> ]? || <repeat-style> || <attachment> || <box> || <box>"},"fit-content()":{syntax:"fit-content( [ <length> | <percentage> ] )"},"fixed-breadth":{syntax:"<length-percentage>"},"fixed-repeat":{syntax:"repeat( [ <positive-integer> ] , [ <line-names>? <fixed-size> ]+ <line-names>? )"},"fixed-size":{syntax:"<fixed-breadth> | minmax( <fixed-breadth> , <track-breadth> ) | minmax( <inflexible-breadth> , <fixed-breadth> )"},"font-stretch-absolute":{syntax:"normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded | <percentage>"},"font-variant-css21":{syntax:"[ normal | small-caps ]"},"font-weight-absolute":{syntax:"normal | bold | <number [1,1000]>"},"frequency-percentage":{syntax:"<frequency> | <percentage>"},"general-enclosed":{syntax:"[ <function-token> <any-value> ) ] | ( <ident> <any-value> )"},"generic-family":{syntax:"serif | sans-serif | cursive | fantasy | monospace"},"generic-name":{syntax:"serif | sans-serif | cursive | fantasy | monospace"},"geometry-box":{syntax:"<shape-box> | fill-box | stroke-box | view-box"},gradient:{syntax:"<linear-gradient()> | <repeating-linear-gradient()> | <radial-gradient()> | <repeating-radial-gradient()> | <conic-gradient()>"},"grayscale()":{syntax:"grayscale( <number-percentage> )"},"grid-line":{syntax:"auto | <custom-ident> | [ <integer> && <custom-ident>? ] | [ span && [ <integer> || <custom-ident> ] ]"},"historical-lig-values":{syntax:"[ historical-ligatures | no-historical-ligatures ]"},"hsl()":{syntax:"hsl( <hue> <percentage> <percentage> [ / <alpha-value> ]? ) | hsl( <hue>, <percentage>, <percentage>, <alpha-value>? )"},"hsla()":{syntax:"hsla( <hue> <percentage> <percentage> [ / <alpha-value> ]? ) | hsla( <hue>, <percentage>, <percentage>, <alpha-value>? )"},hue:{syntax:"<number> | <angle>"},"hue-rotate()":{syntax:"hue-rotate( <angle> )"},"id-selector":{syntax:"<hash-token>"},image:{syntax:"<url> | <image()> | <image-set()> | <element()> | <paint()> | <cross-fade()> | <gradient>"},"image()":{syntax:"image( <image-tags>? [ <image-src>? , <color>? ]! )"},"image-set()":{syntax:"image-set( <image-set-option># )"},"image-set-option":{syntax:"[ <image> | <string> ] <resolution>"},"image-src":{syntax:"<url> | <string>"},"image-tags":{syntax:"ltr | rtl"},"inflexible-breadth":{syntax:"<length> | <percentage> | min-content | max-content | auto"},"inset()":{syntax:"inset( <length-percentage>{1,4} [ round <'border-radius'> ]? )"},"invert()":{syntax:"invert( <number-percentage> )"},"keyframes-name":{syntax:"<custom-ident> | <string>"},"keyframe-block":{syntax:`<keyframe-selector># {
  <declaration-list>
}`},"keyframe-block-list":{syntax:"<keyframe-block>+"},"keyframe-selector":{syntax:"from | to | <percentage>"},"leader()":{syntax:"leader( <leader-type> )"},"leader-type":{syntax:"dotted | solid | space | <string>"},"length-percentage":{syntax:"<length> | <percentage>"},"line-names":{syntax:"'[' <custom-ident>* ']'"},"line-name-list":{syntax:"[ <line-names> | <name-repeat> ]+"},"line-style":{syntax:"none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset"},"line-width":{syntax:"<length> | thin | medium | thick"},"linear-color-hint":{syntax:"<length-percentage>"},"linear-color-stop":{syntax:"<color> <color-stop-length>?"},"linear-gradient()":{syntax:"linear-gradient( [ <angle> | to <side-or-corner> ]? , <color-stop-list> )"},"mask-layer":{syntax:"<mask-reference> || <position> [ / <bg-size> ]? || <repeat-style> || <geometry-box> || [ <geometry-box> | no-clip ] || <compositing-operator> || <masking-mode>"},"mask-position":{syntax:"[ <length-percentage> | left | center | right ] [ <length-percentage> | top | center | bottom ]?"},"mask-reference":{syntax:"none | <image> | <mask-source>"},"mask-source":{syntax:"<url>"},"masking-mode":{syntax:"alpha | luminance | match-source"},"matrix()":{syntax:"matrix( <number>#{6} )"},"matrix3d()":{syntax:"matrix3d( <number>#{16} )"},"max()":{syntax:"max( <calc-sum># )"},"media-and":{syntax:"<media-in-parens> [ and <media-in-parens> ]+"},"media-condition":{syntax:"<media-not> | <media-and> | <media-or> | <media-in-parens>"},"media-condition-without-or":{syntax:"<media-not> | <media-and> | <media-in-parens>"},"media-feature":{syntax:"( [ <mf-plain> | <mf-boolean> | <mf-range> ] )"},"media-in-parens":{syntax:"( <media-condition> ) | <media-feature> | <general-enclosed>"},"media-not":{syntax:"not <media-in-parens>"},"media-or":{syntax:"<media-in-parens> [ or <media-in-parens> ]+"},"media-query":{syntax:"<media-condition> | [ not | only ]? <media-type> [ and <media-condition-without-or> ]?"},"media-query-list":{syntax:"<media-query>#"},"media-type":{syntax:"<ident>"},"mf-boolean":{syntax:"<mf-name>"},"mf-name":{syntax:"<ident>"},"mf-plain":{syntax:"<mf-name> : <mf-value>"},"mf-range":{syntax:`<mf-name> [ '<' | '>' ]? '='? <mf-value>
| <mf-value> [ '<' | '>' ]? '='? <mf-name>
| <mf-value> '<' '='? <mf-name> '<' '='? <mf-value>
| <mf-value> '>' '='? <mf-name> '>' '='? <mf-value>`},"mf-value":{syntax:"<number> | <dimension> | <ident> | <ratio>"},"min()":{syntax:"min( <calc-sum># )"},"minmax()":{syntax:"minmax( [ <length> | <percentage> | min-content | max-content | auto ] , [ <length> | <percentage> | <flex> | min-content | max-content | auto ] )"},"named-color":{syntax:"transparent | aliceblue | antiquewhite | aqua | aquamarine | azure | beige | bisque | black | blanchedalmond | blue | blueviolet | brown | burlywood | cadetblue | chartreuse | chocolate | coral | cornflowerblue | cornsilk | crimson | cyan | darkblue | darkcyan | darkgoldenrod | darkgray | darkgreen | darkgrey | darkkhaki | darkmagenta | darkolivegreen | darkorange | darkorchid | darkred | darksalmon | darkseagreen | darkslateblue | darkslategray | darkslategrey | darkturquoise | darkviolet | deeppink | deepskyblue | dimgray | dimgrey | dodgerblue | firebrick | floralwhite | forestgreen | fuchsia | gainsboro | ghostwhite | gold | goldenrod | gray | green | greenyellow | grey | honeydew | hotpink | indianred | indigo | ivory | khaki | lavender | lavenderblush | lawngreen | lemonchiffon | lightblue | lightcoral | lightcyan | lightgoldenrodyellow | lightgray | lightgreen | lightgrey | lightpink | lightsalmon | lightseagreen | lightskyblue | lightslategray | lightslategrey | lightsteelblue | lightyellow | lime | limegreen | linen | magenta | maroon | mediumaquamarine | mediumblue | mediumorchid | mediumpurple | mediumseagreen | mediumslateblue | mediumspringgreen | mediumturquoise | mediumvioletred | midnightblue | mintcream | mistyrose | moccasin | navajowhite | navy | oldlace | olive | olivedrab | orange | orangered | orchid | palegoldenrod | palegreen | paleturquoise | palevioletred | papayawhip | peachpuff | peru | pink | plum | powderblue | purple | rebeccapurple | red | rosybrown | royalblue | saddlebrown | salmon | sandybrown | seagreen | seashell | sienna | silver | skyblue | slateblue | slategray | slategrey | snow | springgreen | steelblue | tan | teal | thistle | tomato | turquoise | violet | wheat | white | whitesmoke | yellow | yellowgreen"},"namespace-prefix":{syntax:"<ident>"},"ns-prefix":{syntax:"[ <ident-token> | '*' ]? '|'"},"number-percentage":{syntax:"<number> | <percentage>"},"numeric-figure-values":{syntax:"[ lining-nums | oldstyle-nums ]"},"numeric-fraction-values":{syntax:"[ diagonal-fractions | stacked-fractions ]"},"numeric-spacing-values":{syntax:"[ proportional-nums | tabular-nums ]"},nth:{syntax:"<an-plus-b> | even | odd"},"opacity()":{syntax:"opacity( [ <number-percentage> ] )"},"overflow-position":{syntax:"unsafe | safe"},"outline-radius":{syntax:"<length> | <percentage>"},"page-body":{syntax:"<declaration>? [ ; <page-body> ]? | <page-margin-box> <page-body>"},"page-margin-box":{syntax:"<page-margin-box-type> '{' <declaration-list> '}'"},"page-margin-box-type":{syntax:"@top-left-corner | @top-left | @top-center | @top-right | @top-right-corner | @bottom-left-corner | @bottom-left | @bottom-center | @bottom-right | @bottom-right-corner | @left-top | @left-middle | @left-bottom | @right-top | @right-middle | @right-bottom"},"page-selector-list":{syntax:"[ <page-selector># ]?"},"page-selector":{syntax:"<pseudo-page>+ | <ident> <pseudo-page>*"},"path()":{syntax:"path( [ <fill-rule>, ]? <string> )"},"paint()":{syntax:"paint( <ident>, <declaration-value>? )"},"perspective()":{syntax:"perspective( <length> )"},"polygon()":{syntax:"polygon( <fill-rule>? , [ <length-percentage> <length-percentage> ]# )"},position:{syntax:"[ [ left | center | right ] || [ top | center | bottom ] | [ left | center | right | <length-percentage> ] [ top | center | bottom | <length-percentage> ]? | [ [ left | right ] <length-percentage> ] && [ [ top | bottom ] <length-percentage> ] ]"},"pseudo-class-selector":{syntax:"':' <ident-token> | ':' <function-token> <any-value> ')'"},"pseudo-element-selector":{syntax:"':' <pseudo-class-selector>"},"pseudo-page":{syntax:": [ left | right | first | blank ]"},quote:{syntax:"open-quote | close-quote | no-open-quote | no-close-quote"},"radial-gradient()":{syntax:"radial-gradient( [ <ending-shape> || <size> ]? [ at <position> ]? , <color-stop-list> )"},"relative-selector":{syntax:"<combinator>? <complex-selector>"},"relative-selector-list":{syntax:"<relative-selector>#"},"relative-size":{syntax:"larger | smaller"},"repeat-style":{syntax:"repeat-x | repeat-y | [ repeat | space | round | no-repeat ]{1,2}"},"repeating-linear-gradient()":{syntax:"repeating-linear-gradient( [ <angle> | to <side-or-corner> ]? , <color-stop-list> )"},"repeating-radial-gradient()":{syntax:"repeating-radial-gradient( [ <ending-shape> || <size> ]? [ at <position> ]? , <color-stop-list> )"},"rgb()":{syntax:"rgb( <percentage>{3} [ / <alpha-value> ]? ) | rgb( <number>{3} [ / <alpha-value> ]? ) | rgb( <percentage>#{3} , <alpha-value>? ) | rgb( <number>#{3} , <alpha-value>? )"},"rgba()":{syntax:"rgba( <percentage>{3} [ / <alpha-value> ]? ) | rgba( <number>{3} [ / <alpha-value> ]? ) | rgba( <percentage>#{3} , <alpha-value>? ) | rgba( <number>#{3} , <alpha-value>? )"},"rotate()":{syntax:"rotate( [ <angle> | <zero> ] )"},"rotate3d()":{syntax:"rotate3d( <number> , <number> , <number> , [ <angle> | <zero> ] )"},"rotateX()":{syntax:"rotateX( [ <angle> | <zero> ] )"},"rotateY()":{syntax:"rotateY( [ <angle> | <zero> ] )"},"rotateZ()":{syntax:"rotateZ( [ <angle> | <zero> ] )"},"saturate()":{syntax:"saturate( <number-percentage> )"},"scale()":{syntax:"scale( <number> , <number>? )"},"scale3d()":{syntax:"scale3d( <number> , <number> , <number> )"},"scaleX()":{syntax:"scaleX( <number> )"},"scaleY()":{syntax:"scaleY( <number> )"},"scaleZ()":{syntax:"scaleZ( <number> )"},"self-position":{syntax:"center | start | end | self-start | self-end | flex-start | flex-end"},"shape-radius":{syntax:"<length-percentage> | closest-side | farthest-side"},"skew()":{syntax:"skew( [ <angle> | <zero> ] , [ <angle> | <zero> ]? )"},"skewX()":{syntax:"skewX( [ <angle> | <zero> ] )"},"skewY()":{syntax:"skewY( [ <angle> | <zero> ] )"},"sepia()":{syntax:"sepia( <number-percentage> )"},shadow:{syntax:"inset? && <length>{2,4} && <color>?"},"shadow-t":{syntax:"[ <length>{2,3} && <color>? ]"},shape:{syntax:"rect(<top>, <right>, <bottom>, <left>)"},"shape-box":{syntax:"<box> | margin-box"},"side-or-corner":{syntax:"[ left | right ] || [ top | bottom ]"},"single-animation":{syntax:"<time> || <timing-function> || <time> || <single-animation-iteration-count> || <single-animation-direction> || <single-animation-fill-mode> || <single-animation-play-state> || [ none | <keyframes-name> ]"},"single-animation-direction":{syntax:"normal | reverse | alternate | alternate-reverse"},"single-animation-fill-mode":{syntax:"none | forwards | backwards | both"},"single-animation-iteration-count":{syntax:"infinite | <number>"},"single-animation-play-state":{syntax:"running | paused"},"single-transition":{syntax:"[ none | <single-transition-property> ] || <time> || <timing-function> || <time>"},"single-transition-property":{syntax:"all | <custom-ident>"},size:{syntax:"closest-side | farthest-side | closest-corner | farthest-corner | <length> | <length-percentage>{2}"},"step-position":{syntax:"jump-start | jump-end | jump-none | jump-both | start | end"},"step-timing-function":{syntax:"step-start | step-end | steps(<integer>[, <step-position>]?)"},"subclass-selector":{syntax:"<id-selector> | <class-selector> | <attribute-selector> | <pseudo-class-selector>"},"supports-condition":{syntax:"not <supports-in-parens> | <supports-in-parens> [ and <supports-in-parens> ]* | <supports-in-parens> [ or <supports-in-parens> ]*"},"supports-in-parens":{syntax:"( <supports-condition> ) | <supports-feature> | <general-enclosed>"},"supports-feature":{syntax:"<supports-decl> | <supports-selector-fn>"},"supports-decl":{syntax:"( <declaration> )"},"supports-selector-fn":{syntax:"selector( <complex-selector> )"},symbol:{syntax:"<string> | <image> | <custom-ident>"},target:{syntax:"<target-counter()> | <target-counters()> | <target-text()>"},"target-counter()":{syntax:"target-counter( [ <string> | <url> ] , <custom-ident> , <counter-style>? )"},"target-counters()":{syntax:"target-counters( [ <string> | <url> ] , <custom-ident> , <string> , <counter-style>? )"},"target-text()":{syntax:"target-text( [ <string> | <url> ] , [ content | before | after | first-letter ]? )"},"time-percentage":{syntax:"<time> | <percentage>"},"timing-function":{syntax:"linear | <cubic-bezier-timing-function> | <step-timing-function>"},"track-breadth":{syntax:"<length-percentage> | <flex> | min-content | max-content | auto"},"track-list":{syntax:"[ <line-names>? [ <track-size> | <track-repeat> ] ]+ <line-names>?"},"track-repeat":{syntax:"repeat( [ <positive-integer> ] , [ <line-names>? <track-size> ]+ <line-names>? )"},"track-size":{syntax:"<track-breadth> | minmax( <inflexible-breadth> , <track-breadth> ) | fit-content( [ <length> | <percentage> ] )"},"transform-function":{syntax:"<matrix()> | <translate()> | <translateX()> | <translateY()> | <scale()> | <scaleX()> | <scaleY()> | <rotate()> | <skew()> | <skewX()> | <skewY()> | <matrix3d()> | <translate3d()> | <translateZ()> | <scale3d()> | <scaleZ()> | <rotate3d()> | <rotateX()> | <rotateY()> | <rotateZ()> | <perspective()>"},"transform-list":{syntax:"<transform-function>+"},"translate()":{syntax:"translate( <length-percentage> , <length-percentage>? )"},"translate3d()":{syntax:"translate3d( <length-percentage> , <length-percentage> , <length> )"},"translateX()":{syntax:"translateX( <length-percentage> )"},"translateY()":{syntax:"translateY( <length-percentage> )"},"translateZ()":{syntax:"translateZ( <length> )"},"type-or-unit":{syntax:"string | color | url | integer | number | length | angle | time | frequency | cap | ch | em | ex | ic | lh | rlh | rem | vb | vi | vw | vh | vmin | vmax | mm | Q | cm | in | pt | pc | px | deg | grad | rad | turn | ms | s | Hz | kHz | %"},"type-selector":{syntax:"<wq-name> | <ns-prefix>? '*'"},"var()":{syntax:"var( <custom-property-name> , <declaration-value>? )"},"viewport-length":{syntax:"auto | <length-percentage>"},"wq-name":{syntax:"<ns-prefix>? <ident-token>"}}});var Rk=ot((hW,fN)=>{fN.exports={atrules:{charset:{prelude:"<string>"},"font-face":{descriptors:{"unicode-range":{comment:"replaces <unicode-range>, an old production name",syntax:"<urange>#"}}}},properties:{"-moz-background-clip":{comment:"deprecated syntax in old Firefox, https://developer.mozilla.org/en/docs/Web/CSS/background-clip",syntax:"padding | border"},"-moz-border-radius-bottomleft":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/border-bottom-left-radius",syntax:"<'border-bottom-left-radius'>"},"-moz-border-radius-bottomright":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/border-bottom-right-radius",syntax:"<'border-bottom-right-radius'>"},"-moz-border-radius-topleft":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/border-top-left-radius",syntax:"<'border-top-left-radius'>"},"-moz-border-radius-topright":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/border-bottom-right-radius",syntax:"<'border-bottom-right-radius'>"},"-moz-control-character-visibility":{comment:"firefox specific keywords, https://bugzilla.mozilla.org/show_bug.cgi?id=947588",syntax:"visible | hidden"},"-moz-osx-font-smoothing":{comment:"misssed old syntax https://developer.mozilla.org/en-US/docs/Web/CSS/font-smooth",syntax:"auto | grayscale"},"-moz-user-select":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/user-select",syntax:"none | text | all | -moz-none"},"-ms-flex-align":{comment:"misssed old syntax implemented in IE, https://www.w3.org/TR/2012/WD-css3-flexbox-20120322/#flex-align",syntax:"start | end | center | baseline | stretch"},"-ms-flex-item-align":{comment:"misssed old syntax implemented in IE, https://www.w3.org/TR/2012/WD-css3-flexbox-20120322/#flex-align",syntax:"auto | start | end | center | baseline | stretch"},"-ms-flex-line-pack":{comment:"misssed old syntax implemented in IE, https://www.w3.org/TR/2012/WD-css3-flexbox-20120322/#flex-line-pack",syntax:"start | end | center | justify | distribute | stretch"},"-ms-flex-negative":{comment:"misssed old syntax implemented in IE; TODO: find references for comfirmation",syntax:"<'flex-shrink'>"},"-ms-flex-pack":{comment:"misssed old syntax implemented in IE, https://www.w3.org/TR/2012/WD-css3-flexbox-20120322/#flex-pack",syntax:"start | end | center | justify | distribute"},"-ms-flex-order":{comment:"misssed old syntax implemented in IE; https://msdn.microsoft.com/en-us/library/jj127303(v=vs.85).aspx",syntax:"<integer>"},"-ms-flex-positive":{comment:"misssed old syntax implemented in IE; TODO: find references for comfirmation",syntax:"<'flex-grow'>"},"-ms-flex-preferred-size":{comment:"misssed old syntax implemented in IE; TODO: find references for comfirmation",syntax:"<'flex-basis'>"},"-ms-interpolation-mode":{comment:"https://msdn.microsoft.com/en-us/library/ff521095(v=vs.85).aspx",syntax:"nearest-neighbor | bicubic"},"-ms-grid-column-align":{comment:"add this property first since it uses as fallback for flexbox, https://msdn.microsoft.com/en-us/library/windows/apps/hh466338.aspx",syntax:"start | end | center | stretch"},"-ms-grid-row-align":{comment:"add this property first since it uses as fallback for flexbox, https://msdn.microsoft.com/en-us/library/windows/apps/hh466348.aspx",syntax:"start | end | center | stretch"},"-ms-hyphenate-limit-last":{comment:"misssed old syntax implemented in IE; https://www.w3.org/TR/css-text-4/#hyphenate-line-limits",syntax:"none | always | column | page | spread"},"-webkit-appearance":{comment:"webkit specific keywords",references:["http://css-infos.net/property/-webkit-appearance"],syntax:"none | button | button-bevel | caps-lock-indicator | caret | checkbox | default-button | inner-spin-button | listbox | listitem | media-controls-background | media-controls-fullscreen-background | media-current-time-display | media-enter-fullscreen-button | media-exit-fullscreen-button | media-fullscreen-button | media-mute-button | media-overlay-play-button | media-play-button | media-seek-back-button | media-seek-forward-button | media-slider | media-sliderthumb | media-time-remaining-display | media-toggle-closed-captions-button | media-volume-slider | media-volume-slider-container | media-volume-sliderthumb | menulist | menulist-button | menulist-text | menulist-textfield | meter | progress-bar | progress-bar-value | push-button | radio | scrollbarbutton-down | scrollbarbutton-left | scrollbarbutton-right | scrollbarbutton-up | scrollbargripper-horizontal | scrollbargripper-vertical | scrollbarthumb-horizontal | scrollbarthumb-vertical | scrollbartrack-horizontal | scrollbartrack-vertical | searchfield | searchfield-cancel-button | searchfield-decoration | searchfield-results-button | searchfield-results-decoration | slider-horizontal | slider-vertical | sliderthumb-horizontal | sliderthumb-vertical | square-button | textarea | textfield | -apple-pay-button"},"-webkit-background-clip":{comment:"https://developer.mozilla.org/en/docs/Web/CSS/background-clip",syntax:"[ <box> | border | padding | content | text ]#"},"-webkit-column-break-after":{comment:"added, http://help.dottoro.com/lcrthhhv.php",syntax:"always | auto | avoid"},"-webkit-column-break-before":{comment:"added, http://help.dottoro.com/lcxquvkf.php",syntax:"always | auto | avoid"},"-webkit-column-break-inside":{comment:"added, http://help.dottoro.com/lclhnthl.php",syntax:"always | auto | avoid"},"-webkit-font-smoothing":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/font-smooth",syntax:"auto | none | antialiased | subpixel-antialiased"},"-webkit-mask-box-image":{comment:"missed; https://developer.mozilla.org/en-US/docs/Web/CSS/-webkit-mask-box-image",syntax:"[ <url> | <gradient> | none ] [ <length-percentage>{4} <-webkit-mask-box-repeat>{2} ]?"},"-webkit-print-color-adjust":{comment:"missed",references:["https://developer.mozilla.org/en/docs/Web/CSS/-webkit-print-color-adjust"],syntax:"economy | exact"},"-webkit-text-security":{comment:"missed; http://help.dottoro.com/lcbkewgt.php",syntax:"none | circle | disc | square"},"-webkit-user-drag":{comment:"missed; http://help.dottoro.com/lcbixvwm.php",syntax:"none | element | auto"},"-webkit-user-select":{comment:"auto is supported by old webkit, https://developer.mozilla.org/en-US/docs/Web/CSS/user-select",syntax:"auto | none | text | all"},"alignment-baseline":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#AlignmentBaselineProperty"],syntax:"auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical"},"baseline-shift":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#BaselineShiftProperty"],syntax:"baseline | sub | super | <svg-length>"},behavior:{comment:"added old IE property https://msdn.microsoft.com/en-us/library/ms530723(v=vs.85).aspx",syntax:"<url>+"},"clip-rule":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/masking.html#ClipRuleProperty"],syntax:"nonzero | evenodd"},cue:{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<'cue-before'> <'cue-after'>?"},"cue-after":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<url> <decibel>? | none"},"cue-before":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<url> <decibel>? | none"},cursor:{comment:"added legacy keywords: hand, -webkit-grab. -webkit-grabbing, -webkit-zoom-in, -webkit-zoom-out, -moz-grab, -moz-grabbing, -moz-zoom-in, -moz-zoom-out",references:["https://www.sitepoint.com/css3-cursor-styles/"],syntax:"[ [ <url> [ <x> <y> ]? , ]* [ auto | default | none | context-menu | help | pointer | progress | wait | cell | crosshair | text | vertical-text | alias | copy | move | no-drop | not-allowed | e-resize | n-resize | ne-resize | nw-resize | s-resize | se-resize | sw-resize | w-resize | ew-resize | ns-resize | nesw-resize | nwse-resize | col-resize | row-resize | all-scroll | zoom-in | zoom-out | grab | grabbing | hand | -webkit-grab | -webkit-grabbing | -webkit-zoom-in | -webkit-zoom-out | -moz-grab | -moz-grabbing | -moz-zoom-in | -moz-zoom-out ] ]"},display:{comment:"extended with -ms-flexbox",syntax:"| <-non-standard-display>"},position:{comment:"extended with -webkit-sticky",syntax:"| -webkit-sticky"},"dominant-baseline":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#DominantBaselineProperty"],syntax:"auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge"},"image-rendering":{comment:"extended with <-non-standard-image-rendering>, added SVG keywords optimizeSpeed and optimizeQuality",references:["https://developer.mozilla.org/en/docs/Web/CSS/image-rendering","https://www.w3.org/TR/SVG/painting.html#ImageRenderingProperty"],syntax:"| optimizeSpeed | optimizeQuality | <-non-standard-image-rendering>"},fill:{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#FillProperty"],syntax:"<paint>"},"fill-opacity":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#FillProperty"],syntax:"<number-zero-one>"},"fill-rule":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#FillProperty"],syntax:"nonzero | evenodd"},filter:{comment:"extend with IE legacy syntaxes",syntax:"| <-ms-filter-function-list>"},"glyph-orientation-horizontal":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#GlyphOrientationHorizontalProperty"],syntax:"<angle>"},"glyph-orientation-vertical":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#GlyphOrientationVerticalProperty"],syntax:"<angle>"},kerning:{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#KerningProperty"],syntax:"auto | <svg-length>"},"letter-spacing":{comment:"fix syntax <length> -> <length-percentage>",references:["https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/letter-spacing"],syntax:"normal | <length-percentage>"},marker:{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#MarkerProperties"],syntax:"none | <url>"},"marker-end":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#MarkerProperties"],syntax:"none | <url>"},"marker-mid":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#MarkerProperties"],syntax:"none | <url>"},"marker-start":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#MarkerProperties"],syntax:"none | <url>"},"max-width":{comment:"fix auto -> none (https://github.com/mdn/data/pull/431); extend by non-standard width keywords https://developer.mozilla.org/en-US/docs/Web/CSS/max-width",syntax:"none | <length-percentage> | min-content | max-content | fit-content(<length-percentage>) | <-non-standard-width>"},width:{comment:"per spec fit-content should be a function, however browsers are supporting it as a keyword (https://github.com/csstree/stylelint-validator/issues/29)",syntax:"| fit-content | -moz-fit-content | -webkit-fit-content"},"min-width":{comment:"extend by non-standard width keywords https://developer.mozilla.org/en-US/docs/Web/CSS/width",syntax:"auto | <length-percentage> | min-content | max-content | fit-content(<length-percentage>) | <-non-standard-width>"},overflow:{comment:"extend by vendor keywords https://developer.mozilla.org/en-US/docs/Web/CSS/overflow",syntax:"| <-non-standard-overflow>"},pause:{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<'pause-before'> <'pause-after'>?"},"pause-after":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<time> | none | x-weak | weak | medium | strong | x-strong"},"pause-before":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<time> | none | x-weak | weak | medium | strong | x-strong"},rest:{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<'rest-before'> <'rest-after'>?"},"rest-after":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<time> | none | x-weak | weak | medium | strong | x-strong"},"rest-before":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<time> | none | x-weak | weak | medium | strong | x-strong"},"shape-rendering":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#ShapeRenderingPropert"],syntax:"auto | optimizeSpeed | crispEdges | geometricPrecision"},src:{comment:"added @font-face's src property https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/src",syntax:"[ <url> [ format( <string># ) ]? | local( <family-name> ) ]#"},speak:{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"auto | none | normal"},"speak-as":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"normal | spell-out || digits || [ literal-punctuation | no-punctuation ]"},stroke:{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"<paint>"},"stroke-dasharray":{comment:"added SVG property; a list of comma and/or white space separated <length>s and <percentage>s",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"none | [ <svg-length>+ ]#"},"stroke-dashoffset":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"<svg-length>"},"stroke-linecap":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"butt | round | square"},"stroke-linejoin":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"miter | round | bevel"},"stroke-miterlimit":{comment:"added SVG property (<miterlimit> = <number-one-or-greater>) ",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"<number-one-or-greater>"},"stroke-opacity":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"<number-zero-one>"},"stroke-width":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/painting.html#StrokeProperties"],syntax:"<svg-length>"},"text-anchor":{comment:"added SVG property",references:["https://www.w3.org/TR/SVG/text.html#TextAlignmentProperties"],syntax:"start | middle | end"},"unicode-bidi":{comment:"added prefixed keywords https://developer.mozilla.org/en-US/docs/Web/CSS/unicode-bidi",syntax:"| -moz-isolate | -moz-isolate-override | -moz-plaintext | -webkit-isolate | -webkit-isolate-override | -webkit-plaintext"},"unicode-range":{comment:"added missed property https://developer.mozilla.org/en-US/docs/Web/CSS/%40font-face/unicode-range",syntax:"<urange>#"},"voice-balance":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<number> | left | center | right | leftwards | rightwards"},"voice-duration":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"auto | <time>"},"voice-family":{comment:"<name> -> <family-name>, https://www.w3.org/TR/css3-speech/#property-index",syntax:"[ [ <family-name> | <generic-voice> ] , ]* [ <family-name> | <generic-voice> ] | preserve"},"voice-pitch":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<frequency> && absolute | [ [ x-low | low | medium | high | x-high ] || [ <frequency> | <semitones> | <percentage> ] ]"},"voice-range":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"<frequency> && absolute | [ [ x-low | low | medium | high | x-high ] || [ <frequency> | <semitones> | <percentage> ] ]"},"voice-rate":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"[ normal | x-slow | slow | medium | fast | x-fast ] || <percentage>"},"voice-stress":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"normal | strong | moderate | none | reduced"},"voice-volume":{comment:"https://www.w3.org/TR/css3-speech/#property-index",syntax:"silent | [ [ x-soft | soft | medium | loud | x-loud ] || <decibel> ]"},"writing-mode":{comment:"extend with SVG keywords",syntax:"| <svg-writing-mode>"}},syntaxes:{"-legacy-gradient":{comment:"added collection of legacy gradient syntaxes",syntax:"<-webkit-gradient()> | <-legacy-linear-gradient> | <-legacy-repeating-linear-gradient> | <-legacy-radial-gradient> | <-legacy-repeating-radial-gradient>"},"-legacy-linear-gradient":{comment:"like standard syntax but w/o `to` keyword https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient",syntax:"-moz-linear-gradient( <-legacy-linear-gradient-arguments> ) | -webkit-linear-gradient( <-legacy-linear-gradient-arguments> ) | -o-linear-gradient( <-legacy-linear-gradient-arguments> )"},"-legacy-repeating-linear-gradient":{comment:"like standard syntax but w/o `to` keyword https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient",syntax:"-moz-repeating-linear-gradient( <-legacy-linear-gradient-arguments> ) | -webkit-repeating-linear-gradient( <-legacy-linear-gradient-arguments> ) | -o-repeating-linear-gradient( <-legacy-linear-gradient-arguments> )"},"-legacy-linear-gradient-arguments":{comment:"like standard syntax but w/o `to` keyword https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient",syntax:"[ <angle> | <side-or-corner> ]? , <color-stop-list>"},"-legacy-radial-gradient":{comment:"deprecated syntax that implemented by some browsers https://www.w3.org/TR/2011/WD-css3-images-20110908/#radial-gradients",syntax:"-moz-radial-gradient( <-legacy-radial-gradient-arguments> ) | -webkit-radial-gradient( <-legacy-radial-gradient-arguments> ) | -o-radial-gradient( <-legacy-radial-gradient-arguments> )"},"-legacy-repeating-radial-gradient":{comment:"deprecated syntax that implemented by some browsers https://www.w3.org/TR/2011/WD-css3-images-20110908/#radial-gradients",syntax:"-moz-repeating-radial-gradient( <-legacy-radial-gradient-arguments> ) | -webkit-repeating-radial-gradient( <-legacy-radial-gradient-arguments> ) | -o-repeating-radial-gradient( <-legacy-radial-gradient-arguments> )"},"-legacy-radial-gradient-arguments":{comment:"deprecated syntax that implemented by some browsers https://www.w3.org/TR/2011/WD-css3-images-20110908/#radial-gradients",syntax:"[ <position> , ]? [ [ [ <-legacy-radial-gradient-shape> || <-legacy-radial-gradient-size> ] | [ <length> | <percentage> ]{2} ] , ]? <color-stop-list>"},"-legacy-radial-gradient-size":{comment:"before a standard it contains 2 extra keywords (`contain` and `cover`) https://www.w3.org/TR/2011/WD-css3-images-20110908/#ltsize",syntax:"closest-side | closest-corner | farthest-side | farthest-corner | contain | cover"},"-legacy-radial-gradient-shape":{comment:"define to double sure it doesn't extends in future https://www.w3.org/TR/2011/WD-css3-images-20110908/#ltshape",syntax:"circle | ellipse"},"-non-standard-font":{comment:"non standard fonts",references:["https://webkit.org/blog/3709/using-the-system-font-in-web-content/"],syntax:"-apple-system-body | -apple-system-headline | -apple-system-subheadline | -apple-system-caption1 | -apple-system-caption2 | -apple-system-footnote | -apple-system-short-body | -apple-system-short-headline | -apple-system-short-subheadline | -apple-system-short-caption1 | -apple-system-short-footnote | -apple-system-tall-body"},"-non-standard-color":{comment:"non standard colors",references:["http://cssdot.ru/%D0%A1%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA_CSS/color-i305.html","https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#Mozilla_Color_Preference_Extensions"],syntax:"-moz-ButtonDefault | -moz-ButtonHoverFace | -moz-ButtonHoverText | -moz-CellHighlight | -moz-CellHighlightText | -moz-Combobox | -moz-ComboboxText | -moz-Dialog | -moz-DialogText | -moz-dragtargetzone | -moz-EvenTreeRow | -moz-Field | -moz-FieldText | -moz-html-CellHighlight | -moz-html-CellHighlightText | -moz-mac-accentdarkestshadow | -moz-mac-accentdarkshadow | -moz-mac-accentface | -moz-mac-accentlightesthighlight | -moz-mac-accentlightshadow | -moz-mac-accentregularhighlight | -moz-mac-accentregularshadow | -moz-mac-chrome-active | -moz-mac-chrome-inactive | -moz-mac-focusring | -moz-mac-menuselect | -moz-mac-menushadow | -moz-mac-menutextselect | -moz-MenuHover | -moz-MenuHoverText | -moz-MenuBarText | -moz-MenuBarHoverText | -moz-nativehyperlinktext | -moz-OddTreeRow | -moz-win-communicationstext | -moz-win-mediatext | -moz-activehyperlinktext | -moz-default-background-color | -moz-default-color | -moz-hyperlinktext | -moz-visitedhyperlinktext | -webkit-activelink | -webkit-focus-ring-color | -webkit-link | -webkit-text"},"-non-standard-image-rendering":{comment:"non-standard keywords http://phrogz.net/tmp/canvas_image_zoom.html",syntax:"optimize-contrast | -moz-crisp-edges | -o-crisp-edges | -webkit-optimize-contrast"},"-non-standard-overflow":{comment:"non-standard keywords https://developer.mozilla.org/en-US/docs/Web/CSS/overflow",syntax:"-moz-scrollbars-none | -moz-scrollbars-horizontal | -moz-scrollbars-vertical | -moz-hidden-unscrollable"},"-non-standard-width":{comment:"non-standard keywords https://developer.mozilla.org/en-US/docs/Web/CSS/width",syntax:"fill-available | min-intrinsic | intrinsic | -moz-available | -moz-fit-content | -moz-min-content | -moz-max-content | -webkit-min-content | -webkit-max-content"},"-webkit-gradient()":{comment:"first Apple proposal gradient syntax https://webkit.org/blog/175/introducing-css-gradients/ - TODO: simplify when after match algorithm improvement ( [, point, radius | , point] -> [, radius]? , point )",syntax:"-webkit-gradient( <-webkit-gradient-type>, <-webkit-gradient-point> [, <-webkit-gradient-point> | , <-webkit-gradient-radius>, <-webkit-gradient-point> ] [, <-webkit-gradient-radius>]? [, <-webkit-gradient-color-stop>]* )"},"-webkit-gradient-color-stop":{comment:"first Apple proposal gradient syntax https://webkit.org/blog/175/introducing-css-gradients/",syntax:"from( <color> ) | color-stop( [ <number-zero-one> | <percentage> ] , <color> ) | to( <color> )"},"-webkit-gradient-point":{comment:"first Apple proposal gradient syntax https://webkit.org/blog/175/introducing-css-gradients/",syntax:"[ left | center | right | <length-percentage> ] [ top | center | bottom | <length-percentage> ]"},"-webkit-gradient-radius":{comment:"first Apple proposal gradient syntax https://webkit.org/blog/175/introducing-css-gradients/",syntax:"<length> | <percentage>"},"-webkit-gradient-type":{comment:"first Apple proposal gradient syntax https://webkit.org/blog/175/introducing-css-gradients/",syntax:"linear | radial"},"-webkit-mask-box-repeat":{comment:"missed; https://developer.mozilla.org/en-US/docs/Web/CSS/-webkit-mask-box-image",syntax:"repeat | stretch | round"},"-webkit-mask-clip-style":{comment:"missed; there is no enough information about `-webkit-mask-clip` property, but looks like all those keywords are working",syntax:"border | border-box | padding | padding-box | content | content-box | text"},"-ms-filter-function-list":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/-ms-filter",syntax:"<-ms-filter-function>+"},"-ms-filter-function":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/-ms-filter",syntax:"<-ms-filter-function-progid> | <-ms-filter-function-legacy>"},"-ms-filter-function-progid":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/-ms-filter",syntax:"'progid:' [ <ident-token> '.' ]* [ <ident-token> | <function-token> <any-value>? ) ]"},"-ms-filter-function-legacy":{comment:"https://developer.mozilla.org/en-US/docs/Web/CSS/-ms-filter",syntax:"<ident-token> | <function-token> <any-value>? )"},"-ms-filter":{syntax:"<string>"},age:{comment:"https://www.w3.org/TR/css3-speech/#voice-family",syntax:"child | young | old"},"attr-name":{syntax:"<wq-name>"},"attr-fallback":{syntax:"<any-value>"},"border-radius":{comment:"missed, https://drafts.csswg.org/css-backgrounds-3/#the-border-radius",syntax:"<length-percentage>{1,2}"},bottom:{comment:"missed; not sure we should add it, but no others except `shape` is using it so it's ok for now; https://drafts.fxtf.org/css-masking-1/#funcdef-clip-rect",syntax:"<length> | auto"},"content-list":{comment:"missed -> https://drafts.csswg.org/css-content/#typedef-content-list (document-url, <target> and leader() is omitted util stabilization)",syntax:"[ <string> | contents | <image> | <quote> | <target> | <leader()> | <attr()> | counter( <ident>, <'list-style-type'>? ) ]+"},"element()":{comment:"https://drafts.csswg.org/css-gcpm/#element-syntax & https://drafts.csswg.org/css-images-4/#element-notation",syntax:"element( <custom-ident> , [ first | start | last | first-except ]? ) | element( <id-selector> )"},"generic-voice":{comment:"https://www.w3.org/TR/css3-speech/#voice-family",syntax:"[ <age>? <gender> <integer>? ]"},gender:{comment:"https://www.w3.org/TR/css3-speech/#voice-family",syntax:"male | female | neutral"},"generic-family":{comment:"added -apple-system",references:["https://webkit.org/blog/3709/using-the-system-font-in-web-content/"],syntax:"| -apple-system"},gradient:{comment:"added legacy syntaxes support",syntax:"| <-legacy-gradient>"},left:{comment:"missed; not sure we should add it, but no others except `shape` is using it so it's ok for now; https://drafts.fxtf.org/css-masking-1/#funcdef-clip-rect",syntax:"<length> | auto"},"mask-image":{comment:"missed; https://drafts.fxtf.org/css-masking-1/#the-mask-image",syntax:"<mask-reference>#"},"name-repeat":{comment:"missed, and looks like obsolete, keep it as is since other property syntaxes should be changed too; https://www.w3.org/TR/2015/WD-css-grid-1-20150917/#typedef-name-repeat",syntax:"repeat( [ <positive-integer> | auto-fill ], <line-names>+)"},"named-color":{comment:"added non standard color names",syntax:"| <-non-standard-color>"},paint:{comment:"used by SVG https://www.w3.org/TR/SVG/painting.html#SpecifyingPaint",syntax:"none | <color> | <url> [ none | <color> ]? | context-fill | context-stroke"},"page-size":{comment:"https://www.w3.org/TR/css-page-3/#typedef-page-size-page-size",syntax:"A5 | A4 | A3 | B5 | B4 | JIS-B5 | JIS-B4 | letter | legal | ledger"},ratio:{comment:"missed, https://drafts.csswg.org/mediaqueries-4/#typedef-ratio",syntax:"<integer> / <integer>"},right:{comment:"missed; not sure we should add it, but no others except `shape` is using it so it's ok for now; https://drafts.fxtf.org/css-masking-1/#funcdef-clip-rect",syntax:"<length> | auto"},shape:{comment:"missed spaces in function body and add backwards compatible syntax",syntax:"rect( <top>, <right>, <bottom>, <left> ) | rect( <top> <right> <bottom> <left> )"},"svg-length":{comment:"All coordinates and lengths in SVG can be specified with or without a unit identifier",references:["https://www.w3.org/TR/SVG11/coords.html#Units"],syntax:"<percentage> | <length> | <number>"},"svg-writing-mode":{comment:"SVG specific keywords (deprecated for CSS)",references:["https://developer.mozilla.org/en/docs/Web/CSS/writing-mode","https://www.w3.org/TR/SVG/text.html#WritingModeProperty"],syntax:"lr-tb | rl-tb | tb-rl | lr | rl | tb"},top:{comment:"missed; not sure we should add it, but no others except `shape` is using it so it's ok for now; https://drafts.fxtf.org/css-masking-1/#funcdef-clip-rect",syntax:"<length> | auto"},"track-group":{comment:"used by old grid-columns and grid-rows syntax v0",syntax:"'(' [ <string>* <track-minmax> <string>* ]+ ')' [ '[' <positive-integer> ']' ]? | <track-minmax>"},"track-list-v0":{comment:"used by old grid-columns and grid-rows syntax v0",syntax:"[ <string>* <track-group> <string>* ]+ | none"},"track-minmax":{comment:"used by old grid-columns and grid-rows syntax v0",syntax:"minmax( <track-breadth> , <track-breadth> ) | auto | <track-breadth> | fit-content"},x:{comment:"missed; not sure we should add it, but no others except `cursor` is using it so it's ok for now; https://drafts.csswg.org/css-ui-3/#cursor",syntax:"<number>"},y:{comment:"missed; not sure we should add it, but no others except `cursor` is using so it's ok for now; https://drafts.csswg.org/css-ui-3/#cursor",syntax:"<number>"},declaration:{comment:"missed, restored by https://drafts.csswg.org/css-syntax",syntax:"<ident-token> : <declaration-value>? [ '!' important ]?"},"declaration-list":{comment:"missed, restored by https://drafts.csswg.org/css-syntax",syntax:"[ <declaration>? ';' ]* <declaration>?"},url:{comment:"https://drafts.csswg.org/css-values-4/#urls",syntax:"url( <string> <url-modifier>* ) | <url-token>"},"url-modifier":{comment:"https://drafts.csswg.org/css-values-4/#typedef-url-modifier",syntax:"<ident> | <function-token> <any-value> )"},"number-zero-one":{syntax:"<number [0,1]>"},"number-one-or-greater":{syntax:"<number [1,\u221E]>"},"positive-integer":{syntax:"<integer [0,\u221E]>"},"-non-standard-display":{syntax:"-ms-inline-flexbox | -ms-grid | -ms-inline-grid | -webkit-flex | -webkit-inline-flex | -webkit-box | -webkit-inline-box | -moz-inline-stack | -moz-box | -moz-inline-box"}}}});var Nk=ot((pW,Fk)=>{var mN=zk(),gN=Mk(),_N=Ok(),sb=Rk(),Dk=/^\s*\|\s*/;function yN(d){let h=Object.create(null);for(let v in d){let y=d[v],T=null;if(y.descriptors){T=Object.create(null);for(let n in y.descriptors)T[n]=y.descriptors[n].syntax}h[v.substr(1)]={prelude:y.syntax.trim().match(/^@\S+\s+([^;\{]*)/)[1].trim()||null,descriptors:T}}return h}function ab(d,h){let v={};for(let y in d)v[y]=d[y].syntax||d[y];for(let y in h)y in d?h[y].syntax?v[y]=Dk.test(h[y].syntax)?v[y]+" "+h[y].syntax.trim():h[y].syntax:delete v[y]:h[y].syntax&&(v[y]=h[y].syntax.replace(Dk,""));return v}function Bk(d){let h={};for(let v in d)h[v]=d[v].syntax;return h}function vN(d,h){let v={};for(let y in d){let T=h[y]&&h[y].descriptors||null;v[y]={prelude:y in h&&"prelude"in h[y]?h[y].prelude:d[y].prelude||null,descriptors:d[y].descriptors?ab(d[y].descriptors,T||{}):T&&Bk(T)}}for(let y in h)hasOwnProperty.call(d,y)||(v[y]={prelude:h[y].prelude||null,descriptors:h[y].descriptors&&Bk(h[y].descriptors)});return v}Fk.exports={types:ab(_N,sb.syntaxes),atrules:vN(yN(mN),sb.atrules),properties:ab(gN,sb.properties)}});var Gk=ot((fW,Wk)=>{var Uk=Ei().cmpChar,qk=Ei().isDigit,Bm=Ei().TYPE,jk=Bm.WhiteSpace,Vk=Bm.Comment,lb=Bm.Ident,Zc=Bm.Number,xN=Bm.Dimension,sc=43,Sa=45,Ty=110,Rd=!0,bN=!1;function Cy(d,h){var v=this.scanner.tokenStart+d,y=this.scanner.source.charCodeAt(v);for((y===sc||y===Sa)&&(h&&this.error("Number sign is not allowed"),v++);v<this.scanner.tokenEnd;v++)qk(this.scanner.source.charCodeAt(v))||this.error("Integer is expected",v)}function xp(d){return Cy.call(this,0,d)}function Vu(d,h){if(!Uk(this.scanner.source,this.scanner.tokenStart+d,h)){var v="";switch(h){case Ty:v="N is expected";break;case Sa:v="HyphenMinus is expected";break}this.error(v,this.scanner.tokenStart+d)}}function cb(){for(var d=0,h=0,v=this.scanner.tokenType;v===jk||v===Vk;)v=this.scanner.lookupType(++d);if(v!==Zc)if(this.scanner.isDelim(sc,d)||this.scanner.isDelim(Sa,d)){h=this.scanner.isDelim(sc,d)?sc:Sa;do v=this.scanner.lookupType(++d);while(v===jk||v===Vk);v!==Zc&&(this.scanner.skip(d),xp.call(this,Rd))}else return null;return d>0&&this.scanner.skip(d),h===0&&(v=this.scanner.source.charCodeAt(this.scanner.tokenStart),v!==sc&&v!==Sa&&this.error("Number sign is expected")),xp.call(this,h!==0),h===Sa?"-"+this.consume(Zc):this.consume(Zc)}Wk.exports={name:"AnPlusB",structure:{a:[String,null],b:[String,null]},parse:function(){var d=this.scanner.tokenStart,h=null,v=null;if(this.scanner.tokenType===Zc)xp.call(this,bN),v=this.consume(Zc);else if(this.scanner.tokenType===lb&&Uk(this.scanner.source,this.scanner.tokenStart,Sa))switch(h="-1",Vu.call(this,1,Ty),this.scanner.getTokenLength()){case 2:this.scanner.next(),v=cb.call(this);break;case 3:Vu.call(this,2,Sa),this.scanner.next(),this.scanner.skipSC(),xp.call(this,Rd),v="-"+this.consume(Zc);break;default:Vu.call(this,2,Sa),Cy.call(this,3,Rd),this.scanner.next(),v=this.scanner.substrToCursor(d+2)}else if(this.scanner.tokenType===lb||this.scanner.isDelim(sc)&&this.scanner.lookupType(1)===lb){var y=0;switch(h="1",this.scanner.isDelim(sc)&&(y=1,this.scanner.next()),Vu.call(this,0,Ty),this.scanner.getTokenLength()){case 1:this.scanner.next(),v=cb.call(this);break;case 2:Vu.call(this,1,Sa),this.scanner.next(),this.scanner.skipSC(),xp.call(this,Rd),v="-"+this.consume(Zc);break;default:Vu.call(this,1,Sa),Cy.call(this,2,Rd),this.scanner.next(),v=this.scanner.substrToCursor(d+y+1)}}else if(this.scanner.tokenType===xN){for(var T=this.scanner.source.charCodeAt(this.scanner.tokenStart),y=T===sc||T===Sa,n=this.scanner.tokenStart+y;n<this.scanner.tokenEnd&&qk(this.scanner.source.charCodeAt(n));n++);n===this.scanner.tokenStart+y&&this.error("Integer is expected",this.scanner.tokenStart+y),Vu.call(this,n-this.scanner.tokenStart,Ty),h=this.scanner.source.substring(d,n),n+1===this.scanner.tokenEnd?(this.scanner.next(),v=cb.call(this)):(Vu.call(this,n-this.scanner.tokenStart+1,Sa),n+2===this.scanner.tokenEnd?(this.scanner.next(),this.scanner.skipSC(),xp.call(this,Rd),v="-"+this.consume(Zc)):(Cy.call(this,n-this.scanner.tokenStart+2,Rd),this.scanner.next(),v=this.scanner.substrToCursor(n+1)))}else this.error();return h!==null&&h.charCodeAt(0)===sc&&(h=h.substr(1)),v!==null&&v.charCodeAt(0)===sc&&(v=v.substr(1)),{type:"AnPlusB",loc:this.getLocation(d,this.scanner.tokenStart),a:h,b:v}},generate:function(d){var h=d.a!==null&&d.a!==void 0,v=d.b!==null&&d.b!==void 0;h?(this.chunk(d.a==="+1"?"+n":d.a==="1"?"n":d.a==="-1"?"-n":d.a+"n"),v&&(v=String(d.b),v.charAt(0)==="-"||v.charAt(0)==="+"?(this.chunk(v.charAt(0)),this.chunk(v.substr(1))):(this.chunk("+"),this.chunk(v)))):this.chunk(String(d.b))}}});var Uu=ot((mW,$k)=>{var wN=Ei(),Ey=wN.TYPE,SN=Ey.WhiteSpace,ub=Ey.Semicolon,Zk=Ey.LeftCurlyBracket,TN=Ey.Delim,CN=33;function EN(){return this.scanner.tokenIndex>0&&this.scanner.lookupType(-1)===SN?this.scanner.tokenIndex>1?this.scanner.getTokenStart(this.scanner.tokenIndex-1):this.scanner.firstCharOffset:this.scanner.tokenStart}function Hk(){return 0}function AN(d){return d===Zk?1:0}function kN(d){return d===Zk||d===ub?1:0}function IN(d,h,v){return d===TN&&h.charCodeAt(v)===CN||d===ub?1:0}function PN(d){return d===ub?2:0}$k.exports={name:"Raw",structure:{value:String},parse:function(d,h,v){var y=this.scanner.getTokenStart(d),T;return this.scanner.skip(this.scanner.getRawLength(d,h||Hk)),v&&this.scanner.tokenStart>y?T=EN.call(this):T=this.scanner.tokenStart,{type:"Raw",loc:this.getLocation(y,T),value:this.scanner.source.substring(y,T)}},generate:function(d){this.chunk(d.value)},mode:{default:Hk,leftCurlyBracket:AN,leftCurlyBracketOrSemicolon:kN,exclamationMarkOrSemicolon:IN,semicolonIncluded:PN}}});var Qk=ot((gW,Jk)=>{var Ay=Ei().TYPE,LN=Uu().mode,Kk=Ay.AtKeyword,Xk=Ay.Semicolon,db=Ay.LeftCurlyBracket,zN=Ay.RightCurlyBracket;function Yk(d){return this.Raw(d,LN.leftCurlyBracketOrSemicolon,!0)}function MN(){for(var d=1,h;h=this.scanner.lookupType(d);d++){if(h===zN)return!0;if(h===db||h===Kk)return!1}return!1}Jk.exports={name:"Atrule",structure:{name:String,prelude:["AtrulePrelude","Raw",null],block:["Block",null]},parse:function(){var d=this.scanner.tokenStart,h,v,y=null,T=null;switch(this.eat(Kk),h=this.scanner.substrToCursor(d+1),v=h.toLowerCase(),this.scanner.skipSC(),this.scanner.eof===!1&&this.scanner.tokenType!==db&&this.scanner.tokenType!==Xk&&(this.parseAtrulePrelude?(y=this.parseWithFallback(this.AtrulePrelude.bind(this,h),Yk),y.type==="AtrulePrelude"&&y.children.head===null&&(y=null)):y=Yk.call(this,this.scanner.tokenIndex),this.scanner.skipSC()),this.scanner.tokenType){case Xk:this.scanner.next();break;case db:this.atrule.hasOwnProperty(v)&&typeof this.atrule[v].block=="function"?T=this.atrule[v].block.call(this):T=this.Block(MN.call(this));break}return{type:"Atrule",loc:this.getLocation(d,this.scanner.tokenStart),name:h,prelude:y,block:T}},generate:function(d){this.chunk("@"),this.chunk(d.name),d.prelude!==null&&(this.chunk(" "),this.node(d.prelude)),d.block?this.node(d.block):this.chunk(";")},walkContext:"atrule"}});var iI=ot((_W,tI)=>{var eI=Ei().TYPE,ON=eI.Semicolon,RN=eI.LeftCurlyBracket;tI.exports={name:"AtrulePrelude",structure:{children:[[]]},parse:function(d){var h=null;return d!==null&&(d=d.toLowerCase()),this.scanner.skipSC(),this.atrule.hasOwnProperty(d)&&typeof this.atrule[d].prelude=="function"?h=this.atrule[d].prelude.call(this):h=this.readSequence(this.scope.AtrulePrelude),this.scanner.skipSC(),this.scanner.eof!==!0&&this.scanner.tokenType!==RN&&this.scanner.tokenType!==ON&&this.error("Semicolon or block is expected"),h===null&&(h=this.createList()),{type:"AtrulePrelude",loc:this.getLocationFromList(h),children:h}},generate:function(d){this.children(d)},walkContext:"atrulePrelude"}});var sI=ot((yW,oI)=>{var Nm=Ei().TYPE,Fm=Nm.Ident,DN=Nm.String,BN=Nm.Colon,FN=Nm.LeftSquareBracket,rI=Nm.RightSquareBracket,NN=36,nI=42,ky=61,jN=94,hb=124,VN=126;function UN(){this.scanner.eof&&this.error("Unexpected end of input");var d=this.scanner.tokenStart,h=!1,v=!0;return this.scanner.isDelim(nI)?(h=!0,v=!1,this.scanner.next()):this.scanner.isDelim(hb)||this.eat(Fm),this.scanner.isDelim(hb)?this.scanner.source.charCodeAt(this.scanner.tokenStart+1)!==ky?(this.scanner.next(),this.eat(Fm)):h&&this.error("Identifier is expected",this.scanner.tokenEnd):h&&this.error("Vertical line is expected"),v&&this.scanner.tokenType===BN&&(this.scanner.next(),this.eat(Fm)),{type:"Identifier",loc:this.getLocation(d,this.scanner.tokenStart),name:this.scanner.substrToCursor(d)}}function qN(){var d=this.scanner.tokenStart,h=this.scanner.source.charCodeAt(d);return h!==ky&&h!==VN&&h!==jN&&h!==NN&&h!==nI&&h!==hb&&this.error("Attribute selector (=, ~=, ^=, $=, *=, |=) is expected"),this.scanner.next(),h!==ky&&(this.scanner.isDelim(ky)||this.error("Equal sign is expected"),this.scanner.next()),this.scanner.substrToCursor(d)}oI.exports={name:"AttributeSelector",structure:{name:"Identifier",matcher:[String,null],value:["String","Identifier",null],flags:[String,null]},parse:function(){var d=this.scanner.tokenStart,h,v=null,y=null,T=null;return this.eat(FN),this.scanner.skipSC(),h=UN.call(this),this.scanner.skipSC(),this.scanner.tokenType!==rI&&(this.scanner.tokenType!==Fm&&(v=qN.call(this),this.scanner.skipSC(),y=this.scanner.tokenType===DN?this.String():this.Identifier(),this.scanner.skipSC()),this.scanner.tokenType===Fm&&(T=this.scanner.getTokenValue(),this.scanner.next(),this.scanner.skipSC())),this.eat(rI),{type:"AttributeSelector",loc:this.getLocation(d,this.scanner.tokenStart),name:h,matcher:v,value:y,flags:T}},generate:function(d){var h=" ";this.chunk("["),this.node(d.name),d.matcher!==null&&(this.chunk(d.matcher),d.value!==null&&(this.node(d.value),d.value.type==="String"&&(h=""))),d.flags!==null&&(this.chunk(h),this.chunk(d.flags)),this.chunk("]")}}});var hI=ot((vW,dI)=>{var bp=Ei().TYPE,WN=Uu().mode,GN=bp.WhiteSpace,HN=bp.Comment,aI=bp.Semicolon,ZN=bp.AtKeyword,$N=bp.LeftCurlyBracket,lI=bp.RightCurlyBracket;function uI(d){return this.Raw(d,null,!0)}function XN(){return this.parseWithFallback(this.Rule,uI)}function cI(d){return this.Raw(d,WN.semicolonIncluded,!0)}function YN(){if(this.scanner.tokenType===aI)return cI.call(this,this.scanner.tokenIndex);var d=this.parseWithFallback(this.Declaration,cI);return this.scanner.tokenType===aI&&this.scanner.next(),d}dI.exports={name:"Block",structure:{children:[["Atrule","Rule","Declaration"]]},parse:function(d){var h=d?YN:XN,v=this.scanner.tokenStart,y=this.createList();this.eat($N);e:for(;!this.scanner.eof;)switch(this.scanner.tokenType){case lI:break e;case GN:case HN:this.scanner.next();break;case ZN:y.push(this.parseWithFallback(this.Atrule,uI));break;default:y.push(h.call(this))}return this.scanner.eof||this.eat(lI),{type:"Block",loc:this.getLocation(v,this.scanner.tokenStart),children:y}},generate:function(d){this.chunk("{"),this.children(d,function(h){h.type==="Declaration"&&this.chunk(";")}),this.chunk("}")},walkContext:"block"}});var mI=ot((xW,fI)=>{var pI=Ei().TYPE,KN=pI.LeftSquareBracket,JN=pI.RightSquareBracket;fI.exports={name:"Brackets",structure:{children:[[]]},parse:function(d,h){var v=this.scanner.tokenStart,y=null;return this.eat(KN),y=d.call(this,h),this.scanner.eof||this.eat(JN),{type:"Brackets",loc:this.getLocation(v,this.scanner.tokenStart),children:y}},generate:function(d){this.chunk("["),this.children(d),this.chunk("]")}}});var _I=ot((bW,gI)=>{var QN=Ei().TYPE.CDC;gI.exports={name:"CDC",structure:[],parse:function(){var d=this.scanner.tokenStart;return this.eat(QN),{type:"CDC",loc:this.getLocation(d,this.scanner.tokenStart)}},generate:function(){this.chunk("-->")}}});var vI=ot((wW,yI)=>{var ej=Ei().TYPE.CDO;yI.exports={name:"CDO",structure:[],parse:function(){var d=this.scanner.tokenStart;return this.eat(ej),{type:"CDO",loc:this.getLocation(d,this.scanner.tokenStart)}},generate:function(){this.chunk("<!--")}}});var bI=ot((SW,xI)=>{var tj=Ei().TYPE,ij=tj.Ident,rj=46;xI.exports={name:"ClassSelector",structure:{name:String},parse:function(){return this.scanner.isDelim(rj)||this.error("Full stop is expected"),this.scanner.next(),{type:"ClassSelector",loc:this.getLocation(this.scanner.tokenStart-1,this.scanner.tokenEnd),name:this.consume(ij)}},generate:function(d){this.chunk("."),this.chunk(d.name)}}});var TI=ot((TW,SI)=>{var nj=Ei().TYPE,oj=nj.Ident,sj=43,wI=47,aj=62,lj=126;SI.exports={name:"Combinator",structure:{name:String},parse:function(){var d=this.scanner.tokenStart,h=this.scanner.source.charCodeAt(this.scanner.tokenStart);switch(h){case aj:case sj:case lj:this.scanner.next();break;case wI:this.scanner.next(),(this.scanner.tokenType!==oj||this.scanner.lookupValue(0,"deep")===!1)&&this.error("Identifier `deep` is expected"),this.scanner.next(),this.scanner.isDelim(wI)||this.error("Solidus is expected"),this.scanner.next();break;default:this.error("Combinator is expected")}return{type:"Combinator",loc:this.getLocation(d,this.scanner.tokenStart),name:this.scanner.substrToCursor(d)}},generate:function(d){this.chunk(d.name)}}});var EI=ot((CW,CI)=>{var cj=Ei().TYPE,uj=cj.Comment,dj=42,hj=47;CI.exports={name:"Comment",structure:{value:String},parse:function(){var d=this.scanner.tokenStart,h=this.scanner.tokenEnd;return this.eat(uj),h-d+2>=2&&this.scanner.source.charCodeAt(h-2)===dj&&this.scanner.source.charCodeAt(h-1)===hj&&(h-=2),{type:"Comment",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.source.substring(d+2,h)}},generate:function(d){this.chunk("/*"),this.chunk(d.value),this.chunk("*/")}}});var RI=ot((EW,OI)=>{var pj=Q_().isCustomProperty,wp=Ei().TYPE,II=Uu().mode,PI=wp.Ident,AI=wp.Hash,fj=wp.Colon,LI=wp.Semicolon,zI=wp.Delim,mj=wp.WhiteSpace,MI=33,gj=35,_j=36,yj=38,vj=42,xj=43,kI=47;function bj(d){return this.Raw(d,II.exclamationMarkOrSemicolon,!0)}function wj(d){return this.Raw(d,II.exclamationMarkOrSemicolon,!1)}function Sj(){var d=this.scanner.tokenIndex,h=this.Value();return h.type!=="Raw"&&this.scanner.eof===!1&&this.scanner.tokenType!==LI&&this.scanner.isDelim(MI)===!1&&this.scanner.isBalanceEdge(d)===!1&&this.error(),h}OI.exports={name:"Declaration",structure:{important:[Boolean,String],property:String,value:["Value","Raw"]},parse:function(){var d=this.scanner.tokenStart,h=this.scanner.tokenIndex,v=Tj.call(this),y=pj(v),T=y?this.parseCustomProperty:this.parseValue,n=y?wj:bj,R=!1,j;this.scanner.skipSC(),this.eat(fj);let Y=this.scanner.tokenIndex;if(y||this.scanner.skipSC(),T?j=this.parseWithFallback(Sj,n):j=n.call(this,this.scanner.tokenIndex),y&&j.type==="Value"&&j.children.isEmpty()){for(let re=Y-this.scanner.tokenIndex;re<=0;re++)if(this.scanner.lookupType(re)===mj){j.children.appendData({type:"WhiteSpace",loc:null,value:" "});break}}return this.scanner.isDelim(MI)&&(R=Cj.call(this),this.scanner.skipSC()),this.scanner.eof===!1&&this.scanner.tokenType!==LI&&this.scanner.isBalanceEdge(h)===!1&&this.error(),{type:"Declaration",loc:this.getLocation(d,this.scanner.tokenStart),important:R,property:v,value:j}},generate:function(d){this.chunk(d.property),this.chunk(":"),this.node(d.value),d.important&&this.chunk(d.important===!0?"!important":"!"+d.important)},walkContext:"declaration"};function Tj(){var d=this.scanner.tokenStart,h=0;if(this.scanner.tokenType===zI)switch(this.scanner.source.charCodeAt(this.scanner.tokenStart)){case vj:case _j:case xj:case gj:case yj:this.scanner.next();break;case kI:this.scanner.next(),this.scanner.isDelim(kI)&&this.scanner.next();break}return h&&this.scanner.skip(h),this.scanner.tokenType===AI?this.eat(AI):this.eat(PI),this.scanner.substrToCursor(d)}function Cj(){this.eat(zI),this.scanner.skipSC();var d=this.consume(PI);return d==="important"?!0:d}});var BI=ot((AW,DI)=>{var pb=Ei().TYPE,Ej=Uu().mode,Aj=pb.WhiteSpace,kj=pb.Comment,Ij=pb.Semicolon;function Pj(d){return this.Raw(d,Ej.semicolonIncluded,!0)}DI.exports={name:"DeclarationList",structure:{children:[["Declaration"]]},parse:function(){for(var d=this.createList();!this.scanner.eof;)switch(this.scanner.tokenType){case Aj:case kj:case Ij:this.scanner.next();break;default:d.push(this.parseWithFallback(this.Declaration,Pj))}return{type:"DeclarationList",loc:this.getLocationFromList(d),children:d}},generate:function(d){this.children(d,function(h){h.type==="Declaration"&&this.chunk(";")})}}});var NI=ot((kW,FI)=>{var Lj=cp().consumeNumber,zj=Ei().TYPE,Mj=zj.Dimension;FI.exports={name:"Dimension",structure:{value:String,unit:String},parse:function(){var d=this.scanner.tokenStart,h=Lj(this.scanner.source,d);return this.eat(Mj),{type:"Dimension",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.source.substring(d,h),unit:this.scanner.source.substring(h,this.scanner.tokenStart)}},generate:function(d){this.chunk(d.value),this.chunk(d.unit)}}});var VI=ot((IW,jI)=>{var Oj=Ei().TYPE,Rj=Oj.RightParenthesis;jI.exports={name:"Function",structure:{name:String,children:[[]]},parse:function(d,h){var v=this.scanner.tokenStart,y=this.consumeFunctionName(),T=y.toLowerCase(),n;return n=h.hasOwnProperty(T)?h[T].call(this,h):d.call(this,h),this.scanner.eof||this.eat(Rj),{type:"Function",loc:this.getLocation(v,this.scanner.tokenStart),name:y,children:n}},generate:function(d){this.chunk(d.name),this.chunk("("),this.children(d),this.chunk(")")},walkContext:"function"}});var qI=ot((PW,UI)=>{var Dj=Ei().TYPE,Bj=Dj.Hash;UI.exports={name:"Hash",structure:{value:String},parse:function(){var d=this.scanner.tokenStart;return this.eat(Bj),{type:"Hash",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.substrToCursor(d+1)}},generate:function(d){this.chunk("#"),this.chunk(d.value)}}});var GI=ot((LW,WI)=>{var Fj=Ei().TYPE,Nj=Fj.Ident;WI.exports={name:"Identifier",structure:{name:String},parse:function(){return{type:"Identifier",loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),name:this.consume(Nj)}},generate:function(d){this.chunk(d.name)}}});var ZI=ot((zW,HI)=>{var jj=Ei().TYPE,Vj=jj.Hash;HI.exports={name:"IdSelector",structure:{name:String},parse:function(){var d=this.scanner.tokenStart;return this.eat(Vj),{type:"IdSelector",loc:this.getLocation(d,this.scanner.tokenStart),name:this.scanner.substrToCursor(d+1)}},generate:function(d){this.chunk("#"),this.chunk(d.name)}}});var KI=ot((MW,YI)=>{var Dd=Ei().TYPE,$I=Dd.Ident,Uj=Dd.Number,qj=Dd.Dimension,Wj=Dd.LeftParenthesis,XI=Dd.RightParenthesis,Gj=Dd.Colon,Hj=Dd.Delim;YI.exports={name:"MediaFeature",structure:{name:String,value:["Identifier","Number","Dimension","Ratio",null]},parse:function(){var d=this.scanner.tokenStart,h,v=null;if(this.eat(Wj),this.scanner.skipSC(),h=this.consume($I),this.scanner.skipSC(),this.scanner.tokenType!==XI){switch(this.eat(Gj),this.scanner.skipSC(),this.scanner.tokenType){case Uj:this.lookupNonWSType(1)===Hj?v=this.Ratio():v=this.Number();break;case qj:v=this.Dimension();break;case $I:v=this.Identifier();break;default:this.error("Number, dimension, ratio or identifier is expected")}this.scanner.skipSC()}return this.eat(XI),{type:"MediaFeature",loc:this.getLocation(d,this.scanner.tokenStart),name:h,value:v}},generate:function(d){this.chunk("("),this.chunk(d.name),d.value!==null&&(this.chunk(":"),this.node(d.value)),this.chunk(")")}}});var QI=ot((OW,JI)=>{var Iy=Ei().TYPE,Zj=Iy.WhiteSpace,$j=Iy.Comment,Xj=Iy.Ident,Yj=Iy.LeftParenthesis;JI.exports={name:"MediaQuery",structure:{children:[["Identifier","MediaFeature","WhiteSpace"]]},parse:function(){this.scanner.skipSC();var d=this.createList(),h=null,v=null;e:for(;!this.scanner.eof;){switch(this.scanner.tokenType){case $j:this.scanner.next();continue;case Zj:v=this.WhiteSpace();continue;case Xj:h=this.Identifier();break;case Yj:h=this.MediaFeature();break;default:break e}v!==null&&(d.push(v),v=null),d.push(h)}return h===null&&this.error("Identifier or parenthesis is expected"),{type:"MediaQuery",loc:this.getLocationFromList(d),children:d}},generate:function(d){this.children(d)}}});var tP=ot((RW,eP)=>{var Kj=Ei().TYPE.Comma;eP.exports={name:"MediaQueryList",structure:{children:[["MediaQuery"]]},parse:function(d){var h=this.createList();for(this.scanner.skipSC();!this.scanner.eof&&(h.push(this.MediaQuery(d)),this.scanner.tokenType===Kj);)this.scanner.next();return{type:"MediaQueryList",loc:this.getLocationFromList(h),children:h}},generate:function(d){this.children(d,function(){this.chunk(",")})}}});var rP=ot((DW,iP)=>{iP.exports={name:"Nth",structure:{nth:["AnPlusB","Identifier"],selector:["SelectorList",null]},parse:function(d){this.scanner.skipSC();var h=this.scanner.tokenStart,v=h,y=null,T;return this.scanner.lookupValue(0,"odd")||this.scanner.lookupValue(0,"even")?T=this.Identifier():T=this.AnPlusB(),this.scanner.skipSC(),d&&this.scanner.lookupValue(0,"of")?(this.scanner.next(),y=this.SelectorList(),this.needPositions&&(v=this.getLastListNode(y.children).loc.end.offset)):this.needPositions&&(v=T.loc.end.offset),{type:"Nth",loc:this.getLocation(h,v),nth:T,selector:y}},generate:function(d){this.node(d.nth),d.selector!==null&&(this.chunk(" of "),this.node(d.selector))}}});var oP=ot((BW,nP)=>{var Jj=Ei().TYPE.Number;nP.exports={name:"Number",structure:{value:String},parse:function(){return{type:"Number",loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),value:this.consume(Jj)}},generate:function(d){this.chunk(d.value)}}});var aP=ot((FW,sP)=>{sP.exports={name:"Operator",structure:{value:String},parse:function(){var d=this.scanner.tokenStart;return this.scanner.next(),{type:"Operator",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.substrToCursor(d)}},generate:function(d){this.chunk(d.value)}}});var uP=ot((NW,cP)=>{var lP=Ei().TYPE,Qj=lP.LeftParenthesis,eV=lP.RightParenthesis;cP.exports={name:"Parentheses",structure:{children:[[]]},parse:function(d,h){var v=this.scanner.tokenStart,y=null;return this.eat(Qj),y=d.call(this,h),this.scanner.eof||this.eat(eV),{type:"Parentheses",loc:this.getLocation(v,this.scanner.tokenStart),children:y}},generate:function(d){this.chunk("("),this.children(d),this.chunk(")")}}});var hP=ot((jW,dP)=>{var tV=cp().consumeNumber,iV=Ei().TYPE,rV=iV.Percentage;dP.exports={name:"Percentage",structure:{value:String},parse:function(){var d=this.scanner.tokenStart,h=tV(this.scanner.source,d);return this.eat(rV),{type:"Percentage",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.source.substring(d,h)}},generate:function(d){this.chunk(d.value),this.chunk("%")}}});var fP=ot((VW,pP)=>{var Py=Ei().TYPE,nV=Py.Ident,oV=Py.Function,sV=Py.Colon,aV=Py.RightParenthesis;pP.exports={name:"PseudoClassSelector",structure:{name:String,children:[["Raw"],null]},parse:function(){var d=this.scanner.tokenStart,h=null,v,y;return this.eat(sV),this.scanner.tokenType===oV?(v=this.consumeFunctionName(),y=v.toLowerCase(),this.pseudo.hasOwnProperty(y)?(this.scanner.skipSC(),h=this.pseudo[y].call(this),this.scanner.skipSC()):(h=this.createList(),h.push(this.Raw(this.scanner.tokenIndex,null,!1))),this.eat(aV)):v=this.consume(nV),{type:"PseudoClassSelector",loc:this.getLocation(d,this.scanner.tokenStart),name:v,children:h}},generate:function(d){this.chunk(":"),this.chunk(d.name),d.children!==null&&(this.chunk("("),this.children(d),this.chunk(")"))},walkContext:"function"}});var _P=ot((UW,gP)=>{var Ly=Ei().TYPE,lV=Ly.Ident,cV=Ly.Function,mP=Ly.Colon,uV=Ly.RightParenthesis;gP.exports={name:"PseudoElementSelector",structure:{name:String,children:[["Raw"],null]},parse:function(){var d=this.scanner.tokenStart,h=null,v,y;return this.eat(mP),this.eat(mP),this.scanner.tokenType===cV?(v=this.consumeFunctionName(),y=v.toLowerCase(),this.pseudo.hasOwnProperty(y)?(this.scanner.skipSC(),h=this.pseudo[y].call(this),this.scanner.skipSC()):(h=this.createList(),h.push(this.Raw(this.scanner.tokenIndex,null,!1))),this.eat(uV)):v=this.consume(lV),{type:"PseudoElementSelector",loc:this.getLocation(d,this.scanner.tokenStart),name:v,children:h}},generate:function(d){this.chunk("::"),this.chunk(d.name),d.children!==null&&(this.chunk("("),this.children(d),this.chunk(")"))},walkContext:"function"}});var bP=ot((qW,xP)=>{var dV=Ei().isDigit,vP=Ei().TYPE,hV=vP.Number,pV=vP.Delim,fV=47,mV=46;function yP(){this.scanner.skipWS();for(var d=this.consume(hV),h=0;h<d.length;h++){var v=d.charCodeAt(h);!dV(v)&&v!==mV&&this.error("Unsigned number is expected",this.scanner.tokenStart-d.length+h)}return Number(d)===0&&this.error("Zero number is not allowed",this.scanner.tokenStart-d.length),d}xP.exports={name:"Ratio",structure:{left:String,right:String},parse:function(){var d=this.scanner.tokenStart,h=yP.call(this),v;return this.scanner.skipWS(),this.scanner.isDelim(fV)||this.error("Solidus is expected"),this.eat(pV),v=yP.call(this),{type:"Ratio",loc:this.getLocation(d,this.scanner.tokenStart),left:h,right:v}},generate:function(d){this.chunk(d.left),this.chunk("/"),this.chunk(d.right)}}});var TP=ot((WW,SP)=>{var gV=Ei().TYPE,_V=Uu().mode,yV=gV.LeftCurlyBracket;function wP(d){return this.Raw(d,_V.leftCurlyBracket,!0)}function vV(){var d=this.SelectorList();return d.type!=="Raw"&&this.scanner.eof===!1&&this.scanner.tokenType!==yV&&this.error(),d}SP.exports={name:"Rule",structure:{prelude:["SelectorList","Raw"],block:["Block"]},parse:function(){var d=this.scanner.tokenIndex,h=this.scanner.tokenStart,v,y;return this.parseRulePrelude?v=this.parseWithFallback(vV,wP):v=wP.call(this,d),y=this.Block(!0),{type:"Rule",loc:this.getLocation(h,this.scanner.tokenStart),prelude:v,block:y}},generate:function(d){this.node(d.prelude),this.node(d.block)},walkContext:"rule"}});var EP=ot((GW,CP)=>{CP.exports={name:"Selector",structure:{children:[["TypeSelector","IdSelector","ClassSelector","AttributeSelector","PseudoClassSelector","PseudoElementSelector","Combinator","WhiteSpace"]]},parse:function(){var d=this.readSequence(this.scope.Selector);return this.getFirstListNode(d)===null&&this.error("Selector is expected"),{type:"Selector",loc:this.getLocationFromList(d),children:d}},generate:function(d){this.children(d)}}});var kP=ot((HW,AP)=>{var xV=Ei().TYPE,bV=xV.Comma;AP.exports={name:"SelectorList",structure:{children:[["Selector","Raw"]]},parse:function(){for(var d=this.createList();!this.scanner.eof;){if(d.push(this.Selector()),this.scanner.tokenType===bV){this.scanner.next();continue}break}return{type:"SelectorList",loc:this.getLocationFromList(d),children:d}},generate:function(d){this.children(d,function(){this.chunk(",")})},walkContext:"selector"}});var PP=ot((ZW,IP)=>{var wV=Ei().TYPE.String;IP.exports={name:"String",structure:{value:String},parse:function(){return{type:"String",loc:this.getLocation(this.scanner.tokenStart,this.scanner.tokenEnd),value:this.consume(wV)}},generate:function(d){this.chunk(d.value)}}});var MP=ot(($W,zP)=>{var jm=Ei().TYPE,SV=jm.WhiteSpace,TV=jm.Comment,CV=jm.AtKeyword,EV=jm.CDO,AV=jm.CDC,kV=33;function LP(d){return this.Raw(d,null,!1)}zP.exports={name:"StyleSheet",structure:{children:[["Comment","CDO","CDC","Atrule","Rule","Raw"]]},parse:function(){for(var d=this.scanner.tokenStart,h=this.createList(),v;!this.scanner.eof;){switch(this.scanner.tokenType){case SV:this.scanner.next();continue;case TV:if(this.scanner.source.charCodeAt(this.scanner.tokenStart+2)!==kV){this.scanner.next();continue}v=this.Comment();break;case EV:v=this.CDO();break;case AV:v=this.CDC();break;case CV:v=this.parseWithFallback(this.Atrule,LP);break;default:v=this.parseWithFallback(this.Rule,LP)}h.push(v)}return{type:"StyleSheet",loc:this.getLocation(d,this.scanner.tokenStart),children:h}},generate:function(d){this.children(d)},walkContext:"stylesheet"}});var DP=ot((XW,RP)=>{var IV=Ei().TYPE,PV=IV.Ident,LV=42,OP=124;function fb(){this.scanner.tokenType!==PV&&this.scanner.isDelim(LV)===!1&&this.error("Identifier or asterisk is expected"),this.scanner.next()}RP.exports={name:"TypeSelector",structure:{name:String},parse:function(){var d=this.scanner.tokenStart;return this.scanner.isDelim(OP)?(this.scanner.next(),fb.call(this)):(fb.call(this),this.scanner.isDelim(OP)&&(this.scanner.next(),fb.call(this))),{type:"TypeSelector",loc:this.getLocation(d,this.scanner.tokenStart),name:this.scanner.substrToCursor(d)}},generate:function(d){this.chunk(d.name)}}});var UP=ot((YW,VP)=>{var zV=Ei().isHexDigit,BP=Ei().cmpChar,_b=Ei().TYPE,MV=Ei().NAME,OV=_b.Ident,FP=_b.Number,NP=_b.Dimension,My=43,jP=45,gb=63,RV=117;function Vm(d,h){for(var v=this.scanner.tokenStart+d,y=0;v<this.scanner.tokenEnd;v++){var T=this.scanner.source.charCodeAt(v);if(T===jP&&h&&y!==0)return Vm.call(this,d+y+1,!1)===0&&this.error(),-1;zV(T)||this.error(h&&y!==0?"HyphenMinus"+(y<6?" or hex digit":"")+" is expected":y<6?"Hex digit is expected":"Unexpected input",v),++y>6&&this.error("Too many hex digits",v)}return this.scanner.next(),y}function zy(d){for(var h=0;this.scanner.isDelim(gb);)++h>d&&this.error("Too many question marks"),this.scanner.next()}function mb(d){this.scanner.source.charCodeAt(this.scanner.tokenStart)!==d&&this.error(MV[d]+" is expected")}function DV(){var d=0;if(this.scanner.isDelim(My)){if(this.scanner.next(),this.scanner.tokenType===OV){d=Vm.call(this,0,!0),d>0&&zy.call(this,6-d);return}if(this.scanner.isDelim(gb)){this.scanner.next(),zy.call(this,5);return}this.error("Hex digit or question mark is expected");return}if(this.scanner.tokenType===FP){if(mb.call(this,My),d=Vm.call(this,1,!0),this.scanner.isDelim(gb)){zy.call(this,6-d);return}if(this.scanner.tokenType===NP||this.scanner.tokenType===FP){mb.call(this,jP),Vm.call(this,1,!1);return}return}if(this.scanner.tokenType===NP){mb.call(this,My),d=Vm.call(this,1,!0),d>0&&zy.call(this,6-d);return}this.error()}VP.exports={name:"UnicodeRange",structure:{value:String},parse:function(){var d=this.scanner.tokenStart;return BP(this.scanner.source,d,RV)||this.error("U is expected"),BP(this.scanner.source,d+1,My)||this.error("Plus sign is expected"),this.scanner.next(),DV.call(this),{type:"UnicodeRange",loc:this.getLocation(d,this.scanner.tokenStart),value:this.scanner.substrToCursor(d)}},generate:function(d){this.chunk(d.value)}}});var ZP=ot((KW,HP)=>{var qP=Ei().isWhiteSpace,BV=Ei().cmpStr,yb=Ei().TYPE,WP=yb.Function,GP=yb.Url,FV=yb.RightParenthesis;HP.exports={name:"Url",structure:{value:["String","Raw"]},parse:function(){var d=this.scanner.tokenStart,h;switch(this.scanner.tokenType){case GP:for(var v=d+4,y=this.scanner.tokenEnd-1;v<y&&qP(this.scanner.source.charCodeAt(v));)v++;for(;v<y&&qP(this.scanner.source.charCodeAt(y-1));)y--;h={type:"Raw",loc:this.getLocation(v,y),value:this.scanner.source.substring(v,y)},this.eat(GP);break;case WP:BV(this.scanner.source,this.scanner.tokenStart,this.scanner.tokenEnd,"url(")||this.error("Function name must be `url`"),this.eat(WP),this.scanner.skipSC(),h=this.String(),this.scanner.skipSC(),this.eat(FV);break;default:this.error("Url or Function is expected")}return{type:"Url",loc:this.getLocation(d,this.scanner.tokenStart),value:h}},generate:function(d){this.chunk("url"),this.chunk("("),this.node(d.value),this.chunk(")")}}});var XP=ot((JW,$P)=>{$P.exports={name:"Value",structure:{children:[[]]},parse:function(){var d=this.scanner.tokenStart,h=this.readSequence(this.scope.Value);return{type:"Value",loc:this.getLocation(d,this.scanner.tokenStart),children:h}},generate:function(d){this.children(d)}}});var KP=ot((QW,YP)=>{var NV=Ei().TYPE.WhiteSpace,jV=Object.freeze({type:"WhiteSpace",loc:null,value:" "});YP.exports={name:"WhiteSpace",structure:{value:String},parse:function(){return this.eat(NV),jV},generate:function(d){this.chunk(d.value)}}});var Oy=ot((eG,JP)=>{JP.exports={AnPlusB:Gk(),Atrule:Qk(),AtrulePrelude:iI(),AttributeSelector:sI(),Block:hI(),Brackets:mI(),CDC:_I(),CDO:vI(),ClassSelector:bI(),Combinator:TI(),Comment:EI(),Declaration:RI(),DeclarationList:BI(),Dimension:NI(),Function:VI(),Hash:qI(),Identifier:GI(),IdSelector:ZI(),MediaFeature:KI(),MediaQuery:QI(),MediaQueryList:tP(),Nth:rP(),Number:oP(),Operator:aP(),Parentheses:uP(),Percentage:hP(),PseudoClassSelector:fP(),PseudoElementSelector:_P(),Ratio:bP(),Raw:Uu(),Rule:TP(),Selector:EP(),SelectorList:kP(),String:PP(),StyleSheet:MP(),TypeSelector:DP(),UnicodeRange:UP(),Url:ZP(),Value:XP(),WhiteSpace:KP()}});var eL=ot((tG,QP)=>{var vb=Nk();QP.exports={generic:!0,types:vb.types,atrules:vb.atrules,properties:vb.properties,node:Oy()}});var xb=ot((iG,rL)=>{var tL=Ei().cmpChar,VV=Ei().cmpStr,$a=Ei().TYPE,UV=$a.Ident,qV=$a.String,WV=$a.Number,GV=$a.Function,HV=$a.Url,ZV=$a.Hash,$V=$a.Dimension,XV=$a.Percentage,YV=$a.LeftParenthesis,KV=$a.LeftSquareBracket,JV=$a.Comma,QV=$a.Delim,eU=35,tU=42,iL=43,iU=45,rU=47,nU=117;rL.exports=function(h){switch(this.scanner.tokenType){case ZV:return this.Hash();case JV:return h.space=null,h.ignoreWSAfter=!0,this.Operator();case YV:return this.Parentheses(this.readSequence,h.recognizer);case KV:return this.Brackets(this.readSequence,h.recognizer);case qV:return this.String();case $V:return this.Dimension();case XV:return this.Percentage();case WV:return this.Number();case GV:return VV(this.scanner.source,this.scanner.tokenStart,this.scanner.tokenEnd,"url(")?this.Url():this.Function(this.readSequence,h.recognizer);case HV:return this.Url();case UV:return tL(this.scanner.source,this.scanner.tokenStart,nU)&&tL(this.scanner.source,this.scanner.tokenStart+1,iL)?this.UnicodeRange():this.Identifier();case QV:var v=this.scanner.source.charCodeAt(this.scanner.tokenStart);if(v===rU||v===tU||v===iL||v===iU)return this.Operator();v===eU&&this.error("Hex or identifier is expected",this.scanner.tokenStart+1);break}}});var oL=ot((rG,nL)=>{nL.exports={getNode:xb()}});var cL=ot((nG,lL)=>{var qu=Ei().TYPE,oU=qu.Delim,sU=qu.Ident,aU=qu.Dimension,lU=qu.Percentage,cU=qu.Number,uU=qu.Hash,sL=qu.Colon,dU=qu.LeftSquareBracket,hU=35,pU=42,fU=43,mU=47,aL=46,gU=62,_U=124,yU=126;function vU(d){switch(this.scanner.tokenType){case dU:return this.AttributeSelector();case uU:return this.IdSelector();case sL:return this.scanner.lookupType(1)===sL?this.PseudoElementSelector():this.PseudoClassSelector();case sU:return this.TypeSelector();case cU:case lU:return this.Percentage();case aU:this.scanner.source.charCodeAt(this.scanner.tokenStart)===aL&&this.error("Identifier is expected",this.scanner.tokenStart+1);break;case oU:var h=this.scanner.source.charCodeAt(this.scanner.tokenStart);switch(h){case fU:case gU:case yU:return d.space=null,d.ignoreWSAfter=!0,this.Combinator();case mU:return this.Combinator();case aL:return this.ClassSelector();case pU:case _U:return this.TypeSelector();case hU:return this.IdSelector()}break}}lL.exports={getNode:vU}});var dL=ot((oG,uL)=>{uL.exports=function(){return this.createSingleNodeList(this.Raw(this.scanner.tokenIndex,null,!1))}});var fL=ot((sG,pL)=>{var hL=Ei().TYPE,xU=Uu().mode,bU=hL.Comma,wU=hL.WhiteSpace;pL.exports=function(){var d=this.createList();if(this.scanner.skipSC(),d.push(this.Identifier()),this.scanner.skipSC(),this.scanner.tokenType===bU){d.push(this.Operator());let h=this.scanner.tokenIndex,v=this.parseCustomProperty?this.Value(null):this.Raw(this.scanner.tokenIndex,xU.exclamationMarkOrSemicolon,!1);if(v.type==="Value"&&v.children.isEmpty()){for(let y=h-this.scanner.tokenIndex;y<=0;y++)if(this.scanner.lookupType(y)===wU){v.children.appendData({type:"WhiteSpace",loc:null,value:" "});break}}d.push(v)}return d}});var gL=ot((aG,mL)=>{mL.exports={getNode:xb(),expression:dL(),var:fL()}});var yL=ot((lG,_L)=>{_L.exports={AtrulePrelude:oL(),Selector:cL(),Value:gL()}});var xL=ot((cG,vL)=>{vL.exports={parse:{prelude:null,block:function(){return this.Block(!0)}}}});var wL=ot((uG,bL)=>{var Um=Ei().TYPE,SU=Um.String,TU=Um.Ident,CU=Um.Url,EU=Um.Function,AU=Um.LeftParenthesis;bL.exports={parse:{prelude:function(){var d=this.createList();switch(this.scanner.skipSC(),this.scanner.tokenType){case SU:d.push(this.String());break;case CU:case EU:d.push(this.Url());break;default:this.error("String or url() is expected")}return(this.lookupNonWSType(0)===TU||this.lookupNonWSType(0)===AU)&&(d.push(this.WhiteSpace()),d.push(this.MediaQueryList())),d},block:null}}});var TL=ot((dG,SL)=>{SL.exports={parse:{prelude:function(){return this.createSingleNodeList(this.MediaQueryList())},block:function(){return this.Block(!1)}}}});var EL=ot((hG,CL)=>{CL.exports={parse:{prelude:function(){return this.createSingleNodeList(this.SelectorList())},block:function(){return this.Block(!0)}}}});var PL=ot((pG,IL)=>{var Sp=Ei().TYPE,kU=Sp.WhiteSpace,IU=Sp.Comment,AL=Sp.Ident,PU=Sp.Function,LU=Sp.Colon,zU=Sp.LeftParenthesis;function MU(){return this.createSingleNodeList(this.Raw(this.scanner.tokenIndex,null,!1))}function OU(){return this.scanner.skipSC(),this.scanner.tokenType===AL&&this.lookupNonWSType(1)===LU?this.createSingleNodeList(this.Declaration()):kL.call(this)}function kL(){var d=this.createList(),h=null,v;this.scanner.skipSC();e:for(;!this.scanner.eof;){switch(this.scanner.tokenType){case kU:h=this.WhiteSpace();continue;case IU:this.scanner.next();continue;case PU:v=this.Function(MU,this.scope.AtrulePrelude);break;case AL:v=this.Identifier();break;case zU:v=this.Parentheses(OU,this.scope.AtrulePrelude);break;default:break e}h!==null&&(d.push(h),h=null),d.push(v)}return d}IL.exports={parse:{prelude:function(){var d=kL.call(this);return this.getFirstListNode(d)===null&&this.error("Condition is expected"),d},block:function(){return this.Block(!1)}}}});var zL=ot((fG,LL)=>{LL.exports={"font-face":xL(),import:wL(),media:TL(),page:EL(),supports:PL()}});var OL=ot((mG,ML)=>{ML.exports={parse:function(){return this.createSingleNodeList(this.Identifier())}}});var DL=ot((gG,RL)=>{RL.exports={parse:function(){return this.createSingleNodeList(this.SelectorList())}}});var FL=ot((_G,BL)=>{BL.exports={parse:function(){return this.createSingleNodeList(this.Identifier())}}});var bb=ot((yG,NL)=>{NL.exports={parse:function(){return this.createSingleNodeList(this.SelectorList())}}});var VL=ot((vG,jL)=>{jL.exports=bb()});var qL=ot((xG,UL)=>{UL.exports=bb()});var wb=ot((bG,WL)=>{var RU=!0;WL.exports={parse:function(){return this.createSingleNodeList(this.Nth(RU))}}});var HL=ot((wG,GL)=>{GL.exports=wb()});var $L=ot((SG,ZL)=>{ZL.exports=wb()});var Sb=ot((TG,XL)=>{var DU=!1;XL.exports={parse:function(){return this.createSingleNodeList(this.Nth(DU))}}});var KL=ot((CG,YL)=>{YL.exports=Sb()});var QL=ot((EG,JL)=>{JL.exports=Sb()});var tz=ot((AG,ez)=>{ez.exports={parse:function(){return this.createSingleNodeList(this.Selector())}}});var rz=ot((kG,iz)=>{iz.exports={dir:OL(),has:DL(),lang:FL(),matches:VL(),not:qL(),"nth-child":HL(),"nth-last-child":$L(),"nth-last-of-type":KL(),"nth-of-type":QL(),slotted:tz()}});var oz=ot((IG,nz)=>{nz.exports={parseContext:{default:"StyleSheet",stylesheet:"StyleSheet",atrule:"Atrule",atrulePrelude:function(d){return this.AtrulePrelude(d.atrule?String(d.atrule):null)},mediaQueryList:"MediaQueryList",mediaQuery:"MediaQuery",rule:"Rule",selectorList:"SelectorList",selector:"Selector",block:function(){return this.Block(!0)},declarationList:"DeclarationList",declaration:"Declaration",value:"Value"},scope:yL(),atrule:zL(),pseudo:rz(),node:Oy()}});var az=ot((PG,sz)=>{sz.exports={node:Oy()}});var lz=ot((LG,BU)=>{BU.exports={name:"css-tree",version:"1.1.3",description:"A tool set for CSS: fast detailed parser (CSS \u2192 AST), walker (AST traversal), generator (AST \u2192 CSS) and lexer (validation and matching) based on specs and browser implementations",author:"Roman Dvornov <rdvornov@gmail.com> (https://github.com/lahmatiy)",license:"MIT",repository:"csstree/csstree",keywords:["css","ast","tokenizer","parser","walker","lexer","generator","utils","syntax","validation"],main:"lib/index.js",unpkg:"dist/csstree.min.js",jsdelivr:"dist/csstree.min.js",scripts:{build:"rollup --config",lint:"eslint data lib scripts test && node scripts/review-syntax-patch --lint && node scripts/update-docs --lint","lint-and-test":"npm run lint && npm test","update:docs":"node scripts/update-docs","review:syntax-patch":"node scripts/review-syntax-patch",test:"mocha --reporter progress",coverage:"nyc npm test",travis:"nyc npm run lint-and-test && npm run coveralls",coveralls:"nyc report --reporter=text-lcov | coveralls",prepublishOnly:"npm run build",hydrogen:"node --trace-hydrogen --trace-phase=Z --trace-deopt --code-comments --hydrogen-track-positions --redirect-code-traces --redirect-code-traces-to=code.asm --trace_hydrogen_file=code.cfg --print-opt-code bin/parse --stat -o /dev/null"},dependencies:{"mdn-data":"2.0.14","source-map":"^0.6.1"},devDependencies:{"@rollup/plugin-commonjs":"^11.0.2","@rollup/plugin-json":"^4.0.2","@rollup/plugin-node-resolve":"^7.1.1",coveralls:"^3.0.9",eslint:"^6.8.0","json-to-ast":"^2.1.0",mocha:"^6.2.3",nyc:"^14.1.1",rollup:"^1.32.1","rollup-plugin-terser":"^5.3.0"},engines:{node:">=8.0.0"},files:["data","dist","lib"]}});var cz=ot((zG,Tb)=>{function FU(){for(var d={},h=0;h<arguments.length;h++){var v=arguments[h];for(var y in v)d[y]=v[y]}return d}Tb.exports=Lk().create(FU(eL(),oz(),az()));Tb.exports.version=lz().version});var fs=ot((MG,uz)=>{uz.exports=cz()});var jz=ot(Gm=>{var NU=/(\[[^\]]+\])/g,jU=/(#[^\s\+>~\.\[:]+)/g,VU=/(\.[^\s\+>~\.\[:]+)/g,UU=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/g,qU=/(:[^\s\+>~\.\[:]+)/g,WU=/([^\s\+>~\.\[:]+)/g,GU=/:not\(([^\)]*)\)/g,HU=/\{[^]*/gm,ZU=/[\*\s\+>~]/g,$U=/[#\.]/g,Cp=function(d,h,v,y){var T=y.match(d);if(T)for(var n=0;n<T.length;n++)v[h]++,y=y.replace(T[n]," ");return y},XU=function(d){var h=d.indexOf(",");h!==-1&&(d=d.substring(0,h));var v={a:0,b:0,c:0};return d=d.replace(GU," $1 "),d=d.replace(HU," "),d=Cp(NU,"b",v,d),d=Cp(jU,"a",v,d),d=Cp(VU,"b",v,d),d=Cp(UU,"c",v,d),d=Cp(qU,"b",v,d),d=d.replace(ZU," "),d=d.replace($U," "),Cp(WU,"c",v,d),v.a*100+v.b*10+v.c*1},Fz={};Gm.calculateSpecificity=function(d){var h=Fz[d];return h===void 0&&(h=XU(d),Fz[d]=h),h};var Nz={},Kb=null;Gm.isSelectorValid=function(d){var h=Nz[d];if(h===void 0){Kb==null&&(Kb=document.createElement("div"));try{Kb.querySelector(d),h=!0}catch{h=!1}Nz[d]=h}return h};Gm.validateSelector=function(d){if(!Gm.isSelectorValid(d)){var h=new SyntaxError(d+" is not a valid selector");throw h.code="EBADSELECTOR",h}}});var Hz=ot((mZ,Gz)=>{"use strict";Gz.exports=function(){var d=Array.from,h,v;return typeof d!="function"?!1:(h=["raz","dwa"],v=d(h),!!(v&&v!==h&&v[1]==="dwa"))}});var $z=ot((gZ,Zz)=>{"use strict";Zz.exports=function(){return typeof globalThis!="object"||!globalThis?!1:globalThis.Array===Array}});var Kz=ot((_Z,Yz)=>{var Xz=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};Yz.exports=(function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return Xz()}try{return __global__||Xz()}finally{delete Object.prototype.__global__}})()});var Hm=ot((yZ,Jz)=>{"use strict";Jz.exports=$z()()?globalThis:Kz()});var eM=ot((vZ,Qz)=>{"use strict";var YU=Hm(),Qb={object:!0,symbol:!0};Qz.exports=function(){var d=YU.Symbol,h;if(typeof d!="function")return!1;h=d("test symbol");try{String(h)}catch{return!1}return!(!Qb[typeof d.iterator]||!Qb[typeof d.toPrimitive]||!Qb[typeof d.toStringTag])}});var iM=ot((xZ,tM)=>{"use strict";tM.exports=function(d){return d?typeof d=="symbol"?!0:!d.constructor||d.constructor.name!=="Symbol"?!1:d[d.constructor.toStringTag]==="Symbol":!1}});var e1=ot((bZ,rM)=>{"use strict";var KU=iM();rM.exports=function(d){if(!KU(d))throw new TypeError(d+" is not a symbol");return d}});var lM=ot((wZ,aM)=>{"use strict";var nM=Ld(),JU=Object.create,oM=Object.defineProperty,QU=Object.prototype,sM=JU(null);aM.exports=function(d){for(var h=0,v,y;sM[d+(h||"")];)++h;return d+=h||"",sM[d]=!0,v="@@"+d,oM(QU,v,nM.gs(null,function(T){y||(y=!0,oM(this,v,nM(T)),y=!1)})),v}});var uM=ot((SZ,cM)=>{"use strict";var Sl=Ld(),ro=Hm().Symbol;cM.exports=function(d){return Object.defineProperties(d,{hasInstance:Sl("",ro&&ro.hasInstance||d("hasInstance")),isConcatSpreadable:Sl("",ro&&ro.isConcatSpreadable||d("isConcatSpreadable")),iterator:Sl("",ro&&ro.iterator||d("iterator")),match:Sl("",ro&&ro.match||d("match")),replace:Sl("",ro&&ro.replace||d("replace")),search:Sl("",ro&&ro.search||d("search")),species:Sl("",ro&&ro.species||d("species")),split:Sl("",ro&&ro.split||d("split")),toPrimitive:Sl("",ro&&ro.toPrimitive||d("toPrimitive")),toStringTag:Sl("",ro&&ro.toStringTag||d("toStringTag")),unscopables:Sl("",ro&&ro.unscopables||d("unscopables"))})}});var pM=ot((TZ,hM)=>{"use strict";var dM=Ld(),e6=e1(),Zm=Object.create(null);hM.exports=function(d){return Object.defineProperties(d,{for:dM(function(h){return Zm[h]?Zm[h]:Zm[h]=d(String(h))}),keyFor:dM(function(h){var v;e6(h);for(v in Zm)if(Zm[v]===h)return v})})}});var gM=ot((CZ,mM)=>{"use strict";var ac=Ld(),t1=e1(),Ny=Hm().Symbol,t6=lM(),i6=uM(),r6=pM(),n6=Object.create,i1=Object.defineProperties,jy=Object.defineProperty,ms,Ep,fM;if(typeof Ny=="function")try{String(Ny()),fM=!0}catch{}else Ny=null;Ep=function(h){if(this instanceof Ep)throw new TypeError("Symbol is not a constructor");return ms(h)};mM.exports=ms=function d(h){var v;if(this instanceof d)throw new TypeError("Symbol is not a constructor");return fM?Ny(h):(v=n6(Ep.prototype),h=h===void 0?"":String(h),i1(v,{__description__:ac("",h),__name__:ac("",t6(h))}))};i6(ms);r6(ms);i1(Ep.prototype,{constructor:ac(ms),toString:ac("",function(){return this.__name__})});i1(ms.prototype,{toString:ac(function(){return"Symbol ("+t1(this).__description__+")"}),valueOf:ac(function(){return t1(this)})});jy(ms.prototype,ms.toPrimitive,ac("",function(){var d=t1(this);return typeof d=="symbol"?d:d.toString()}));jy(ms.prototype,ms.toStringTag,ac("c","Symbol"));jy(Ep.prototype,ms.toStringTag,ac("c",ms.prototype[ms.toStringTag]));jy(Ep.prototype,ms.toPrimitive,ac("c",ms.prototype[ms.toPrimitive]))});var yM=ot((EZ,_M)=>{"use strict";_M.exports=eM()()?Hm().Symbol:gM()});var bM=ot((AZ,xM)=>{"use strict";var vM=Object.prototype.toString,o6=vM.call((function(){return arguments})());xM.exports=function(d){return vM.call(d)===o6}});var SM=ot((kZ,wM)=>{"use strict";var s6=Object.prototype.toString,a6=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);wM.exports=function(d){return typeof d=="function"&&a6(s6.call(d))}});var CM=ot((IZ,TM)=>{"use strict";TM.exports=function(){var d=Math.sign;return typeof d!="function"?!1:d(10)===1&&d(-20)===-1}});var AM=ot((PZ,EM)=>{"use strict";EM.exports=function(d){return d=Number(d),isNaN(d)||d===0?d:d>0?1:-1}});var IM=ot((LZ,kM)=>{"use strict";kM.exports=CM()()?Math.sign:AM()});var LM=ot((zZ,PM)=>{"use strict";var l6=IM(),c6=Math.abs,u6=Math.floor;PM.exports=function(d){return isNaN(d)?0:(d=Number(d),d===0||!isFinite(d)?d:l6(d)*u6(c6(d)))}});var r1=ot((MZ,zM)=>{"use strict";var d6=LM(),h6=Math.max;zM.exports=function(d){return h6(0,d6(d))}});var RM=ot((OZ,OM)=>{"use strict";var MM=Object.prototype.toString,p6=MM.call("");OM.exports=function(d){return typeof d=="string"||d&&typeof d=="object"&&(d instanceof String||MM.call(d)===p6)||!1}});var NM=ot((RZ,FM)=>{"use strict";var f6=yM().iterator,m6=bM(),g6=SM(),_6=r1(),DM=Ux(),y6=F_(),v6=rp(),x6=RM(),BM=Array.isArray,n1=Function.prototype.call,Bd={configurable:!0,enumerable:!0,writable:!0,value:null},o1=Object.defineProperty;FM.exports=function(d){var h=arguments[1],v=arguments[2],y,T,n,R,j,Y,re,me,be,oe;if(d=Object(y6(d)),v6(h)&&DM(h),!this||this===Array||!g6(this)){if(!h){if(m6(d))return j=d.length,j!==1?Array.apply(null,d):(R=new Array(1),R[0]=d[0],R);if(BM(d)){for(R=new Array(j=d.length),T=0;T<j;++T)R[T]=d[T];return R}}R=[]}else y=this;if(!BM(d)){if((be=d[f6])!==void 0){for(re=DM(be).call(d),y&&(R=new y),me=re.next(),T=0;!me.done;)oe=h?n1.call(h,v,me.value,T):me.value,y?(Bd.value=oe,o1(R,T,Bd)):R[T]=oe,me=re.next(),++T;j=T}else if(x6(d)){for(j=d.length,y&&(R=new y),T=0,n=0;T<j;++T)oe=d[T],T+1<j&&(Y=oe.charCodeAt(0),Y>=55296&&Y<=56319&&(oe+=d[++T])),oe=h?n1.call(h,v,oe,n):oe,y?(Bd.value=oe,o1(R,n,Bd)):R[n]=oe,++n;j=n}}if(j===void 0)for(j=_6(d.length),y&&(R=new y(j)),T=0;T<j;++T)oe=h?n1.call(h,v,d[T],T):d[T],y?(Bd.value=oe,o1(R,T,Bd)):R[T]=oe;return y&&(Bd.value=null,R.length=j),R}});var VM=ot((DZ,jM)=>{"use strict";jM.exports=Hz()()?Array.from:NM()});var qM=ot((BZ,UM)=>{"use strict";UM.exports=function(){var d=Number.isNaN;return typeof d!="function"?!1:!d({})&&d(NaN)&&!d(34)}});var GM=ot((FZ,WM)=>{"use strict";WM.exports=function(d){return d!==d}});var ZM=ot((NZ,HM)=>{"use strict";HM.exports=qM()()?Number.isNaN:GM()});var JM=ot((jZ,KM)=>{"use strict";var $M=ZM(),XM=r1(),b6=F_(),w6=Array.prototype.indexOf,S6=Object.prototype.hasOwnProperty,T6=Math.abs,YM=Math.floor;KM.exports=function(d){var h,v,y,T;if(!$M(d))return w6.apply(this,arguments);for(v=XM(b6(this).length),y=arguments[1],isNaN(y)?y=0:y>=0?y=YM(y):y=XM(this.length)-YM(T6(y)),h=y;h<v;++h)if(S6.call(this,h)&&(T=this[h],$M(T)))return h;return-1}});var eO=ot((VZ,QM)=>{"use strict";var C6=JM(),E6=Array.prototype.forEach,A6=Array.prototype.splice;QM.exports=function(d){E6.call(arguments,function(h){var v=C6.call(this,h);v!==-1&&A6.call(this,v,1)},this)}});var iO=ot((UZ,tO)=>{"use strict";var k6=rp(),I6={function:!0,object:!0};tO.exports=function(d){return k6(d)&&I6[typeof d]||!1}});var nO=ot((qZ,rO)=>{"use strict";var P6=iO();rO.exports=function(d){if(!P6(d))throw new TypeError(d+" is not an Object");return d}});var uO=ot((WZ,cO)=>{"use strict";var L6=VM(),z6=eO(),oO=nO(),sO=Ld(),aO=Bu().methods.emit,lO=Object.defineProperty,M6=Object.prototype.hasOwnProperty,O6=Object.getOwnPropertyDescriptor;cO.exports=function(d,h){var v,y,T,n;return oO(d)&&oO(h),n=arguments[2],n===void 0&&(n="emit"),y={close:function(){z6.call(v,h)}},M6.call(d,"__eePipes__")?((v=d.__eePipes__).push(h),y):(lO(d,"__eePipes__",sO("c",v=[h])),T=O6(d,n),T?(delete T.get,delete T.set):T=sO("c",void 0),T.value=function(){var R,j,Y=L6(v);for(aO.apply(this,arguments),R=0;j=Y[R];++R)aO.apply(j,arguments)},lO(d,n,T),y)}});var c1=ot((Wy,fO)=>{(function(d,h){typeof Wy=="object"&&typeof fO<"u"?h(Wy):typeof define=="function"&&define.amd?define(["exports"],h):(d=typeof globalThis<"u"?globalThis:d||self,h(d.leaflet={}))})(Wy,(function(d){"use strict";var h="1.9.4";function v(m){var C,z,U,Q;for(z=1,U=arguments.length;z<U;z++){Q=arguments[z];for(C in Q)m[C]=Q[C]}return m}var y=Object.create||(function(){function m(){}return function(C){return m.prototype=C,new m}})();function T(m,C){var z=Array.prototype.slice;if(m.bind)return m.bind.apply(m,z.call(arguments,1));var U=z.call(arguments,2);return function(){return m.apply(C,U.length?U.concat(z.call(arguments)):arguments)}}var n=0;function R(m){return"_leaflet_id"in m||(m._leaflet_id=++n),m._leaflet_id}function j(m,C,z){var U,Q,fe,Ve;return Ve=function(){U=!1,Q&&(fe.apply(z,Q),Q=!1)},fe=function(){U?Q=arguments:(m.apply(z,arguments),setTimeout(Ve,C),U=!0)},fe}function Y(m,C,z){var U=C[1],Q=C[0],fe=U-Q;return m===U&&z?m:((m-Q)%fe+fe)%fe+Q}function re(){return!1}function me(m,C){if(C===!1)return m;var z=Math.pow(10,C===void 0?6:C);return Math.round(m*z)/z}function be(m){return m.trim?m.trim():m.replace(/^\s+|\s+$/g,"")}function oe(m){return be(m).split(/\s+/)}function Se(m,C){Object.prototype.hasOwnProperty.call(m,"options")||(m.options=m.options?y(m.options):{});for(var z in C)m.options[z]=C[z];return m.options}function Re(m,C,z){var U=[];for(var Q in m)U.push(encodeURIComponent(z?Q.toUpperCase():Q)+"="+encodeURIComponent(m[Q]));return(!C||C.indexOf("?")===-1?"?":"&")+U.join("&")}var tt=/\{ *([\w_ -]+) *\}/g;function yt(m,C){return m.replace(tt,function(z,U){var Q=C[U];if(Q===void 0)throw new Error("No value provided for variable "+z);return typeof Q=="function"&&(Q=Q(C)),Q})}var qe=Array.isArray||function(m){return Object.prototype.toString.call(m)==="[object Array]"};function St(m,C){for(var z=0;z<m.length;z++)if(m[z]===C)return z;return-1}var ai="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function pi(m){return window["webkit"+m]||window["moz"+m]||window["ms"+m]}var Cr=0;function lr(m){var C=+new Date,z=Math.max(0,16-(C-Cr));return Cr=C+z,window.setTimeout(m,z)}var bt=window.requestAnimationFrame||pi("RequestAnimationFrame")||lr,Wt=window.cancelAnimationFrame||pi("CancelAnimationFrame")||pi("CancelRequestAnimationFrame")||function(m){window.clearTimeout(m)};function li(m,C,z){if(z&&bt===lr)m.call(C);else return bt.call(window,T(m,C))}function Hi(m){m&&Wt.call(window,m)}var hi={__proto__:null,extend:v,create:y,bind:T,get lastId(){return n},stamp:R,throttle:j,wrapNum:Y,falseFn:re,formatNum:me,trim:be,splitWords:oe,setOptions:Se,getParamString:Re,template:yt,isArray:qe,indexOf:St,emptyImageUrl:ai,requestFn:bt,cancelFn:Wt,requestAnimFrame:li,cancelAnimFrame:Hi};function Di(){}Di.extend=function(m){var C=function(){Se(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},z=C.__super__=this.prototype,U=y(z);U.constructor=C,C.prototype=U;for(var Q in this)Object.prototype.hasOwnProperty.call(this,Q)&&Q!=="prototype"&&Q!=="__super__"&&(C[Q]=this[Q]);return m.statics&&v(C,m.statics),m.includes&&(kr(m.includes),v.apply(null,[U].concat(m.includes))),v(U,m),delete U.statics,delete U.includes,U.options&&(U.options=z.options?y(z.options):{},v(U.options,m.options)),U._initHooks=[],U.callInitHooks=function(){if(!this._initHooksCalled){z.callInitHooks&&z.callInitHooks.call(this),this._initHooksCalled=!0;for(var fe=0,Ve=U._initHooks.length;fe<Ve;fe++)U._initHooks[fe].call(this)}},C},Di.include=function(m){var C=this.prototype.options;return v(this.prototype,m),m.options&&(this.prototype.options=C,this.mergeOptions(m.options)),this},Di.mergeOptions=function(m){return v(this.prototype.options,m),this},Di.addInitHook=function(m){var C=Array.prototype.slice.call(arguments,1),z=typeof m=="function"?m:function(){this[m].apply(this,C)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(z),this};function kr(m){if(!(typeof L>"u"||!L||!L.Mixin)){m=qe(m)?m:[m];for(var C=0;C<m.length;C++)m[C]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Si={on:function(m,C,z){if(typeof m=="object")for(var U in m)this._on(U,m[U],C);else{m=oe(m);for(var Q=0,fe=m.length;Q<fe;Q++)this._on(m[Q],C,z)}return this},off:function(m,C,z){if(!arguments.length)delete this._events;else if(typeof m=="object")for(var U in m)this._off(U,m[U],C);else{m=oe(m);for(var Q=arguments.length===1,fe=0,Ve=m.length;fe<Ve;fe++)Q?this._off(m[fe]):this._off(m[fe],C,z)}return this},_on:function(m,C,z,U){if(typeof C!="function"){console.warn("wrong listener type: "+typeof C);return}if(this._listens(m,C,z)===!1){z===this&&(z=void 0);var Q={fn:C,ctx:z};U&&(Q.once=!0),this._events=this._events||{},this._events[m]=this._events[m]||[],this._events[m].push(Q)}},_off:function(m,C,z){var U,Q,fe;if(this._events&&(U=this._events[m],!!U)){if(arguments.length===1){if(this._firingCount)for(Q=0,fe=U.length;Q<fe;Q++)U[Q].fn=re;delete this._events[m];return}if(typeof C!="function"){console.warn("wrong listener type: "+typeof C);return}var Ve=this._listens(m,C,z);if(Ve!==!1){var ut=U[Ve];this._firingCount&&(ut.fn=re,this._events[m]=U=U.slice()),U.splice(Ve,1)}}},fire:function(m,C,z){if(!this.listens(m,z))return this;var U=v({},C,{type:m,target:this,sourceTarget:C&&C.sourceTarget||this});if(this._events){var Q=this._events[m];if(Q){this._firingCount=this._firingCount+1||1;for(var fe=0,Ve=Q.length;fe<Ve;fe++){var ut=Q[fe],wt=ut.fn;ut.once&&this.off(m,wt,ut.ctx),wt.call(ut.ctx||this,U)}this._firingCount--}}return z&&this._propagateEvent(U),this},listens:function(m,C,z,U){typeof m!="string"&&console.warn('"string" type argument expected');var Q=C;typeof C!="function"&&(U=!!C,Q=void 0,z=void 0);var fe=this._events&&this._events[m];if(fe&&fe.length&&this._listens(m,Q,z)!==!1)return!0;if(U){for(var Ve in this._eventParents)if(this._eventParents[Ve].listens(m,C,z,U))return!0}return!1},_listens:function(m,C,z){if(!this._events)return!1;var U=this._events[m]||[];if(!C)return!!U.length;z===this&&(z=void 0);for(var Q=0,fe=U.length;Q<fe;Q++)if(U[Q].fn===C&&U[Q].ctx===z)return Q;return!1},once:function(m,C,z){if(typeof m=="object")for(var U in m)this._on(U,m[U],C,!0);else{m=oe(m);for(var Q=0,fe=m.length;Q<fe;Q++)this._on(m[Q],C,z,!0)}return this},addEventParent:function(m){return this._eventParents=this._eventParents||{},this._eventParents[R(m)]=m,this},removeEventParent:function(m){return this._eventParents&&delete this._eventParents[R(m)],this},_propagateEvent:function(m){for(var C in this._eventParents)this._eventParents[C].fire(m.type,v({layer:m.target,propagatedFrom:m.target},m),!0)}};Si.addEventListener=Si.on,Si.removeEventListener=Si.clearAllEventListeners=Si.off,Si.addOneTimeEventListener=Si.once,Si.fireEvent=Si.fire,Si.hasEventListeners=Si.listens;var Ai=Di.extend(Si);function oi(m,C,z){this.x=z?Math.round(m):m,this.y=z?Math.round(C):C}var mo=Math.trunc||function(m){return m>0?Math.floor(m):Math.ceil(m)};oi.prototype={clone:function(){return new oi(this.x,this.y)},add:function(m){return this.clone()._add(Mi(m))},_add:function(m){return this.x+=m.x,this.y+=m.y,this},subtract:function(m){return this.clone()._subtract(Mi(m))},_subtract:function(m){return this.x-=m.x,this.y-=m.y,this},divideBy:function(m){return this.clone()._divideBy(m)},_divideBy:function(m){return this.x/=m,this.y/=m,this},multiplyBy:function(m){return this.clone()._multiplyBy(m)},_multiplyBy:function(m){return this.x*=m,this.y*=m,this},scaleBy:function(m){return new oi(this.x*m.x,this.y*m.y)},unscaleBy:function(m){return new oi(this.x/m.x,this.y/m.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=mo(this.x),this.y=mo(this.y),this},distanceTo:function(m){m=Mi(m);var C=m.x-this.x,z=m.y-this.y;return Math.sqrt(C*C+z*z)},equals:function(m){return m=Mi(m),m.x===this.x&&m.y===this.y},contains:function(m){return m=Mi(m),Math.abs(m.x)<=Math.abs(this.x)&&Math.abs(m.y)<=Math.abs(this.y)},toString:function(){return"Point("+me(this.x)+", "+me(this.y)+")"}};function Mi(m,C,z){return m instanceof oi?m:qe(m)?new oi(m[0],m[1]):m==null?m:typeof m=="object"&&"x"in m&&"y"in m?new oi(m.x,m.y):new oi(m,C,z)}function Dr(m,C){if(m)for(var z=C?[m,C]:m,U=0,Q=z.length;U<Q;U++)this.extend(z[U])}Dr.prototype={extend:function(m){var C,z;if(!m)return this;if(m instanceof oi||typeof m[0]=="number"||"x"in m)C=z=Mi(m);else if(m=gn(m),C=m.min,z=m.max,!C||!z)return this;return!this.min&&!this.max?(this.min=C.clone(),this.max=z.clone()):(this.min.x=Math.min(C.x,this.min.x),this.max.x=Math.max(z.x,this.max.x),this.min.y=Math.min(C.y,this.min.y),this.max.y=Math.max(z.y,this.max.y)),this},getCenter:function(m){return Mi((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,m)},getBottomLeft:function(){return Mi(this.min.x,this.max.y)},getTopRight:function(){return Mi(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(m){var C,z;return typeof m[0]=="number"||m instanceof oi?m=Mi(m):m=gn(m),m instanceof Dr?(C=m.min,z=m.max):C=z=m,C.x>=this.min.x&&z.x<=this.max.x&&C.y>=this.min.y&&z.y<=this.max.y},intersects:function(m){m=gn(m);var C=this.min,z=this.max,U=m.min,Q=m.max,fe=Q.x>=C.x&&U.x<=z.x,Ve=Q.y>=C.y&&U.y<=z.y;return fe&&Ve},overlaps:function(m){m=gn(m);var C=this.min,z=this.max,U=m.min,Q=m.max,fe=Q.x>C.x&&U.x<z.x,Ve=Q.y>C.y&&U.y<z.y;return fe&&Ve},isValid:function(){return!!(this.min&&this.max)},pad:function(m){var C=this.min,z=this.max,U=Math.abs(C.x-z.x)*m,Q=Math.abs(C.y-z.y)*m;return gn(Mi(C.x-U,C.y-Q),Mi(z.x+U,z.y+Q))},equals:function(m){return m?(m=gn(m),this.min.equals(m.getTopLeft())&&this.max.equals(m.getBottomRight())):!1}};function gn(m,C){return!m||m instanceof Dr?m:new Dr(m,C)}function er(m,C){if(m)for(var z=C?[m,C]:m,U=0,Q=z.length;U<Q;U++)this.extend(z[U])}er.prototype={extend:function(m){var C=this._southWest,z=this._northEast,U,Q;if(m instanceof Kr)U=m,Q=m;else if(m instanceof er){if(U=m._southWest,Q=m._northEast,!U||!Q)return this}else return m?this.extend(Pr(m)||nn(m)):this;return!C&&!z?(this._southWest=new Kr(U.lat,U.lng),this._northEast=new Kr(Q.lat,Q.lng)):(C.lat=Math.min(U.lat,C.lat),C.lng=Math.min(U.lng,C.lng),z.lat=Math.max(Q.lat,z.lat),z.lng=Math.max(Q.lng,z.lng)),this},pad:function(m){var C=this._southWest,z=this._northEast,U=Math.abs(C.lat-z.lat)*m,Q=Math.abs(C.lng-z.lng)*m;return new er(new Kr(C.lat-U,C.lng-Q),new Kr(z.lat+U,z.lng+Q))},getCenter:function(){return new Kr((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Kr(this.getNorth(),this.getWest())},getSouthEast:function(){return new Kr(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(m){typeof m[0]=="number"||m instanceof Kr||"lat"in m?m=Pr(m):m=nn(m);var C=this._southWest,z=this._northEast,U,Q;return m instanceof er?(U=m.getSouthWest(),Q=m.getNorthEast()):U=Q=m,U.lat>=C.lat&&Q.lat<=z.lat&&U.lng>=C.lng&&Q.lng<=z.lng},intersects:function(m){m=nn(m);var C=this._southWest,z=this._northEast,U=m.getSouthWest(),Q=m.getNorthEast(),fe=Q.lat>=C.lat&&U.lat<=z.lat,Ve=Q.lng>=C.lng&&U.lng<=z.lng;return fe&&Ve},overlaps:function(m){m=nn(m);var C=this._southWest,z=this._northEast,U=m.getSouthWest(),Q=m.getNorthEast(),fe=Q.lat>C.lat&&U.lat<z.lat,Ve=Q.lng>C.lng&&U.lng<z.lng;return fe&&Ve},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(m,C){return m?(m=nn(m),this._southWest.equals(m.getSouthWest(),C)&&this._northEast.equals(m.getNorthEast(),C)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function nn(m,C){return m instanceof er?m:new er(m,C)}function Kr(m,C,z){if(isNaN(m)||isNaN(C))throw new Error("Invalid LatLng object: ("+m+", "+C+")");this.lat=+m,this.lng=+C,z!==void 0&&(this.alt=+z)}Kr.prototype={equals:function(m,C){if(!m)return!1;m=Pr(m);var z=Math.max(Math.abs(this.lat-m.lat),Math.abs(this.lng-m.lng));return z<=(C===void 0?1e-9:C)},toString:function(m){return"LatLng("+me(this.lat,m)+", "+me(this.lng,m)+")"},distanceTo:function(m){return oo.distance(this,Pr(m))},wrap:function(){return oo.wrapLatLng(this)},toBounds:function(m){var C=180*m/40075017,z=C/Math.cos(Math.PI/180*this.lat);return nn([this.lat-C,this.lng-z],[this.lat+C,this.lng+z])},clone:function(){return new Kr(this.lat,this.lng,this.alt)}};function Pr(m,C,z){return m instanceof Kr?m:qe(m)&&typeof m[0]!="object"?m.length===3?new Kr(m[0],m[1],m[2]):m.length===2?new Kr(m[0],m[1]):null:m==null?m:typeof m=="object"&&"lat"in m?new Kr(m.lat,"lng"in m?m.lng:m.lon,m.alt):C===void 0?null:new Kr(m,C,z)}var Uo={latLngToPoint:function(m,C){var z=this.projection.project(m),U=this.scale(C);return this.transformation._transform(z,U)},pointToLatLng:function(m,C){var z=this.scale(C),U=this.transformation.untransform(m,z);return this.projection.unproject(U)},project:function(m){return this.projection.project(m)},unproject:function(m){return this.projection.unproject(m)},scale:function(m){return 256*Math.pow(2,m)},zoom:function(m){return Math.log(m/256)/Math.LN2},getProjectedBounds:function(m){if(this.infinite)return null;var C=this.projection.bounds,z=this.scale(m),U=this.transformation.transform(C.min,z),Q=this.transformation.transform(C.max,z);return new Dr(U,Q)},infinite:!1,wrapLatLng:function(m){var C=this.wrapLng?Y(m.lng,this.wrapLng,!0):m.lng,z=this.wrapLat?Y(m.lat,this.wrapLat,!0):m.lat,U=m.alt;return new Kr(z,C,U)},wrapLatLngBounds:function(m){var C=m.getCenter(),z=this.wrapLatLng(C),U=C.lat-z.lat,Q=C.lng-z.lng;if(U===0&&Q===0)return m;var fe=m.getSouthWest(),Ve=m.getNorthEast(),ut=new Kr(fe.lat-U,fe.lng-Q),wt=new Kr(Ve.lat-U,Ve.lng-Q);return new er(ut,wt)}},oo=v({},Uo,{wrapLng:[-180,180],R:6371e3,distance:function(m,C){var z=Math.PI/180,U=m.lat*z,Q=C.lat*z,fe=Math.sin((C.lat-m.lat)*z/2),Ve=Math.sin((C.lng-m.lng)*z/2),ut=fe*fe+Math.cos(U)*Math.cos(Q)*Ve*Ve,wt=2*Math.atan2(Math.sqrt(ut),Math.sqrt(1-ut));return this.R*wt}}),Er=6378137,_n={R:Er,MAX_LATITUDE:85.0511287798,project:function(m){var C=Math.PI/180,z=this.MAX_LATITUDE,U=Math.max(Math.min(z,m.lat),-z),Q=Math.sin(U*C);return new oi(this.R*m.lng*C,this.R*Math.log((1+Q)/(1-Q))/2)},unproject:function(m){var C=180/Math.PI;return new Kr((2*Math.atan(Math.exp(m.y/this.R))-Math.PI/2)*C,m.x*C/this.R)},bounds:(function(){var m=Er*Math.PI;return new Dr([-m,-m],[m,m])})()};function Mn(m,C,z,U){if(qe(m)){this._a=m[0],this._b=m[1],this._c=m[2],this._d=m[3];return}this._a=m,this._b=C,this._c=z,this._d=U}Mn.prototype={transform:function(m,C){return this._transform(m.clone(),C)},_transform:function(m,C){return C=C||1,m.x=C*(this._a*m.x+this._b),m.y=C*(this._c*m.y+this._d),m},untransform:function(m,C){return C=C||1,new oi((m.x/C-this._b)/this._a,(m.y/C-this._d)/this._c)}};function Vs(m,C,z,U){return new Mn(m,C,z,U)}var Wr=v({},oo,{code:"EPSG:3857",projection:_n,transformation:(function(){var m=.5/(Math.PI*_n.R);return Vs(m,.5,-m,.5)})()}),Ta=v({},Wr,{code:"EPSG:900913"});function zo(m){return document.createElementNS("http://www.w3.org/2000/svg",m)}function Qo(m,C){var z="",U,Q,fe,Ve,ut,wt;for(U=0,fe=m.length;U<fe;U++){for(ut=m[U],Q=0,Ve=ut.length;Q<Ve;Q++)wt=ut[Q],z+=(Q?"L":"M")+wt.x+" "+wt.y;z+=C?ki.svg?"z":"x":""}return z||"M0 0"}var es=document.documentElement.style,on="ActiveXObject"in window,lc=on&&!document.addEventListener,Ca="msLaunchUri"in navigator&&!("documentMode"in document),go=bn("webkit"),na=bn("android"),Tl=bn("android 2")||bn("android 3"),_o=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ea=na&&bn("Google")&&_o<537&&!("AudioNode"in window),ts=!!window.opera,Us=!Ca&&bn("chrome"),Aa=bn("gecko")&&!go&&!ts&&!on,Ao=!Us&&bn("safari"),ka=bn("phantom"),gs="OTransition"in es,Cl=navigator.platform.indexOf("Win")===0,Xa=on&&"transition"in es,xn="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Tl,Ia="MozPerspective"in es,El=!window.L_DISABLE_3D&&(Xa||xn||Ia)&&!gs&&!ka,qo=typeof orientation<"u"||bn("mobile"),_s=qo&&go,is=qo&&xn,Gr=!window.PointerEvent&&window.MSPointerEvent,Gn=!!(window.PointerEvent||Gr),Pa="ontouchstart"in window||!!window.TouchEvent,La=!window.L_NO_TOUCH&&(Pa||Gn),Wo=qo&&ts,Xc=qo&&Aa,cc=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Zu=(function(){var m=!1;try{var C=Object.defineProperty({},"passive",{get:function(){m=!0}});window.addEventListener("testPassiveEventSupport",re,C),window.removeEventListener("testPassiveEventSupport",re,C)}catch{}return m})(),Al=(function(){return!!document.createElement("canvas").getContext})(),st=!!(document.createElementNS&&zo("svg").createSVGRect),oa=!!st&&(function(){var m=document.createElement("div");return m.innerHTML="<svg/>",(m.firstChild&&m.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),uc=!st&&(function(){try{var m=document.createElement("div");m.innerHTML='<v:shape adj="1"/>';var C=m.firstChild;return C.style.behavior="url(#default#VML)",C&&typeof C.adj=="object"}catch{return!1}})(),dc=navigator.platform.indexOf("Mac")===0,Bi=navigator.platform.indexOf("Linux")===0;function bn(m){return navigator.userAgent.toLowerCase().indexOf(m)>=0}var ki={ie:on,ielt9:lc,edge:Ca,webkit:go,android:na,android23:Tl,androidStock:Ea,opera:ts,chrome:Us,gecko:Aa,safari:Ao,phantom:ka,opera12:gs,win:Cl,ie3d:Xa,webkit3d:xn,gecko3d:Ia,any3d:El,mobile:qo,mobileWebkit:_s,mobileWebkit3d:is,msPointer:Gr,pointer:Gn,touch:La,touchNative:Pa,mobileOpera:Wo,mobileGecko:Xc,retina:cc,passiveEvents:Zu,canvas:Al,svg:st,vml:uc,inlineSvg:oa,mac:dc,linux:Bi},kl=ki.msPointer?"MSPointerDown":"pointerdown",Le=ki.msPointer?"MSPointerMove":"pointermove",Z=ki.msPointer?"MSPointerUp":"pointerup",X=ki.msPointer?"MSPointerCancel":"pointercancel",le={touchstart:kl,touchmove:Le,touchend:Z,touchcancel:X},Te={touchstart:ii,touchmove:ti,touchend:ti,touchcancel:ti},we={},ke=!1;function je(m,C,z){return C==="touchstart"&&jt(),Te[C]?(z=Te[C].bind(this,z),m.addEventListener(le[C],z,!1),z):(console.warn("wrong event specified:",C),re)}function Pe(m,C,z){if(!le[C]){console.warn("wrong event specified:",C);return}m.removeEventListener(le[C],z,!1)}function Fe(m){we[m.pointerId]=m}function dt(m){we[m.pointerId]&&(we[m.pointerId]=m)}function rt(m){delete we[m.pointerId]}function jt(){ke||(document.addEventListener(kl,Fe,!0),document.addEventListener(Le,dt,!0),document.addEventListener(Z,rt,!0),document.addEventListener(X,rt,!0),ke=!0)}function ti(m,C){if(C.pointerType!==(C.MSPOINTER_TYPE_MOUSE||"mouse")){C.touches=[];for(var z in we)C.touches.push(we[z]);C.changedTouches=[C],m(C)}}function ii(m,C){C.MSPOINTER_TYPE_TOUCH&&C.pointerType===C.MSPOINTER_TYPE_TOUCH&&Zn(C),ti(m,C)}function Zt(m){var C={},z,U;for(U in m)z=m[U],C[U]=z&&z.bind?z.bind(m):z;return m=C,C.type="dblclick",C.detail=2,C.isTrusted=!1,C._simulated=!0,C}var bi=200;function Ci(m,C){m.addEventListener("dblclick",C);var z=0,U;function Q(fe){if(fe.detail!==1){U=fe.detail;return}if(!(fe.pointerType==="mouse"||fe.sourceCapabilities&&!fe.sourceCapabilities.firesTouchEvents)){var Ve=Il(fe);if(!(Ve.some(function(wt){return wt instanceof HTMLLabelElement&&wt.attributes.for})&&!Ve.some(function(wt){return wt instanceof HTMLInputElement||wt instanceof HTMLSelectElement}))){var ut=Date.now();ut-z<=bi?(U++,U===2&&C(Zt(fe))):U=1,z=ut}}}return m.addEventListener("click",Q),{dblclick:C,simDblclick:Q}}function mr(m,C){m.removeEventListener("dblclick",C.dblclick),m.removeEventListener("click",C.simDblclick)}var Hr=Mo(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),un=Mo(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),dn=un==="webkitTransition"||un==="OTransition"?un+"End":"transitionend";function sn(m){return typeof m=="string"?document.getElementById(m):m}function Ki(m,C){var z=m.style[C]||m.currentStyle&&m.currentStyle[C];if((!z||z==="auto")&&document.defaultView){var U=document.defaultView.getComputedStyle(m,null);z=U?U[C]:null}return z==="auto"?null:z}function Kt(m,C,z){var U=document.createElement(m);return U.className=C||"",z&&z.appendChild(U),U}function Ii(m){var C=m.parentNode;C&&C.removeChild(m)}function Br(m){for(;m.firstChild;)m.removeChild(m.firstChild)}function tr(m){var C=m.parentNode;C&&C.lastChild!==m&&C.appendChild(m)}function yr(m){var C=m.parentNode;C&&C.firstChild!==m&&C.insertBefore(m,C.firstChild)}function Tn(m,C){if(m.classList!==void 0)return m.classList.contains(C);var z=Cn(m);return z.length>0&&new RegExp("(^|\\s)"+C+"(\\s|$)").test(z)}function Ri(m,C){if(m.classList!==void 0)for(var z=oe(C),U=0,Q=z.length;U<Q;U++)m.classList.add(z[U]);else if(!Tn(m,C)){var fe=Cn(m);sa(m,(fe?fe+" ":"")+C)}}function Jr(m,C){m.classList!==void 0?m.classList.remove(C):sa(m,be((" "+Cn(m)+" ").replace(" "+C+" "," ")))}function sa(m,C){m.className.baseVal===void 0?m.className=C:m.className.baseVal=C}function Cn(m){return m.correspondingElement&&(m=m.correspondingElement),m.className.baseVal===void 0?m.className:m.className.baseVal}function Pn(m,C){"opacity"in m.style?m.style.opacity=C:"filter"in m.style&&yo(m,C)}function yo(m,C){var z=!1,U="DXImageTransform.Microsoft.Alpha";try{z=m.filters.item(U)}catch{if(C===1)return}C=Math.round(C*100),z?(z.Enabled=C!==100,z.Opacity=C):m.style.filter+=" progid:"+U+"(opacity="+C+")"}function Mo(m){for(var C=document.documentElement.style,z=0;z<m.length;z++)if(m[z]in C)return m[z];return!1}function Un(m,C,z){var U=C||new oi(0,0);m.style[Hr]=(ki.ie3d?"translate("+U.x+"px,"+U.y+"px)":"translate3d("+U.x+"px,"+U.y+"px,0)")+(z?" scale("+z+")":"")}function Zr(m,C){m._leaflet_pos=C,ki.any3d?Un(m,C):(m.style.left=C.x+"px",m.style.top=C.y+"px")}function qs(m){return m._leaflet_pos||new oi(0,0)}var aa,la,Ya;if("onselectstart"in document)aa=function(){pr(window,"selectstart",Zn)},la=function(){Lr(window,"selectstart",Zn)};else{var Hn=Mo(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);aa=function(){if(Hn){var m=document.documentElement.style;Ya=m[Hn],m[Hn]="none"}},la=function(){Hn&&(document.documentElement.style[Hn]=Ya,Ya=void 0)}}function Go(){pr(window,"dragstart",Zn)}function Kn(){Lr(window,"dragstart",Zn)}var vo,ys;function ca(m){for(;m.tabIndex===-1;)m=m.parentNode;m.style&&(Ka(),vo=m,ys=m.style.outlineStyle,m.style.outlineStyle="none",pr(window,"keydown",Ka))}function Ka(){vo&&(vo.style.outlineStyle=ys,vo=void 0,ys=void 0,Lr(window,"keydown",Ka))}function hc(m){do m=m.parentNode;while((!m.offsetWidth||!m.offsetHeight)&&m!==document.body);return m}function rs(m){var C=m.getBoundingClientRect();return{x:C.width/m.offsetWidth||1,y:C.height/m.offsetHeight||1,boundingClientRect:C}}var za={__proto__:null,TRANSFORM:Hr,TRANSITION:un,TRANSITION_END:dn,get:sn,getStyle:Ki,create:Kt,remove:Ii,empty:Br,toFront:tr,toBack:yr,hasClass:Tn,addClass:Ri,removeClass:Jr,setClass:sa,getClass:Cn,setOpacity:Pn,testProp:Mo,setTransform:Un,setPosition:Zr,getPosition:qs,get disableTextSelection(){return aa},get enableTextSelection(){return la},disableImageDrag:Go,enableImageDrag:Kn,preventOutline:ca,restoreOutline:Ka,getSizedParentNode:hc,getScale:rs};function pr(m,C,z,U){if(C&&typeof C=="object")for(var Q in C)da(m,Q,C[Q],z);else{C=oe(C);for(var fe=0,Ve=C.length;fe<Ve;fe++)da(m,C[fe],z,U)}return this}var vs="_leaflet_events";function Lr(m,C,z,U){if(arguments.length===1)Yc(m),delete m[vs];else if(C&&typeof C=="object")for(var Q in C)pc(m,Q,C[Q],z);else if(C=oe(C),arguments.length===2)Yc(m,function(ut){return St(C,ut)!==-1});else for(var fe=0,Ve=C.length;fe<Ve;fe++)pc(m,C[fe],z,U);return this}function Yc(m,C){for(var z in m[vs]){var U=z.split(/\d/)[0];(!C||C(U))&&pc(m,U,null,null,z)}}var ua={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function da(m,C,z,U){var Q=C+R(z)+(U?"_"+R(U):"");if(m[vs]&&m[vs][Q])return this;var fe=function(ut){return z.call(U||m,ut||window.event)},Ve=fe;!ki.touchNative&&ki.pointer&&C.indexOf("touch")===0?fe=je(m,C,fe):ki.touch&&C==="dblclick"?fe=Ci(m,fe):"addEventListener"in m?C==="touchstart"||C==="touchmove"||C==="wheel"||C==="mousewheel"?m.addEventListener(ua[C]||C,fe,ki.passiveEvents?{passive:!1}:!1):C==="mouseenter"||C==="mouseleave"?(fe=function(ut){ut=ut||window.event,Ja(m,ut)&&Ve(ut)},m.addEventListener(ua[C],fe,!1)):m.addEventListener(C,Ve,!1):m.attachEvent("on"+C,fe),m[vs]=m[vs]||{},m[vs][Q]=fe}function pc(m,C,z,U,Q){Q=Q||C+R(z)+(U?"_"+R(U):"");var fe=m[vs]&&m[vs][Q];if(!fe)return this;!ki.touchNative&&ki.pointer&&C.indexOf("touch")===0?Pe(m,C,fe):ki.touch&&C==="dblclick"?mr(m,fe):"removeEventListener"in m?m.removeEventListener(ua[C]||C,fe,!1):m.detachEvent("on"+C,fe),m[vs][Q]=null}function xs(m){return m.stopPropagation?m.stopPropagation():m.originalEvent?m.originalEvent._stopped=!0:m.cancelBubble=!0,this}function Ma(m){return da(m,"wheel",xs),this}function Ni(m){return pr(m,"mousedown touchstart dblclick contextmenu",xs),m._leaflet_disable_click=!0,this}function Zn(m){return m.preventDefault?m.preventDefault():m.returnValue=!1,this}function bs(m){return Zn(m),xs(m),this}function Il(m){if(m.composedPath)return m.composedPath();for(var C=[],z=m.target;z;)C.push(z),z=z.parentNode;return C}function Kc(m,C){if(!C)return new oi(m.clientX,m.clientY);var z=rs(C),U=z.boundingClientRect;return new oi((m.clientX-U.left)/z.x-C.clientLeft,(m.clientY-U.top)/z.y-C.clientTop)}var fc=ki.linux&&ki.chrome?window.devicePixelRatio:ki.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Pl(m){return ki.edge?m.wheelDeltaY/2:m.deltaY&&m.deltaMode===0?-m.deltaY/fc:m.deltaY&&m.deltaMode===1?-m.deltaY*20:m.deltaY&&m.deltaMode===2?-m.deltaY*60:m.deltaX||m.deltaZ?0:m.wheelDelta?(m.wheelDeltaY||m.wheelDelta)/2:m.detail&&Math.abs(m.detail)<32765?-m.detail*20:m.detail?m.detail/-32765*60:0}function Ja(m,C){var z=C.relatedTarget;if(!z)return!0;try{for(;z&&z!==m;)z=z.parentNode}catch{return!1}return z!==m}var Qa={__proto__:null,on:pr,off:Lr,stopPropagation:xs,disableScrollPropagation:Ma,disableClickPropagation:Ni,preventDefault:Zn,stop:bs,getPropagationPath:Il,getMousePosition:Kc,getWheelDelta:Pl,isExternalTarget:Ja,addListener:pr,removeListener:Lr},$u=Ai.extend({run:function(m,C,z,U){this.stop(),this._el=m,this._inProgress=!0,this._duration=z||.25,this._easeOutPower=1/Math.max(U||.5,.2),this._startPos=qs(m),this._offset=C.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=li(this._animate,this),this._step()},_step:function(m){var C=+new Date-this._startTime,z=this._duration*1e3;C<z?this._runFrame(this._easeOut(C/z),m):(this._runFrame(1),this._complete())},_runFrame:function(m,C){var z=this._startPos.add(this._offset.multiplyBy(m));C&&z._round(),Zr(this._el,z),this.fire("step")},_complete:function(){Hi(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(m){return 1-Math.pow(1-m,this._easeOutPower)}}),zr=Ai.extend({options:{crs:Wr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(m,C){C=Se(this,C),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(m),this._initLayout(),this._onResize=T(this._onResize,this),this._initEvents(),C.maxBounds&&this.setMaxBounds(C.maxBounds),C.zoom!==void 0&&(this._zoom=this._limitZoom(C.zoom)),C.center&&C.zoom!==void 0&&this.setView(Pr(C.center),C.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=un&&ki.any3d&&!ki.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),pr(this._proxy,dn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(m,C,z){if(C=C===void 0?this._zoom:this._limitZoom(C),m=this._limitCenter(Pr(m),C,this.options.maxBounds),z=z||{},this._stop(),this._loaded&&!z.reset&&z!==!0){z.animate!==void 0&&(z.zoom=v({animate:z.animate},z.zoom),z.pan=v({animate:z.animate,duration:z.duration},z.pan));var U=this._zoom!==C?this._tryAnimatedZoom&&this._tryAnimatedZoom(m,C,z.zoom):this._tryAnimatedPan(m,z.pan);if(U)return clearTimeout(this._sizeTimer),this}return this._resetView(m,C,z.pan&&z.pan.noMoveStart),this},setZoom:function(m,C){return this._loaded?this.setView(this.getCenter(),m,{zoom:C}):(this._zoom=m,this)},zoomIn:function(m,C){return m=m||(ki.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+m,C)},zoomOut:function(m,C){return m=m||(ki.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-m,C)},setZoomAround:function(m,C,z){var U=this.getZoomScale(C),Q=this.getSize().divideBy(2),fe=m instanceof oi?m:this.latLngToContainerPoint(m),Ve=fe.subtract(Q).multiplyBy(1-1/U),ut=this.containerPointToLatLng(Q.add(Ve));return this.setView(ut,C,{zoom:z})},_getBoundsCenterZoom:function(m,C){C=C||{},m=m.getBounds?m.getBounds():nn(m);var z=Mi(C.paddingTopLeft||C.padding||[0,0]),U=Mi(C.paddingBottomRight||C.padding||[0,0]),Q=this.getBoundsZoom(m,!1,z.add(U));if(Q=typeof C.maxZoom=="number"?Math.min(C.maxZoom,Q):Q,Q===1/0)return{center:m.getCenter(),zoom:Q};var fe=U.subtract(z).divideBy(2),Ve=this.project(m.getSouthWest(),Q),ut=this.project(m.getNorthEast(),Q),wt=this.unproject(Ve.add(ut).divideBy(2).add(fe),Q);return{center:wt,zoom:Q}},fitBounds:function(m,C){if(m=nn(m),!m.isValid())throw new Error("Bounds are not valid.");var z=this._getBoundsCenterZoom(m,C);return this.setView(z.center,z.zoom,C)},fitWorld:function(m){return this.fitBounds([[-90,-180],[90,180]],m)},panTo:function(m,C){return this.setView(m,this._zoom,{pan:C})},panBy:function(m,C){if(m=Mi(m).round(),C=C||{},!m.x&&!m.y)return this.fire("moveend");if(C.animate!==!0&&!this.getSize().contains(m))return this._resetView(this.unproject(this.project(this.getCenter()).add(m)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new $u,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),C.noMoveStart||this.fire("movestart"),C.animate!==!1){Ri(this._mapPane,"leaflet-pan-anim");var z=this._getMapPanePos().subtract(m).round();this._panAnim.run(this._mapPane,z,C.duration||.25,C.easeLinearity)}else this._rawPanBy(m),this.fire("move").fire("moveend");return this},flyTo:function(m,C,z){if(z=z||{},z.animate===!1||!ki.any3d)return this.setView(m,C,z);this._stop();var U=this.project(this.getCenter()),Q=this.project(m),fe=this.getSize(),Ve=this._zoom;m=Pr(m),C=C===void 0?Ve:C;var ut=Math.max(fe.x,fe.y),wt=ut*this.getZoomScale(Ve,C),Ut=Q.distanceTo(U)||1,fi=1.42,Vi=fi*fi;function vr(Dn){var al=Dn?-1:1,Cc=Dn?wt:ut,Zd=wt*wt-ut*ut+al*Vi*Vi*Ut*Ut,$d=2*Cc*Vi*Ut,nu=Zd/$d,ll=Math.sqrt(nu*nu+1)-nu,ou=ll<1e-9?-18:Math.log(ll);return ou}function lo(Dn){return(Math.exp(Dn)-Math.exp(-Dn))/2}function In(Dn){return(Math.exp(Dn)+Math.exp(-Dn))/2}function co(Dn){return lo(Dn)/In(Dn)}var eo=vr(0);function Cs(Dn){return ut*(In(eo)/In(eo+fi*Dn))}function Gd(Dn){return ut*(In(eo)*co(eo+fi*Dn)-lo(eo))/Vi}function nd(Dn){return 1-Math.pow(1-Dn,1.5)}var Hd=Date.now(),sl=(vr(1)-eo)/fi,ru=z.duration?1e3*z.duration:1e3*sl*.8;function Tc(){var Dn=(Date.now()-Hd)/ru,al=nd(Dn)*sl;Dn<=1?(this._flyToFrame=li(Tc,this),this._move(this.unproject(U.add(Q.subtract(U).multiplyBy(Gd(al)/Ut)),Ve),this.getScaleZoom(ut/Cs(al),Ve),{flyTo:!0})):this._move(m,C)._moveEnd(!0)}return this._moveStart(!0,z.noMoveStart),Tc.call(this),this},flyToBounds:function(m,C){var z=this._getBoundsCenterZoom(m,C);return this.flyTo(z.center,z.zoom,C)},setMaxBounds:function(m){return m=nn(m),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),m.isValid()?(this.options.maxBounds=m,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(m){var C=this.options.minZoom;return this.options.minZoom=m,this._loaded&&C!==m&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(m):this},setMaxZoom:function(m){var C=this.options.maxZoom;return this.options.maxZoom=m,this._loaded&&C!==m&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(m):this},panInsideBounds:function(m,C){this._enforcingBounds=!0;var z=this.getCenter(),U=this._limitCenter(z,this._zoom,nn(m));return z.equals(U)||this.panTo(U,C),this._enforcingBounds=!1,this},panInside:function(m,C){C=C||{};var z=Mi(C.paddingTopLeft||C.padding||[0,0]),U=Mi(C.paddingBottomRight||C.padding||[0,0]),Q=this.project(this.getCenter()),fe=this.project(m),Ve=this.getPixelBounds(),ut=gn([Ve.min.add(z),Ve.max.subtract(U)]),wt=ut.getSize();if(!ut.contains(fe)){this._enforcingBounds=!0;var Ut=fe.subtract(ut.getCenter()),fi=ut.extend(fe).getSize().subtract(wt);Q.x+=Ut.x<0?-fi.x:fi.x,Q.y+=Ut.y<0?-fi.y:fi.y,this.panTo(this.unproject(Q),C),this._enforcingBounds=!1}return this},invalidateSize:function(m){if(!this._loaded)return this;m=v({animate:!1,pan:!0},m===!0?{animate:!0}:m);var C=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var z=this.getSize(),U=C.divideBy(2).round(),Q=z.divideBy(2).round(),fe=U.subtract(Q);return!fe.x&&!fe.y?this:(m.animate&&m.pan?this.panBy(fe):(m.pan&&this._rawPanBy(fe),this.fire("move"),m.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(T(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:C,newSize:z}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(m){if(m=this._locateOptions=v({timeout:1e4,watch:!1},m),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var C=T(this._handleGeolocationResponse,this),z=T(this._handleGeolocationError,this);return m.watch?this._locationWatchId=navigator.geolocation.watchPosition(C,z,m):navigator.geolocation.getCurrentPosition(C,z,m),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(m){if(this._container._leaflet_id){var C=m.code,z=m.message||(C===1?"permission denied":C===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:C,message:"Geolocation error: "+z+"."})}},_handleGeolocationResponse:function(m){if(this._container._leaflet_id){var C=m.coords.latitude,z=m.coords.longitude,U=new Kr(C,z),Q=U.toBounds(m.coords.accuracy*2),fe=this._locateOptions;if(fe.setView){var Ve=this.getBoundsZoom(Q);this.setView(U,fe.maxZoom?Math.min(Ve,fe.maxZoom):Ve)}var ut={latlng:U,bounds:Q,timestamp:m.timestamp};for(var wt in m.coords)typeof m.coords[wt]=="number"&&(ut[wt]=m.coords[wt]);this.fire("locationfound",ut)}},addHandler:function(m,C){if(!C)return this;var z=this[m]=new C(this);return this._handlers.push(z),this.options[m]&&z.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ii(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Hi(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var m;for(m in this._layers)this._layers[m].remove();for(m in this._panes)Ii(this._panes[m]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(m,C){var z="leaflet-pane"+(m?" leaflet-"+m.replace("Pane","")+"-pane":""),U=Kt("div",z,C||this._mapPane);return m&&(this._panes[m]=U),U},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var m=this.getPixelBounds(),C=this.unproject(m.getBottomLeft()),z=this.unproject(m.getTopRight());return new er(C,z)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(m,C,z){m=nn(m),z=Mi(z||[0,0]);var U=this.getZoom()||0,Q=this.getMinZoom(),fe=this.getMaxZoom(),Ve=m.getNorthWest(),ut=m.getSouthEast(),wt=this.getSize().subtract(z),Ut=gn(this.project(ut,U),this.project(Ve,U)).getSize(),fi=ki.any3d?this.options.zoomSnap:1,Vi=wt.x/Ut.x,vr=wt.y/Ut.y,lo=C?Math.max(Vi,vr):Math.min(Vi,vr);return U=this.getScaleZoom(lo,U),fi&&(U=Math.round(U/(fi/100))*(fi/100),U=C?Math.ceil(U/fi)*fi:Math.floor(U/fi)*fi),Math.max(Q,Math.min(fe,U))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new oi(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(m,C){var z=this._getTopLeftPoint(m,C);return new Dr(z,z.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(m){return this.options.crs.getProjectedBounds(m===void 0?this.getZoom():m)},getPane:function(m){return typeof m=="string"?this._panes[m]:m},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(m,C){var z=this.options.crs;return C=C===void 0?this._zoom:C,z.scale(m)/z.scale(C)},getScaleZoom:function(m,C){var z=this.options.crs;C=C===void 0?this._zoom:C;var U=z.zoom(m*z.scale(C));return isNaN(U)?1/0:U},project:function(m,C){return C=C===void 0?this._zoom:C,this.options.crs.latLngToPoint(Pr(m),C)},unproject:function(m,C){return C=C===void 0?this._zoom:C,this.options.crs.pointToLatLng(Mi(m),C)},layerPointToLatLng:function(m){var C=Mi(m).add(this.getPixelOrigin());return this.unproject(C)},latLngToLayerPoint:function(m){var C=this.project(Pr(m))._round();return C._subtract(this.getPixelOrigin())},wrapLatLng:function(m){return this.options.crs.wrapLatLng(Pr(m))},wrapLatLngBounds:function(m){return this.options.crs.wrapLatLngBounds(nn(m))},distance:function(m,C){return this.options.crs.distance(Pr(m),Pr(C))},containerPointToLayerPoint:function(m){return Mi(m).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(m){return Mi(m).add(this._getMapPanePos())},containerPointToLatLng:function(m){var C=this.containerPointToLayerPoint(Mi(m));return this.layerPointToLatLng(C)},latLngToContainerPoint:function(m){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Pr(m)))},mouseEventToContainerPoint:function(m){return Kc(m,this._container)},mouseEventToLayerPoint:function(m){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(m))},mouseEventToLatLng:function(m){return this.layerPointToLatLng(this.mouseEventToLayerPoint(m))},_initContainer:function(m){var C=this._container=sn(m);if(C){if(C._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");pr(C,"scroll",this._onScroll,this),this._containerId=R(C)},_initLayout:function(){var m=this._container;this._fadeAnimated=this.options.fadeAnimation&&ki.any3d,Ri(m,"leaflet-container"+(ki.touch?" leaflet-touch":"")+(ki.retina?" leaflet-retina":"")+(ki.ielt9?" leaflet-oldie":"")+(ki.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var C=Ki(m,"position");C!=="absolute"&&C!=="relative"&&C!=="fixed"&&C!=="sticky"&&(m.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var m=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Zr(this._mapPane,new oi(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ri(m.markerPane,"leaflet-zoom-hide"),Ri(m.shadowPane,"leaflet-zoom-hide"))},_resetView:function(m,C,z){Zr(this._mapPane,new oi(0,0));var U=!this._loaded;this._loaded=!0,C=this._limitZoom(C),this.fire("viewprereset");var Q=this._zoom!==C;this._moveStart(Q,z)._move(m,C)._moveEnd(Q),this.fire("viewreset"),U&&this.fire("load")},_moveStart:function(m,C){return m&&this.fire("zoomstart"),C||this.fire("movestart"),this},_move:function(m,C,z,U){C===void 0&&(C=this._zoom);var Q=this._zoom!==C;return this._zoom=C,this._lastCenter=m,this._pixelOrigin=this._getNewPixelOrigin(m),U?z&&z.pinch&&this.fire("zoom",z):((Q||z&&z.pinch)&&this.fire("zoom",z),this.fire("move",z)),this},_moveEnd:function(m){return m&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Hi(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(m){Zr(this._mapPane,this._getMapPanePos().subtract(m))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(m){this._targets={},this._targets[R(this._container)]=this;var C=m?Lr:pr;C(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&C(window,"resize",this._onResize,this),ki.any3d&&this.options.transform3DLimit&&(m?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Hi(this._resizeRequest),this._resizeRequest=li(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var m=this._getMapPanePos();Math.max(Math.abs(m.x),Math.abs(m.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(m,C){for(var z=[],U,Q=C==="mouseout"||C==="mouseover",fe=m.target||m.srcElement,Ve=!1;fe;){if(U=this._targets[R(fe)],U&&(C==="click"||C==="preclick")&&this._draggableMoved(U)){Ve=!0;break}if(U&&U.listens(C,!0)&&(Q&&!Ja(fe,m)||(z.push(U),Q))||fe===this._container)break;fe=fe.parentNode}return!z.length&&!Ve&&!Q&&this.listens(C,!0)&&(z=[this]),z},_isClickDisabled:function(m){for(;m&&m!==this._container;){if(m._leaflet_disable_click)return!0;m=m.parentNode}},_handleDOMEvent:function(m){var C=m.target||m.srcElement;if(!(!this._loaded||C._leaflet_disable_events||m.type==="click"&&this._isClickDisabled(C))){var z=m.type;z==="mousedown"&&ca(C),this._fireDOMEvent(m,z)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(m,C,z){if(m.type==="click"){var U=v({},m);U.type="preclick",this._fireDOMEvent(U,U.type,z)}var Q=this._findEventTargets(m,C);if(z){for(var fe=[],Ve=0;Ve<z.length;Ve++)z[Ve].listens(C,!0)&&fe.push(z[Ve]);Q=fe.concat(Q)}if(Q.length){C==="contextmenu"&&Zn(m);var ut=Q[0],wt={originalEvent:m};if(m.type!=="keypress"&&m.type!=="keydown"&&m.type!=="keyup"){var Ut=ut.getLatLng&&(!ut._radius||ut._radius<=10);wt.containerPoint=Ut?this.latLngToContainerPoint(ut.getLatLng()):this.mouseEventToContainerPoint(m),wt.layerPoint=this.containerPointToLayerPoint(wt.containerPoint),wt.latlng=Ut?ut.getLatLng():this.layerPointToLatLng(wt.layerPoint)}for(Ve=0;Ve<Q.length;Ve++)if(Q[Ve].fire(C,wt,!0),wt.originalEvent._stopped||Q[Ve].options.bubblingMouseEvents===!1&&St(this._mouseEvents,C)!==-1)return}},_draggableMoved:function(m){return m=m.dragging&&m.dragging.enabled()?m:this,m.dragging&&m.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var m=0,C=this._handlers.length;m<C;m++)this._handlers[m].disable()},whenReady:function(m,C){return this._loaded?m.call(C||this,{target:this}):this.on("load",m,C),this},_getMapPanePos:function(){return qs(this._mapPane)||new oi(0,0)},_moved:function(){var m=this._getMapPanePos();return m&&!m.equals([0,0])},_getTopLeftPoint:function(m,C){var z=m&&C!==void 0?this._getNewPixelOrigin(m,C):this.getPixelOrigin();return z.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(m,C){var z=this.getSize()._divideBy(2);return this.project(m,C)._subtract(z)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(m,C,z){var U=this._getNewPixelOrigin(z,C);return this.project(m,C)._subtract(U)},_latLngBoundsToNewLayerBounds:function(m,C,z){var U=this._getNewPixelOrigin(z,C);return gn([this.project(m.getSouthWest(),C)._subtract(U),this.project(m.getNorthWest(),C)._subtract(U),this.project(m.getSouthEast(),C)._subtract(U),this.project(m.getNorthEast(),C)._subtract(U)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(m){return this.latLngToLayerPoint(m).subtract(this._getCenterLayerPoint())},_limitCenter:function(m,C,z){if(!z)return m;var U=this.project(m,C),Q=this.getSize().divideBy(2),fe=new Dr(U.subtract(Q),U.add(Q)),Ve=this._getBoundsOffset(fe,z,C);return Math.abs(Ve.x)<=1&&Math.abs(Ve.y)<=1?m:this.unproject(U.add(Ve),C)},_limitOffset:function(m,C){if(!C)return m;var z=this.getPixelBounds(),U=new Dr(z.min.add(m),z.max.add(m));return m.add(this._getBoundsOffset(U,C))},_getBoundsOffset:function(m,C,z){var U=gn(this.project(C.getNorthEast(),z),this.project(C.getSouthWest(),z)),Q=U.min.subtract(m.min),fe=U.max.subtract(m.max),Ve=this._rebound(Q.x,-fe.x),ut=this._rebound(Q.y,-fe.y);return new oi(Ve,ut)},_rebound:function(m,C){return m+C>0?Math.round(m-C)/2:Math.max(0,Math.ceil(m))-Math.max(0,Math.floor(C))},_limitZoom:function(m){var C=this.getMinZoom(),z=this.getMaxZoom(),U=ki.any3d?this.options.zoomSnap:1;return U&&(m=Math.round(m/U)*U),Math.max(C,Math.min(z,m))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Jr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(m,C){var z=this._getCenterOffset(m)._trunc();return(C&&C.animate)!==!0&&!this.getSize().contains(z)?!1:(this.panBy(z,C),!0)},_createAnimProxy:function(){var m=this._proxy=Kt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(m),this.on("zoomanim",function(C){var z=Hr,U=this._proxy.style[z];Un(this._proxy,this.project(C.center,C.zoom),this.getZoomScale(C.zoom,1)),U===this._proxy.style[z]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ii(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var m=this.getCenter(),C=this.getZoom();Un(this._proxy,this.project(m,C),this.getZoomScale(C,1))},_catchTransitionEnd:function(m){this._animatingZoom&&m.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(m,C,z){if(this._animatingZoom)return!0;if(z=z||{},!this._zoomAnimated||z.animate===!1||this._nothingToAnimate()||Math.abs(C-this._zoom)>this.options.zoomAnimationThreshold)return!1;var U=this.getZoomScale(C),Q=this._getCenterOffset(m)._divideBy(1-1/U);return z.animate!==!0&&!this.getSize().contains(Q)?!1:(li(function(){this._moveStart(!0,z.noMoveStart||!1)._animateZoom(m,C,!0)},this),!0)},_animateZoom:function(m,C,z,U){this._mapPane&&(z&&(this._animatingZoom=!0,this._animateToCenter=m,this._animateToZoom=C,Ri(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:m,zoom:C,noUpdate:U}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(T(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Jr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Lp(m,C){return new zr(m,C)}var ko=Di.extend({options:{position:"topright"},initialize:function(m){Se(this,m)},getPosition:function(){return this.options.position},setPosition:function(m){var C=this._map;return C&&C.removeControl(this),this.options.position=m,C&&C.addControl(this),this},getContainer:function(){return this._container},addTo:function(m){this.remove(),this._map=m;var C=this._container=this.onAdd(m),z=this.getPosition(),U=m._controlCorners[z];return Ri(C,"leaflet-control"),z.indexOf("bottom")!==-1?U.insertBefore(C,U.firstChild):U.appendChild(C),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ii(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(m){this._map&&m&&m.screenX>0&&m.screenY>0&&this._map.getContainer().focus()}}),so=function(m){return new ko(m)};zr.include({addControl:function(m){return m.addTo(this),this},removeControl:function(m){return m.remove(),this},_initControlPos:function(){var m=this._controlCorners={},C="leaflet-",z=this._controlContainer=Kt("div",C+"control-container",this._container);function U(Q,fe){var Ve=C+Q+" "+C+fe;m[Q+fe]=Kt("div",Ve,z)}U("top","left"),U("top","right"),U("bottom","left"),U("bottom","right")},_clearControlPos:function(){for(var m in this._controlCorners)Ii(this._controlCorners[m]);Ii(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ll=ko.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(m,C,z,U){return z<U?-1:U<z?1:0}},initialize:function(m,C,z){Se(this,z),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var U in m)this._addLayer(m[U],U);for(U in C)this._addLayer(C[U],U,!0)},onAdd:function(m){this._initLayout(),this._update(),this._map=m,m.on("zoomend",this._checkDisabledLayers,this);for(var C=0;C<this._layers.length;C++)this._layers[C].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(m){return ko.prototype.addTo.call(this,m),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var m=0;m<this._layers.length;m++)this._layers[m].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(m,C){return this._addLayer(m,C),this._map?this._update():this},addOverlay:function(m,C){return this._addLayer(m,C,!0),this._map?this._update():this},removeLayer:function(m){m.off("add remove",this._onLayerChange,this);var C=this._getLayer(R(m));return C&&this._layers.splice(this._layers.indexOf(C),1),this._map?this._update():this},expand:function(){Ri(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var m=this._map.getSize().y-(this._container.offsetTop+50);return m<this._section.clientHeight?(Ri(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=m+"px"):Jr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Jr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var m="leaflet-control-layers",C=this._container=Kt("div",m),z=this.options.collapsed;C.setAttribute("aria-haspopup",!0),Ni(C),Ma(C);var U=this._section=Kt("section",m+"-list");z&&(this._map.on("click",this.collapse,this),pr(C,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var Q=this._layersLink=Kt("a",m+"-toggle",C);Q.href="#",Q.title="Layers",Q.setAttribute("role","button"),pr(Q,{keydown:function(fe){fe.keyCode===13&&this._expandSafely()},click:function(fe){Zn(fe),this._expandSafely()}},this),z||this.expand(),this._baseLayersList=Kt("div",m+"-base",U),this._separator=Kt("div",m+"-separator",U),this._overlaysList=Kt("div",m+"-overlays",U),C.appendChild(U)},_getLayer:function(m){for(var C=0;C<this._layers.length;C++)if(this._layers[C]&&R(this._layers[C].layer)===m)return this._layers[C]},_addLayer:function(m,C,z){this._map&&m.on("add remove",this._onLayerChange,this),this._layers.push({layer:m,name:C,overlay:z}),this.options.sortLayers&&this._layers.sort(T(function(U,Q){return this.options.sortFunction(U.layer,Q.layer,U.name,Q.name)},this)),this.options.autoZIndex&&m.setZIndex&&(this._lastZIndex++,m.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Br(this._baseLayersList),Br(this._overlaysList),this._layerControlInputs=[];var m,C,z,U,Q=0;for(z=0;z<this._layers.length;z++)U=this._layers[z],this._addItem(U),C=C||U.overlay,m=m||!U.overlay,Q+=U.overlay?0:1;return this.options.hideSingleBase&&(m=m&&Q>1,this._baseLayersList.style.display=m?"":"none"),this._separator.style.display=C&&m?"":"none",this},_onLayerChange:function(m){this._handlingClick||this._update();var C=this._getLayer(R(m.target)),z=C.overlay?m.type==="add"?"overlayadd":"overlayremove":m.type==="add"?"baselayerchange":null;z&&this._map.fire(z,C)},_createRadioElement:function(m,C){var z='<input type="radio" class="leaflet-control-layers-selector" name="'+m+'"'+(C?' checked="checked"':"")+"/>",U=document.createElement("div");return U.innerHTML=z,U.firstChild},_addItem:function(m){var C=document.createElement("label"),z=this._map.hasLayer(m.layer),U;m.overlay?(U=document.createElement("input"),U.type="checkbox",U.className="leaflet-control-layers-selector",U.defaultChecked=z):U=this._createRadioElement("leaflet-base-layers_"+R(this),z),this._layerControlInputs.push(U),U.layerId=R(m.layer),pr(U,"click",this._onInputClick,this);var Q=document.createElement("span");Q.innerHTML=" "+m.name;var fe=document.createElement("span");C.appendChild(fe),fe.appendChild(U),fe.appendChild(Q);var Ve=m.overlay?this._overlaysList:this._baseLayersList;return Ve.appendChild(C),this._checkDisabledLayers(),C},_onInputClick:function(){if(!this._preventClick){var m=this._layerControlInputs,C,z,U=[],Q=[];this._handlingClick=!0;for(var fe=m.length-1;fe>=0;fe--)C=m[fe],z=this._getLayer(C.layerId).layer,C.checked?U.push(z):C.checked||Q.push(z);for(fe=0;fe<Q.length;fe++)this._map.hasLayer(Q[fe])&&this._map.removeLayer(Q[fe]);for(fe=0;fe<U.length;fe++)this._map.hasLayer(U[fe])||this._map.addLayer(U[fe]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var m=this._layerControlInputs,C,z,U=this._map.getZoom(),Q=m.length-1;Q>=0;Q--)C=m[Q],z=this._getLayer(C.layerId).layer,C.disabled=z.options.minZoom!==void 0&&U<z.options.minZoom||z.options.maxZoom!==void 0&&U>z.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var m=this._section;this._preventClick=!0,pr(m,"click",Zn),this.expand();var C=this;setTimeout(function(){Lr(m,"click",Zn),C._preventClick=!1})}}),zl=function(m,C,z){return new Ll(m,C,z)},el=ko.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(m){var C="leaflet-control-zoom",z=Kt("div",C+" leaflet-bar"),U=this.options;return this._zoomInButton=this._createButton(U.zoomInText,U.zoomInTitle,C+"-in",z,this._zoomIn),this._zoomOutButton=this._createButton(U.zoomOutText,U.zoomOutTitle,C+"-out",z,this._zoomOut),this._updateDisabled(),m.on("zoomend zoomlevelschange",this._updateDisabled,this),z},onRemove:function(m){m.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(m){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(m.shiftKey?3:1))},_zoomOut:function(m){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(m.shiftKey?3:1))},_createButton:function(m,C,z,U,Q){var fe=Kt("a",z,U);return fe.innerHTML=m,fe.href="#",fe.title=C,fe.setAttribute("role","button"),fe.setAttribute("aria-label",C),Ni(fe),pr(fe,"click",bs),pr(fe,"click",Q,this),pr(fe,"click",this._refocusOnMap,this),fe},_updateDisabled:function(){var m=this._map,C="leaflet-disabled";Jr(this._zoomInButton,C),Jr(this._zoomOutButton,C),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||m._zoom===m.getMinZoom())&&(Ri(this._zoomOutButton,C),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||m._zoom===m.getMaxZoom())&&(Ri(this._zoomInButton,C),this._zoomInButton.setAttribute("aria-disabled","true"))}});zr.mergeOptions({zoomControl:!0}),zr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new el,this.addControl(this.zoomControl))});var ha=function(m){return new el(m)},kn=ko.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(m){var C="leaflet-control-scale",z=Kt("div",C),U=this.options;return this._addScales(U,C+"-line",z),m.on(U.updateWhenIdle?"moveend":"move",this._update,this),m.whenReady(this._update,this),z},onRemove:function(m){m.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(m,C,z){m.metric&&(this._mScale=Kt("div",C,z)),m.imperial&&(this._iScale=Kt("div",C,z))},_update:function(){var m=this._map,C=m.getSize().y/2,z=m.distance(m.containerPointToLatLng([0,C]),m.containerPointToLatLng([this.options.maxWidth,C]));this._updateScales(z)},_updateScales:function(m){this.options.metric&&m&&this._updateMetric(m),this.options.imperial&&m&&this._updateImperial(m)},_updateMetric:function(m){var C=this._getRoundNum(m),z=C<1e3?C+" m":C/1e3+" km";this._updateScale(this._mScale,z,C/m)},_updateImperial:function(m){var C=m*3.2808399,z,U,Q;C>5280?(z=C/5280,U=this._getRoundNum(z),this._updateScale(this._iScale,U+" mi",U/z)):(Q=this._getRoundNum(C),this._updateScale(this._iScale,Q+" ft",Q/C))},_updateScale:function(m,C,z){m.style.width=Math.round(this.options.maxWidth*z)+"px",m.innerHTML=C},_getRoundNum:function(m){var C=Math.pow(10,(Math.floor(m)+"").length-1),z=m/C;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:1,C*z}}),Xu=function(m){return new kn(m)},Yu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',mc=ko.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ki.inlineSvg?Yu+" ":"")+"Leaflet</a>"},initialize:function(m){Se(this,m),this._attributions={}},onAdd:function(m){m.attributionControl=this,this._container=Kt("div","leaflet-control-attribution"),Ni(this._container);for(var C in m._layers)m._layers[C].getAttribution&&this.addAttribution(m._layers[C].getAttribution());return this._update(),m.on("layeradd",this._addAttribution,this),this._container},onRemove:function(m){m.off("layeradd",this._addAttribution,this)},_addAttribution:function(m){m.layer.getAttribution&&(this.addAttribution(m.layer.getAttribution()),m.layer.once("remove",function(){this.removeAttribution(m.layer.getAttribution())},this))},setPrefix:function(m){return this.options.prefix=m,this._update(),this},addAttribution:function(m){return m?(this._attributions[m]||(this._attributions[m]=0),this._attributions[m]++,this._update(),this):this},removeAttribution:function(m){return m?(this._attributions[m]&&(this._attributions[m]--,this._update()),this):this},_update:function(){if(this._map){var m=[];for(var C in this._attributions)this._attributions[C]&&m.push(C);var z=[];this.options.prefix&&z.push(this.options.prefix),m.length&&z.push(m.join(", ")),this._container.innerHTML=z.join(' <span aria-hidden="true">|</span> ')}}});zr.mergeOptions({attributionControl:!0}),zr.addInitHook(function(){this.options.attributionControl&&new mc().addTo(this)});var cr=function(m){return new mc(m)};ko.Layers=Ll,ko.Zoom=el,ko.Scale=kn,ko.Attribution=mc,so.layers=zl,so.zoom=ha,so.scale=Xu,so.attribution=cr;var ns=Di.extend({initialize:function(m){this._map=m},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ns.addTo=function(m,C){return m.addHandler(C,this),this};var Fd={Events:Si},Ku=ki.touch?"touchstart mousedown":"mousedown",$t=Ai.extend({options:{clickTolerance:3},initialize:function(m,C,z,U){Se(this,U),this._element=m,this._dragStartTarget=C||m,this._preventOutline=z},enable:function(){this._enabled||(pr(this._dragStartTarget,Ku,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($t._dragging===this&&this.finishDrag(!0),Lr(this._dragStartTarget,Ku,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(m){if(this._enabled&&(this._moved=!1,!Tn(this._element,"leaflet-zoom-anim"))){if(m.touches&&m.touches.length!==1){$t._dragging===this&&this.finishDrag();return}if(!($t._dragging||m.shiftKey||m.which!==1&&m.button!==1&&!m.touches)&&($t._dragging=this,this._preventOutline&&ca(this._element),Go(),aa(),!this._moving)){this.fire("down");var C=m.touches?m.touches[0]:m,z=hc(this._element);this._startPoint=new oi(C.clientX,C.clientY),this._startPos=qs(this._element),this._parentScale=rs(z);var U=m.type==="mousedown";pr(document,U?"mousemove":"touchmove",this._onMove,this),pr(document,U?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(m){if(this._enabled){if(m.touches&&m.touches.length>1){this._moved=!0;return}var C=m.touches&&m.touches.length===1?m.touches[0]:m,z=new oi(C.clientX,C.clientY)._subtract(this._startPoint);!z.x&&!z.y||Math.abs(z.x)+Math.abs(z.y)<this.options.clickTolerance||(z.x/=this._parentScale.x,z.y/=this._parentScale.y,Zn(m),this._moved||(this.fire("dragstart"),this._moved=!0,Ri(document.body,"leaflet-dragging"),this._lastTarget=m.target||m.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ri(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(z),this._moving=!0,this._lastEvent=m,this._updatePosition())}},_updatePosition:function(){var m={originalEvent:this._lastEvent};this.fire("predrag",m),Zr(this._element,this._newPos),this.fire("drag",m)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(m){Jr(document.body,"leaflet-dragging"),this._lastTarget&&(Jr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Lr(document,"mousemove touchmove",this._onMove,this),Lr(document,"mouseup touchend touchcancel",this._onUp,this),Kn(),la();var C=this._moved&&this._moving;this._moving=!1,$t._dragging=!1,C&&this.fire("dragend",{noInertia:m,distance:this._newPos.distanceTo(this._startPos)})}});function Ml(m,C,z){var U,Q=[1,4,2,8],fe,Ve,ut,wt,Ut,fi,Vi,vr;for(fe=0,fi=m.length;fe<fi;fe++)m[fe]._code=ws(m[fe],C);for(ut=0;ut<4;ut++){for(Vi=Q[ut],U=[],fe=0,fi=m.length,Ve=fi-1;fe<fi;Ve=fe++)wt=m[fe],Ut=m[Ve],wt._code&Vi?Ut._code&Vi||(vr=Gs(Ut,wt,Vi,C,z),vr._code=ws(vr,C),U.push(vr)):(Ut._code&Vi&&(vr=Gs(Ut,wt,Vi,C,z),vr._code=ws(vr,C),U.push(vr)),U.push(wt));m=U}return m}function Ws(m,C){var z,U,Q,fe,Ve,ut,wt,Ut,fi;if(!m||m.length===0)throw new Error("latlngs not passed");ss(m)||(console.warn("latlngs are not flat! Only the first ring will be used"),m=m[0]);var Vi=Pr([0,0]),vr=nn(m),lo=vr.getNorthWest().distanceTo(vr.getSouthWest())*vr.getNorthEast().distanceTo(vr.getNorthWest());lo<1700&&(Vi=Oo(m));var In=m.length,co=[];for(z=0;z<In;z++){var eo=Pr(m[z]);co.push(C.project(Pr([eo.lat-Vi.lat,eo.lng-Vi.lng])))}for(ut=wt=Ut=0,z=0,U=In-1;z<In;U=z++)Q=co[z],fe=co[U],Ve=Q.y*fe.x-fe.y*Q.x,wt+=(Q.x+fe.x)*Ve,Ut+=(Q.y+fe.y)*Ve,ut+=Ve*3;ut===0?fi=co[0]:fi=[wt/ut,Ut/ut];var Cs=C.unproject(Mi(fi));return Pr([Cs.lat+Vi.lat,Cs.lng+Vi.lng])}function Oo(m){for(var C=0,z=0,U=0,Q=0;Q<m.length;Q++){var fe=Pr(m[Q]);C+=fe.lat,z+=fe.lng,U++}return Pr([C/U,z/U])}var os={__proto__:null,clipPolygon:Ml,polygonCenter:Ws,centroid:Oo};function tl(m,C){if(!C||!m.length)return m.slice();var z=C*C;return m=Ol(m,z),m=ir(m,z),m}function Gt(m,C,z){return Math.sqrt(fn(m,C,z,!0))}function Zi(m,C,z){return fn(m,C,z)}function ir(m,C){var z=m.length,U=typeof Uint8Array<"u"?Uint8Array:Array,Q=new U(z);Q[0]=Q[z-1]=1,xo(m,Q,C,0,z-1);var fe,Ve=[];for(fe=0;fe<z;fe++)Q[fe]&&Ve.push(m[fe]);return Ve}function xo(m,C,z,U,Q){var fe=0,Ve,ut,wt;for(ut=U+1;ut<=Q-1;ut++)wt=fn(m[ut],m[U],m[Q],!0),wt>fe&&(Ve=ut,fe=wt);fe>z&&(C[Ve]=1,xo(m,C,z,U,Ve),xo(m,C,z,Ve,Q))}function Ol(m,C){for(var z=[m[0]],U=1,Q=0,fe=m.length;U<fe;U++)qn(m[U],m[Q])>C&&(z.push(m[U]),Q=U);return Q<fe-1&&z.push(m[fe-1]),z}var ur;function Rl(m,C,z,U,Q){var fe=U?ur:ws(m,z),Ve=ws(C,z),ut,wt,Ut;for(ur=Ve;;){if(!(fe|Ve))return[m,C];if(fe&Ve)return!1;ut=fe||Ve,wt=Gs(m,C,ut,z,Q),Ut=ws(wt,z),ut===fe?(m=wt,fe=Ut):(C=wt,Ve=Ut)}}function Gs(m,C,z,U,Q){var fe=C.x-m.x,Ve=C.y-m.y,ut=U.min,wt=U.max,Ut,fi;return z&8?(Ut=m.x+fe*(wt.y-m.y)/Ve,fi=wt.y):z&4?(Ut=m.x+fe*(ut.y-m.y)/Ve,fi=ut.y):z&2?(Ut=wt.x,fi=m.y+Ve*(wt.x-m.x)/fe):z&1&&(Ut=ut.x,fi=m.y+Ve*(ut.x-m.x)/fe),new oi(Ut,fi,Q)}function ws(m,C){var z=0;return m.x<C.min.x?z|=1:m.x>C.max.x&&(z|=2),m.y<C.min.y?z|=4:m.y>C.max.y&&(z|=8),z}function qn(m,C){var z=C.x-m.x,U=C.y-m.y;return z*z+U*U}function fn(m,C,z,U){var Q=C.x,fe=C.y,Ve=z.x-Q,ut=z.y-fe,wt=Ve*Ve+ut*ut,Ut;return wt>0&&(Ut=((m.x-Q)*Ve+(m.y-fe)*ut)/wt,Ut>1?(Q=z.x,fe=z.y):Ut>0&&(Q+=Ve*Ut,fe+=ut*Ut)),Ve=m.x-Q,ut=m.y-fe,U?Ve*Ve+ut*ut:new oi(Q,fe)}function ss(m){return!qe(m[0])||typeof m[0][0]!="object"&&typeof m[0][0]<"u"}function Dl(m){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ss(m)}function Jc(m,C){var z,U,Q,fe,Ve,ut,wt,Ut;if(!m||m.length===0)throw new Error("latlngs not passed");ss(m)||(console.warn("latlngs are not flat! Only the first ring will be used"),m=m[0]);var fi=Pr([0,0]),Vi=nn(m),vr=Vi.getNorthWest().distanceTo(Vi.getSouthWest())*Vi.getNorthEast().distanceTo(Vi.getNorthWest());vr<1700&&(fi=Oo(m));var lo=m.length,In=[];for(z=0;z<lo;z++){var co=Pr(m[z]);In.push(C.project(Pr([co.lat-fi.lat,co.lng-fi.lng])))}for(z=0,U=0;z<lo-1;z++)U+=In[z].distanceTo(In[z+1])/2;if(U===0)Ut=In[0];else for(z=0,fe=0;z<lo-1;z++)if(Ve=In[z],ut=In[z+1],Q=Ve.distanceTo(ut),fe+=Q,fe>U){wt=(fe-U)/Q,Ut=[ut.x-wt*(ut.x-Ve.x),ut.y-wt*(ut.y-Ve.y)];break}var eo=C.unproject(Mi(Ut));return Pr([eo.lat+fi.lat,eo.lng+fi.lng])}var gc={__proto__:null,simplify:tl,pointToSegmentDistance:Gt,closestPointOnSegment:Zi,clipSegment:Rl,_getEdgeIntersection:Gs,_getBitCode:ws,_sqClosestPointOnSegment:fn,isFlat:ss,_flat:Dl,polylineCenter:Jc},Bl={project:function(m){return new oi(m.lng,m.lat)},unproject:function(m){return new Kr(m.y,m.x)},bounds:new Dr([-180,-90],[180,90])},_c={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Dr([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(m){var C=Math.PI/180,z=this.R,U=m.lat*C,Q=this.R_MINOR/z,fe=Math.sqrt(1-Q*Q),Ve=fe*Math.sin(U),ut=Math.tan(Math.PI/4-U/2)/Math.pow((1-Ve)/(1+Ve),fe/2);return U=-z*Math.log(Math.max(ut,1e-10)),new oi(m.lng*C*z,U)},unproject:function(m){for(var C=180/Math.PI,z=this.R,U=this.R_MINOR/z,Q=Math.sqrt(1-U*U),fe=Math.exp(-m.y/z),Ve=Math.PI/2-2*Math.atan(fe),ut=0,wt=.1,Ut;ut<15&&Math.abs(wt)>1e-7;ut++)Ut=Q*Math.sin(Ve),Ut=Math.pow((1-Ut)/(1+Ut),Q/2),wt=Math.PI/2-2*Math.atan(fe*Ut)-Ve,Ve+=wt;return new Kr(Ve*C,m.x*C/z)}},yc={__proto__:null,LonLat:Bl,Mercator:_c,SphericalMercator:_n},jn=v({},oo,{code:"EPSG:3395",projection:_c,transformation:(function(){var m=.5/(Math.PI*_c.R);return Vs(m,.5,-m,.5)})()}),Hs=v({},oo,{code:"EPSG:4326",projection:Bl,transformation:Vs(1/180,1,-1/180,.5)}),Io=v({},Uo,{projection:Bl,transformation:Vs(1,0,-1,0),scale:function(m){return Math.pow(2,m)},zoom:function(m){return Math.log(m)/Math.LN2},distance:function(m,C){var z=C.lng-m.lng,U=C.lat-m.lat;return Math.sqrt(z*z+U*U)},infinite:!0});Uo.Earth=oo,Uo.EPSG3395=jn,Uo.EPSG3857=Wr,Uo.EPSG900913=Ta,Uo.EPSG4326=Hs,Uo.Simple=Io;var Ro=Ai.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(m){return m.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(m){return m&&m.removeLayer(this),this},getPane:function(m){return this._map.getPane(m?this.options[m]||m:this.options.pane)},addInteractiveTarget:function(m){return this._map._targets[R(m)]=this,this},removeInteractiveTarget:function(m){return delete this._map._targets[R(m)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(m){var C=m.target;if(C.hasLayer(this)){if(this._map=C,this._zoomAnimated=C._zoomAnimated,this.getEvents){var z=this.getEvents();C.on(z,this),this.once("remove",function(){C.off(z,this)},this)}this.onAdd(C),this.fire("add"),C.fire("layeradd",{layer:this})}}});zr.include({addLayer:function(m){if(!m._layerAdd)throw new Error("The provided object is not a Layer.");var C=R(m);return this._layers[C]?this:(this._layers[C]=m,m._mapToAdd=this,m.beforeAdd&&m.beforeAdd(this),this.whenReady(m._layerAdd,m),this)},removeLayer:function(m){var C=R(m);return this._layers[C]?(this._loaded&&m.onRemove(this),delete this._layers[C],this._loaded&&(this.fire("layerremove",{layer:m}),m.fire("remove")),m._map=m._mapToAdd=null,this):this},hasLayer:function(m){return R(m)in this._layers},eachLayer:function(m,C){for(var z in this._layers)m.call(C,this._layers[z]);return this},_addLayers:function(m){m=m?qe(m)?m:[m]:[];for(var C=0,z=m.length;C<z;C++)this.addLayer(m[C])},_addZoomLimit:function(m){(!isNaN(m.options.maxZoom)||!isNaN(m.options.minZoom))&&(this._zoomBoundLayers[R(m)]=m,this._updateZoomLevels())},_removeZoomLimit:function(m){var C=R(m);this._zoomBoundLayers[C]&&(delete this._zoomBoundLayers[C],this._updateZoomLevels())},_updateZoomLevels:function(){var m=1/0,C=-1/0,z=this._getZoomSpan();for(var U in this._zoomBoundLayers){var Q=this._zoomBoundLayers[U].options;m=Q.minZoom===void 0?m:Math.min(m,Q.minZoom),C=Q.maxZoom===void 0?C:Math.max(C,Q.maxZoom)}this._layersMaxZoom=C===-1/0?void 0:C,this._layersMinZoom=m===1/0?void 0:m,z!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ss=Ro.extend({initialize:function(m,C){Se(this,C),this._layers={};var z,U;if(m)for(z=0,U=m.length;z<U;z++)this.addLayer(m[z])},addLayer:function(m){var C=this.getLayerId(m);return this._layers[C]=m,this._map&&this._map.addLayer(m),this},removeLayer:function(m){var C=m in this._layers?m:this.getLayerId(m);return this._map&&this._layers[C]&&this._map.removeLayer(this._layers[C]),delete this._layers[C],this},hasLayer:function(m){var C=typeof m=="number"?m:this.getLayerId(m);return C in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(m){var C=Array.prototype.slice.call(arguments,1),z,U;for(z in this._layers)U=this._layers[z],U[m]&&U[m].apply(U,C);return this},onAdd:function(m){this.eachLayer(m.addLayer,m)},onRemove:function(m){this.eachLayer(m.removeLayer,m)},eachLayer:function(m,C){for(var z in this._layers)m.call(C,this._layers[z]);return this},getLayer:function(m){return this._layers[m]},getLayers:function(){var m=[];return this.eachLayer(m.push,m),m},setZIndex:function(m){return this.invoke("setZIndex",m)},getLayerId:function(m){return R(m)}}),On=function(m,C){return new Ss(m,C)},Jn=Ss.extend({addLayer:function(m){return this.hasLayer(m)?this:(m.addEventParent(this),Ss.prototype.addLayer.call(this,m),this.fire("layeradd",{layer:m}))},removeLayer:function(m){return this.hasLayer(m)?(m in this._layers&&(m=this._layers[m]),m.removeEventParent(this),Ss.prototype.removeLayer.call(this,m),this.fire("layerremove",{layer:m})):this},setStyle:function(m){return this.invoke("setStyle",m)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var m=new er;for(var C in this._layers){var z=this._layers[C];m.extend(z.getBounds?z.getBounds():z.getLatLng())}return m}}),pa=function(m,C){return new Jn(m,C)},$r=Di.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(m){Se(this,m)},createIcon:function(m){return this._createIcon("icon",m)},createShadow:function(m){return this._createIcon("shadow",m)},_createIcon:function(m,C){var z=this._getIconUrl(m);if(!z){if(m==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var U=this._createImg(z,C&&C.tagName==="IMG"?C:null);return this._setIconStyles(U,m),(this.options.crossOrigin||this.options.crossOrigin==="")&&(U.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),U},_setIconStyles:function(m,C){var z=this.options,U=z[C+"Size"];typeof U=="number"&&(U=[U,U]);var Q=Mi(U),fe=Mi(C==="shadow"&&z.shadowAnchor||z.iconAnchor||Q&&Q.divideBy(2,!0));m.className="leaflet-marker-"+C+" "+(z.className||""),fe&&(m.style.marginLeft=-fe.x+"px",m.style.marginTop=-fe.y+"px"),Q&&(m.style.width=Q.x+"px",m.style.height=Q.y+"px")},_createImg:function(m,C){return C=C||document.createElement("img"),C.src=m,C},_getIconUrl:function(m){return ki.retina&&this.options[m+"RetinaUrl"]||this.options[m+"Url"]}});function vi(m){return new $r(m)}var Rt=$r.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(m){return typeof Rt.imagePath!="string"&&(Rt.imagePath=this._detectIconPath()),(this.options.imagePath||Rt.imagePath)+$r.prototype._getIconUrl.call(this,m)},_stripUrl:function(m){var C=function(z,U,Q){var fe=U.exec(z);return fe&&fe[Q]};return m=C(m,/^url\((['"])?(.+)\1\)$/,2),m&&C(m,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var m=Kt("div","leaflet-default-icon-path",document.body),C=Ki(m,"background-image")||Ki(m,"backgroundImage");if(document.body.removeChild(m),C=this._stripUrl(C),C)return C;var z=document.querySelector('link[href$="leaflet.css"]');return z?z.href.substring(0,z.href.length-11-1):""}}),Oa=ns.extend({initialize:function(m){this._marker=m},addHooks:function(){var m=this._marker._icon;this._draggable||(this._draggable=new $t(m,m,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ri(m,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Jr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(m){var C=this._marker,z=C._map,U=this._marker.options.autoPanSpeed,Q=this._marker.options.autoPanPadding,fe=qs(C._icon),Ve=z.getPixelBounds(),ut=z.getPixelOrigin(),wt=gn(Ve.min._subtract(ut).add(Q),Ve.max._subtract(ut).subtract(Q));if(!wt.contains(fe)){var Ut=Mi((Math.max(wt.max.x,fe.x)-wt.max.x)/(Ve.max.x-wt.max.x)-(Math.min(wt.min.x,fe.x)-wt.min.x)/(Ve.min.x-wt.min.x),(Math.max(wt.max.y,fe.y)-wt.max.y)/(Ve.max.y-wt.max.y)-(Math.min(wt.min.y,fe.y)-wt.min.y)/(Ve.min.y-wt.min.y)).multiplyBy(U);z.panBy(Ut,{animate:!1}),this._draggable._newPos._add(Ut),this._draggable._startPos._add(Ut),Zr(C._icon,this._draggable._newPos),this._onDrag(m),this._panRequest=li(this._adjustPan.bind(this,m))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(m){this._marker.options.autoPan&&(Hi(this._panRequest),this._panRequest=li(this._adjustPan.bind(this,m)))},_onDrag:function(m){var C=this._marker,z=C._shadow,U=qs(C._icon),Q=C._map.layerPointToLatLng(U);z&&Zr(z,U),C._latlng=Q,m.latlng=Q,m.oldLatLng=this._oldLatLng,C.fire("move",m).fire("drag",m)},_onDragEnd:function(m){Hi(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",m)}}),ni=Ro.extend({options:{icon:new Rt,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(m,C){Se(this,C),this._latlng=Pr(m)},onAdd:function(m){this._zoomAnimated=this._zoomAnimated&&m.options.markerZoomAnimation,this._zoomAnimated&&m.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(m){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&m.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(m){var C=this._latlng;return this._latlng=Pr(m),this.update(),this.fire("move",{oldLatLng:C,latlng:this._latlng})},setZIndexOffset:function(m){return this.options.zIndexOffset=m,this.update()},getIcon:function(){return this.options.icon},setIcon:function(m){return this.options.icon=m,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var m=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(m)}return this},_initIcon:function(){var m=this.options,C="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),z=m.icon.createIcon(this._icon),U=!1;z!==this._icon&&(this._icon&&this._removeIcon(),U=!0,m.title&&(z.title=m.title),z.tagName==="IMG"&&(z.alt=m.alt||"")),Ri(z,C),m.keyboard&&(z.tabIndex="0",z.setAttribute("role","button")),this._icon=z,m.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&pr(z,"focus",this._panOnFocus,this);var Q=m.icon.createShadow(this._shadow),fe=!1;Q!==this._shadow&&(this._removeShadow(),fe=!0),Q&&(Ri(Q,C),Q.alt=""),this._shadow=Q,m.opacity<1&&this._updateOpacity(),U&&this.getPane().appendChild(this._icon),this._initInteraction(),Q&&fe&&this.getPane(m.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Lr(this._icon,"focus",this._panOnFocus,this),Ii(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ii(this._shadow),this._shadow=null},_setPos:function(m){this._icon&&Zr(this._icon,m),this._shadow&&Zr(this._shadow,m),this._zIndex=m.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(m){this._icon&&(this._icon.style.zIndex=this._zIndex+m)},_animateZoom:function(m){var C=this._map._latLngToNewLayerPoint(this._latlng,m.zoom,m.center).round();this._setPos(C)},_initInteraction:function(){if(this.options.interactive&&(Ri(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Oa)){var m=this.options.draggable;this.dragging&&(m=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Oa(this),m&&this.dragging.enable()}},setOpacity:function(m){return this.options.opacity=m,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var m=this.options.opacity;this._icon&&Pn(this._icon,m),this._shadow&&Pn(this._shadow,m)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var m=this._map;if(m){var C=this.options.icon.options,z=C.iconSize?Mi(C.iconSize):Mi(0,0),U=C.iconAnchor?Mi(C.iconAnchor):Mi(0,0);m.panInside(this._latlng,{paddingTopLeft:U,paddingBottomRight:z.subtract(U)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Fl(m,C){return new ni(m,C)}var Ts=Ro.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(m){this._renderer=m.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(m){return Se(this,m),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&m&&Object.prototype.hasOwnProperty.call(m,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Jt=Ts.extend({options:{fill:!0,radius:10},initialize:function(m,C){Se(this,C),this._latlng=Pr(m),this._radius=this.options.radius},setLatLng:function(m){var C=this._latlng;return this._latlng=Pr(m),this.redraw(),this.fire("move",{oldLatLng:C,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(m){return this.options.radius=this._radius=m,this.redraw()},getRadius:function(){return this._radius},setStyle:function(m){var C=m&&m.radius||this._radius;return Ts.prototype.setStyle.call(this,m),this.setRadius(C),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var m=this._radius,C=this._radiusY||m,z=this._clickTolerance(),U=[m+z,C+z];this._pxBounds=new Dr(this._point.subtract(U),this._point.add(U))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(m){return m.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function vc(m,C){return new Jt(m,C)}var Nl=Jt.extend({initialize:function(m,C,z){if(typeof C=="number"&&(C=v({},z,{radius:C})),Se(this,C),this._latlng=Pr(m),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(m){return this._mRadius=m,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var m=[this._radius,this._radiusY||this._radius];return new er(this._map.layerPointToLatLng(this._point.subtract(m)),this._map.layerPointToLatLng(this._point.add(m)))},setStyle:Ts.prototype.setStyle,_project:function(){var m=this._latlng.lng,C=this._latlng.lat,z=this._map,U=z.options.crs;if(U.distance===oo.distance){var Q=Math.PI/180,fe=this._mRadius/oo.R/Q,Ve=z.project([C+fe,m]),ut=z.project([C-fe,m]),wt=Ve.add(ut).divideBy(2),Ut=z.unproject(wt).lat,fi=Math.acos((Math.cos(fe*Q)-Math.sin(C*Q)*Math.sin(Ut*Q))/(Math.cos(C*Q)*Math.cos(Ut*Q)))/Q;(isNaN(fi)||fi===0)&&(fi=fe/Math.cos(Math.PI/180*C)),this._point=wt.subtract(z.getPixelOrigin()),this._radius=isNaN(fi)?0:wt.x-z.project([Ut,m-fi]).x,this._radiusY=wt.y-Ve.y}else{var Vi=U.unproject(U.project(this._latlng).subtract([this._mRadius,0]));this._point=z.latLngToLayerPoint(this._latlng),this._radius=this._point.x-z.latLngToLayerPoint(Vi).x}this._updateBounds()}});function Nd(m,C,z){return new Nl(m,C,z)}var Qn=Ts.extend({options:{smoothFactor:1,noClip:!1},initialize:function(m,C){Se(this,C),this._setLatLngs(m)},getLatLngs:function(){return this._latlngs},setLatLngs:function(m){return this._setLatLngs(m),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(m){for(var C=1/0,z=null,U=fn,Q,fe,Ve=0,ut=this._parts.length;Ve<ut;Ve++)for(var wt=this._parts[Ve],Ut=1,fi=wt.length;Ut<fi;Ut++){Q=wt[Ut-1],fe=wt[Ut];var Vi=U(m,Q,fe,!0);Vi<C&&(C=Vi,z=U(m,Q,fe))}return z&&(z.distance=Math.sqrt(C)),z},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jc(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(m,C){return C=C||this._defaultShape(),m=Pr(m),C.push(m),this._bounds.extend(m),this.redraw()},_setLatLngs:function(m){this._bounds=new er,this._latlngs=this._convertLatLngs(m)},_defaultShape:function(){return ss(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(m){for(var C=[],z=ss(m),U=0,Q=m.length;U<Q;U++)z?(C[U]=Pr(m[U]),this._bounds.extend(C[U])):C[U]=this._convertLatLngs(m[U]);return C},_project:function(){var m=new Dr;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,m),this._bounds.isValid()&&m.isValid()&&(this._rawPxBounds=m,this._updateBounds())},_updateBounds:function(){var m=this._clickTolerance(),C=new oi(m,m);this._rawPxBounds&&(this._pxBounds=new Dr([this._rawPxBounds.min.subtract(C),this._rawPxBounds.max.add(C)]))},_projectLatlngs:function(m,C,z){var U=m[0]instanceof Kr,Q=m.length,fe,Ve;if(U){for(Ve=[],fe=0;fe<Q;fe++)Ve[fe]=this._map.latLngToLayerPoint(m[fe]),z.extend(Ve[fe]);C.push(Ve)}else for(fe=0;fe<Q;fe++)this._projectLatlngs(m[fe],C,z)},_clipPoints:function(){var m=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(m))){if(this.options.noClip){this._parts=this._rings;return}var C=this._parts,z,U,Q,fe,Ve,ut,wt;for(z=0,Q=0,fe=this._rings.length;z<fe;z++)for(wt=this._rings[z],U=0,Ve=wt.length;U<Ve-1;U++)ut=Rl(wt[U],wt[U+1],m,U,!0),ut&&(C[Q]=C[Q]||[],C[Q].push(ut[0]),(ut[1]!==wt[U+1]||U===Ve-2)&&(C[Q].push(ut[1]),Q++))}},_simplifyPoints:function(){for(var m=this._parts,C=this.options.smoothFactor,z=0,U=m.length;z<U;z++)m[z]=tl(m[z],C)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(m,C){var z,U,Q,fe,Ve,ut,wt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(m))return!1;for(z=0,fe=this._parts.length;z<fe;z++)for(ut=this._parts[z],U=0,Ve=ut.length,Q=Ve-1;U<Ve;Q=U++)if(!(!C&&U===0)&&Gt(m,ut[Q],ut[U])<=wt)return!0;return!1}});function Qc(m,C){return new Qn(m,C)}Qn._flat=Dl;var En=Qn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ws(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(m){var C=Qn.prototype._convertLatLngs.call(this,m),z=C.length;return z>=2&&C[0]instanceof Kr&&C[0].equals(C[z-1])&&C.pop(),C},_setLatLngs:function(m){Qn.prototype._setLatLngs.call(this,m),ss(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ss(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var m=this._renderer._bounds,C=this.options.weight,z=new oi(C,C);if(m=new Dr(m.min.subtract(z),m.max.add(z)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(m))){if(this.options.noClip){this._parts=this._rings;return}for(var U=0,Q=this._rings.length,fe;U<Q;U++)fe=Ml(this._rings[U],m,!0),fe.length&&this._parts.push(fe)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(m){var C=!1,z,U,Q,fe,Ve,ut,wt,Ut;if(!this._pxBounds||!this._pxBounds.contains(m))return!1;for(fe=0,wt=this._parts.length;fe<wt;fe++)for(z=this._parts[fe],Ve=0,Ut=z.length,ut=Ut-1;Ve<Ut;ut=Ve++)U=z[Ve],Q=z[ut],U.y>m.y!=Q.y>m.y&&m.x<(Q.x-U.x)*(m.y-U.y)/(Q.y-U.y)+U.x&&(C=!C);return C||Qn.prototype._containsPoint.call(this,m,!0)}});function ao(m,C){return new En(m,C)}var Po=Jn.extend({initialize:function(m,C){Se(this,C),this._layers={},m&&this.addData(m)},addData:function(m){var C=qe(m)?m:m.features,z,U,Q;if(C){for(z=0,U=C.length;z<U;z++)Q=C[z],(Q.geometries||Q.geometry||Q.features||Q.coordinates)&&this.addData(Q);return this}var fe=this.options;if(fe.filter&&!fe.filter(m))return this;var Ve=fa(m,fe);return Ve?(Ve.feature=xc(m),Ve.defaultOptions=Ve.options,this.resetStyle(Ve),fe.onEachFeature&&fe.onEachFeature(m,Ve),this.addLayer(Ve)):this},resetStyle:function(m){return m===void 0?this.eachLayer(this.resetStyle,this):(m.options=v({},m.defaultOptions),this._setLayerStyle(m,this.options.style),this)},setStyle:function(m){return this.eachLayer(function(C){this._setLayerStyle(C,m)},this)},_setLayerStyle:function(m,C){m.setStyle&&(typeof C=="function"&&(C=C(m.feature)),m.setStyle(C))}});function fa(m,C){var z=m.type==="Feature"?m.geometry:m,U=z?z.coordinates:null,Q=[],fe=C&&C.pointToLayer,Ve=C&&C.coordsToLatLng||Rn,ut,wt,Ut,fi;if(!U&&!z)return null;switch(z.type){case"Point":return ut=Ve(U),Zs(fe,m,ut,C);case"MultiPoint":for(Ut=0,fi=U.length;Ut<fi;Ut++)ut=Ve(U[Ut]),Q.push(Zs(fe,m,ut,C));return new Jn(Q);case"LineString":case"MultiLineString":return wt=eu(U,z.type==="LineString"?0:1,Ve),new Qn(wt,C);case"Polygon":case"MultiPolygon":return wt=eu(U,z.type==="Polygon"?1:2,Ve),new En(wt,C);case"GeometryCollection":for(Ut=0,fi=z.geometries.length;Ut<fi;Ut++){var Vi=fa({geometry:z.geometries[Ut],type:"Feature",properties:m.properties},C);Vi&&Q.push(Vi)}return new Jn(Q);case"FeatureCollection":for(Ut=0,fi=z.features.length;Ut<fi;Ut++){var vr=fa(z.features[Ut],C);vr&&Q.push(vr)}return new Jn(Q);default:throw new Error("Invalid GeoJSON object.")}}function Zs(m,C,z,U){return m?m(C,z):new ni(z,U&&U.markersInheritOptions&&U)}function Rn(m){return new Kr(m[1],m[0],m[2])}function eu(m,C,z){for(var U=[],Q=0,fe=m.length,Ve;Q<fe;Q++)Ve=C?eu(m[Q],C-1,z):(z||Rn)(m[Q]),U.push(Ve);return U}function Ju(m,C){return m=Pr(m),m.alt!==void 0?[me(m.lng,C),me(m.lat,C),me(m.alt,C)]:[me(m.lng,C),me(m.lat,C)]}function Ra(m,C,z,U){for(var Q=[],fe=0,Ve=m.length;fe<Ve;fe++)Q.push(C?Ra(m[fe],ss(m[fe])?0:C-1,z,U):Ju(m[fe],U));return!C&&z&&Q.length>0&&Q.push(Q[0].slice()),Q}function Ho(m,C){return m.feature?v({},m.feature,{geometry:C}):xc(C)}function xc(m){return m.type==="Feature"||m.type==="FeatureCollection"?m:{type:"Feature",properties:{},geometry:m}}var Do={toGeoJSON:function(m){return Ho(this,{type:"Point",coordinates:Ju(this.getLatLng(),m)})}};ni.include(Do),Nl.include(Do),Jt.include(Do),Qn.include({toGeoJSON:function(m){var C=!ss(this._latlngs),z=Ra(this._latlngs,C?1:0,!1,m);return Ho(this,{type:(C?"Multi":"")+"LineString",coordinates:z})}}),En.include({toGeoJSON:function(m){var C=!ss(this._latlngs),z=C&&!ss(this._latlngs[0]),U=Ra(this._latlngs,z?2:C?1:0,!0,m);return C||(U=[U]),Ho(this,{type:(z?"Multi":"")+"Polygon",coordinates:U})}}),Ss.include({toMultiPoint:function(m){var C=[];return this.eachLayer(function(z){C.push(z.toGeoJSON(m).geometry.coordinates)}),Ho(this,{type:"MultiPoint",coordinates:C})},toGeoJSON:function(m){var C=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(C==="MultiPoint")return this.toMultiPoint(m);var z=C==="GeometryCollection",U=[];return this.eachLayer(function(Q){if(Q.toGeoJSON){var fe=Q.toGeoJSON(m);if(z)U.push(fe.geometry);else{var Ve=xc(fe);Ve.type==="FeatureCollection"?U.push.apply(U,Ve.features):U.push(Ve)}}}),z?Ho(this,{geometries:U,type:"GeometryCollection"}):{type:"FeatureCollection",features:U}}});function Qu(m,C){return new Po(m,C)}var tu=Qu,Da=Ro.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(m,C,z){this._url=m,this._bounds=nn(C),Se(this,z)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ri(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ii(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(m){return this.options.opacity=m,this._image&&this._updateOpacity(),this},setStyle:function(m){return m.opacity&&this.setOpacity(m.opacity),this},bringToFront:function(){return this._map&&tr(this._image),this},bringToBack:function(){return this._map&&yr(this._image),this},setUrl:function(m){return this._url=m,this._image&&(this._image.src=m),this},setBounds:function(m){return this._bounds=nn(m),this._map&&this._reset(),this},getEvents:function(){var m={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(m.zoomanim=this._animateZoom),m},setZIndex:function(m){return this.options.zIndex=m,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var m=this._url.tagName==="IMG",C=this._image=m?this._url:Kt("img");if(Ri(C,"leaflet-image-layer"),this._zoomAnimated&&Ri(C,"leaflet-zoom-animated"),this.options.className&&Ri(C,this.options.className),C.onselectstart=re,C.onmousemove=re,C.onload=T(this.fire,this,"load"),C.onerror=T(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(C.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),m){this._url=C.src;return}C.src=this._url,C.alt=this.options.alt},_animateZoom:function(m){var C=this._map.getZoomScale(m.zoom),z=this._map._latLngBoundsToNewLayerBounds(this._bounds,m.zoom,m.center).min;Un(this._image,z,C)},_reset:function(){var m=this._image,C=new Dr(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),z=C.getSize();Zr(m,C.min),m.style.width=z.x+"px",m.style.height=z.y+"px"},_updateOpacity:function(){Pn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var m=this.options.errorOverlayUrl;m&&this._url!==m&&(this._url=m,this._image.src=m)},getCenter:function(){return this._bounds.getCenter()}}),Ba=function(m,C,z){return new Da(m,C,z)},jd=Da.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var m=this._url.tagName==="VIDEO",C=this._image=m?this._url:Kt("video");if(Ri(C,"leaflet-image-layer"),this._zoomAnimated&&Ri(C,"leaflet-zoom-animated"),this.options.className&&Ri(C,this.options.className),C.onselectstart=re,C.onmousemove=re,C.onloadeddata=T(this.fire,this,"load"),m){for(var z=C.getElementsByTagName("source"),U=[],Q=0;Q<z.length;Q++)U.push(z[Q].src);this._url=z.length>0?U:[C.src];return}qe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(C.style,"objectFit")&&(C.style.objectFit="fill"),C.autoplay=!!this.options.autoplay,C.loop=!!this.options.loop,C.muted=!!this.options.muted,C.playsInline=!!this.options.playsInline;for(var fe=0;fe<this._url.length;fe++){var Ve=Kt("source");Ve.src=this._url[fe],C.appendChild(Ve)}}});function Vd(m,C,z){return new jd(m,C,z)}var Ud=Da.extend({_initImage:function(){var m=this._image=this._url;Ri(m,"leaflet-image-layer"),this._zoomAnimated&&Ri(m,"leaflet-zoom-animated"),this.options.className&&Ri(m,this.options.className),m.onselectstart=re,m.onmousemove=re}});function Fa(m,C,z){return new Ud(m,C,z)}var $s=Ro.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(m,C){m&&(m instanceof Kr||qe(m))?(this._latlng=Pr(m),Se(this,C)):(Se(this,m),this._source=C),this.options.content&&(this._content=this.options.content)},openOn:function(m){return m=arguments.length?m:this._source._map,m.hasLayer(this)||m.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(m){return this._map?this.close():(arguments.length?this._source=m:m=this._source,this._prepareOpen(),this.openOn(m._map)),this},onAdd:function(m){this._zoomAnimated=m._zoomAnimated,this._container||this._initLayout(),m._fadeAnimated&&Pn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),m._fadeAnimated&&Pn(this._container,1),this.bringToFront(),this.options.interactive&&(Ri(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(m){m._fadeAnimated?(Pn(this._container,0),this._removeTimeout=setTimeout(T(Ii,void 0,this._container),200)):Ii(this._container),this.options.interactive&&(Jr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(m){return this._latlng=Pr(m),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(m){return this._content=m,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var m={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(m.zoomanim=this._animateZoom),m},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&tr(this._container),this},bringToBack:function(){return this._map&&yr(this._container),this},_prepareOpen:function(m){var C=this._source;if(!C._map)return!1;if(C instanceof Jn){C=null;var z=this._source._layers;for(var U in z)if(z[U]._map){C=z[U];break}if(!C)return!1;this._source=C}if(!m)if(C.getCenter)m=C.getCenter();else if(C.getLatLng)m=C.getLatLng();else if(C.getBounds)m=C.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(m),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var m=this._contentNode,C=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof C=="string")m.innerHTML=C;else{for(;m.hasChildNodes();)m.removeChild(m.firstChild);m.appendChild(C)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var m=this._map.latLngToLayerPoint(this._latlng),C=Mi(this.options.offset),z=this._getAnchor();this._zoomAnimated?Zr(this._container,m.add(z)):C=C.add(m).add(z);var U=this._containerBottom=-C.y,Q=this._containerLeft=-Math.round(this._containerWidth/2)+C.x;this._container.style.bottom=U+"px",this._container.style.left=Q+"px"}},_getAnchor:function(){return[0,0]}});zr.include({_initOverlay:function(m,C,z,U){var Q=C;return Q instanceof m||(Q=new m(U).setContent(C)),z&&Q.setLatLng(z),Q}}),Ro.include({_initOverlay:function(m,C,z,U){var Q=z;return Q instanceof m?(Se(Q,U),Q._source=this):(Q=C&&!U?C:new m(U,this),Q.setContent(z)),Q}});var jl=$s.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(m){return m=arguments.length?m:this._source._map,!m.hasLayer(this)&&m._popup&&m._popup.options.autoClose&&m.removeLayer(m._popup),m._popup=this,$s.prototype.openOn.call(this,m)},onAdd:function(m){$s.prototype.onAdd.call(this,m),m.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ts||this._source.on("preclick",xs))},onRemove:function(m){$s.prototype.onRemove.call(this,m),m.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ts||this._source.off("preclick",xs))},getEvents:function(){var m=$s.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(m.preclick=this.close),this.options.keepInView&&(m.moveend=this._adjustPan),m},_initLayout:function(){var m="leaflet-popup",C=this._container=Kt("div",m+" "+(this.options.className||"")+" leaflet-zoom-animated"),z=this._wrapper=Kt("div",m+"-content-wrapper",C);if(this._contentNode=Kt("div",m+"-content",z),Ni(C),Ma(this._contentNode),pr(C,"contextmenu",xs),this._tipContainer=Kt("div",m+"-tip-container",C),this._tip=Kt("div",m+"-tip",this._tipContainer),this.options.closeButton){var U=this._closeButton=Kt("a",m+"-close-button",C);U.setAttribute("role","button"),U.setAttribute("aria-label","Close popup"),U.href="#close",U.innerHTML='<span aria-hidden="true">&#215;</span>',pr(U,"click",function(Q){Zn(Q),this.close()},this)}},_updateLayout:function(){var m=this._contentNode,C=m.style;C.width="",C.whiteSpace="nowrap";var z=m.offsetWidth;z=Math.min(z,this.options.maxWidth),z=Math.max(z,this.options.minWidth),C.width=z+1+"px",C.whiteSpace="",C.height="";var U=m.offsetHeight,Q=this.options.maxHeight,fe="leaflet-popup-scrolled";Q&&U>Q?(C.height=Q+"px",Ri(m,fe)):Jr(m,fe),this._containerWidth=this._container.offsetWidth},_animateZoom:function(m){var C=this._map._latLngToNewLayerPoint(this._latlng,m.zoom,m.center),z=this._getAnchor();Zr(this._container,C.add(z))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var m=this._map,C=parseInt(Ki(this._container,"marginBottom"),10)||0,z=this._container.offsetHeight+C,U=this._containerWidth,Q=new oi(this._containerLeft,-z-this._containerBottom);Q._add(qs(this._container));var fe=m.layerPointToContainerPoint(Q),Ve=Mi(this.options.autoPanPadding),ut=Mi(this.options.autoPanPaddingTopLeft||Ve),wt=Mi(this.options.autoPanPaddingBottomRight||Ve),Ut=m.getSize(),fi=0,Vi=0;fe.x+U+wt.x>Ut.x&&(fi=fe.x+U-Ut.x+wt.x),fe.x-fi-ut.x<0&&(fi=fe.x-ut.x),fe.y+z+wt.y>Ut.y&&(Vi=fe.y+z-Ut.y+wt.y),fe.y-Vi-ut.y<0&&(Vi=fe.y-ut.y),(fi||Vi)&&(this.options.keepInView&&(this._autopanning=!0),m.fire("autopanstart").panBy([fi,Vi]))}},_getAnchor:function(){return Mi(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),iu=function(m,C){return new jl(m,C)};zr.mergeOptions({closePopupOnClick:!0}),zr.include({openPopup:function(m,C,z){return this._initOverlay(jl,m,C,z).openOn(this),this},closePopup:function(m){return m=arguments.length?m:this._popup,m&&m.close(),this}}),Ro.include({bindPopup:function(m,C){return this._popup=this._initOverlay(jl,this._popup,m,C),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(m){return this._popup&&(this instanceof Jn||(this._popup._source=this),this._popup._prepareOpen(m||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(m){return this._popup&&this._popup.setContent(m),this},getPopup:function(){return this._popup},_openPopup:function(m){if(!(!this._popup||!this._map)){bs(m);var C=m.layer||m.target;if(this._popup._source===C&&!(C instanceof Ts)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(m.latlng);return}this._popup._source=C,this.openPopup(m.latlng)}},_movePopup:function(m){this._popup.setLatLng(m.latlng)},_onKeyPress:function(m){m.originalEvent.keyCode===13&&this._openPopup(m)}});var Vl=$s.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(m){$s.prototype.onAdd.call(this,m),this.setOpacity(this.options.opacity),m.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(m){$s.prototype.onRemove.call(this,m),m.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var m=$s.prototype.getEvents.call(this);return this.options.permanent||(m.preclick=this.close),m},_initLayout:function(){var m="leaflet-tooltip",C=m+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Kt("div",C),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+R(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(m){var C,z,U=this._map,Q=this._container,fe=U.latLngToContainerPoint(U.getCenter()),Ve=U.layerPointToContainerPoint(m),ut=this.options.direction,wt=Q.offsetWidth,Ut=Q.offsetHeight,fi=Mi(this.options.offset),Vi=this._getAnchor();ut==="top"?(C=wt/2,z=Ut):ut==="bottom"?(C=wt/2,z=0):ut==="center"?(C=wt/2,z=Ut/2):ut==="right"?(C=0,z=Ut/2):ut==="left"?(C=wt,z=Ut/2):Ve.x<fe.x?(ut="right",C=0,z=Ut/2):(ut="left",C=wt+(fi.x+Vi.x)*2,z=Ut/2),m=m.subtract(Mi(C,z,!0)).add(fi).add(Vi),Jr(Q,"leaflet-tooltip-right"),Jr(Q,"leaflet-tooltip-left"),Jr(Q,"leaflet-tooltip-top"),Jr(Q,"leaflet-tooltip-bottom"),Ri(Q,"leaflet-tooltip-"+ut),Zr(Q,m)},_updatePosition:function(){var m=this._map.latLngToLayerPoint(this._latlng);this._setPosition(m)},setOpacity:function(m){this.options.opacity=m,this._container&&Pn(this._container,m)},_animateZoom:function(m){var C=this._map._latLngToNewLayerPoint(this._latlng,m.zoom,m.center);this._setPosition(C)},_getAnchor:function(){return Mi(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ed=function(m,C){return new Vl(m,C)};zr.include({openTooltip:function(m,C,z){return this._initOverlay(Vl,m,C,z).openOn(this),this},closeTooltip:function(m){return m.close(),this}}),Ro.include({bindTooltip:function(m,C){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Vl,this._tooltip,m,C),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(m){if(!(!m&&this._tooltipHandlersAdded)){var C=m?"off":"on",z={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?z.add=this._openTooltip:(z.mouseover=this._openTooltip,z.mouseout=this.closeTooltip,z.click=this._openTooltip,this._map?this._addFocusListeners():z.add=this._addFocusListeners),this._tooltip.options.sticky&&(z.mousemove=this._moveTooltip),this[C](z),this._tooltipHandlersAdded=!m}},openTooltip:function(m){return this._tooltip&&(this instanceof Jn||(this._tooltip._source=this),this._tooltip._prepareOpen(m)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(m){return this._tooltip&&this._tooltip.setContent(m),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(m){var C=typeof m.getElement=="function"&&m.getElement();C&&(pr(C,"focus",function(){this._tooltip._source=m,this.openTooltip()},this),pr(C,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(m){var C=typeof m.getElement=="function"&&m.getElement();C&&C.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(m){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var C=this;this._map.once("moveend",function(){C._openOnceFlag=!1,C._openTooltip(m)});return}this._tooltip._source=m.layer||m.target,this.openTooltip(this._tooltip.options.sticky?m.latlng:void 0)}},_moveTooltip:function(m){var C=m.latlng,z,U;this._tooltip.options.sticky&&m.originalEvent&&(z=this._map.mouseEventToContainerPoint(m.originalEvent),U=this._map.containerPointToLayerPoint(z),C=this._map.layerPointToLatLng(U)),this._tooltip.setLatLng(C)}});var Zo=$r.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(m){var C=m&&m.tagName==="DIV"?m:document.createElement("div"),z=this.options;if(z.html instanceof Element?(Br(C),C.appendChild(z.html)):C.innerHTML=z.html!==!1?z.html:"",z.bgPos){var U=Mi(z.bgPos);C.style.backgroundPosition=-U.x+"px "+-U.y+"px"}return this._setIconStyles(C,"icon"),C},createShadow:function(){return null}});function il(m){return new Zo(m)}$r.Default=Rt;var ma=Ro.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ki.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(m){Se(this,m)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(m){m._addZoomLimit(this)},onRemove:function(m){this._removeAllTiles(),Ii(this._container),m._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(tr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(m){return this.options.opacity=m,this._updateOpacity(),this},setZIndex:function(m){return this.options.zIndex=m,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var m=this._clampZoom(this._map.getZoom());m!==this._tileZoom&&(this._tileZoom=m,this._updateLevels()),this._update()}return this},getEvents:function(){var m={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=j(this._onMoveEnd,this.options.updateInterval,this)),m.move=this._onMove),this._zoomAnimated&&(m.zoomanim=this._animateZoom),m},createTile:function(){return document.createElement("div")},getTileSize:function(){var m=this.options.tileSize;return m instanceof oi?m:new oi(m,m)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(m){for(var C=this.getPane().children,z=-m(-1/0,1/0),U=0,Q=C.length,fe;U<Q;U++)fe=C[U].style.zIndex,C[U]!==this._container&&fe&&(z=m(z,+fe));isFinite(z)&&(this.options.zIndex=z+m(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ki.ielt9){Pn(this._container,this.options.opacity);var m=+new Date,C=!1,z=!1;for(var U in this._tiles){var Q=this._tiles[U];if(!(!Q.current||!Q.loaded)){var fe=Math.min(1,(m-Q.loaded)/200);Pn(Q.el,fe),fe<1?C=!0:(Q.active?z=!0:this._onOpaqueTile(Q),Q.active=!0)}}z&&!this._noPrune&&this._pruneTiles(),C&&(Hi(this._fadeFrame),this._fadeFrame=li(this._updateOpacity,this))}},_onOpaqueTile:re,_initContainer:function(){this._container||(this._container=Kt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var m=this._tileZoom,C=this.options.maxZoom;if(m!==void 0){for(var z in this._levels)z=Number(z),this._levels[z].el.children.length||z===m?(this._levels[z].el.style.zIndex=C-Math.abs(m-z),this._onUpdateLevel(z)):(Ii(this._levels[z].el),this._removeTilesAtZoom(z),this._onRemoveLevel(z),delete this._levels[z]);var U=this._levels[m],Q=this._map;return U||(U=this._levels[m]={},U.el=Kt("div","leaflet-tile-container leaflet-zoom-animated",this._container),U.el.style.zIndex=C,U.origin=Q.project(Q.unproject(Q.getPixelOrigin()),m).round(),U.zoom=m,this._setZoomTransform(U,Q.getCenter(),Q.getZoom()),re(U.el.offsetWidth),this._onCreateLevel(U)),this._level=U,U}},_onUpdateLevel:re,_onRemoveLevel:re,_onCreateLevel:re,_pruneTiles:function(){if(this._map){var m,C,z=this._map.getZoom();if(z>this.options.maxZoom||z<this.options.minZoom){this._removeAllTiles();return}for(m in this._tiles)C=this._tiles[m],C.retain=C.current;for(m in this._tiles)if(C=this._tiles[m],C.current&&!C.active){var U=C.coords;this._retainParent(U.x,U.y,U.z,U.z-5)||this._retainChildren(U.x,U.y,U.z,U.z+2)}for(m in this._tiles)this._tiles[m].retain||this._removeTile(m)}},_removeTilesAtZoom:function(m){for(var C in this._tiles)this._tiles[C].coords.z===m&&this._removeTile(C)},_removeAllTiles:function(){for(var m in this._tiles)this._removeTile(m)},_invalidateAll:function(){for(var m in this._levels)Ii(this._levels[m].el),this._onRemoveLevel(Number(m)),delete this._levels[m];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(m,C,z,U){var Q=Math.floor(m/2),fe=Math.floor(C/2),Ve=z-1,ut=new oi(+Q,+fe);ut.z=+Ve;var wt=this._tileCoordsToKey(ut),Ut=this._tiles[wt];return Ut&&Ut.active?(Ut.retain=!0,!0):(Ut&&Ut.loaded&&(Ut.retain=!0),Ve>U?this._retainParent(Q,fe,Ve,U):!1)},_retainChildren:function(m,C,z,U){for(var Q=2*m;Q<2*m+2;Q++)for(var fe=2*C;fe<2*C+2;fe++){var Ve=new oi(Q,fe);Ve.z=z+1;var ut=this._tileCoordsToKey(Ve),wt=this._tiles[ut];if(wt&&wt.active){wt.retain=!0;continue}else wt&&wt.loaded&&(wt.retain=!0);z+1<U&&this._retainChildren(Q,fe,z+1,U)}},_resetView:function(m){var C=m&&(m.pinch||m.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),C,C)},_animateZoom:function(m){this._setView(m.center,m.zoom,!0,m.noUpdate)},_clampZoom:function(m){var C=this.options;return C.minNativeZoom!==void 0&&m<C.minNativeZoom?C.minNativeZoom:C.maxNativeZoom!==void 0&&C.maxNativeZoom<m?C.maxNativeZoom:m},_setView:function(m,C,z,U){var Q=Math.round(C);this.options.maxZoom!==void 0&&Q>this.options.maxZoom||this.options.minZoom!==void 0&&Q<this.options.minZoom?Q=void 0:Q=this._clampZoom(Q);var fe=this.options.updateWhenZooming&&Q!==this._tileZoom;(!U||fe)&&(this._tileZoom=Q,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),Q!==void 0&&this._update(m),z||this._pruneTiles(),this._noPrune=!!z),this._setZoomTransforms(m,C)},_setZoomTransforms:function(m,C){for(var z in this._levels)this._setZoomTransform(this._levels[z],m,C)},_setZoomTransform:function(m,C,z){var U=this._map.getZoomScale(z,m.zoom),Q=m.origin.multiplyBy(U).subtract(this._map._getNewPixelOrigin(C,z)).round();ki.any3d?Un(m.el,Q,U):Zr(m.el,Q)},_resetGrid:function(){var m=this._map,C=m.options.crs,z=this._tileSize=this.getTileSize(),U=this._tileZoom,Q=this._map.getPixelWorldBounds(this._tileZoom);Q&&(this._globalTileRange=this._pxBoundsToTileRange(Q)),this._wrapX=C.wrapLng&&!this.options.noWrap&&[Math.floor(m.project([0,C.wrapLng[0]],U).x/z.x),Math.ceil(m.project([0,C.wrapLng[1]],U).x/z.y)],this._wrapY=C.wrapLat&&!this.options.noWrap&&[Math.floor(m.project([C.wrapLat[0],0],U).y/z.x),Math.ceil(m.project([C.wrapLat[1],0],U).y/z.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(m){var C=this._map,z=C._animatingZoom?Math.max(C._animateToZoom,C.getZoom()):C.getZoom(),U=C.getZoomScale(z,this._tileZoom),Q=C.project(m,this._tileZoom).floor(),fe=C.getSize().divideBy(U*2);return new Dr(Q.subtract(fe),Q.add(fe))},_update:function(m){var C=this._map;if(C){var z=this._clampZoom(C.getZoom());if(m===void 0&&(m=C.getCenter()),this._tileZoom!==void 0){var U=this._getTiledPixelBounds(m),Q=this._pxBoundsToTileRange(U),fe=Q.getCenter(),Ve=[],ut=this.options.keepBuffer,wt=new Dr(Q.getBottomLeft().subtract([ut,-ut]),Q.getTopRight().add([ut,-ut]));if(!(isFinite(Q.min.x)&&isFinite(Q.min.y)&&isFinite(Q.max.x)&&isFinite(Q.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ut in this._tiles){var fi=this._tiles[Ut].coords;(fi.z!==this._tileZoom||!wt.contains(new oi(fi.x,fi.y)))&&(this._tiles[Ut].current=!1)}if(Math.abs(z-this._tileZoom)>1){this._setView(m,z);return}for(var Vi=Q.min.y;Vi<=Q.max.y;Vi++)for(var vr=Q.min.x;vr<=Q.max.x;vr++){var lo=new oi(vr,Vi);if(lo.z=this._tileZoom,!!this._isValidTile(lo)){var In=this._tiles[this._tileCoordsToKey(lo)];In?In.current=!0:Ve.push(lo)}}if(Ve.sort(function(eo,Cs){return eo.distanceTo(fe)-Cs.distanceTo(fe)}),Ve.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var co=document.createDocumentFragment();for(vr=0;vr<Ve.length;vr++)this._addTile(Ve[vr],co);this._level.el.appendChild(co)}}}},_isValidTile:function(m){var C=this._map.options.crs;if(!C.infinite){var z=this._globalTileRange;if(!C.wrapLng&&(m.x<z.min.x||m.x>z.max.x)||!C.wrapLat&&(m.y<z.min.y||m.y>z.max.y))return!1}if(!this.options.bounds)return!0;var U=this._tileCoordsToBounds(m);return nn(this.options.bounds).overlaps(U)},_keyToBounds:function(m){return this._tileCoordsToBounds(this._keyToTileCoords(m))},_tileCoordsToNwSe:function(m){var C=this._map,z=this.getTileSize(),U=m.scaleBy(z),Q=U.add(z),fe=C.unproject(U,m.z),Ve=C.unproject(Q,m.z);return[fe,Ve]},_tileCoordsToBounds:function(m){var C=this._tileCoordsToNwSe(m),z=new er(C[0],C[1]);return this.options.noWrap||(z=this._map.wrapLatLngBounds(z)),z},_tileCoordsToKey:function(m){return m.x+":"+m.y+":"+m.z},_keyToTileCoords:function(m){var C=m.split(":"),z=new oi(+C[0],+C[1]);return z.z=+C[2],z},_removeTile:function(m){var C=this._tiles[m];C&&(Ii(C.el),delete this._tiles[m],this.fire("tileunload",{tile:C.el,coords:this._keyToTileCoords(m)}))},_initTile:function(m){Ri(m,"leaflet-tile");var C=this.getTileSize();m.style.width=C.x+"px",m.style.height=C.y+"px",m.onselectstart=re,m.onmousemove=re,ki.ielt9&&this.options.opacity<1&&Pn(m,this.options.opacity)},_addTile:function(m,C){var z=this._getTilePos(m),U=this._tileCoordsToKey(m),Q=this.createTile(this._wrapCoords(m),T(this._tileReady,this,m));this._initTile(Q),this.createTile.length<2&&li(T(this._tileReady,this,m,null,Q)),Zr(Q,z),this._tiles[U]={el:Q,coords:m,current:!0},C.appendChild(Q),this.fire("tileloadstart",{tile:Q,coords:m})},_tileReady:function(m,C,z){C&&this.fire("tileerror",{error:C,tile:z,coords:m});var U=this._tileCoordsToKey(m);z=this._tiles[U],z&&(z.loaded=+new Date,this._map._fadeAnimated?(Pn(z.el,0),Hi(this._fadeFrame),this._fadeFrame=li(this._updateOpacity,this)):(z.active=!0,this._pruneTiles()),C||(Ri(z.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:z.el,coords:m})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ki.ielt9||!this._map._fadeAnimated?li(this._pruneTiles,this):setTimeout(T(this._pruneTiles,this),250)))},_getTilePos:function(m){return m.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(m){var C=new oi(this._wrapX?Y(m.x,this._wrapX):m.x,this._wrapY?Y(m.y,this._wrapY):m.y);return C.z=m.z,C},_pxBoundsToTileRange:function(m){var C=this.getTileSize();return new Dr(m.min.unscaleBy(C).floor(),m.max.unscaleBy(C).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var m in this._tiles)if(!this._tiles[m].loaded)return!1;return!0}});function td(m){return new ma(m)}var Na=ma.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(m,C){this._url=m,C=Se(this,C),C.detectRetina&&ki.retina&&C.maxZoom>0?(C.tileSize=Math.floor(C.tileSize/2),C.zoomReverse?(C.zoomOffset--,C.minZoom=Math.min(C.maxZoom,C.minZoom+1)):(C.zoomOffset++,C.maxZoom=Math.max(C.minZoom,C.maxZoom-1)),C.minZoom=Math.max(0,C.minZoom)):C.zoomReverse?C.minZoom=Math.min(C.maxZoom,C.minZoom):C.maxZoom=Math.max(C.minZoom,C.maxZoom),typeof C.subdomains=="string"&&(C.subdomains=C.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(m,C){return this._url===m&&C===void 0&&(C=!0),this._url=m,C||this.redraw(),this},createTile:function(m,C){var z=document.createElement("img");return pr(z,"load",T(this._tileOnLoad,this,C,z)),pr(z,"error",T(this._tileOnError,this,C,z)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(z.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(z.referrerPolicy=this.options.referrerPolicy),z.alt="",z.src=this.getTileUrl(m),z},getTileUrl:function(m){var C={r:ki.retina?"@2x":"",s:this._getSubdomain(m),x:m.x,y:m.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var z=this._globalTileRange.max.y-m.y;this.options.tms&&(C.y=z),C["-y"]=z}return yt(this._url,v(C,this.options))},_tileOnLoad:function(m,C){ki.ielt9?setTimeout(T(m,this,null,C),0):m(null,C)},_tileOnError:function(m,C,z){var U=this.options.errorTileUrl;U&&C.getAttribute("src")!==U&&(C.src=U),m(z,C)},_onTileRemove:function(m){m.tile.onload=null},_getZoomForUrl:function(){var m=this._tileZoom,C=this.options.maxZoom,z=this.options.zoomReverse,U=this.options.zoomOffset;return z&&(m=C-m),m+U},_getSubdomain:function(m){var C=Math.abs(m.x+m.y)%this.options.subdomains.length;return this.options.subdomains[C]},_abortLoading:function(){var m,C;for(m in this._tiles)if(this._tiles[m].coords.z!==this._tileZoom&&(C=this._tiles[m].el,C.onload=re,C.onerror=re,!C.complete)){C.src=ai;var z=this._tiles[m].coords;Ii(C),delete this._tiles[m],this.fire("tileabort",{tile:C,coords:z})}},_removeTile:function(m){var C=this._tiles[m];if(C)return C.el.setAttribute("src",ai),ma.prototype._removeTile.call(this,m)},_tileReady:function(m,C,z){if(!(!this._map||z&&z.getAttribute("src")===ai))return ma.prototype._tileReady.call(this,m,C,z)}});function rl(m,C){return new Na(m,C)}var nl=Na.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(m,C){this._url=m;var z=v({},this.defaultWmsParams);for(var U in C)U in this.options||(z[U]=C[U]);C=Se(this,C);var Q=C.detectRetina&&ki.retina?2:1,fe=this.getTileSize();z.width=fe.x*Q,z.height=fe.y*Q,this.wmsParams=z},onAdd:function(m){this._crs=this.options.crs||m.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var C=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[C]=this._crs.code,Na.prototype.onAdd.call(this,m)},getTileUrl:function(m){var C=this._tileCoordsToNwSe(m),z=this._crs,U=gn(z.project(C[0]),z.project(C[1])),Q=U.min,fe=U.max,Ve=(this._wmsVersion>=1.3&&this._crs===Hs?[Q.y,Q.x,fe.y,fe.x]:[Q.x,Q.y,fe.x,fe.y]).join(","),ut=Na.prototype.getTileUrl.call(this,m);return ut+Re(this.wmsParams,ut,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ve},setParams:function(m,C){return v(this.wmsParams,m),C||this.redraw(),this}});function id(m,C){return new nl(m,C)}Na.WMS=nl,rl.wms=id;var as=Ro.extend({options:{padding:.1},initialize:function(m){Se(this,m),R(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ri(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var m={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(m.zoomanim=this._onAnimZoom),m},_onAnimZoom:function(m){this._updateTransform(m.center,m.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(m,C){var z=this._map.getZoomScale(C,this._zoom),U=this._map.getSize().multiplyBy(.5+this.options.padding),Q=this._map.project(this._center,C),fe=U.multiplyBy(-z).add(Q).subtract(this._map._getNewPixelOrigin(m,C));ki.any3d?Un(this._container,fe,z):Zr(this._container,fe)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var m in this._layers)this._layers[m]._reset()},_onZoomEnd:function(){for(var m in this._layers)this._layers[m]._project()},_updatePaths:function(){for(var m in this._layers)this._layers[m]._update()},_update:function(){var m=this.options.padding,C=this._map.getSize(),z=this._map.containerPointToLayerPoint(C.multiplyBy(-m)).round();this._bounds=new Dr(z,z.add(C.multiplyBy(1+m*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Bo=as.extend({options:{tolerance:0},getEvents:function(){var m=as.prototype.getEvents.call(this);return m.viewprereset=this._onViewPreReset,m},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){as.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var m=this._container=document.createElement("canvas");pr(m,"mousemove",this._onMouseMove,this),pr(m,"click dblclick mousedown mouseup contextmenu",this._onClick,this),pr(m,"mouseout",this._handleMouseOut,this),m._leaflet_disable_events=!0,this._ctx=m.getContext("2d")},_destroyContainer:function(){Hi(this._redrawRequest),delete this._ctx,Ii(this._container),Lr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var m;this._redrawBounds=null;for(var C in this._layers)m=this._layers[C],m._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){as.prototype._update.call(this);var m=this._bounds,C=this._container,z=m.getSize(),U=ki.retina?2:1;Zr(C,m.min),C.width=U*z.x,C.height=U*z.y,C.style.width=z.x+"px",C.style.height=z.y+"px",ki.retina&&this._ctx.scale(2,2),this._ctx.translate(-m.min.x,-m.min.y),this.fire("update")}},_reset:function(){as.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(m){this._updateDashArray(m),this._layers[R(m)]=m;var C=m._order={layer:m,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=C),this._drawLast=C,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(m){this._requestRedraw(m)},_removePath:function(m){var C=m._order,z=C.next,U=C.prev;z?z.prev=U:this._drawLast=U,U?U.next=z:this._drawFirst=z,delete m._order,delete this._layers[R(m)],this._requestRedraw(m)},_updatePath:function(m){this._extendRedrawBounds(m),m._project(),m._update(),this._requestRedraw(m)},_updateStyle:function(m){this._updateDashArray(m),this._requestRedraw(m)},_updateDashArray:function(m){if(typeof m.options.dashArray=="string"){var C=m.options.dashArray.split(/[, ]+/),z=[],U,Q;for(Q=0;Q<C.length;Q++){if(U=Number(C[Q]),isNaN(U))return;z.push(U)}m.options._dashArray=z}else m.options._dashArray=m.options.dashArray},_requestRedraw:function(m){this._map&&(this._extendRedrawBounds(m),this._redrawRequest=this._redrawRequest||li(this._redraw,this))},_extendRedrawBounds:function(m){if(m._pxBounds){var C=(m.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Dr,this._redrawBounds.extend(m._pxBounds.min.subtract([C,C])),this._redrawBounds.extend(m._pxBounds.max.add([C,C]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var m=this._redrawBounds;if(m){var C=m.getSize();this._ctx.clearRect(m.min.x,m.min.y,C.x,C.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var m,C=this._redrawBounds;if(this._ctx.save(),C){var z=C.getSize();this._ctx.beginPath(),this._ctx.rect(C.min.x,C.min.y,z.x,z.y),this._ctx.clip()}this._drawing=!0;for(var U=this._drawFirst;U;U=U.next)m=U.layer,(!C||m._pxBounds&&m._pxBounds.intersects(C))&&m._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(m,C){if(this._drawing){var z,U,Q,fe,Ve=m._parts,ut=Ve.length,wt=this._ctx;if(ut){for(wt.beginPath(),z=0;z<ut;z++){for(U=0,Q=Ve[z].length;U<Q;U++)fe=Ve[z][U],wt[U?"lineTo":"moveTo"](fe.x,fe.y);C&&wt.closePath()}this._fillStroke(wt,m)}}},_updateCircle:function(m){if(!(!this._drawing||m._empty())){var C=m._point,z=this._ctx,U=Math.max(Math.round(m._radius),1),Q=(Math.max(Math.round(m._radiusY),1)||U)/U;Q!==1&&(z.save(),z.scale(1,Q)),z.beginPath(),z.arc(C.x,C.y/Q,U,0,Math.PI*2,!1),Q!==1&&z.restore(),this._fillStroke(z,m)}},_fillStroke:function(m,C){var z=C.options;z.fill&&(m.globalAlpha=z.fillOpacity,m.fillStyle=z.fillColor||z.color,m.fill(z.fillRule||"evenodd")),z.stroke&&z.weight!==0&&(m.setLineDash&&m.setLineDash(C.options&&C.options._dashArray||[]),m.globalAlpha=z.opacity,m.lineWidth=z.weight,m.strokeStyle=z.color,m.lineCap=z.lineCap,m.lineJoin=z.lineJoin,m.stroke())},_onClick:function(m){for(var C=this._map.mouseEventToLayerPoint(m),z,U,Q=this._drawFirst;Q;Q=Q.next)z=Q.layer,z.options.interactive&&z._containsPoint(C)&&(!(m.type==="click"||m.type==="preclick")||!this._map._draggableMoved(z))&&(U=z);this._fireEvent(U?[U]:!1,m)},_onMouseMove:function(m){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var C=this._map.mouseEventToLayerPoint(m);this._handleMouseHover(m,C)}},_handleMouseOut:function(m){var C=this._hoveredLayer;C&&(Jr(this._container,"leaflet-interactive"),this._fireEvent([C],m,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(m,C){if(!this._mouseHoverThrottled){for(var z,U,Q=this._drawFirst;Q;Q=Q.next)z=Q.layer,z.options.interactive&&z._containsPoint(C)&&(U=z);U!==this._hoveredLayer&&(this._handleMouseOut(m),U&&(Ri(this._container,"leaflet-interactive"),this._fireEvent([U],m,"mouseover"),this._hoveredLayer=U)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,m),this._mouseHoverThrottled=!0,setTimeout(T(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(m,C,z){this._map._fireDOMEvent(C,z||C.type,m)},_bringToFront:function(m){var C=m._order;if(C){var z=C.next,U=C.prev;if(z)z.prev=U;else return;U?U.next=z:z&&(this._drawFirst=z),C.prev=this._drawLast,this._drawLast.next=C,C.next=null,this._drawLast=C,this._requestRedraw(m)}},_bringToBack:function(m){var C=m._order;if(C){var z=C.next,U=C.prev;if(U)U.next=z;else return;z?z.prev=U:U&&(this._drawLast=U),C.prev=null,C.next=this._drawFirst,this._drawFirst.prev=C,this._drawFirst=C,this._requestRedraw(m)}}});function bc(m){return ki.canvas?new Bo(m):null}var ht=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(m){return document.createElement("<lvml:"+m+' class="lvml">')}}catch{}return function(m){return document.createElement("<"+m+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),rd={_initContainer:function(){this._container=Kt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(as.prototype._update.call(this),this.fire("update"))},_initPath:function(m){var C=m._container=ht("shape");Ri(C,"leaflet-vml-shape "+(this.options.className||"")),C.coordsize="1 1",m._path=ht("path"),C.appendChild(m._path),this._updateStyle(m),this._layers[R(m)]=m},_addPath:function(m){var C=m._container;this._container.appendChild(C),m.options.interactive&&m.addInteractiveTarget(C)},_removePath:function(m){var C=m._container;Ii(C),m.removeInteractiveTarget(C),delete this._layers[R(m)]},_updateStyle:function(m){var C=m._stroke,z=m._fill,U=m.options,Q=m._container;Q.stroked=!!U.stroke,Q.filled=!!U.fill,U.stroke?(C||(C=m._stroke=ht("stroke")),Q.appendChild(C),C.weight=U.weight+"px",C.color=U.color,C.opacity=U.opacity,U.dashArray?C.dashStyle=qe(U.dashArray)?U.dashArray.join(" "):U.dashArray.replace(/( *, *)/g," "):C.dashStyle="",C.endcap=U.lineCap.replace("butt","flat"),C.joinstyle=U.lineJoin):C&&(Q.removeChild(C),m._stroke=null),U.fill?(z||(z=m._fill=ht("fill")),Q.appendChild(z),z.color=U.fillColor||U.color,z.opacity=U.fillOpacity):z&&(Q.removeChild(z),m._fill=null)},_updateCircle:function(m){var C=m._point.round(),z=Math.round(m._radius),U=Math.round(m._radiusY||z);this._setPath(m,m._empty()?"M0 0":"AL "+C.x+","+C.y+" "+z+","+U+" 0,"+65535*360)},_setPath:function(m,C){m._path.v=C},_bringToFront:function(m){tr(m._container)},_bringToBack:function(m){yr(m._container)}},ga=ki.vml?ht:zo,Xs=as.extend({_initContainer:function(){this._container=ga("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ga("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ii(this._container),Lr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){as.prototype._update.call(this);var m=this._bounds,C=m.getSize(),z=this._container;(!this._svgSize||!this._svgSize.equals(C))&&(this._svgSize=C,z.setAttribute("width",C.x),z.setAttribute("height",C.y)),Zr(z,m.min),z.setAttribute("viewBox",[m.min.x,m.min.y,C.x,C.y].join(" ")),this.fire("update")}},_initPath:function(m){var C=m._path=ga("path");m.options.className&&Ri(C,m.options.className),m.options.interactive&&Ri(C,"leaflet-interactive"),this._updateStyle(m),this._layers[R(m)]=m},_addPath:function(m){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(m._path),m.addInteractiveTarget(m._path)},_removePath:function(m){Ii(m._path),m.removeInteractiveTarget(m._path),delete this._layers[R(m)]},_updatePath:function(m){m._project(),m._update()},_updateStyle:function(m){var C=m._path,z=m.options;C&&(z.stroke?(C.setAttribute("stroke",z.color),C.setAttribute("stroke-opacity",z.opacity),C.setAttribute("stroke-width",z.weight),C.setAttribute("stroke-linecap",z.lineCap),C.setAttribute("stroke-linejoin",z.lineJoin),z.dashArray?C.setAttribute("stroke-dasharray",z.dashArray):C.removeAttribute("stroke-dasharray"),z.dashOffset?C.setAttribute("stroke-dashoffset",z.dashOffset):C.removeAttribute("stroke-dashoffset")):C.setAttribute("stroke","none"),z.fill?(C.setAttribute("fill",z.fillColor||z.color),C.setAttribute("fill-opacity",z.fillOpacity),C.setAttribute("fill-rule",z.fillRule||"evenodd")):C.setAttribute("fill","none"))},_updatePoly:function(m,C){this._setPath(m,Qo(m._parts,C))},_updateCircle:function(m){var C=m._point,z=Math.max(Math.round(m._radius),1),U=Math.max(Math.round(m._radiusY),1)||z,Q="a"+z+","+U+" 0 1,0 ",fe=m._empty()?"M0 0":"M"+(C.x-z)+","+C.y+Q+z*2+",0 "+Q+-z*2+",0 ";this._setPath(m,fe)},_setPath:function(m,C){m._path.setAttribute("d",C)},_bringToFront:function(m){tr(m._path)},_bringToBack:function(m){yr(m._path)}});ki.vml&&Xs.include(rd);function Ul(m){return ki.svg||ki.vml?new Xs(m):null}zr.include({getRenderer:function(m){var C=m.options.renderer||this._getPaneRenderer(m.options.pane)||this.options.renderer||this._renderer;return C||(C=this._renderer=this._createRenderer()),this.hasLayer(C)||this.addLayer(C),C},_getPaneRenderer:function(m){if(m==="overlayPane"||m===void 0)return!1;var C=this._paneRenderers[m];return C===void 0&&(C=this._createRenderer({pane:m}),this._paneRenderers[m]=C),C},_createRenderer:function(m){return this.options.preferCanvas&&bc(m)||Ul(m)}});var ql=En.extend({initialize:function(m,C){En.prototype.initialize.call(this,this._boundsToLatLngs(m),C)},setBounds:function(m){return this.setLatLngs(this._boundsToLatLngs(m))},_boundsToLatLngs:function(m){return m=nn(m),[m.getSouthWest(),m.getNorthWest(),m.getNorthEast(),m.getSouthEast()]}});function Ys(m,C){return new ql(m,C)}Xs.create=ga,Xs.pointsToPath=Qo,Po.geometryToLayer=fa,Po.coordsToLatLng=Rn,Po.coordsToLatLngs=eu,Po.latLngToCoords=Ju,Po.latLngsToCoords=Ra,Po.getFeature=Ho,Po.asFeature=xc,zr.mergeOptions({boxZoom:!0});var wc=ns.extend({initialize:function(m){this._map=m,this._container=m._container,this._pane=m._panes.overlayPane,this._resetStateTimeout=0,m.on("unload",this._destroy,this)},addHooks:function(){pr(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Lr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ii(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(m){if(!m.shiftKey||m.which!==1&&m.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),aa(),Go(),this._startPoint=this._map.mouseEventToContainerPoint(m),pr(document,{contextmenu:bs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(m){this._moved||(this._moved=!0,this._box=Kt("div","leaflet-zoom-box",this._container),Ri(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(m);var C=new Dr(this._point,this._startPoint),z=C.getSize();Zr(this._box,C.min),this._box.style.width=z.x+"px",this._box.style.height=z.y+"px"},_finish:function(){this._moved&&(Ii(this._box),Jr(this._container,"leaflet-crosshair")),la(),Kn(),Lr(document,{contextmenu:bs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(m){if(!(m.which!==1&&m.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(T(this._resetState,this),0);var C=new er(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(C).fire("boxzoomend",{boxZoomBounds:C})}},_onKeyDown:function(m){m.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});zr.addInitHook("addHandler","boxZoom",wc),zr.mergeOptions({doubleClickZoom:!0});var $o=ns.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(m){var C=this._map,z=C.getZoom(),U=C.options.zoomDelta,Q=m.originalEvent.shiftKey?z-U:z+U;C.options.doubleClickZoom==="center"?C.setZoom(Q):C.setZoomAround(m.containerPoint,Q)}});zr.addInitHook("addHandler","doubleClickZoom",$o),zr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Pi=ns.extend({addHooks:function(){if(!this._draggable){var m=this._map;this._draggable=new $t(m._mapPane,m._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),m.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),m.on("zoomend",this._onZoomEnd,this),m.whenReady(this._onZoomEnd,this))}Ri(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Jr(this._map._container,"leaflet-grab"),Jr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var m=this._map;if(m._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var C=nn(this._map.options.maxBounds);this._offsetLimit=gn(this._map.latLngToContainerPoint(C.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(C.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;m.fire("movestart").fire("dragstart"),m.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(m){if(this._map.options.inertia){var C=this._lastTime=+new Date,z=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(z),this._times.push(C),this._prunePositions(C)}this._map.fire("move",m).fire("drag",m)},_prunePositions:function(m){for(;this._positions.length>1&&m-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var m=this._map.getSize().divideBy(2),C=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=C.subtract(m).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(m,C){return m-(m-C)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var m=this._draggable._newPos.subtract(this._draggable._startPos),C=this._offsetLimit;m.x<C.min.x&&(m.x=this._viscousLimit(m.x,C.min.x)),m.y<C.min.y&&(m.y=this._viscousLimit(m.y,C.min.y)),m.x>C.max.x&&(m.x=this._viscousLimit(m.x,C.max.x)),m.y>C.max.y&&(m.y=this._viscousLimit(m.y,C.max.y)),this._draggable._newPos=this._draggable._startPos.add(m)}},_onPreDragWrap:function(){var m=this._worldWidth,C=Math.round(m/2),z=this._initialWorldOffset,U=this._draggable._newPos.x,Q=(U-C+z)%m+C-z,fe=(U+C+z)%m-C-z,Ve=Math.abs(Q+z)<Math.abs(fe+z)?Q:fe;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ve},_onDragEnd:function(m){var C=this._map,z=C.options,U=!z.inertia||m.noInertia||this._times.length<2;if(C.fire("dragend",m),U)C.fire("moveend");else{this._prunePositions(+new Date);var Q=this._lastPos.subtract(this._positions[0]),fe=(this._lastTime-this._times[0])/1e3,Ve=z.easeLinearity,ut=Q.multiplyBy(Ve/fe),wt=ut.distanceTo([0,0]),Ut=Math.min(z.inertiaMaxSpeed,wt),fi=ut.multiplyBy(Ut/wt),Vi=Ut/(z.inertiaDeceleration*Ve),vr=fi.multiplyBy(-Vi/2).round();!vr.x&&!vr.y?C.fire("moveend"):(vr=C._limitOffset(vr,C.options.maxBounds),li(function(){C.panBy(vr,{duration:Vi,easeLinearity:Ve,noMoveStart:!0,animate:!0})}))}}});zr.addInitHook("addHandler","dragging",Pi),zr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ol=ns.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(m){this._map=m,this._setPanDelta(m.options.keyboardPanDelta),this._setZoomDelta(m.options.zoomDelta)},addHooks:function(){var m=this._map._container;m.tabIndex<=0&&(m.tabIndex="0"),pr(m,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Lr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var m=document.body,C=document.documentElement,z=m.scrollTop||C.scrollTop,U=m.scrollLeft||C.scrollLeft;this._map._container.focus(),window.scrollTo(U,z)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(m){var C=this._panKeys={},z=this.keyCodes,U,Q;for(U=0,Q=z.left.length;U<Q;U++)C[z.left[U]]=[-1*m,0];for(U=0,Q=z.right.length;U<Q;U++)C[z.right[U]]=[m,0];for(U=0,Q=z.down.length;U<Q;U++)C[z.down[U]]=[0,m];for(U=0,Q=z.up.length;U<Q;U++)C[z.up[U]]=[0,-1*m]},_setZoomDelta:function(m){var C=this._zoomKeys={},z=this.keyCodes,U,Q;for(U=0,Q=z.zoomIn.length;U<Q;U++)C[z.zoomIn[U]]=m;for(U=0,Q=z.zoomOut.length;U<Q;U++)C[z.zoomOut[U]]=-m},_addHooks:function(){pr(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Lr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(m){if(!(m.altKey||m.ctrlKey||m.metaKey)){var C=m.keyCode,z=this._map,U;if(C in this._panKeys){if(!z._panAnim||!z._panAnim._inProgress)if(U=this._panKeys[C],m.shiftKey&&(U=Mi(U).multiplyBy(3)),z.options.maxBounds&&(U=z._limitOffset(Mi(U),z.options.maxBounds)),z.options.worldCopyJump){var Q=z.wrapLatLng(z.unproject(z.project(z.getCenter()).add(U)));z.panTo(Q)}else z.panBy(U)}else if(C in this._zoomKeys)z.setZoom(z.getZoom()+(m.shiftKey?3:1)*this._zoomKeys[C]);else if(C===27&&z._popup&&z._popup.options.closeOnEscapeKey)z.closePopup();else return;bs(m)}}});zr.addInitHook("addHandler","keyboard",ol),zr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var qd=ns.extend({addHooks:function(){pr(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Lr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(m){var C=Pl(m),z=this._map.options.wheelDebounceTime;this._delta+=C,this._lastMousePos=this._map.mouseEventToContainerPoint(m),this._startTime||(this._startTime=+new Date);var U=Math.max(z-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(T(this._performZoom,this),U),bs(m)},_performZoom:function(){var m=this._map,C=m.getZoom(),z=this._map.options.zoomSnap||0;m._stop();var U=this._delta/(this._map.options.wheelPxPerZoomLevel*4),Q=4*Math.log(2/(1+Math.exp(-Math.abs(U))))/Math.LN2,fe=z?Math.ceil(Q/z)*z:Q,Ve=m._limitZoom(C+(this._delta>0?fe:-fe))-C;this._delta=0,this._startTime=null,Ve&&(m.options.scrollWheelZoom==="center"?m.setZoom(C+Ve):m.setZoomAround(this._lastMousePos,C+Ve))}});zr.addInitHook("addHandler","scrollWheelZoom",qd);var zp=600;zr.mergeOptions({tapHold:ki.touchNative&&ki.safari&&ki.mobile,tapTolerance:15});var Sc=ns.extend({addHooks:function(){pr(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Lr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(m){if(clearTimeout(this._holdTimeout),m.touches.length===1){var C=m.touches[0];this._startPos=this._newPos=new oi(C.clientX,C.clientY),this._holdTimeout=setTimeout(T(function(){this._cancel(),this._isTapValid()&&(pr(document,"touchend",Zn),pr(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",C))},this),zp),pr(document,"touchend touchcancel contextmenu",this._cancel,this),pr(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function m(){Lr(document,"touchend",Zn),Lr(document,"touchend touchcancel",m)},_cancel:function(){clearTimeout(this._holdTimeout),Lr(document,"touchend touchcancel contextmenu",this._cancel,this),Lr(document,"touchmove",this._onMove,this)},_onMove:function(m){var C=m.touches[0];this._newPos=new oi(C.clientX,C.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(m,C){var z=new MouseEvent(m,{bubbles:!0,cancelable:!0,view:window,screenX:C.screenX,screenY:C.screenY,clientX:C.clientX,clientY:C.clientY});z._simulated=!0,C.target.dispatchEvent(z)}});zr.addInitHook("addHandler","tapHold",Sc),zr.mergeOptions({touchZoom:ki.touch,bounceAtZoomLimits:!0});var Wd=ns.extend({addHooks:function(){Ri(this._map._container,"leaflet-touch-zoom"),pr(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Jr(this._map._container,"leaflet-touch-zoom"),Lr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(m){var C=this._map;if(!(!m.touches||m.touches.length!==2||C._animatingZoom||this._zooming)){var z=C.mouseEventToContainerPoint(m.touches[0]),U=C.mouseEventToContainerPoint(m.touches[1]);this._centerPoint=C.getSize()._divideBy(2),this._startLatLng=C.containerPointToLatLng(this._centerPoint),C.options.touchZoom!=="center"&&(this._pinchStartLatLng=C.containerPointToLatLng(z.add(U)._divideBy(2))),this._startDist=z.distanceTo(U),this._startZoom=C.getZoom(),this._moved=!1,this._zooming=!0,C._stop(),pr(document,"touchmove",this._onTouchMove,this),pr(document,"touchend touchcancel",this._onTouchEnd,this),Zn(m)}},_onTouchMove:function(m){if(!(!m.touches||m.touches.length!==2||!this._zooming)){var C=this._map,z=C.mouseEventToContainerPoint(m.touches[0]),U=C.mouseEventToContainerPoint(m.touches[1]),Q=z.distanceTo(U)/this._startDist;if(this._zoom=C.getScaleZoom(Q,this._startZoom),!C.options.bounceAtZoomLimits&&(this._zoom<C.getMinZoom()&&Q<1||this._zoom>C.getMaxZoom()&&Q>1)&&(this._zoom=C._limitZoom(this._zoom)),C.options.touchZoom==="center"){if(this._center=this._startLatLng,Q===1)return}else{var fe=z._add(U)._divideBy(2)._subtract(this._centerPoint);if(Q===1&&fe.x===0&&fe.y===0)return;this._center=C.unproject(C.project(this._pinchStartLatLng,this._zoom).subtract(fe),this._zoom)}this._moved||(C._moveStart(!0,!1),this._moved=!0),Hi(this._animRequest);var Ve=T(C._move,C,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=li(Ve,this,!0),Zn(m)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Hi(this._animRequest),Lr(document,"touchmove",this._onTouchMove,this),Lr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});zr.addInitHook("addHandler","touchZoom",Wd),zr.BoxZoom=wc,zr.DoubleClickZoom=$o,zr.Drag=Pi,zr.Keyboard=ol,zr.ScrollWheelZoom=qd,zr.TapHold=Sc,zr.TouchZoom=Wd,d.Bounds=Dr,d.Browser=ki,d.CRS=Uo,d.Canvas=Bo,d.Circle=Nl,d.CircleMarker=Jt,d.Class=Di,d.Control=ko,d.DivIcon=Zo,d.DivOverlay=$s,d.DomEvent=Qa,d.DomUtil=za,d.Draggable=$t,d.Evented=Ai,d.FeatureGroup=Jn,d.GeoJSON=Po,d.GridLayer=ma,d.Handler=ns,d.Icon=$r,d.ImageOverlay=Da,d.LatLng=Kr,d.LatLngBounds=er,d.Layer=Ro,d.LayerGroup=Ss,d.LineUtil=gc,d.Map=zr,d.Marker=ni,d.Mixin=Fd,d.Path=Ts,d.Point=oi,d.PolyUtil=os,d.Polygon=En,d.Polyline=Qn,d.Popup=jl,d.PosAnimation=$u,d.Projection=yc,d.Rectangle=ql,d.Renderer=as,d.SVG=Xs,d.SVGOverlay=Ud,d.TileLayer=Na,d.Tooltip=Vl,d.Transformation=Mn,d.Util=hi,d.VideoOverlay=jd,d.bind=T,d.bounds=gn,d.canvas=bc,d.circle=Nd,d.circleMarker=vc,d.control=so,d.divIcon=il,d.extend=v,d.featureGroup=pa,d.geoJSON=Qu,d.geoJson=tu,d.gridLayer=td,d.icon=vi,d.imageOverlay=Ba,d.latLng=Pr,d.latLngBounds=nn,d.layerGroup=On,d.map=Lp,d.marker=Fl,d.point=Mi,d.polygon=ao,d.polyline=Qc,d.popup=iu,d.rectangle=Ys,d.setOptions=Se,d.stamp=R,d.svg=Ul,d.svgOverlay=Fa,d.tileLayer=rl,d.tooltip=ed,d.transformation=Vs,d.version=h,d.videoOverlay=Vd;var Xr=window.L;d.noConflict=function(){return window.L=Xr,this},window.L=d}))});var gO=ot((Gy,mO)=>{(function(d,h){typeof Gy=="object"&&typeof mO<"u"?h(Gy):typeof define=="function"&&define.amd?define(["exports"],h):(d=d||self,h((d.Leaflet=d.Leaflet||{},d.Leaflet.markercluster={})))})(Gy,function(d){"use strict";var h=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(y){L.Util.setOptions(this,y),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var T=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,T?this._withAnimation:this._noAnimation),this._markerCluster=T?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(y){if(y instanceof L.LayerGroup)return this.addLayers([y]);if(!y.getLatLng)return this._nonPointGroup.addLayer(y),this.fire("layeradd",{layer:y}),this;if(!this._map)return this._needsClustering.push(y),this.fire("layeradd",{layer:y}),this;if(this.hasLayer(y))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(y,this._maxZoom),this.fire("layeradd",{layer:y}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var T=y,n=this._zoom;if(y.__parent)for(;T.__parent._zoom>=n;)T=T.__parent;return this._currentShownBounds.contains(T.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(y,T):this._animationAddLayerNonAnimated(y,T)),this},removeLayer:function(y){return y instanceof L.LayerGroup?this.removeLayers([y]):y.getLatLng?this._map?y.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(y)),this._removeLayer(y,!0),this.fire("layerremove",{layer:y}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),y.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(y)&&(this._featureGroup.removeLayer(y),y.clusterShow&&y.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,y)&&this.hasLayer(y)&&this._needsRemoving.push({layer:y,latlng:y._latlng}),this.fire("layerremove",{layer:y}),this):(this._nonPointGroup.removeLayer(y),this.fire("layerremove",{layer:y}),this)},addLayers:function(y,T){if(!L.Util.isArray(y))return this.addLayer(y);var n=this._featureGroup,R=this._nonPointGroup,j=this.options.chunkedLoading,Y=this.options.chunkInterval,re=this.options.chunkProgress,me=y.length,be=0,oe=!0,Se;if(this._map){var Re=new Date().getTime(),tt=L.bind(function(){var qe=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();be<me;be++){if(j&&be%200===0){var St=new Date().getTime()-qe;if(St>Y)break}if(Se=y[be],Se instanceof L.LayerGroup){oe&&(y=y.slice(),oe=!1),this._extractNonGroupLayers(Se,y),me=y.length;continue}if(!Se.getLatLng){R.addLayer(Se),T||this.fire("layeradd",{layer:Se});continue}if(!this.hasLayer(Se)&&(this._addLayer(Se,this._maxZoom),T||this.fire("layeradd",{layer:Se}),Se.__parent&&Se.__parent.getChildCount()===2)){var ai=Se.__parent.getAllChildMarkers(),pi=ai[0]===Se?ai[1]:ai[0];n.removeLayer(pi)}}re&&re(be,me,new Date().getTime()-Re),be===me?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(tt,this.options.chunkDelay)},this);tt()}else for(var yt=this._needsClustering;be<me;be++){if(Se=y[be],Se instanceof L.LayerGroup){oe&&(y=y.slice(),oe=!1),this._extractNonGroupLayers(Se,y),me=y.length;continue}if(!Se.getLatLng){R.addLayer(Se);continue}this.hasLayer(Se)||yt.push(Se)}return this},removeLayers:function(y){var T,n,R=y.length,j=this._featureGroup,Y=this._nonPointGroup,re=!0;if(!this._map){for(T=0;T<R;T++){if(n=y[T],n instanceof L.LayerGroup){re&&(y=y.slice(),re=!1),this._extractNonGroupLayers(n,y),R=y.length;continue}this._arraySplice(this._needsClustering,n),Y.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n})}return this}if(this._unspiderfy){this._unspiderfy();var me=y.slice(),be=R;for(T=0;T<be;T++){if(n=me[T],n instanceof L.LayerGroup){this._extractNonGroupLayers(n,me),be=me.length;continue}this._unspiderfyLayer(n)}}for(T=0;T<R;T++){if(n=y[T],n instanceof L.LayerGroup){re&&(y=y.slice(),re=!1),this._extractNonGroupLayers(n,y),R=y.length;continue}if(!n.__parent){Y.removeLayer(n),this.fire("layerremove",{layer:n});continue}this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),j.hasLayer(n)&&(j.removeLayer(n),n.clusterShow&&n.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(y){y.off(this._childMarkerEventHandlers,this),delete y.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var y=new L.LatLngBounds;this._topClusterLevel&&y.extend(this._topClusterLevel._bounds);for(var T=this._needsClustering.length-1;T>=0;T--)y.extend(this._needsClustering[T].getLatLng());return y.extend(this._nonPointGroup.getBounds()),y},eachLayer:function(y,T){var n=this._needsClustering.slice(),R=this._needsRemoving,j,Y,re;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),Y=n.length-1;Y>=0;Y--){for(j=!0,re=R.length-1;re>=0;re--)if(R[re].layer===n[Y]){j=!1;break}j&&y.call(T,n[Y])}this._nonPointGroup.eachLayer(y,T)},getLayers:function(){var y=[];return this.eachLayer(function(T){y.push(T)}),y},getLayer:function(y){var T=null;return y=parseInt(y,10),this.eachLayer(function(n){L.stamp(n)===y&&(T=n)}),T},hasLayer:function(y){if(!y)return!1;var T,n=this._needsClustering;for(T=n.length-1;T>=0;T--)if(n[T]===y)return!0;for(n=this._needsRemoving,T=n.length-1;T>=0;T--)if(n[T].layer===y)return!1;return!!(y.__parent&&y.__parent._group===this)||this._nonPointGroup.hasLayer(y)},zoomToShowLayer:function(y,T){var n=this._map;typeof T!="function"&&(T=function(){});var R=function(){(n.hasLayer(y)||n.hasLayer(y.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",R,this),this.off("animationend",R,this),n.hasLayer(y)?T():y.__parent._icon&&(this.once("spiderfied",T,this),y.__parent.spiderfy()))};y._icon&&this._map.getBounds().contains(y.getLatLng())?T():y.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",R,this),this._map.panTo(y.getLatLng())):(this._map.on("moveend",R,this),this.on("animationend",R,this),y.__parent.zoomToBounds())},onAdd:function(y){this._map=y;var T,n,R;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(y),this._nonPointGroup.addTo(y),this._gridClusters||this._generateInitialClusters(),this._maxLat=y.options.crs.projection.MAX_LATITUDE,T=0,n=this._needsRemoving.length;T<n;T++)R=this._needsRemoving[T],R.newlatlng=R.layer._latlng,R.layer._latlng=R.latlng;for(T=0,n=this._needsRemoving.length;T<n;T++)R=this._needsRemoving[T],this._removeLayer(R.layer,!0),R.layer._latlng=R.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(y){y.off("zoomend",this._zoomEnd,this),y.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(y){for(var T=y;T&&!T._icon;)T=T.__parent;return T||null},_arraySplice:function(y,T){for(var n=y.length-1;n>=0;n--)if(y[n]===T)return y.splice(n,1),!0},_removeFromGridUnclustered:function(y,T){for(var n=this._map,R=this._gridUnclustered,j=Math.floor(this._map.getMinZoom());T>=j&&R[T].removeObject(y,n.project(y.getLatLng(),T));T--);},_childMarkerDragStart:function(y){y.target.__dragStart=y.target._latlng},_childMarkerMoved:function(y){if(!this._ignoreMove&&!y.target.__dragStart){var T=y.target._popup&&y.target._popup.isOpen();this._moveChild(y.target,y.oldLatLng,y.latlng),T&&y.target.openPopup()}},_moveChild:function(y,T,n){y._latlng=T,this.removeLayer(y),y._latlng=n,this.addLayer(y)},_childMarkerDragEnd:function(y){var T=y.target.__dragStart;delete y.target.__dragStart,T&&this._moveChild(y.target,T,y.target._latlng)},_removeLayer:function(y,T,n){var R=this._gridClusters,j=this._gridUnclustered,Y=this._featureGroup,re=this._map,me=Math.floor(this._map.getMinZoom());T&&this._removeFromGridUnclustered(y,this._maxZoom);var be=y.__parent,oe=be._markers,Se;for(this._arraySplice(oe,y);be&&(be._childCount--,be._boundsNeedUpdate=!0,!(be._zoom<me));)T&&be._childCount<=1?(Se=be._markers[0]===y?be._markers[1]:be._markers[0],R[be._zoom].removeObject(be,re.project(be._cLatLng,be._zoom)),j[be._zoom].addObject(Se,re.project(Se.getLatLng(),be._zoom)),this._arraySplice(be.__parent._childClusters,be),be.__parent._markers.push(Se),Se.__parent=be.__parent,be._icon&&(Y.removeLayer(be),n||Y.addLayer(Se))):be._iconNeedsUpdate=!0,be=be.__parent;delete y.__parent},_isOrIsParent:function(y,T){for(;T;){if(y===T)return!0;T=T.parentNode}return!1},fire:function(y,T,n){if(T&&T.layer instanceof L.MarkerCluster){if(T.originalEvent&&this._isOrIsParent(T.layer._icon,T.originalEvent.relatedTarget))return;y="cluster"+y}L.FeatureGroup.prototype.fire.call(this,y,T,n)},listens:function(y,T){return L.FeatureGroup.prototype.listens.call(this,y,T)||L.FeatureGroup.prototype.listens.call(this,"cluster"+y,T)},_defaultIconCreateFunction:function(y){var T=y.getChildCount(),n=" marker-cluster-";return T<10?n+="small":T<100?n+="medium":n+="large",new L.DivIcon({html:"<div><span>"+T+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var y=this._map,T=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,R=this.options.zoomToBoundsOnClick,j=this.options.spiderfyOnEveryZoom;(T||R||j)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),y.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(y){var T=y.layer,n=T;if(!(y.type==="clusterkeypress"&&y.originalEvent&&y.originalEvent.keyCode!==13)){for(;n._childClusters.length===1;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===T._childCount&&this.options.spiderfyOnMaxZoom?T.spiderfy():this.options.zoomToBoundsOnClick&&T.zoomToBounds(),this.options.spiderfyOnEveryZoom&&T.spiderfy(),y.originalEvent&&y.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(y){var T=this._map;this._inZoomAnimation||(this._shownPolygon&&T.removeLayer(this._shownPolygon),y.layer.getChildCount()>2&&y.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(y.layer.getConvexHull(),this.options.polygonOptions),T.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var y=this.options.spiderfyOnMaxZoom,T=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,R=this.options.spiderfyOnEveryZoom,j=this._map;(y||n||R)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),T&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),j.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var y=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,y),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),y),this._currentShownBounds=y}},_generateInitialClusters:function(){var y=Math.ceil(this._map.getMaxZoom()),T=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,R=n;typeof n!="function"&&(R=function(){return n}),this.options.disableClusteringAtZoom!==null&&(y=this.options.disableClusteringAtZoom-1),this._maxZoom=y,this._gridClusters={},this._gridUnclustered={};for(var j=y;j>=T;j--)this._gridClusters[j]=new L.DistanceGrid(R(j)),this._gridUnclustered[j]=new L.DistanceGrid(R(j));this._topClusterLevel=new this._markerCluster(this,T-1)},_addLayer:function(y,T){var n=this._gridClusters,R=this._gridUnclustered,j=Math.floor(this._map.getMinZoom()),Y,re;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(y),y.on(this._childMarkerEventHandlers,this);T>=j;T--){Y=this._map.project(y.getLatLng(),T);var me=n[T].getNearObject(Y);if(me){me._addChild(y),y.__parent=me;return}if(me=R[T].getNearObject(Y),me){var be=me.__parent;be&&this._removeLayer(me,!1);var oe=new this._markerCluster(this,T,me,y);n[T].addObject(oe,this._map.project(oe._cLatLng,T)),me.__parent=oe,y.__parent=oe;var Se=oe;for(re=T-1;re>be._zoom;re--)Se=new this._markerCluster(this,re,Se),n[re].addObject(Se,this._map.project(me.getLatLng(),re));be._addChild(Se),this._removeFromGridUnclustered(me,T);return}R[T].addObject(y,Y)}this._topClusterLevel._addChild(y),y.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(y){y instanceof L.MarkerCluster&&y._iconNeedsUpdate&&y._updateIcon()})},_enqueue:function(y){this._queue.push(y),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var y=0;y<this._queue.length;y++)this._queue[y].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var y=Math.round(this._map._zoom);this._processQueue(),this._zoom<y&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,y)):this._zoom>y?(this._animationStart(),this._animationZoomOut(this._zoom,y)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(y){var T=this._maxLat;return T!==void 0&&(y.getNorth()>=T&&(y._northEast.lat=1/0),y.getSouth()<=-T&&(y._southWest.lat=-1/0)),y},_animationAddLayerNonAnimated:function(y,T){if(T===y)this._featureGroup.addLayer(y);else if(T._childCount===2){T._addToMap();var n=T.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else T._updateIcon()},_extractNonGroupLayers:function(y,T){var n=y.getLayers(),R=0,j;for(T=T||[];R<n.length;R++){if(j=n[R],j instanceof L.LayerGroup){this._extractNonGroupLayers(j,T);continue}T.push(j)}return T},_overrideMarkerIcon:function(y){var T=y.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[y]}});return T}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(y,T){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),y),this._topClusterLevel._recursivelyAddChildrenToMap(null,T,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(y,T){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),y),this._topClusterLevel._recursivelyAddChildrenToMap(null,T,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(y,T){this._animationAddLayerNonAnimated(y,T)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(y,T){var n=this._getExpandedVisibleBounds(),R=this._featureGroup,j=Math.floor(this._map.getMinZoom()),Y;this._ignoreMove=!0,this._topClusterLevel._recursively(n,y,j,function(re){var me=re._latlng,be=re._markers,oe;for(n.contains(me)||(me=null),re._isSingleParent()&&y+1===T?(R.removeLayer(re),re._recursivelyAddChildrenToMap(null,T,n)):(re.clusterHide(),re._recursivelyAddChildrenToMap(me,T,n)),Y=be.length-1;Y>=0;Y--)oe=be[Y],n.contains(oe._latlng)||R.removeLayer(oe)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,T),R.eachLayer(function(re){!(re instanceof L.MarkerCluster)&&re._icon&&re.clusterShow()}),this._topClusterLevel._recursively(n,y,T,function(re){re._recursivelyRestoreChildPositions(T)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(n,y,j,function(re){R.removeLayer(re),re.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(y,T){this._animationZoomOutSingle(this._topClusterLevel,y-1,T),this._topClusterLevel._recursivelyAddChildrenToMap(null,T,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),y,this._getExpandedVisibleBounds())},_animationAddLayer:function(y,T){var n=this,R=this._featureGroup;R.addLayer(y),T!==y&&(T._childCount>2?(T._updateIcon(),this._forceLayout(),this._animationStart(),y._setPos(this._map.latLngToLayerPoint(T.getLatLng())),y.clusterHide(),this._enqueue(function(){R.removeLayer(y),y.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(T,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(y,T,n){var R=this._getExpandedVisibleBounds(),j=Math.floor(this._map.getMinZoom());y._recursivelyAnimateChildrenInAndAddSelfToMap(R,j,T+1,n);var Y=this;this._forceLayout(),y._recursivelyBecomeVisible(R,n),this._enqueue(function(){if(y._childCount===1){var re=y._markers[0];this._ignoreMove=!0,re.setLatLng(re.getLatLng()),this._ignoreMove=!1,re.clusterShow&&re.clusterShow()}else y._recursively(R,n,j,function(me){me._recursivelyRemoveChildrenFromMap(R,j,T+1)});Y._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(y){return new L.MarkerClusterGroup(y)};var v=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(y,T,n,R){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:y.options.clusterPane}),this._group=y,this._zoom=T,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),R&&this._addChild(R)},getAllChildMarkers:function(y,T){y=y||[];for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n].getAllChildMarkers(y,T);for(var R=this._markers.length-1;R>=0;R--)T&&this._markers[R].__dragStart||y.push(this._markers[R]);return y},getChildCount:function(){return this._childCount},zoomToBounds:function(y){for(var T=this._childClusters.slice(),n=this._group._map,R=n.getBoundsZoom(this._bounds),j=this._zoom+1,Y=n.getZoom(),re;T.length>0&&R>j;){j++;var me=[];for(re=0;re<T.length;re++)me=me.concat(T[re]._childClusters);T=me}R>j?this._group._map.setView(this._latlng,j):R<=Y?this._group._map.setView(this._latlng,Y+1):this._group._map.fitBounds(this._bounds,y)},getBounds:function(){var y=new L.LatLngBounds;return y.extend(this._bounds),y},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(y,T){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(y),y instanceof L.MarkerCluster?(T||(this._childClusters.push(y),y.__parent=this),this._childCount+=y._childCount):(T||this._markers.push(y),this._childCount++),this.__parent&&this.__parent._addChild(y,!0)},_setClusterCenter:function(y){this._cLatLng||(this._cLatLng=y._cLatLng||y._latlng)},_resetBounds:function(){var y=this._bounds;y._southWest&&(y._southWest.lat=1/0,y._southWest.lng=1/0),y._northEast&&(y._northEast.lat=-1/0,y._northEast.lng=-1/0)},_recalculateBounds:function(){var y=this._markers,T=this._childClusters,n=0,R=0,j=this._childCount,Y,re,me,be;if(j!==0){for(this._resetBounds(),Y=0;Y<y.length;Y++)me=y[Y]._latlng,this._bounds.extend(me),n+=me.lat,R+=me.lng;for(Y=0;Y<T.length;Y++)re=T[Y],re._boundsNeedUpdate&&re._recalculateBounds(),this._bounds.extend(re._bounds),me=re._wLatLng,be=re._childCount,n+=me.lat*be,R+=me.lng*be;this._latlng=this._wLatLng=new L.LatLng(n/j,R/j),this._boundsNeedUpdate=!1}},_addToMap:function(y){y&&(this._backupLatlng=this._latlng,this.setLatLng(y)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(y,T,n){this._recursively(y,this._group._map.getMinZoom(),n-1,function(R){var j=R._markers,Y,re;for(Y=j.length-1;Y>=0;Y--)re=j[Y],re._icon&&(re._setPos(T),re.clusterHide())},function(R){var j=R._childClusters,Y,re;for(Y=j.length-1;Y>=0;Y--)re=j[Y],re._icon&&(re._setPos(T),re.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(y,T,n,R){this._recursively(y,R,T,function(j){j._recursivelyAnimateChildrenIn(y,j._group._map.latLngToLayerPoint(j.getLatLng()).round(),n),j._isSingleParent()&&n-1===R?(j.clusterShow(),j._recursivelyRemoveChildrenFromMap(y,T,n)):j.clusterHide(),j._addToMap()})},_recursivelyBecomeVisible:function(y,T){this._recursively(y,this._group._map.getMinZoom(),T,null,function(n){n.clusterShow()})},_recursivelyAddChildrenToMap:function(y,T,n){this._recursively(n,this._group._map.getMinZoom()-1,T,function(R){if(T!==R._zoom)for(var j=R._markers.length-1;j>=0;j--){var Y=R._markers[j];n.contains(Y._latlng)&&(y&&(Y._backupLatlng=Y.getLatLng(),Y.setLatLng(y),Y.clusterHide&&Y.clusterHide()),R._group._featureGroup.addLayer(Y))}},function(R){R._addToMap(y)})},_recursivelyRestoreChildPositions:function(y){for(var T=this._markers.length-1;T>=0;T--){var n=this._markers[T];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(y-1===this._zoom)for(var R=this._childClusters.length-1;R>=0;R--)this._childClusters[R]._restorePosition();else for(var j=this._childClusters.length-1;j>=0;j--)this._childClusters[j]._recursivelyRestoreChildPositions(y)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(y,T,n,R){var j,Y;this._recursively(y,T-1,n-1,function(re){for(Y=re._markers.length-1;Y>=0;Y--)j=re._markers[Y],(!R||!R.contains(j._latlng))&&(re._group._featureGroup.removeLayer(j),j.clusterShow&&j.clusterShow())},function(re){for(Y=re._childClusters.length-1;Y>=0;Y--)j=re._childClusters[Y],(!R||!R.contains(j._latlng))&&(re._group._featureGroup.removeLayer(j),j.clusterShow&&j.clusterShow())})},_recursively:function(y,T,n,R,j){var Y=this._childClusters,re=this._zoom,me,be;if(T<=re&&(R&&R(this),j&&re===n&&j(this)),re<T||re<n)for(me=Y.length-1;me>=0;me--)be=Y[me],be._boundsNeedUpdate&&be._recalculateBounds(),y.intersects(be._bounds)&&be._recursively(y,T,n,R,j)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var y=this.options.opacity;return this.setOpacity(0),this.options.opacity=y,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(y){this._cellSize=y,this._sqCellSize=y*y,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(y,T){var n=this._getCoord(T.x),R=this._getCoord(T.y),j=this._grid,Y=j[R]=j[R]||{},re=Y[n]=Y[n]||[],me=L.Util.stamp(y);this._objectPoint[me]=T,re.push(y)},updateObject:function(y,T){this.removeObject(y),this.addObject(y,T)},removeObject:function(y,T){var n=this._getCoord(T.x),R=this._getCoord(T.y),j=this._grid,Y=j[R]=j[R]||{},re=Y[n]=Y[n]||[],me,be;for(delete this._objectPoint[L.Util.stamp(y)],me=0,be=re.length;me<be;me++)if(re[me]===y)return re.splice(me,1),be===1&&delete Y[n],!0},eachObject:function(y,T){var n,R,j,Y,re,me,be,oe=this._grid;for(n in oe){re=oe[n];for(R in re)for(me=re[R],j=0,Y=me.length;j<Y;j++)be=y.call(T,me[j]),be&&(j--,Y--)}},getNearObject:function(y){var T=this._getCoord(y.x),n=this._getCoord(y.y),R,j,Y,re,me,be,oe,Se,Re=this._objectPoint,tt=this._sqCellSize,yt=null;for(R=n-1;R<=n+1;R++)if(re=this._grid[R],re){for(j=T-1;j<=T+1;j++)if(me=re[j],me)for(Y=0,be=me.length;Y<be;Y++)oe=me[Y],Se=this._sqDist(Re[L.Util.stamp(oe)],y),(Se<tt||Se<=tt&&yt===null)&&(tt=Se,yt=oe)}return yt},_getCoord:function(y){var T=Math.floor(y/this._cellSize);return isFinite(T)?T:y},_sqDist:function(y,T){var n=T.x-y.x,R=T.y-y.y;return n*n+R*R}},(function(){L.QuickHull={getDistant:function(y,T){var n=T[1].lat-T[0].lat,R=T[0].lng-T[1].lng;return R*(y.lat-T[0].lat)+n*(y.lng-T[0].lng)},findMostDistantPointFromBaseLine:function(y,T){var n=0,R=null,j=[],Y,re,me;for(Y=T.length-1;Y>=0;Y--){if(re=T[Y],me=this.getDistant(re,y),me>0)j.push(re);else continue;me>n&&(n=me,R=re)}return{maxPoint:R,newPoints:j}},buildConvexHull:function(y,T){var n=[],R=this.findMostDistantPointFromBaseLine(y,T);return R.maxPoint?(n=n.concat(this.buildConvexHull([y[0],R.maxPoint],R.newPoints)),n=n.concat(this.buildConvexHull([R.maxPoint,y[1]],R.newPoints)),n):[y[0]]},getConvexHull:function(y){var T=!1,n=!1,R=!1,j=!1,Y=null,re=null,me=null,be=null,oe=null,Se=null,Re;for(Re=y.length-1;Re>=0;Re--){var tt=y[Re];(T===!1||tt.lat>T)&&(Y=tt,T=tt.lat),(n===!1||tt.lat<n)&&(re=tt,n=tt.lat),(R===!1||tt.lng>R)&&(me=tt,R=tt.lng),(j===!1||tt.lng<j)&&(be=tt,j=tt.lng)}n!==T?(Se=re,oe=Y):(Se=be,oe=me);var yt=[].concat(this.buildConvexHull([Se,oe],y),this.buildConvexHull([oe,Se],y));return yt}}})(),L.MarkerCluster.include({getConvexHull:function(){var y=this.getAllChildMarkers(),T=[],n,R;for(R=y.length-1;R>=0;R--)n=y[R].getLatLng(),T.push(n);return L.QuickHull.getConvexHull(T)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var y=this.getAllChildMarkers(null,!0),T=this._group,n=T._map,R=n.latLngToLayerPoint(this._latlng),j;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?j=this._group.options.spiderfyShapePositions(y.length,R):y.length>=this._circleSpiralSwitchover?j=this._generatePointsSpiral(y.length,R):(R.y+=10,j=this._generatePointsCircle(y.length,R)),this._animationSpiderfy(y,j)}},unspiderfy:function(y){this._group._inZoomAnimation||(this._animationUnspiderfy(y),this._group._spiderfied=null)},_generatePointsCircle:function(y,T){var n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+y),R=n/this._2PI,j=this._2PI/y,Y=[],re,me;for(R=Math.max(R,35),Y.length=y,re=0;re<y;re++)me=this._circleStartAngle+re*j,Y[re]=new L.Point(T.x+R*Math.cos(me),T.y+R*Math.sin(me))._round();return Y},_generatePointsSpiral:function(y,T){var n=this._group.options.spiderfyDistanceMultiplier,R=n*this._spiralLengthStart,j=n*this._spiralFootSeparation,Y=n*this._spiralLengthFactor*this._2PI,re=0,me=[],be;for(me.length=y,be=y;be>=0;be--)be<y&&(me[be]=new L.Point(T.x+R*Math.cos(re),T.y+R*Math.sin(re))._round()),re+=j/R+be*5e-4,R+=Y/re;return me},_noanimationUnspiderfy:function(){var y=this._group,T=y._map,n=y._featureGroup,R=this.getAllChildMarkers(null,!0),j,Y;for(y._ignoreMove=!0,this.setOpacity(1),Y=R.length-1;Y>=0;Y--)j=R[Y],n.removeLayer(j),j._preSpiderfyLatlng&&(j.setLatLng(j._preSpiderfyLatlng),delete j._preSpiderfyLatlng),j.setZIndexOffset&&j.setZIndexOffset(0),j._spiderLeg&&(T.removeLayer(j._spiderLeg),delete j._spiderLeg);y.fire("unspiderfied",{cluster:this,markers:R}),y._ignoreMove=!1,y._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(y,T){var n=this._group,R=n._map,j=n._featureGroup,Y=this._group.options.spiderLegPolylineOptions,re,me,be,oe;for(n._ignoreMove=!0,re=0;re<y.length;re++)oe=R.layerPointToLatLng(T[re]),me=y[re],be=new L.Polyline([this._latlng,oe],Y),R.addLayer(be),me._spiderLeg=be,me._preSpiderfyLatlng=me._latlng,me.setLatLng(oe),me.setZIndexOffset&&me.setZIndexOffset(1e6),j.addLayer(me);this.setOpacity(.3),n._ignoreMove=!1,n.fire("spiderfied",{cluster:this,markers:y})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(y,T){var n=this,R=this._group,j=R._map,Y=R._featureGroup,re=this._latlng,me=j.latLngToLayerPoint(re),be=L.Path.SVG,oe=L.extend({},this._group.options.spiderLegPolylineOptions),Se=oe.opacity,Re,tt,yt,qe,St,ai;for(Se===void 0&&(Se=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),be?(oe.opacity=0,oe.className=(oe.className||"")+" leaflet-cluster-spider-leg"):oe.opacity=Se,R._ignoreMove=!0,Re=0;Re<y.length;Re++)tt=y[Re],ai=j.layerPointToLatLng(T[Re]),yt=new L.Polyline([re,ai],oe),j.addLayer(yt),tt._spiderLeg=yt,be&&(qe=yt._path,St=qe.getTotalLength()+.1,qe.style.strokeDasharray=St,qe.style.strokeDashoffset=St),tt.setZIndexOffset&&tt.setZIndexOffset(1e6),tt.clusterHide&&tt.clusterHide(),Y.addLayer(tt),tt._setPos&&tt._setPos(me);for(R._forceLayout(),R._animationStart(),Re=y.length-1;Re>=0;Re--)ai=j.layerPointToLatLng(T[Re]),tt=y[Re],tt._preSpiderfyLatlng=tt._latlng,tt.setLatLng(ai),tt.clusterShow&&tt.clusterShow(),be&&(yt=tt._spiderLeg,qe=yt._path,qe.style.strokeDashoffset=0,yt.setStyle({opacity:Se}));this.setOpacity(.3),R._ignoreMove=!1,setTimeout(function(){R._animationEnd(),R.fire("spiderfied",{cluster:n,markers:y})},200)},_animationUnspiderfy:function(y){var T=this,n=this._group,R=n._map,j=n._featureGroup,Y=y?R._latLngToNewLayerPoint(this._latlng,y.zoom,y.center):R.latLngToLayerPoint(this._latlng),re=this.getAllChildMarkers(null,!0),me=L.Path.SVG,be,oe,Se,Re,tt,yt;for(n._ignoreMove=!0,n._animationStart(),this.setOpacity(1),oe=re.length-1;oe>=0;oe--)be=re[oe],be._preSpiderfyLatlng&&(be.closePopup(),be.setLatLng(be._preSpiderfyLatlng),delete be._preSpiderfyLatlng,yt=!0,be._setPos&&(be._setPos(Y),yt=!1),be.clusterHide&&(be.clusterHide(),yt=!1),yt&&j.removeLayer(be),me&&(Se=be._spiderLeg,Re=Se._path,tt=Re.getTotalLength()+.1,Re.style.strokeDashoffset=tt,Se.setStyle({opacity:0})));n._ignoreMove=!1,setTimeout(function(){var qe=0;for(oe=re.length-1;oe>=0;oe--)be=re[oe],be._spiderLeg&&qe++;for(oe=re.length-1;oe>=0;oe--)be=re[oe],be._spiderLeg&&(be.clusterShow&&be.clusterShow(),be.setZIndexOffset&&be.setZIndexOffset(0),qe>1&&j.removeLayer(be),R.removeLayer(be._spiderLeg),delete be._spiderLeg);n._animationEnd(),n.fire("unspiderfied",{cluster:T,markers:re})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(y){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(y))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(y){this._spiderfied&&this._spiderfied.unspiderfy(y)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(y){y._spiderLeg&&(this._featureGroup.removeLayer(y),y.clusterShow&&y.clusterShow(),y.setZIndexOffset&&y.setZIndexOffset(0),this._map.removeLayer(y._spiderLeg),delete y._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(y){return y?y instanceof L.MarkerClusterGroup?y=y._topClusterLevel.getAllChildMarkers():y instanceof L.LayerGroup?y=y._layers:y instanceof L.MarkerCluster?y=y.getAllChildMarkers():y instanceof L.Marker&&(y=[y]):y=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(y),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(y),this},_flagParentsIconsNeedUpdate:function(y){var T,n;for(T in y)for(n=y[T].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(y){var T,n;for(T in y)n=y[T],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(y,T){var n=this.options.icon;return L.setOptions(n,y),this.setIcon(n),T&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),d.MarkerClusterGroup=h,d.MarkerCluster=v,Object.defineProperty(d,"__esModule",{value:!0})})});var SO=ot((h1,p1)=>{(function(d,h){typeof h1=="object"&&typeof p1<"u"?p1.exports=h():typeof define=="function"&&define.amd?define(h):(d=typeof globalThis<"u"?globalThis:d||self,d.mapboxgl=h())})(h1,(function(){"use strict";var d,h,v;function y(n,R){if(!d)d=R;else if(!h)h=R;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",Y={};d(Y),v=R(Y),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}y(["exports"],(function(n){var R=1e-6,j=typeof Float32Array<"u"?Float32Array:Array;function Y(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=i*u-a*s;return p?(r[0]=u*(p=1/p),r[1]=-s*p,r[2]=-a*p,r[3]=i*p,r):null}function re(){var r=new j(9);return j!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function me(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=e[4],g=e[5],b=e[6],w=e[7],A=e[8];return r[0]=p*A-g*w,r[1]=a*w-s*A,r[2]=s*g-a*p,r[3]=g*b-u*A,r[4]=i*A-a*b,r[5]=a*u-i*g,r[6]=u*w-p*b,r[7]=s*b-i*w,r[8]=i*p-s*u,r}function be(r,e,i){var s=e[0],a=e[1],u=e[2],p=e[3],g=e[4],b=e[5],w=e[6],A=e[7],k=e[8],I=i[0],D=i[1],B=i[2],V=i[3],W=i[4],H=i[5],J=i[6],te=i[7],ne=i[8];return r[0]=I*s+D*p+B*w,r[1]=I*a+D*g+B*A,r[2]=I*u+D*b+B*k,r[3]=V*s+W*p+H*w,r[4]=V*a+W*g+H*A,r[5]=V*u+W*b+H*k,r[6]=J*s+te*p+ne*w,r[7]=J*a+te*g+ne*A,r[8]=J*u+te*b+ne*k,r}function oe(){var r=new j(16);return j!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Se(r){var e=new j(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Re(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tt(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=e[4],g=e[5],b=e[6],w=e[7],A=e[8],k=e[9],I=e[10],D=e[11],B=e[12],V=e[13],W=e[14],H=e[15],J=i*g-s*p,te=i*b-a*p,ne=i*w-u*p,_e=s*b-a*g,de=s*w-u*g,xe=a*w-u*b,Ce=A*V-k*B,Ae=A*W-I*B,He=A*H-D*B,Oe=k*W-I*V,Ze=k*H-D*V,Je=I*H-D*W,it=J*Je-te*Ze+ne*Oe+_e*He-de*Ae+xe*Ce;return it?(r[0]=(g*Je-b*Ze+w*Oe)*(it=1/it),r[1]=(a*Ze-s*Je-u*Oe)*it,r[2]=(V*xe-W*de+H*_e)*it,r[3]=(I*de-k*xe-D*_e)*it,r[4]=(b*He-p*Je-w*Ae)*it,r[5]=(i*Je-a*He+u*Ae)*it,r[6]=(W*ne-B*xe-H*te)*it,r[7]=(A*xe-I*ne+D*te)*it,r[8]=(p*Ze-g*He+w*Ce)*it,r[9]=(s*He-i*Ze-u*Ce)*it,r[10]=(B*de-V*ne+H*J)*it,r[11]=(k*ne-A*de-D*J)*it,r[12]=(g*Ae-p*Oe-b*Ce)*it,r[13]=(i*Oe-s*Ae+a*Ce)*it,r[14]=(V*te-B*_e-W*J)*it,r[15]=(A*_e-k*te+I*J)*it,r):null}function yt(r,e,i){var s=e[0],a=e[1],u=e[2],p=e[3],g=e[4],b=e[5],w=e[6],A=e[7],k=e[8],I=e[9],D=e[10],B=e[11],V=e[12],W=e[13],H=e[14],J=e[15],te=i[0],ne=i[1],_e=i[2],de=i[3];return r[0]=te*s+ne*g+_e*k+de*V,r[1]=te*a+ne*b+_e*I+de*W,r[2]=te*u+ne*w+_e*D+de*H,r[3]=te*p+ne*A+_e*B+de*J,r[4]=(te=i[4])*s+(ne=i[5])*g+(_e=i[6])*k+(de=i[7])*V,r[5]=te*a+ne*b+_e*I+de*W,r[6]=te*u+ne*w+_e*D+de*H,r[7]=te*p+ne*A+_e*B+de*J,r[8]=(te=i[8])*s+(ne=i[9])*g+(_e=i[10])*k+(de=i[11])*V,r[9]=te*a+ne*b+_e*I+de*W,r[10]=te*u+ne*w+_e*D+de*H,r[11]=te*p+ne*A+_e*B+de*J,r[12]=(te=i[12])*s+(ne=i[13])*g+(_e=i[14])*k+(de=i[15])*V,r[13]=te*a+ne*b+_e*I+de*W,r[14]=te*u+ne*w+_e*D+de*H,r[15]=te*p+ne*A+_e*B+de*J,r}function qe(r,e,i){var s,a,u,p,g,b,w,A,k,I,D,B,V=i[0],W=i[1],H=i[2];return e===r?(r[12]=e[0]*V+e[4]*W+e[8]*H+e[12],r[13]=e[1]*V+e[5]*W+e[9]*H+e[13],r[14]=e[2]*V+e[6]*W+e[10]*H+e[14],r[15]=e[3]*V+e[7]*W+e[11]*H+e[15]):(a=e[1],u=e[2],p=e[3],g=e[4],b=e[5],w=e[6],A=e[7],k=e[8],I=e[9],D=e[10],B=e[11],r[0]=s=e[0],r[1]=a,r[2]=u,r[3]=p,r[4]=g,r[5]=b,r[6]=w,r[7]=A,r[8]=k,r[9]=I,r[10]=D,r[11]=B,r[12]=s*V+g*W+k*H+e[12],r[13]=a*V+b*W+I*H+e[13],r[14]=u*V+w*W+D*H+e[14],r[15]=p*V+A*W+B*H+e[15]),r}function St(r,e,i){var s=i[0],a=i[1],u=i[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*u,r[9]=e[9]*u,r[10]=e[10]*u,r[11]=e[11]*u,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ai(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[4],p=e[5],g=e[6],b=e[7],w=e[8],A=e[9],k=e[10],I=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=u*a+w*s,r[5]=p*a+A*s,r[6]=g*a+k*s,r[7]=b*a+I*s,r[8]=w*a-u*s,r[9]=A*a-p*s,r[10]=k*a-g*s,r[11]=I*a-b*s,r}function pi(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],p=e[1],g=e[2],b=e[3],w=e[8],A=e[9],k=e[10],I=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=u*a-w*s,r[1]=p*a-A*s,r[2]=g*a-k*s,r[3]=b*a-I*s,r[8]=u*s+w*a,r[9]=p*s+A*a,r[10]=g*s+k*a,r[11]=b*s+I*a,r}function Cr(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],p=e[1],g=e[2],b=e[3],w=e[4],A=e[5],k=e[6],I=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=u*a+w*s,r[1]=p*a+A*s,r[2]=g*a+k*s,r[3]=b*a+I*s,r[4]=w*a-u*s,r[5]=A*a-p*s,r[6]=k*a-g*s,r[7]=I*a-b*s,r}function lr(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function bt(r,e,i){var s,a,u,p=i[0],g=i[1],b=i[2],w=Math.sqrt(p*p+g*g+b*b);return w<R?null:(p*=w=1/w,g*=w,b*=w,s=Math.sin(e),a=Math.cos(e),r[0]=p*p*(u=1-a)+a,r[1]=g*p*u+b*s,r[2]=b*p*u-g*s,r[3]=0,r[4]=p*g*u-b*s,r[5]=g*g*u+a,r[6]=b*g*u+p*s,r[7]=0,r[8]=p*b*u+g*s,r[9]=g*b*u-p*s,r[10]=b*b*u+a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Wt(r,e){var i=e[0],s=e[1],a=e[2],u=e[4],p=e[5],g=e[6],b=e[8],w=e[9],A=e[10];return r[0]=Math.sqrt(i*i+s*s+a*a),r[1]=Math.sqrt(u*u+p*p+g*g),r[2]=Math.sqrt(b*b+w*w+A*A),r}function li(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=i+i,g=s+s,b=a+a,w=i*p,A=s*p,k=s*g,I=a*p,D=a*g,B=a*b,V=u*p,W=u*g,H=u*b;return r[0]=1-k-B,r[1]=A+H,r[2]=I-W,r[3]=0,r[4]=A-H,r[5]=1-w-B,r[6]=D+V,r[7]=0,r[8]=I+W,r[9]=D-V,r[10]=1-w-k,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var Hi=yt;function hi(){var r=new j(3);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Di(r){var e=new j(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function kr(r){var e=r[0],i=r[1],s=r[2];return Math.sqrt(e*e+i*i+s*s)}function Si(r,e,i){var s=new j(3);return s[0]=r,s[1]=e,s[2]=i,s}function Ai(r,e,i,s){return r[0]=e,r[1]=i,r[2]=s,r}function oi(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function mo(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Mi(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Dr(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function gn(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function er(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function nn(r,e,i,s){return r[0]=e[0]+i[0]*s,r[1]=e[1]+i[1]*s,r[2]=e[2]+i[2]*s,r}function Kr(r,e){var i=e[0]-r[0],s=e[1]-r[1],a=e[2]-r[2];return Math.sqrt(i*i+s*s+a*a)}function Pr(r,e){var i=e[0]-r[0],s=e[1]-r[1],a=e[2]-r[2];return i*i+s*s+a*a}function Uo(r){var e=r[0],i=r[1],s=r[2];return e*e+i*i+s*s}function oo(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Er(r,e){var i=e[0],s=e[1],a=e[2],u=i*i+s*s+a*a;return u>0&&(u=1/Math.sqrt(u)),r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r}function _n(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Mn(r,e,i){var s=e[0],a=e[1],u=e[2],p=i[0],g=i[1],b=i[2];return r[0]=a*b-u*g,r[1]=u*p-s*b,r[2]=s*g-a*p,r}function Vs(r,e,i,s){var a=e[0],u=e[1],p=e[2];return r[0]=a+s*(i[0]-a),r[1]=u+s*(i[1]-u),r[2]=p+s*(i[2]-p),r}function Wr(r,e,i){var s=e[0],a=e[1],u=e[2],p=i[3]*s+i[7]*a+i[11]*u+i[15];return r[0]=(i[0]*s+i[4]*a+i[8]*u+i[12])/(p=p||1),r[1]=(i[1]*s+i[5]*a+i[9]*u+i[13])/p,r[2]=(i[2]*s+i[6]*a+i[10]*u+i[14])/p,r}function Ta(r,e,i){var s=e[0],a=e[1],u=e[2];return r[0]=s*i[0]+a*i[3]+u*i[6],r[1]=s*i[1]+a*i[4]+u*i[7],r[2]=s*i[2]+a*i[5]+u*i[8],r}function zo(r,e,i){var s=i[0],a=i[1],u=i[2],p=i[3],g=e[0],b=e[1],w=e[2],A=a*w-u*b,k=u*g-s*w,I=s*b-a*g;return r[0]=g+p*(A+=A)+a*(I+=I)-u*(k+=k),r[1]=b+p*k+u*A-s*I,r[2]=w+p*I+s*k-a*A,r}function Qo(r){return r[0]=0,r[1]=0,r[2]=0,r}function es(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var on=mo,lc=Mi,Ca=kr;function go(){var r=new j(4);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function na(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Tl(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=i*i+s*s+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=i*p,r[1]=s*p,r[2]=a*p,r[3]=u*p,r}function _o(r,e,i){var s=e[0],a=e[1],u=e[2],p=e[3];return r[0]=i[0]*s+i[4]*a+i[8]*u+i[12]*p,r[1]=i[1]*s+i[5]*a+i[9]*u+i[13]*p,r[2]=i[2]*s+i[6]*a+i[10]*u+i[14]*p,r[3]=i[3]*s+i[7]*a+i[11]*u+i[15]*p,r}function Ea(){var r=new j(4);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ts(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Us(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],p=e[3],g=Math.sin(i),b=Math.cos(i);return r[0]=s*b+p*g,r[1]=a*b+u*g,r[2]=u*b-a*g,r[3]=p*b-s*g,r}function Aa(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],p=e[3],g=Math.sin(i),b=Math.cos(i);return r[0]=s*b-u*g,r[1]=a*b+p*g,r[2]=u*b+s*g,r[3]=p*b-a*g,r}hi(),go();var Ao,ka,gs,Cl=Tl,Xa=(Ao=hi(),ka=Si(1,0,0),gs=Si(0,1,0),function(r,e,i){var s=_n(e,i);return s<-.999999?(Mn(Ao,ka,e),Ca(Ao)<1e-6&&Mn(Ao,gs,e),Er(Ao,Ao),(function(a,u,p){p*=.5;var g=Math.sin(p);a[0]=g*u[0],a[1]=g*u[1],a[2]=g*u[2],a[3]=Math.cos(p)})(r,Ao,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Mn(Ao,e,i),r[0]=Ao[0],r[1]=Ao[1],r[2]=Ao[2],r[3]=1+s,Cl(r,r))});function xn(){var r=new j(2);return j!=Float32Array&&(r[0]=0,r[1]=0),r}function Ia(r,e){var i=new j(2);return i[0]=r,i[1]=e,i}function El(r,e,i){return r[0]=e,r[1]=i,r}function qo(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function _s(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function is(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function Gr(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function Gn(r,e){var i=e[0],s=e[1],a=i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e[0]*a,r[1]=e[1]*a,r}function Pa(r,e){return r[0]*e[0]+r[1]*e[1]}Ea(),Ea(),re();var La,Wo,Xc=_s;function cc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}xn();var Zu=(function(){if(Wo)return La;function r(e,i,s,a){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(a-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=a}return Wo=1,La=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,a=0;a<8;a++){var u=this.sampleCurveX(s)-e;if(Math.abs(u)<i)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=u/p}var g=0,b=1;for(s=e,a=0;a<20&&(u=this.sampleCurveX(s),!(Math.abs(u-e)<i));a++)e>u?g=s:b=s,s=.5*(b-g)+g;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},La})(),Al=cc(Zu);function st(r,e){this.x=r,this.y=e}function oa(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!oa(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(let i in r)if(!oa(r[i],e[i]))return!1;return!0}return r===e}st.prototype={clone(){return new st(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){let e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){let e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){let r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){let e=Math.cos(r),i=Math.sin(r),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(r,e){let i=Math.cos(r),s=Math.sin(r),a=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=a,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(r){if(r instanceof st)return r;if(Array.isArray(r))return new st(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new st(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};let uc=Math.PI/180,dc=180/Math.PI;function Bi(r){return r*uc}function bn(r){return r*dc}let ki=[[0,0],[1,0],[1,1],[0,1]];function kl(r){if(r<=0)return 0;if(r>=1)return 1;let e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Le(r,e,i,s){let a=new Al(r,e,i,s);return function(u){return a.solve(u)}}let Z=Le(.25,.1,.25,1);function X(r,e,i){return Math.min(i,Math.max(e,r))}function le(r,e,i){return(i=X((i-r)/(e-r),0,1))*i*(3-2*i)}function Te(r,e,i){let s=i-e,a=((r-e)%s+s)%s+e;return a===e?i:a}function we(r,e,i){if(!r.length)return i(null,[]);let s=r.length,a=new Array(r.length),u=null;r.forEach(((p,g)=>{e(p,((b,w)=>{b&&(u=b),a[g]=w,--s==0&&i(u,a)}))}))}let ke=1;function je(){return ke++}function Pe(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Fe(r,e){r.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function dt(r,e,i){let s={};for(let a in r)s[a]=e.call(this,r[a],a,r);return s}function rt(r,e,i){let s={};for(let a in r)e.call(this,r[a],a,r)&&(s[a]=r[a]);return s}function jt(r){return Array.isArray(r)?r.map(jt):typeof r=="object"&&r?dt(r,jt):r}function ti(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}let ii={};function Zt(r){ii[r]||(typeof console<"u"&&console.warn(r),ii[r]=!0)}function bi(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Ci(r){let e=0;for(let i,s,a=0,u=r.length,p=u-1;a<u;p=a++)i=r[a],s=r[p],e+=(s.x-i.x)*(i.y+s.y);return e}function mr([r,e,i]){let s=Bi(e+90),a=Bi(i);return{x:r*Math.cos(s)*Math.sin(a),y:r*Math.sin(s)*Math.sin(a),z:r*Math.cos(a),azimuthal:e,polar:i}}function Hr(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function un(r){let e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,s,a,u)=>{let p=a||u;return e[s]=!p||p.toLowerCase(),""})),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let dn=null;function sn(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Ki(r,e,i,s){for(;e<i;){let a=e+i>>1;r[a]<s?e=a+1:i=a}return e}function Kt(r,e,i,s){for(;e<i;){let a=e+i>>1;r[a]<=s?e=a+1:i=a}return e}function Ii(r){return r>0?1/(1.001-r):1+r}function Br(r){return r>0?1-1/(1.001-r):-r}function tr(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}let yr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!yr.API_URL)return null;try{let r=new URL(yr.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Tn(r){return yr.API_URL_REGEX.test(r)}function Ri(r){return yr.API_SPRITE_REGEX.test(r)}let Jr,sa,Cn,Pn,yo,Mo;function Un(){return Jr==null&&(Jr=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Jr}let Zr={now:()=>Pn!==void 0?Pn:performance.now(),setNow(r){Pn=r},restoreNow(){Pn=void 0},frame(r){let e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){let{width:i,height:s}=r;yo||(yo=document.createElement("canvas"));let a=yo.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>yo.width||s>yo.height)&&(yo.width=i,yo.height=s),a.clearRect(-e,-e,i+2*e,s+2*e),a.drawImage(r,0,0,i,s),a.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(sa||(sa=document.createElement("a")),sa.href=r,sa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Cn==null&&(Cn=window.matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches)},hasCanvasFingerprintNoise(){if(Mo!==void 0)return Mo;if(!Un())return Mo=!1,!1;let r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0}),i=0;for(let a=0;a<r.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);let s=e.getImageData(0,0,r.width,r.height);i=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&i++!==s.data[a])return Mo=!0,!0;return Mo=!1,!1}};function qs(r,e){let i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;let s=new URLSearchParams(r.slice(i));for(let a in e)s.set(a,e[a]);return`${r.slice(0,i)}?${s.toString()}`}function aa(r,e={persistentParams:[]}){let i=r.indexOf("?");if(i<0)return r;let s=new URLSearchParams,a=new URLSearchParams(r.slice(i));for(let p of e.persistentParams){let g=a.get(p);g&&s.set(p,g)}let u=s.toString();return`${r.slice(0,i)}${u.length>0?`?${u}`:""}`}let la="mapbox-tiles",Ya=500,Hn=50,Go=["language","worldview","jobid"],Kn,vo;function ys(){try{return caches}catch{}}function ca(){let r=ys();r&&Kn==null&&(Kn=r.open(la))}let Ka=1/0,hc={supported:!1,testSupport:function(r){!pr&&za&&(vs?Yc(r):rs=r)}},rs,za,pr=!1,vs=!1,Lr=typeof self<"u"?self:{};function Yc(r){let e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,za),r.isContextLost())return;hc.supported=!0}catch{}r.deleteTexture(e),pr=!0}Lr.document&&(za=Lr.document.createElement("img"),za.onload=function(){rs&&Yc(rs),rs=null,vs=!0},za.onerror=function(){pr=!0,rs=null},za.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let ua={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ua);class da extends Error{constructor(e,i,s){i===401&&Tn(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let pc=Hr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xs=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(pc())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(s,a){let u=new AbortController,p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:pc(),referrerPolicy:s.referrerPolicy,signal:u.signal}),g=!1,b=!1,w=(A=p.url).indexOf("sku=")>0&&Tn(A);var A;s.type==="json"&&p.headers.set("Accept","application/json");let k=(D,B,V)=>{if(b)return;if(D&&D.message!=="SecurityError"&&Zt(D.toString()),B&&V)return I(B);let W=Date.now();fetch(p).then((H=>{if(H.ok){let J=w?H.clone():null;return I(H,J,W)}return a(new da(H.statusText,H.status,s.url))})).catch((H=>{H.name!=="AbortError"&&a(new Error(`${H.message} ${s.url}`))}))},I=(D,B,V)=>{(s.type==="arrayBuffer"?D.arrayBuffer():s.type==="json"?D.json():D.text()).then((W=>{b||(B&&V&&(function(H,J,te){if(ca(),Kn==null)return;let ne=un(J.headers.get("Cache-Control")||"");if(ne["no-store"])return;let _e={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach(((Ce,Ae)=>_e.headers.set(Ae,Ce))),ne["max-age"]&&_e.headers.set("Expires",new Date(te+1e3*ne["max-age"]).toUTCString());let de=_e.headers.get("Expires");if(!de||new Date(de).getTime()-te<42e4)return;let xe=aa(H.url,{persistentParams:Go});if(J.status===206){let Ce=H.headers.get("Range");if(!Ce)return;_e.status=200,xe=qs(xe,{range:Ce})}(function(Ce,Ae){if(vo===void 0)try{new Response(new ReadableStream),vo=!0}catch{vo=!1}vo?Ae(Ce.body):Ce.blob().then(Ae).catch((He=>Zt(He.message)))})(J,(Ce=>{let Ae=new Response((He=J.status)!==200&&He!==404&&[101,103,204,205,304].includes(He)?null:Ce,_e);var He;ca(),Kn?.then((Oe=>Oe.put(xe,Ae))).catch((Oe=>Zt(Oe.message)))}))})(p,B,V),g=!0,a(null,W,D.headers))})).catch((W=>{b||a(new Error(W.message))}))};return w?(function(D,B){if(ca(),Kn==null)return B(null);Kn.then((V=>{let W=aa(D.url,{persistentParams:Go}),H=D.headers.get("Range");H&&(W=qs(W,{range:H})),V.match(W).then((J=>{let te=(function(ne){if(!ne)return!1;let _e=new Date(ne.headers.get("Expires")||0),de=un(ne.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!de["no-cache"]})(J);V.delete(W).catch(B),te&&V.put(W,J.clone()).catch(B),B(null,J,te)})).catch(B)})).catch(B)})(p,k):k(null,null),{cancel:()=>{b=!0,g||u.abort()}}})(r,e);if(Hr(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(s,a){let u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let p in s.headers)u.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(s.type==="json")try{p=JSON.parse(u.response)}catch(b){return a(b)}let g=new Headers;u.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((b=>{let w=b.split(": "),A=w.shift(),k=w.join(": ");g.append(A,k)})),a(null,p,g)}else a(new da(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}})(r,e)},Ma=function(r,e){return xs(Object.assign(r,{type:"arrayBuffer"}),e)};function Ni(r){let e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}let Zn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",bs,Il;bs=[],Il=0;let Kc=function(r,e){if(hc.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Il>=yr.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bs.push(u),u}Il++;let i=!1,s=()=>{if(!i)for(i=!0,Il--;bs.length&&Il<yr.MAX_PARALLEL_IMAGE_REQUESTS;){let u=bs.shift(),{requestParameters:p,callback:g,cancelled:b}=u;b||(u.cancel=Kc(p,g).cancel)}},a=Ma(r,((u,p,g)=>{s(),u?e(u):p&&(self.createImageBitmap?(function(b,w){let A=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(A).then((k=>{w(null,k)})).catch((k=>{w(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(p,((b,w)=>e(b,w,g))):(function(b,w){let A=new Image;A.onload=()=>{w(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame((()=>{A.src=Zn}))},A.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let k=new Blob([new Uint8Array(b)],{type:"image/png"});A.src=b.byteLength?URL.createObjectURL(k):Zn})(p,((b,w)=>e(b,w,g))))}));return{cancel:()=>{a.cancel(),s()}}};var fc,Pl,Ja,Qa={exports:{}},$u={exports:{}},zr={exports:{}},Lp=(function(){if(Ja)return Qa.exports;Ja=1;var r=(fc||(fc=1,$u.exports=function(i,s){var a,u,p,g,b,w,A,k;for(u=i.length-(a=3&i.length),p=s,b=3432918353,w=461845907,k=0;k<u;)A=255&i.charCodeAt(k)|(255&i.charCodeAt(++k))<<8|(255&i.charCodeAt(++k))<<16|(255&i.charCodeAt(++k))<<24,++k,p=27492+(65535&(g=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(A=0,a){case 3:A^=(255&i.charCodeAt(k+2))<<16;case 2:A^=(255&i.charCodeAt(k+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&i.charCodeAt(k)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),$u.exports),e=(Pl||(Pl=1,zr.exports=function(i,s){for(var a,u=i.length,p=s^u,g=0;u>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:p^=(255&i.charCodeAt(g+2))<<16;case 2:p^=(255&i.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),zr.exports);return Qa.exports=r,Qa.exports.murmur3=r,Qa.exports.murmur2=e,Qa.exports})(),ko=cc(Lp);class so{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Ll extends so{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function zl(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function el(r,e,i){if(i&&i[r]){let s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class ha{on(e,i){return this._listeners=this._listeners||{},zl(e,i,this._listeners),this}off(e,i){return el(e,i,this._listeners),el(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},zl(e,i,this._oneTimeListeners),this):new Promise((s=>{this.once(e,s)}))}fire(e,i){let s=typeof e=="string"?new so(e,i):e,a=s.type;if(this.listens(a)){s.target=this;let u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let b of u)b.call(this,s);let p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let b of p)el(a,b,this._oneTimeListeners),b.call(this,s);let g=this._eventedParent;if(g){let b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,b),g.fire(s)}}else s instanceof Ll&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class kn{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new kn(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){let[i,s]=e.split("");return new kn({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return kn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Xu,Yu={},mc=(function(){if(Xu)return Yu;Xu=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function i(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function s(u){return(p=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:p>1?1:p;var p}function a(u,p,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?u+(p-u)*g*6:2*g<1?p:3*g<2?u+(p-u)*(2/3-g)*6:u}try{Yu.parseCSSColor=function(u){var p,g=u.replace(/ /g,"").toLowerCase();if(g in r)return r[g].slice();if(g[0]==="#")return g.length===4?(p=parseInt(g.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:g.length===7&&(p=parseInt(g.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var b=g.indexOf("("),w=g.indexOf(")");if(b!==-1&&w+1===g.length){var A=g.substr(0,b),k=g.substr(b+1,w-(b+1)).split(","),I=1;switch(A){case"rgba":if(k.length!==4)return null;I=s(k.pop());case"rgb":return k.length!==3?null:[i(k[0]),i(k[1]),i(k[2]),I];case"hsla":if(k.length!==4)return null;I=s(k.pop());case"hsl":if(k.length!==3)return null;var D=(parseFloat(k[0])%360+360)%360/360,B=s(k[1]),V=s(k[2]),W=V<=.5?V*(B+1):V+B-V*B,H=2*V-W;return[e(255*a(H,W,D+1/3)),e(255*a(H,W,D)),e(255*a(H,W,D-1/3)),I];default:return null}}return null}}catch{}return Yu})();class cr{constructor(e,i,s,a=1){this.r=e,this.g=i,this.b=s,this.a=a}static parse(e){if(!e)return;if(e instanceof cr)return e;if(typeof e!="string")return;let i=mc.parseCSSColor(e);return i?new cr(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){let[e,i,s,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${a})`}toNonPremultipliedRenderColor(e){let{r:i,g:s,b:a,a:u}=this;return new Fd(e,i,s,a,u)}toPremultipliedRenderColor(e){let{r:i,g:s,b:a,a:u}=this;return new Ku(e,i*u,s*u,a*u,u)}clone(){return new cr(this.r,this.g,this.b,this.a)}}class ns{constructor(e,i,s,a,u,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){let g=e.image.height,b=g*g;this.premultiplied?(i=u===0?0:i/u*(g-1),s=u===0?0:s/u*(g-1),a=u===0?0:a/u*(g-1)):(i*=g-1,s*=g-1,a*=g-1);let w=Math.floor(i),A=Math.floor(s),k=Math.floor(a),I=Math.ceil(i),D=Math.ceil(s),B=Math.ceil(a),V=i-w,W=s-A,H=a-k,J=e.image.data,te=4*(w+A*b+k*g),ne=4*(w+A*b+B*g),_e=4*(w+D*b+k*g),de=4*(w+D*b+B*g),xe=4*(I+A*b+k*g),Ce=4*(I+A*b+B*g),Ae=4*(I+D*b+k*g),He=4*(I+D*b+B*g);if(te<0||He>=J.length)throw new Error("out of range");this.r=$t($t($t(J[te],J[ne],H),$t(J[_e],J[de],H),W),$t($t(J[xe],J[Ce],H),$t(J[Ae],J[He],H),W),V)/255*(this.premultiplied?u:1),this.g=$t($t($t(J[te+1],J[ne+1],H),$t(J[_e+1],J[de+1],H),W),$t($t(J[xe+1],J[Ce+1],H),$t(J[Ae+1],J[He+1],H),W),V)/255*(this.premultiplied?u:1),this.b=$t($t($t(J[te+2],J[ne+2],H),$t(J[_e+2],J[de+2],H),W),$t($t(J[xe+2],J[Ce+2],H),$t(J[Ae+2],J[He+2],H),W),V)/255*(this.premultiplied?u:1),this.a=u}else this.r=i,this.g=s,this.b=a,this.a=u}toArray(){let{r:e,g:i,b:s,a}=this;return[255*e,255*i,255*s,a]}toHslaArray(){let{r:e,g:i,b:s,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];let B=1/a;e*=B,i*=B,s*=B}let u=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),g=Math.min(Math.max(s,0),1),b=Math.min(u,p,g),w=Math.max(u,p,g),A=w-b,k=.5*(b+w);if(A===0)return[0,0,100*k,a];let I=k>.5?A/(2-w-b):A/(w+b),D;switch(w){case u:D=60*((p-g)/A+(p<g?6:0));break;case p:D=60*((g-u)/A+2);break;default:D=60*((u-p)/A+4)}return[D,100*I,100*k,a]}toArray01(){let{r:e,g:i,b:s,a}=this;return[e,i,s,a]}toArray01Scaled(e){let{r:i,g:s,b:a}=this;return[i*e,s*e,a*e]}toArray01Linear(){let{r:e,g:i,b:s,a}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),a]}}class Fd extends ns{constructor(e,i,s,a,u){super(e,i,s,a,u,!1)}}class Ku extends ns{constructor(e,i,s,a,u){super(e,i,s,a,u,!0)}}function $t(r,e,i){return r*(1-i)+e*i}function Ml(r,e,i){return r.map(((s,a)=>$t(s,e[a],i)))}cr.black=new cr(0,0,0,1),cr.white=new cr(1,1,1,1),cr.transparent=new cr(0,0,0,0),cr.red=new cr(1,0,0,1),cr.blue=new cr(0,0,1,1);var Ws=Object.freeze({__proto__:null,array:Ml,color:function(r,e,i){return new cr($t(r.r,e.r,i),$t(r.g,e.g,i),$t(r.b,e.b,i),$t(r.a,e.a,i))},number:$t});class Oo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class os{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[s,a]of i)this.bindings[s]=a}concat(e){return new os(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let tl={kind:"null"},Gt={kind:"number"},Zi={kind:"string"},ir={kind:"boolean"},xo={kind:"color"},Ol={kind:"object"},ur={kind:"value"},Rl={kind:"collator"},Gs={kind:"formatted"},ws={kind:"resolvedImage"};function qn(r,e){return{kind:"array",itemType:r,N:e}}function fn(r){if(r.kind==="array"){let e=fn(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}let ss=[tl,Gt,Zi,ir,xo,Gs,Ol,qn(ur),ws];function Dl(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Dl(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(let i of ss)if(!Dl(i,e))return null}}return`Expected ${fn(r)} but found ${fn(e)} instead.`}function Jc(r,e){return e.some((i=>i.kind===r.kind))}function gc(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Bl(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Bl(r.itemType,e.itemType):r.kind===e.kind}class _c{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yc{constructor(e,i,s,a,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=a,this.textColor=u}}class jn{constructor(e){this.sections=e}static fromString(e){return new jn([new yc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof jn?e:jn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){let a=i.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(i.text);let s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class Hs{constructor(e,i={}){if(this.id=kn.from(e),this.options=Object.assign({},i),i.transform){let{a:s,b:a,c:u,d:p,e:g,f:b}=i.transform;this.options.transform=new DOMMatrix([s,a,u,p,g,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){let{a:e,b:i,c:s,d:a,e:u,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:s,d:a,e:u,f:p}})}static parse(e){let i,s,a,u;try{({name:i,iconsetId:s,params:a,transform:u}=JSON.parse(e)||{})}catch{return null}if(!i)return null;let{a:p,b:g,c:b,d:w,e:A,f:k}=u||{};return new Hs({name:i,iconsetId:s},{params:a,transform:new DOMMatrix([p,g,b,w,A,k])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Io{constructor(e,i,s,a,u=!1){this.primaryId=kn.from(e),this.primaryOptions=i,s&&(this.secondaryId=kn.from(s)),this.secondaryOptions=a,this.available=u}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Hs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Hs(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Io.build({name:e}):e}static build(e,i,s,a){return!e||typeof e=="object"&&!("name"in e)?null:new Io(e,s,i,a)}}function Ro(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ss(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof cr||r instanceof _c||r instanceof jn||r instanceof Io)return!0;if(Array.isArray(r)){for(let e of r)if(!Ss(e))return!1;return!0}if(typeof r=="object"){for(let e in r)if(!Ss(r[e]))return!1;return!0}return!1}function On(r){if(r===null)return tl;if(typeof r=="string")return Zi;if(typeof r=="boolean")return ir;if(typeof r=="number")return Gt;if(r instanceof cr)return xo;if(r instanceof _c)return Rl;if(r instanceof jn)return Gs;if(r instanceof Io)return ws;if(Array.isArray(r)){let e=r.length,i;for(let s of r){let a=On(s);if(i){if(i===a)continue;i=ur;break}i=a}return qn(i||ur,e)}return Ol}function Jn(r){let e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof jn||r instanceof Io||r instanceof cr?r.toString():JSON.stringify(r)}class pa{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ss(e[1]))return i.error("invalid value");let s=e[1],a=On(s),u=i.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new pa(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof cr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof jn?this.value.serialize():this.value}}class $r{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let vi={string:Zi,number:Gt,boolean:ir,object:Ol};class Rt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,a=1,u=e[0];if(u==="array"){let g,b;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in vi)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=vi[w],a++}else g=ur;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],a++}s=qn(g,b)}else s=vi[u];let p=[];for(;a<e.length;a++){let g=i.parse(e[a],a,ur);if(!g)return null;p.push(g)}return new Rt(s,p)}evaluate(e){for(let i=0;i<this.args.length;i++){let s=this.args[i].evaluate(e);if(!Dl(this.type,On(s)))return s;if(i===this.args.length-1)throw new $r(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${fn(On(s))} but was expected to be of type ${fn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);let a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map((s=>s.serialize())))}}class Oa{constructor(e){this.type=Gs,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");let a=[],u=!1;for(let p=1;p<=e.length-1;++p){let g=e[p];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let b=null;if(g["font-scale"]&&(b=i.parseObjectValue(g["font-scale"],p,"font-scale",Gt),!b))return null;let w=null;if(g["text-font"]&&(w=i.parseObjectValue(g["text-font"],p,"text-font",qn(Zi)),!w))return null;let A=null;if(g["text-color"]&&(A=i.parseObjectValue(g["text-color"],p,"text-color",xo),!A))return null;let k=a[a.length-1];k.scale=b,k.font=w,k.textColor=A}else{let b=i.parse(e[p],p,ur);if(!b)return null;let w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:b,scale:null,font:null,textColor:null})}}return new Oa(a)}evaluate(e){return new jn(this.sections.map((i=>{let s=i.content.evaluate(e);return Bl(On(s),ws)?new yc("",s,null,null,null):new yc(Jn(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class ni{constructor(e,i,s,a){this._imageWarnHistory={},this.type=ws,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1,a=[];function u(){if(s<e.length){let g=i.parse(e[s],s++,Zi);return g?(a.push({image:g,options:{}}),!0):(i.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(s<e.length){let b=e[s];if((g=b)===null||typeof g!="object"||Array.isArray(g))return!0;let w=b.params,A=b.iconset,k=i.concat(s);if(!w&&!A)return s++,!0;if(w){if(typeof w!="object"||w.constructor!==Object)return k.error('Image options "params" should be an object'),!1;let I={},D=k.concat(void 0,"params");for(let B in w){if(!B)return D.error("Image parameter name should be non-empty"),!1;let V=D.concat(void 0,B).parse(w[B],void 0,xo,void 0,{typeAnnotation:"coerce"});if(!V)return!1;I[B]=V}a[a.length-1].options.params=I}if(A){if(typeof A!="object"||A.constructor!==Object)return k.error('Image options "iconset" should be an object'),!1;if(!A.id)return k.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=A}return s++,!0}var g;return!0}for(let g=0;g<2;g++)if(!u()||!p())return;return new ni(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,i){let s={};if(i){for(let a in i)if(i[a])try{s[a]=i[a].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){let i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=Io.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){let u=a.getPrimary().id;if(a.available=e.availableImages.some((p=>kn.isEqual(p,u))),a.available){let p=a.getSecondary()?a.getSecondary().id:null;p&&(a.available=e.availableImages.some((g=>kn.isEqual(g,p))))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(let i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(let i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){let s={};if(i&&(s.iconset={id:i}),e){s.params={};for(let a in e)e[a]&&(s.params[a]=e[a].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){let e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Fl(r){return Jt(r)?"string":vc(r)?"number":Nl(r)?"boolean":Array.isArray(r)?"array":r===null?"null":Ts(r)?"object":typeof r}function Ts(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function Jt(r){return typeof r=="string"||r instanceof String}function vc(r){return typeof r=="number"||r instanceof Number}function Nl(r){return typeof r=="boolean"||r instanceof Boolean}let Nd={"to-boolean":ir,"to-color":xo,"to-number":Gt,"to-string":Zi};class Qn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s=e[0],a=[],u=tl;if(s==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=qn(i.expectedType.itemType,p)}else{if(!(p>0&&Ss(e[1][0])))return null;u=qn(On(e[1][0]),p)}for(let g=0;g<p;g++){let b=e[1][g],w;if(Array.isArray(b))w=i.parse(b,void 0,u.itemType);else{let A=Fl(b);if(A!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${A}.`);w=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!w)return null;a.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=Nd[s];for(let p=1;p<e.length;p++){let g=i.parse(e[p],p,ur);if(!g)return null;a.push(g)}}return new Qn(u,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(let a of this.args){if(i=a.evaluate(e),s=null,i instanceof cr)return i;if(typeof i=="string"){let u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ro(i[0],i[1],i[2],i[3]),!s))return new cr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new $r(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let s of this.args){if(i=s.evaluate(e),i===null)return 0;let a=Number(i);if(!isNaN(a))return a}throw new $r(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?jn.fromString(Jn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Io.build(Jn(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Jn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Oa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ni(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}let Qc=["Unknown","Point","LineString","Polygon"];class En{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=cr.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ao{constructor(e,i,s,a,u){this.name=e,this.type=i,this._evaluate=s,this.args=a,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let i=ao.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){let s=e[0],a=ao.definitions[s];if(!a)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(a)?a[0]:a.type,p=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,g=[],b=null,w=-1;for(let[A,k]of p){if(Array.isArray(A)&&A.length!==e.length-1)continue;g.push(A),w++,b=new Tc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);let I=[],D=!1;for(let B=1;B<e.length;B++){let V=e[B],W=Array.isArray(A)?A[B-1]:A.type,H=b.parse(V,1+I.length,W);if(!H){D=!0;break}I.push(H)}if(!D)if(Array.isArray(A)&&A.length!==I.length)b.error(`Expected ${A.length} arguments, but found ${I.length} instead.`);else{for(let B=0;B<I.length;B++){let V=Array.isArray(A)?A[B]:A.type,W=I[B];b.concat(B+1).checkSubtype(V,W.type)}if(b.errors.length===0)return new ao(s,u,k,I,w)}}if(g.length===1)i.errors.push(...b.errors);else{let A=(g.length?g:p.map((([I])=>I))).map(Po).join(" | "),k=[];for(let I=1;I<e.length;I++){let D=i.parse(e[I],1+k.length);if(!D)return null;k.push(fn(D.type))}i.error(`Expected arguments of type ${A}, but found (${k.join(", ")}) instead.`)}return null}static register(e,i){ao.definitions=i;for(let s in i)e[s]=ao}}function Po(r){return Array.isArray(r)?`(${r.map(fn).join(", ")})`:`(${fn(r.type)}...)`}class fa{constructor(e,i,s){this.type=Rl,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");let a=s["case-sensitive"]===void 0?i.parse(!1,1,ir):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",ir);if(!a)return null;let u=s["diacritic-sensitive"]===void 0?i.parse(!1,1,ir):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",ir);if(!u)return null;let p=null;return s.locale&&(p=i.parseObjectValue(s.locale,1,"locale",Zi),!p)?null:new fa(a,u,p)}evaluate(e){return new _c(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Zs(r,e,i=0,s=r.length-1,a=eu){for(;s>i;){if(s-i>600){let b=s-i+1,w=e-i+1,A=Math.log(b),k=.5*Math.exp(2*A/3),I=.5*Math.sqrt(A*k*(b-k)/b)*(w-b/2<0?-1:1);Zs(r,e,Math.max(i,Math.floor(e-w*k/b+I)),Math.min(s,Math.floor(e+(b-w)*k/b+I)),a)}let u=r[e],p=i,g=s;for(Rn(r,i,e),a(r[s],u)>0&&Rn(r,i,s);p<g;){for(Rn(r,p,g),p++,g--;a(r[p],u)<0;)p++;for(;a(r[g],u)>0;)g--}a(r[i],u)===0?Rn(r,i,g):(g++,Rn(r,g,s)),g<=e&&(i=g+1),e<=g&&(s=g-1)}}function Rn(r,e,i){let s=r[e];r[e]=r[i],r[i]=s}function eu(r,e){return r<e?-1:r>e?1:0}function Ju(r){let e=0;for(let i,s,a=0,u=r.length,p=u-1;a<u;p=a++)i=r[a],s=r[p],e+=(s.x-i.x)*(i.y+s.y);return e}function Ra(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ho(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function xc(r,e,i){let s=r[0]-e[0],a=r[1]-e[1],u=r[0]-i[0],p=r[1]-i[1];return s*p-u*a==0&&s*u<=0&&a*p<=0}function Do(r,e,i=!1){let s=!1;for(let g=0,b=e.length;g<b;g++){let w=e[g];for(let A=0,k=w.length,I=k-1;A<k;I=A++){let D=w[I],B=w[A];if(xc(r,D,B))return i;(u=D)[1]>(a=r)[1]!=(p=B)[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]&&(s=!s)}}var a,u,p;return s}function Qu(r,e,i,s){let a=s[0]-i[0],u=s[1]-i[1],p=(r[0]-i[0])*u-a*(r[1]-i[1]),g=(e[0]-i[0])*u-a*(e[1]-i[1]);return p>0&&g<0||p<0&&g>0}function tu(r,e,i,s){return(a=[s[0]-i[0],s[1]-i[1]])[0]*(u=[e[0]-r[0],e[1]-r[1]])[1]-a[1]*u[0]!=0&&!(!Qu(r,e,i,s)||!Qu(i,s,r,e));var a,u}function Da(r){let e=new st(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new st(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let s of r[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}let Ba=8192;function jd(r,e){let i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*Ba),Math.round(s*a*Ba)]}function Vd(r,e){for(let i=0;i<e.length;i++)if(Do(r,e[i]))return!0;return!1}function Ud(r,e,i){for(let s of i)for(let a=0,u=s.length,p=u-1;a<u;p=a++)if(tu(r,e,s[p],s[a]))return!0;return!1}function Fa(r,e){for(let i=0;i<r.length;++i)if(!Do(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Ud(r[i],r[i+1],e))return!1;return!0}function $s(r,e){for(let i=0;i<e.length;i++)if(Fa(r,e[i]))return!0;return!1}function jl(r,e,i){let s=[];for(let a=0;a<r.length;a++){let u=[];for(let p=0;p<r[a].length;p++){let g=jd(r[a][p],i);Ra(e,g),u.push(g)}s.push(u)}return s}function iu(r,e,i){let s=[];for(let a=0;a<r.length;a++){let u=jl(r[a],e,i);s.push(u)}return s}function Vl(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){let a=.5*s,u=r[0]-i[0]>a?-s:i[0]-r[0]>a?s:0;u===0&&(u=r[0]-i[2]>a?-s:i[2]-r[0]>a?s:0),r[0]+=u}Ra(e,r)}function ed(r,e,i,s){let a=Math.pow(2,s.z)*Ba,u=[s.x*Ba,s.y*Ba],p=[];if(!r)return p;for(let g of r)for(let b of g){let w=[b.x+u[0],b.y+u[1]];Vl(w,e,i,a),p.push(w)}return p}function Zo(r,e,i,s){let a=Math.pow(2,s.z)*Ba,u=[s.x*Ba,s.y*Ba],p=[];if(!r)return p;for(let b of r){let w=[];for(let A of b){let k=[A.x+u[0],A.y+u[1]];Ra(e,k),w.push(k)}p.push(w)}if(e[2]-e[0]<=a/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(let b of p)for(let w of b)Vl(w,e,i,a)}var g;return p}class il{constructor(e,i){this.type=ir,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ss(e[1])){let s=e[1];if(s.type==="FeatureCollection")for(let a=0;a<s.features.length;++a){let u=s.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new il(s,s.features[a].geometry)}else if(s.type==="Feature"){let a=s.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new il(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new il(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,s){let a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){let g=jl(s.coordinates,u,p),b=ed(i.geometry(),a,u,p);if(!Ho(a,u))return!1;for(let w of b)if(!Do(w,g))return!1}if(s.type==="MultiPolygon"){let g=iu(s.coordinates,u,p),b=ed(i.geometry(),a,u,p);if(!Ho(a,u))return!1;for(let w of b)if(!Vd(w,g))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,s){let a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){let g=jl(s.coordinates,u,p),b=Zo(i.geometry(),a,u,p);if(!Ho(a,u))return!1;for(let w of b)if(!Fa(w,g))return!1}if(s.type==="MultiPolygon"){let g=iu(s.coordinates,u,p),b=Zo(i.geometry(),a,u,p);if(!Ho(a,u))return!1;for(let w of b)if(!$s(w,g))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let ma={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},td=1/298.257223563,Na=td*(2-td),rl=Math.PI/180;class nl{static fromTile(e,i,s){let a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),u=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/rl;return new nl(u,s)}static get units(){return ma}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!ma[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(ma).join(", ")}`);let s=6378.137*rl*(i?ma[i]:1),a=Math.cos(e*rl),u=1/(1-Na*(1-a*a)),p=Math.sqrt(u);this.kx=s*p*a,this.ky=s*p*u*(1-Na)}distance(e,i){let s=Bo(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+a*a)}bearing(e,i){let s=Bo(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/rl}destination(e,i,s){let a=s*rl;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){let a=e[s];for(let u=0,p=a.length,g=p-1;u<p;g=u++)i+=Bo(a[u][0]-a[g][0])*(a[u][1]+a[g][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){let u=e[a],p=e[a+1],g=this.distance(u,p);if(s+=g,s>i)return as(u,p,(i-(s-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[a,u]=i,p=Bo(s[0]-a)*this.kx,g=(s[1]-u)*this.ky;if(p!==0||g!==0){let b=(Bo(e[0]-a)*this.kx*p+(e[1]-u)*this.ky*g)/(p*p+g*g);b>1?(a=s[0],u=s[1]):b>0&&(a+=p/this.kx*b,u+=g/this.ky*b)}return p=Bo(e[0]-a)*this.kx,g=(e[1]-u)*this.ky,Math.sqrt(p*p+g*g)}pointOnLine(e,i){let s=1/0,a=e[0][0],u=e[0][1],p=0,g=0;for(let b=0;b<e.length-1;b++){let w=e[b][0],A=e[b][1],k=Bo(e[b+1][0]-w)*this.kx,I=(e[b+1][1]-A)*this.ky,D=0;k===0&&I===0||(D=(Bo(i[0]-w)*this.kx*k+(i[1]-A)*this.ky*I)/(k*k+I*I),D>1?(w=e[b+1][0],A=e[b+1][1]):D>0&&(w+=k/this.kx*D,A+=I/this.ky*D)),k=Bo(i[0]-w)*this.kx,I=(i[1]-A)*this.ky;let B=k*k+I*I;B<s&&(s=B,a=w,u=A,p=b,g=D)}return{point:[a,u],index:p,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,s){let a=this.pointOnLine(s,e),u=this.pointOnLine(s,i);if(a.index>u.index||a.index===u.index&&a.t>u.t){let w=a;a=u,u=w}let p=[a.point],g=a.index+1,b=u.index;!id(s[g],p[0])&&g<=b&&p.push(s[g]);for(let w=g+1;w<=b;w++)p.push(s[w]);return id(s[b],u.point)||p.push(u.point),p}lineSliceAlong(e,i,s){let a=0,u=[];for(let p=0;p<s.length-1;p++){let g=s[p],b=s[p+1],w=this.distance(g,b);if(a+=w,a>e&&u.length===0&&u.push(as(g,b,(e-(a-w))/w)),a>=i)return u.push(as(g,b,(i-(a-w))/w)),u;a>e&&u.push(b)}return u}bufferPoint(e,i){let s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[0]+a,e[1]+s]}bufferBBox(e,i){let s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[2]+a,e[3]+s]}insideBBox(e,i){return Bo(e[0]-i[0])>=0&&Bo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function id(r,e){return r[0]===e[0]&&r[1]===e[1]}function as(r,e,i){let s=Bo(e[0]-r[0]);return[r[0]+s*i,r[1]+(e[1]-r[1])*i]}function Bo(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class bc{constructor(e=[],i=((s,a)=>s<a?-1:s>a?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:i,compare:s}=this,a=i[e];for(;e>0;){let u=e-1>>1,p=i[u];if(s(a,p)>=0)break;i[e]=p,e=u}i[e]=a}_down(e){let{data:i,compare:s}=this,a=this.length>>1,u=i[e];for(;e<a;){let p=1+(e<<1),g=p+1;if(g<this.length&&s(i[g],i[p])<0&&(p=g),s(i[p],u)>=0)break;i[e]=i[p],e=p}i[e]=u}}var ht=8192;function rd(r,e){return e.dist-r.dist}let ga=100,Xs=50;function Ul(r){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function ql(r){return r[1]-r[0]+1}function Ys(r,e){let i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function wc(r,e){if(r[0]>r[1])return[null,null];let i=ql(r);if(e){if(i===2)return[r,null];let s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(i===1)return[r,null];let s=Math.floor(i/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function $o(r,e){let i=[1/0,1/0,-1/0,-1/0];if(!Ys(e,r.length))return i;for(let s=e[0];s<=e[1];++s)Ra(i,r[s]);return i}function Pi(r){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let s=0;s<r[i].length;++s)Ra(e,r[i][s]);return e}function ol(r,e,i){if(Ul(r)||Ul(e))return NaN;let s=0,a=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(a=r[1]-e[3]),r[3]<e[1]&&(a=e[1]-r[3]),i.distance([0,0],[s,a])}function qd(r){return 360*r-180}function zp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Sc(r,e){let i=Math.pow(2,e.z),s=(r.y/ht+e.y)/i;return[qd((r.x/ht+e.x)/i),zp(s)]}function Wd(r,e){let i=[];for(let s=0;s<r.length;++s)i.push(Sc(r[s],e));return i}function Xr(r,e,i){let s=i.pointOnLine(e,r).point;return i.distance(r,s)}function m(r,e,i,s,a){let u=i.slice(s[0],s[1]+1),p=1/0;for(let g=e[0];g<=e[1];++g)if((p=Math.min(p,Xr(r[g],u,a)))===0)return 0;return p}function C(r,e,i,s,a){let u=Math.min(a.pointToSegmentDistance(r,i,s),a.pointToSegmentDistance(e,i,s)),p=Math.min(a.pointToSegmentDistance(i,r,e),a.pointToSegmentDistance(s,r,e));return Math.min(u,p)}function z(r,e,i,s,a){if(!Ys(e,r.length)||!Ys(s,i.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let g=s[0];g<s[1];++g){if(tu(r[p],r[p+1],i[g],i[g+1]))return 0;u=Math.min(u,C(r[p],r[p+1],i[g],i[g+1],a))}return u}function U(r,e,i,s,a){if(!Ys(e,r.length)||!Ys(s,i.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let g=s[0];g<=s[1];++g)if((u=Math.min(u,a.distance(r[p],i[g])))===0)return u;return u}function Q(r,e,i){if(Do(r,e,!0))return 0;let s=1/0;for(let a of e){let u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&(s=Math.min(s,i.pointToSegmentDistance(r,a[u-1],a[0])))===0||(s=Math.min(s,Xr(r,a,i)))===0)return s}return s}function fe(r,e,i,s){if(!Ys(e,r.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Do(r[u],i,!0))return 0;let a=1/0;for(let u=e[0];u<e[1];++u)for(let p of i)for(let g=0,b=p.length,w=b-1;g<b;w=g++){if(tu(r[u],r[u+1],p[w],p[g]))return 0;a=Math.min(a,C(r[u],r[u+1],p[w],p[g],s))}return a}function Ve(r,e){for(let i of r)for(let s=0;s<=i.length-1;++s)if(Do(i[s],e,!0))return!0;return!1}function ut(r,e,i,s=1/0){let a=Pi(r),u=Pi(e);if(s!==1/0&&ol(a,u,i)>=s)return s;if(Ho(a,u)){if(Ve(r,e))return 0}else if(Ve(e,r))return 0;let p=s;for(let g of r)for(let b=0,w=g.length,A=w-1;b<w;A=b++)for(let k of e)for(let I=0,D=k.length,B=D-1;I<D;B=I++){if(tu(g[A],g[b],k[B],k[I]))return 0;p=Math.min(p,C(g[A],g[b],k[B],k[I],i))}return p}function wt(r,e,i,s,a,u,p){if(u===null||p===null)return;let g=ol($o(s,u),$o(a,p),i);g<e&&r.push({dist:g,range1:u,range2:p})}function Ut(r,e,i,s,a=1/0){let u=Math.min(s.distance(r[0],i[0][0]),a);if(u===0)return u;let p=new bc([{dist:0,range1:[0,r.length-1],range2:[0,0]}],rd),g=e?Xs:ga,b=Pi(i);for(;p.length;){let w=p.pop();if(w.dist>=u)continue;let A=w.range1;if(ql(A)<=g){if(!Ys(A,r.length))return NaN;if(e){let k=fe(r,A,i,s);if((u=Math.min(u,k))===0)return u}else for(let k=A[0];k<=A[1];++k){let I=Q(r[k],i,s);if((u=Math.min(u,I))===0)return u}}else{let k=wc(A,e);if(k[0]!==null){let I=ol($o(r,k[0]),b,s);I<u&&p.push({dist:I,range1:k[0],range2:[0,0]})}if(k[1]!==null){let I=ol($o(r,k[1]),b,s);I<u&&p.push({dist:I,range1:k[1],range2:[0,0]})}}}return u}function fi(r,e,i,s,a,u=1/0){let p=Math.min(u,a.distance(r[0],i[0]));if(p===0)return p;let g=new bc([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],rd),b=e?Xs:ga,w=s?Xs:ga;for(;g.length;){let A=g.pop();if(A.dist>=p)continue;let k=A.range1,I=A.range2;if(ql(k)<=b&&ql(I)<=w){if(!Ys(k,r.length)||!Ys(I,i.length))return NaN;if(e&&s?p=Math.min(p,z(r,k,i,I,a)):e||s?e&&!s?p=Math.min(p,m(i,I,r,k,a)):!e&&s&&(p=Math.min(p,m(r,k,i,I,a))):p=Math.min(p,U(r,k,i,I,a)),p===0)return p}else{let D=wc(k,e),B=wc(I,s);wt(g,p,a,r,i,D[0],B[0]),wt(g,p,a,r,i,D[0],B[1]),wt(g,p,a,r,i,D[1],B[0]),wt(g,p,a,r,i,D[1],B[1])}}return p}function Vi(r,e,i,s,a=1/0){let u=a,p=$o(r,[0,r.length-1]);for(let g of i)if(!(u!==1/0&&ol(p,$o(g,[0,g.length-1]),s)>=u)&&(u=Math.min(u,fi(r,e,g,!0,s,u)),u===0))return u;return u}function vr(r,e,i,s,a=1/0){let u=a,p=$o(r,[0,r.length-1]);for(let g of i){if(u!==1/0&&ol(p,Pi(g),s)>=u)continue;let b=Ut(r,e,g,s,u);if(isNaN(b))return b;if((u=Math.min(u,b))===0)return u}return u}function lo(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class In{constructor(e,i){this.type=Gt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ss(e[1])){let s=e[1];if(s.type==="FeatureCollection"){for(let a=0;a<s.features.length;++a)if(lo(s.features[a].geometry.type))return new In(s,s.features[a].geometry)}else if(s.type==="Feature"){if(lo(s.geometry.type))return new In(s,s.geometry)}else if(lo(s.type))return new In(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return(function(a,u,p){let g=[];for(let w of a)for(let A of w)g.push(Sc(A,u));let b=new nl(g[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?fi(g,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?Vi(g,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?vr(g,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null})(i,s,this.geometries);if(e.geometryType()==="LineString")return(function(a,u,p){let g=[];for(let w of a){let A=[];for(let k of w)A.push(Sc(k,u));g.push(A)}let b=new nl(g[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Vi(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,b);if(p.type==="MultiLineString"){let w=1/0;for(let A=0;A<p.coordinates.length;A++){let k=Vi(p.coordinates[A],!0,g,b,w);if(isNaN(k))return k;if((w=Math.min(w,k))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let A=0;A<g.length;A++){let k=vr(g[A],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,w);if(isNaN(k))return k;if((w=Math.min(w,k))===0)return w}return w}return null})(i,s,this.geometries);if(e.geometryType()==="Polygon")return(function(a,u,p){let g=[];for(let w of(function(A,k){let I=A.length;if(I<=1)return[A];let D=[],B,V;for(let W=0;W<I;W++){let H=Ju(A[W]);H!==0&&(A[W].area=Math.abs(H),V===void 0&&(V=H<0),V===H<0?(B&&D.push(B),B=[A[W]]):B.push(A[W]))}return B&&D.push(B),D})(a)){let A=[];for(let k=0;k<w.length;++k)A.push(Wd(w[k],u));g.push(A)}let b=new nl(g[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return vr(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",g,b);if(p.type==="MultiLineString"){let w=1/0;for(let A=0;A<p.coordinates.length;A++){let k=vr(p.coordinates[A],!0,g,b,w);if(isNaN(k))return k;if((w=Math.min(w,k))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?(function(w,A,k){let I=1/0;for(let D of w)for(let B of A){let V=ut(D,B,k,I);if(isNaN(V))return V;if((I=Math.min(I,V))===0)return I}return I})(p.type==="Polygon"?[p.coordinates]:p.coordinates,g,b):null})(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function co(r){if(r instanceof ao&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof il||r instanceof In)return!1;if(r instanceof sl)return r.featureConstant;let e=!0;return r.eachChild((i=>{e&&!co(i)&&(e=!1)})),e}function eo(r){if(r instanceof ao&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!eo(i)&&(e=!1)})),e}function Cs(r,e){if(r instanceof ao&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((s=>{i&&!Cs(s,e)&&(i=!1)})),i}function Gd(r,e,i){return[r,e,i].filter(Boolean).join("")}function nd(r,e){switch(r){case"string":return Jn(e);case"number":return+e;case"boolean":return!!e;case"color":return cr.parse(e);case"formatted":return jn.fromString(Jn(e));case"resolvedImage":return Io.build(Jn(e))}return e}function Hd(r,e,i,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class sl{constructor(e,i,s,a=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=a}static parse(e,i){let s=i.expectedType;if(s==null&&(s=ur),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let a=i.parse(e[1],1);if(!(a instanceof pa))return i.error("Key name of 'config' expression must be a string literal.");let u,p=!0,g=Jn(a.value);if(e.length>=3){let b=i.parse(e[2],2);if(!(b instanceof pa))return i.error("Scope of 'config' expression must be a string literal.");u=Jn(b.value)}if(i.options){let b=Gd(g,u,i._scope),w=i.options.get(b);w&&(p=co(w.value||w.default))}return new sl(s,g,u,p)}evaluate(e){let i=Gd(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;let{type:a,value:u,values:p,minValue:g,maxValue:b,stepValue:w}=s,A=s.default.evaluate(e),k=A;if(u){let I=e.scope;e.scope=(I||"").split("").slice(1).join(""),k=u.evaluate(e),e.scope=I}return a&&(k=nd(a,k)),k===void 0||g===void 0&&b===void 0&&w===void 0||(typeof k=="number"?k=Hd(k,g,b,w):Array.isArray(k)&&(k=k.map((I=>typeof I=="number"?Hd(I,g,b,w):I)))),u!==void 0&&k!==void 0&&p&&!p.includes(k)&&(k=A,a&&(k=nd(a,k))),(a&&a!==this.type||k!==void 0&&!Bl(On(k),this.type))&&(k=nd(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class ru{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let s=e[1];return i.scope.has(s)?new ru(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tc{constructor(e,i=[],s,a=new os,u=[],p,g,b){this.registry=e,this.path=i,this.key=i.map((w=>typeof w=="string"?`['${w}']`:`[${w}]`)).join(""),this.scope=a,this.errors=u,this.expectedType=s,this._scope=p,this.options=g,this.iconImageUseTheme=b}parse(e,i,s,a,u={}){return i||s?this.concat(i,null,s,a)._parse(e,u):this._parse(e,u)}parseObjectValue(e,i,s,a,u,p={}){return this.concat(i,s,a,u)._parse(e,p)}_parse(e,i){function s(a,u,p){return p==="assert"?new Rt(u,[a]):p==="coerce"?new Qn(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let u=a.parse(e,this);if(!u)return null;if(this.expectedType){let p=this.expectedType,g=u.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||g.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(p,g))return null}else u=s(u,p,i.typeAnnotation||"coerce");else u=s(u,p,i.typeAnnotation||"assert")}if(!(u instanceof pa)&&u.type.kind!=="resolvedImage"&&Dn(u)){let p=new En(this._scope,this.options,this.iconImageUseTheme);try{u=new pa(u.type,u.evaluate(p))}catch(g){return this.error(g.message),null}}return u}return Qn.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,a){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof i=="string"?u.concat(i):u;let p=a?this.scope.concat(a):this.scope;return new Tc(this.registry,u,s||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){let s=`${this.key}${i.map((a=>`[${a}]`)).join("")}`;this.errors.push(new Oo(s,e))}checkSubtype(e,i){let s=Dl(e,i);return s&&this.error(s),s}}function Dn(r){if(r instanceof ru)return Dn(r.boundExpression);if(r instanceof ao&&r.name==="error"||r instanceof fa||r instanceof il||r instanceof In||r instanceof sl)return!1;let e=r instanceof Qn||r instanceof Rt,i=!0;return r.eachChild((s=>{i=e?i&&Dn(s):i&&s instanceof pa})),!!i&&co(r)&&Cs(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function al(r,e){let i=r.length-1,s,a,u=0,p=i,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),s=r[g],a=r[g+1],s<=e){if(g===i||e<a)return g;u=g+1}else{if(!(s>e))throw new $r("Input is not a number.");p=g-1}return 0}class Cc{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[a,u]of s)this.labels.push(a),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let s=i.parse(e[1],1,Gt);if(!s)return null;let a=[],u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let p=1;p<e.length;p+=2){let g=p===1?-1/0:e[p],b=e[p+1],w=p,A=p+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(a.length&&a[a.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let k=i.parse(b,A,u);if(!k)return null;u=u||k.type,a.push([g,k])}return new Cc(u,s,a)}evaluate(e){let i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);let a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);let u=i.length;return a>=i[u-1]?s[u-1].evaluate(e):s[al(i,a)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}let Zd=.95047,$d=1.08883,nu=4/29,ll=6/29,ou=3*ll*ll,$y=ll*ll*ll,Xm=Math.PI/180,Xy=180/Math.PI;function Mp(r){return r>$y?Math.pow(r,1/3):r/ou+nu}function Op(r){return r>ll?r*r*r:ou*(r-nu)}function Xd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Yd(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ec(r){let e=Yd(r.r),i=Yd(r.g),s=Yd(r.b),a=Mp((.4124564*e+.3575761*i+.1804375*s)/Zd),u=Mp((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-Mp((.0193339*e+.119192*i+.9503041*s)/$d)),alpha:r.a}}function Rp(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*Op(e),i=Zd*Op(i),s=$d*Op(s),new cr(Xd(3.2404542*i-1.5371385*e-.4985314*s),Xd(-.969266*i+1.8760108*e+.041556*s),Xd(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function Ym(r,e,i){let s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}let od={forward:Ec,reverse:Rp,interpolate:function(r,e,i){return{l:$t(r.l,e.l,i),a:$t(r.a,e.a,i),b:$t(r.b,e.b,i),alpha:$t(r.alpha,e.alpha,i)}}},Ac={forward:function(r){let{l:e,a:i,b:s}=Ec(r),a=Math.atan2(s,i)*Xy;return{h:a<0?a+360:a,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){let e=r.h*Xm,i=r.c;return Rp({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Ym(r.h,e.h,i),c:$t(r.c,e.c,i),l:$t(r.l,e.l,i),alpha:$t(r.alpha,e.alpha,i)}}};var Kd=Object.freeze({__proto__:null,hcl:Ac,lab:od});class Es{constructor(e,i,s,a,u){this.type=e,this.operator=i,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(let[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,i,s,a){let u=0;if(e.name==="exponential")u=Dp(i,e.base,s,a);else if(e.name==="linear")u=Dp(i,1,s,a);else if(e.name==="cubic-bezier"){let p=e.controlPoints;u=new Al(p[0],p[1],p[2],p[3]).solve(Dp(i,1,s,a))}return u}static parse(e,i){let[s,a,u,...p]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){let w=a[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:w}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{let w=a.slice(1);if(w.length!==4||w.some((A=>typeof A!="number"||A<0||A>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,Gt),!u)return null;let g=[],b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=xo:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let w=0;w<p.length;w+=2){let A=p[w],k=p[w+1],I=w+3,D=w+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);let B=i.parse(k,D,b);if(!B)return null;b=b||B.type,g.push([A,B])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Es(b,s,a,u,g):i.error(`Type ${fn(b)} is not interpolatable.`)}evaluate(e){let i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);let a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);let u=i.length;if(a>=i[u-1])return s[u-1].evaluate(e);let p=al(i,a),g=Es.interpolationFactor(this.interpolation,a,i[p],i[p+1]),b=s[p].evaluate(e),w=s[p+1].evaluate(e);return this.operator==="interpolate"?Ws[this.type.kind.toLowerCase()](b,w,g):this.operator==="interpolate-hcl"?Ac.reverse(Ac.interpolate(Ac.forward(b),Ac.forward(w),g)):od.reverse(od.interpolate(od.forward(b),od.forward(w),g))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function Dp(r,e,i,s){let a=s-i,u=r-i;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class sd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null,a=i.expectedType;a&&a.kind!=="value"&&(s=a);let u=[];for(let g of e.slice(1)){let b=i.parse(g,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,u.push(b)}let p=a&&u.some((g=>Dl(a,g.type)));return new sd(p?ur:s,u)}evaluate(e){let i,s=null,a=0;for(let u of this.args){if(a++,s=u.evaluate(e),s&&s instanceof Io&&!s.available&&(i||(i=s),s=null,a===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){let e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class ad{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let s=[];for(let u=1;u<e.length-1;u+=2){let p=e[u];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);let g=i.parse(e[u+1],u+1);if(!g)return null;s.push([p,g])}let a=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return a?new ad(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Bp{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,Gt),a=i.parse(e[2],2,qn(i.expectedType||ur));return s&&a?new Bp(a.type.itemType,s,a):null}evaluate(e){let i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new $r("Array index out of bounds: negative index");if(i>=s.length)throw new $r("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new $r("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fp{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,Gt),a=i.parse(e[2],2,qn(i.expectedType||ur));return s&&a?new Fp(a.type.itemType,s,a):null}evaluate(e){let i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new $r(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new $r(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];let a=Math.floor(i),u=Math.ceil(i),p=s[a],g=s[u];if(typeof p!="number"||typeof g!="number")throw new $r(`Cannot interpolate between non-number values at index ${i}.`);let b=i-a;return p*(1-b)+g*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Np{constructor(e,i){this.type=ir,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,ur),a=i.parse(e[2],2,ur);return s&&a?Jc(s.type,[ir,Zi,Gt,tl,ur])?new Np(s,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${fn(s.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!gc(i,["boolean","string","number","null"]))throw new $r(`Expected first argument to be of type boolean, string, number or null, but found ${fn(On(i))} instead.`);if(!gc(s,["string","array"]))throw new $r(`Expected second argument to be of type array or string, but found ${fn(On(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ld{constructor(e,i,s){this.type=Gt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,ur),a=i.parse(e[2],2,ur);if(!s||!a)return null;if(!Jc(s.type,[ir,Zi,Gt,tl,ur]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${fn(s.type)} instead`);if(e.length===4){let u=i.parse(e[3],3,Gt);return u?new ld(s,a,u):null}return new ld(s,a)}evaluate(e){let i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!gc(i,["boolean","string","number","null"]))throw new $r(`Expected first argument to be of type boolean, string, number or null, but found ${fn(On(i))} instead.`);if(!gc(s,["string","array"]))throw new $r(`Expected second argument to be of type array or string, but found ${fn(On(s))} instead.`);if(this.fromIndex){let a=this.fromIndex.evaluate(e);return s.indexOf(i,a)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Jd{constructor(e,i,s,a,u,p){this.inputType=e,this.type=i,this.input=s,this.cases=a,this.outputs=u,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let u={},p=[];for(let w=2;w<e.length-1;w+=2){let A=e[w],k=e[w+1];Array.isArray(A)||(A=[A]);let I=i.concat(w);if(A.length===0)return I.error("Expected at least one branch label.");for(let B of A){if(typeof B!="number"&&typeof B!="string")return I.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,On(B)))return null}else s=On(B);if(u[String(B)]!==void 0)return I.error("Branch labels must be unique.");u[String(B)]=p.length}let D=i.parse(k,w,a);if(!D)return null;a=a||D.type,p.push(D)}let g=i.parse(e[1],1,ur);if(!g)return null;let b=i.parse(e[e.length-1],e.length-1,a);return b?g.type.kind!=="value"&&i.concat(1).checkSubtype(s,g.type)?null:new Jd(s,a,g,u,p,b):null}evaluate(e){let i=this.input.evaluate(e);return(Bl(On(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],a={};for(let p of i){let g=a[this.cases[p]];g===void 0?(a[this.cases[p]]=s.length,s.push([this.cases[p],[p]])):s[g][1].push(p)}let u=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,g]of s)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class su{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);let a=[];for(let p=1;p<e.length-1;p+=2){let g=i.parse(e[p],p,ir);if(!g)return null;let b=i.parse(e[p+1],p+1,s);if(!b)return null;a.push([g,b]),s=s||b.type}let u=i.parse(e[e.length-1],e.length-1,s);return u?new su(s,a,u):null}evaluate(e){for(let[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Qd{constructor(e,i,s,a){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,ur),a=i.parse(e[2],2,Gt);if(!s||!a)return null;if(!Jc(s.type,[qn(ur),Zi,ur]))return i.error(`Expected first argument to be of type array or string, but found ${fn(s.type)} instead`);if(e.length===4){let u=i.parse(e[3],3,Gt);return u?new Qd(s.type,s,a,u):null}return new Qd(s.type,s,a)}evaluate(e){let i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!gc(i,["string","array"]))throw new $r(`Expected first argument to be of type array or string, but found ${fn(On(i))} instead.`);if(this.endIndex){let a=this.endIndex.evaluate(e);return i.slice(s,a)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class eh{constructor(e,i){this.type=qn(Zi),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=i.parse(e[1],1,Zi),a=i.parse(e[2],2,Zi);return s&&a?new eh(s,a):void 0}evaluate(e){let i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Km(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jm(r,e,i,s){return s.compare(e,i)===0}function au(r,e,i){let s=r!=="=="&&r!=="!=";return class wO{constructor(u,p,g){this.type=ir,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");let g=u[0],b=p.parse(u[1],1,ur);if(!b)return null;if(!Km(g,b.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${fn(b.type)}'.`);let w=p.parse(u[2],2,ur);if(!w)return null;if(!Km(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${fn(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${fn(b.type)}' and '${fn(w.type)}'.`);s&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new Rt(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new Rt(b.type,[w])));let A=null;if(u.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(A=p.parse(u[3],3,Rl),!A)return null}return new wO(b,w,A)}evaluate(u){let p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){let b=On(p),w=On(g);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new $r(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){let b=On(p),w=On(g);if(b.kind!=="string"||w.kind!=="string")return e(u,p,g)}return this.collator?i(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[r];return this.eachChild((p=>{u.push(p.serialize())})),u}}}let Qm=au("==",(function(r,e,i){return e===i}),Jm),eg=au("!=",(function(r,e,i){return e!==i}),(function(r,e,i,s){return!Jm(0,e,i,s)})),Yy=au("<",(function(r,e,i){return e<i}),(function(r,e,i,s){return s.compare(e,i)<0})),Ky=au(">",(function(r,e,i){return e>i}),(function(r,e,i,s){return s.compare(e,i)>0})),Jy=au("<=",(function(r,e,i){return e<=i}),(function(r,e,i,s){return s.compare(e,i)<=0})),th=au(">=",(function(r,e,i){return e>=i}),(function(r,e,i,s){return s.compare(e,i)>=0}));class jp{constructor(e,i,s,a,u,p){this.type=Zi,this.number=e,this.locale=i,this.currency=s,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let s=i.parse(e[1],1,Gt);if(!s)return null;let a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=i.parseObjectValue(a.locale,2,"locale",Zi),!u))return null;let p=null;if(a.currency&&(p=i.parseObjectValue(a.currency,2,"currency",Zi),!p))return null;let g=null;if(a.unit&&(g=i.parseObjectValue(a.unit,2,"unit",Zi),!g))return null;let b=null;if(a["min-fraction-digits"]&&(b=i.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",Gt),!b))return null;let w=null;return a["max-fraction-digits"]&&(w=i.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",Gt),!w)?null:new jp(s,u,p,g,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Vp{constructor(e){this.type=Gt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${fn(s.type)} instead.`):new Vp(s):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new $r(`Expected value to be of type string or array, but found ${fn(On(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function tg(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let lu={"==":Qm,"!=":eg,">":Ky,"<":Yy,">=":th,"<=":Jy,array:Rt,at:Bp,"at-interpolated":Fp,boolean:Rt,case:su,coalesce:sd,collator:fa,format:Oa,image:ni,in:Np,"index-of":ld,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:Vp,let:ad,literal:pa,match:Jd,number:Rt,"number-format":jp,object:Rt,slice:Qd,step:Cc,string:Rt,"to-boolean":Qn,"to-color":Qn,"to-number":Qn,"to-string":Qn,var:ru,within:il,distance:In,config:sl,split:eh};function Up(r,[e,i,s,a]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);let u=a?a.evaluate(r):1,p=Ro(e,i,s,u);if(p)throw new $r(p);return new cr(e/255,i/255,s/255,u)}function ig(r,[e,i,s,a]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);let u=a?a.evaluate(r):1,p=(function(w,A,k,I){return typeof w=="number"&&w>=0&&w<=360?typeof A=="number"&&A>=0&&A<=100&&typeof k=="number"&&k>=0&&k<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[w,A,k,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[w,A,k,I]:[w,A,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[w,A,k,I]:[w,A,k]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,s,u);if(p)throw new $r(p);let g=`hsla(${e}, ${i}%, ${s}%, ${u})`,b=cr.parse(g);if(!b)throw new $r(`Failed to parse HSLA color: ${g}`);return b}function rg(r,e){return r in e}function ih(r,e){let i=e[r];return i===void 0?null:i}function cl(r){return{type:r}}function cd(r){if(r instanceof sl)return new Set([r.key]);let e=new Set;return r.eachChild((i=>{e=new Set([...e,...cd(i)])})),e}function rh(r){if(r instanceof ao&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild((i=>{!e&&rh(i)&&(e=!0)})),e}function kc(r){return{result:"success",value:r}}function Wl(r){return{result:"error",value:r}}function qp(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function nh(r){return r["property-type"]==="data-driven"}function Wp(r){return qp(r.expression,"measure-light")}function Gp(r){return qp(r.expression,"zoom")}function oh(r){return!!r.expression&&r.expression.interpolated}function sh(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Hp(r){return r}function ah(r,e){let i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",a=s||!(s||r.property!==void 0),u=r.type||(oh(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((w=>[w[0],cr.parse(w[1])]))),r.default=cr.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Kd[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let p,g,b;if(u==="exponential")p=ng;else if(u==="interval")p=Gl;else if(u==="categorical"){p=Qy,g=Object.create(null);for(let w of r.stops)g[w[0]]=w[1];b=typeof r.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=ev}if(s){let w={},A=[];for(let D=0;D<r.stops.length;D++){let B=r.stops[D],V=B[0].zoom;w[V]===void 0&&(w[V]={zoom:V,type:r.type,property:r.property,default:r.default,stops:[]},A.push(V)),w[V].stops.push([B[0].value,B[1]])}let k=[];for(let D of A)k.push([w[D].zoom,ah(w[D],e)]);let I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Es.interpolationFactor.bind(void 0,I),zoomStops:k.map((D=>D[0])),evaluate:({zoom:D},B)=>ng({stops:k,base:r.base},e,D).evaluate(D,B)}}if(a){let w=u==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Es.interpolationFactor.bind(void 0,w),zoomStops:r.stops.map((A=>A[0])),evaluate:({zoom:A})=>p(r,e,A,g,b)}}return{kind:"source",evaluate(w,A){let k=A&&A.properties?A.properties[r.property]:void 0;return k===void 0?cu(r.default,e.default):p(r,e,k,g,b)}}}function cu(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Qy(r,e,i,s,a){return cu(typeof i===a?s[i]:void 0,r.default,e.default)}function Gl(r,e,i){if(!vc(i))return cu(r.default,e.default);let s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];let a=al(r.stops.map((u=>u[0])),i);return r.stops[a][1]}function ng(r,e,i){let s=r.base!==void 0?r.base:1;if(!vc(i))return cu(r.default,e.default);let a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];let u=al(r.stops.map((A=>A[0])),i),p=(function(A,k,I,D){let B=D-I,V=A-I;return B===0?0:k===1?V/B:(Math.pow(k,V)-1)/(Math.pow(k,B)-1)})(i,s,r.stops[u][0],r.stops[u+1][0]),g=r.stops[u][1],b=r.stops[u+1][1],w=Ws[e.type]||Hp;if(r.colorSpace&&r.colorSpace!=="rgb"){let A=Kd[r.colorSpace];w=(k,I)=>A.reverse(A.interpolate(A.forward(k),A.forward(I),p))}return typeof g.evaluate=="function"?{evaluate(...A){let k=g.evaluate.apply(void 0,A),I=b.evaluate.apply(void 0,A);if(k!==void 0&&I!==void 0)return w(k,I,p)}}:w(g,b,p)}function ev(r,e,i){return e.type==="color"?i=cr.parse(i):e.type==="formatted"?i=jn.fromString(i.toString()):e.type==="resolvedImage"?i=Io.build(i.toString()):Fl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),cu(i,r.default,e.default)}ao.register(lu,{error:[{kind:"error"},[Zi],(r,[e])=>{throw new $r(e.evaluate(r))}],typeof:[Zi,[ur],(r,[e])=>fn(On(e.evaluate(r)))],"to-rgba":[qn(Gt,4),[xo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[qn(Gt,4),[xo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[xo,[Gt,Gt,Gt],Up],rgba:[xo,[Gt,Gt,Gt,Gt],Up],hsl:[xo,[Gt,Gt,Gt],ig],hsla:[xo,[Gt,Gt,Gt,Gt],ig],has:{type:ir,overloads:[[[Zi],(r,[e])=>rg(e.evaluate(r),r.properties())],[[Zi,Ol],(r,[e,i])=>rg(e.evaluate(r),i.evaluate(r))]]},get:{type:ur,overloads:[[[Zi],(r,[e])=>ih(e.evaluate(r),r.properties())],[[Zi,Ol],(r,[e,i])=>ih(e.evaluate(r),i.evaluate(r))]]},"feature-state":[ur,[Zi],(r,[e])=>ih(e.evaluate(r),r.featureState||{})],properties:[Ol,[],r=>r.properties()],"geometry-type":[Zi,[],r=>r.geometryType()],worldview:[Zi,[],r=>r.globals.worldview||""],"is-active-floor":[ir,cl(Zi),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;let i=r.globals.activeFloors;return e.some((s=>{let a=s.evaluate(r);return i.has(a)}))}],id:[ur,[],r=>r.id()],zoom:[Gt,[],r=>r.globals.zoom],pitch:[Gt,[],r=>r.globals.pitch||0],"distance-from-center":[Gt,[],r=>r.distanceFromCenter()],"measure-light":[Gt,[Zi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Gt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Gt,[],r=>r.globals.lineProgress||0],"raster-value":[Gt,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Gt,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Gt,[],r=>r.globals.skyRadialProgress||0],accumulated:[ur,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Gt,cl(Gt),(r,e)=>{let i=0;for(let s of e)i+=s.evaluate(r);return i}],"*":[Gt,cl(Gt),(r,e)=>{let i=1;for(let s of e)i*=s.evaluate(r);return i}],"-":{type:Gt,overloads:[[[Gt,Gt],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Gt],(r,[e])=>-e.evaluate(r)]]},"/":[Gt,[Gt,Gt],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Gt,[Gt,Gt],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Gt,[Gt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Gt,[Gt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Gt,[Gt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Gt,[Gt],(r,[e])=>Math.log2(e.evaluate(r))],sin:[Gt,[Gt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Gt,[Gt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Gt,[Gt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Gt,[Gt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Gt,[Gt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Gt,[Gt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Gt,cl(Gt),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[Gt,cl(Gt),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[Gt,[Gt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Gt,[Gt],(r,[e])=>{let i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Gt,[Gt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Gt,[Gt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ir,[Zi,ur],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[ir,[ur],(r,[e])=>r.id()===e.value],"filter-type-==":[ir,[Zi],(r,[e])=>r.geometryType()===e.value],"filter-<":[ir,[Zi,ur],(r,[e,i])=>{let s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s<a}],"filter-id-<":[ir,[ur],(r,[e])=>{let i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[ir,[Zi,ur],(r,[e,i])=>{let s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s>a}],"filter-id->":[ir,[ur],(r,[e])=>{let i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[ir,[Zi,ur],(r,[e,i])=>{let s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[ir,[ur],(r,[e])=>{let i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[ir,[Zi,ur],(r,[e,i])=>{let s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[ir,[ur],(r,[e])=>{let i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[ir,[ur],(r,[e])=>e.value in r.properties()],"filter-has-id":[ir,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ir,[qn(Zi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ir,[qn(ur)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ir,[Zi,qn(ur)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ir,[Zi,qn(ur)],(r,[e,i])=>(function(s,a,u,p){for(;u<=p;){let g=u+p>>1;if(a[g]===s)return!0;a[g]>s?p=g-1:u=g+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ir,overloads:[[[ir,ir],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[cl(ir),(r,e)=>{for(let i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:ir,overloads:[[[ir,ir],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[cl(ir),(r,e)=>{for(let i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[ir,[ir],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ir,[Zi],(r,[e])=>{let i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Zi,[Zi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Zi,[Zi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Zi,cl(ur),(r,e)=>e.map((i=>Jn(i.evaluate(r)))).join("")],"resolved-locale":[Zi,[Rl],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Gt,[Gt,Gt,ur],(r,e)=>{let[i,s,a]=e.map((p=>p.evaluate(r)));if(i>s||i===s)return i;let u;if(typeof a=="string")u=(function(p){let g=0;if(p.length===0)return g;for(let b=0;b<p.length;b++)g=(g<<5)-g+p.charCodeAt(b),g|=0;return g})(a);else{if(typeof a!="number")throw new $r(`Invalid seed input: ${a}`);u=a}return i+tg(u)()*(s-i)}]});class lh{constructor(e,i,s,a,u){this.expression=e,this._warningHistory={},this._scope=s,this._options=a,this._iconImageUseTheme=u,this._evaluator=new En(s,a,u),this._defaultValue=i?(function(p){return p.type==="color"&&(sh(p.default)||Array.isArray(p.default))?new cr(0,0,0,0):p.type==="color"?cr.parse(p.default)||null:p.default===void 0?null:p.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=cd(e),this.isIndoorDependent=rh(e)}evaluateWithoutErrorHandling(e,i,s,a,u,p,g,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,a,u,p,g,b,w){this._evaluator||(this._evaluator=new En(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=w||null;try{let A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new $r(`Expected value to be one of ${Object.keys(this._enumValues).map((k=>JSON.stringify(k))).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function ch(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in lu}function ja(r,e,i,s,a){let u=new Tc(lu,[],e?(function(g){let b={color:xo,string:Zi,number:Gt,enum:Zi,boolean:ir,formatted:Gs,resolvedImage:ws};return g.type==="array"?qn(b[g.value]||ur,g.length):b[g.type]})(e):void 0,void 0,void 0,i,s,a),p=u.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?kc(new lh(p,e,i,s,a)):Wl(u.errors)}class ud{constructor(e,i,s,a){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!eo(i.expression),this.configDependencies=cd(i.expression),this.isIndoorDependent=rh(i.expression)}evaluateWithoutErrorHandling(e,i,s,a,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,p)}evaluate(e,i,s,a,u,p,g){return this._styleExpression.evaluate(e,i,s,a,u,p,void 0,void 0,g)}}class Hl{constructor(e,i,s,a,u,p){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!eo(i.expression),this.isIndoorDependent=rh(i.expression),this.isLightConstant=u,this.isLineProgressConstant=p,this.configDependencies=cd(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,s,a,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,p)}evaluate(e,i,s,a,u,p){return this._styleExpression.evaluate(e,i,s,a,u,p)}interpolationFactor(e,i,s){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,i,s):0}}function Zp(r,e,i,s,a){if((r=ja(r,e,i,s,a)).result==="error")return r;let u=r.value.expression,p=co(u);if(!p&&!nh(e))return Wl([new Oo("","data expressions not supported")]);let g=Cs(u,["zoom","pitch","distance-from-center"]);if(!g&&!Gp(e))return Wl([new Oo("","zoom expressions not supported")]);let b=Cs(u,["measure-light"]);if(!b&&!Wp(e))return Wl([new Oo("","measure-light expression not supported")]);let w=Cs(u,["line-progress"]);if(!w&&!(function(I){return qp(I.expression,"line-progress")})(e))return Wl([new Oo("","line-progress expression not supported")]);let A=e.expression&&e.expression.relaxZoomRestriction,k=dh(u);return k||g||A?k instanceof Oo?Wl([k]):k instanceof Es&&!oh(e)?Wl([new Oo("",'"interpolate" expressions cannot be used with this property')]):kc(k?new Hl(p&&w?"camera":"composite",r.value,k.labels,k instanceof Es?k.interpolation:void 0,b,w):new ud(p&&w?"constant":"source",r.value,b,w)):Wl([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class uh{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,ah(this._parameters,this._specification))}static deserialize(e){return new uh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function dh(r){let e=null;if(r instanceof ad)e=dh(r.result);else if(r instanceof sd){for(let i of r.args)if(e=dh(i),e)break}else(r instanceof Cc||r instanceof Es)&&r.input instanceof ao&&r.input.name==="zoom"&&(e=r);return e instanceof Oo||r.eachChild((i=>{let s=dh(i);s instanceof Oo?e=s:e&&s&&e!==s&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var dd,hh,og=(function(){if(hh)return dd;hh=1,dd=e;var r=3;function e(i,s,a){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(s=p[1])+2*(a=p[2]);for(var g=0;g<this.d*this.d;g++){var b=p[r+g],w=p[r+g+1];u.push(b===w?null:p.subarray(b,w))}var A=p[r+u.length+1];this.keys=p.subarray(p[r+u.length],A),this.bboxes=p.subarray(A),this.insert=this._insertReadonly}else{this.d=s+2*a;for(var k=0;k<this.d*this.d;k++)u.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=a,this.scale=s/i,this.uid=0;var I=a/s*i;this.min=-I,this.max=i+I}return e.prototype.insert=function(i,s,a,u,p){this._forEachCell(s,a,u,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,a,u,p,g){this.cells[p].push(g)},e.prototype.query=function(i,s,a,u,p){var g=this.min,b=this.max;if(i<=g&&s<=g&&b<=a&&b<=u&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(i,s,a,u,this._queryCell,w,{},p),w},e.prototype._queryCell=function(i,s,a,u,p,g,b,w){var A=this.cells[p];if(A!==null)for(var k=this.keys,I=this.bboxes,D=0;D<A.length;D++){var B=A[D];if(b[B]===void 0){var V=4*B;(w?w(I[V+0],I[V+1],I[V+2],I[V+3]):i<=I[V+2]&&s<=I[V+3]&&a>=I[V+0]&&u>=I[V+1])?(b[B]=!0,g.push(k[B])):b[B]=!1}}},e.prototype._forEachCell=function(i,s,a,u,p,g,b,w){for(var A=this._convertToCellCoord(i),k=this._convertToCellCoord(s),I=this._convertToCellCoord(a),D=this._convertToCellCoord(u),B=A;B<=I;B++)for(var V=k;V<=D;V++){var W=this.d*V+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(V),this._convertFromCellCoord(B+1),this._convertFromCellCoord(V+1)))&&p.call(this,i,s,a,u,W,g,b,w))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=r+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var p=new Int32Array(s+a+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=s,b=0;b<i.length;b++){var w=i[b];p[r+b]=g,p.set(w,g),g+=w.length}return p[r+i.length]=g,p.set(this.keys,g),p[r+i.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer},dd})(),Ic=cc(og);let uu={};function Ot(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),uu[e]={klass:r,omit:i.omit||[]}}Ot(Object,"Object"),Ic.serialize=function(r,e){let i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ic.deserialize=function(r){return new Ic(r.buffer)},Object.defineProperty(Ic,"name",{value:"Grid"}),Ot(Ic,"Grid"),delete st.prototype.constructor,typeof DOMMatrix<"u"&&Ot(DOMMatrix,"DOMMatrix"),Ot(cr,"Color"),Ot(Error,"Error"),Ot(jn,"Formatted"),Ot(yc,"FormattedSection"),Ot(da,"AJAXError"),Ot(Io,"ResolvedImage"),Ot(uh,"StylePropertyFunction"),Ot(lh,"StyleExpression",{omit:["_evaluator"]}),Ot(kn,"ImageId"),Ot(Hs,"ImageVariant"),Ot(Hl,"ZoomDependentExpression"),Ot(ud,"ZoomConstantExpression"),Ot(ao,"CompoundExpression",{omit:["_evaluate"]});for(let r in lu)uu[lu[r]._classRegistryKey]||Ot(lu[r],`Expression${r}`);function $p(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function ul(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Zl(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if($p(r)||ul(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){let i=[];for(let s of r)i.push(Zl(s,e));return i}if(r instanceof Map){let i={$name:"Map",entries:[]};for(let[s,a]of r.entries())i.entries.push(Zl(s),Zl(a,e));return i}if(r instanceof Set){let i={$name:"Set"},s=0;for(let a of r.values())i[++s]=Zl(a);return i}if(r instanceof DOMMatrix){let i={$name:"DOMMatrix"},s=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(let a of s)i[a]=r[a];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){let i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);let a=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(let u in r)r.hasOwnProperty(u)&&(uu[s].omit.indexOf(u)>=0||(a[u]=Zl(r[u],e)));r instanceof Error&&(a.message=r.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof r)}function $l(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||$p(r)||ul(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map($l);if(typeof r=="object"){let e=r.$name||"Object";if(e==="Map"){let a=r.entries||[],u=new Map;for(let p=0;p<a.length;p+=2)u.set($l(a[p]),$l(a[p+1]));return u}if(e==="Set"){let a=new Set;for(let u of Object.keys(r))u!=="$name"&&a.add($l(r[u]));return a}if(e==="DOMMatrix"){let a;return a=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(a)}if(e==="BigInt")return BigInt(r.value);let{klass:i}=uu[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);let s=Object.create(i.prototype);for(let a of Object.keys(r))a!=="$name"&&(s[a]=$l(r[a]));return s}throw new Error("can't deserialize object of type "+typeof r)}let Xt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Xp(r){for(let e of r)if(fh(e.charCodeAt(0)))return!0;return!1}function sg(r){for(let e of r)if(!ph(e.charCodeAt(0)))return!1;return!0}function ph(r){return!(Xt.Arabic(r)||Xt["Arabic Supplement"](r)||Xt["Arabic Extended-A"](r)||Xt["Arabic Presentation Forms-A"](r)||Xt["Arabic Presentation Forms-B"](r))}function fh(r){return!(r!==746&&r!==747&&(r<4352||!(Xt["Bopomofo Extended"](r)||Xt.Bopomofo(r)||Xt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Xt["CJK Compatibility Ideographs"](r)||Xt["CJK Compatibility"](r)||Xt["CJK Radicals Supplement"](r)||Xt["CJK Strokes"](r)||!(!Xt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Xt["CJK Unified Ideographs Extension A"](r)||Xt["CJK Unified Ideographs"](r)||Xt["Enclosed CJK Letters and Months"](r)||Xt["Hangul Compatibility Jamo"](r)||Xt["Hangul Jamo Extended-A"](r)||Xt["Hangul Jamo Extended-B"](r)||Xt["Hangul Jamo"](r)||Xt["Hangul Syllables"](r)||Xt.Hiragana(r)||Xt["Ideographic Description Characters"](r)||Xt.Kanbun(r)||Xt["Kangxi Radicals"](r)||Xt["Katakana Phonetic Extensions"](r)||Xt.Katakana(r)&&r!==12540||!(!Xt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Xt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Xt["Unified Canadian Aboriginal Syllabics"](r)||Xt["Unified Canadian Aboriginal Syllabics Extended"](r)||Xt["Vertical Forms"](r)||Xt["Yijing Hexagram Symbols"](r)||Xt["Yi Syllables"](r)||Xt["Yi Radicals"](r))))}function Yp(r){return!(fh(r)||(function(e){return!!(Xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xt["Letterlike Symbols"](e)||Xt["Number Forms"](e)||Xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xt["Control Pictures"](e)&&e!==9251||Xt["Optical Character Recognition"](e)||Xt["Enclosed Alphanumerics"](e)||Xt["Geometric Shapes"](e)||Xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xt["CJK Symbols and Punctuation"](e)||Xt.Katakana(e)||Xt["Private Use Area"](e)||Xt["CJK Compatibility Forms"](e)||Xt["Small Form Variants"](e)||Xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function Kp(r){return Xt.Arabic(r)||Xt["Arabic Supplement"](r)||Xt["Arabic Extended-A"](r)||Xt["Arabic Presentation Forms-A"](r)||Xt["Arabic Presentation Forms-B"](r)}function ag(r){return r>=1424&&r<=2303||Xt["Arabic Presentation Forms-A"](r)||Xt["Arabic Presentation Forms-B"](r)}function tv(r,e){return!(!e&&ag(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Xt.Khmer(r))}function iv(r){for(let e of r)if(ag(e.charCodeAt(0)))return!0;return!1}let ls={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"},Jp=null,Fo=ls.unavailable,Xl=null,lg=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Fo=ls.error),Jp&&Jp(r)};function Qp(){ef.fire(new so("pluginStateChange",{pluginStatus:Fo,pluginURL:Xl}))}let ef=new ha,tf=function(){return Fo},rf=function(){if(Fo!==ls.deferred||!Xl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fo=ls.loading,Qp(),Xl&&Ma({url:Xl},(r=>{r?lg(r):(Fo=ls.loaded,Qp())}))},cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Fo===ls.loaded||cs.applyArabicShaping!=null,isLoading:()=>Fo===ls.loading,setState(r){Fo=r.pluginStatus,Xl=r.pluginURL},isParsing:()=>Fo===ls.parsing,isParsed:()=>Fo===ls.parsed,getPluginURL:()=>Xl};class Rr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,s){for(let a of i)if(!tv(a.charCodeAt(0),s))return!1;return!0})(e,cs.isLoaded())}}class hd{constructor(e,i,s,a,u){this.property=e,this.value=i,this.expression=(function(p,g,b,w,A){if(sh(p))return new uh(p,g);if(ch(p)||Array.isArray(p)&&p.length>0){let k=Zp(p,g,b,w,A);if(k.result==="error")throw new Error(k.value.map((I=>`${I.key}: ${I.message}`)).join(", "));return k.value}{let k=p;return typeof p=="string"&&g.type==="color"&&(k=cr.parse(p)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>k}}})(i===void 0?e.specification.default:i,e.specification,s,a,u)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,a){return this.property.possiblyEvaluate(this,e,i,s,a)}}class du{constructor(e,i,s,a){this.property=e,this.value=new hd(e,void 0,i,s,a)}transitioned(e,i){return new ug(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new ug(this.property,this.value,null,{},0)}}class cg{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return jt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new du(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new hd(this._values[e].property,i===null?void 0:jt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);let s=this._properties.properties;if(e)for(let a in e){let u=e[a];if(a.endsWith("-transition")){let p=a.slice(0,-11);s[p]&&this.setTransition(p,u)}else s.hasOwnProperty(a)&&this.setValue(a,u)}}getTransition(e){return jt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new du(this._values[e].property)),this._values[e].transition=jt(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let s=this.getValue(i);s!==void 0&&(e[i]=s);let a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){let s=new dl(this._properties);for(let a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(e,i._values[a]);return s}untransitioned(){let e=new dl(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class ug{constructor(e,i,s,a,u){let p=a.delay||0,g=a.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){let a=e.now||0,u=this.value.possiblyEvaluate(e,i,s),p=this.prior;if(p){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return p.possiblyEvaluate(e,i,s);{let g=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,s),u,kl(g))}}return u}}class dl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){let a=new Pc(this._properties);for(let u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,i,s);return a}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class nf{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return jt(this._values[e].value)}setValue(e,i){this._values[e]=new hd(this._values[e].property,i===null?void 0:jt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){let e={};for(let i of Object.keys(this._values)){let s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,a){let u=new Pc(this._properties);for(let p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s,a);return u}isIndoorDependent(){return this._isIndoorDependent}}class Ks{constructor(e,i,s,a){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,a){return this.property.evaluate(this.value,this.parameters,e,i,s,a,this.iconImageUseTheme)}}class Pc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){let a=Ws[this.specification.type];return a?a(e,i,s):e}}class kt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,a,u){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ks(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,a,void 0,u)},i):new Ks(this,e.expression,i,u)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ks(this,{kind:"constant",value:void 0},e.parameters);let a=Ws[this.specification.type];return a?new Ks(this,{kind:"constant",value:a(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,a,u,p,g){return e.kind==="constant"?e.value:e.evaluate(i,s,a,u,p,void 0,g)}}class hu{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,a){return!!e.expression.evaluate(i,null,{},s,a)}interpolate(){return!1}}class hn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new Rr(0,{});for(let s in e){let a=e[s];a.specification.overridable&&this.overridableProperties.push(s);let u=this.defaultPropertyValues[s]=new hd(a,void 0),p=this.defaultTransitionablePropertyValues[s]=new du(a);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(i)}}}Ot(kt,"DataDrivenProperty"),Ot(pt,"DataConstantProperty"),Ot(hu,"ColorRampProperty");var Me=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function of(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function pu(r){if(Array.isArray(r))return r.map(pu);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let e={};for(let i in r)e[i]=pu(r[i]);return e}return of(r)}function fu(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let e of r.slice(1))if(!fu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function mh(r,e="",i=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fu(r)||(r=As(r));let a=r,u=!0;try{u=(function(A){if(!gu(A))return A;let k=pu(A);return mu(k),k=gh(k),k})(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let p=null,g=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){g=Me[`filter_${s}`];let A=ja(u,g,e,i);if(A.result==="error")throw new Error(A.value.map((k=>`${k.key}: ${k.message}`)).join(", "));p=(k,I,D)=>A.value.evaluate(k,I,{},D)}let b=null,w=null;if(u!==a){let A=ja(a,g,e,i);if(A.result==="error")throw new Error(A.value.map((k=>`${k.key}: ${k.message}`)).join(", "));b=(k,I,D,B,V)=>A.value.evaluate(k,I,{},D,void 0,void 0,B,V),w=!co(A.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:hg(u),needFeature:!!w}}function gh(r){if(!Array.isArray(r))return r;let e=(function(i){if(rv.has(i[0])){for(let s=1;s<i.length;s++)if(gu(i[s]))return!0}return i})(r);return e===!0?e:e.map((i=>gh(i)))}function mu(r){let e=!1,i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||gu(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||gu(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||gu(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)mu(r[s])}function gu(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(gu(r[i]))return!0;return!1}let rv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dg(r,e){return r<e?-1:r>e?1:0}function hg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(hg(r[e]))return!0;return!1}function As(r){if(!r)return!0;let e=r[0];return r.length<=1?e!=="any":e==="=="?sf(r[1],r[2],"=="):e==="!="?_h(sf(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?sf(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(As))):e==="all"?["all"].concat(r.slice(1).map(As)):e==="none"?["all"].concat(r.slice(1).map(As).map(_h)):e==="in"?af(r[1],r.slice(2)):e==="!in"?_h(af(r[1],r.slice(2))):e==="has"?pg(r[1]):e!=="!has"||_h(pg(r[1]));var i}function sf(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function af(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(dg)]]:["filter-in-small",r,["literal",e]]}}function pg(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function _h(r){return["!",r]}let pd="";function Lc(r,e){return e?`${r}${pd}${e}`:r}let fg,mg=()=>fg||(fg=new hn({"icon-size":new kt(Me.layout_symbol["icon-size"]),"icon-image":new kt(Me.layout_symbol["icon-image"]),"icon-rotate":new kt(Me.layout_symbol["icon-rotate"]),"icon-offset":new kt(Me.layout_symbol["icon-offset"])}));class nv{constructor(e,i,s,a,u,p){this.cachedIconPrimary=null;let g=ja(e,Me.appearance.condition);if(g.result==="success"&&(this.condition=g.value),this.name=i,s){this.properties=new Pc(mg()),this.unevaluatedLayout=new nf(mg(),a,u,p);for(let b in s)this.unevaluatedLayout.setValue(b,s[b])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){let e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}let gg="-transition",ov=new Set(["fill","line","background","hillshade","raster"]);class Lo extends ha{constructor(e,i,s,a,u,p){if(super(),this.id=e.id,this.fqid=Lc(this.id,s),this.type=e.type,this.scope=s,this.lut=a,this.options=u,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let g=ja(this.filter,Me[`filter_${e.type}`]);g.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...g.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||g.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new nf(i.layout,this.scope,u,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new cg(i.paint,this.scope,u);for(let g in e.paint)this.setPaintProperty(g,e.paint[g]);for(let g in e.layout)this.setLayoutProperty(g,e.layout[g]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ov.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new nv(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(gg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){let s=this._transitionablePaint,a=s._properties.properties;if(e.endsWith(gg)){let k=e.slice(0,-11);return a[k]&&s.setTransition(k,i||void 0),!1}if(!a[e])return!1;let u=s._values[e],p=u.value.isDataDriven(),g=u.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);let b=s._values[e].value,w=b.isDataDriven(),A=e.endsWith("pattern")||e==="line-dasharray";return w||p||A||this._handleOverridablePaintPropertyUpdate(e,g,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){let e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),rt(e,((i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof Ks&&nh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(let e of this.appearances)if(!eo(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=mh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,a,u,p,g,b,w){}}let sv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fd{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Li(r,e=1){let i=0,s=0;return{members:r.map((a=>{let u=sv[a.type].BYTES_PER_ELEMENT,p=i=lf(i,Math.max(e,u)),g=a.components||1;return s=Math.max(s,u),i+=u*g,{name:a.name,type:a.type,components:g,offset:p}})),size:lf(i,Math.max(s,e)),alignment:e}}function lf(r,e){return Math.ceil(r/e)*e}class Xo extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){let a=2*e;return this.int16[a+0]=i,this.int16[a+1]=s,e}}Xo.prototype.bytesPerElement=4,Ot(Xo,"StructArrayLayout2i4");class zc extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){let u=3*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}zc.prototype.bytesPerElement=6,Ot(zc,"StructArrayLayout3i6");class _u extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){let p=4*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=a,this.int16[p+3]=u,e}}_u.prototype.bytesPerElement=8,Ot(_u,"StructArrayLayout4i8");class hl extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}hl.prototype.bytesPerElement=4,Ot(hl,"StructArrayLayout1f4");class cf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){let u=4*e,p=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.float32[p+1]=a,e}}cf.prototype.bytesPerElement=8,Ot(cf,"StructArrayLayout2i1f8");class uf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){let u=4*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}uf.prototype.bytesPerElement=8,Ot(uf,"StructArrayLayout3i8");class yh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u)}emplace(e,i,s,a,u,p){let g=5*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=p,e}}yh.prototype.bytesPerElement=10,Ot(yh,"StructArrayLayout5i10");class vh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,a,u,p,g)}emplace(e,i,s,a,u,p,g,b){let w=6*e,A=12*e,k=3*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[A+4]=a,this.uint8[A+5]=u,this.uint8[A+6]=p,this.uint8[A+7]=g,this.float32[k+2]=b,e}}vh.prototype.bytesPerElement=12,Ot(vh,"StructArrayLayout2i4ub1f12");class ks extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){let u=3*e;return this.float32[u+0]=i,this.float32[u+1]=s,this.float32[u+2]=a,e}}ks.prototype.bytesPerElement=12,Ot(ks,"StructArrayLayout3f12");class Yl extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u)}emplace(e,i,s,a,u,p){let g=6*e,b=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=a,this.uint16[g+3]=u,this.float32[b+2]=p,e}}Yl.prototype.bytesPerElement=12,Ot(Yl,"StructArrayLayout4ui1f12");class Mc extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){let p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=a,this.uint16[p+3]=u,e}}Mc.prototype.bytesPerElement=8,Ot(Mc,"StructArrayLayout4ui8");class xh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,p)}emplace(e,i,s,a,u,p,g){let b=6*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=a,this.int16[b+3]=u,this.int16[b+4]=p,this.int16[b+5]=g,e}}xh.prototype.bytesPerElement=12,Ot(xh,"StructArrayLayout6i12");class bh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k,I){let D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,a,u,p,g,b,w,A,k,I)}emplace(e,i,s,a,u,p,g,b,w,A,k,I,D){let B=12*e;return this.int16[B+0]=i,this.int16[B+1]=s,this.int16[B+2]=a,this.int16[B+3]=u,this.uint16[B+4]=p,this.uint16[B+5]=g,this.uint16[B+6]=b,this.uint16[B+7]=w,this.int16[B+8]=A,this.int16[B+9]=k,this.int16[B+10]=I,this.int16[B+11]=D,e}}bh.prototype.bytesPerElement=24,Ot(bh,"StructArrayLayout4i4ui4i24");class yu extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,p)}emplace(e,i,s,a,u,p,g){let b=10*e,w=5*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=a,this.float32[w+2]=u,this.float32[w+3]=p,this.float32[w+4]=g,e}}yu.prototype.bytesPerElement=20,Ot(yu,"StructArrayLayout3i3f20");class Kl extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){let p=4*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=a,this.float32[p+3]=u,e}}Kl.prototype.bytesPerElement=16,Ot(Kl,"StructArrayLayout4f16");class df extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}df.prototype.bytesPerElement=4,Ot(df,"StructArrayLayout1ul4");class Js extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){let a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=s,e}}Js.prototype.bytesPerElement=4,Ot(Js,"StructArrayLayout2ui4");class hf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k,I,D){let B=this.length;return this.resize(B+1),this.emplace(B,e,i,s,a,u,p,g,b,w,A,k,I,D)}emplace(e,i,s,a,u,p,g,b,w,A,k,I,D,B){let V=20*e,W=10*e;return this.int16[V+0]=i,this.int16[V+1]=s,this.int16[V+2]=a,this.int16[V+3]=u,this.int16[V+4]=p,this.float32[W+3]=g,this.float32[W+4]=b,this.float32[W+5]=w,this.float32[W+6]=A,this.int16[V+14]=k,this.uint32[W+8]=I,this.uint16[V+18]=D,this.uint16[V+19]=B,e}}hf.prototype.bytesPerElement=40,Ot(hf,"StructArrayLayout5i4f1i1ul2ui40");class wh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,a,u,p,g)}emplace(e,i,s,a,u,p,g,b){let w=8*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=a,this.int16[w+4]=u,this.int16[w+5]=p,this.int16[w+6]=g,this.int16[w+7]=b,e}}wh.prototype.bytesPerElement=16,Ot(wh,"StructArrayLayout3i2i2i16");class vu extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u)}emplace(e,i,s,a,u,p){let g=4*e,b=8*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=a,this.int16[b+6]=u,this.int16[b+7]=p,e}}vu.prototype.bytesPerElement=16,Ot(vu,"StructArrayLayout2f1f2i16");class xu extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,p)}emplace(e,i,s,a,u,p,g){let b=20*e,w=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=s,this.float32[w+1]=a,this.float32[w+2]=u,this.float32[w+3]=p,this.float32[w+4]=g,e}}xu.prototype.bytesPerElement=20,Ot(xu,"StructArrayLayout2ub4f20");class Yr extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){let u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,this.uint16[u+2]=a,e}}Yr.prototype.bytesPerElement=6,Ot(Yr,"StructArrayLayout3ui6");class bu extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e){let de=this.length;return this.resize(de+1),this.emplace(de,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e)}emplace(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e,de){let xe=30*e,Ce=15*e,Ae=60*e;return this.int16[xe+0]=i,this.int16[xe+1]=s,this.int16[xe+2]=a,this.float32[Ce+2]=u,this.float32[Ce+3]=p,this.uint16[xe+8]=g,this.uint16[xe+9]=b,this.uint32[Ce+5]=w,this.uint32[Ce+6]=A,this.uint32[Ce+7]=k,this.uint16[xe+16]=I,this.uint16[xe+17]=D,this.uint16[xe+18]=B,this.float32[Ce+10]=V,this.float32[Ce+11]=W,this.uint8[Ae+48]=H,this.uint8[Ae+49]=J,this.uint8[Ae+50]=te,this.uint32[Ce+13]=ne,this.int16[xe+28]=_e,this.uint8[Ae+58]=de,e}}bu.prototype.bytesPerElement=60,Ot(bu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e,de,xe,Ce,Ae,He,Oe,Ze,Je,it,_t,ct,Qe){let lt=this.length;return this.resize(lt+1),this.emplace(lt,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e,de,xe,Ce,Ae,He,Oe,Ze,Je,it,_t,ct,Qe)}emplace(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e,de,xe,Ce,Ae,He,Oe,Ze,Je,it,_t,ct,Qe,lt){let We=20*e,Ue=40*e,at=80*e;return this.float32[We+0]=i,this.float32[We+1]=s,this.int16[Ue+4]=a,this.int16[Ue+5]=u,this.int16[Ue+6]=p,this.int16[Ue+7]=g,this.int16[Ue+8]=b,this.int16[Ue+9]=w,this.int16[Ue+10]=A,this.int16[Ue+11]=k,this.int16[Ue+12]=I,this.uint16[Ue+13]=D,this.uint16[Ue+14]=B,this.uint16[Ue+15]=V,this.uint16[Ue+16]=W,this.uint16[Ue+17]=H,this.uint16[Ue+18]=J,this.uint16[Ue+19]=te,this.uint16[Ue+20]=ne,this.uint16[Ue+21]=_e,this.uint16[Ue+22]=de,this.uint16[Ue+23]=xe,this.uint16[Ue+24]=Ce,this.uint16[Ue+25]=Ae,this.uint16[Ue+26]=He,this.uint16[Ue+27]=Oe,this.uint32[We+14]=Ze,this.float32[We+15]=Je,this.float32[We+16]=it,this.float32[We+17]=_t,this.float32[We+18]=ct,this.uint8[at+76]=Qe,this.uint16[Ue+39]=lt,e}}pf.prototype.bytesPerElement=80,Ot(pf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ff extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,p)}emplace(e,i,s,a,u,p,g){let b=6*e;return this.float32[b+0]=i,this.float32[b+1]=s,this.float32[b+2]=a,this.float32[b+3]=u,this.float32[b+4]=p,this.float32[b+5]=g,e}}ff.prototype.bytesPerElement=24,Ot(ff,"StructArrayLayout6f24");class Oc extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u)}emplace(e,i,s,a,u,p){let g=5*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=a,this.float32[g+3]=u,this.float32[g+4]=p,e}}Oc.prototype.bytesPerElement=20,Ot(Oc,"StructArrayLayout5f20");class mf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,a,u,p,g)}emplace(e,i,s,a,u,p,g,b){let w=7*e;return this.float32[w+0]=i,this.float32[w+1]=s,this.float32[w+2]=a,this.float32[w+3]=u,this.float32[w+4]=p,this.float32[w+5]=g,this.float32[w+6]=b,e}}mf.prototype.bytesPerElement=28,Ot(mf,"StructArrayLayout7f28");class md extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k){let I=this.length;return this.resize(I+1),this.emplace(I,e,i,s,a,u,p,g,b,w,A,k)}emplace(e,i,s,a,u,p,g,b,w,A,k,I){let D=11*e;return this.float32[D+0]=i,this.float32[D+1]=s,this.float32[D+2]=a,this.float32[D+3]=u,this.float32[D+4]=p,this.float32[D+5]=g,this.float32[D+6]=b,this.float32[D+7]=w,this.float32[D+8]=A,this.float32[D+9]=k,this.float32[D+10]=I,e}}md.prototype.bytesPerElement=44,Ot(md,"StructArrayLayout11f44");class gf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w){let A=this.length;return this.resize(A+1),this.emplace(A,e,i,s,a,u,p,g,b,w)}emplace(e,i,s,a,u,p,g,b,w,A){let k=9*e;return this.float32[k+0]=i,this.float32[k+1]=s,this.float32[k+2]=a,this.float32[k+3]=u,this.float32[k+4]=p,this.float32[k+5]=g,this.float32[k+6]=b,this.float32[k+7]=w,this.float32[k+8]=A,e}}gf.prototype.bytesPerElement=36,Ot(gf,"StructArrayLayout9f36");class Jl extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){let a=2*e;return this.float32[a+0]=i,this.float32[a+1]=s,e}}Jl.prototype.bytesPerElement=8,Ot(Jl,"StructArrayLayout2f8");class _f extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){let p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=s,this.uint16[p+3]=a,this.uint16[p+4]=u,e}}_f.prototype.bytesPerElement=12,Ot(_f,"StructArrayLayout1ul3ui12");class Sh extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Sh.prototype.bytesPerElement=2,Ot(Sh,"StructArrayLayout1ui2");class Th extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W){let H=this.length;return this.resize(H+1),this.emplace(H,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W)}emplace(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H){let J=16*e;return this.float32[J+0]=i,this.float32[J+1]=s,this.float32[J+2]=a,this.float32[J+3]=u,this.float32[J+4]=p,this.float32[J+5]=g,this.float32[J+6]=b,this.float32[J+7]=w,this.float32[J+8]=A,this.float32[J+9]=k,this.float32[J+10]=I,this.float32[J+11]=D,this.float32[J+12]=B,this.float32[J+13]=V,this.float32[J+14]=W,this.float32[J+15]=H,e}}Th.prototype.bytesPerElement=64,Ot(Th,"StructArrayLayout16f64");class wu extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,p,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,a,u,p,g)}emplace(e,i,s,a,u,p,g,b){let w=10*e,A=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=s,this.uint16[w+2]=a,this.uint16[w+3]=u,this.float32[A+2]=p,this.float32[A+3]=g,this.float32[A+4]=b,e}}wu.prototype.bytesPerElement=20,Ot(wu,"StructArrayLayout4ui3f20");class yf extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}yf.prototype.bytesPerElement=2,Ot(yf,"StructArrayLayout1i2");class Ch extends jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Ch.prototype.bytesPerElement=1,Ot(Ch,"StructArrayLayout1ub1");class vf extends fd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vf.prototype.size=40;class _g extends hf{get(e){return new vf(this,e)}}Ot(_g,"CollisionBoxArray");class Eh extends fd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Eh.prototype.size=60;class gd extends bu{get(e){return new Eh(this,e)}}Ot(gd,"PlacedSymbolArray");class xf extends fd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}xf.prototype.size=80;class yg extends pf{get(e){return new xf(this,e)}}Ot(yg,"SymbolInstanceArray");class bf extends hl{getoffsetX(e){return this.float32[1*e+0]}}Ot(bf,"GlyphOffsetArray");class vg extends Xo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ot(vg,"SymbolLineVertexArray");class Ah extends fd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ah.prototype.size=12;class xg extends _f{get(e){return new Ah(this,e)}}Ot(xg,"FeatureIndexArray");class bg extends Js{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ot(bg,"FillExtrusionCentroidArray");class wg extends fd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}wg.prototype.size=6;class Sg extends zc{get(e){return new wg(this,e)}}Ot(Sg,"FillExtrusionWallArray");let Tg=Li([{name:"a_pos",components:2,type:"Int16"}],4),av=Li([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),lv=Li([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class tn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,a){let u=this.segments[this.segments.length-1];return e>tn.MAX_VERTEX_ARRAY_LENGTH&&Zt(`Max vertices per segment is ${tn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>tn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(e,i,s,a){return this._prepareSegment(e,i.length,s.length,a)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,a){return new tn([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function Cg(r,e){return 256*(r=X(Math.floor(r),0,255))+X(Math.floor(e),0,255)}tn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(tn,"SegmentVector");let cv=Li([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),uv=Li([{name:"a_pattern_b",components:4,type:"Uint16"}]),dv=Li([{name:"a_dash",components:4,type:"Uint16"}]);class _d{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,a){this.ids.push(yd(e)),this.positions.push(i,s,a)}eachPosition(e,i){let s=yd(e),a=0,u=this.ids.length-1;for(;a<u;){let p=a+u>>1;this.ids[p]>=s?u=p:a=p+1}for(;this.ids[a]===s;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){let s=new Float64Array(e.ids),a=new Uint32Array(e.positions);return wf(s,a,0,s.length-1),i&&(i.add(s.buffer),i.add(a.buffer)),{ids:s,positions:a}}static deserialize(e){let i=new _d,s;i.ids=e.ids,i.positions=e.positions;for(let a of i.ids)a!==s&&i.uniqueIds.push(a),s=a;return i.indexed=!0,i}}function yd(r){let e=+r;return Number.isSafeInteger(e)?e:ko(String(r))}function wf(r,e,i,s){for(;i<s;){let a=r[i+s>>1],u=i-1,p=s+1;for(;;){do u++;while(r[u]<a);do p--;while(r[p]>a);if(u>=p)break;kh(r,u,p),kh(e,3*u,3*p),kh(e,3*u+1,3*p+1),kh(e,3*u+2,3*p+2)}p-i<s-p?(wf(r,e,i,p),i=p+1):(wf(r,e,p+1,s),s=p)}}function kh(r,e,i){let s=r[e];r[e]=r[i],r[i]=s}Ot(_d,"FeaturePositionMap");class Qs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ih extends Qs{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class An extends Qs{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Va extends Qs{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Su extends Qs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class vd extends Qs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Sf extends Qs{constructor(e){super(e),this.current=cr.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}let Eg=new Float32Array(16);class xd extends Qs{constructor(e){super(e),this.current=Eg}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}let hv=new Float32Array(9),Ag=new Float32Array(4);class Tf extends Qs{constructor(e){super(e),this.current=Ag}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Cf(r){return[Cg(255*r.r,255*r.g),Cg(255*r.b,255*r.a)]}function Ph(r,e,i,s,a,u,p,g){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Rr(0,{brightness:u,worldview:g}),e,i,a,s,p)==="none":r.value==="none")}class Lh{constructor(e,i,s,a){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=s,this.context=a}setUniform(e,i,s,a,u){let p=a.constantOr(this.value);i.set(e,u,p instanceof cr?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new Sf(e):new An(e)}}class bd{constructor(e,i){this.uniformNames=i.map((s=>`u_${s}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,a,u){let p=null;u!=="u_pattern"&&u!=="u_dash"||(p=this.pattern),u==="u_pattern_b"&&(p=this.patternTransition),u==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,u,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new vd(e):new An(e)}}class pl{constructor(e,i,s,a){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map((u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,i,s,a,u,p,g,b){let w=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Rr(0,{brightness:p,worldview:b}),i,{},u,a,g):this.expression.kind==="constant"&&this.expression.value,k=Ph(this.lutExpression,i,{},a,u,p,g,b);this.paintVertexArray.resize(e),this._setPaintValue(w,e,A,k?null:this.context.lut)}updatePaintArray(e,i,s,a,u,p,g,b){let w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g,worldview:b},s,a,void 0,u):this.expression.kind==="constant"&&this.expression.value,A=Ph(this.lutExpression,s,a,u,void 0,g,void 0,b);this._setPaintValue(e,i,w,A?null:this.context.lut)}_setPaintValue(e,i,s,a){if(this.type==="color"){let u=Cf(s.toPremultipliedRenderColor(a));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _a{constructor(e,i,s,a,u,p){this.expression=e,this.uniformNames=i.map((g=>`u_${g}_t`)),this.type=s,this.useIntegerZoom=a,this.context=u,this.maxValue=0,this.paintVertexAttributes=i.map((g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,s,a,u,p,g,b){let w=this.expression.evaluate(new Rr(this.context.zoom,{brightness:p,worldview:b}),i,{},u,a,g),A=this.expression.evaluate(new Rr(this.context.zoom+1,{brightness:p,worldview:b}),i,{},u,a,g),k=Ph(this.lutExpression,i,{},a,u,p,g,b),I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,w,A,k?null:this.context.lut)}updatePaintArray(e,i,s,a,u,p,g,b){let w=this.expression.evaluate({zoom:this.context.zoom,brightness:g,worldview:b},s,a,void 0,u),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g,worldview:b},s,a,void 0,u),k=Ph(this.lutExpression,s,a,u,void 0,g,void 0,b);this._setPaintValue(e,i,w,A,k?null:this.context.lut)}_setPaintValue(e,i,s,a,u){if(this.type==="color"){let p=Cf(s.toPremultipliedRenderColor(u)),g=Cf(s.toPremultipliedRenderColor(u));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,p[0],p[1],g[0],g[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,a,u){let p=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=X(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,u,g)}getBinding(e,i){return new An(e)}}class bo{constructor(e,i,s,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(s==="array"?dv:cv).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Mc}populatePaintArray(e,i,s,a){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,a,u,p,g){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(e,i,s,a){if(!a||!s)return;let u=a[s[0]],p=a[s[1]];if(u){if(u){let{tl:g,br:b,pixelRatio:w}=u;for(let A=e;A<i;A++)this.paintVertexArray.emplace(A,g[0],g[1],b[0],b[1],w)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:g,br:b}=p;for(let w=e;w<i;w++)this.paintTransitionVertexArray.emplace(w,g[0],g[1],b[0],b[1])}}}upload(e){let i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,uv.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class fl{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[],this.context=i;let a=[];for(let u in e.paint._values){let p=e.paint.get(u);if(u.endsWith("-use-theme")||!s(u)||!(p instanceof Ks&&nh(p.property.specification)))continue;let g=fv(u,e.type),b=p.value,w=p.property.specification.type,A=!!p.property.useIntegerZoom,k=u==="line-dasharray"||u.endsWith("pattern"),I=e.paint.get(`${u}-use-theme`),D=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(b.kind!=="constant"||D)if(b.kind==="source"||D||k){let B=Ef(u,w,"source");this.binders[u]=k?new bo(b,g,w,B,e.id):new pl(b,g,w,B),a.push(`/a_${u}`)}else{let B=Ef(u,w,"composite");this.binders[u]=new _a(b,g,w,A,i,B),a.push(`/z_${u}`)}else this.binders[u]=k?new bd(b.value,g):new Lh(b.value,g,w,i),a.push(`/u_${u}`);I&&(this.binders[u].lutExpression=I.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof pl||i instanceof _a?i.maxValue:0}populatePaintArrays(e,i,s,a,u,p,g,b){for(let w in this.binders){let A=this.binders[w];A.context=this.context,(A instanceof pl||A instanceof _a||A instanceof bo)&&A.populatePaintArray(e,i,s,a,u,p,g,b)}}setConstantPatternPositions(e,i){for(let s in this.binders){let a=this.binders[s];a instanceof bd&&a.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){let i=this.binders[e];return i instanceof bo?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,a,u,p,g,b,w,A){let k=!1,I=Object.keys(e),D=I.length!==0&&!b,B=D?I:i.uniqueIds;this.context.lut=u.lut;for(let V in this.binders){let W=this.binders[V];if(W.context=this.context,(W instanceof pl||W instanceof _a||W instanceof bo)&&W.expression&&W.expression.kind&&W.expression.kind!=="constant"&&(W.expression.isStateDependent===!0||W.expression.isLightConstant===!1)){let H=u.paint.get(V);W.expression=H.value;for(let J of B){let te=e[J.toString()];i.eachPosition(J,((ne,_e,de)=>{let xe=a.feature(ne);W.updatePaintArray(_e,de,xe,te,p,g,w,A)}))}if(!D)for(let J of s.uniqueIds){let te=e[J.toString()];s.eachPosition(J,((ne,_e,de)=>{let xe=a.feature(ne);W.updatePaintArray(_e,de,xe,te,p,g,w,A)}))}k=!0}}return k}defines(){let e=[];for(let i in this.binders){let s=this.binders[i];(s instanceof Lh||s instanceof bd)&&e.push(...s.uniformNames.map((a=>`#define HAS_UNIFORM_${a}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let s in this.binders){let a=this.binders[s];if(a instanceof Lh||a instanceof bd||a instanceof _a)for(let u of a.uniformNames)i.push({name:u,property:s,binding:a.getBinding(e,u)})}return i}setUniforms(e,i,s,a,u){for(let{name:p,property:g,binding:b}of s)this.binders[g].setUniform(e,b,u,a.get(g),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof pl||i instanceof _a||i instanceof bo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof bo&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(let i in this.binders){let s=this.binders[i];(s instanceof pl||s instanceof _a||s instanceof bo)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof pl||i instanceof _a||i instanceof bo)&&i.destroy()}}}class ya{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(let a of e)this.programConfigurations[a.id]=new fl(a,i,s);this.needsUpload=!1,this._featureMap=new _d,this._featureMapWithoutIds=new _d,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,a,u,p,g,b,w){for(let A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,i,a,u,p,g,b,w);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,a,u,p,g,b){for(let w of s)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,w,a,u,p,g||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let pv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function fv(r,e){return pv[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}let mv={"line-pattern":{source:Yl,composite:Yl},"fill-pattern":{source:Yl,composite:Yl},"fill-extrusion-pattern":{source:Yl,composite:Yl},"line-dasharray":{source:Mc,composite:Mc}},gv={color:{source:Jl,composite:Kl},number:{source:hl,composite:Jl}};function Ef(r,e,i){let s=mv[r];return s&&s[i]||gv[e][i]}Ot(Lh,"ConstantBinder"),Ot(bd,"PatternConstantBinder"),Ot(pl,"SourceExpressionBinder"),Ot(bo,"PatternCompositeBinder"),Ot(_a,"CompositeExpressionBinder"),Ot(fl,"ProgramConfiguration",{omit:["_buffers"]}),Ot(ya,"ProgramConfigurationSet");let Yo=ht/Math.PI/2,l=5,t=6,o=16383,c=64,f=[c,32,16],_=-Yo,x=Yo;function S(r,e,i,s=Yo){return i=Bi(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function E(r,e,i){return S(Math.cos(Bi(r)),Math.sin(Bi(r)),e,i)}let P=63710088e-1,M=2*Math.PI*P;class F{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,s=this.lat*i,a=e.lat*i,u=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return P*Math.acos(Math.min(u,1))}toBounds(e=0){let i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new O({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return E(this.lat,this.lng,Yo+e*Yo/P)}static convert(e){if(e instanceof F)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new F(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new F(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class O{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof F?new F(e.lng,e.lat):F.convert(e),this}setSouthWest(e){return this._sw=e instanceof F?new F(e.lng,e.lat):F.convert(e),this}extend(e){let i=this._sw,s=this._ne,a,u;if(e instanceof F)a=e,u=e;else{if(!(e instanceof O))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(O.convert(e)):this.extend(F.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(F.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return i||s?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new F(a.lng,a.lat),this._ne=new F(u.lng,u.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:s}=F.convert(e),a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(e){if(e)return e instanceof O?e:new O(e)}}let N=0,q=25.5;function G(r){return M*Math.cos(r*Math.PI/180)}function K(r){return(180+r)/360}function $(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ee(r,e){return r/G(e)}function se(r){return 360*r-180}function ie(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function ge(r,e){return r*G(ie(e))}let ae=85.051129;function ye(r){return Math.cos(Bi(X(r,-ae,ae)))}function pe(r,e){let i=X(e,N,q),s=Math.pow(2,i);return ye(r)*M/(512*s)}function ue(r){return 1/Math.cos(r*Math.PI/180)}function ve(r,e=0){let i=Math.exp(Math.PI*(1-(r.y+e/ht)/(1<<r.z)*2));return 80150034*i/(i*i+1)/ht/(1<<r.z)}class ze{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){let s=F.convert(e);return new ze(K(s.lng),$(s.lat),ee(i,s.lat))}toLngLat(){return new F(se(this.x),ie(this.y))}toAltitude(){return ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/M*ue(ie(this.y))}}function Ie(r,e,i,s,a,u,p,g,b){let w=(e+s)/2,A=(i+a)/2,k=new st(w,A);g(k),(function(I,D,B,V,W,H){let J=B-W,te=V-H;return Math.abs((V-D)*J-(B-I)*te)/Math.hypot(J,te)})(k.x,k.y,u.x,u.y,p.x,p.y)>=b?(Ie(r,e,i,w,A,u,k,g,b),Ie(r,w,A,s,a,k,p,g,b)):r.push(p)}function Ge(r,e,i){let s=r[0],a=s.x,u=s.y;e(s);let p=[s];for(let g=1;g<r.length;g++){let b=r[g],{x:w,y:A}=b;e(b),Ie(p,a,u,w,A,s,b,e,i),a=w,u=A,s=b}return p}function Be(r,e,i,s){if(s(e,i)){let a=e.add(i)._mult(.5);Be(r,e,a,s),Be(r,a,i,s)}else r.push(i)}function Ye(r,e){let i=r[0],s=[i];for(let a=1;a<r.length;a++){let u=r[a];Be(s,i,u,e),i=u}return s}let gt=Math.pow(2,14)-1,De=-gt-1;function Ee(r,e){let i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=X(i,De,gt),r.y=X(s,De,gt),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&Zt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Ke(r,e,i){let s=r.loadGeometry(),a=r.extent,u=ht/a;if(e&&i&&i.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:g,x:b,y:w,projection:A}=i,k=I=>{let D=se((e.x+I.x/a)/p),B=ie((e.y+I.y/a)/p),V=A.project(D,B);I.x=(V.x*g-b)*a,I.y=(V.y*g-w)*a};for(let I=0;I<s.length;I++)if(r.type!==1)s[I]=Ge(s[I],k,1);else{let D=[];for(let B of s[I])B.x<0||B.x>=a||B.y<0||B.y>=a||(k(B),D.push(B));s[I]=D}}for(let p of s)for(let g of p)Ee(g,u);return s}function Ne(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ke(r):[]}}class nt{constructor(e,i,s,a,u){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields(xt,this,i)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let i=e.readVarint()+e.pos,s=[],a,u=1,p=0,g=0,b=0;for(;e.pos<i;){if(p<=0){let w=e.readVarint();u=7&w,p=w>>3}if(p--,u===1||u===2)g+=e.readSVarint(),b+=e.readSVarint(),u===1&&(a&&s.push(a),a=[]),a&&a.push(new st(g,b));else{if(u!==7)throw new Error(`unknown command ${u}`);a&&a.push(a[0].clone())}}return a&&s.push(a),s}bbox(){let e=this._pbf;e.pos=this._geometry;let i=e.readVarint()+e.pos,s=1,a=0,u=0,p=0,g=1/0,b=-1/0,w=1/0,A=-1/0;for(;e.pos<i;){if(a<=0){let k=e.readVarint();s=7&k,a=k>>3}if(a--,s===1||s===2)u+=e.readSVarint(),p+=e.readSVarint(),u<g&&(g=u),u>b&&(b=u),p<w&&(w=p),p>A&&(A=p);else if(s!==7)throw new Error(`unknown command ${s}`)}return[g,w,b,A]}toGeoJSON(e,i,s){let a=this.extent*Math.pow(2,s),u=this.extent*e,p=this.extent*i,g=this.loadGeometry();function b(I){return[360*(I.x+u)/a-180,360/Math.PI*Math.atan(Math.exp((1-2*(I.y+p)/a)*Math.PI))-90]}function w(I){return I.map(b)}let A;if(this.type===1){let I=[];for(let B of g)I.push(B[0]);let D=w(I);A=I.length===1?{type:"Point",coordinates:D[0]}:{type:"MultiPoint",coordinates:D}}else if(this.type===2){let I=g.map(w);A=I.length===1?{type:"LineString",coordinates:I[0]}:{type:"MultiLineString",coordinates:I}}else{if(this.type!==3)throw new Error("unknown feature type");{let I=(function(B){let V=B.length;if(V<=1)return[B];let W=[],H,J;for(let te=0;te<V;te++){let ne=Dt(B[te]);ne!==0&&(J===void 0&&(J=ne<0),J===ne<0?(H&&W.push(H),H=[B[te]]):H&&H.push(B[te]))}return H&&W.push(H),W})(g),D=[];for(let B of I)D.push(B.map(w));A=D.length===1?{type:"Polygon",coordinates:D[0]}:{type:"MultiPolygon",coordinates:D}}}let k={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function xt(r,e,i){r===1?e.id=i.readVarint():r===2?(function(s,a){let u=s.readVarint()+s.pos;for(;s.pos<u;){let p=a._keys[s.readVarint()],g=a._values[s.readVarint()];a.properties[p]=g}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function Dt(r){let e=0;for(let i,s,a=0,u=r.length,p=u-1;a<u;p=a++)i=r[a],s=r[p],e+=(s.x-i.x)*(i.y+s.y);return e}nt.types=["Unknown","Point","LineString","Polygon"];class ft{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(vt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let i=this._pbf.readVarint()+this._pbf.pos;return new nt(this._pbf,i,this.extent,this._keys,this._values)}}function vt(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(s){let a=null,u=s.readVarint()+s.pos;for(;s.pos<u;){let p=s.readVarint()>>3;a=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}if(a==null)throw new Error("unknown feature value");return a})(i))}class Ft{constructor(e,i){this.layers=e.readFields(Lt,{},i)}}function Lt(r,e,i){if(r===3){let s=new ft(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}let It="3d_elevation_id",zt="level";class Yt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,a){let u=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&u!==void 0&&!Number.isNaN(u)?s(a?a(u):u):i&&(this._valid=!1),this}}class zi{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}let Ui=new zi(((r,e,i)=>r.reset(e).require(It,(s=>{i.id=s})).optional("fixed_height_relative",(s=>{i.constantHeight=s}),si.decodeRelativeHeight).geometry((s=>{i.bounds=s}),Da).success()),((r,e,i)=>r.reset(e).require(It,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height_relative",(s=>{i.height=s}),si.decodeRelativeHeight).geometry((s=>{i.position=s}),si.getPoint).success())),xr=new zi(((r,e,i)=>r.reset(e).require(It,(s=>{i.id=s})).optional("fixed_height",(s=>{i.constantHeight=s}),si.decodeMetricHeight).geometry((s=>{i.bounds=s}),Da).success()),((r,e,i)=>r.reset(e).require(It,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height",(s=>{i.height=s}),si.decodeMetricHeight).geometry((s=>{i.position=s}),si.getPoint).success()));class si{static getPoint(e){return Ia(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?xr:void 0:Ui}static parse(e){let i=[],s=[],a=e.length,u=new Yt;for(let p=0;p<a;p++){let g=e.feature(p),b=g.properties.version,w=si.getVersionSchema(b);if(w===void 0){Zt(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}let A=g.properties.type;if(!A)continue;let k=nt.types[g.type];if(k==="Point"&&A==="curve_point"){let I={};w.parseVertex(u,g,I)&&i.push(I)}else if(k==="Polygon"&&A==="curve_meta"){let I={};w.parseFeature(u,g,I)&&s.push(I)}}return{vertices:i,features:s}}}class ji{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){let a=Pa(i,this.dir);if(Math.abs(a)<1e-6)return!1;let u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,!0}}class yi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){let a=_n(i,this.dir);if(Math.abs(a)<1e-6)return!1;let u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,s){if((function(D,B){var V=D[0],W=D[1],H=D[2],J=B[0],te=B[1],ne=B[2];return Math.abs(V-J)<=R*Math.max(1,Math.abs(V),Math.abs(J))&&Math.abs(W-te)<=R*Math.max(1,Math.abs(W),Math.abs(te))&&Math.abs(H-ne)<=R*Math.max(1,Math.abs(H),Math.abs(ne))})(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;let[a,u,p]=this.dir,g=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],A=a*a+u*u+p*p,k=2*(g*a+b*u+w*p),I=k*k-4*A*(g*g+b*b+w*w-i*i);if(I<0){let D=Math.max(-k/2,0),B=g+a*D,V=b+u*D,W=w+p*D,H=Math.hypot(B,V,W);return s[0]=B*i/H,s[1]=V*i/H,s[2]=W*i/H,!1}{let D=(-k-Math.sqrt(I))/(2*A);if(D<0){let B=Math.hypot(g,b,w);return s[0]=g*i/B,s[1]=b*i/B,s[2]=w*i/B,!1}return s[0]=g+a*D,s[1]=b+u*D,s[2]=w+p*D,!0}}}class gr{constructor(e,i,s,a,u){this.TL=e,this.TR=i,this.BR=s,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,i,s){let a=[-1,1,1],u=[1,1,1],p=[1,-1,1],g=[-1,-1,1],b=Wr(a,a,e),w=Wr(u,u,e),A=Wr(p,p,e),k=Wr(g,g,e);return new gr(b,w,A,k,i/s)}}function qi(r,e,i){let s=1/0,a=-1/0,u=[];for(let p of r){on(u,p,e);let g=_n(u,i);s=Math.min(s,g),a=Math.max(a,g)}return[s,a]}function Ir(r,e){let i=!0;for(let s=0;s<r.planes.length;s++){let a=r.planes[s],u=0;for(let p=0;p<e.length;p++)u+=+(_n(a,e[p])+a[3]>=0);if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function Ji(r,e){for(let i of r.projections){let s=qi(e,r.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function xi(r,e){let i=0,s=[0,0,0,0];for(let p=0;p<r.length;p++)s[0]=r[p][0],s[1]=r[p][1],s[2]=r[p][2],s[3]=1,(a=s)[0]*(u=e)[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]>=0&&i++;var a,u;return i}class dr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=wi.fromPoints(this.points),this.projections=[],this.frustumEdges=[on([],this.points[2],this.points[3]),on([],this.points[0],this.points[3]),on([],this.points[4],this.points[0]),on([],this.points[5],this.points[1]),on([],this.points[6],this.points[2]),on([],this.points[7],this.points[3])];for(let s of this.frustumEdges){let a=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:a,projection:qi(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:qi(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,s,a){let u=Math.pow(2,s),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((w=>{let A=_o([],w,e),k=1/A[3]/i*u;return(I=A)[0]=(D=A)[0]*(B=[k,k,a?1/A[3]:k,k])[0],I[1]=D[1]*B[1],I[2]=D[2]*B[2],I[3]=D[3]*B[3],I;var I,D,B})),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((w=>{let A=Er([],Mn([],on([],p[w[0]],p[w[1]]),on([],p[w[2]],p[w[1]]))),k=-_n(A,p[w[1]]);return A.concat(k)})),b=[];for(let w=0;w<p.length;w++)b.push([p[w][0],p[w][1],p[w][2]]);return new dr(b,g)}intersectsPrecise(e,i,s){for(let a=0;a<i.length;a++)if(!xi(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!xi(e,this.planes[a]))return 0;for(let a of s)for(let u of this.frustumEdges){let p=Mn([],a,u),g=kr(p);if(g===0)continue;er(p,p,1/g);let b=qi(this.points,this.points[0],p),w=qi(e,this.points[0],p);if(b[0]>w[1]||w[0]>b[1])return 0}return 1}containsPoint(e){for(let i of this.planes){let s=i[3];if(_n([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class wi{static fromPoints(e){let i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(let a of e)Dr(i,i,a),gn(s,s,a);return new wi(i,s)}static fromTileIdAndHeight(e,i,s){let a=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new wi([u/a,p/a,i],[(u+1)/a,(p+1)/a,s])}static applyTransform(e,i){let s=e.getCorners();for(let a=0;a<s.length;++a)Wr(s[a],s[a],i);return wi.fromPoints(s)}static applyTransformFast(e,i){let s=[i[12],i[13],i[14]],a=[...s];for(let u=0;u<3;u++)for(let p=0;p<3;p++){let g=i[4*p+u],b=g*e.min[p],w=g*e.max[p];s[u]+=Math.min(b,w),a[u]+=Math.max(b,w)}return new wi(s,a)}static projectAabbCorners(e,i){let s=e.getCorners();for(let a=0;a<s.length;++a)Wr(s[a],s[a],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=er([],oi([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],s=Di(this.min),a=Di(this.max);for(let u=0;u<i.length;u++)s[u]=i[u]?this.min[u]:this.center[u],a[u]=i[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new wi(s,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ir(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ir(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ji(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ji(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ot(wi,"Aabb");class Fr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){let e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],a=-i[0],u=(e.extent+1)*this.metersToTile;return[new st(Math.trunc(e.position[0]+s*u),Math.trunc(e.position[1]+a*u)),new st(Math.trunc(e.position[0]-s*u),Math.trunc(e.position[1]-a*u))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class hr{constructor(e,i,s,a,u,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[xn(),xn(),xn(),xn(),xn(),xn(),xn()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=u,this.edges=this.edges.filter((g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((b=this.vertices[g.a].position)[0]===(w=this.vertices[g.b].position)[0]&&b[1]===w[1]);var b,w})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let g of this.vertices)this.vertexProps.push({dir:Ia(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(let g of this.edges){let b=this.vertices[g.a].position,w=this.vertices[g.b].position,A=_s(xn(),w,b),k=Gr(A),I=is(xn(),A,1/k);this.edgeProps.push({vec:A,dir:I,len:k});let D=this.vertexProps[g.a].dir,B=this.vertexProps[g.b].dir;qo(D,D,I),qo(B,B,I)}for(let g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||Gn(g.dir,g.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;let i=this.getClosestEdge(e);if(i==null)return 0;let[s,a]=i;return $t(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,a)}computeSlopeNormal(e,i){let s=this.getClosestEdge(e);if(!s)return Si(0,0,1);let a=s[0],u=this.edges[a],p=this.edgeProps[a].vec,g=Si(p[0],p[1],(this.vertices[u.b].height-this.vertices[u.a].height)*i),b=Si(g[1],-g[0],0);Mn(b,b,g);let w=kr(b);return w>0?er(b,b,1/w):Ai(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,a=0,[u,p,g,b,w,A,k]=this._tmpVec2;El(k,e.x,e.y);let I=new ji(k,null);for(let D=0;D<this.edges.length;D++){let B=this.edges[D],V=this.edgeProps[D].dir;I.dir=V;let W=this.vertices[B.a].position,H=this.vertices[B.b].position,J=I.intersectsPlane(W,this.vertexProps[B.a].dir,u),te=I.intersectsPlane(H,this.vertexProps[B.b].dir,p);if(!J||!te)continue;_s(g,p,u),_s(b,k,u);let ne=Pa(g,g),_e=ne>0?Pa(b,g)/ne:0,de=X(_e,0,1),xe=Math.abs((_e-de)*this.edgeProps[D].len);_s(w,k,W),El(A,V[1],-V[0]);let Ce=xe+Math.abs(Pa(w,A));Ce<s&&(i=D,s=Ce,a=de)}return[i,a]}tessellate(e){let i=hi(),s=hi(),a=hi(),u=hi();for(let p=this.edges.length-1;p>=0;--p){let g=this.edges[p].a,b=this.edges[p].b,{position:w,height:A,extent:k}=this.vertices[g],{position:I,height:D,extent:B}=this.vertices[b],V=this.vertexProps[g].dir,W=this.vertexProps[b].dir;if(Ai(i,w[0]/e,w[1]/e,A),Ai(s,I[0]/e,I[1]/e,D),Ai(a,V[1],-V[0],0),er(a,a,k),Ai(u,W[1],-W[0],0),er(u,u,B),this.distSqLines(Si(i[0]+.5*a[0],i[1]+.5*a[1],i[2]+.5*a[2]),Si(s[0]-.5*u[0],s[1]-.5*u[1],s[2]-.5*u[2]),Si(i[0]-.5*a[0],i[1]-.5*a[1],i[2]-.5*a[2]),Si(s[0]+.5*u[0],s[1]+.5*u[1],s[2]+.5*u[2]))<=.0025000000000000005)continue;let H=this.vertices.length,J=qo(xn(),w,I);this.vertices.push({position:is(J,J,.5),height:.5*(A+D),extent:.5*(k+B)});let te=qo(xn(),V,W);this.vertexProps.push({dir:Gn(te,te)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:g,b:H}),this.edges.push({a:H,b});let ne=_s(xn(),this.vertices[H].position,w),_e=Gr(ne),de={vec:ne,dir:is(xn(),ne,1/_e),len:_e};this.edgeProps.push(de),this.edgeProps.push(de)}}distSqLines(e,i,s,a){let u=mo(hi(),i,e),p=mo(hi(),a,s),g=mo(hi(),e,s),b=_n(u,u),w=_n(u,p),A=_n(u,g),k=_n(p,p),I=_n(p,g),D=b*k-w*w;if(D===0)return Pr(Vs(u,s,a,_n(g,p)/_n(p,p)),e);let B=(b*I-w*A)/D;return Pr(Vs(u,e,i,(w*I-A*k)/D),Vs(p,s,a,B))}}class ci{static parseFrom(e,i){let s=si.parse(e);if(!s)return[];let{vertices:a,features:u}=s,p=1/ve(i);u.sort(((A,k)=>A.id-k.id)),a.sort(((A,k)=>A.id-k.id||A.idx-k.idx)),a=a.filter(((A,k,I)=>k===I.findIndex((D=>D.id===A.id&&D.idx===A.idx))));let g=new Array,b=0,w=a.length;for(let A of u){if(A.constantHeight){g.push(new hr(A.id,A.bounds,A.constantHeight));continue}for(;b!==w&&a[b].id<A.id;)b++;if(b===w||a[b].id!==A.id)continue;let k=new Array,I=new Array,D=b;for(;b!==w&&a[b].id===A.id;){let B=a[b];if(k.push({position:B.position,height:B.height,extent:B.extent}),b!==D&&a[b-1].idx===B.idx-1){let V=b-D;I.push({a:V-1,b:V})}b++}g.push(new hr(A.id,A.bounds,void 0,k,I,p))}return g}static getElevationFeature(e,i){if(!i)return;let s=+e.properties[It];return Number.isNaN(s)?void 0:i.find((a=>a.id===s))}}class $i{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*ht,this.yOffset=(e.y*this.zScale-i.y)*ht)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){let a=this.constantElevation(i,s);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*le(0,i,e>=0?e:Math.abs(.5*e))}}Ot(hr,"ElevationFeature");class Qr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xo,this.indexArray=new Yr,this.segments=new tn,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new hl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){let u=this.layers[0],p=[],g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(let{feature:w,id:A,index:k,sourceLayerIndex:I}of e){let D=this.layers[0]._featureFilter.needGeometry,B=Ne(w,D);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),B,s))continue;let V=g?g.evaluate(B,{},s):void 0,W={id:A,properties:w.properties,type:w.type,sourceLayerIndex:I,index:k,geometry:D?B.geometry:Ke(w,s,a),patterns:{},sortKey:V};p.push(W)}g&&p.sort(((w,A)=>w.sortKey-A.sortKey));let b=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new xh,b=a.projection);for(let w of p){let{geometry:A,index:k,sourceLayerIndex:I}=w,D=e[k].feature;this.addFeature(w,A,k,i.availableImages,s,b,i.brightness,i.elevationFeatures),i.featureIndex.insert(D,A,k,I,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,a,u,p,g){this.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lv.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,av.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,a,u,p,g,b){let w;this.elevationMode!=="none"&&(w=ci.getElevationFeature(e,b));for(let A of i)for(let k of A){let I=k.x,D=k.y;if(I<0||I>=ht||D<0||D>=ht)continue;if(p){let W=p.projectTilePoint(I,D,u),H=p.upVector(u,I,D);this.addGlobeExtVertex(W,H),this.addGlobeExtVertex(W,H),this.addGlobeExtVertex(W,H),this.addGlobeExtVertex(W,H)}let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=B.vertexLength;if(this.addCircleVertex(I,D,-1,-1),this.addCircleVertex(I,D,1,-1),this.addCircleVertex(I,D,1,1),this.addCircleVertex(I,D,-1,1),this.elevationMode!=="none"){let W=w?w.pointElevation(new st(I,D)):0;this.hasElevation=this.hasElevation||W!==0;for(let H=0;H<4;H++)this.elevatedLayoutVertexArray.emplaceBack(W)}this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a,u,g,void 0,this.worldview)}addCircleVertex(e,i,s,a){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(a+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function yn(r,e){for(let i=0;i<r.length;i++)if($n(e,r[i]))return!0;for(let i=0;i<e.length;i++)if($n(r,e[i]))return!0;return!!No(r,e)}function rn(r,e,i){return!!$n(r,e)||!!ho(e,r,i)}function pn(r,e){if(r.length===1)return ea(e,r[0]);for(let i=0;i<e.length;i++){let s=e[i];for(let a=0;a<s.length;a++)if($n(r,s[a]))return!0}for(let i=0;i<r.length;i++)if(ea(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(No(r,e[i]))return!0;return!1}function Ko(r,e,i){if(r.length>1){if(No(r,e))return!0;for(let s=0;s<e.length;s++)if(ho(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(ho(r[s],e,i))return!0;return!1}function No(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){let s=r[i],a=r[i+1];for(let u=0;u<e.length-1;u++)if(uo(s,a,e[u],e[u+1]))return!0}return!1}function uo(r,e,i,s){return bi(r,i,s)!==bi(e,i,s)&&bi(r,e,i)!==bi(r,e,s)}function wo(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Is(r,e,i,s){let a=wo(r,e,s),u=wo(r,e,i);if(Math.sign(a)===Math.sign(u))return;let p=wo(i,s,r),g=p+u-a;return Math.sign(p)!==Math.sign(g)?[p/(p-g),u/(u-a)]:void 0}function ho(r,e,i){let s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let a=1;a<e.length;a++)if(Ps(r,e[a-1],e[a])<s)return!0;return!1}function Ps(r,e,i){let s=e.distSqr(i);if(s===0)return r.distSqr(e);let a=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function ea(r,e){let i,s,a,u=!1;for(let p=0;p<r.length;p++){i=r[p];for(let g=0,b=i.length-1;g<i.length;b=g++)s=i[g],a=i[b],s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(u=!u)}return u}function $n(r,e){let i=!1;for(let s=0,a=r.length-1;s<r.length;a=s++){let u=r[s],p=r[a];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(i=!i)}return i}function an(r,e,i,s,a){for(let p of r)if(e<=p.x&&i<=p.y&&s>=p.x&&a>=p.y)return!0;let u=[new st(e,i),new st(e,a),new st(s,a),new st(s,i)];if(r.length>2){for(let p of u)if($n(r,p))return!0}for(let p=0;p<r.length-1;p++)if(vn(r[p],r[p+1],u))return!0;return!1}function vn(r,e,i){let s=i[0],a=i[2];if(r.x<s.x&&e.x<s.x||r.x>a.x&&e.x>a.x||r.y<s.y&&e.y<s.y||r.y>a.y&&e.y>a.y)return!1;let u=bi(r,e,i[0]);return u!==bi(r,e,i[1])||u!==bi(r,e,i[2])||u!==bi(r,e,i[3])}function Ar(r,e,i,s,a,u){let p=e.y-r.y,g=r.x-e.x;if(u=u||0){let b=p*p+g*g;if(b===0)return!0;let w=Math.sqrt(b);p/=w,g/=w}return!((i.x-r.x)*p+(i.y-r.y)*g-u<0||(s.x-r.x)*p+(s.y-r.y)*g-u<0||(a.x-r.x)*p+(a.y-r.y)*g-u<0)}function wn(r,e,i,s,a,u,p){return!(Ar(r,e,s,a,u,p)||Ar(e,i,s,a,u,p)||Ar(i,r,s,a,u,p)||Ar(s,a,r,e,i,p)||Ar(a,u,r,e,i,p)||Ar(u,s,r,e,i,p))}function Xn(r,e,i){let s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function ln(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Ls(r,e,i,s,a){if(!e[0]&&!e[1])return r;let u=st.convert(e)._mult(a);i==="viewport"&&u._rotate(-s);let p=[];for(let g=0;g<r.length;g++)p.push(r[g].sub(u));return p}function Tu(r,e,i,s){let a=st.convert(r)._mult(s);return e==="viewport"&&a._rotate(-i),a}let ml,Cu;function Eu(r,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}Ot(Qr,"CircleBucket",{omit:["layers"]});class zs{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Ms(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){let i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){let s=(function(u,p,g){var b=Eu(256*u,256*(p=Math.pow(2,g)-p-1),g),w=Eu(256*(u+1),256*(p+1),g);return b[0]+","+b[1]+","+w[0]+","+w[1]})(this.x,this.y,this.z),a=(function(u,p,g){let b,w="";for(let A=u;A>0;A--)b=1<<A-1,w+=(p&b?1:0)+(g&b?2:0);return w})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ua{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ms(e,i.z,i.z,i.x,i.y)}}class Wn{constructor(e,i,s,a,u){this.overscaledZ=e,this.wrap=i,this.canonical=new zs(s,+a,+u),this.key=i===0&&e===s?this.canonical.key:Ms(i,e,s,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new Wn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ms(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let s=this.canonical.z-e;return Ms(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Wn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new Wn(i,this.wrap,i,s,a),new Wn(i,this.wrap,i,s+1,a),new Wn(i,this.wrap,i,s,a+1),new Wn(i,this.wrap,i,s+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Wn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Wn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ua(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ms(r,e,i,s,a){let u=1<<Math.min(i,22),p=u*(a%u)+s%u;return r&&i<22&&(p+=u*u*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}let Rc=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new Wn(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new Wn(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new Wn(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Wn(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Ot(zs,"CanonicalTileID"),Ot(Wn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let kg=Li([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zh}=kg,AO=Li([{name:"a_pos_3",components:3,type:"Int16"}]);var _1=Li([{name:"a_pos",type:"Int16",components:2}]);function Ig(r){return r*Yo/P}let kO=[new wi([_,_,_],[x,x,x]),new wi([_,_,_],[0,0,x]),new wi([0,_,_],[x,0,x]),new wi([_,0,_],[0,x,x]),new wi([0,0,_],[x,x,x])];function y1(r,e,i,s=!0){let a=er([],r._camera.position,r.worldSize),u=[e,i,1,1];_o(u,u,r.pixelMatrixInverse),na(u,u,1/u[3]);let p=Er([],on([],u,a)),g=r.globeMatrix,b=[g[12],g[13],g[14]],w=on([],b,a),A=kr(w),k=Er([],w),I=r.worldSize/(2*Math.PI),D=_n(k,p),B=Math.asin(I/A);if(B<Math.acos(D)){if(!s)return null;let He=[],Oe=[];er(He,p,A/D),Er(Oe,on(Oe,He,w)),Er(p,oi(p,w,er(p,Oe,Math.tan(B)*A)))}let V=[];new yi(a,p).closestPointOnSphere(b,I,V);let W=Er([],sn(g,0)),H=Er([],sn(g,1)),J=Er([],sn(g,2)),te=_n(W,V),ne=_n(H,V),_e=_n(J,V),de=bn(Math.asin(-ne/I)),xe=bn(Math.atan2(te,_e));xe=r.center.lng+(function(He,Oe){let Ze=(Oe-He+180)%360-180;return Ze<-180?Ze+360:Ze})(r.center.lng,xe);let Ce=K(xe),Ae=X($(de),0,1);return new ze(Ce,Ae)}class IO{constructor(e,i,s){this.a=on([],e,s),this.b=on([],i,s),this.center=s;let a=Er([],this.a),u=Er([],this.b);this.angle=Math.acos(_n(a,u))}}function _v(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(s,a,u,p){let g=Math.sin(u);return s*(Math.sin((1-p)*u)/g)+a*(Math.sin(p*u)/g)})(r.a[e],r.b[e],r.angle,X(i,0,1))+r.center[e]}function Ql(r){if(r.z<=1)return kO[r.z+2*r.y+r.x];let e=yv(Pg(r));return wi.fromPoints(e)}function Dc(r,e,i){return er(r,r,1-i),nn(r,r,e,i)}function v1(r,e,i){for(let s of r)Wr(s,s,e),er(s,s,i)}function x1(r,e,i,s){let a=e/r.worldSize,u=r.globeMatrix;if(i.z<=1){let Ae=Ql(i).getCorners();return v1(Ae,u,a),wi.fromPoints(Ae)}let p=Pg(i,s),g=yv(p,Yo+Ig(r._tileCoverLift));v1(g,u,a);let b=Number.MAX_VALUE,w=[-b,-b,-b],A=[b,b,b];if(p.contains(r.center)){for(let Oe of g)Dr(A,A,Oe),gn(w,w,Oe);w[2]=0;let Ae=r.point,He=[Ae.x*a,Ae.y*a,0];return Dr(A,A,He),gn(w,w,He),new wi(A,w)}if(r._tileCoverLift>0){for(let Ae of g)Dr(A,A,Ae),gn(w,w,Ae);return new wi(A,w)}let k=[u[12]*a,u[13]*a,u[14]*a],I=p.getCenter(),D=X(r.center.lat,-ae,ae),B=X(I.lat,-ae,ae),V=K(r.center.lng),W=$(D),H=V-K(I.lng),J=W-$(B);H>.5?H-=1:H<-.5&&(H+=1);let te=0;Math.abs(H)>Math.abs(J)?te=H>=0?1:3:(te=J>=0?0:2,nn(k,k,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Bi(J>=0?p.getSouth():p.getNorth()))*Yo));let ne=g[te],_e=g[(te+1)%4],de=new IO(ne,_e,k),xe=[_v(de,0)||ne[0],_v(de,1)||ne[1],_v(de,2)||ne[2]],Ce=Au(r.zoom);if(Ce>0){let Ae=(function({x:Oe,y:Ze,z:Je},it,_t,ct,Qe){let lt=1/(1<<Je),We=Oe*lt,Ue=We+lt,at=Ze*lt,mt=at+lt,et=0,Mt=(We+Ue)/2-ct;return Mt>.5?et=-1:Mt<-.5&&(et=1),We=((We+et)*it-(ct*=it))*_t+ct,Ue=((Ue+et)*it-ct)*_t+ct,at=(at*it-(Qe*=it))*_t+Qe,mt=(mt*it-Qe)*_t+Qe,[[We,mt,0],[Ue,mt,0],[Ue,at,0],[We,at,0]]})(i,e,r._pixelsPerMercatorPixel,V,W);for(let Oe=0;Oe<g.length;Oe++)Dc(g[Oe],Ae[Oe],Ce);let He=oi([],Ae[te],Ae[(te+1)%4]);er(He,He,.5),Dc(xe,He,Ce)}for(let Ae of g)Dr(A,A,Ae),gn(w,w,Ae);return A[2]=Math.min(ne[2],_e[2]),Dr(A,A,xe),gn(w,w,xe),new wi(A,w)}function Pg({x:r,y:e,z:i},s=!1){let a=1/(1<<i),u=new F(se(r*a),e===(1<<i)-1&&s?-90:ie((e+1)*a)),p=new F(se((r+1)*a),e===0&&s?90:ie(e*a));return new O(u,p)}function yv(r,e=Yo){let i=Bi(r.getNorth()),s=Bi(r.getSouth()),a=Math.cos(i),u=Math.cos(s),p=Math.sin(i),g=Math.sin(s),b=r.getWest(),w=r.getEast();return[S(u,g,b,e),S(u,g,w,e),S(a,p,w,e),S(a,p,b,e)]}function Af(r,e,i,s){let a=1<<i.z,u=(r/ht+i.x)/a;return E(ie((e/ht+i.y)/a),se(u),s)}function Lg({min:r,max:e}){return o/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}let b1=new Float64Array(16);function zg(r){let e=Lg(r),i=lr(b1,[e,e,e]);return qe(i,i,oo([],r.min))}function vv(r){let e=(s=r.min,(i=b1)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;let a=1/Lg(r);return St(e,e,[a,a,a])}function xv(r){let e=ht/(2*Math.PI);return r/(2*Math.PI)/e}function w1(r,e){return ht/(512*Math.pow(2,r))*Lg(Ql(e))}function S1(r,e,i,s,a){let u=xv(i),p=[r,e,-i/(2*Math.PI)],g=Re(new Float64Array(16));return qe(g,g,p),St(g,g,[u,u,u]),ai(g,g,Bi(-a)),pi(g,g,Bi(-s)),g}function Au(r){return le(l,t,r)}function T1(r,e){let i=E(e.lat,e.lng),s=(function(B){let V=E(B._center.lat,B._center.lng),W=Mn([],Si(0,1,0),V),H=bt([],-B.angle,V);W=Wr(W,W,H),bt(H,-B._pitch,W);let J=Er([],V);return er(J,J,Ig(B.cameraToCenterDistance/B.pixelsPerMeter)),Wr(J,J,H),oi([],V,J)})(r);return p=(a=mo([],s,i))[0],g=a[1],b=a[2],w=(u=i)[0],A=u[1],k=u[2],D=(I=Math.sqrt((p*p+g*g+b*b)*(w*w+A*A+k*k)))&&_n(a,u)/I,Math.acos(Math.min(Math.max(D,-1),1));var a,u,p,g,b,w,A,k,I,D}function bv(r,e){return T1(r,e)>Math.PI/2*1.01}let C1=Bi(85),PO=Math.cos(C1),LO=Math.sin(C1),zO=oe(),E1=r=>{let e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function A1(r,e,i,s,a,u,p,g,b){if(u&&r.queryGeometry.isAboveHorizon)return!1;u&&(b*=r.pixelToTileUnitsFactor);let w=r.tileID.canonical,A=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(let k of e)for(let I of k){let D=I.add(g),B=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(D.x,D.y,!0):0,V=i.projection.projectTilePoint(D.x,D.y,w);if(B>0){let te=i.projection.upVector(w,D.x,D.y);V.x+=te[0]*A*B,V.y+=te[1]*A*B,V.z+=te[2]*A*B}let W=u?D:MO(V.x,V.y,V.z,s),H=u?r.tilespaceRays.map((te=>RO(te,B))):r.queryGeometry.screenGeometry,J=_o([],[V.x,V.y,V.z,1],s);if(!p&&u?b*=J[3]/i.cameraToCenterDistance:p&&!u&&(b*=i.cameraToCenterDistance/J[3]),u){let te=ie((I.y/ht+w.y)/(1<<w.z));b/=i.projection.pixelsPerMeter(te,1)/ee(1,te)}if(rn(H,W,b))return!0}return!1}function MO(r,e,i,s){let a=_o([],[r,e,i,1],s);return new st(a[0]/a[3],a[1]/a[3])}let k1=Si(0,0,0),OO=Si(0,0,1);function RO(r,e){let i=hi();return k1[2]=e,r.intersectsPlane(k1,OO,i),new st(i[0],i[1])}class I1 extends Qr{}let P1,L1,z1,M1;function O1(r,{width:e,height:i},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=a,r}function R1(r,e,i){let{width:s,height:a}=e;s===r.width&&a===r.height||(wv(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,a)},i,null),r.width=s,r.height=a,r.data=e.data)}function wv(r,e,i,s,a,u,p,g){if(a.width===0||a.height===0)return e;if(a.width>r.width||a.height>r.height||i.x>r.width-a.width||i.y>r.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||s.x>e.width-a.width||s.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");let b=r.data,w=e.data,A=u===4&&g;for(let k=0;k<a.height;k++){let I=((i.y+k)*r.width+i.x)*u,D=((s.y+k)*e.width+s.x)*u;if(A)for(let B=0;B<a.width;B++){let V=I+B*u+3,W=D+B*u;w[W+0]=255,w[W+1]=255,w[W+2]=255,w[W+3]=b[V]}else if(p)for(let B=0;B<a.width;B++){let V=I+B*u,W=D+B*u,H=new cr(b[V+0]/255,b[V+1]/255,b[V+2]/255,b[V+3]).toNonPremultipliedRenderColor(p).toArray();w[W+0]=H[0],w[W+1]=H[1],w[W+2]=H[2],w[W+3]=H[3]}else for(let B=0;B<a.width*u;B++)w[D+B]=b[I+B]}return e}Ot(I1,"HeatmapBucket",{omit:["layers"]});class ku{constructor(e,i){O1(this,e,1,i)}resize(e){R1(this,new ku(e),1)}clone(){return new ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u){wv(e,i,s,a,u,1,null)}}class So{constructor(e,i){O1(this,e,4,i)}resize(e){R1(this,new So(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u,p,g){wv(e,i,s,a,u,4,p,g)}}class D1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function kf(r){let e={},i=r.resolution||256,s=r.clips?r.clips.length:1,a=r.image||new So({width:i,height:s}),u=(p,g,b)=>{e[r.evaluationKey]=b;let w=r.expression.evaluate(e),A=w?w.toNonPremultipliedRenderColor(null):null;A&&(a.data[p+g+0]=Math.floor(255*A.r),a.data[p+g+1]=Math.floor(255*A.g),a.data[p+g+2]=Math.floor(255*A.b),a.data[p+g+3]=Math.floor(255*A.a))};if(r.clips)for(let p=0,g=0;p<s;++p,g+=4*i)for(let b=0,w=0;b<i;b++,w+=4){let A=b/(i-1),{start:k,end:I}=r.clips[p];u(g,w,k*(1-A)+I*A)}else for(let p=0,g=0;p<i;p++,g+=4)u(0,g,p/(i-1));return a}Ot(ku,"AlphaImage"),Ot(So,"RGBAImage");let DO=Li([{name:"a_pos",components:2,type:"Int16"}],4),BO=Li([{name:"a_road_z_offset",components:1,type:"Float32"}],4),FO=Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),NO=Li([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Mh(r,e,i=2){let s=e&&e.length,a=s?e[0]*i:r.length,u=B1(r,0,a,i,!0),p=[];if(!u||u.next===u.prev)return p;let g,b,w;if(s&&(u=(function(A,k,I,D){let B=[];for(let V=0,W=k.length;V<W;V++){let H=B1(A,k[V]*D,V<W-1?k[V+1]*D:A.length,D,!1);H===H.next&&(H.steiner=!0),B.push(ZO(H))}B.sort(WO);for(let V=0;V<B.length;V++)I=GO(B[V],I);return I})(r,e,u,i)),r.length>80*i){g=r[0],b=r[1];let A=g,k=b;for(let I=i;I<a;I+=i){let D=r[I],B=r[I+1];D<g&&(g=D),B<b&&(b=B),D>A&&(A=D),B>k&&(k=B)}w=Math.max(A-g,k-b),w=w!==0?32767/w:0}return If(u,p,i,g,b,w,0),p}function B1(r,e,i,s,a){let u;if(a===(function(p,g,b,w){let A=0;for(let k=g,I=b-w;k<b;k+=w)A+=(p[I]-p[k])*(p[k+1]+p[I+1]),I=k;return A})(r,e,i,s)>0)for(let p=e;p<i;p+=s)u=V1(p/s|0,r[p],r[p+1],u);else for(let p=i-s;p>=e;p-=s)u=V1(p/s|0,r[p],r[p+1],u);return u&&Oh(u,u.next)&&(zf(u),u=u.next),u}function wd(r,e){if(!r)return r;e||(e=r);let i,s=r;do if(i=!1,s.steiner||!Oh(s,s.next)&&Yn(s.prev,s,s.next)!==0)s=s.next;else{if(zf(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function If(r,e,i,s,a,u,p){if(!r)return;!p&&u&&(function(b,w,A,k){let I=b;do I.z===0&&(I.z=Sv(I.x,I.y,w,A,k)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==b);I.prevZ.nextZ=null,I.prevZ=null,(function(D){let B,V=1;do{let W,H=D;D=null;let J=null;for(B=0;H;){B++;let te=H,ne=0;for(let de=0;de<V&&(ne++,te=te.nextZ,te);de++);let _e=V;for(;ne>0||_e>0&&te;)ne!==0&&(_e===0||!te||H.z<=te.z)?(W=H,H=H.nextZ,ne--):(W=te,te=te.nextZ,_e--),J?J.nextZ=W:D=W,W.prevZ=J,J=W;H=te}J.nextZ=null,V*=2}while(B>1)})(I)})(r,s,a,u);let g=r;for(;r.prev!==r.next;){let b=r.prev,w=r.next;if(u?VO(r,s,a,u):jO(r))e.push(b.i,r.i,w.i),zf(r),r=w.next,g=w.next;else if((r=w)===g){p?p===1?If(r=UO(wd(r),e),e,i,s,a,u,2):p===2&&qO(r,e,i,s,a,u):If(wd(r),e,i,s,a,u,1);break}}}function jO(r){let e=r.prev,i=r,s=r.next;if(Yn(e,i,s)>=0)return!1;let a=e.x,u=i.x,p=s.x,g=e.y,b=i.y,w=s.y,A=Math.min(a,u,p),k=Math.min(g,b,w),I=Math.max(a,u,p),D=Math.max(g,b,w),B=s.next;for(;B!==e;){if(B.x>=A&&B.x<=I&&B.y>=k&&B.y<=D&&Pf(a,g,u,b,p,w,B.x,B.y)&&Yn(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function VO(r,e,i,s){let a=r.prev,u=r,p=r.next;if(Yn(a,u,p)>=0)return!1;let g=a.x,b=u.x,w=p.x,A=a.y,k=u.y,I=p.y,D=Math.min(g,b,w),B=Math.min(A,k,I),V=Math.max(g,b,w),W=Math.max(A,k,I),H=Sv(D,B,e,i,s),J=Sv(V,W,e,i,s),te=r.prevZ,ne=r.nextZ;for(;te&&te.z>=H&&ne&&ne.z<=J;){if(te.x>=D&&te.x<=V&&te.y>=B&&te.y<=W&&te!==a&&te!==p&&Pf(g,A,b,k,w,I,te.x,te.y)&&Yn(te.prev,te,te.next)>=0||(te=te.prevZ,ne.x>=D&&ne.x<=V&&ne.y>=B&&ne.y<=W&&ne!==a&&ne!==p&&Pf(g,A,b,k,w,I,ne.x,ne.y)&&Yn(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;te&&te.z>=H;){if(te.x>=D&&te.x<=V&&te.y>=B&&te.y<=W&&te!==a&&te!==p&&Pf(g,A,b,k,w,I,te.x,te.y)&&Yn(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ne&&ne.z<=J;){if(ne.x>=D&&ne.x<=V&&ne.y>=B&&ne.y<=W&&ne!==a&&ne!==p&&Pf(g,A,b,k,w,I,ne.x,ne.y)&&Yn(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function UO(r,e){let i=r;do{let s=i.prev,a=i.next.next;!Oh(s,a)&&N1(s,i,i.next,a)&&Lf(s,a)&&Lf(a,s)&&(e.push(s.i,i.i,a.i),zf(i),zf(i.next),i=r=a),i=i.next}while(i!==r);return wd(i)}function qO(r,e,i,s,a,u){let p=r;do{let g=p.next.next;for(;g!==p.prev;){if(p.i!==g.i&&$O(p,g)){let b=j1(p,g);return p=wd(p,p.next),b=wd(b,b.next),If(p,e,i,s,a,u,0),void If(b,e,i,s,a,u,0)}g=g.next}p=p.next}while(p!==r)}function WO(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function GO(r,e){let i=(function(a,u){let p=u,g=a.x,b=a.y,w,A=-1/0;if(Oh(a,p))return p;do{if(Oh(a,p.next))return p.next;if(b<=p.y&&b>=p.next.y&&p.next.y!==p.y){let V=p.x+(b-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(V<=g&&V>A&&(A=V,w=p.x<p.next.x?p:p.next,V===g))return w}p=p.next}while(p!==u);if(!w)return null;let k=w,I=w.x,D=w.y,B=1/0;p=w;do{if(g>=p.x&&p.x>=I&&g!==p.x&&F1(b<D?g:A,b,I,D,b<D?A:g,b,p.x,p.y)){let V=Math.abs(b-p.y)/(g-p.x);Lf(p,a)&&(V<B||V===B&&(p.x>w.x||p.x===w.x&&HO(w,p)))&&(w=p,B=V)}p=p.next}while(p!==k);return w})(r,e);if(!i)return e;let s=j1(i,r);return wd(s,s.next),wd(i,i.next)}function HO(r,e){return Yn(r.prev,r,e.prev)<0&&Yn(e.next,r,r.next)<0}function Sv(r,e,i,s,a){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*a|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ZO(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function F1(r,e,i,s,a,u,p,g){return(a-p)*(e-g)>=(r-p)*(u-g)&&(r-p)*(s-g)>=(i-p)*(e-g)&&(i-p)*(u-g)>=(a-p)*(s-g)}function Pf(r,e,i,s,a,u,p,g){return!(r===p&&e===g)&&F1(r,e,i,s,a,u,p,g)}function $O(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,s){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==s.i&&a.next.i!==s.i&&N1(a,a.next,i,s))return!0;a=a.next}while(a!==i);return!1})(r,e)&&(Lf(r,e)&&Lf(e,r)&&(function(i,s){let a=i,u=!1,p=(i.x+s.x)/2,g=(i.y+s.y)/2;do a.y>g!=a.next.y>g&&a.next.y!==a.y&&p<(a.next.x-a.x)*(g-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==i);return u})(r,e)&&(Yn(r.prev,r,e.prev)||Yn(r,e.prev,e))||Oh(r,e)&&Yn(r.prev,r,r.next)>0&&Yn(e.prev,e,e.next)>0)}function Yn(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Oh(r,e){return r.x===e.x&&r.y===e.y}function N1(r,e,i,s){let a=Og(Yn(r,e,i)),u=Og(Yn(r,e,s)),p=Og(Yn(i,s,r)),g=Og(Yn(i,s,e));return a!==u&&p!==g||!(a!==0||!Mg(r,i,e))||!(u!==0||!Mg(r,s,e))||!(p!==0||!Mg(i,r,s))||!(g!==0||!Mg(i,e,s))}function Mg(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Og(r){return r>0?1:r<0?-1:0}function Lf(r,e){return Yn(r.prev,r,r.next)<0?Yn(r,e,r.next)>=0&&Yn(r,r.prev,e)>=0:Yn(r,e,r.prev)<0||Yn(r,r.next,e)<0}function j1(r,e){let i=Tv(r.i,r.x,r.y),s=Tv(e.i,e.x,e.y),a=r.next,u=e.prev;return r.next=e,e.prev=r,i.next=a,a.prev=i,s.next=i,i.prev=s,u.next=s,s.prev=u,s}function V1(r,e,i,s){let a=Tv(r,e,i);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function zf(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Tv(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mf(r,e){let i=r.length;if(i<=1)return[r];let s=[],a,u;for(let p=0;p<i;p++){let g=Ci(r[p]);g!==0&&(r[p].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(a&&s.push(a),a=[r[p]]):a.push(r[p]))}if(a&&s.push(a),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(Zs(s[p],e,1,s[p].length-1,XO),s[p]=s[p].slice(0,e));return s}function XO(r,e){return e.area-r.area}function U1(r,e,i=1){if(!r)return null;let s=typeof r=="string"?Io.from(r).getPrimary():r.getPrimary(),a=typeof r=="string"?null:r.getSecondary();for(let u of[s,a]){if(!u)continue;let p=u.id.toString();e.has(p)||e.set(p,[]),u.scaleSelf(i),e.get(p).push(u)}return{primary:s.toString(),secondary:a?a.toString():null}}function Cv(r,e,i,s){let a=s.patternDependencies,u=!1;for(let p of e){let g=p.paint.get(`${r}-pattern`);g.isConstant()||(u=!0),U1(g.constantOr(null),a,i)&&(u=!0)}return u}function Ev(r,e,i,s,a,u){let p=u.patternDependencies;for(let g of e){let b=g.paint.get(`${r}-pattern`).value;if(b.kind!=="constant"){let w=b.evaluate({zoom:s},i,{},u.availableImages);w=w&&w.name?w.name:w;let A=U1(w,p,a);if(!A)continue;let{primary:k,secondary:I}=A;k&&(i.patterns[g.id]=[k,I].filter(Boolean))}}return i}class q1{constructor(){this.polygons=new Map}add(e,...i){let s=this.polygons.get(e);s?s.push(...i):this.polygons.set(e,i)}merge(e){for(let[i,s]of e.polygons)this.add(i,...s)}}class Bc{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=ht&&i>=ht}static evaluate(e){if(e.length===0)return new Bc;let i=[];for(let b of e)i.push(...b.portals);if(i.length===0)return new Bc;for(let b of i){let w=b.va,A=b.vb;(Bc.isOnBorder(w.x,A.x)||Bc.isOnBorder(w.y,A.y))&&(b.type="border")}let s=i.filter((b=>b.type!=="unevaluated")),a=i.filter((b=>b.type==="unevaluated"));if(a.length===0)return new Bc;a.sort(((b,w)=>b.hash===w.hash?b.isTunnel===w.isTunnel?0:b.isTunnel?-1:1:b.hash<w.hash?1:-1)),i=s.concat(a);let u=s.length,p=u,g=u;do if(p++,p===i.length||i[u].hash!==i[p].hash){if(p-u==2){g<u&&(i[g]=i[u],i[u]=null);let b=i[g],w=i[p-1];b.type=b.isTunnel!==w.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:w.connection.a},g++}u=p}while(u!==i.length);return i.splice(g),i.sort(((b,w)=>b.hash<w.hash?1:-1)),{portals:i}}}Ot(Bc,"ElevationPortalGraph"),Ot(q1,"ElevationPolygons");class YO{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let a=e[2];s!=null&&(a*=s);let u=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,p=this.vertexLookup.get(u);if(p!=null)return p;let g=this.outPositions.length;this.vertexLookup.set(u,g);let b=Math.trunc(16384*i[0]),w=Math.trunc(16384*i[1]),A=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(b,w,A),g}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;let a=s.length===1,u=hi(),p=hi();for(let g=0;g<e.length;g+=3){let b=i[e[g+0]],w=i[e[g+1]],A=i[e[g+2]],k=a?s[0]:s[e[g+1]],I=a?s[0]:s[e[g+2]];Ai(u,b.x,b.y,a?s[0]:s[e[g+0]]);let D=this.addVertex(u,p);Ai(u,w.x,w.y,k);let B=this.addVertex(u,p);Ai(u,A.x,A.y,I);let V=this.addVertex(u,p);this.outIndices.emplaceBack(D,B,V)}}addQuad(e,i,s,a,u,p){let g=this.addVertex(e,u,p),b=this.addVertex(i,u,p),w=this.addVertex(s,u,p),A=this.addVertex(a,u,p);this.addTriangle(g,b,w),this.addTriangle(w,A,g)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Os{constructor(e,i,s,a){this.unevaluatedPortals=new Bc,this.portalPolygons=new q1,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new cf,this.vertexNormals=new uf,this.indexArray=new Yr,this.tileToMeters=ve(e),this.bridgeProgramConfigurations=new ya(i,{zoom:s,lut:a},(u=>u!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new ya(i,{zoom:s,lut:a},(u=>u!=="fill-bridge-guard-rail-color"))}addVertices(e,i){let s=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(i[a]);return s}addTriangles(e,i,s){let a=s?this.unevalTunnelTriangles:this.unevalTriangles;for(let u of e)a.push(u+i)}addRenderableRing(e,i,s,a,u,p){let g=[new st(u.min.x,u.min.y),new st(u.max.x,u.min.y),new st(u.max.x,u.max.y),new st(u.min.x,u.max.y)];for(let b=0;b<s-1;b++){let w=i+b,A=w+1,k=this.unevalVertices[w],I=this.unevalVertices[A];if(!(k.x>=u.min.x&&k.x<=u.max.x&&k.y>=u.min.y&&k.y<=u.max.y||I.x>=u.min.x&&I.x<=u.max.x&&I.y>=u.min.y&&I.y<=u.max.y||vn(k,I,g))||this.isOnBorder(k.x,I.x)||this.isOnBorder(k.y,I.y))continue;let D=Os.computeEdgeHash(this.unevalVertices[w],this.unevalVertices[A]),B,V=this.vertexHashLookup.get(Os.computePosHash(k));V!=null?B=V.next:(V=this.vertexHashLookup.get(Os.computePosHash(I)),B=V!=null?V.prev:D),this.unevalEdges.push({polygonIdx:e,a:w,b:A,hash:D,portalHash:B,isTunnel:a,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,s,a,u){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:u});let p=i[0];this.vertexHashLookup.clear();let g=Os.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let b=0;b<p.length-1;b++){let w=p[b+0],A=p[b+1],k=Ia(A.x-w.x,A.y-w.y),I=Gr(k);if(I===0)continue;let D="unevaluated",B=a.pointElevation(w),V=a.pointElevation(A);Math.abs(B)<.01&&Math.abs(V)<.01?D="entrance":(this.isOnBorder(w.x,A.x)||this.isOnBorder(w.y,A.y))&&(D="border");let W=Os.computeEdgeHash(w,A);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:w,vb:A,vab:k,length:I,hash:W,isTunnel:s,type:D});let H=Os.computePosHash(w);this.vertexHashLookup.set(H,{prev:g,next:W}),g=W}}construct(e){if(this.unevalVertices.length===0)return;let i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=I=>{I.primitiveLength=this.indexArray.length-I.primitiveOffset},a=new YO(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);let u=i(),p=i(),g=i(),b=(I,D)=>{I.sort(((V,W)=>V.type===D&&W.type!==D?-1:V.type!==D&&W.type===D?1:0));let B=I.findIndex((V=>V.type!==D));return B>=0?B:I.length},w=0;this.unevalEdges.length>0&&(w=b(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},this.tileToMeters)),s(g);let A=i(),k=i();if(this.unevalEdges.length>0){let I=this.unevalEdges.splice(w),D=b(I,"tunnel")+w;this.unevalEdges.push(...I),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},{min:w,max:D})}s(A),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(k),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(p),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(u),this.maskSegments=tn.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.depthSegments=tn.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=tn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableTunnelSegments=tn.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=tn.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength)}update(e,i,s,a,u,p,g,b){this.bridgeProgramConfigurations.updatePaintArrays(e,i,u,s,a,p,g,b),this.tunnelProgramConfigurations.updatePaintArrays(e,i,u,s,a,p,g,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,FO.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,NO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,a,u){let p=(g,b)=>{for(let w=0;w<b.length-1;w++){let A=b[w].featureIndex,k=b[w+1].vertexStart,I=e.feature(A);g.populatePaintArrays(k,I,A,{},s,i,a,void 0,u)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,a,u){let p=new Map;for(let g=a;g<u;g++){let b=s[g],w=b.a,A=b.b,k=Os.computePosHash(e[w]),I=Os.computePosHash(e[A]),D=p.get(k);D||(D={},p.set(k,D));let B=p.get(I);B||(B={},p.set(I,B)),i[w]<=0&&i[A]<=0||(D.to=A,B.from=w)}return p}isTerminalVertex(e,i){let s=Os.computePosHash(this.unevalVertices[e]),a=i.get(s);return!a||!a.from||!a.to}constructBridgeStructures(e,i,s,a,u,p){e.clearVertexLookup();let g=this.computeVertexConnections(i,s,a,u.min,u.max),b=1/p,w=.5*b,A=(_t,ct)=>Ai(_t,i[ct].x,i[ct].y,s[ct]*b),k=hi(),I=hi(),D=hi(),B=hi(),V=hi(),W=(_t,ct)=>{let Qe=g.get(Os.computePosHash(i[ct])),lt=Qe.from,We=Qe.to;if(!lt||!We)return;A(k,lt),A(I,ct),A(D,We),Qo(B),es(k,I)||(on(V,I,k),Er(B,V)),es(D,I)||(on(V,D,I),oi(B,B,Er(V,V)));let Ue=Ca(B);return Ue>0?er(_t,B,1/Ue):void 0},H=Number.POSITIVE_INFINITY;this.sortSubarray(a,u.min,u.max,((_t,ct)=>_t.featureInfo.featureIndex-ct.featureInfo.featureIndex));let J=hi(),te=hi(),ne=hi(),_e=hi(),de=hi(),xe=hi(),Ce=hi(),Ae=hi(),He=hi(),Oe=[hi(),hi(),hi(),hi()],Ze=[hi(),hi(),hi(),hi()],Je=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],it=(_t,ct)=>_t>ct;for(let _t=u.min;_t<u.max;_t++){let ct=a[_t];if(!ct.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Je,i,s,ct,it))continue;let[Qe,lt]=Je;if(Ai(J,Qe.coord.x,Qe.coord.y,b*Qe.height),Ai(te,lt.coord.x,lt.coord.y,b*lt.height),es(J,te))continue;on(ne,te,J),Er(ne,ne);let We=W(Ae,ct.a)||ne,Ue=W(He,ct.b)||ne;Ai(_e,We[1],-We[0],0),Er(_e,_e),Ai(de,Ue[1],-Ue[0],0),Er(de,de),Mn(Ae,_e,We),Er(xe,Ae),Mn(Ae,de,Ue),Er(Ce,Ae),oi(Oe[0],J,er(Ae,on(Ae,_e,xe),w)),oi(Oe[1],J,er(Ae,oi(Ae,_e,xe),w)),oi(Oe[2],J,er(Ae,xe,w)),Oe[3]=J,oi(Ze[0],te,er(Ae,on(Ae,de,Ce),w)),oi(Ze[1],te,er(Ae,oi(Ae,de,Ce),w)),oi(Ze[2],te,er(Ae,Ce,w)),Ze[3]=te,H=this.addFeatureSection(ct.featureInfo.featureIndex,H,this.bridgeFeatureSections,e);let at=e.addVertex(Oe[0],_e,p),mt=e.addVertex(Oe[1],_e,p),et=e.addVertex(Ze[0],de,p),Mt=e.addVertex(Ze[1],de,p);e.addTriangle(at,mt,et),e.addTriangle(mt,Mt,et);let Bt=e.addVertex(Oe[1],xe,p),Pt=e.addVertex(Oe[2],xe,p),Ct=e.addVertex(Ze[1],Ce,p),ui=e.addVertex(Ze[2],Ce,p);e.addTriangle(Bt,Pt,Ct),e.addTriangle(Pt,ui,Ct),oo(_e,_e),oo(de,de);let At=e.addVertex(Oe[2],_e,p),Ht=e.addVertex(Oe[3],_e,p),di=e.addVertex(Ze[2],de,p),Ti=e.addVertex(Ze[3],de,p);e.addTriangle(At,Ht,di),e.addTriangle(Ht,Ti,di);let Xi=this.isTerminalVertex(ct.a,g),mi=this.isTerminalVertex(ct.b,g);Qe.height<.01&&Xi&&e.addQuad(Oe[3],Oe[2],Oe[1],Oe[0],oo(We,We),p),lt.height<.01&&mi&&e.addQuad(Ze[0],Ze[1],Ze[2],Ze[3],Ue,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,a,u,p){e.clearVertexLookup();let g=Number.POSITIVE_INFINITY,b=(H,J)=>H.featureInfo.featureIndex-J.featureInfo.featureIndex;this.sortSubarray(a,u.min,u.max,b),this.sortSubarray(a,p.min,p.max,b);let w=H=>Er(H,H),A=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],k=(H,J)=>H<J,I=hi(),D=hi(),B=hi(),V=hi(),W=hi();for(let H=u.min;H<u.max;H++){if(!this.prepareEdgePoints(A,i,s,a[H],k))continue;let[J,te]=A,ne=w(Ai(W,-(te.coord.y-J.coord.y),te.coord.x-J.coord.x,0));g=this.addFeatureSection(a[H].featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad(Ai(I,J.coord.x,J.coord.y,J.height),Ai(D,te.coord.x,te.coord.y,te.height),Ai(B,te.coord.x,te.coord.y,a[H].isTunnel?-.1:0),Ai(V,J.coord.x,J.coord.y,a[H].isTunnel?-.1:0),ne)}for(let H=p.min;H<p.max;H++){let J=a[H];J.isTunnel&&([J.a,J.b]=[J.b,J.a]);let te=i[J.a],ne=i[J.b],_e=w(Ai(W,-(ne.y-te.y),ne.x-te.x,0));g=this.addFeatureSection(J.featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad(Ai(I,ne.x,ne.y,0),Ai(D,te.x,te.y,0),Ai(B,te.x,te.y,s[J.a]+4),Ai(V,ne.x,ne.y,s[J.b]+4),_e),e.addQuad(Ai(I,te.x,te.y,0),Ai(D,ne.x,ne.y,0),Ai(B,ne.x,ne.y,s[J.b]+4),Ai(V,te.x,te.y,s[J.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,a){e.coord.x=i,e.coord.y=s,e.height=a}prepareEdgePoints(e,i,s,a,u){let p=i[a.a].x,g=i[a.a].y,b=i[a.b].x,w=i[a.b].y,A=s[a.a],k=s[a.b],I=u(A,0),D=u(k,0);if(I&&D)return this.setElevatedPoint(e[0],p,g,A),this.setElevatedPoint(e[1],b,w,k),!0;if(!I&&!D)return!1;if(I){if(!D){let B=k/(k-A);b=$t(b,p,B),w=$t(w,g,B),k=$t(k,A,B)}}else{let B=A/(A-k);p=$t(p,b,B),g=$t(g,w,B),A=$t(A,k,B)}return this.setElevatedPoint(e[0],p,g,A),this.setElevatedPoint(e[1],b,w,k),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((g,b)=>g.hash===b.hash?b.polygonIdx-g.polygonIdx:b.hash>g.hash?1:-1));let s=0,a=0,u=0,p=i[s].polygonIdx;do a++,(a===i.length||i[s].hash!==i[a].hash)&&((a-s==1||i[a-1].polygonIdx!==p)&&(u<s&&(i[u]=i[s],i[s]=null),i[u].type="none",u++),s=a,s!==i.length&&(p=i[s].polygonIdx));while(s!==i.length);if(i.splice(u),i.length!==0&&e.length!==0){i.sort(((w,A)=>w.portalHash<A.portalHash?1:-1));let g=0,b=0;for(;g!==i.length&&b!==e.length;){let w=i[g],A=e[b];w.portalHash>A.hash?g++:A.hash>w.portalHash?b++:(w.type=A.type,g++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=ht&&i>=ht}addFeatureSection(e,i,s,a){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),i}sortSubarray(e,i,s,a){let u=e.slice(i,s);u.sort(a),e.splice(i,u.length,...u)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Os.computePosHash(e))<<32n|BigInt(Os.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var W1,G1={exports:{}},H1=(W1||(W1=1,(function(r,e){(function(i){function s(he,ce){return he>ce?1:he<ce?-1:0}var a=function(he,ce){he===void 0&&(he=s),ce===void 0&&(ce=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!ce},u={size:{configurable:!0}};function p(he,ce,$e,Tt,Xe){var Et=Xe-Tt;if(Et>0){var qt=Tt+Math.floor(Et/2),Vt={key:ce[qt],data:$e[qt],parent:he};return Vt.left=p(Vt,ce,$e,Tt,qt),Vt.right=p(Vt,ce,$e,qt+1,Xe),Vt}return null}function g(he,ce,$e,Tt,Xe){if(!($e>=Tt)){for(var Et=he[$e+Tt>>1],qt=$e-1,Vt=Tt+1;;){do qt++;while(Xe(he[qt],Et)<0);do Vt--;while(Xe(he[Vt],Et)>0);if(qt>=Vt)break;var gi=he[qt];he[qt]=he[Vt],he[Vt]=gi,gi=ce[qt],ce[qt]=ce[Vt],ce[Vt]=gi}g(he,ce,$e,Vt,Xe),g(he,ce,Vt+1,Tt,Xe)}}a.prototype.rotateLeft=function(he){var ce=he.right;ce&&(he.right=ce.left,ce.left&&(ce.left.parent=he),ce.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ce:he.parent.right=ce:this._root=ce,ce&&(ce.left=he),he.parent=ce},a.prototype.rotateRight=function(he){var ce=he.left;ce&&(he.left=ce.right,ce.right&&(ce.right.parent=he),ce.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ce:he.parent.right=ce:this._root=ce,ce&&(ce.right=he),he.parent=ce},a.prototype._splay=function(he){for(;he.parent;){var ce=he.parent;ce.parent?ce.left===he&&ce.parent.left===ce?(this.rotateRight(ce.parent),this.rotateRight(ce)):ce.right===he&&ce.parent.right===ce?(this.rotateLeft(ce.parent),this.rotateLeft(ce)):ce.left===he&&ce.parent.right===ce?(this.rotateRight(ce),this.rotateLeft(ce)):(this.rotateLeft(ce),this.rotateRight(ce)):ce.left===he?this.rotateRight(ce):this.rotateLeft(ce)}},a.prototype.splay=function(he){for(var ce,$e,Tt,Xe,Et;he.parent;)($e=(ce=he.parent).parent)&&$e.parent?((Tt=$e.parent).left===$e?Tt.left=he:Tt.right=he,he.parent=Tt):(he.parent=null,this._root=he),Xe=he.left,Et=he.right,he===ce.left?($e&&($e.left===ce?(ce.right?($e.left=ce.right,$e.left.parent=$e):$e.left=null,ce.right=$e,$e.parent=ce):(Xe?($e.right=Xe,Xe.parent=$e):$e.right=null,he.left=$e,$e.parent=he)),Et?(ce.left=Et,Et.parent=ce):ce.left=null,he.right=ce,ce.parent=he):($e&&($e.right===ce?(ce.left?($e.right=ce.left,$e.right.parent=$e):$e.right=null,ce.left=$e,$e.parent=ce):(Et?($e.left=Et,Et.parent=$e):$e.left=null,he.right=$e,$e.parent=he)),Xe?(ce.right=Xe,Xe.parent=ce):ce.right=null,he.left=ce,ce.parent=he)},a.prototype.replace=function(he,ce){he.parent?he===he.parent.left?he.parent.left=ce:he.parent.right=ce:this._root=ce,ce&&(ce.parent=he.parent)},a.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},a.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},a.prototype.insert=function(he,ce){var $e=this._root,Tt=null,Xe=this._compare;if(this._noDuplicates)for(;$e;){if(Tt=$e,Xe($e.key,he)===0)return;$e=Xe($e.key,he)<0?$e.right:$e.left}else for(;$e;)Tt=$e,$e=Xe($e.key,he)<0?$e.right:$e.left;return $e={key:he,data:ce,left:null,right:null,parent:Tt},Tt?Xe(Tt.key,$e.key)<0?Tt.right=$e:Tt.left=$e:this._root=$e,this.splay($e),this._size++,$e},a.prototype.find=function(he){for(var ce=this._root,$e=this._compare;ce;){var Tt=$e(ce.key,he);if(Tt<0)ce=ce.right;else{if(!(Tt>0))return ce;ce=ce.left}}return null},a.prototype.contains=function(he){for(var ce=this._root,$e=this._compare;ce;){var Tt=$e(he,ce.key);if(Tt===0)return!0;ce=Tt<0?ce.left:ce.right}return!1},a.prototype.remove=function(he){var ce=this.find(he);if(!ce)return!1;if(this.splay(ce),ce.left)if(ce.right){var $e=this.minNode(ce.right);$e.parent!==ce&&(this.replace($e,$e.right),$e.right=ce.right,$e.right.parent=$e),this.replace(ce,$e),$e.left=ce.left,$e.left.parent=$e}else this.replace(ce,ce.left);else this.replace(ce,ce.right);return this._size--,!0},a.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var ce=this.minNode(he.right);ce.parent!==he&&(this.replace(ce,ce.right),ce.right=he.right,ce.right.parent=ce),this.replace(he,ce),ce.left=he.left,ce.left.parent=ce}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},a.prototype.erase=function(he){var ce=this.find(he);if(ce){this.splay(ce);var $e=ce.left,Tt=ce.right,Xe=null;$e&&($e.parent=null,Xe=this.maxNode($e),this.splay(Xe),this._root=Xe),Tt&&($e?Xe.right=Tt:this._root=Tt,Tt.parent=Xe),this._size--}},a.prototype.pop=function(){var he=this._root,ce=null;if(he){for(;he.left;)he=he.left;ce={key:he.key,data:he.data},this.remove(he.key)}return ce},a.prototype.next=function(he){var ce=he;if(ce)if(ce.right)for(ce=ce.right;ce&&ce.left;)ce=ce.left;else for(ce=he.parent;ce&&ce.right===he;)he=ce,ce=ce.parent;return ce},a.prototype.prev=function(he){var ce=he;if(ce)if(ce.left)for(ce=ce.left;ce&&ce.right;)ce=ce.right;else for(ce=he.parent;ce&&ce.left===he;)he=ce,ce=ce.parent;return ce},a.prototype.forEach=function(he){for(var ce=this._root,$e=[],Tt=!1,Xe=0;!Tt;)ce?($e.push(ce),ce=ce.left):$e.length>0?(he(ce=$e.pop(),Xe++),ce=ce.right):Tt=!0;return this},a.prototype.range=function(he,ce,$e,Tt){for(var Xe=[],Et=this._compare,qt=this._root;Xe.length!==0||qt;)if(qt)Xe.push(qt),qt=qt.left;else{if(Et((qt=Xe.pop()).key,ce)>0)break;if(Et(qt.key,he)>=0&&$e.call(Tt,qt))return this;qt=qt.right}return this},a.prototype.keys=function(){for(var he=this._root,ce=[],$e=[],Tt=!1;!Tt;)he?(ce.push(he),he=he.left):ce.length>0?(he=ce.pop(),$e.push(he.key),he=he.right):Tt=!0;return $e},a.prototype.values=function(){for(var he=this._root,ce=[],$e=[],Tt=!1;!Tt;)he?(ce.push(he),he=he.left):ce.length>0?(he=ce.pop(),$e.push(he.data),he=he.right):Tt=!0;return $e},a.prototype.at=function(he){for(var ce=this._root,$e=[],Tt=!1,Xe=0;!Tt;)if(ce)$e.push(ce),ce=ce.left;else if($e.length>0){if(ce=$e.pop(),Xe===he)return ce;Xe++,ce=ce.right}else Tt=!0;return null},a.prototype.load=function(he,ce,$e){if(he===void 0&&(he=[]),ce===void 0&&(ce=[]),$e===void 0&&($e=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Tt=he.length;return $e&&g(he,ce,0,Tt-1,this._compare),this._root=p(null,he,ce,0,Tt),this._size=Tt,this},a.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},a.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(he,ce,$e,Tt,Xe){return new a($e,Xe).load(he,ce,Tt)},Object.defineProperties(a.prototype,u);var b=0,w=1,A=2,k=3,I=0,D=1,B=2,V=3;function W(he,ce,$e){ce===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===ce.isSubject?(he.inOut=!ce.inOut,he.otherInOut=ce.otherInOut):(he.inOut=!ce.otherInOut,he.otherInOut=ce.isVertical()?!ce.inOut:ce.inOut),ce&&(he.prevInResult=!H(ce,$e)||ce.isVertical()?ce.prevInResult:ce));var Tt=H(he,$e);he.resultTransition=Tt?(function(Xe,Et){var qt,Vt=!Xe.inOut,gi=!Xe.otherInOut;switch(Et){case I:qt=Vt&&gi;break;case D:qt=Vt||gi;break;case V:qt=Vt^gi;break;case B:qt=Xe.isSubject?Vt&&!gi:gi&&!Vt}return qt?1:-1})(he,$e):0}function H(he,ce){switch(he.type){case b:switch(ce){case I:return!he.otherInOut;case D:return he.otherInOut;case B:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case V:return!0}break;case A:return ce===I||ce===D;case k:return ce===B;case w:return!1}return!1}var J=function(he,ce,$e,Tt,Xe){this.left=ce,this.point=he,this.otherEvent=$e,this.isSubject=Tt,this.type=Xe||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},te={inResult:{configurable:!0}};function ne(he,ce){return he[0]===ce[0]&&he[1]===ce[1]}J.prototype.isBelow=function(he){var ce=this.point,$e=this.otherEvent.point;return this.left?(ce[0]-he[0])*($e[1]-he[1])-($e[0]-he[0])*(ce[1]-he[1])>0:($e[0]-he[0])*(ce[1]-he[1])-(ce[0]-he[0])*($e[1]-he[1])>0},J.prototype.isAbove=function(he){return!this.isBelow(he)},J.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},te.inResult.get=function(){return this.resultTransition!==0},J.prototype.clone=function(){var he=new J(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(J.prototype,te);var _e=11102230246251565e-32,de=134217729,xe=(3+8*_e)*_e;function Ce(he,ce,$e,Tt,Xe){var Et,qt,Vt,gi,Qt=ce[0],Nt=Tt[0],Qi=0,wr=0;Nt>Qt==Nt>-Qt?(Et=Qt,Qt=ce[++Qi]):(Et=Nt,Nt=Tt[++wr]);var ri=0;if(Qi<he&&wr<$e)for(Nt>Qt==Nt>-Qt?(Vt=Et-((qt=Qt+Et)-Qt),Qt=ce[++Qi]):(Vt=Et-((qt=Nt+Et)-Nt),Nt=Tt[++wr]),Et=qt,Vt!==0&&(Xe[ri++]=Vt);Qi<he&&wr<$e;)Nt>Qt==Nt>-Qt?(Vt=Et-((qt=Et+Qt)-(gi=qt-Et))+(Qt-gi),Qt=ce[++Qi]):(Vt=Et-((qt=Et+Nt)-(gi=qt-Et))+(Nt-gi),Nt=Tt[++wr]),Et=qt,Vt!==0&&(Xe[ri++]=Vt);for(;Qi<he;)Vt=Et-((qt=Et+Qt)-(gi=qt-Et))+(Qt-gi),Qt=ce[++Qi],Et=qt,Vt!==0&&(Xe[ri++]=Vt);for(;wr<$e;)Vt=Et-((qt=Et+Nt)-(gi=qt-Et))+(Nt-gi),Nt=Tt[++wr],Et=qt,Vt!==0&&(Xe[ri++]=Vt);return Et===0&&ri!==0||(Xe[ri++]=Et),ri}function Ae(he){return new Float64Array(he)}var He=33306690738754716e-32,Oe=22204460492503146e-32,Ze=11093356479670487e-47,Je=Ae(4),it=Ae(8),_t=Ae(12),ct=Ae(16),Qe=Ae(4);function lt(he,ce,$e){var Tt=(function(Xe,Et,qt,Vt,gi,Qt){var Nt=(Et-Qt)*(qt-gi),Qi=(Xe-gi)*(Vt-Qt),wr=Nt-Qi;if(Nt===0||Qi===0||Nt>0!=Qi>0)return wr;var ri=Math.abs(Nt+Qi);return Math.abs(wr)>=He*ri?wr:-(function(Wi,Sr,fr,cn,Vr,Mr,_r){var or,_i,sr,Or,ei,Yi,Ur,mn,Sn,Bn,qr,Ln,us,zn,Ds,To,xa,ds,Bs=Wi-Vr,Co=fr-Vr,Fs=Sr-Mr,ba=cn-Mr;Je[0]=(Ds=(mn=Bs-(Ur=(Yi=de*Bs)-(Yi-Bs)))*(Bn=ba-(Sn=(Yi=de*ba)-(Yi-ba)))-((zn=Bs*ba)-Ur*Sn-mn*Sn-Ur*Bn))-((qr=Ds-(xa=(mn=Fs-(Ur=(Yi=de*Fs)-(Yi-Fs)))*(Bn=Co-(Sn=(Yi=de*Co)-(Yi-Co)))-((To=Fs*Co)-Ur*Sn-mn*Sn-Ur*Bn)))+(ei=Ds-qr))+(ei-xa),Je[1]=(us=zn-((Ln=zn+qr)-(ei=Ln-zn))+(qr-ei))-((qr=us-To)+(ei=us-qr))+(ei-To),Je[2]=Ln-((ds=Ln+qr)-(ei=ds-Ln))+(qr-ei),Je[3]=ds;var io=(function(Ou,rc){for(var S_=rc[0],Qh=1;Qh<4;Qh++)S_+=rc[Qh];return S_})(0,Je),jo=Oe*_r;if(io>=jo||-io>=jo||(or=Wi-(Bs+(ei=Wi-Bs))+(ei-Vr),sr=fr-(Co+(ei=fr-Co))+(ei-Vr),_i=Sr-(Fs+(ei=Sr-Fs))+(ei-Mr),Or=cn-(ba+(ei=cn-ba))+(ei-Mr),or===0&&_i===0&&sr===0&&Or===0)||(jo=Ze*_r+xe*Math.abs(io),(io+=Bs*Or+ba*or-(Fs*sr+Co*_i))>=jo||-io>=jo))return io;Qe[0]=(Ds=(mn=or-(Ur=(Yi=de*or)-(Yi-or)))*(Bn=ba-(Sn=(Yi=de*ba)-(Yi-ba)))-((zn=or*ba)-Ur*Sn-mn*Sn-Ur*Bn))-((qr=Ds-(xa=(mn=_i-(Ur=(Yi=de*_i)-(Yi-_i)))*(Bn=Co-(Sn=(Yi=de*Co)-(Yi-Co)))-((To=_i*Co)-Ur*Sn-mn*Sn-Ur*Bn)))+(ei=Ds-qr))+(ei-xa),Qe[1]=(us=zn-((Ln=zn+qr)-(ei=Ln-zn))+(qr-ei))-((qr=us-To)+(ei=us-qr))+(ei-To),Qe[2]=Ln-((ds=Ln+qr)-(ei=ds-Ln))+(qr-ei),Qe[3]=ds;var ic=Ce(4,Je,4,Qe,it);Qe[0]=(Ds=(mn=Bs-(Ur=(Yi=de*Bs)-(Yi-Bs)))*(Bn=Or-(Sn=(Yi=de*Or)-(Yi-Or)))-((zn=Bs*Or)-Ur*Sn-mn*Sn-Ur*Bn))-((qr=Ds-(xa=(mn=Fs-(Ur=(Yi=de*Fs)-(Yi-Fs)))*(Bn=sr-(Sn=(Yi=de*sr)-(Yi-sr)))-((To=Fs*sr)-Ur*Sn-mn*Sn-Ur*Bn)))+(ei=Ds-qr))+(ei-xa),Qe[1]=(us=zn-((Ln=zn+qr)-(ei=Ln-zn))+(qr-ei))-((qr=us-To)+(ei=us-qr))+(ei-To),Qe[2]=Ln-((ds=Ln+qr)-(ei=ds-Ln))+(qr-ei),Qe[3]=ds;var Mu=Ce(ic,it,4,Qe,_t);Qe[0]=(Ds=(mn=or-(Ur=(Yi=de*or)-(Yi-or)))*(Bn=Or-(Sn=(Yi=de*Or)-(Yi-Or)))-((zn=or*Or)-Ur*Sn-mn*Sn-Ur*Bn))-((qr=Ds-(xa=(mn=_i-(Ur=(Yi=de*_i)-(Yi-_i)))*(Bn=sr-(Sn=(Yi=de*sr)-(Yi-sr)))-((To=_i*sr)-Ur*Sn-mn*Sn-Ur*Bn)))+(ei=Ds-qr))+(ei-xa),Qe[1]=(us=zn-((Ln=zn+qr)-(ei=Ln-zn))+(qr-ei))-((qr=us-To)+(ei=us-qr))+(ei-To),Qe[2]=Ln-((ds=Ln+qr)-(ei=ds-Ln))+(qr-ei),Qe[3]=ds;var Jh=Ce(Mu,_t,4,Qe,ct);return ct[Jh-1]})(Xe,Et,qt,Vt,gi,Qt,ri)})(he[0],he[1],ce[0],ce[1],$e[0],$e[1]);return Tt>0?-1:Tt<0?1:0}function We(he,ce){var $e=he.point,Tt=ce.point;return $e[0]>Tt[0]?1:$e[0]<Tt[0]?-1:$e[1]!==Tt[1]?$e[1]>Tt[1]?1:-1:(function(Xe,Et,qt,Vt){return Xe.left!==Et.left?Xe.left?1:-1:lt(qt,Xe.otherEvent.point,Et.otherEvent.point)!==0?Xe.isBelow(Et.otherEvent.point)?-1:1:!Xe.isSubject&&Et.isSubject?1:-1})(he,ce,$e)}function Ue(he,ce,$e){var Tt=new J(ce,!1,he,he.isSubject),Xe=new J(ce,!0,he.otherEvent,he.isSubject);return ne(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Tt.contourId=Xe.contourId=he.contourId,We(Xe,he.otherEvent)>0&&(he.otherEvent.left=!0,Xe.left=!1),he.otherEvent.otherEvent=Xe,he.otherEvent=Tt,$e.push(Xe),$e.push(Tt),$e}function at(he,ce){return he[0]*ce[1]-he[1]*ce[0]}function mt(he,ce){return he[0]*ce[0]+he[1]*ce[1]}function et(he,ce,$e){var Tt=(function(gi,Qt,Nt,Qi,wr){var ri=[Qt[0]-gi[0],Qt[1]-gi[1]],Wi=[Qi[0]-Nt[0],Qi[1]-Nt[1]];function Sr(Yi,Ur,mn){return[Yi[0]+Ur*mn[0],Yi[1]+Ur*mn[1]]}var fr=[Nt[0]-gi[0],Nt[1]-gi[1]],cn=at(ri,Wi),Vr=cn*cn,Mr=mt(ri,ri);if(Vr>0){var _r=at(fr,Wi)/cn;if(_r<0||_r>1)return null;var or=at(fr,ri)/cn;return or<0||or>1?null:_r===0||_r===1?[Sr(gi,_r,ri)]:or===0||or===1?[Sr(Nt,or,Wi)]:[Sr(gi,_r,ri)]}if((Vr=(cn=at(fr,ri))*cn)>0)return null;var _i=mt(ri,fr)/Mr,sr=_i+mt(ri,Wi)/Mr,Or=Math.min(_i,sr),ei=Math.max(_i,sr);return Or<=1&&ei>=0?Or===1?[Sr(gi,Or>0?Or:0,ri)]:ei===0?[Sr(gi,ei<1?ei:1,ri)]:[Sr(gi,Or>0?Or:0,ri),Sr(gi,ei<1?ei:1,ri)]:null})(he.point,he.otherEvent.point,ce.point,ce.otherEvent.point),Xe=Tt?Tt.length:0;if(Xe===0||Xe===1&&(ne(he.point,ce.point)||ne(he.otherEvent.point,ce.otherEvent.point))||Xe===2&&he.isSubject===ce.isSubject)return 0;if(Xe===1)return ne(he.point,Tt[0])||ne(he.otherEvent.point,Tt[0])||Ue(he,Tt[0],$e),ne(ce.point,Tt[0])||ne(ce.otherEvent.point,Tt[0])||Ue(ce,Tt[0],$e),1;var Et=[],qt=!1,Vt=!1;return ne(he.point,ce.point)?qt=!0:We(he,ce)===1?Et.push(ce,he):Et.push(he,ce),ne(he.otherEvent.point,ce.otherEvent.point)?Vt=!0:We(he.otherEvent,ce.otherEvent)===1?Et.push(ce.otherEvent,he.otherEvent):Et.push(he.otherEvent,ce.otherEvent),qt&&Vt||qt?(ce.type=w,he.type=ce.inOut===he.inOut?A:k,qt&&!Vt&&Ue(Et[1].otherEvent,Et[0].point,$e),2):Vt?(Ue(Et[0],Et[1].point,$e),3):Et[0]!==Et[3].otherEvent?(Ue(Et[0],Et[1].point,$e),Ue(Et[1],Et[2].point,$e),3):(Ue(Et[0],Et[1].point,$e),Ue(Et[3].otherEvent,Et[2].point,$e),3)}function Mt(he,ce){if(he===ce)return 0;if(lt(he.point,he.otherEvent.point,ce.point)!==0||lt(he.point,he.otherEvent.point,ce.otherEvent.point)!==0)return ne(he.point,ce.point)?he.isBelow(ce.otherEvent.point)?-1:1:he.point[0]===ce.point[0]?he.point[1]<ce.point[1]?-1:1:We(he,ce)===1?ce.isAbove(he.point)?-1:1:he.isBelow(ce.point)?-1:1;if(he.isSubject!==ce.isSubject)return he.isSubject?-1:1;var $e=he.point,Tt=ce.point;return $e[0]===Tt[0]&&$e[1]===Tt[1]?($e=he.otherEvent.point)[0]===(Tt=ce.otherEvent.point)[0]&&$e[1]===Tt[1]?0:he.contourId>ce.contourId?1:-1:We(he,ce)===1?1:-1}var Bt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Pt(he,ce,$e,Tt){var Xe,Et=he+1,qt=ce[he].point,Vt=ce.length;for(Et<Vt&&(Xe=ce[Et].point);Et<Vt&&Xe[0]===qt[0]&&Xe[1]===qt[1];){if(!$e[Et])return Et;++Et<Vt&&(Xe=ce[Et].point)}for(Et=he-1;$e[Et]&&Et>Tt;)Et--;return Et}Bt.prototype.isExterior=function(){return this.holeOf==null};var Ct=At,ui=At;function At(he,ce){if(!(this instanceof At))return new At(he,ce);if(this.data=he||[],this.length=this.data.length,this.compare=ce||Ht,this.length>0)for(var $e=(this.length>>1)-1;$e>=0;$e--)this._down($e)}function Ht(he,ce){return he<ce?-1:he>ce?1:0}At.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var ce=this.data,$e=this.compare,Tt=ce[he];he>0;){var Xe=he-1>>1,Et=ce[Xe];if($e(Tt,Et)>=0)break;ce[he]=Et,he=Xe}ce[he]=Tt},_down:function(he){for(var ce=this.data,$e=this.compare,Tt=this.length>>1,Xe=ce[he];he<Tt;){var Et=1+(he<<1),qt=Et+1,Vt=ce[Et];if(qt<this.length&&$e(ce[qt],Vt)<0&&(Et=qt,Vt=ce[qt]),$e(Vt,Xe)>=0)break;ce[he]=Vt,he=Et}ce[he]=Xe}},Ct.default=ui;var di=Math.max,Ti=Math.min,Xi=0;function mi(he,ce,$e,Tt,Xe,Et){var qt,Vt,gi,Qt,Nt,Qi;for(qt=0,Vt=he.length-1;qt<Vt;qt++)if(Qt=he[qt+1],Nt=new J(gi=he[qt],!1,void 0,ce),Qi=new J(Qt,!1,Nt,ce),Nt.otherEvent=Qi,gi[0]!==Qt[0]||gi[1]!==Qt[1]){Nt.contourId=Qi.contourId=$e,Et||(Nt.isExteriorRing=!1,Qi.isExteriorRing=!1),We(Nt,Qi)>0?Qi.left=!0:Nt.left=!0;var wr=gi[0],ri=gi[1];Xe[0]=Ti(Xe[0],wr),Xe[1]=Ti(Xe[1],ri),Xe[2]=di(Xe[2],wr),Xe[3]=di(Xe[3],ri),Tt.push(Nt),Tt.push(Qi)}}var rr=[];function nr(he,ce,$e){typeof he[0][0][0]=="number"&&(he=[he]),typeof ce[0][0][0]=="number"&&(ce=[ce]);var Tt=(function(ri,Wi,Sr){var fr=null;return ri.length*Wi.length==0&&(Sr===I?fr=rr:Sr===B?fr=ri:Sr!==D&&Sr!==V||(fr=ri.length===0?Wi:ri)),fr})(he,ce,$e);if(Tt)return Tt===rr?null:Tt;var Xe=[1/0,1/0,-1/0,-1/0],Et=[1/0,1/0,-1/0,-1/0],qt=(function(ri,Wi,Sr,fr,cn){var Vr,Mr,_r,or,_i,sr,Or=new Ct(null,We);for(_r=0,or=ri.length;_r<or;_r++)for(_i=0,sr=(Vr=ri[_r]).length;_i<sr;_i++)(Mr=_i===0)&&Xi++,mi(Vr[_i],!0,Xi,Or,Sr,Mr);for(_r=0,or=Wi.length;_r<or;_r++)for(_i=0,sr=(Vr=Wi[_r]).length;_i<sr;_i++)Mr=_i===0,cn===B&&(Mr=!1),Mr&&Xi++,mi(Vr[_i],!1,Xi,Or,fr,Mr);return Or})(he,ce,Xe,Et,$e);if(Tt=(function(ri,Wi,Sr,fr,cn){var Vr=null;return(Sr[0]>fr[2]||fr[0]>Sr[2]||Sr[1]>fr[3]||fr[1]>Sr[3])&&(cn===I?Vr=rr:cn===B?Vr=ri:cn!==D&&cn!==V||(Vr=ri.concat(Wi))),Vr})(he,ce,Xe,Et,$e))return Tt===rr?null:Tt;for(var Vt=(function(ri){var Wi,Sr,fr=(function(_r){var or,_i,sr,Or,ei=[];for(_i=0,sr=_r.length;_i<sr;_i++)((or=_r[_i]).left&&or.inResult||!or.left&&or.otherEvent.inResult)&&ei.push(or);for(var Yi=!1;!Yi;)for(Yi=!0,_i=0,sr=ei.length;_i<sr;_i++)_i+1<sr&&We(ei[_i],ei[_i+1])===1&&(Or=ei[_i],ei[_i]=ei[_i+1],ei[_i+1]=Or,Yi=!1);for(_i=0,sr=ei.length;_i<sr;_i++)(or=ei[_i]).otherPos=_i;for(_i=0,sr=ei.length;_i<sr;_i++)(or=ei[_i]).left||(Or=or.otherPos,or.otherPos=or.otherEvent.otherPos,or.otherEvent.otherPos=Or);return ei})(ri),cn={},Vr=[],Mr=function(){if(!cn[Wi]){var _r=Vr.length,or=(function(ei,Yi,Ur){var mn=new Bt;if(ei.prevInResult!=null){var Sn=ei.prevInResult,Bn=Sn.outputContourId;if(Sn.resultTransition>0){var qr=Yi[Bn];if(qr.holeOf!=null){var Ln=qr.holeOf;Yi[Ln].holeIds.push(Ur),mn.holeOf=Ln,mn.depth=Yi[Bn].depth}else Yi[Bn].holeIds.push(Ur),mn.holeOf=Bn,mn.depth=Yi[Bn].depth+1}else mn.holeOf=null,mn.depth=Yi[Bn].depth}else mn.holeOf=null,mn.depth=0;return mn})(fr[Wi],Vr,_r),_i=function(ei){cn[ei]=!0,ei<fr.length&&fr[ei]&&(fr[ei].outputContourId=_r)},sr=Wi,Or=Wi;for(or.points.push(fr[Wi].point);_i(sr),_i(sr=fr[sr].otherPos),or.points.push(fr[sr].point),!((sr=Pt(sr,fr,cn,Or))==Or||sr>=fr.length)&&fr[sr];);Vr.push(or)}};for(Wi=0,Sr=fr.length;Wi<Sr;Wi++)Mr();return Vr})((function(ri,Wi,Sr,fr,cn,Vr){for(var Mr,_r,or,_i=new a(Mt),sr=[],Or=Math.min(fr[2],cn[2]);ri.length!==0;){var ei=ri.pop();if(sr.push(ei),Vr===I&&ei.point[0]>Or||Vr===B&&ei.point[0]>fr[2])break;if(ei.left){_r=Mr=_i.insert(ei),Mr=Mr!==(or=_i.minNode())?_i.prev(Mr):null,_r=_i.next(_r);var Yi=Mr?Mr.key:null;if(W(ei,Yi,Vr),_r&&et(ei,_r.key,ri)===2&&(W(ei,Yi,Vr),W(_r.key,ei,Vr)),Mr&&et(Mr.key,ei,ri)===2){var Ur=Mr;W(Yi,(Ur=Ur!==or?_i.prev(Ur):null)?Ur.key:null,Vr),W(ei,Yi,Vr)}}else _r=Mr=_i.find(ei=ei.otherEvent),Mr&&_r&&(Mr=Mr!==or?_i.prev(Mr):null,_r=_i.next(_r),_i.remove(ei),_r&&Mr&&et(Mr.key,_r.key,ri))}return sr})(qt,0,0,Xe,Et,$e)),gi=[],Qt=0;Qt<Vt.length;Qt++){var Nt=Vt[Qt];if(Nt.isExterior()){for(var Qi=[Nt.points],wr=0;wr<Nt.holeIds.length;wr++)Qi.push(Vt[Nt.holeIds[wr]].points);gi.push(Qi)}}return gi}var en={UNION:D,DIFFERENCE:B,INTERSECTION:I,XOR:V};i.diff=function(he,ce){return nr(he,ce,B)},i.intersection=function(he,ce){return nr(he,ce,I)},i.operations=en,i.union=function(he,ce){return nr(he,ce,D)},i.xor=function(he,ce){return nr(he,ce,V)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,G1.exports)),G1.exports);function Rg(r,e,i,s){let a=[],u=s===0?(p,g,b,w,A,k)=>{p.push(new st(k,b+(k-g)/(w-g)*(A-b)))}:(p,g,b,w,A,k)=>{p.push(new st(g+(k-b)/(A-b)*(w-g),k))};for(let p of r){let g=[];for(let b of p){if(b.length<=2)continue;let w=[];for(let I=0;I<b.length-1;I++){let D=b[I].x,B=b[I].y,V=b[I+1].x,W=b[I+1].y,H=s===0?D:B,J=s===0?V:W;H<e?J>e&&u(w,D,B,V,W,e):H>i?J<i&&u(w,D,B,V,W,i):w.push(b[I]),J<e&&H>=e&&u(w,D,B,V,W,e),J>i&&H<=i&&u(w,D,B,V,W,i)}let A=b[b.length-1],k=s===0?A.x:A.y;k>=e&&k<=i&&w.push(A),w.length&&(A=w[w.length-1],w[0].x===A.x&&w[0].y===A.y||w.push(w[0]),g.push(w))}g.length&&a.push(g)}return a}function KO(r,e){let i=Av(r),s=Av([e]),a=H1.intersection(i,s);return a==null?[]:Z1(a)}function JO(r,e){let s=Av(r,65536),a=[];for(;e.valid();e.next()){let[u,p]=e.get(),g=u.x*65536,b=u.y*65536,w=p.x*65536,A=p.y*65536,k=w-g,I=A-b,D=Math.hypot(k,I);if(D===0)continue;let B=Math.trunc(I/D*3),V=-Math.trunc(k/D*3);a.push([[[g,b],[w,A],[w+B,A+V],[g+B,b+V],[g,b]]])}return a.length>0&&(s=H1.diff(s,a)),Z1(s,1/65536)}function Av(r,e=1){return[r.map((i=>i.map((s=>[s.x*e,s.y*e]))))]}function Z1(r,e=1){return r.map((i=>i.map(((s,a)=>{let u=s.map((p=>new st(p[0]*e,p[1]*e).round()));return a>0&&u.reverse(),u}))))}class kv{constructor(e,i){this.layoutVertexArray=new Xo,this.indexArray=new Yr,this.lineIndexArray=new Js,this.triangleSegments=new tn,this.lineSegments=new tn,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new hl)}update(e,i,s,a,u,p,g,b){this.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,DO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,BO.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,a,u,p,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,a,u,p,void 0,g)}}class Iv{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new kv(e,!1),this.elevationBufferData=new kv(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=Cv("fill",this.layers,this.pixelRatio,i);let u=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:g,id:b,index:w,sourceLayerIndex:A}of e){let k=this.layers[0]._featureFilter.needGeometry,I=Ne(g,k);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),I,s))continue;let D=u?u.evaluate(I,{},s,i.availableImages):void 0,B={id:b,properties:g.properties,type:g.type,sourceLayerIndex:A,index:w,geometry:k?I.geometry:Ke(g,s,a),patterns:{},sortKey:D};p.push(B)}u&&p.sort(((g,b)=>g.sortKey-b.sortKey));for(let g of p){let{geometry:b,index:w,sourceLayerIndex:A}=g;if(this.hasPattern){let k=Ev("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(k)}else this.addFeature(g,b,w,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[w].feature,b,w,A,this.index)}}update(e,i,s,a,u,p,g){this.bufferData.update(e,i,s,a,u,p,g,this.worldview),this.elevationBufferData.update(e,i,s,a,u,p,g,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,a,u,p,g,this.worldview)}addFeatures(e,i,s,a,u,p){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,a,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,a,u,p=[],g,b){let w=Mf(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,w,a,s,b):this.addGeometry(w,this.bufferData),this.bufferData.populatePaintArrays(e,s,u,p,a,g,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,u,p,a,g,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,a,u){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,a,u,this.worldview))}addElevatedRoadFeature(e,i,s,a,u){let p=new Array,g=ci.getElevationFeature(e,u);if(!g)return void this.addGeometry(i,this.bufferData);{let w=this.clipPolygonsToTile(i,1);w.length>0&&p.push({polygons:w,elevationFeature:g,elevationTileID:s})}let b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:a};for(let w of p)if(w.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Os(w.elevationTileID,this.layers,this.zoom,this.lut));let k=w.elevationFeature.isTunnel(),I=0;e.properties.hasOwnProperty(zt)&&(I=+e.properties[zt]);for(let D of w.polygons)this.elevatedStructures.addPortalCandidates(w.elevationFeature.id,D,k,w.elevationFeature,I)}w.elevationFeature.constantHeight==null&&(w.polygons=this.prepareElevatedPolygons(w.polygons,w.elevationFeature,w.elevationTileID));let A=new $i(s,w.elevationTileID);this.addElevatedGeometry(w.polygons,A,w.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,b)}}addElevatedGeometry(e,i,s,a,u,p){let g={elevation:s,elevationSampler:i,bias:a,index:u,featureInfo:p},[b,w]=this.addGeometry(e,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:w}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,w))}addGeometry(e,i,s){let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,p=null;s&&(p=s.elevationSampler.constantElevation(s.elevation,s.bias),p!=null&&(a=p,u=p));let g=(b,w,A)=>{if(s!=null)if(w.push(b),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),A.push(p);else{let k=s.elevationSampler.pointElevation(b,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(k),A.push(k),a=Math.min(a,k),u=Math.max(u,k)}};for(let b of e){let w=0;for(let te of b)w+=te.length;let A=i.triangleSegments.prepareSegment(w,i.layoutVertexArray,i.indexArray),k=A.vertexLength,I=[],D=[],B=[],V=[],W=[],H=i.layoutVertexArray.length;for(let te of b){if(te.length===0)continue;te!==b[0]&&D.push(I.length/2);let ne=i.lineSegments.prepareSegment(te.length,i.layoutVertexArray,i.lineIndexArray),_e=ne.vertexLength;s&&W.push(i.layoutVertexArray.length-H),g(te[0],B,V),i.layoutVertexArray.emplaceBack(te[0].x,te[0].y),i.lineIndexArray.emplaceBack(_e+te.length-1,_e),I.push(te[0].x),I.push(te[0].y);for(let de=1;de<te.length;de++)g(te[de],B,V),i.layoutVertexArray.emplaceBack(te[de].x,te[de].y),i.lineIndexArray.emplaceBack(_e+de-1,_e+de),I.push(te[de].x),I.push(te[de].y);ne.vertexLength+=te.length,ne.primitiveLength+=te.length}let J=Mh(I,D);for(let te=0;te<J.length;te+=3)i.indexArray.emplaceBack(k+J[te],k+J[te+1],k+J[te+2]);if(J.length>0&&s&&this.elevationMode==="hd-road-base"){let te=s.elevation.isTunnel(),ne=s.elevation.safeArea,_e=this.elevatedStructures.addVertices(B,V);this.elevatedStructures.addTriangles(J,_e,te);let de=W.length;if(de>0){for(let xe=0;xe<de-1;xe++)this.elevatedStructures.addRenderableRing(s.index,W[xe]+_e,W[xe+1]-W[xe],te,ne,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,W[de-1]+_e,B.length-W[de-1],te,ne,s.featureInfo)}}A.vertexLength+=w,A.primitiveLength+=J.length/3}return[a,u]}prepareElevatedPolygons(e,i,s){let a=1/ve(s),u=[];for(let p of e){let g=JO(p,new Fr(i,a));u.push(...g)}return u}clipPolygonsToTile(e,i){let s=-i,a=-i,u=ht+i,p=ht+i,g=0,b=[],w=[];for(;g<e.length;g++){let I=e[g],D=Da(I);(D.min.x>=s&&D.max.x<=u&&D.min.y>=a&&D.max.y<=p?b:w).push(I)}if(b.length===e.length)return e;let A=[new st(s,a),new st(u,a),new st(u,p),new st(s,p),new st(s,a)],k=b;for(let I of w)k.push(...KO(I,A));return k}}let $1,X1,Y1,K1;Ot(Iv,"FillBucket",{omit:["layers","patternFeatures"]}),Ot(kv,"FillBufferData"),Ot(Os,"ElevatedStructures");class Dg{constructor(e,i,s,a){if(this.triangleCount=i.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,p]=[e[0].clone(),e[0].clone()];for(let k=1;k<e.length;++k){let I=e[k];u.x=Math.min(u.x,I.x),u.y=Math.min(u.y,I.y),p.x=Math.max(p.x,I.x),p.y=Math.max(p.y,I.y)}if(a){let k=Math.ceil(Math.max(p.x-u.x,p.y-u.y)/a);s=Math.max(s,k)}if(s===0)return;this.min=u,this.max=p;let g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);let b=Math.max(g.x,g.y)/s;this.cellsX=Math.max(1,Math.ceil(g.x/b)),this.cellsY=Math.max(1,Math.ceil(g.y/b)),this.xScale=1/b,this.yScale=1/b;let w=[];for(let k=0;k<this.triangleCount;k++){let I=e[i[3*k+0]].sub(this.min),D=e[i[3*k+1]].sub(this.min),B=e[i[3*k+2]].sub(this.min),V=ec(Math.floor(Math.min(I.x,D.x,B.x)),this.xScale,this.cellsX),W=ec(Math.floor(Math.max(I.x,D.x,B.x)),this.xScale,this.cellsX),H=ec(Math.floor(Math.min(I.y,D.y,B.y)),this.yScale,this.cellsY),J=ec(Math.floor(Math.max(I.y,D.y,B.y)),this.yScale,this.cellsY),te=new st(0,0),ne=new st(0,0),_e=new st(0,0),de=new st(0,0);for(let xe=H;xe<=J;++xe){te.y=ne.y=xe*b,_e.y=de.y=(xe+1)*b;for(let Ce=V;Ce<=W;++Ce)te.x=_e.x=Ce*b,ne.x=de.x=(Ce+1)*b,(wn(I,D,B,te,ne,de)||wn(I,D,B,te,de,_e))&&w.push({cellIdx:xe*this.cellsX+Ce,triIdx:k})}}if(w.length===0)return;w.sort(((k,I)=>k.cellIdx-I.cellIdx||k.triIdx-I.triIdx));let A=0;for(;A<w.length;){let k=w[A].cellIdx,I={start:this.payload.length,len:0};for(;A<w.length&&w[A].cellIdx===k;)++I.len,this.payload.push(w[A++].triIdx);this.cells[k]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let s=ec(e.x-this.min.x,this.xScale,this.cellsX),a=ec(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[a*this.cellsX+s];if(u){this._lazyInitLookup();for(let p=0;p<u.len;p++){let g=this.payload[u.start+p],b=Math.floor(g/8),w=1<<g%8;if(!(this.lookup[b]&w)&&(this.lookup[b]|=w,i.push(g),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();let a=ec(e.x-this.min.x,this.xScale,this.cellsX),u=ec(i.x-this.min.x,this.xScale,this.cellsX),p=ec(e.y-this.min.y,this.yScale,this.cellsY),g=ec(i.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=g;b++)for(let w=a;w<=u;w++){let A=this.cells[b*this.cellsX+w];if(A)for(let k=0;k<A.len;k++){let I=this.payload[A.start+k],D=Math.floor(I/8),B=1<<I%8;if(!(this.lookup[D]&B)&&(this.lookup[D]|=B,s.push(I),s.length===this.triangleCount))return}}}}function ec(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Ot(Dg,"TriangleGridIndex");class J1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(let s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}populate(e,i,s,a){let u=[];for(let{feature:p,id:g,index:b,sourceLayerIndex:w}of e){let A=this.layers[0]._featureFilter.needGeometry,k=Ne(p,A);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,s))continue;let I={id:g,properties:p.properties,type:p.type,sourceLayerIndex:w,index:b,geometry:A?k.geometry:Ke(p,s,a),patterns:{}};u.push(I)}for(let p of u){let{geometry:g,index:b,sourceLayerIndex:w}=p;this.addFeature(p,g,b,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,g,b,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,a,u,p,g){}destroy(){}addFeature(e,i,s,a,u,p=[],g){for(let b of Mf(i,2)){let w=[],A=[],k=[],I=new st(1/0,1/0),D=new st(-1/0,-1/0);for(let W of b)if(W.length!==0){W!==b[0]&&k.push(A.length/2);for(let H=0;H<W.length;H++)A.push(W[H].x),A.push(W[H].y),w.push(W[H]),I.x=Math.min(I.x,W[H].x),I.y=Math.min(I.y,W[H].y),D.x=Math.max(D.x,W[H].x),D.y=Math.max(D.y,W[H].y)}let B=Mh(A,k),V=new Dg(w,B,8,256);this.footprints.push({vertices:w,indices:B,grid:V,min:I,max:D})}}}Ot(J1,"ClipBucket",{omit:["layers"]});let QO=Li([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),eR=Li([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),tR=Li([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),iR=Li([{name:"a_centroid_pos",components:2,type:"Uint16"}]),rR=Li([{name:"a_join_normal_inside",components:3,type:"Int16"}]),nR=Li([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),oR=Li([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:sR}=QO,Of=Number.MAX_SAFE_INTEGER,Q1=Of-1;function ew(r,e,i,s){return r.order<e||r.order===Of||!(r.clipMask&i)||(function(a,u){return u.length!==0&&u.find((p=>p===a))===void 0})(s,r.clipScope)}function Bg(r,e){return r.x-e.x||r.y-e.y}function tw(r,e){return Bg(r.min,e.min)===0&&Bg(r.max,e.max)===0}function Pv(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Fg(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!tw(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!oa(r[i].clipScope,e[i].clipScope))return!1;return!0}function iw(r,e,i){let s=1/ht,a=1/(1<<i.canonical.z),u=(e.x*s+i.canonical.x)*a+i.wrap,p=(e.y*s+i.canonical.y)*a;return{min:new st((r.x*s+i.canonical.x)*a+i.wrap,(r.y*s+i.canonical.y)*a),max:new st(u,p)}}function aR(r,e,i){let s=1<<i.canonical.z,a=((e.x-i.wrap)*s-i.canonical.x)*ht,u=(e.y*s-i.canonical.y)*ht;return{min:new st(((r.x-i.wrap)*s-i.canonical.x)*ht,(r.y*s-i.canonical.y)*ht),max:new st(a,u)}}function Lv(r,e,i,s,a,u,p){let g=r.indices,b=r.vertices,w=[];for(let A=s;A<s+a;A+=3){let k=e[i[A+0]+u],I=e[i[A+1]+u],D=e[i[A+2]+u],B=Math.min(k.x,I.x,D.x),V=Math.max(k.x,I.x,D.x),W=Math.min(k.y,I.y,D.y),H=Math.max(k.y,I.y,D.y);w.length=0,r.grid.query(new st(B,W),new st(V,H),w);for(let J=0;J<w.length;J++){let te=w[J];if(wn(b[g[3*te+0]],b[g[3*te+1]],b[g[3*te+2]],k,I,D,p))return!0}}return!1}function rw(r,e,i,s){if(!r||!i)return!1;let a=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<r.vertices.length)return rw(i,s,r,e);let u=e.canonical,p=s.canonical,g=Math.pow(2,p.z-u.z);a=r.vertices.map((b=>new st((b.x+u.x*ht)*g-p.x*ht,(b.y+u.y*ht)*g-p.y*ht)))}return Lv(i,a,r.indices,0,r.indices.length,0,0)}function nw(r,e,i,s){let a=Math.pow(2,s.z-i.z);return new st((r+i.x*ht)*a-s.x*ht,(e+i.y*ht)*a-s.y*ht)}function zv(r,e){let i=[];e.grid.queryPoint(r,i);let s=e.indices,a=e.vertices;for(let u=0;u<i.length;u++){let p=i[u];if($n([a[s[3*p+0]],a[s[3*p+1]],a[s[3*p+2]]],r))return!0}return!1}let Mv=[new st(0,0),new st(ht,0),new st(ht,ht),new st(0,ht)];function ow(r,e){let i=[],s=[];if(!e||r.length<2)return[r];if(r.length===2)return vn(r[0],r[1],Mv)?[r]:[];for(let a=0;a<r.length+2;a++){let u=r[a%r.length],p=r[(a+1)%r.length],g=vn(a===0?r[r.length-1]:r[(a-1)%r.length],u,Mv),b=vn(u,p,Mv),w=g||b;w&&s.push(u),w&&b||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}let Ov=nt.types,lR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],cR=["fill-extrusion-flood-light-ground-radius"],uR=Math.pow(2,13),dR=Math.pow(2,15)-1,sw=new st(0,1),Iu=2147483648,aw=7,lw=450;function Rf(r,e,i,s,a,u,p,g){r.emplaceBack((e<<1)+p,(i<<1)+u,(Math.floor(s*uR)<<1)+a,Math.round(g))}function Df(r,e,i){r.emplaceBack(e.x*ht,e.y*ht,i?1:0)}function Ng(r,e,i,s,a,u){r.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+a,u)}function Bf(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class cw{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class uw{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class dw{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===ht)&&i.x===s.x)!=((i.y===0||i.y===ht)&&i.y===s.y)&&this.processBorderOverlap(i,s),a&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,$t(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ht!=e.x>ht&&this.addBorderIntersection(1,$t(i.y,e.y,(ht-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,$t(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ht!=e.y>ht&&this.addBorderIntersection(3,$t(i.x,e.x,(ht-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{let s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function hw(r,e){let i=r.add(e)._unit(),s=X(r.x*i.x+r.y*i.y,-1,1);var a,u,p;return a=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(a)))/4*dR*((u=r).x*(p=e).y-u.y*p.x<0?-1:1)}let hR=[r=>r.x<0,r=>r.x>ht,r=>r.y<0,r=>r.y>ht];function pR(r,e,i,s){let a=[4];if(s===0)return a;i._mult(s);let u=r.sub(i),p=e.sub(i),g=[r,e,u,p];for(let b=0;b<4;b++)for(let w of g)if(hR[b](w)){a.push(b);break}return a}class Rv{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new yh,this.indexArray=new Yr,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut},(i=>cR.includes(i))),this._segments=new tn,this.hiddenByLandmarkVertexArray=new Ch,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new tn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,a=!1){let u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1),g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],A=e[1];b=hw(w.sub(e[u-1])._perp()._unit(),A.sub(w)._perp()._unit())}for(let w=0;w<u;w++){let A=w===u-1?0:w+1,k=e[w],I=e[A],D=e[A===u-1?0:A+1],B=I.sub(k)._perp()._unit(),V=hw(B,D.sub(I)._perp()._unit()),W=b,H=V;if(Dv(k,I,i)||a&&mw(k,i)&&mw(I,i)){b=V;continue}let J=g.vertexLength;Ng(this.vertexArray,k,I,1,1,W),Ng(this.vertexArray,k,I,1,0,W),Ng(this.vertexArray,k,I,0,1,H),Ng(this.vertexArray,k,I,0,0,H),g.vertexLength+=4;let te=pR(k,I,B,s);for(let ne of te)this._segmentToGroundQuads[p].push({id:J,region:ne}),this._segmentToRegionTriCounts[p][ne]+=2,g.primitiveLength+=2;b=V}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort(((a,u)=>a.region-u.region));for(let s=0;s<i;s++){let a=this._segmentToGroundQuads[s],u=e[s],p=this._segmentToRegionTriCounts[s];p.reduce(((b,w)=>b+w),0);let g=0;for(let b=0;b<=4;b++){let w=p[b];if(w!==0){let A=this.regionSegments[b];A||(A=this.regionSegments[b]=new tn);let k={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:w};A.get().push(k)}g+=w}for(let b=0;b<a.length;b++){let w=a[b].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,a,u,p,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,a,u,p,void 0,g)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,eR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,tR.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,a,u,p,g,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,a,u,p,g,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Iu))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;let a=i+e;if(i!==0){for(let u=e;u<a;++u)this.hiddenByLandmarkVertexArray.emplace(u,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,nR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class jg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Yr,this.footprintVertices=new Xo,this.footprintSegments=[],this.layoutVertexArray=new _u,this.centroidVertexArray=new bg,this.wallVertexArray=new Sg,this.indexArray=new Yr,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut},(i=>lR.includes(i))),this.segments=new tn,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new Rv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.features=[],this.hasPattern=Cv("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ve(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:u,id:p,index:g,sourceLayerIndex:b}of e){let w=this.layers[0]._featureFilter.needGeometry,A=Ne(u,w);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),A,s))continue;let k={id:p,sourceLayerIndex:b,index:g,geometry:w?A.geometry:Ke(u,s,a),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length,D=Ov[k.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:u.id,feature:Ev("fill-extrusion",this.layers,k,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(let B of k.geometry)for(let V of ow(B,D))this.addFeature(u.id,k,[V],g,s,{},i.availableImages,a,i.brightness);else this.addFeature(u.id,k,k.geometry,g,s,{},i.availableImages,a,i.brightness);i.featureIndex.insert(u,k.geometry,g,b,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,a,u,p){for(let{featureId:g,feature:b}of this.features){let w=Ov[b.type]==="Polygon",{geometry:A}=b;if(this.wallMode)for(let k of A)for(let I of ow(k,w))this.addFeature(g,b,[I],b.index,i,s,a,u,p);else this.addFeature(g,b,A,b.index,i,s,a,u,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,a,u,p,g){this.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,this.worldview),this.groundEffect.update(e,i,u,s,a,p,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,rR.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,oR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,iR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,a,u,p,g,b,w){let A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,k=[new st(0,0),new st(ht,ht)],I=b.projection,D=I.name==="globe",B=this.wallMode||Ov[i.type]==="Polygon",V=new dw;V.centroidDataIndex=this.centroidData.length;let W=new uw;W.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(W.buildingId=i.properties.building_id);let H=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},u)<=0,J=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},u),te;if(W.height=J,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new xh),this.wallMode){if(D)return void Zt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;te=(function(Oe){let Ze=Oe[0].x===Oe[Oe.length-1].x&&Oe[0].y===Oe[Oe.length-1].y;(function(Pt){let Ct=0,ui=Pt.length;for(let At=0;At<ui;At++)Ct+=(Pt[(At+1)%ui].x-Pt[At].x)*(Pt[(At+1)%ui].y+Pt[At].y);return Ct>=0})(Oe)||(Oe=Oe.reverse());let it={geometry:[],joinNormals:[],indices:[]},_t=[],ct=[],Qe=[],lt=Oe.length;for(;lt>=2&&Oe[lt-1].equals(Oe[lt-2]);)lt--;if(lt<(Ze?3:2))return it;let We,Ue,at,mt,et,Mt=0;for(;Mt<lt-1&&Oe[Mt].equals(Oe[Mt+1]);)Mt++;Ze&&(We=Oe[lt-2],et=Oe[Mt].sub(We)._unit()._perp());for(let Pt=Mt;Pt<lt;Pt++){if(at=Pt===lt-1?Ze?Oe[Mt+1]:void 0:Oe[Pt+1],at&&Oe[Pt].equals(at))continue;et&&(mt=et),We&&(Ue=We),We=Oe[Pt],et=at?at.sub(We)._unit()._perp():mt,mt=mt||et;let Ct=mt.add(et);Ct.x===0&&Ct.y===0||Ct._unit();let ui=Ct.x*et.x+Ct.y*et.y,At=ui!==0?1/ui:1/0,Ht=mt.x*et.y-mt.y*et.x>0,di="miter",Ti=2;di==="miter"&&At>Ti&&(di="bevel"),di==="bevel"&&(At>100&&(di="flipbevel"),At<Ti&&(di="miter"));let Xi=(mi,rr,nr,en)=>{let he=new st(mi.x,mi.y),ce=new st(mi.x,mi.y);he.x+=rr.x*en,he.y+=rr.y*en,ce.x-=rr.x*Math.max(nr,1),ce.y-=rr.y*Math.max(nr,1),Qe.push(rr),_t.push(he),ct.push(ce)};if(di==="miter")Ct._mult(At),Xi(We,Ct,0,0);else if(di==="flipbevel")Ct=et.mult(-1),Xi(We,Ct,0,0),Xi(We,Ct.mult(-1),0,0);else{let mi=-Math.sqrt(At*At-1),rr=Ht?mi:0,nr=Ht?0:mi;Ue&&Xi(We,mt,rr,nr),at&&Xi(We,et,rr,nr)}}it.geometry=[..._t,...ct.reverse(),_t[0]],it.joinNormals=[...Qe,...Qe.reverse(),Qe[Qe.length-1]];let Bt=it.geometry.length-1;for(let Pt=0;Pt<Bt/2;Pt++)if(Pt+1<Bt/2){let Ct=Pt,ui=Pt+1,At=Bt-1-Pt,Ht=Bt-2-Pt;Ct=Ct===0?Bt-1:Ct-1,ui=ui===0?Bt-1:ui-1,At=At===0?Bt-1:At-1,Ht=Ht===0?Bt-1:Ht-1,it.indices.push(At),it.indices.push(ui),it.indices.push(Ct),it.indices.push(At),it.indices.push(Ht),it.indices.push(ui)}return it})(s[0]),s=[te.geometry]}let ne=(Oe,Ze)=>Oe<(Ze.length-1)/2||Oe===Ze.length-1,_e=this.wallMode?[s]:Mf(s,500);for(let Oe=_e.length-1;Oe>=0;Oe--){let Ze=_e[Oe];(Ze.length===0||(de=Ze[0]).every((Je=>Je.x<=0))||de.every((Je=>Je.x>=ht))||de.every((Je=>Je.y<=0))||de.every((Je=>Je.y>=ht)))&&_e.splice(Oe,1)}var de;let xe;if(D)xe=vw(_e,k,u);else{xe=[];for(let Oe of _e)xe.push({polygon:Oe,bounds:k})}let Ce=B?this.edgeRadius:0,Ae=Ce>0&&this.zoom<17,He=(Oe,Ze)=>{if(Oe.length===0)return!1;let Je=Oe[Oe.length-1];return Ze.x===Je.x&&Ze.y===Je.y};for(let{polygon:Oe,bounds:Ze}of xe){let Je=0,it=0;for(let lt of Oe)B&&!lt[0].equals(lt[lt.length-1])&&lt.push(lt[0]),it+=B?lt.length-1:lt.length;let _t=this.segments.prepareSegment((B?5:4)*it,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);let ct={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Qe=new cw;if(Qe.vertexOffset=this.footprintVertices.length,Qe.indexOffset=3*this.footprintIndices.length,Qe.ringIndices=[],B){let lt=[],We=[];Je=_t.vertexLength;for(let at=0;at<Oe.length;at++){let mt=Oe[at];mt.length&&at!==0&&We.push(lt.length/2);let et=[],Mt,Bt;Mt=mt[1].sub(mt[0])._perp()._unit(),Qe.ringIndices.push(mt.length-1);for(let Pt=1;Pt<mt.length;Pt++){let Ct=mt[Pt],ui=mt[Pt===mt.length-1?1:Pt+1],At=Ct.clone();if(Ce){Bt=ui.sub(Ct)._perp()._unit();let Ht=Mt.add(Bt)._unit(),di=Ce*Math.min(4,1/(Mt.x*Ht.x+Mt.y*Ht.y));At.x+=di*Ht.x,At.y+=di*Ht.y,At.x=Math.round(At.x),At.y=Math.round(At.y),Mt=Bt}if(!H||Ce!==0&&!Ae||He(et,At)||et.push(At),Rf(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),this.wallMode){let Ht=ne(Pt,mt);Df(this.wallVertexArray,te.joinNormals[Pt],!Ht)}_t.vertexLength++,this.footprintVertices.emplaceBack(Ct.x,Ct.y),lt.push(Ct.x,Ct.y),D&&Bf(this.layoutVertexExtArray,I.projectTilePoint(At.x,At.y,u),I.upVector(u,At.x,At.y))}H&&(Ce===0||Ae)&&(et.length!==0&&He(et,et[0])&&et.pop(),this.groundEffect.addData(et,Ze,A))}let Ue=this.wallMode?te.indices:Mh(lt,We);for(let at=0;at<Ue.length;at+=3)this.footprintIndices.emplaceBack(Qe.vertexOffset+Ue[at+0],Qe.vertexOffset+Ue[at+1],Qe.vertexOffset+Ue[at+2]),this.indexArray.emplaceBack(Je+Ue[at],Je+Ue[at+2],Je+Ue[at+1]),_t.primitiveLength++;Qe.indexCount+=Ue.length,Qe.vertexCount+=this.footprintVertices.length-Qe.vertexOffset}for(let lt=0;lt<Oe.length;lt++){let We=Oe[lt];V.startRing(W,We[0]);let Ue=We.length>4&&gw(We[We.length-2],We[0],We[1]),at=Ce?fR(We[We.length-2],We[0],We[1],Ce):0,mt=[],et,Mt,Bt;Mt=We[1].sub(We[0])._perp()._unit();let Pt=!0;for(let Ct=1,ui=0;Ct<We.length;Ct++){let At=We[Ct-1],Ht=We[Ct],di=We[Ct===We.length-1?1:Ct+1];if(V.appendEdge(W,Ht,At),Dv(Ht,At,Ze)){Ce&&(Mt=di.sub(Ht)._perp()._unit(),Pt=!Pt);continue}let Ti=Ht.sub(At)._perp(),Xi=Ti.x/(Math.abs(Ti.x)+Math.abs(Ti.y)),mi=Ti.y>0?1:0,rr=At.dist(Ht);if(ui+rr>32768&&(ui=0),Ce){Bt=di.sub(Ht)._perp()._unit();let ce=fw(At,Ht,di,pw(Mt,Bt),Ce);isNaN(ce)&&(ce=0);let $e=Ht.sub(At)._unit();At=At.add($e.mult(at))._round(),Ht=Ht.add($e.mult(-ce))._round(),at=ce,Mt=Bt,H&&this.zoom>=17&&(He(mt,At)||mt.push(At),He(mt,Ht)||mt.push(Ht))}let nr=_t.vertexLength,en=We.length>4&&gw(At,Ht,di),he=_w(ui,Ue,Pt);if(Rf(this.layoutVertexArray,At.x,At.y,Xi,mi,0,0,he),Rf(this.layoutVertexArray,At.x,At.y,Xi,mi,0,1,he),this.wallMode){let ce=ne(Ct-1,We),$e=te.joinNormals[Ct-1];Df(this.wallVertexArray,$e,ce),Df(this.wallVertexArray,$e,ce)}if(ui+=rr,he=_w(ui,en,!Pt),Ue=en,Rf(this.layoutVertexArray,Ht.x,Ht.y,Xi,mi,0,0,he),Rf(this.layoutVertexArray,Ht.x,Ht.y,Xi,mi,0,1,he),this.wallMode){let ce=ne(Ct,We),$e=te.joinNormals[Ct];Df(this.wallVertexArray,$e,ce),Df(this.wallVertexArray,$e,ce)}if(_t.vertexLength+=4,this.indexArray.emplaceBack(nr+0,nr+1,nr+2),this.indexArray.emplaceBack(nr+1,nr+3,nr+2),_t.primitiveLength+=2,Ce){let ce=Je+(Ct===1?We.length-2:Ct-2),$e=Ct===1?Je:ce+1;if(this.indexArray.emplaceBack(nr+1,ce,nr+3),this.indexArray.emplaceBack(ce,$e,nr+3),_t.primitiveLength+=2,et===void 0&&(et=nr),!Dv(di,We[Ct],Ze)){let Tt=Ct===We.length-1?et:_t.vertexLength;this.indexArray.emplaceBack(nr+2,nr+3,Tt),this.indexArray.emplaceBack(nr+3,Tt+1,Tt),this.indexArray.emplaceBack(nr+3,$e,Tt+1),_t.primitiveLength+=3}Pt=!Pt}if(D){let ce=this.layoutVertexExtArray,$e=I.projectTilePoint(At.x,At.y,u),Tt=I.projectTilePoint(Ht.x,Ht.y,u),Xe=I.upVector(u,At.x,At.y),Et=I.upVector(u,Ht.x,Ht.y);Bf(ce,$e,Xe),Bf(ce,$e,Xe),Bf(ce,Tt,Et),Bf(ce,Tt,Et)}}B&&(Je+=We.length-1),H&&Ce&&this.zoom>=17&&(mt.length!==0&&He(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Ze,A,Ce>0))}this.footprintSegments.push(Qe),ct.triangleCount=this.indexArray.length-ct.triangleArrayOffset,this.polygonSegments.push(ct),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,W.vertexCount!==0){if(W.centroidXY=V.borders?sw:this.encodeCentroid(V,W),this.centroidData.push(W),V.borders){this.featuresOnBorder.push(V);let Oe=this.featuresOnBorder.length-1;for(let Ze=0;Ze<V.borders.length;Ze++)V.borders[Ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ze].push(Oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,p,g,u,w,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,a,p,g,u,w,this.worldview),this.maxHeight=Math.max(this.maxHeight,J)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0]))}splitToSubtiles(){let e=[];for(let g=0;g<this.centroidData.length;g++){let b=this.centroidData[g],w=+(b.min.y+b.max.y>ht),A=2*w+(+(b.min.x+b.max.x>ht)^w);for(let k=0;k<b.polygonSegLen;k++){let I=b.polygonSegIdx+k;e.push({centroidIdx:g,subtile:A,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}let i=new Yr;e.sort(((g,b)=>g.triangleSegmentIdx===b.triangleSegmentIdx?g.subtile-b.subtile:g.triangleSegmentIdx-b.triangleSegmentIdx));let s=0,a=0,u=0;for(let g of e){if(g.triangleSegmentIdx!==s)break;u++}let p=e.length;for(;a!==e.length;){s=e[a].triangleSegmentIdx;let g=0,b=a,w=a;for(let A=b;A<u&&e[A].subtile===g;A++)w++;for(;b!==u;){let A=e[b];g=A.subtile;let k=this.centroidData[A.centroidIdx].min.clone(),I=this.centroidData[A.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=b;B<w;B++){let V=e[B],W=this.polygonSegments[V.polygonSegmentIdx],H=this.centroidData[V.centroidIdx].min,J=this.centroidData[V.centroidIdx].max,te=this.indexArray.uint16;for(let ne=W.triangleArrayOffset;ne<W.triangleArrayOffset+W.triangleCount;ne++)i.emplaceBack(te[3*ne],te[3*ne+1],te[3*ne+2]);D.primitiveLength+=W.triangleCount,k.x=Math.min(k.x,H.x),k.y=Math.min(k.y,H.y),I.x=Math.max(I.x,J.x),I.y=Math.max(I.y,J.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:k,max:I}),b=w;for(let B=b;B<u&&e[B].subtile===e[b].subtile;B++)w++}a=u;for(let A=a;A<p&&e[A].triangleSegmentIdx===e[a].triangleSegmentIdx;A++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){let a=new tn;if(this.wallMode){for(let V of this.triangleSubSegments)a.segments.push(V.segment);return a}let u=0,p=0,g=1<<e.canonical.z;if(i){let V=i.getMinMaxForTile(e);V&&(u=V.min,p=V.max)}p+=this.maxHeight;let b=e.toUnwrapped(),w,A=[b.canonical.x/g+b.wrap,b.canonical.y/g],k=[(b.canonical.x+1)/g+b.wrap,(b.canonical.y+1)/g],I=(V,W,H)=>[V[0]*(1-H[0])+W[0]*H[0],V[1]*(1-H[1])+W[1]*H[1]],D=[],B=[];for(let V of this.triangleSubSegments){D[0]=V.min.x/ht,D[1]=V.min.y/ht,B[0]=V.max.x/ht,B[1]=V.max.y/ht;let W=I(A,k,D),H=I(A,k,B);if(new wi([W[0],W[1],u],[H[0],H[1],p]).intersectsPrecise(s)===0){w&&(a.segments.push(w),w=void 0);continue}let J=V.segment;w&&w.vertexOffset!==J.vertexOffset&&(a.segments.push(w),w=void 0),w?(w.vertexLength+=J.vertexLength,w.primitiveLength+=J.primitiveLength):w={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&a.segments.push(w),a}encodeCentroid(e,i){let s=e.centroid(),a=i.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),p=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new st(X(s.x,1,ht-1)<<3|u,X(s.y,1,ht-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new st(0,0);let i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){let a=i[0][0]!==s?0:1;return new st(6|(i[0][0]!==s?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{let a=i[2][0]!==s?2:3;return new st((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,a=e.flags&Iu?sw:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||u!==a.x){for(let p=i;p<s;++p)this.centroidVertexArray.emplace(p,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let a=i.getReplacementRegionsForTile(e.toUnwrapped());if(Fg(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let u=[];for(let p of this.activeReplacements){if(p.order<s)continue;let g=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){let b=p.footprint.buildingId;for(let w of this.centroidData)w.buildingId===b&&(w.flags|=Iu)}else for(let b of this.centroidData)if(!(b.flags&Iu||p.min.x>b.max.x||b.min.x>p.max.x||p.min.y>b.max.y||b.min.y>p.max.y))for(let w=0;w<b.footprintSegLen;w++){let A=this.footprintSegments[b.footprintSegIdx+w];if(u.length=0,mR(this.footprintVertices,A.vertexOffset,A.vertexCount,p.footprintTileId.canonical,e.canonical,u),Lv(p.footprint,u,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-g)){b.flags|=Iu;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let a=!1;for(let u=0;u<s.footprintSegLen;u++){let p=this.footprintSegments[s.footprintSegIdx+u],g=0;for(let b of p.ringIndices){for(let w=g,A=b+g-1;w<b+g;A=w++){let k=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],I=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],D=this.footprintVertices.int16[2*(A+p.vertexOffset)+1];I>i!=D>i&&e<(this.footprintVertices.int16[2*(A+p.vertexOffset)+0]-k)*(i-I)/(D-I)+k&&(a=!a)}g=b}}return a}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0,u=4*(e+ht)*ht+(i+ht);if(this.partLookup.hasOwnProperty(u)){let p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&Iu)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=s||this.footprintContainsPoint(e,i,p)&&(s=p.height,this.partLookup[u]=p,a=!!(p.flags&Iu));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[u]=void 0}}function pw(r,e){let i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function fR(r,e,i,s){let a=e.sub(r)._perp()._unit(),u=i.sub(e)._perp()._unit();return fw(r,e,i,pw(a,u),s)}function fw(r,e,i,s,a){let u=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(i)/3,a*u/s)}function Dv(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function mw(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function gw(r,e,i){if(r.x<0||r.x>=ht||e.x<0||e.x>=ht||i.x<0||i.x>=ht)return!1;let s=i.sub(e),a=s.perp(),u=r.sub(e);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function _w(r,e,i){let s=e?2|r:-3&r;return i?1|s:-2&s}function yw(){let r=Math.PI/32,e=Math.tan(r),i=P;return i*Math.sqrt(1+2*e*e)-i}function vw(r,e,i){let s=1<<i.z,a=se(i.x/s),u=se((i.x+1)/s),p=ie(i.y/s),g=ie((i.y+1)/s);return(function(b,w,A,k,I=0,D){let B=[];if(!b.length||!A||!k)return B;let V=(de,xe)=>{for(let Ce of de)B.push({polygon:Ce,bounds:xe})},W=Math.ceil(Math.log2(A)),H=Math.ceil(Math.log2(k)),J=W-H,te=[];for(let de=0;de<Math.abs(J);de++)te.push(J>0?0:1);for(let de=0;de<Math.min(W,H);de++)te.push(0),te.push(1);let ne=b;if(ne=Rg(ne,w[0].y-I,w[1].y+I,1),ne=Rg(ne,w[0].x-I,w[1].x+I,0),!ne.length)return B;let _e=[];for(te.length?_e.push({polygons:ne,bounds:w,depth:0}):V(ne,w);_e.length;){let de=_e.pop(),xe=de.depth,Ce=te[xe],Ae=de.bounds[0],He=de.bounds[1],Oe=Ce===0?Ae.x:Ae.y,Ze=Ce===0?He.x:He.y,Je=D?D(Ce,Oe,Ze):.5*(Oe+Ze),it=Rg(de.polygons,Oe-I,Je+I,Ce),_t=Rg(de.polygons,Je-I,Ze+I,Ce);if(it.length){let ct=[Ae,new st(Ce===0?Je:He.x,Ce===1?Je:He.y)];te.length>xe+1?_e.push({polygons:it,bounds:ct,depth:xe+1}):V(it,ct)}if(_t.length){let ct=[new st(Ce===0?Je:Ae.x,Ce===1?Je:Ae.y),He];te.length>xe+1?_e.push({polygons:_t,bounds:ct,depth:xe+1}):V(_t,ct)}}return B})(r,e,Math.ceil((u-a)/11.25),Math.ceil((p-g)/11.25),1,((b,w,A)=>{if(b===0)return .5*(w+A);{let k=ie((i.y+w/ht)/s);return($(.5*(ie((i.y+A/ht)/s)+k))*s-i.y)*ht}}))}function mR(r,e,i,s,a,u){let p=Math.pow(2,s.z-a.z);for(let g=0;g<i;g++){let b=r.int16[2*(g+e)+0],w=r.int16[2*(g+e)+1];b=(b+a.x*ht)*p-s.x*ht,w=(w+a.y*ht)*p-s.y*ht,u.push(new st(b,w))}}let xw,bw;Ot(jg,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(uw,"PartData"),Ot(cw,"FootprintSegment"),Ot(dw,"BorderCentroidData"),Ot(Rv,"GroundEffect");class Sd extends st{constructor(e,i,s){super(e,i),this.z=s}}class ww extends Sd{constructor(e,i,s,a){super(e,i,s),this.w=a}}function Sw(r,e,i,s){let a=i==="x"?"y":"x",u=(s-r[i])/(e[i]-r[i]);r[a]=Math.round(r[a]+(e[a]-r[a])*u),r[i]=s,r.hasOwnProperty("z")&&(r.z=$t(r.z,e.z,u)),r.hasOwnProperty("w")&&(r.w=$t(r.w,e.w,u))}function Tw(r,e,i,s){let a=i,u=s;for(let p of["x","y"]){let g=r,b=e;g[p]>=b[p]&&(g=e,b=r),g[p]<a&&b[p]>a&&Sw(g,b,p,a),g[p]<u&&b[p]>u&&Sw(b,g,p,u)}}function Vg(r,e,i,s,a,u){let p=[];for(let g=0;g<r.length;g++){let b=r[g],w,A=p.length,k=0;for(let I=0;I<b.length-1;I++){let D=b[I],B=b[I+1],V=0,W=k,H,J;u&&(V=Math.hypot(B.x-D.x,B.y-D.y),k+=V,H=D,J=B),D.x<e&&B.x<e||(D.x<e?D=new st(e,D.y+(e-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x<e&&(B=new st(e,D.y+(e-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y<i&&B.y<i||(D.y<i?D=new st(D.x+(i-D.y)/(B.y-D.y)*(B.x-D.x),i)._round():B.y<i&&(B=new st(D.x+(i-D.y)/(B.y-D.y)*(B.x-D.x),i)._round()),D.x>=s&&B.x>=s||(D.x>=s?D=new st(s,D.y+(s-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x>=s&&(B=new st(s,D.y+(s-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y>=a&&B.y>=a||(D.y>=a?D=new st(D.x+(a-D.y)/(B.y-D.y)*(B.x-D.x),a)._round():B.y>=a&&(B=new st(D.x+(a-D.y)/(B.y-D.y)*(B.x-D.x),a)._round()),w&&D.equals(w[w.length-1])||(w=[D],p.push(w),u&&u.push({progress:{min:W+Cw(H,J,D)*V,max:1},parentIndex:g,prevPoint:H,nextPoint:J})),w.push(B),u&&(u[u.length-1].progress.max=W+Cw(H,J,B)*V,u[u.length-1].nextPoint=J)))))}if(u&&k>0)for(let I=A;I<p.length;I++)u[I].progress.min/=k,u[I].progress.max/=k}return p}function gR(r,e,i,s,a){if(r.length<2)return void s.push(r);let u=[];for(;e.valid();){let[w,A]=e.get();for(let k=0;k<r.length-1;k++){let I=r[k],D=r[k+1],B=Is(I,D,w,A);if(B){let[V]=B,W=new st($t(I.x,D.x,V),$t(I.y,D.y,V));u.push({t:k+V,distance:0,point:W})}}e.next()}if(u.length===0)return void s.push(r);u.sort(((w,A)=>w.t-A.t));let p=0,g=0,b=[];for(s.push(b);p!==r.length;){if(g===u.length){for(;p!==r.length;)b.length!==0&&b[b.length-1].equals(r[p])||b.push(r[p]),p++;break}u[g].t<=p?(b.length!==0&&b[b.length-1].equals(u[g].point)||b.push(u[g].point),Math.trunc(u[g].t),g++):(b.length!==0&&b[b.length-1].equals(r[p])||b.push(r[p]),p++)}}function Cw(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Ff(r,e){return r.x*e.x+r.y*e.y}function Ew(r,e){if(r.length===1){let i=0,s=e[i++],a;for(;!a||s.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){let u=e[i],p=r[0],g=a.sub(s),b=u.sub(s),w=p.sub(s),A=Ff(g,g),k=Ff(g,b),I=Ff(b,b),D=Ff(w,g),B=Ff(w,b),V=A*I-k*k,W=(I*D-k*B)/V,H=(A*B-k*D)/V,J=s.z*(1-W-H)+a.z*W+u.z*H;if(isFinite(J))return J}return 1/0}{let i=1/0;for(let s of e)i=Math.min(i,s.z);return i}}function Aw(r,e,i){let s=1/0;pn(i,e)&&(s=Ew(i,e[0]));for(let a=0;a<e.length;a++){let u=e[a],p=r[a];for(let g=0;g<u.length-1;g++){let b=u[g],w=[b,u[g+1],p[g+1],p[g],b];yn(i,w)&&(s=Math.min(s,Ew(i,w)))}}return s!==1/0&&s}function kw(r,e,i,s,a,u,p,g,b,w,A){return r.projection.name==="globe"?(function(k,I,D,B,V,W,H,J,te,ne,_e){let de=[],xe=[],Ce=k.projection.upVectorScale(_e,k.center.lat,k.worldSize).metersToTile,Ae=[0,0,0,1],He=[0,0,0,1],Oe=(Je,it,_t,ct)=>{Je[0]=it,Je[1]=_t,Je[2]=ct,Je[3]=1},Ze=yw();D>0&&(D+=Ze),B+=Ze;for(let Je of I){let it=[],_t=[];for(let ct of Je){let Qe=ct.x+V.x,lt=ct.y+V.y,We=k.projection.projectTilePoint(Qe,lt,_e),Ue=k.projection.upVector(_e,ct.x,ct.y),at=D,mt=B;if(H){let et=Iw(Qe,lt,D,B,H,J,te,ne);at+=et.base,mt+=et.top}D!==0?Oe(Ae,We.x+Ue[0]*Ce*at,We.y+Ue[1]*Ce*at,We.z+Ue[2]*Ce*at):Oe(Ae,We.x,We.y,We.z),Oe(He,We.x+Ue[0]*Ce*mt,We.y+Ue[1]*Ce*mt,We.z+Ue[2]*Ce*mt),Wr(Ae,Ae,W),Wr(He,He,W),it.push(new Sd(Ae[0],Ae[1],Ae[2])),_t.push(new Sd(He[0],He[1],He[2]))}de.push(it),xe.push(_t)}return[de,xe]})(r,e,i,s,a,u,p,g,b,w,A):p?(function(k,I,D,B,V,W,H,J,te){let ne=[],_e=[],de=[0,0,0,1];for(let xe of k){let Ce=[],Ae=[];for(let He of xe){let Oe=He.x+B.x,Ze=He.y+B.y,Je=Iw(Oe,Ze,I,D,W,H,J,te);de[0]=Oe,de[1]=Ze,de[2]=Je.base,de[3]=1,_o(de,de,V),de[3]=Math.max(de[3],1e-5);let it=new Sd(de[0]/de[3],de[1]/de[3],de[2]/de[3]);de[0]=Oe,de[1]=Ze,de[2]=Je.top,de[3]=1,_o(de,de,V),de[3]=Math.max(de[3],1e-5);let _t=new Sd(de[0]/de[3],de[1]/de[3],de[2]/de[3]);Ce.push(it),Ae.push(_t)}ne.push(Ce),_e.push(Ae)}return[ne,_e]})(e,i,s,a,u,p,g,b,w):(function(k,I,D,B,V){let W=[],H=[],J=V[8]*I,te=V[9]*I,ne=V[10]*I,_e=V[11]*I,de=V[8]*D,xe=V[9]*D,Ce=V[10]*D,Ae=V[11]*D;for(let He of k){let Oe=[],Ze=[];for(let Je of He){let it=Je.x+B.x,_t=Je.y+B.y,ct=V[0]*it+V[4]*_t+V[12],Qe=V[1]*it+V[5]*_t+V[13],lt=V[2]*it+V[6]*_t+V[14],We=V[3]*it+V[7]*_t+V[15],Ue=ct+J,at=Qe+te,mt=lt+ne,et=Math.max(We+_e,1e-5),Mt=ct+de,Bt=Qe+xe,Pt=lt+Ce,Ct=Math.max(We+Ae,1e-5);Oe.push(new Sd(Ue/et,at/et,mt/et)),Ze.push(new Sd(Mt/Ct,Bt/Ct,Pt/Ct))}W.push(Oe),H.push(Ze)}return[W,H]})(e,i,s,a,u)}function Iw(r,e,i,s,a,u,p,g){let b=p*a.getElevationAt(r,e,!0,!0),w=u[0]!==0,A=w?u[1]===0?p*(u[0]/aw-lw):p*(function(k,I,D){let B=Math.floor(I[0]/8),V=Math.floor(I[1]/8),W=10*(I[0]-8*B),H=10*(I[1]-8*V),J=k.getElevationAt(B,V,!0,!0),te=k.getMeterToDEM(D),ne=Math.floor(.5*(W*te-1)),_e=Math.floor(.5*(H*te-1)),de=k.tileCoordToPixel(B,V),xe=2*ne+1,Ce=2*_e+1,Ae=(function(_t,ct,Qe,lt,We){return[_t.getElevationAtPixel(ct,Qe,!0),_t.getElevationAtPixel(ct+We,Qe,!0),_t.getElevationAtPixel(ct,Qe+We,!0),_t.getElevationAtPixel(ct+lt,Qe+We,!0)]})(k,de.x-ne,de.y-_e,xe,Ce),He=Math.abs(Ae[0]-Ae[1]),Oe=Math.abs(Ae[2]-Ae[3]),Ze=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),Je=Math.min(.25,.5*te*(He+Oe)/xe),it=Math.min(.25,.5*te*Ze/Ce);return J+Math.max(Je*W,it*H)})(a,u,g):b;return{base:b+(i===0?-1:i),top:w?Math.max(A+s,b+i+2):b+s}}class _R{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yR{constructor(){this.tasks={},this.taskQueue=[],Fe(["process"],this),this.invoker=new _R(this.process),this.nextId=0}add(e,i){let s=this.nextId++,a=(function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-g:u==="maybePrepare"&&p?400-g:500:200-g:100-g})(i);if(a===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((s=>!!this.tasks[s])),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){let u=this.tasks[this.taskQueue[a]];u.priority<i&&(i=u.priority,e=a)}if(e===null)return null;let s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Pw{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Fe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new yR}send(e,i,s,a,u=!1,p){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[g]=s);let b=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!s,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:Zl(i,b)},b),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){let i=e.data;if(!i)return;let s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(i.mustQueue||Hr(self)){let a=this.callbacks[s],u=this.scheduler.add((()=>this.processTask(s,i)),a&&a.metadata||{type:"message"});u&&(this.cancelCallbacks[s]=u)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s($l(i.error)):s(null,$l(i.data)))}else{let s=new Set,a=i.hasCallback?(p,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Zl(p):null,data:Zl(g,s)},s)}:()=>{},u=$l(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,a);else if(this.parent.getWorkerSource){let p=i.type.split("."),{source:g,scope:b}=u;this.parent.getWorkerSource(i.sourceMapId,p[0],g,b)[p[1]](u,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Nf={workerUrl:"",workerClass:null,workerParams:void 0};let Bv="mapboxgl_preloaded_worker_pool";class Td{constructor(){this.active={}}acquire(e,i=Td.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Nf.workerClass!=null?new Nf.workerClass:new self.Worker(Nf.workerUrl,Nf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Bv]}numActive(){return Object.keys(this.active).length}}Td.workerCount=2;class Rh{constructor(e,i,s="Worker",a=Td.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=je();let u=this.workerPool.acquire(this.id,a);for(let p=0;p<u.length;p++){let g=new Rh.Actor(u[p],i,this.id);g.name=`${s} ${p}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,s){we(this.actors,((a,u)=>{a.send(e,i,u)}),s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let jf,Fv;function Ug(){return jf||(jf=new Td),jf}Rh.Actor=Pw;class vR{constructor(e){this.module=e}createIntArray(e){let i=new Int32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,s/i.BYTES_PER_ELEMENT),s}createFloatArray(e){let i=new Float32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,s/i.BYTES_PER_ELEMENT),s}createStringBuffer(e){let i=this.module.malloc(e.length+1);for(let s=0;s<e.length;++s)this.module.heapU8[i+s]=e.charCodeAt(s);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){let i=e.entranceColorRgb,s=e.facadeGlazingColorRgb,a=e.roofColorRgb,u=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],s[0],s[1],s[2],a[0],a[1],a[2],u[0],u[1],u[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(let g of e){let b=this.createStringBuffer(g.roofType),w=[0],A=[];for(let D of g.coordinates)if(Array.isArray(D)){for(let B of D)A.push(B.x),A.push(B.y);w.push(A.length)}let k=this.createIntArray(w),I=this.createFloatArray(A);this.module.addFeature(g.id,g.sourceId,g.minHeight,g.height,b,g.roofType.length,I,k,w.length-1),this.module.free(b),this.module.free(k),this.module.free(I)}for(let g of i){let b;b=g.entrances?JSON.parse(g.entrances):[];let w=this.createFloatArray(b),A=[];for(let I of g.coordinates)A.push(I.x),A.push(I.y);let k=this.createFloatArray(A);this.module.addFacade(g.sourceId,g.crossPerc,g.distanceToRoad,w,b.length,k,A.length),this.module.free(w),this.module.free(k)}if(!this.module.generateMesh()){let g=this.module.getLastError();return this.readStringBuffer(g)}let s=this.module.getMeshCount(),a=new Array(s);for(let g=0;g<s;g++){let b=this.module.getPositionsPtr(g),w=this.module.getPositionsLength(g),A=new Float32Array(this.module.heapF32.buffer,b,w),k=this.module.getNormalsPtr(g),I=this.module.getNormalsLength(g),D=new Float32Array(this.module.heapF32.buffer,k,I),B=this.module.getColorsPtr(g),V=this.module.getColorsLength(g),W=new Uint8Array(this.module.heapU8.buffer,B,V),H=this.module.getAOPtr(g),J=this.module.getAOLength(g),te=new Float32Array(this.module.heapF32.buffer,H,J),ne=this.module.getUVPtr(g),_e=this.module.getUVLength(g),de=new Float32Array(this.module.heapF32.buffer,ne,_e),xe=this.module.getFauxFacadePtr(g),Ce=this.module.getFauxFacadeLength(g),Ae=new Uint8Array(this.module.heapU8.buffer,xe,Ce),He=this.module.getIndicesPtr(g),Oe=this.module.getIndicesLength(g),Ze=new Int32Array(this.module.heap32.buffer,He,Oe),Je=this.module.getBuildingPart(g),it=this.readStringBuffer(Je);a[g]={positions:A,normals:D,colors:W,ao:te,uv:de,isFauxFacade:Ae,indices:Ze,buildingPart:it}}let u=this.module.getRingCount(),p=[];for(let g=0;g<u;g++){let b=this.module.getRingPtr(g),w=this.module.getRingLength(g),A=new Float32Array(this.module.heapF32.buffer,b,w);p.push(A)}return{meshes:a,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let Vf,Nv,gl,Dh,jv,Bh=null,Fh=null,Lw=null,qg=null;function zw(){return Hr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Nv||yr.DRACO_URL}function Mw(){if(Hr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Dh)return Dh;let r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Dh=WebAssembly.validate(r)?yr.MESHOPT_SIMD_URL:yr.MESHOPT_URL,Dh}function xR(){return qg}let Wg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Uf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ow(r,e,i){let s=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:a,byteLength:r.byteLength},i.buffers[a]=r}let Vv="KHR_draco_mesh_compression";function wR(r,e){let i=r.extensions&&r.extensions[Vv];if(!i)return;let s=new gl.Decoder,a=Fw(e,i.bufferView),u=new gl.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[r.indices],g=Wg[p.componentType],b=p.count*g.BYTES_PER_ELEMENT,w=gl._malloc(b);g===Uint16Array?s.GetTrianglesUInt16Array(u,b,w):s.GetTrianglesUInt32Array(u,b,w),Ow(gl.memory.buffer.slice(w,w+b),p,e),gl._free(w);for(let A of Object.keys(i.attributes)){let k=s.GetAttributeByUniqueId(u,i.attributes[A]),I=e.json.accessors[r.attributes[A]],D=bR[I.componentType],B=I.count*Uf[I.type]*Wg[I.componentType].BYTES_PER_ELEMENT,V=gl._malloc(B);s.GetAttributeDataArrayForAllPoints(u,k,gl[D],B,V),Ow(gl.memory.buffer.slice(V,V+B),I,e),gl._free(V)}s.destroy(),u.destroy(),delete r.extensions[Vv]}let Gg="EXT_meshopt_compression";function SR(r,e){if(!r.extensions||!r.extensions[Gg])return;let i=r.extensions[Gg],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);jv.decodeGltfBuffer(a,i.count,i.byteStride,s,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=a.buffer,delete r.extensions[Gg]}let Rw=1179937895,Dw=new TextDecoder("utf8");function Bw(r,e){return new URL(r,e).href}function TR(r,e,i,s){return fetch(Bw(r.uri,s)).then((a=>a.arrayBuffer())).then((a=>{e.buffers[i]=a}))}function Fw(r,e){let i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function CR(r,e,i,s){if(r.uri){let a=Bw(r.uri,s);return fetch(a).then((u=>u.blob())).then((u=>createImageBitmap(u))).then((u=>{e.images[i]=u}))}if(r.bufferView!==void 0){let a=Fw(e,r.bufferView),u=new Blob([a],{type:r.mimeType});return createImageBitmap(u).then((p=>{e.images[i]=p}))}}function Nw(r,e=0,i){let s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===Rw){let A=new Uint32Array(r,e),k=2,I=(A[k++]>>2)-3,D=A[k++]>>2;if(k++,s.json=JSON.parse(Dw.decode(A.subarray(k,k+D))),k+=D,k<I){let B=A[k++];k++;let V=e+(k<<2);s.buffers[0]=r.slice(V,V+B)}}else s.json=JSON.parse(Dw.decode(new Uint8Array(r,e)));let{buffers:a,images:u,meshes:p,extensionsUsed:g,bufferViews:b}=s.json,w=Promise.resolve();if(a){let A=[];for(let k=0;k<a.length;k++){let I=a[k];I.uri?A.push(TR(I,s,k,i)):s.buffers[k]||(s.buffers[k]=null)}w=Promise.all(A)}return w.then((()=>{let A=[],k=g&&g.includes(Vv),I=g&&g.includes(Gg);if(k&&A.push((function(){if(!gl)return Vf??(Vf=(function(D){let B,V=null;function W(){B=new Uint8Array(V.buffer)}function H(){throw new Error("Unexpected Draco error.")}let J={a:{a:H,d:function(te,ne,_e){return B.copyWithin(te,ne,ne+_e)},c:function(te){let ne=B.length,_e=Math.max(te>>>0,Math.ceil(1.2*ne)),de=Math.ceil((_e-ne)/65536);try{return V.grow(de),W(),!0}catch{return!1}},b:H}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,J):D.then((te=>te.arrayBuffer())).then((te=>WebAssembly.instantiate(te,J)))).then((te=>{let{Rb:ne,Qb:_e,P:de,T:xe,X:Ce,Ja:Ae,La:He,Qa:Oe,Va:Ze,Wa:Je,eb:it,jb:_t,f:ct,e:Qe,yb:lt,zb:We,Ab:Ue,Bb:at,Db:mt,Gb:et}=te.instance.exports;V=Qe;let Mt=(()=>{let Bt=0,Pt=0,Ct=0,ui=0;return At=>{Ct&&(ne(ui),ne(Bt),Pt+=Ct,Ct=Bt=0),Bt||(Pt+=128,Bt=_e(Pt));let Ht=At.length+7&-8,di=Bt;Ht>=Pt&&(Ct=Ht,di=ui=_e(Ht));for(let Ti=0;Ti<At.length;Ti++)B[di+Ti]=At[Ti];return di}})();return W(),ct(),{memory:Qe,_free:ne,_malloc:_e,Mesh:class{constructor(){this.ptr=de()}destroy(){xe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ae()}destroy(){_t(this.ptr)}DecodeArrayToMesh(Bt,Pt,Ct){let ui=Mt(Bt),At=He(this.ptr,ui,Pt,Ct.ptr);return!!Ce(At)}GetAttributeByUniqueId(Bt,Pt){return{ptr:Oe(this.ptr,Bt.ptr,Pt)}}GetTrianglesUInt16Array(Bt,Pt,Ct){Ze(this.ptr,Bt.ptr,Pt,Ct)}GetTrianglesUInt32Array(Bt,Pt,Ct){Je(this.ptr,Bt.ptr,Pt,Ct)}GetAttributeDataArrayForAllPoints(Bt,Pt,Ct,ui,At){it(this.ptr,Bt.ptr,Pt.ptr,Ct,ui,At)}},DT_INT8:lt(),DT_UINT8:We(),DT_INT16:Ue(),DT_UINT16:at(),DT_UINT32:mt(),DT_FLOAT32:et()}}))})(fetch(zw())),Vf.then((D=>{gl=D,Vf=void 0})))})()),I&&A.push((function(){if(jv)return;let D=(function(B){let V,W=WebAssembly.instantiateStreaming(B,{}).then((te=>{V=te.instance,V.exports.__wasm_call_ctors()})),H={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(te,ne,_e,de,xe,Ce){(function(Ae,He,Oe,Ze,Je,it,_t){let ct=Ae.exports.sbrk,Qe=Ze+3&-4,lt=ct(Qe*Je),We=ct(it.length),Ue=new Uint8Array(Ae.exports.memory.buffer);Ue.set(it,We);let at=He(lt,Ze,Je,We,it.length);if(at===0&&_t&&_t(lt,Qe,Je),Oe.set(Ue.subarray(lt,lt+Ze*Je)),ct(lt-ct(0)),at!==0)throw new Error(`Malformed buffer data: ${at}`)})(V,V.exports[J[xe]],te,ne,_e,de,V.exports[H[Ce]])}}})(fetch(Mw()));return D.ready.then((()=>{jv=D}))})()),u)for(let D=0;D<u.length;D++)A.push(CR(u[D],s,D,i));return(A.length?Promise.all(A):Promise.resolve()).then((()=>{if(k&&p)for(let{primitives:D}of p)for(let B of D)wR(B,s);if(I&&p&&b)for(let D of b)SR(D,s);return s}))}))}function jw(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>Nw(e,0,r)))}function Uv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function qv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Wv{constructor(e,i,s,a){this.context=e,this.format=s,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:a&&a.premultiply})}update(e,i){let s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:p}=u,{x:g,y:b}=i&&i.position?i.position:{x:0,y:0},w=g+s,A=b+a;!this.size||this.size[0]===w&&this.size[1]===A||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));let k=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&w>0&&A>0){let I=this.useMipmap?Math.floor(Math.log2(Math.max(w,A)))+1:1;p.texStorage2D(p.TEXTURE_2D,I,this.format,w,A),this.size=[w,A]}this.size&&(k?p.texSubImage2D(p.TEXTURE_2D,0,g,b,Uv(this.format),qv(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,g,b,s,a,Uv(this.format),qv(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,s=!1){let{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,a,u){let{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapT=a),u!==this.compareMode&&(u?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.COMPARE_REF_TO_TEXTURE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_FUNC,u)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.NONE),this.compareMode=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class qf{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}let ER=Li([{name:"a_pos_3f",components:3,type:"Float32"}]),AR=Li([{name:"a_color_3f",components:3,type:"Float32"}]),kR=Li([{name:"a_color_4f",components:4,type:"Float32"}]),IR=Li([{name:"a_uv_2f",components:2,type:"Float32"}]),PR=Li([{name:"a_normal_3f",components:3,type:"Float32"}]),LR=Li([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),zR=Li([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Vw(r,e){let i=Hg(r.projection,r.zoom,r.width,r.height),s=(function(u,p,g,b,w){let A=new F(g.lng-180*Pu,g.lat),k=new F(g.lng+180*Pu,g.lat),I=u.project(A.lng,A.lat),D=u.project(k.lng,k.lat),B=-Math.atan2(D.y-I.y,D.x-I.x),V=ze.fromLngLat(g);V.y=X(V.y,-1+Pu,1-Pu);let W=V.toLngLat(),H=u.project(W.lng,W.lat),J=ze.fromLngLat(W);J.x+=Pu;let te=J.toLngLat(),ne=u.project(te.lng,te.lat),_e=qw(ne.x-H.x,ne.y-H.y,B),de=ze.fromLngLat(W);de.y+=Pu;let xe=de.toLngLat(),Ce=u.project(xe.lng,xe.lat),Ae=qw(Ce.x-H.x,Ce.y-H.y,B),He=Math.abs(_e.x)/Math.abs(Ae.y),Oe=Re([]);Cr(Oe,Oe,-B*(1-(w?0:b)));let Ze=Re([]);return St(Ze,Ze,[1,1-(1-He)*b,1]),Ze[4]=-Ae.x/Ae.y*b,Cr(Ze,Ze,B),yt(Ze,Oe,Ze),Ze})(r.projection,0,r.center,i,e),a=Uw(r);return St(s,s,[a,a,1]),s}function Uw(r){let e=r.projection,i=Hg(r.projection,r.zoom,r.width,r.height),s=Gv(e,r.center),a=Gv(e,F.convert(e.center));return Math.pow(2,s*i+(1-i)*a)}function Hg(r,e,i,s,a=1/0){let u=r.range;if(!u)return 0;let p=Math.min(a,Math.max(i,s)),g=Math.log2(p/1024);return le(u[0]+g,u[1]+g,e)}let Pu=1/4e4;function Gv(r,e){let i=X(e.lat,-ae,ae),s=new F(e.lng-180*Pu,i),a=new F(e.lng+180*Pu,i),u=r.project(s.lng,i),p=r.project(a.lng,i),g=ze.fromLngLat(s),b=ze.fromLngLat(a),w=p.x-u.x,A=p.y-u.y,k=b.x-g.x,I=b.y-g.y,D=Math.sqrt((k*k+I*I)/(w*w+A*A));return Math.log2(D)}function qw(r,e,i){let s=Math.cos(i),a=Math.sin(i);return{x:r*s-e*a,y:r*a+e*s}}function Ww(r,e,i){Re(r),Cr(r,r,Bi(e[2])),ai(r,r,Bi(e[0])),pi(r,r,Bi(e[1])),St(r,r,i),yt(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Zg(r,e,i,s,a,u,p,g){let b=[i[0]-e[0],i[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(kr(b)<1e-12||kr(w)<1e-12)return ts(r);let A=Mn([],b,w);Er(A,A),mo(w,s,e),b[2]=(u-a)*g,w[2]=(p-a)*g;let k=b;return Mn(k,b,w),Er(k,k),Xa(r,A,k)}function $g(r,e,i=!1){let s=Au(e.zoom),a=(function(u,p,g){let b=p.worldSize,w=[u[12],u[13],u[14]],A=ie(w[1]/b),k=se(w[0]/b),I=Re([]),D=ee(1,A)*b,B=ee(1,0)*b*pe(A,p.zoom),V=1/xv(b),W=B*V;if(g){let ne=Hg(p.projection,p.zoom,p.width,p.height,1024);W=V*p.projection.pixelSpaceConversion(p.center.lat,b,ne)}let H=E(A,k);oi(H,H,er([],Er([],H),D*W*w[2]));let J=(function(ne){let _e=[ne[0],ne[1],ne[2]],de=[0,1,0],xe=Mn([],de,_e);return Mn(de,_e,xe),Uo(de)===0&&(de=[0,1,0],Mn(xe,_e,de)),Er(xe,xe),Er(de,de),Er(_e,_e),[xe[0],xe[1],xe[2],0,de[0],de[1],de[2],0,_e[0],_e[1],_e[2],0,ne[0],ne[1],ne[2],1]})(H);St(I,I,[W,W,W*D]),qe(I,I,[-w[0],-w[1],-w[2]]);let te=yt([],p.globeMatrix,J);return yt(te,te,I),yt(te,te,u),te})(r,e,i);if(s>0){let u=(function(p,g){let b=g.worldSize,w=ee(1,0)*b*pe(g.center.lat,g.zoom)/xv(b),A=ee(1,g.center.lat)*b,k=Re([]);pi(k,k,Bi(g.center.lng)),ai(k,k,Bi(g.center.lat)),qe(k,k,[0,0,Yo]),St(k,k,[w,w,w*A]);let I=g.point;return qe(k,k,[-I.x,-I.y,0]),yt(k,k,p),yt(k,g.globeMatrix,k)})(r,e);return(function(p,g,b){let w=(B,V,W)=>{let H=kr(B),J=kr(V),te=Dc(B,V,W);return er(te,te,1/kr(te)*$t(H,J,W))},A=w([p[0],p[1],p[2]],[g[0],g[1],g[2]],b),k=w([p[4],p[5],p[6]],[g[4],g[5],g[6]],b),I=w([p[8],p[9],p[10]],[g[8],g[9],g[10]],b),D=Dc([p[12],p[13],p[14]],[g[12],g[13],g[14]],b);return[A[0],A[1],A[2],0,k[0],k[1],k[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],1]})(a,u,s)}return a}function Hv(r,e,i,s){let a=wi.projectAabbCorners(s,i),u=Number.MAX_VALUE;for(let g=0;g<a.length;++g){let b=a[g];b[0]=(.5*b[0]+.5)*e.width,b[1]=(.5-.5*b[1])*e.height,b[2]<u&&(u=b[2])}let p=(function(g){let b=[],w=0;for(let D=1;D<g.length;D++)(g[D][0]<g[w][0]||g[D][0]===g[w][0]&&g[D][1]<g[w][1])&&(w=D);let A,k=w,I=new Uint8Array(g.length);do{if(I[k])break;b.push(new st(g[k][0],g[k][1])),I[k]=1,A=(k+1)%g.length;for(let D=0;D<g.length;D++){if(g[D][0]===g[A][0]&&g[D][1]===g[A][1]||g[D][0]===g[k][0]&&g[D][1]===g[k][1])continue;let B=[g[D][0]-g[k][0],g[D][1]-g[k][1]],V=[g[A][0]-g[k][0],g[A][1]-g[k][1]],W=B[0]*V[1]-B[1]*V[0];(W>0||W===0&&B[0]*V[0]+B[1]*V[1]>=0&&B[0]*B[0]+B[1]*B[1]>V[0]*V[0]+V[1]*V[1])&&(A=D)}k=A}while(k!==w);return b.length>0&&b.push(b[0]),b})(a);if(yn(r,p))return u}let Cd=64,Nh={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Xg(r,e,i,s,a,u,p,g,b,w=!1){let A=i.zoom,k=i.project(s),I=pe(s.lat,A),D=1/I;Re(r),qe(r,r,[k.x+p[0]*D,k.y+p[1]*D,p[2]]);let B=1,V=1,W=i.worldSize;if(w){if(i.projection.name==="mercator"){let ne=0;i.elevation&&(ne=i.elevation.getAtPointOrZero(new ze(k.x/W,k.y/W),0));let _e=_o([],[k.x,k.y,ne,1],i.projMatrix)[3]/i.cameraToCenterDistance;B=_e,V=_e*pe(i.center.lat,A)}else if(i.projection.name==="globe"){let ne=$g(r,i),_e=[0,0,0,1];_o(_e,_e,yt([],i.projMatrix,ne));let de=_e[3]/i.cameraToCenterDistance,xe=Au(A),Ce=i.projection.pixelsPerMeter(s.lat,W)*pe(s.lat,A),Ae=i.projection.pixelsPerMeter(i.center.lat,W)*pe(i.center.lat,A);B=de/$t(Ce,ye(i.center.lat),xe),V=de*I/Ce,B*=Ae,V*=Ae}}else B=D;St(r,r,[B,B,V]);let H=[...r],J=e.orientation,te=[];if(Ww(te,[J[0]+(a?a[0]:0),J[1]+(a?a[1]:0),J[2]+(a?a[2]:0)],u),yt(r,H,te),g&&i.elevation){let ne=0,_e=[];if(b&&i.elevation){ne=(function(xe,Ce,Ae,He,Oe){let Ze=Ce.elevation;if(!Ze)return 0;let Je=wi.projectAabbCorners(Ae,He),it=ee(1,Oe.lat)*Ce.worldSize,_t=(function(Pt,Ct){let ui=[0,0,1],At=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ht of At){let di=Pt[Ht.corners[0]],Ti=Pt[Ht.corners[1]],Xi=Pt[Ht.corners[2]],mi=[Ti[0]-di[0],Ti[1]-di[1],Ct*(Ti[2]-di[2])],rr=Mn(mi,mi,[Xi[0]-di[0],Xi[1]-di[1],Ct*(Xi[2]-di[2])]);Er(rr,rr),Ht.dotProductWithUp=_n(rr,ui)}return At.sort(((Ht,di)=>Ht.dotProductWithUp-di.dotProductWithUp)),At[0].corners})(Je,it),ct=Je[_t[0]],Qe=Je[_t[1]],lt=Je[_t[2]],We=Je[_t[3]],Ue=Ze.getAtPointOrZero(new ze(ct[0]/Ce.worldSize,ct[1]/Ce.worldSize),0),at=Ze.getAtPointOrZero(new ze(Qe[0]/Ce.worldSize,Qe[1]/Ce.worldSize),0),mt=Ze.getAtPointOrZero(new ze(lt[0]/Ce.worldSize,lt[1]/Ce.worldSize),0),et=Ze.getAtPointOrZero(new ze(We[0]/Ce.worldSize,We[1]/Ce.worldSize),0),Mt=(Ue+et)/2,Bt=(at+mt)/2;return Mt>Bt?at<mt?Zg(xe,Qe,We,ct,at,et,Ue,it):Zg(xe,lt,ct,We,mt,Ue,et,it):Ue<et?Zg(xe,ct,Qe,lt,Ue,at,mt,it):Zg(xe,We,lt,Qe,et,mt,at,it),Math.max(Mt,Bt)})(_e,i,e.aabb,r,s);let de=yt([],li([],_e),te);yt(r,H,de)}else ne=i.elevation.getAtPointOrZero(new ze(k.x/W,k.y/W),0);ne!==0&&(r[14]+=ne)}}class Gw{constructor(e,i,s,a,u){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new F(s[0],s[1]):new F(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){yt(e.globalMatrix,i,e.localMatrix);let s=this.nodeOverrides.get(e.name);if(s!==void 0){let p=[];u=s.orientation,Re(a=p),pi(a,a,Bi(u[1])),Cr(a,a,Bi(u[2])),ai(a,a,Bi(u[0])),yt(e.globalMatrix,e.globalMatrix,p)}var a,u;if(e.meshes)for(let p of e.meshes){let g=wi.applyTransformFast(p.aabb,e.globalMatrix);this.aabb.encapsulate(g)}if(e.children)for(let p of e.children)this._applyTransformations(p,e.globalMatrix)}computeBoundsAndApplyParent(){let e=Re([]);this.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,a,u,p,g=!1){Xg(this.matrix,this,e.transform,this.position,i,s,a,u,p,g)}upload(e){if(!this.uploaded){for(let i of this.nodes)Zv(i,e);for(let i of this.nodes)Yg(i);this.uploaded=!0}}destroy(){for(let e of this.nodes)$v(e)}}function Wf(r,e,i=!1){r.uploaded||(r.gfxTexture=new Wv(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function MR(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,ER.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,PR.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,IR.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?AR:kR).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,zR.members,!0)),r.segments=tn.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);let s=r.material;s.pbrMetallicRoughness.baseColorTexture&&Wf(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Wf(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Wf(s.normalTexture,e),s.occlusionTexture&&Wf(s.occlusionTexture,e,i),s.emissionTexture&&Wf(s.emissionTexture,e)}function Zv(r,e,i){if(r.meshes)for(let s of r.meshes)MR(s,e,i);if(r.children)for(let s of r.children)Zv(s,e,i)}function Yg(r){if(r.meshes)for(let e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(let e of r.children)Yg(e)}function $v(r){if(r.meshes)for(let i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(let i of r.children)$v(i)}function Ed(r,e){let i=r.json.bufferViews[e.bufferView],s=Wg[e.componentType];return new s(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Uf[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Uf[e.type]))}function Xv(r,e,i,s){let a=Wg[e.componentType],u=(function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(a),p=r.json.bufferViews[e.bufferView],g=p.byteStride?p.byteStride/a.BYTES_PER_ELEMENT:Uf[e.type],b=i.float32,w=b.length/i.capacity;for(let A=0,k=0;A<e.count*g;A+=g,k+=w)for(let I=0;I<w;I++)b[k+I]=s[A+I]*u;i._trim()}function OR(r,e,i){let s=r.indices,a=r.attributes,u={};u.indexArray=new Yr;let p=e.json.accessors[s],g=p.count/3;u.indexArray.reserve(g);let b=Ed(e,p);for(let I=0;I<g;I++)u.indexArray.emplaceBack(b[3*I],b[3*I+1],b[3*I+2]);u.indexArray._trim(),u.vertexArray=new ks;let w=e.json.accessors[a.POSITION];u.vertexArray.reserve(w.count);let A=Ed(e,w);for(let I=0;I<w.count;I++)u.vertexArray.emplaceBack(A[3*I],A[3*I+1],A[3*I+2]);if(u.vertexArray._trim(),u.aabb=new wi(w.min,w.max),u.centroid=(function(I,D){let B=[0,0,0],V=I.length;if(V>0){for(let W=0;W<V;W++){let H=3*I[W];B[0]+=D[H],B[1]+=D[H+1],B[2]+=D[H+2]}B[0]/=V,B[1]/=V,B[2]/=V}return B})(b,A),a.COLOR_0!==void 0){let I=e.json.accessors[a.COLOR_0],D=Uf[I.type],B=Ed(e,I);u.colorArray=D===3?new ks:new Kl,u.colorArray.resize(I.count),Xv(e,I,u.colorArray,B)}if(a.NORMAL!==void 0){u.normalArray=new ks;let I=e.json.accessors[a.NORMAL];u.normalArray.resize(I.count);let D=Ed(e,I);Xv(e,I,u.normalArray,D)}if(a.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new Jl;let I=e.json.accessors[a.TEXCOORD_0];u.texcoordArray.resize(I.count);let D=Ed(e,I);Xv(e,I,u.texcoordArray,D)}if(a._FEATURE_ID_RGBA4444!==void 0){let I=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Ed(e,I))}a._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Ed(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));let k=r.material;return u.material=(function(I,D){let{emissiveFactor:B=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:W=.5,normalTexture:H,occlusionTexture:J,emissiveTexture:te,doubleSided:ne,name:_e}=I,{baseColorFactor:de=[1,1,1,1],metallicFactor:xe=1,roughnessFactor:Ce=1,baseColorTexture:Ae,metallicRoughnessTexture:He}=I.pbrMetallicRoughness||{},Oe=J?D[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Oe){let Ze=J.extensions.KHR_texture_transform;Oe.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new cr(...de),metallicFactor:xe,roughnessFactor:Ce,baseColorTexture:Ae?D[Ae.index]:void 0,metallicRoughnessTexture:He?D[He.index]:void 0},doubleSided:ne,emissiveFactor:new cr(...B),alphaMode:V,alphaCutoff:W,normalTexture:H?D[H.index]:void 0,occlusionTexture:Oe,emissionTexture:te?D[te.index]:void 0,defined:I.defined===void 0}})(k!==void 0?e.json.materials[k]:{defined:!1},i),u}function Hw(r,e,i){let{matrix:s,rotation:a,translation:u,scale:p,mesh:g,extras:b,children:w,name:A}=r,k={};if(k.name=A,k.localMatrix=s||(function(I,D,B,V){var W=D[0],H=D[1],J=D[2],te=D[3],ne=W+W,_e=H+H,de=J+J,xe=W*ne,Ce=W*_e,Ae=W*de,He=H*_e,Oe=H*de,Ze=J*de,Je=te*ne,it=te*_e,_t=te*de,ct=V[0],Qe=V[1],lt=V[2];return I[0]=(1-(He+Ze))*ct,I[1]=(Ce+_t)*ct,I[2]=(Ae-it)*ct,I[3]=0,I[4]=(Ce-_t)*Qe,I[5]=(1-(xe+Ze))*Qe,I[6]=(Oe+Je)*Qe,I[7]=0,I[8]=(Ae+it)*lt,I[9]=(Oe-Je)*lt,I[10]=(1-(xe+He))*lt,I[11]=0,I[12]=B[0],I[13]=B[1],I[14]=B[2],I[15]=1,I})([],a||[0,0,0,1],u||[0,0,0],p||[1,1,1]),k.globalMatrix=Se(k.localMatrix),g!==void 0){k.meshes=i[g];let I=k.anchor=[0,0];for(let D of k.meshes){let{min:B,max:V}=D.aabb;I[0]+=B[0]+V[0],I[1]+=B[1]+V[1]}I[0]=Math.floor(I[0]/k.meshes.length/2),I[1]=Math.floor(I[1]/k.meshes.length/2)}if(b&&(b.id&&(k.id=b.id),b.lights&&(k.lights=(function(I){if(!I.length)return[];let D=(function(J){let te=atob(J),ne=new Uint8Array(te.length);for(let _e=0;_e<te.length;_e++)ne[_e]=te.codePointAt(_e);return ne})(I),B=[],V=D.length/24,W=new Uint16Array(D.buffer),H=new Float32Array(D.buffer);for(let J=0;J<V;J++){let te=W[2*J*6]/30,ne=W[2*J*6+1]/30,_e=W[2*J*6+10]/100,de=H[6*J+1],xe=H[6*J+2],Ce=H[6*J+3],Ae=H[6*J+4],He=Ce-de,Oe=Ae-xe,Ze=Math.hypot(He,Oe);B.push({pos:[de+.5*He,xe+.5*Oe,ne],normal:[Oe/Ze,-He/Ze,0],width:Ze,height:te,depth:_e,points:[de,xe,Ce,Ae]})}return B})(b.lights)),b.MAPBOX_geometry_bloom&&(k.isGeometryBloom=b.MAPBOX_geometry_bloom)),w){let I=[];for(let D of w)I.push(Hw(e.json.nodes[D],e,i));k.children=I}return k}function RR(r){if(r.vertices.length===0||r.indices.length===0)return null;let e=new Dg(r.vertices,r.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:s}}function DR(r){if(!r.extras||!r.extras.ground)return null;let e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let s=[];for(let p of i){if(!Array.isArray(p)||p.length!==2)continue;let g=p[0],b=p[1];typeof g=="number"&&typeof b=="number"&&s.push(new st(g,b))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let p=0;p<s.length;p++){let g=s[p],b=s[(p+1)%s.length],w=s[(p+2)%s.length];a+=(g.x-b.x)*(w.y-b.y)-(w.x-b.x)*(g.y-b.y)}a>0&&s.reverse();let u=Mh(s.flatMap((p=>[p.x,p.y])),[]);return u.length===0?null:{vertices:s,indices:u}}function BR(r,e){let i=[],s=[],a=0,u=[];for(let p of r){a=i.length;let g=p.vertexArray.float32,b=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)u[0]=g[3*w+0],u[1]=g[3*w+1],u[2]=g[3*w+2],Wr(u,u,e),i.push(new st(u[0],u[1]));for(let w=0;w<3*p.indexArray.length;w++)s.push(b[w]+a)}if(s.length%3!=0)return null;for(let p=0;p<s.length;p+=3){let g=i[s[p+0]],b=i[s[p+1]],w=i[s[p+2]];(g.x-b.x)*(w.y-b.y)-(w.x-b.x)*(g.y-b.y)>0&&([s[p+1],s[p+2]]=[s[p+2],s[p+1]])}return{vertices:i,indices:s}}function Yv(r){let e=(function(b,w){let A=[],k=WebGL2RenderingContext;if(b.json.textures)for(let I of b.json.textures){let D={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};I.sampler!==void 0&&Object.assign(D,b.json.samplers[I.sampler]),A.push({image:w[I.source],sampler:D,uploaded:!1})}return A})(r,r.images),i=(function(b,w){let A=[];for(let k of b.json.meshes){let I=[];for(let D of k.primitives)I.push(OR(D,b,w));A.push(I)}return A})(r,e),{scenes:s,scene:a,nodes:u}=r.json,p=s?s[a||0].nodes:[...u.keys()],g=[];for(let b of p)g.push(Hw(u[b],r,i));return(function(b,w,A){let k={},I=new Set;for(let D=0;D<b.length;D++){let B=A[w[D]];if(!B.extras)continue;let V=B.extras["mapbox:footprint:version"],W=B.extras["mapbox:footprint:id"];(V||W)&&I.add(D),V==="1.0.0"&&W&&(k[W]=D)}for(let D=0;D<b.length;D++){if(I.has(D))continue;let B=b[D],V=A[w[D]];if(!V.extras)continue;let W=null;B.id in k&&(W=BR(b[k[B.id]].meshes,B.localMatrix)),W||(W=DR(V)),W&&(B.footprint=RR(W))}if(I.size>0){let D=Array.from(I.values()).sort(((B,V)=>B-V));for(let B=D.length-1;B>=0;B--)b.splice(D[B],1)}})(g,p,r.json.nodes),g}function FR(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);let e=r.vertexArray.float32,i=r.aabb.min[0]-1,s=r.aabb.min[1]-1,a=Cd/(r.aabb.max[0]-i+2),u=Cd/(r.aabb.max[1]-s+2);for(let p=0;p<e.length;p+=3){let g=e[p+2],b=(e[p+0]-i)*a|0,w=(e[p+1]-s)*u|0;g>r.heightmap[w*Cd+b]&&(r.heightmap[w*Cd+b]=g)}}function Zw(r,e,i,s,a){i.reserve(i.length+4*r.length),s.reserve(s.length+10*r.length),a.reserve(a.length+10*r.length);let u=s.length;for(let p of r){let g=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),A=p.width-2*p.depth*e*(w+.01),k=nn([],p.pos,b,A/2),I=nn([],p.pos,b,-A/2),D=[k[0],k[1],k[2]+p.height],B=[I[0],I[1],I[2]+p.height],V=nn([],p.normal,b,w);er(V,V,g);let W=nn([],p.normal,b,-w);er(W,W,g),oi(V,k,V),oi(W,I,W),k[2]+=.1,I[2]+=.1,s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(W[0],W[1],W[2]),s.emplaceBack(k[0],k[1],k[2]),s.emplaceBack(I[0],I[1],I[2]),s.emplaceBack(D[0],D[1],D[2]),s.emplaceBack(B[0],B[1],B[2]),s.emplaceBack(k[0],k[1],k[2]),s.emplaceBack(I[0],I[1],I[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(W[0],W[1],W[2]);let H=A/g/2;a.emplaceBack(-H-w,-1,H,.8),a.emplaceBack(H+w,-1,H,.8),a.emplaceBack(-H,0,H,1.3),a.emplaceBack(H,0,H,1.3),a.emplaceBack(H+w,-.8,H,.7),a.emplaceBack(H+w,-.8,H,.7),a.emplaceBack(0,0,H,1.3),a.emplaceBack(0,0,H,1.3),a.emplaceBack(H+w,-1.2,H,.8),a.emplaceBack(H+w,-1.2,H,.8),i.emplaceBack(6+u,4+u,8+u),i.emplaceBack(7+u,9+u,5+u),i.emplaceBack(0+u,1+u,2+u),i.emplaceBack(1+u,3+u,2+u),u+=10}}function NR(r,e){let i={};i.indexArray=new Yr,i.vertexArray=new ks,i.colorArray=new Kl,Zw(r,e,i.indexArray,i.vertexArray,i.colorArray);let s={defined:!0};s.emissiveFactor=cr.black;let a={};return a.baseColorFactor=cr.white,s.pbrMetallicRoughness=a,i.material=s,i.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}let $w=Li([{name:"a_pos_3f",components:3,type:"Float32"}]),jR=Li([{name:"a_normal_3",components:3,type:"Int16"}]),VR=Li([{name:"a_centroid_3",components:3,type:"Int16"}]),Xw=Li([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),UR=Li([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),qR=Li([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),WR=Li([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),GR=Li([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),HR=Li([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Yw=nt.types,Kg=32767;function ZR(r,e){let i=ht+e;for(let s of r)for(let a of s)if(a.x<-e||a.x>i||a.y<-e||a.y>i)return!1;return!0}class Kw{constructor(){this.layoutVertexArray=new ks,this.layoutAttenuationArray=new Kl,this.layoutColorArray=new Js,this.indexArray=new Yr,this.indexArrayForConflation=new Yr,this.segmentsBucket=new tn}}class Kv{constructor(){this.layoutVertexArray=new ks,this.layoutNormalArray=new zc,this.layoutCentroidArray=new zc,this.layoutColorArray=new Js,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Sh,this.layoutAOArray=new hl,this.indexArray=new Yr,this.indexArrayForConflation=new Yr,this.segmentsBucket=new tn,this.entranceBloom=new Kw}}class Jw{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new Kv,this.buildingWithFacade=new Kv,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Js,this.buildingWithFacade.layoutFacadeDataArray=new Mc,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Js,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new Rv(e),this.groundEffect.groundRadiusArray=new hl,this.hasAppearances=null}updateFootprints(e,i){for(let s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}prepare(){return(function(){if(qg!=null||Lw!=null)return null;if(Fh!=null)return Fh;let e=fetch(yr.BUILDING_GEN_URL);return Fh=(function(i){let s,a,u,p;function g(){s=new Uint8Array(p.buffer),a=new Int32Array(p.buffer),u=new Float32Array(p.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}let w=()=>{},A={a:{a:b,f:function(k){let I=s.length,D=Math.max(k>>>0,Math.ceil(1.2*I)),B=Math.ceil((D-I)/65536);try{return p.grow(B),g(),!0}catch{return!1}},g:b,b:w,c:w,d:w,e:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,A):i.then((k=>k.arrayBuffer())).then((k=>WebAssembly.instantiate(k,A)))).then((k=>{let I=k.instance.exports;return(0,I.g)(),p=I.f,g(),new vR({setStyle:I.h,setAOOptions:I.i,setMetricOptions:I.j,setStructuralOptions:I.k,setFacadeOptions:I.l,setFauxFacadeOptions:I.m,setFacadeClassifierOptions:I.n,addFeature:I.o,addFacade:I.p,generateMesh:I.q,getLastError:I.r,getOuterRingLength:I.s,getMeshCount:I.t,getPositionsPtr:I.u,getPositionsLength:I.v,getNormalsPtr:I.w,getNormalsLength:I.x,getColorsPtr:I.y,getColorsLength:I.z,getAOPtr:I.A,getAOLength:I.B,getUVPtr:I.C,getUVLength:I.D,getFauxFacadePtr:I.E,getFauxFacadeLength:I.F,getIndicesPtr:I.G,getIndicesLength:I.H,getBuildingPart:I.I,getRingCount:I.J,getRingPtr:I.K,getRingLength:I.L,free:I.M,malloc:I.N,heapU8:s,heap32:a,heapF32:u})}))})(e).then((i=>(Fh=null,qg=i,qg))).catch((i=>{Zt("Could not load building-gen"),Fh=null,Lw=i})),Fh})()}populate(e,i,s,a){let u=xR();if(!u)return;let p=ve(s);this.tileToMeter=p,this.brightness=i.brightness,u.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),u.setAOOptions(!1,.3),u.setMetricOptions(!1,16),u.setStructuralOptions(!0),u.setFacadeClassifierOptions(3);let g=new Map,b=new Map;for(let{feature:w}of e){if(Yw[w.type]!=="LineString"){g.set(w.id,w.properties.source_id);continue}let A=this.layers[0]._featureFilter.needGeometry,k=Ne(w,A);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),k,s))continue;let I=A?k.geometry:Ke(w,s,a),D=[];for(let H of I)for(let J of H)D.push({x:J.x,y:J.y});let B={coordinates:D,crossPerc:w.properties.cross_perc,distanceToRoad:w.properties.distance_to_road,entrances:w.properties.entrances,sourceId:0},V=w.properties.source_id,W=b.get(V);W||(W=[],b.set(V,W)),W.push(B)}this.maxHeight=0;for(let{feature:w,id:A,index:k,sourceLayerIndex:I}of e){if(Yw[w.type]==="LineString")continue;let D=this.layers[0]._featureFilter.needGeometry,B=Ne(w,D);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),B,s))continue;let V=D?B.geometry:Ke(w,s,a),W=Mf(V,500);if(!ZR(V,163))continue;let H=this.layers[0],J=H.layout.get("building-roof-shape").evaluate(w,{},s);if(J==="flat")continue;let te=H.layout.get("building-base").evaluate(w,{},s),ne=H.layout.get("building-height").evaluate(w,{},s),_e=H.layout.get("building-flood-light-ground-radius").evaluate(w,{},s),de=H.paint.get("building-ambient-occlusion-intensity"),xe=_e/this.tileToMeter,Ce=H.layout.get("building-flood-light-wall-radius").evaluate(w,{},s);Ce=X(Ce,0,2048);let Ae=Ce/2048*Kg,He=g.get(A),Oe;Oe=b.has(He)?b.get(He):[];let Ze=Oe.length!==0&&H.layout.get("building-facade").evaluate(w,{},s);u.setFacadeOptions(4,!0),u.setFauxFacadeOptions(Ze,!1,1);let Je=0,it=0,_t=0,ct=0,Qe=0,lt=0;if(Ze){let Xe=Math.round(H.layout.get("building-facade-floors").evaluate(w,{},s));if(te===0){Xe=Math.max(1,Xe-(Oe.length>0?1:0));let qt=4;if(ne>100){let Vt=[10,13,15];qt=Vt[w.id?w.id%Vt.length:0],u.setFacadeOptions(qt,!0)}Qe=1.6803*qt/p}else Qe=te/p;lt=ne/p,Qe=Math.min(Qe,lt),_t=H.layout.get("building-facade-unit-width").evaluate(w,{},s)/p,ct=(lt-Qe)/Xe,u.setFauxFacadeOptions(!0,!0,_t);let Et=H.layout.get("building-facade-window").evaluate(w,{},s);Je=Et[0],it=Et[1]}let We=[],Ue=new st(1/0,1/0),at=new st(-1/0,-1/0),mt=new st(0,0),et=0;for(let Xe of W)if(Xe.length>0){let Et=[];for(let qt of Xe){let Vt=[];for(let gi=qt.length-1;gi>=0;gi--){let Qt=qt[gi];Vt.push({x:Qt.x,y:Qt.y}),Ue.x=Math.min(Ue.x,Qt.x),Ue.y=Math.min(Ue.y,Qt.y),at.x=Math.max(at.x,Qt.x),at.y=Math.max(at.y,Qt.y),mt.x+=Qt.x,mt.y+=Qt.y,et++}Et.push(Vt)}We.push({id:w.id?w.id:0,height:ne,minHeight:te,sourceId:0,roofType:J,coordinates:Et})}mt.x/=et||1,mt.y/=et||1;let Mt=u.generateMesh(We,Oe);if(typeof Mt=="string"){Zt(`Unable to generate building ${w.id}: ${Mt}`);continue}if(Mt.meshes.length===0||Mt.modifiedPolygonRings.length===0)continue;let Bt=0;for(let Xe of Mt.meshes)Bt+=Xe.positions.length/3;let Pt=Ze?this.buildingWithFacade:this.buildingWithoutFacade,Ct=Pt.segmentsBucket.prepareSegment(Bt,Pt.layoutVertexArray,Pt.indexArray),ui=[],At=null,Ht=0,di=-1,Ti=Pt.layoutVertexArray.length,Xi=Pt.indexArray.length,mi=0;for(let Xe of Mt.meshes){let Et=Pt.layoutVertexArray.length;if(Xe.buildingPart==="entrance"){let Nt=new Array;for(let Wi=0;Wi<Xe.positions.length;Wi+=12){let Sr=Xe.positions[Wi+0],fr=Xe.positions[Wi+1],cn=Xe.positions[Wi+3],Vr=Xe.positions[Wi+4],Mr=Xe.positions[Wi+2],_r=Xe.positions[Wi+8]-Mr,or=1,_i=cn-Sr,sr=Vr-fr,Or=Math.hypot(_i,sr);Nt.push({pos:[Sr+.5*_i,fr+.5*sr,Mr],normal:[sr/Or,-_i/Or,0],width:Or,height:_r,depth:or,points:[Sr,fr,cn,Vr]})}let Qi=Pt.entranceBloom.segmentsBucket.prepareSegment(10*Nt.length,Pt.entranceBloom.layoutVertexArray,Pt.entranceBloom.indexArray),wr=Pt.entranceBloom.layoutVertexArray.length;Ht=Pt.entranceBloom.indexArray.length,Zw(Nt,.5/this.tileToMeter,Pt.entranceBloom.indexArray,Pt.entranceBloom.layoutVertexArray,Pt.entranceBloom.layoutAttenuationArray);let ri=Pt.entranceBloom.layoutVertexArray.length-wr;di=Pt.entranceBloom.indexArray.length-Ht;for(let Wi=0;Wi<ri;Wi++)Pt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Qi.vertexLength+=ri,Qi.primitiveLength+=di,At={part:Xe.buildingPart,vertexOffset:wr,vertexLength:ri}}for(let Nt=0;Nt<Xe.positions.length;Nt+=3)mi=Math.max(mi,Xe.positions[Nt+2]),Pt.layoutVertexArray.emplaceBack(Xe.positions[Nt],Xe.positions[Nt+1],Xe.positions[Nt+2]);let qt=Math.floor(mt.x),Vt=Math.floor(mt.y),gi=Math.floor(mi);for(let Nt=0;Nt<Xe.positions.length;Nt+=3)Pt.layoutCentroidArray.emplaceBack(qt,Vt,gi),Pt.layoutFloodLightDataArray.emplaceBack(Xe.buildingPart==="wall"?Ae:0);for(let Nt=0;Nt<Xe.normals.length;Nt+=3)Pt.layoutNormalArray.emplaceBack(Xe.normals[Nt+0]*Kg,Xe.normals[Nt+1]*Kg,Xe.normals[Nt+2]*Kg);for(let Nt=0;Nt<Xe.ao.length;Nt++)Pt.layoutAOArray.emplaceBack(Xe.ao[Nt]);for(let Nt=0;Nt<Xe.colors.length;Nt+=3){let Qi=1+(Xe.ao[Nt/3]-1)*de;Pt.layoutColorArray.emplaceBack(Xe.colors[Nt]*Qi<<8|Xe.colors[Nt+1]*Qi,Xe.colors[Nt+2]*Qi<<8)}if(Ze){for(let Nt=0;Nt<Xe.positions.length;Nt+=3)Pt.layoutFacadePaintArray.emplaceBack(65535,255);for(let Nt=0;Nt<Xe.isFauxFacade.length;Nt++)if(Xe.isFauxFacade[Nt]){let Qi=1|Math.min(65535,Math.floor(Xe.uv[2*Nt]*Mt.outerRingLength)),wr=Math.floor(255*Je)<<8|Math.floor(255*it),ri=Math.floor(65535*Math.min(1,_t/ht)),Wi=Math.floor(65535*Math.min(1,ct/ht));Pt.layoutFacadeDataArray.emplaceBack(Qi,wr,ri,Wi);let Sr=Math.floor(65535*Math.min(1,Qe/ht)),fr=Math.floor(65535*Math.min(1,lt/ht));Pt.layoutFacadeVerticalRangeArray.emplaceBack(Sr,fr)}else Pt.layoutFacadeDataArray.emplaceBack(0,0,0,0),Pt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}let Qt=Ct.vertexLength;for(let Nt=0;Nt<Xe.indices.length;Nt+=3)Pt.indexArray.emplaceBack(Qt+Xe.indices[Nt],Qt+Xe.indices[Nt+1],Qt+Xe.indices[Nt+2]);Ct.vertexLength+=Xe.positions.length/3,Ct.primitiveLength+=Xe.indices.length/3,(Xe.buildingPart==="roof"||Xe.buildingPart==="wall"||Xe.buildingPart==="facade_glazing"||Xe.buildingPart==="entrance")&&ui.push({part:Xe.buildingPart,vertexOffset:Et,vertexLength:Xe.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,mi),this.buildingFeatures.push({promoteId:A,feature:B,hasFauxFacade:Ze,segment:Ct,parts:ui,buildingBloom:At});let rr=Pt.indexArray.length-Xi,nr=[],en=[],he=new st(1/0,1/0),ce=new st(-1/0,-1/0),$e=this.groundEffect.vertexArray.length;for(let Xe of Mt.modifiedPolygonRings){let Et=[],qt=new st(1/0,1/0),Vt=new st(-1/0,-1/0);for(let gi=0;gi<Xe.length;gi+=2){let Qt=Xe.length-gi-2;qt.x=Math.min(qt.x,Xe[Qt]),qt.y=Math.min(qt.y,Xe[Qt+1]),Vt.x=Math.max(Vt.x,Xe[Qt]),Vt.y=Math.max(Vt.y,Xe[Qt+1]);let Nt=new st(Xe[Qt],Xe[Qt+1]);Et.push(Nt),nr.push(Nt.x,Nt.y),en.push(Nt.clone())}he.x=Math.min(he.x,qt.x),he.y=Math.min(he.y,qt.y),ce.x=Math.max(ce.x,Vt.x),ce.y=Math.max(ce.y,Vt.y),this.groundEffect.addData(Et,[qt,Vt],xe)}let Tt=this.groundEffect.vertexArray.length-$e;for(let Xe=0;Xe<Tt;Xe++)this.groundEffect.groundRadiusArray.emplaceBack(_e);(Ue.x<0||at.x>ht||Ue.y<0||at.y>ht)&&this.featuresOnBorder.push({featureId:w.id,footprintIndex:this.footprints.length});{let Xe=Mh(nr,null,2),Et=new Dg(en,Xe,8,256),qt=w.id;w.properties&&w.properties.hasOwnProperty("building_id")&&(qt=w.properties.building_id);let Vt={vertices:en,indices:Xe,grid:Et,min:he,max:ce,buildingId:qt,hiddenFlags:0,indicesOffset:Xi,indicesLength:rr,bloomIndicesOffset:Ht,bloomIndicesLength:di,groundEffectVertexOffset:$e,groundEffectVertexLength:Tt,hasFauxFacade:Ze,segment:Ct,height:mi};w.id!==void 0&&this.featureFootprintLookup.set(w.id,this.footprints.length),this.footprints.push(Vt)}this.programConfigurations.populatePaintArrays(Pt.layoutVertexArray.length,w,k,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData(w,k,{},i.availableImages,s,i.brightness),i.featureIndex.insert(w,V,k,I,this.index,Ti)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,s,a,u,p,g){this.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g),this.groundEffect.update(e,i,u,s,a,p,g),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){let i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,$w.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,jR.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,VR.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,HR.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,qR.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,WR.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,$w.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,GR.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){let e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let a=!1,u=s?i:0,p=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let g of e){let b=this.footprints[g],w=b.hiddenFlags&p|u;b.hiddenFlags!==w&&(b.hiddenFlags=w,a=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return a&&(this.indexArrayForConflationUploaded=!1),a}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;let i=a=>{a.indexArray.length!==0&&(a.indexArrayForConflation.resize(a.indexArray.length),a.indexArrayForConflation.uint16.set(a.indexArray.uint16),a.entranceBloom.indexArrayForConflation.resize(a.entranceBloom.indexArray.length),a.entranceBloom.indexArrayForConflation.uint16.set(a.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(let a of this.footprints){let u=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let b=a.indicesOffset;b<p;b++)u.indexArrayForConflation.uint16[3*b+0]=0,u.indexArrayForConflation.uint16[3*b+1]=0,u.indexArrayForConflation.uint16[3*b+2]=0;let g=a.bloomIndicesOffset+a.bloomIndicesLength;for(let b=a.bloomIndicesOffset;b<g;b++)u.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,u.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,u.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}let s=a=>{a.indexArray.length!==0&&(a.indexBuffer?a.indexBuffer.updateData(a.indexArrayForConflation):a.indexBuffer=e.createIndexBuffer(a.indexArrayForConflation,!0),a.entranceBloom.indexBuffer?a.entranceBloom.indexBuffer.updateData(a.entranceBloom.indexArrayForConflation):a.entranceBloom.indexBuffer=e.createIndexBuffer(a.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){let i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,Xw.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,UR.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,Xw.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){let s=e.paint.get("building-ambient-occlusion-intensity");for(let a of this.buildingFeatures){let u=i[a.promoteId],p=a.feature;p.properties["building-part"]="roof";let g=e.paint.get("building-color").evaluate(p,u,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(p,u,this.canonical);p.properties["building-part"]="wall";let w=e.paint.get("building-color").evaluate(p,u,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(p,u,this.canonical);p.properties["building-part"]="window";let k=e.paint.get("building-color").evaluate(p,u,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(p,u,this.canonical);p.properties["building-part"]="door";let D=e.paint.get("building-color").evaluate(p,u,this.canonical).toPremultipliedRenderColor(this.lut),B=e.paint.get("building-emissive-strength").evaluate(p,u,this.canonical),V=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(let H of a.parts){let J,te=g;H.part==="roof"?(te=g,J=b):H.part==="wall"?(te=w,J=A):H.part==="facade_glazing"?(te=k,J=I):H.part==="entrance"&&(te=D,J=B),J=X(J,0,1);for(let ne=0;ne<H.vertexLength;ne++){let _e=H.vertexOffset+ne,de=1+(V.layoutAOArray.float32[_e]-1)*s;V.layoutColorArray.emplace(_e,te.r*de*255<<8|te.g*de*255,te.b*de*255<<8|255*J),a.hasFauxFacade&&V.layoutFacadePaintArray.emplace(_e,255*k.r<<8|255*k.g,255*k.b<<8|255*I)}}let W=a.buildingBloom;if(W)for(let H=0;H<W.vertexLength;H++)V.entranceBloom.layoutColorArray.emplace(W.vertexOffset+H,255*D.r<<8|255*D.g,255*D.b<<8|51*B)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let a=i.getReplacementRegionsForTile(e.toUnwrapped());if(Fg(this.activeReplacements,a))return;this.activeReplacements=a;for(let p of this.footprints)p.hiddenFlags&=-2;let u=[];for(let p of this.activeReplacements){if(p.order<=Q1)continue;let g=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(let b of this.footprints)b.min.x>p.max.x||b.max.x<p.min.x||b.min.y>p.max.y||b.max.y<p.min.y||(u.length=0,$R(b.vertices,0,b.vertices.length,p.footprintTileId.canonical,e.canonical,u),Lv(p.footprint,u,b.indices,0,b.indices.length,0,-g)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){let i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0,u=4*(e+ht)*ht+(i+ht);if(this.footprintLookup.hasOwnProperty(u)){let g=this.footprintLookup[u];return g?{height:g.height,hidden:g.hiddenFlags!==0}:void 0}let p=new st(e,i);for(let g of this.footprints)e>g.max.x||g.min.x>e||i>g.max.y||g.min.y>i||g.height<=s||zv(p,g)&&(s=g.height,this.footprintLookup[u]=g,a=g.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.footprintLookup[u]=void 0}}function $R(r,e,i,s,a,u){let p=Math.pow(2,s.z-a.z);for(let g=0;g<i;g++){let b=r[g+e].x,w=r[g+e].y;b=(b+a.x*ht)*p-s.x*ht,w=(w+a.y*ht)*p-s.y*ht,u.push(new st(b,w))}}let Qw,eS;Ot(Jw,"BuildingBucket",{omit:["layers"]}),Ot(Kv,"BuildingGeometry"),Ot(Kw,"BuildingBloomGeometry");let XR=Li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),YR=Li([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:KR}=XR,JR=Li([{name:"a_packed",components:3,type:"Float32"}]),{members:QR}=JR,eD=Li([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:tD}=eD;class tS{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ku({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let s=this.getKey(e,i);return this.positions[s]}trim(){let e=this.width,i=this.height=Pe(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){let a=[],u=e.length%2==1?-e[e.length-1]*s:0,p=e[0]*s,g=!0;a.push({left:u,right:p,isDash:g,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){g=!g;let A=e[w];u=b*s,b+=A,p=b*s,a.push({left:u,right:p,isDash:g,zeroLength:A===0})}return a}addRoundDash(e,i,s){let a=i/2;for(let u=-s;u<=s;u++){let p=this.width*(this.nextRow+s+u),g=0,b=e[g];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++g]);let A=Math.abs(w-b.left),k=Math.abs(w-b.right),I=Math.min(A,k),D,B=u/s*(a+1);if(b.isDash){let V=a-Math.abs(B);D=Math.sqrt(I*I+V*V)}else D=a-Math.sqrt(I*I+B*B);this.image.data[p+w]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){let w=e[b],A=e[b+1];w.zeroLength?e.splice(b,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(b,1))}let s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);let u=this.width*this.nextRow,p=0,g=e[p];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++p]);let w=Math.abs(b-g.left),A=Math.abs(b-g.right),k=Math.min(w,A);this.image.data[u+b]=Math.max(0,Math.min(255,(g.isDash?k:-k)+i+128))}}addDash(e,i){let s=this.getKey(e,i);if(this.positions[s])return this.positions[s];let a=i==="round",u=a?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Zt("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let A=0;A<e.length;A++)e[A]<0&&(Zt("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),g+=e[A];if(g!==0){let A=this.width/g,k=this.getDashRanges(e,this.width,A);a?this.addRoundDash(k,A,u):this.addRegularDash(k,i==="square"?.5*A:0)}let b=this.nextRow+u;this.nextRow+=p;let w={tl:[b,u],br:[g,0]};return this.positions[s]=w,w}}Ot(tS,"LineAtlas");let iD=nt.types,rD=Math.cos(Math.PI/180*37.5),nD=Math.cos(Math.PI/180*5);class Jv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new vh,this.layoutVertexArray2=new ks,this.patternVertexArray=new ks,this.indexArray=new Yr,this.programConfigurations=new ya(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new tn,this.maxLineLength=0,this.zOffsetVertexArray=new ks,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:ht/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=Cv("line",this.layers,this.pixelRatio,i);let u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ve(s);let p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{let I=this.layers[0].layout.get("line-z-offset"),D=I.isConstant()&&!I.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&p==="none"&&Zt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;let b=[];for(let{feature:I,id:D,index:B,sourceLayerIndex:V}of e){let W=this.layers[0]._featureFilter.needGeometry,H=Ne(I,W);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),H,s))continue;let J=u?u.evaluate(H,{},s):void 0,te={id:D,properties:I.properties,type:I.type,sourceLayerIndex:V,index:B,geometry:W?H.geometry:Ke(I,s,a),patterns:{},sortKey:J};b.push(te)}u&&b.sort(((I,D)=>I.sortKey-D.sortKey));let{lineAtlas:w,featureIndex:A}=i,k=this.addConstantDashes(w);for(let I of b){let{geometry:D,index:B,sourceLayerIndex:V}=I;if(k&&this.addFeatureDashes(I,w),this.hasPattern){let W=Ev("line",this.layers,I,this.zoom,this.pixelRatio,i);this.patternFeatures.push(W)}else this.addFeature(I,D,B,s,w.positions,i.availableImages,i.brightness,i.elevationFeatures);A.insert(e[B].feature,D,B,V,this.index)}}addConstantDashes(e){let i=!1;for(let s of this.layers){let a=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")i=!0;else{let p=u.value,g=a.value;if(!g)continue;e.addDash(g,p)}}return i}addFeatureDashes(e,i){let s=this.zoom;for(let a of this.layers){let u=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let g,b;if(u.kind==="constant"){if(g=u.value,!g)continue}else g=u.evaluate({zoom:s},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:s},e),i.addDash(g,b),e.patterns[a.id]=[i.getKey(g,b)]}}update(e,i,s,a,u,p,g,b){this.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,b)}addFeatures(e,i,s,a,u,p){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,a,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,QR)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,tD)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,YR.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,a;if(i&&i>0?(s=`mapbox_clip_start_${i}`,a=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",a="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(a))return{start:+e.properties[s],end:+e.properties[a]}}addFeature(e,i,s,a,u,p,g,b){let w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),k=w.get("line-cap").evaluate(e,{}),I=w.get("line-miter-limit"),D=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;let B=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=w.get("line-z-offset").value;let V=this.layers[0].paint.get("line-width").value;if(V.kind!=="constant"&&V.isLineProgressConstant===!1&&(this.variableWidthValue=V),this.elevationType==="road"){let W=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,a,b,A,k,I,D)){let[H,J]=this.clipRuntimeLinesToTile(i,1);for(let te=0;te<H.length;te++){let ne=H[te],_e=J[te],de={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,ne),prevDir:this.computeSegPrevDir(_e,ne)};this.addLine(ne,e,a,A,k,I,D,de,B&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(W)}}else for(let W=0;W<i.length;W++)this.addLine(i[W],e,a,A,k,I,D,void 0,B&&W>0?W:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,p,a,g,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Vg(e,-i,-i,ht+i,ht+i)}clipRuntimeLinesToTile(e,i){let s=[];return[Vg(e,-i,-i,ht+i,ht+i,s),s]}addElevatedRoadFeature(e,i,s,a,u,p,g,b){let w=[],A=ci.getElevationFeature(e,a);if(A){let k=this.clipLinesToTile(i,1),I=this.prepareElevatedLines(k,A,s);for(let D of I)w.push({geometry:D,elevation:A,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(w.length===0)return!1;for(let k of w){let I=this.layoutVertexArray.length;this.addLine(k.geometry,e,s,u,p,g,b);let D=new $i(s,k.elevationTileID);if(k.elevation)for(let B=I;B<this.layoutVertexArray.length;B++){let V=new st(this.layoutVertexArray.int16[6*B]>>1,this.layoutVertexArray.int16[6*B+1]>>1),W=D.pointElevation(V,k.elevation,.05);this.updateHeightRange(W),this.zOffsetVertexArray.emplaceBack(W,0,0)}else this.fillNonElevatedRoadSegment(I)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;let a=[],u=1/ve(s);for(let p of e)gR(p,new Fr(i,u),0,a);return a}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,a,u,p,g,b,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=w?this.lineFeatureClips(i,w):this.lineClips;let A=a==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let k=b&&b.progress.min>0,I=b&&b.progress.max<1;if(this.lineClips){let Ae={min:this.lineClips.start,max:this.lineClips.end},He=1;if(b){let Je=this.lineClips.end-this.lineClips.start;Ae=(function(it,_t,ct){return{min:tr(it.min,_t,ct),max:tr(it.max,_t,ct)}})(b.progress,{min:0,max:1},Ae),Je>0&&(He=(Ae.max-Ae.min)/Je)}let Oe=+i.properties.mapbox_clip_feature_len,Ze=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Oe)||Number.isNaN(Ze)){for(let it=0;it<e.length-1;it++)this.totalDistance+=e[it].dist(e[it+1]);let Je=this.totalDistance/(Ae.max-Ae.min);this.totalFeatureLength=Number.isFinite(Je)?Je:0,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Oe,this.distance=Ze*He,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let D=iD[i.type]==="Polygon",B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let V=0;for(;V<B-1&&e[V].equals(e[V+1]);)V++;if(B<(D?3:2))return;a==="bevel"&&(p=1.05);let W=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),H,J,te,ne,_e,de,xe,Ce;b&&b.prevDir&&(de=b.prevDir.perp()),b&&b.nextDir&&(xe=b.nextDir.perp()),this.e1=this.e2=-1,D&&(H=e[B-2],_e=e[V].sub(H)._unit()._perp());for(let Ae=V;Ae<B;Ae++){if(te=Ae===B-1?D?e[V+1]:void 0:e[Ae+1],te&&e[Ae].equals(te))continue;_e&&(ne=_e),H&&(J=H),H=e[Ae],Ce=this.evaluateLineProgressFeatures(J?J.dist(H):0),_e=te?te.sub(H)._unit()._perp():ne,ne=ne||_e;let He=J&&te,Oe=He?a:D||A?"butt":u,Ze=ne.x*_e.x+ne.y*_e.y;if(A){let Ue=function(at){if(at.patternJoinNone){let mt=at.segmentPoints.length/2,et=at.lineSoFar-at.segmentStart;for(let Mt=0;Mt<mt;++Mt){let Bt=at.segmentPoints[2*Mt+1],Pt=Math.round(at.segmentPoints[2*Mt])+.5+.25*Bt;at.patternVertexArray.emplaceBack(Pt,et,at.segmentStart),at.patternVertexArray.emplaceBack(Pt,et,at.segmentStart)}at.segmentPoints.length=0}at.e1=at.e2=-1};if(He&&Ze<nD){this.updateDistance(J,H),this.addCurrentVertex(H,ne,1,1,W,Ce),Ue(this),this.addCurrentVertex(H,_e,-1,-1,W,Ce);continue}if(J){if(!te){this.updateDistance(J,H),this.addCurrentVertex(H,ne,1,1,W,Ce),Ue(this);continue}Oe="miter"}}let Je=ne.add(_e);Je.x===0&&Je.y===0||Je._unit();let it=Je.x*_e.x+Je.y*_e.y,_t=it!==0?1/it:1/0,ct=2*Math.sqrt(2-2*it),Qe=it<rD&&J&&te,lt=ne.x*_e.y-ne.y*_e.x>0,We=this.overscaling<=16?15*ht/(512*this.overscaling):0;if(He&&Oe==="round"){if(_t<g)Oe="miter";else if(_t<=2){let Ue=Qv(H,-10,ht+10);Oe=this.elevationType==="offset"&&(Ue||this.hasCrossSlope)?"miter":"fakeround"}}if(Oe==="miter"&&_t>p&&(Oe="bevel"),Oe==="bevel"&&(_t>2&&(Oe="flipbevel"),_t<p&&(Oe="miter")),J&&!(Oe==="miter"&&Qe)&&this.updateDistance(J,H),Oe==="miter")if(Qe){let Ue=H.dist(J);if(Ue>2*We){let mt=H.sub(H.sub(J)._mult(We/Ue)._round());this.updateDistance(J,mt),this.addCurrentVertex(mt,ne,0,0,W,Ce),J=mt}this.updateDistance(J,H),Je._mult(_t),this.addCurrentVertex(H,Je,0,0,W,Ce);let at=H.dist(te);if(at>2*We){let mt=H.add(te.sub(H)._mult(We/at)._round());this.updateDistance(H,mt),this.addCurrentVertex(mt,_e,0,0,W,Ce),H=mt}}else Je._mult(_t),this.addCurrentVertex(H,Je,0,0,W,Ce);else if(Oe==="flipbevel"){if(_t>100)Je=_e.mult(-1);else{let Ue=_t*ne.add(_e).mag()/ne.sub(_e).mag();Je._perp()._mult(Ue*(lt?-1:1))}this.addCurrentVertex(H,Je,0,0,W,Ce),this.addCurrentVertex(H,Je.mult(-1),0,0,W,Ce)}else if(Oe==="bevel"||Oe==="fakeround"){Ce!=null&&J&&this.addCurrentVertex(H,xe||ne,-1,-1,W,Ce);let Ue=H.dist(J)<=2*We&&Oe!=="bevel",at=Je.mult(lt?1:-1);at._mult(_t);let mt=_e.mult(lt?-1:1),et=ne.mult(lt?-1:1),Mt=this.evaluateLineProgressFeatures(this.distance);if(Ce==null&&(this.addHalfVertex(H,at.x,at.y,!1,!lt,0,W,Mt),Ue||this.addHalfVertex(H,at.x+2*et.x,at.y+2*et.y,!1,lt,0,W,Mt)),Oe==="fakeround"){let Bt=Math.round(180*ct/Math.PI/20);this.addHalfVertex(H,et.x,et.y,!1,lt,0,W,Mt);for(let Pt=0;Pt<Bt;Pt++){let Ct=Pt/Bt;if(Ct!==.5){let At=Ct-.5;Ct+=Ct*At*(Ct-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*At*At+(.848013+Ze*(.215638*Ze-1.06021)))}let ui=mt.sub(et)._mult(Ct)._add(et)._unit();this.addHalfVertex(H,ui.x,ui.y,!1,lt,0,W,Mt)}this.addHalfVertex(H,mt.x,mt.y,!1,lt,0,W,Mt)}Ue||Ce!=null||this.addHalfVertex(H,at.x+2*mt.x,at.y+2*mt.y,!1,lt,0,W,Mt),Ce!=null&&te&&this.addCurrentVertex(H,de||_e,1,1,W,Ce)}else if(Oe==="butt")this.addCurrentVertex(H,Je,0,0,W,Ce);else if(Oe==="square"){if(!J){let Ue=k?0:-1;this.addCurrentVertex(H,Je,Ue,Ue,W,Ce)}if(this.addCurrentVertex(H,Je,0,0,W,Ce),J){let Ue=I?0:1;this.addCurrentVertex(H,Je,Ue,Ue,W,Ce)}}else if(Oe==="round"){if(J){let Ue=!He&&xe?xe:ne;this.addCurrentVertex(H,Ue,0,0,W,Ce),!He&&I||this.addCurrentVertex(H,Ue,1,1,W,Ce,!0)}if(te){let Ue=!He&&de?de:_e;!He&&k||this.addCurrentVertex(H,Ue,-1,-1,W,Ce,!0),this.addCurrentVertex(H,Ue,0,0,W,Ce)}}}}addVerticesTo(e,i,s,a,u,p,g,b,w,A){let k=(i.w-e.w)/this.tessellationStep|0,I=0,D=this.scaledDistance;if(k>1){this.lineSoFar=e.w;let V=(i.x-e.x)/k,W=(i.y-e.y)/k,H=(i.z-e.z)/k,J=(i.w-e.w)/k;for(let te=1;te<k;++te){e.x+=V,e.y+=W,e.z+=H,this.lineSoFar+=J,I+=J;let ne=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,s,a,A,!1,g,w,ne),this.addHalfVertex(e,u,p,A,!0,-b,w,ne)}}this.lineSoFar=i.w,this.scaledDistance=D;let B=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,a,A,!1,g,w,B),this.addHalfVertex(i,u,p,A,!0,-b,w,B)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Zt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,a,u,p,g=!1){let b=i.x+i.y*s,w=i.y-i.x*s,A=i.y*a-i.x,k=-i.y-i.x*a;if(p!=null){let I=this.elevationType==="offset",D=-10,B=ht+10,V=p.zOffset,W=new ww(e.x,e.y,V,this.lineSoFar),H=!!I&&Qv(e,D,B),J=this.lineSoFar,te=this.distance;if(this.currentVertex)if(H){let ne=this.currentVertexIsOutside,_e=this.currentVertex,de=new ww(e.x,e.y,V,this.lineSoFar);if(Tw(_e,de,D,B),!Qv(de,D,B)){if(ne){this.e1=this.e2=-1,this.distance-=_e.dist(W),this.lineSoFar=_e.w;let xe=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,b,w,g,!1,s,u,xe),this.addHalfVertex(_e,A,k,g,!0,-a,u,xe),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,de,b,w,A,k,s,a,u,g),this.distance=te,this.scaledDistance=this.distance/this.totalDistance}}else{let ne=this.currentVertex;if(this.currentVertexIsOutside){Tw(ne,W,D,B),this.e1=this.e2=-1,this.distance-=ne.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ne.w;let _e=this.evaluateLineProgressFeatures(ne.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ne,b,w,g,!1,s,u,_e),this.addHalfVertex(ne,A,k,g,!0,-a,u,_e),this.prevDistance=this.distance,this.distance=te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ne,W,b,w,A,k,s,a,u,g)}else H||(this.addHalfVertex(e,b,w,g,!1,s,u,p),this.addHalfVertex(e,A,k,g,!0,-a,u,p));this.currentVertex=W,this.currentVertexIsOutside=H,this.lineSoFar=J}else this.addHalfVertex(e,b,w,g,!1,s,u,p),this.addHalfVertex(e,A,k,g,!0,-a,u,p)}addHalfVertex({x:e,y:i},s,a,u,p,g,b,w){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let k=$t(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,k)}let A=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),b.primitiveLength++),p?this.e2=A:this.e1=A,w!=null&&this.zOffsetVertexArray.emplaceBack(w.zOffset,w.variableWidth,w.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Qv(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let iS,rS;function nS(r,e,i){return e*(ht/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Ot(Jv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let oS=(r,e,i)=>(1-i)*r+i*e;function sS(r,e){return 1/nS(r,1,e.tileZoom)}function aS(r,e,i,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let lS=r=>{let e=[];cS(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let s=r.layout.get("line-join").constantOr("miter")==="none",a=!!r.paint.get("line-pattern").constantOr(1);return s&&a&&e.push("LINE_JOIN_NONE"),e};function cS(r){let e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let ex,uS=()=>ex||(ex={layout:iS||(iS=new hn({"line-cap":new kt(Me.layout_line["line-cap"]),"line-join":new kt(Me.layout_line["line-join"]),"line-miter-limit":new pt(Me.layout_line["line-miter-limit"]),"line-round-limit":new pt(Me.layout_line["line-round-limit"]),"line-sort-key":new kt(Me.layout_line["line-sort-key"]),"line-z-offset":new kt(Me.layout_line["line-z-offset"]),"line-elevation-reference":new pt(Me.layout_line["line-elevation-reference"]),"line-cross-slope":new pt(Me.layout_line["line-cross-slope"]),visibility:new pt(Me.layout_line.visibility),"line-width-unit":new pt(Me.layout_line["line-width-unit"])})),paint:rS||(rS=new hn({"line-opacity":new kt(Me.paint_line["line-opacity"]),"line-color":new kt(Me.paint_line["line-color"]),"line-translate":new pt(Me.paint_line["line-translate"]),"line-translate-anchor":new pt(Me.paint_line["line-translate-anchor"]),"line-width":new kt(Me.paint_line["line-width"]),"line-gap-width":new kt(Me.paint_line["line-gap-width"]),"line-offset":new kt(Me.paint_line["line-offset"]),"line-blur":new kt(Me.paint_line["line-blur"]),"line-dasharray":new kt(Me.paint_line["line-dasharray"]),"line-pattern":new kt(Me.paint_line["line-pattern"]),"line-pattern-cross-fade":new pt(Me.paint_line["line-pattern-cross-fade"]),"line-gradient":new hu(Me.paint_line["line-gradient"]),"line-trim-offset":new pt(Me.paint_line["line-trim-offset"]),"line-trim-fade-range":new pt(Me.paint_line["line-trim-fade-range"]),"line-trim-color":new pt(Me.paint_line["line-trim-color"]),"line-emissive-strength":new pt(Me.paint_line["line-emissive-strength"]),"line-border-width":new kt(Me.paint_line["line-border-width"]),"line-border-color":new kt(Me.paint_line["line-border-color"]),"line-occlusion-opacity":new pt(Me.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},ex);class oD extends kt{possiblyEvaluate(e,i){return i=new Rr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,a){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,a)}}let Gf;function dS(r,e){return e>0?e+2*r:r}let sD=Li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),aD=Li([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),lD=Li([{name:"a_projected_pos",components:4,type:"Float32"}],4);Li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let cD=Li([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),uD=Li([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),dD=Li([{name:"a_texb",components:2,type:"Uint16"}]),hD=Li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pD=Li([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Li([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let hS=Li([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fD=Li([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Li([{name:"triangle",components:3,type:"Uint16"}]),Li([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Li([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Li([{type:"Float32",name:"offsetX"}]),Li([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var to=24;function mD(r,e,i){return r.sections.forEach((s=>{s.text=(function(a,u,p){let g=u.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?a=a.toLocaleUpperCase():g==="lowercase"&&(a=a.toLocaleLowerCase()),cs.applyArabicShaping&&(a=cs.applyArabicShaping(a)),a})(s.text,e,i)})),r}let Hf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function gD(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function _D(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}let tx=4294967296,pS=1/tx,fS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),Jg=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){let s=this.readVarint(),a=s>>3,u=this.pos;this.type=7&s,r(a,e,this),this.pos===u&&this.skip(s)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){let r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){let r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){let r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*tx;return this.pos+=8,r}readSFixed64(){let r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*tx;return this.pos+=8,r}readFloat(){let r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){let r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){let e=this.buf,i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,(function(a,u,p){let g=p.buf,b,w;if(w=g[p.pos++],b=(112&w)>>4,w<128||(w=g[p.pos++],b|=(127&w)<<3,w<128)||(w=g[p.pos++],b|=(127&w)<<10,w<128)||(w=g[p.pos++],b|=(127&w)<<17,w<128)||(w=g[p.pos++],b|=(127&w)<<24,w<128)||(w=g[p.pos++],b|=(1&w)<<31,w<128))return jh(a,b,u);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){let r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&fS?fS.decode(this.buf.subarray(e,r)):(function(i,s,a){let u="",p=s;for(;p<a;){let g=i[p],b,w,A,k=null,I=g>239?4:g>223?3:g>191?2:1;if(p+I>a)break;I===1?g<128&&(k=g):I===2?(b=i[p+1],(192&b)==128&&(k=(31&g)<<6|63&b,k<=127&&(k=null))):I===3?(b=i[p+1],w=i[p+2],(192&b)==128&&(192&w)==128&&(k=(15&g)<<12|(63&b)<<6|63&w,(k<=2047||k>=55296&&k<=57343)&&(k=null))):I===4&&(b=i[p+1],w=i[p+2],A=i[p+3],(192&b)==128&&(192&w)==128&&(192&A)==128&&(k=(15&g)<<18|(63&b)<<12|(63&w)<<6|63&A,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,I=1):k>65535&&(k-=65536,u+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),u+=String.fromCharCode(k),p+=I}return u})(this.buf,e,r)}readBytes(){let r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){let i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){let e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){let e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){let i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*pS),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*pS),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let s,a;if(e>=0?(s=e%4294967296|0,a=e/4294967296|0):(s=~(-e%4294967296),a=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(u,p,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)})(s,0,i),(function(u,p){let g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))})(a,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;let e=this.pos;this.pos=(function(s,a,u){for(let p,g,b=0;b<a.length;b++){if(p=a.charCodeAt(b),p>55295&&p<57344){if(!g){p>56319||b+1===a.length?(s[u++]=239,s[u++]=191,s[u++]=189):g=p;continue}if(p<56320){s[u++]=239,s[u++]=191,s[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(s[u++]=239,s[u++]=191,s[u++]=189,g=null);p<128?s[u++]=p:(p<2048?s[u++]=p>>6|192:(p<65536?s[u++]=p>>12|224:(s[u++]=p>>18|240,s[u++]=p>>12&63|128),s[u++]=p>>6&63|128),s[u++]=63&p|128)}return u})(this.buf,r,this.pos);let i=this.pos-e;i>=128&&mS(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){let e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;let i=this.pos;r(e,this);let s=this.pos-i;s>=128&&mS(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,yD,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,vD,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,wD,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,xD,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,bD,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,SD,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,TD,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,CD,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,ED,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function jh(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function mS(r,e,i){let s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let a=i.pos-1;a>=r;a--)i.buf[a+s]=i.buf[a]}function yD(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function vD(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function xD(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function bD(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function wD(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function SD(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function TD(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function CD(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function ED(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}let ix=3;function AD(r,e,i){e.glyphs=[],r===1&&i.readMessage(kD,e)}function kD(r,e,i){if(r===3){let{id:s,bitmap:a,width:u,height:p,left:g,top:b,advance:w}=i.readMessage(ID,{});e.glyphs.push({id:s,bitmap:new ku({width:u+2*ix,height:p+2*ix},a),metrics:{width:u,height:p,left:g,top:b,advance:w}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function ID(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}let gS=ix,Rs={horizontal:1,vertical:2,horizontalOnly:3};class Zf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){let s=new Zf;return s.scale=e||1,s.fontStack=i,s}static forImage(e){let i=new Zf;return i.image=e,i}}class Vh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){let a=new Vh;for(let u=0;u<e.sections.length;u++){let p=e.sections[u];p.image?a.addImageSection(p,s):a.addTextSection(p,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,s){let a="";for(let u=0;u<i.length;u++){let p=i.charCodeAt(u+1)||null,g=i.charCodeAt(u-1)||null;a+=!s&&(p&&Yp(p)&&!Hf[i[u+1]]||g&&Yp(g)&&!Hf[i[u-1]])||!Hf[i[u]]?i[u]:Hf[i[u]]}return a})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Qg[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Qg[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let s=new Vh;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Zf.forText(e.scale,e.fontStack||i));let s=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(s)}addImageSection(e,i){let s=e.image?e.image.getPrimary():null;if(!s)return void Zt("Can't add FormattedSection with an empty image.");s.scaleSelf(i);let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Zf.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rx(r,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V=1){let W=Vh.fromFeature(r,a,V);k===Rs.vertical&&W.verticalizePunctuation(I);let H=[],J=(function(xe,Ce,Ae,He,Oe,Ze){if(!xe)return[];let Je=[],it=(function(lt,We,Ue,at,mt,et){let Mt=0;for(let Bt=0;Bt<lt.length();Bt++){let Pt=lt.getSection(Bt);Mt+=_S(lt.getCodePoint(Bt),Pt,at,mt,We,et)}return Mt/Math.max(1,Math.ceil(Mt/Ue))})(xe,Ce,Ae,He,Oe,Ze),_t=xe.text.indexOf("\u200B")>=0,ct=0;for(let lt=0;lt<xe.length();lt++){let We=xe.getSection(lt),Ue=xe.getCodePoint(lt);if(Qg[Ue]||(ct+=_S(Ue,We,He,Oe,Ce,Ze)),lt<xe.length()-1){let at=!((Qe=Ue)<11904||!(Xt["Bopomofo Extended"](Qe)||Xt.Bopomofo(Qe)||Xt["CJK Compatibility Forms"](Qe)||Xt["CJK Compatibility Ideographs"](Qe)||Xt["CJK Compatibility"](Qe)||Xt["CJK Radicals Supplement"](Qe)||Xt["CJK Strokes"](Qe)||Xt["CJK Symbols and Punctuation"](Qe)||Xt["CJK Unified Ideographs Extension A"](Qe)||Xt["CJK Unified Ideographs"](Qe)||Xt["Enclosed CJK Letters and Months"](Qe)||Xt["Halfwidth and Fullwidth Forms"](Qe)||Xt.Hiragana(Qe)||Xt["Ideographic Description Characters"](Qe)||Xt["Kangxi Radicals"](Qe)||Xt["Katakana Phonetic Extensions"](Qe)||Xt.Katakana(Qe)||Xt["Vertical Forms"](Qe)||Xt["Yi Radicals"](Qe)||Xt["Yi Syllables"](Qe)));(PD[Ue]||at||We.image)&&Je.push(vS(lt+1,ct,it,Je,LD(Ue,xe.getCodePoint(lt+1),at&&_t),!1))}}var Qe;return xS(vS(xe.length(),ct,it,Je,0,!0))})(W,w,u,e,s,D),{processBidirectionalText:te,processStyledBidirectionalText:ne}=cs;if(te&&W.sections.length===1){let xe=te(W.toString(),J);for(let Ce of xe){let Ae=new Vh;Ae.text=Ce,Ae.sections=W.sections;for(let He=0;He<Ce.length;He++)Ae.sectionIndex.push(0);H.push(Ae)}}else if(ne){let xe=ne(W.text,W.sectionIndex,J);for(let Ce of xe){let Ae=new Vh;Ae.text=Ce[0],Ae.sectionIndex=Ce[1],Ae.sections=W.sections,H.push(Ae)}}else H=(function(xe,Ce){let Ae=[],He=xe.text,Oe=0;for(let Ze of Ce)Ae.push(xe.substring(Oe,Ze)),Oe=Ze;return Oe<He.length&&Ae.push(xe.substring(Oe,He.length)),Ae})(W,J);let _e=[],de={positionedLines:_e,text:W.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(xe,Ce,Ae,He,Oe,Ze,Je,it,_t,ct,Qe,lt){let We=0,Ue=0,at=0,mt=it==="right"?1:it==="left"?0:.5,et=!1;for(let At of Oe){let Ht=At.getSections();for(let di of Ht){if(di.image)continue;let Ti=Ce[di.fontStack];if(Ti&&(et=Ti.ascender!==void 0&&Ti.descender!==void 0,!et))break}if(!et)break}let Mt=0;for(let At of Oe){At.trim();let Ht=At.getMaxScale(),di=(Ht-1)*to,Ti={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Mt]=Ti;let Xi=Ti.positionedGlyphs,mi=0;if(!At.length()){Ue+=Ze,++Mt;continue}let rr=0,nr=0;for(let he=0;he<At.length();he++){let ce=At.getSection(he),$e=At.getSectionIndex(he),Tt=At.getCodePoint(he),Xe=ce.scale,Et=null,qt=null,Vt=null,gi=to,Qt=0,Nt=_t;Nt===Rs.vertical&&((Bt=Tt)===12312||Bt===12313||Bt===12316||Bt===12540||Bt===12448)&&(Nt=Rs.horizontal);let Qi=!(Nt===Rs.horizontal||!Qe&&!fh(Tt)||Qe&&(Qg[Tt]||Kp(Tt)));if(ce.image){let wr=He.get(ce.image.toString());if(!wr)continue;Vt=ce.image,xe.iconsInText=xe.iconsInText||!0,qt=wr.paddedRect;let ri=wr.displaySize;Xe=Xe*to/lt,Et={width:ri[0],height:ri[1],left:0,top:-gS,advance:Qi?ri[1]:ri[0],localGlyph:!1},Qt=et?-Et.height*Xe:Ht*to-17-ri[1]*Xe,gi=Et.advance;let Wi=(Qi?ri[0]:ri[1])*Xe-to*Ht;Wi>0&&Wi>mi&&(mi=Wi)}else{let wr=Ae[ce.fontStack];if(!wr)continue;wr[Tt]&&(qt=wr[Tt]);let ri=Ce[ce.fontStack];if(!ri)continue;let Wi=ri.glyphs[Tt];if(!Wi)continue;if(Et=Wi.metrics,gi=Tt!==8203?to:0,et){let Sr=ri.ascender!==void 0?Math.abs(ri.ascender):0,fr=ri.descender!==void 0?Math.abs(ri.descender):0,cn=(Sr+fr)*Xe;rr<cn&&(rr=cn,nr=(Sr-fr)/2*Xe),Qt=-Sr*Xe}else Qt=(Ht-Xe)*to-17}Qi?(xe.verticalizable=!0,Xi.push({glyph:Tt,image:Vt,x:We,y:Ue+Qt,vertical:Qi,scale:Xe,localGlyph:Et.localGlyph,fontStack:ce.fontStack,sectionIndex:$e,metrics:Et,rect:qt}),We+=gi*Xe+ct):(Xi.push({glyph:Tt,image:Vt,x:We,y:Ue+Qt,vertical:Qi,scale:Xe,localGlyph:Et.localGlyph,fontStack:ce.fontStack,sectionIndex:$e,metrics:Et,rect:qt}),We+=Et.advance*Xe+ct)}Xi.length!==0&&(at=Math.max(We-ct,at),et?bS(Xi,mt,mi,nr,Ze*Ht/2):bS(Xi,mt,mi,0,Ze/2)),We=0;let en=Ze*Ht+mi;Ti.lineOffset=Math.max(mi,di),Ue+=en,++Mt}var Bt;let Pt=Ue,{horizontalAlign:Ct,verticalAlign:ui}=nx(Je);(function(At,Ht,di,Ti,Xi,mi){let rr=(Ht-di)*Xi,nr=-mi*Ti;for(let en of At)for(let he of en.positionedGlyphs)he.x+=rr,he.y+=nr})(xe.positionedLines,mt,Ct,ui,at,Pt),xe.top+=-ui*Pt,xe.bottom=xe.top+Pt,xe.left+=-Ct*at,xe.right=xe.left+at,xe.hasBaseline=et})(de,e,i,s,H,p,g,b,k,w,I,B),!(function(xe){for(let Ce of xe)if(Ce.positionedGlyphs.length!==0)return!1;return!0})(_e))return de}let Qg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _S(r,e,i,s,a,u){if(e.image){let p=s.get(e.image.toString());return p?p.displaySize[0]*e.scale*to/u+a:0}{let p=i[e.fontStack],g=p&&p.glyphs[r];return g?g.metrics.advance*e.scale+a:0}}function yS(r,e,i,s){let a=Math.pow(r-e,2);return s?r<e?a/2:2*a:a+Math.abs(i)*i}function LD(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function vS(r,e,i,s,a,u){let p=null,g=yS(e,i,a,u);for(let b of s){let w=yS(e-b.x,i,a,u)+b.badness;w<=g&&(p=b,g=w)}return{index:r,x:e,priorBreak:p,badness:g}}function xS(r){return r?xS(r.priorBreak).concat(r.index):[]}function nx(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function bS(r,e,i,s,a){if(!(e||i||s||a))return;let u=r.length-1,p=r[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=u;b++)r[b].x-=g,r[b].y+=i+s+a}function wS(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function e_(r,e,i,s){let{horizontalAlign:a,verticalAlign:u}=nx(s),p=i[0]-r.displaySize[0]*a,g=i[1]-r.displaySize[1]*u;return{imagePrimary:r,imageSecondary:e,top:g,bottom:g+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function ox(r,e,i,s,a,u){let p=r.imagePrimary,g;if(p.content){let W=p.content,H=p.pixelRatio||1;g=[W[0]/H,W[1]/H,p.displaySize[0]-W[2]/H,p.displaySize[1]-W[3]/H]}let b=e.left*u,w=e.right*u,A,k,I,D;i==="width"||i==="both"?(D=a[0]+b-s[3],k=a[0]+w+s[1]):(D=a[0]+(b+w-p.displaySize[0])/2,k=D+p.displaySize[0]);let B=e.top*u,V=e.bottom*u;return i==="height"||i==="both"?(A=a[1]+B-s[0],I=a[1]+V+s[2]):(A=a[1]+(B+V-p.displaySize[1])/2,I=A+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:A,right:k,bottom:I,left:D,collisionPadding:g}}function SS(r){return!r.imagePrimary.stretchX}function TS(r){return!r.imagePrimary.stretchY}function CS(r){return{width:r.right-r.left,height:r.bottom-r.top}}let _l=128;function Uh(r,e,i){let{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Rr(r+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:u}=s,p=0;for(;p<a.length&&a[p]<=r;)p++;p=Math.max(0,p-1);let g=p;for(;g<a.length&&a[g]<r+1;)g++;g=Math.min(a.length-1,g);let b=a[p],w=a[g];return s.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:w,minSize:s.evaluate(new Rr(b,{worldview:i})),maxSize:s.evaluate(new Rr(w,{worldview:i})),interpolationType:u}}}function sx(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:a}){return r.kind==="source"?s/_l:r.kind==="composite"?$t(s/_l,a/_l,i):e}function qh(r,e,i=1){let s=0,a=0;if(r.kind==="constant")a=r.layoutSize*i;else if(r.kind!=="source"){let{interpolationType:u,minZoom:p,maxZoom:g}=r,b=u?X(Es.interpolationFactor(u,e,p,g),0,1):0;r.kind==="camera"?a=$t(r.minSize,r.maxSize,b)*i:s=b*i}return{uSizeT:s,uSize:a}}class Fc extends st{constructor(e,i,s,a,u){super(e,i),this.angle=a,this.z=s,u!==void 0&&(this.segment=u)}clone(){return new Fc(this.x,this.y,this.z,this.angle,this.segment)}}function ES(r,e,i,s,a){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,g=0;for(;g>-i/2;){if(p--,p<0)return!1;g-=r[p].dist(u),u=r[p]}g+=r[p].dist(r[p+1]),p++;let b=[],w=0;for(;g<i/2;){let A=r[p],k=r[p+1];if(!k)return!1;let I=r[p-1].angleTo(A)-A.angleTo(k);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:I}),w+=I;g-b[0].distance>s;)w-=b.shift().angleDelta;if(w>a)return!1;p++,g+=A.dist(k)}return!0}function AS(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function kS(r,e,i){return r?.6*e*i:0}function IS(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function zD(r,e,i,s,a,u){let p=kS(i,a,u),g=IS(i,s)*u,b=0,w=AS(r)/2;for(let A=0;A<r.length-1;A++){let k=r[A],I=r[A+1],D=k.dist(I);if(b+D>w){let B=(w-b)/D,V=$t(k.x,I.x,B),W=$t(k.y,I.y,B),H=new Fc(V,W,0,I.angleTo(k),A);return!p||ES(r,H,g,p,e)?H:void 0}b+=D}}function MD(r,e,i,s,a,u,p,g,b){let w=kS(s,u,p),A=IS(s,a),k=A*p,I=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-k<e/4&&(e=k+e/4),PS(r,I?e/2*g%e:(A/2+2*u)*p*g%e,e,w,i,k,I,!1,b)}function PS(r,e,i,s,a,u,p,g,b){let w=u/2,A=AS(r),k=0,I=e-i,D=[];for(let B=0;B<r.length-1;B++){let V=r[B],W=r[B+1],H=V.dist(W),J=W.angleTo(V);for(;I+i<k+H;){I+=i;let te=(I-k)/H,ne=$t(V.x,W.x,te),_e=$t(V.y,W.y,te);if(ne>=0&&ne<b&&_e>=0&&_e<b&&I-w>=0&&I+w<=A){let de=new Fc(ne,_e,0,J,B);s&&!ES(r,de,u,s,a)||D.push(de)}}k+=H}return g||D.length||p||(D=PS(r,k/2,i,s,a,u,p,!0,b)),D}function LS(r){let e=0,i=0;for(let p of r)e+=p.w*p.h,i=Math.max(i,p.w);r.sort(((p,g)=>g.h-p.h));let s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],a=0,u=0;for(let p of r)for(let g=s.length-1;g>=0;g--){let b=s[g];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,u=Math.max(u,p.y+p.h),a=Math.max(a,p.x+p.w),p.w===b.w&&p.h===b.h){let w=s.pop();w&&g<s.length&&(s[g]=w)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(s.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}Ot(Fc,"Anchor");let Ad=1;class $f{static getImagePositionScale(e,i,s){if(i&&e&&e.options&&e.options.transform){let a=e.options.transform;return{x:a.a,y:a.d}}return{x:s,y:s}}constructor(e,i,s,a){this.paddedRect=e;let{pixelRatio:u,version:p,stretchX:g,stretchY:b,content:w,sdf:A,usvg:k}=i;this.pixelRatio=u,this.stretchX=g,this.stretchY=b,this.content=w,this.version=p,this.padding=s,this.sdf=A,this.usvg=k,this.scale=$f.getImagePositionScale(a,k,u)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function ax(r,e,i){let s=Hs.parse(r),a=(function(u,p,g=[1,1]){return{x:0,y:0,w:(u.data?u.data.width:u.width*g[0])+2*p,h:(u.data?u.data.height:u.height*g[1])+2*p}})(e,i,[s.options.transform.a,s.options.transform.d]);return{bin:a,imagePosition:new $f(a,e,i,s),imageVariant:s}}class zS{constructor(e,i,s){let a=new Map,u=new Map;this.haveRenderCallbacks=[];let p=[];this.addImages(e,a,Ad,p),this.addImages(i,u,2,p);let{w:g,h:b}=LS(p),w=new So({width:g||1,height:b||1});for(let[A,k]of e.entries()){let I=a.get(A).paddedRect;So.copy(k.data,w,{x:0,y:0},{x:I.x+Ad,y:I.y+Ad},k.data,null,k.sdf)}for(let[A,k]of i.entries()){let I=u.get(A),D=I.paddedRect,B=I.padding,V=D.x+B,W=D.y+B,H=k.data.width,J=k.data.height;B=B>1?B-1:B,So.copy(k.data,w,{x:0,y:0},{x:V,y:W},k.data,s),So.copy(k.data,w,{x:0,y:J-B},{x:V,y:W-B},{width:H,height:B},s),So.copy(k.data,w,{x:0,y:0},{x:V,y:W+J},{width:H,height:B},s),So.copy(k.data,w,{x:H-B,y:0},{x:V-B,y:W},{width:B,height:J},s),So.copy(k.data,w,{x:0,y:0},{x:V+H,y:W},{width:B,height:J},s),So.copy(k.data,w,{x:H-B,y:J-B},{x:V-B,y:W-B},{width:B,height:B},s),So.copy(k.data,w,{x:0,y:J-B},{x:V+H,y:W-B},{width:B,height:B},s),So.copy(k.data,w,{x:0,y:0},{x:V+H,y:W+J},{width:B,height:B},s),So.copy(k.data,w,{x:H-B,y:0},{x:V-B,y:W+J},{width:B,height:B},s)}this.lut=s,this.image=w,this.iconPositions=a,this.patternPositions=u}addImages(e,i,s,a){for(let[u,p]of e.entries()){let{bin:g,imagePosition:b,imageVariant:w}=ax(u,p,s);i.set(u,b),a.push(g),p.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((a=>e.hasImage(a,s))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(let a of e.getUpdatedImages(s)){for(let u of this.iconPositions.keys()){let p=Hs.parse(u);if(kn.isEqual(p.id,a)){let g=e.getImage(a,s);this.patchUpdatedImage(this.iconPositions.get(u),g,i,null)}}for(let u of this.patternPositions.keys()){let p=Hs.parse(u);if(kn.isEqual(p.id,a)){let g=e.getImage(a,s);this.patchUpdatedImage(this.patternPositions.get(u),g,i,this.lut)}}}}patchUpdatedImage(e,i,s,a=null){if(!e||!i||e.version===i.version)return;e.version=i.version;let[u,p]=e.tl,g=e.sdf;if(this.lut||g){let b={width:i.data.width,height:i.data.height},w=new So(b);So.copy(i.data,w,{x:0,y:0},{x:0,y:0},b,a,g),s.update(w,{position:{x:u,y:p}})}else s.update(i.data,{position:{x:u,y:p}})}}Ot($f,"ImagePosition"),Ot(zS,"ImageAtlas");let Xf=1e20;function MS(r,e,i,s,a,u,p,g,b){for(let w=e;w<e+s;w++)OS(r,i*u+w,u,a,p,g,b);for(let w=i;w<i+a;w++)OS(r,w*u+e,1,s,p,g,b)}function OS(r,e,i,s,a,u,p){u[0]=0,p[0]=-Xf,p[1]=Xf,a[0]=r[e];for(let g=1,b=0,w=0;g<s;g++){a[g]=r[e+g*i];let A=g*g;do{let k=u[b];w=(a[g]-a[k]+A-k*k)/(g-k)/2}while(w<=p[b]&&--b>-1);b++,u[b]=g,p[b]=w,p[b+1]=Xf}for(let g=0,b=0;g<s;g++){for(;p[b+1]<g;)b++;let w=u[b],A=g-w;r[e+g*i]=a[w]+A*A}}let yl=2,lx={none:0,ideographs:1,all:2};class Wh{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){let s=[],a=this.url||yr.GLYPHS_URL;for(let u in e)for(let p of e[u])s.push({stack:u,id:p});we(s,(({stack:u,id:p},g)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=b.glyphs[p];if(w!==void 0)return void g(null,{stack:u,id:p,glyph:w});if(w=this._tinySDF(b,u,p),w)return b.glyphs[p]=w,void g(null,{stack:u,id:p,glyph:w});let A=Math.floor(p/256);if(256*A>65535)return Zt("glyphs > 65535 not supported"),void g(null,{stack:u,id:p,glyph:w});if(b.ranges[A])return void g(null,{stack:u,id:p,glyph:w});let k=b.requests[A];k||(k=b.requests[A]=[],Wh.loadGlyphRange(u,A,a,this.requestManager,((I,D)=>{if(D){b.ascender=D.ascender,b.descender=D.descender;for(let B in D.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=D.glyphs[+B]);b.ranges[A]=!0}for(let B of k)B(I,D);delete b.requests[A]}))),k.push(((I,D)=>{I?g(I):D&&g(null,{stack:u,id:p,glyph:D.glyphs[p]||null})}))}),((u,p)=>{if(u)i(u);else if(p){let g={};for(let{stack:b,id:w,glyph:A}of p)g[b]===void 0&&(g[b]={}),g[b].glyphs===void 0&&(g[b].glyphs={}),g[b].glyphs[w]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},g[b].ascender=this.entries[b].ascender,g[b].descender=this.entries[b].descender;i(null,g)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==lx.none&&(this.localGlyphMode===lx.all?!!this.localFontFamily:!!this.localFontFamily&&(Xt["CJK Unified Ideographs"](e)||Xt["Hangul Syllables"](e)||Xt.Hiragana(e)||Xt.Katakana(e)||Xt["CJK Symbols and Punctuation"](e)||Xt["CJK Unified Ideographs Extension A"](e)||Xt["CJK Unified Ideographs Extension B"](e)||Xt.Osage(e)))}_tinySDF(e,i,s){let a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),u=e.tinySDF=new Wh.TinySDF({fontFamily:a,fontWeight:V,fontSize:24*yl,buffer:3*yl,radius:8*yl}),u.fontWeight=V}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];let p=String.fromCodePoint(s),{data:g,width:b,height:w,glyphWidth:A,glyphHeight:k,glyphLeft:I,glyphTop:D,glyphAdvance:B}=u.draw(p);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new ku({width:b,height:w},g),metrics:{width:A/yl,height:k/yl,left:I/yl,top:D/yl-27,advance:B/yl,localGlyph:!0}}}}Wh.loadGlyphRange=function(r,e,i,s,a){let u=256*e,p=u+255,g=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${u}-${p}`),ua.Glyphs);Ma(g,((b,w)=>{if(b)a(b);else if(w){let A={},k=(function(I){return new Jg(I).readFields(AD,{})})(w);for(let I of k.glyphs)A[I.id]=I;a(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}}))},Wh.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:p="normal",lang:g=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=g;let b=this.size=r+4*e,w=this._createCanvas(b),A=this.ctx=w.getContext("2d",{willReadFrequently:!0});A.font=`${p} ${u} ${r}px ${a}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(r){let e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(r),p=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),b=Math.min(this.size-this.buffer,p+Math.ceil(s)),w=g+2*this.buffer,A=b+2*this.buffer,k=Math.max(w*A,0),I=new Uint8ClampedArray(k),D={data:I,width:w,height:A,glyphWidth:g,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||b===0)return D;let{ctx:B,buffer:V,gridInner:W,gridOuter:H}=this;this.lang&&(B.lang=this.lang),B.clearRect(V,V,g,b),B.fillText(r,V,V+p);let J=B.getImageData(V,V,g,b);H.fill(Xf,0,k),W.fill(0,0,k);for(let te=0;te<b;te++)for(let ne=0;ne<g;ne++){let _e=J.data[4*(te*g+ne)+3]/255;if(_e===0)continue;let de=(te+V)*w+ne+V;if(_e===1)H[de]=0,W[de]=Xf;else{let xe=.5-_e;H[de]=xe>0?xe*xe:0,W[de]=xe<0?xe*xe:0}}MS(H,0,0,w,A,w,this.f,this.v,this.z),MS(W,V,V,g,b,w,this.f,this.v,this.z);for(let te=0;te<k;te++){let ne=Math.sqrt(H[te])-Math.sqrt(W[te]);I[te]=Math.round(255-255*(ne/this.radius+this.cutoff))}return D}};let tc=Ad;function RS(r,e){return r+e[1]-e[0]}function cx(r,e,i,s,a=1){let u=[],p=r.imagePrimary,g=p.pixelRatio,b=p.paddedRect.w-2*tc,w=p.paddedRect.h-2*tc,A=(r.right-r.left)*a,k=(r.bottom-r.top)*a,I=p.stretchX||[[0,b]],D=p.stretchY||[[0,w]],B=I.reduce(RS,0),V=D.reduce(RS,0),W=b-B,H=w-V,J=0,te=B,ne=0,_e=V,de=0,xe=W,Ce=0,Ae=H;if(p.content&&s){let Oe=p.content;J=t_(I,0,Oe[0]),ne=t_(D,0,Oe[1]),te=t_(I,Oe[0],Oe[2]),_e=t_(D,Oe[1],Oe[3]),de=Oe[0]-J,Ce=Oe[1]-ne,xe=Oe[2]-Oe[0]-te,Ae=Oe[3]-Oe[1]-_e}let He=(Oe,Ze,Je,it)=>{let _t=i_(Oe.stretch-J,te,A,r.left*a),ct=r_(Oe.fixed-de,xe,Oe.stretch,B),Qe=i_(Ze.stretch-ne,_e,k,r.top*a),lt=r_(Ze.fixed-Ce,Ae,Ze.stretch,V),We=i_(Je.stretch-J,te,A,r.left*a),Ue=r_(Je.fixed-de,xe,Je.stretch,B),at=i_(it.stretch-ne,_e,k,r.top*a),mt=r_(it.fixed-Ce,Ae,it.stretch,V),et=new st(_t,Qe),Mt=new st(We,Qe),Bt=new st(We,at),Pt=new st(_t,at),Ct=new st(ct/g,lt/g),ui=new st(Ue/g,mt/g),At=e*Math.PI/180;if(At){let rr=Math.sin(At),nr=Math.cos(At),en=[nr,-rr,rr,nr];et._matMult(en),Mt._matMult(en),Pt._matMult(en),Bt._matMult(en)}let Ht=Oe.stretch+Oe.fixed,di=Je.stretch+Je.fixed,Ti=Ze.stretch+Ze.fixed,Xi=it.stretch+it.fixed,mi=r.imageSecondary;return{tl:et,tr:Mt,bl:Pt,br:Bt,texPrimary:{x:p.paddedRect.x+tc+Ht,y:p.paddedRect.y+tc+Ti,w:di-Ht,h:Xi-Ti},texSecondary:mi?{x:mi.paddedRect.x+tc+Ht,y:mi.paddedRect.y+tc+Ti,w:di-Ht,h:Xi-Ti}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ct,pixelOffsetBR:ui,minFontScaleX:xe/g/A,minFontScaleY:Ae/g/k,isSDF:i}};if(s&&(p.stretchX||p.stretchY)){let Oe=DS(I,W,B),Ze=DS(D,H,V);for(let Je=0;Je<Oe.length-1;Je++){let it=Oe[Je],_t=Oe[Je+1];for(let ct=0;ct<Ze.length-1;ct++)u.push(He(it,Ze[ct],_t,Ze[ct+1]))}}else u.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:w+1}));return u}function OD(r,e){let i=r.stretchY||[[0,r.paddedRect.h-2*tc]];return e&&(r.stretchX||r.stretchY)?BS(r.stretchX||[[0,r.paddedRect.w-2*tc]])*BS(i):1}function t_(r,e,i){let s=0;for(let a of r)s+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return s}function DS(r,e,i){let s=[{fixed:-tc,stretch:0}];for(let[a,u]of r){let p=s[s.length-1];s.push({fixed:a-p.stretch,stretch:p.stretch}),s.push({fixed:a-p.stretch,stretch:p.stretch+(u-a)})}return s.push({fixed:e+tc,stretch:i}),s}function BS(r){return 2*r.length+1}function i_(r,e,i,s){return r/e*i+s}function r_(r,e,i,s){return r-e*i/s}function RD(r,e,i,s){let a=e+r.positionedLines[s].lineOffset;return s===0?i+a/2:i+(a+(e+r.positionedLines[s-1].lineOffset))/2}function DD(r,e=1,i=!1){let s=1/0,a=1/0,u=-1/0,p=-1/0,g=r[0];for(let D=0;D<g.length;D++){let B=g[D];(!D||B.x<s)&&(s=B.x),(!D||B.y<a)&&(a=B.y),(!D||B.x>u)&&(u=B.x),(!D||B.y>p)&&(p=B.y)}let b=Math.min(u-s,p-a),w=b/2,A=new bc([],BD);if(b===0)return new st(s,a);for(let D=s;D<u;D+=b)for(let B=a;B<p;B+=b)A.push(new Gh(D+w,B+w,w,r));let k=(function(D){let B=0,V=0,W=0,H=D[0];for(let J=0,te=H.length,ne=te-1;J<te;ne=J++){let _e=H[J],de=H[ne],xe=_e.x*de.y-de.x*_e.y;V+=(_e.x+de.x)*xe,W+=(_e.y+de.y)*xe,B+=3*xe}return new Gh(V/B,W/B,0,D)})(r),I=A.length;for(;A.length;){let D=A.pop();(D.d>k.d||!k.d)&&(k=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,I)),D.max-k.d<=e||(w=D.h/2,A.push(new Gh(D.p.x-w,D.p.y-w,w,r)),A.push(new Gh(D.p.x+w,D.p.y-w,w,r)),A.push(new Gh(D.p.x-w,D.p.y+w,w,r)),A.push(new Gh(D.p.x+w,D.p.y+w,w,r)),I+=4)}return i&&(console.log(`num probes: ${I}`),console.log(`best distance: ${k.d}`)),k.p}function BD(r,e){return e.max-r.max}class Gh{constructor(e,i,s,a){this.p=new st(e,i),this.h=s,this.d=(function(u,p){let g=!1,b=1/0;for(let w=0;w<p.length;w++){let A=p[w];for(let k=0,I=A.length,D=I-1;k<I;D=k++){let B=A[k],V=A[D];B.y>u.y!=V.y>u.y&&u.x<(V.x-B.x)*(u.y-B.y)/(V.y-B.y)+B.x&&(g=!g),b=Math.min(b,Ps(u,B,V))}}return(g?1:-1)*Math.sqrt(b)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}}let FD=Object.keys,ux=Number.POSITIVE_INFINITY,ND=Math.sqrt(2);function n_(r,e,i,s){let a=r.collisionPadding||[0,0,0,0],u={top:r.top-a[1],bottom:r.bottom+a[3],left:r.left-a[0],right:r.right+a[2],scaled:!1};return s!==void 0&&(function(p,g){p.top*=g,p.bottom*=g,p.left*=g,p.right*=g,p.scaled=!0})(u,s),i&&(function(p,g){if(!g)return;let b=Bi(g),w=new st(p.left,p.top),A=new st(p.right,p.top),k=new st(p.left,p.bottom),I=new st(p.right,p.bottom);w._rotateAround(b,new st(0,0)),A._rotateAround(b,new st(0,0)),k._rotateAround(b,new st(0,0)),I._rotateAround(b,new st(0,0)),p.left=Math.min(w.x,A.x,k.x,I.x),p.right=Math.max(w.x,A.x,k.x,I.x),p.top=Math.min(w.y,A.y,k.y,I.y),p.bottom=Math.max(w.y,A.y,k.y,I.y)})(u,i),e?{top:Math.min(e.top,u.top),bottom:Math.max(e.bottom,u.bottom),left:Math.min(e.left,u.left),right:Math.max(e.right,u.right),scaled:e.scaled||u.scaled}:u}function FS(r,[e,i]){let s=0,a=0;if(i===ux){e<0&&(e=0);let u=e/ND;switch(r){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(r){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,a]}function jD(r,e,i,s,a,u,p,g,b,w,A){let k=r.layers[0],I=k.appearances;if(I.length===0)return{iconBBox:null,iconVerticalBBox:null};let D=null,B=null,V=s.get("icon-rotate").evaluate(a,{},u);e&&(D=n_(e,D,V,p),i)&&(B=n_(i,B,V+90,p));let[W,H]=s.get("icon-size-scale-range"),J=X(1,W,H);for(let te of I){let ne=te.getUnevaluatedProperties(),_e=ne._values["icon-image"].value!==void 0,de=ne._values["icon-size"].value!==void 0,xe=ne._values["icon-offset"].value!==void 0,Ce=ne._values["icon-rotate"].value!==void 0;if(_e||de||xe||Ce){let Ae=xe?k.getAppearanceValueAndResolveTokens(te,"icon-offset",a,u,[]):null,He=Ae&&Array.isArray(Ae)?Ae:g,Oe=Ce?k.getAppearanceValueAndResolveTokens(te,"icon-rotate",a,u,[]):null,Ze=typeof Oe=="number"?Oe:V,Je=de?k.getAppearanceValueAndResolveTokens(te,"icon-size",a,u,[]):null,it=typeof Je=="number"?Je*b.iconScaleFactor:p,_t=null,ct=null,Qe=null;if(_e){let lt=k.getAppearanceValueAndResolveTokens(te,"icon-image",a,u,[]);if(lt){let We=r.getResolvedImageFromTokens(lt),Ue=ne._values["icon-size"],at=Yf(We,Uh(r.zoom,Ue,r.worldview),Ue,u,r.zoom,a,r.pixelRatio,J,r.worldview);Qe=w.get(at.iconPrimary.toString())}}else e&&(Qe=e.imagePrimary);Qe&&(_t=e_(Qe,null,He,A),r.allowVerticalPlacement&&(ct=e_(Qe,null,He,A))),_t&&(D=n_(_t,D,Ze,it)),ct&&(B=n_(ct,B,Ze+90,it))}}return{iconBBox:D,iconVerticalBBox:B}}function o_(r,e,i,s,a,u,p,g,b){if(!e||!e.usvg)return;let w=CS(s),A=CS(a),k=u!=="both"&&u!=="width"||!SS(s)?1:A.width/w.width,I=u!=="both"&&u!=="height"||!TS(s)?1:A.height/w.height;i.scaleSelf(k,I);let D=i.toString();p.set(D,i),g.set(D,e);let{imagePosition:B}=ax(D,e,Ad);b.set(D,B)}function NS(r,e,i,s,a,u,p,g,b){if(!r)return;let w=(function(A,k,I,D,B,V){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){let W=k.possiblyEvaluate(new Rr(A.maxZoom,{worldview:V}),I).evaluate(B,{},I),H=k.possiblyEvaluate(new Rr(A.minZoom,{worldview:V}),I).evaluate(B,{},I);return Math.max(W,H)}return k.possiblyEvaluate(new Rr(D,{worldview:V})).evaluate(B,{},I)})(e,i,s,a,u,b);return r.scaleSelf(w*g*p)}function Yf(r,e,i,s,a,u,p,g,b){return{iconPrimary:NS(r.getPrimary(),e,i,s,a,u,p,g,b),iconSecondary:NS(r.getSecondary(),e,i,s,a,u,p,g,b)}}function VD(r,e,i){if(!e)return;let s=i.get(r.toString()),a=i.get(e.toString());s&&a&&(s.paddedRect.w===a.paddedRect.w&&s.paddedRect.h===a.paddedRect.h||Zt(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),s.usvg!==a.usvg&&Zt(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function jS(r,e,i,s){if(!r)return;let a=e.get(i.toString());if(r.imagePrimary=a,s){let u=e.get(s.toString());r.imageSecondary=u}}function UD(r,e){for(let i in r.horizontal)VS(r.horizontal[i],e);VS(r.vertical,e)}function VS(r,e){if(r){for(let i of r.positionedLines)for(let s of i.positionedGlyphs)if(s.image!==null){let a=s.image.toString();s.rect=e.get(a).paddedRect}}}function dx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qD(r,e,i,s,a,u,p,g,b){let w=hx(u.horizontal)||u.vertical,A=i.get("icon-text-fit-padding").evaluate(s,{},a),k,I=e;return e&&b!=="none"&&(r.allowVerticalPlacement&&u.vertical&&(k=ox(e,u.vertical,b,A,g,p)),w&&(I=ox(e,w,b,A,g,p))),{defaultShapedIcon:I,verticallyShapedIcon:k}}function WD(r,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J,te,ne,_e){let de=p.textMaxSize.evaluate(e,{},I);de===void 0?de=g*p.textScaleFactor:de*=p.textScaleFactor;let xe=r.layers[0].layout,Ce=to,Ae=g*p.textScaleFactor/Ce,He=hx(i.horizontal)||i.vertical;if(W!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){let et=r.appearanceFeatureData[e.index];et&&(et.textShaping=He,et.iconTextFitPadding=xe.get("icon-text-fit-padding").evaluate(e,{},I),et.fontScale=Ae)}let Oe=D.name==="globe",Ze=r.tilePixelRatio*de/Ce,Je=(We=r.overscaling,r.zoom>18&&We>2&&(We>>=1),Math.max(ht/(512*We),1)*xe.get("symbol-spacing")),it=xe.get("text-padding")*r.tilePixelRatio,_t=xe.get("icon-padding")*r.tilePixelRatio,ct=Bi(xe.get("text-max-angle")),Qe=xe.get("icon-rotation-alignment")==="map"&&te!=="point",lt=Je/2;var We;r.hasAnyIconTextFit===!1&&W!=="none"&&(r.hasAnyIconTextFit=!0);let Ue=e.properties?+e.properties[It]:null,at=Ue&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(Ue):65535,mt=(et,Mt,Bt)=>{if(Mt.x<0||Mt.x>=ht||Mt.y<0||Mt.y>=ht)return;let Pt=null;if(Oe){let{x:Ct,y:ui,z:At}=D.projectTilePoint(Mt.x,Mt.y,Bt);Pt={anchor:new Fc(Ct,ui,At,0,void 0),up:D.upVector(Bt,Mt.x,Mt.y)}}(function(Ct,ui,At,Ht,di,Ti,Xi,mi,rr,nr,en,he,ce,$e,Tt,Xe,Et,qt,Vt,gi,Qt,Nt,Qi,wr,ri,Wi,Sr,fr,cn,Vr,Mr){let _r=Ct.addToLineVertexArray(ui,Ht),or,_i,sr,Or,ei,Yi,Ur,mn=0,Sn=0,Bn=0,qr=0,Ln=-1,us=-1,zn={},Ds=ko(""),To=At?At.anchor:ui,xa=fr!=="none",ds=0,Bs=0;if(rr._unevaluatedLayout.getValue("text-radial-offset")===void 0){let io=rr.layout.get("text-offset").evaluate(Qt,{},ri);ds=io[0]*to,Bs=io[1]*to}else ds=rr.layout.get("text-radial-offset").evaluate(Qt,{},ri)*to,Bs=ux;if(Ct.allowVerticalPlacement&&di.vertical){let io=di.vertical;if(Tt)Yi=px(io),mi&&(Ur=px(mi));else{let jo=rr.layout.get("text-rotate").evaluate(Qt,{},ri)+90;sr=s_(nr,To,ui,en,he,ce,io,$e,jo,Xe),mi&&(Or=s_(nr,To,ui,en,he,ce,mi,qt,jo,null,Mr))}}if(Ti){let io=Ct.iconSizeData,jo=rr.layout.get("icon-rotate").evaluate(Qt,{},ri),ic=cx(Ti,jo,Qi,xa,Nt.iconScaleFactor),Mu=mi?cx(mi,jo,Qi,xa,Nt.iconScaleFactor):void 0;_i=s_(nr,To,ui,en,he,ce,Ti,qt,jo,null,Vr);let Jh=(function(rc,S_,Qh,r3,s2,a2,n3,o3){let l2=rc.layers[0],c2=l2.appearances,ep=S_.length;if(Qh&&(ep=Math.max(ep,Qh.length)),c2.length===0)return ep;let[s3,a3]=r3.get("icon-size-scale-range"),l3=X(1,s3,a3);for(let u2 of c2){let d2=u2.getUnevaluatedProperties();if(d2._values["icon-image"].value!==void 0){let h2=l2.getAppearanceValueAndResolveTokens(u2,"icon-image",s2,a2,[]);if(h2){let p2=rc.getResolvedImageFromTokens(h2);if(p2){let f2=d2._values["icon-size"],c3=Yf(p2,Uh(rc.zoom,f2,rc.worldview),f2,a2,rc.zoom,s2,rc.pixelRatio,l3,rc.worldview),u3=n3.get(c3.iconPrimary.toString());ep=Math.max(ep,OD(u3,o3))}}}}return ep})(Ct,ic,Mu,rr.layout,Qt,ri,Ct.iconAtlasPositions,xa);mn=4*Jh;let Ou=null;io.kind==="source"?(Ou=[_l*rr.layout.get("icon-size").evaluate(Qt,{},ri)*Nt.iconScaleFactor],Ou[0]>Nc&&Zt(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${Kf}. Reduce your "icon-size".`)):io.kind==="composite"&&(Ou=[_l*Nt.compositeIconSizes[0].evaluate(Qt,{},ri)*Nt.iconScaleFactor,_l*Nt.compositeIconSizes[1].evaluate(Qt,{},ri)*Nt.iconScaleFactor],(Ou[0]>Nc||Ou[1]>Nc)&&Zt(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${Kf}. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,ic,Ou,gi,Vt,Qt,void 0,At,ui,_r.lineStartIndex,_r.lineLength,-1,wr,ri,Wi,Sr,Ct.symbolInstances.length,Jh),Ln=Ct.icon.placedSymbolArray.length-1,Mu&&(Sn=4*Jh,Ct.addSymbols(Ct.icon,Mu,Ou,gi,Vt,Qt,Rs.vertical,At,ui,_r.lineStartIndex,_r.lineLength,-1,wr,ri,Wi,Sr,Ct.symbolInstances.length,Jh),us=Ct.icon.placedSymbolArray.length-1)}for(let io in di.horizontal){let jo=io,ic=di.horizontal[jo];or||(Ds=ko(ic.text),Tt?ei=px(ic):or=s_(nr,To,ui,en,he,ce,ic,$e,rr.layout.get("text-rotate").evaluate(Qt,{},ri),Xe));let Mu=ic.positionedLines.length===1;if(Bn+=US(Ct,At,ui,ic,Xi,rr,Tt,Qt,Xe,_r,di.vertical?Rs.horizontal:Rs.horizontalOnly,Mu?FD(di.horizontal):[jo],zn,Ln,Nt,wr,ri,Ct.symbolInstances.length,Wi),Mu)break}di.vertical&&(qr+=US(Ct,At,ui,di.vertical,Xi,rr,Tt,Qt,Xe,_r,Rs.vertical,["vertical"],zn,us,Nt,wr,ri,Ct.symbolInstances.length,Wi));let Co=-1,Fs=(io,jo)=>io?Math.max(io,jo):jo;Co=Fs(ei,Co),Co=Fs(Yi,Co),Co=Fs(Ur,Co);let ba=Co>-1?1:0;Ct.glyphOffsetArray.length>=65535&&Zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qt.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,Qt.sortKey),Ct.symbolInstances.emplaceBack(ui.x,ui.y,To.x,To.y,To.z,zn.right>=0?zn.right:-1,zn.center>=0?zn.center:-1,zn.left>=0?zn.left:-1,zn.vertical>=0?zn.vertical:-1,Ln,us,Ds,or!==void 0?or:Ct.collisionBoxArray.length,or!==void 0?or+1:Ct.collisionBoxArray.length,sr!==void 0?sr:Ct.collisionBoxArray.length,sr!==void 0?sr+1:Ct.collisionBoxArray.length,_i!==void 0?_i:Ct.collisionBoxArray.length,_i!==void 0?_i+1:Ct.collisionBoxArray.length,Or||Ct.collisionBoxArray.length,Or?Or+1:Ct.collisionBoxArray.length,en,Bn,qr,mn,Sn,ba,0,ds,Bs,Co,0,xa?1:0,cn)})(r,Mt,Pt,et,i,s,u,a,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,it,J,w,0,_t,Qe,H,e,p,A,k,I,B,V,W,at,ne,_e)};if(te==="line")for(let et of Vg(e.geometry,0,0,ht,ht)){let Mt=MD(et,Je,ct,i.vertical||He,s,Ce,Ze,r.overscaling,ht);for(let Bt of Mt)He&&GD(r,He.text,lt,Bt)||mt(et,Bt,I)}else if(te==="line-center"){for(let et of e.geometry)if(et.length>1){let Mt=zD(et,ct,i.vertical||He,s,Ce,Ze);Mt&&mt(et,Mt,I)}}else if(e.type==="Polygon")for(let et of Mf(e.geometry,0)){let Mt=DD(et,16);mt(et[0],new Fc(Mt.x,Mt.y,0,0,void 0),I)}else if(e.type==="LineString")for(let et of e.geometry)mt(et,new Fc(et[0].x,et[0].y,0,0,void 0),I);else if(e.type==="Point")for(let et of e.geometry)for(let Mt of et)mt([Mt],new Fc(Mt.x,Mt.y,0,0,void 0),I)}let Kf=255,Nc=Kf*_l;function US(r,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J){let te=(function(de,xe,Ce,Ae,He,Oe,Ze,Je){let it=[];if(xe.positionedLines.length===0)return it;let _t=Ae.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,ct=(function(at){let mt=at[0],et=at[1],Mt=mt*et;return Mt>0?[mt,-et]:Mt<0?[-mt,et]:mt===0?[et,mt]:[et,-mt]})(Ce),Qe=Math.abs(xe.top-xe.bottom);for(let at of xe.positionedLines)Qe-=at.lineOffset;let lt=xe.positionedLines.length,We=Qe/lt,Ue=xe.top-Ce[1];for(let at=0;at<lt;++at){let mt=xe.positionedLines[at];Ue=RD(xe,We,Ue,at);for(let et of mt.positionedGlyphs){if(!et.rect)continue;let Mt=et.rect||{},Bt=gS+1,Pt=!0,Ct=1,ui=0;if(et.image){let Vt=Ze.get(et.image.toString());if(!Vt)continue;if(Vt.sdf){Zt("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,Ct=Vt.pixelRatio,Bt=Ad/Ct}let At=(He||Je)&&et.vertical,Ht=et.metrics.advance*et.scale/2,di=et.metrics,Ti=et.rect;if(Ti===null)continue;Je&&xe.verticalizable&&(ui=et.image?Ht-et.metrics.width*et.scale/2:0);let Xi=He?[et.x+Ht,et.y]:[0,0],mi=[0,0],rr=[0,0],nr=!1;He||(At?(rr=[et.x+Ht+ct[0],et.y+ct[1]-ui],nr=!0):mi=[et.x+Ht+Ce[0],et.y+Ce[1]-ui]);let en=Ti.w*et.scale/(Ct*(et.localGlyph?yl:1)),he=Ti.h*et.scale/(Ct*(et.localGlyph?yl:1)),ce,$e,Tt,Xe;if(At){let Vt=et.y-Ue,gi=new st(-Ht,Ht-Vt),Qt=-Math.PI/2,Nt=new st(...rr);ce=new st(-Ht+mi[0],mi[1]),ce._rotateAround(Qt,gi)._add(Nt),ce.x+=-Vt+Ht,ce.y-=(di.left-Bt)*et.scale;let Qi=et.image?di.advance*et.scale:to*et.scale,wr=String.fromCodePoint(et.glyph);gD(wr)?ce.x+=(1-Bt)*et.scale:_D(wr)?ce.x+=Qi-di.height*et.scale+(-Bt-1)*et.scale:ce.x+=et.image||di.width+2*Bt===Ti.w&&di.height+2*Bt===Ti.h?(Qi-he)/2:(Qi-(di.height+2*Bt)*et.scale)/2,$e=new st(ce.x,ce.y-en),Tt=new st(ce.x+he,ce.y),Xe=new st(ce.x+he,ce.y-en)}else{let Vt=(di.left-Bt)*et.scale-Ht+mi[0],gi=(-di.top-Bt)*et.scale+mi[1],Qt=Vt+en,Nt=gi+he;ce=new st(Vt,gi),$e=new st(Qt,gi),Tt=new st(Vt,Nt),Xe=new st(Qt,Nt)}if(_t){let Vt;Vt=He?new st(0,0):nr?new st(ct[0],ct[1]):new st(Ce[0],Ce[1]),ce._rotateAround(_t,Vt),$e._rotateAround(_t,Vt),Tt._rotateAround(_t,Vt),Xe._rotateAround(_t,Vt)}let Et=new st(0,0),qt=new st(0,0);it.push({tl:ce,tr:$e,bl:Tt,br:Xe,texPrimary:Mt,texSecondary:void 0,writingMode:xe.writingMode,glyphOffset:Xi,sectionIndex:et.sectionIndex,isSDF:Pt,pixelOffsetTL:Et,pixelOffsetBR:qt,minFontScaleX:0,minFontScaleY:0})}}return it})(0,s,b,u,p,g,a,r.allowVerticalPlacement),ne=r.textSizeData,_e=null;ne.kind==="source"?(_e=[_l*u.layout.get("text-size").evaluate(g,{},W)*B.textScaleFactor],_e[0]>Nc&&Zt(`${r.layerIds[0]}: Value for "text-size" is >= ${Kf}. Reduce your "text-size".`)):ne.kind==="composite"&&(_e=[_l*B.compositeTextSizes[0].evaluate(g,{},W)*B.textScaleFactor,_l*B.compositeTextSizes[1].evaluate(g,{},W)*B.textScaleFactor],(_e[0]>Nc||_e[1]>Nc)&&Zt(`${r.layerIds[0]}: Value for "text-size" is >= ${Kf}. Reduce your "text-size".`)),r.addSymbols(r.text,te,_e,b,p,g,A,e,i,w.lineStartIndex,w.lineLength,D,V,W,J,!1,H,te.length);for(let de of k)I[de]=r.text.placedSymbolArray.length-1;return 4*te.length}function hx(r){for(let e in r)return r[e];return null}function s_(r,e,i,s,a,u,p,g,b,w,A){let k,I,D,B;if(k=A?A.top:p.top,I=A?A.bottom:p.bottom,D=A?A.left:p.left,B=A?A.right:p.right,wS(p)&&p.collisionPadding){let V=p.collisionPadding;D-=V[0],k-=V[1],B+=V[2],I+=V[3]}if(b){let V=new st(D,k),W=new st(B,k),H=new st(D,I),J=new st(B,I),te=Bi(b),ne=new st(0,0);w&&(ne=new st(w[0],w[1])),V._rotateAround(te,ne),W._rotateAround(te,ne),H._rotateAround(te,ne),J._rotateAround(te,ne),D=Math.min(V.x,W.x,H.x,J.x),B=Math.max(V.x,W.x,H.x,J.x),k=Math.min(V.y,W.y,H.y,J.y),I=Math.max(V.y,W.y,H.y,J.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,k,B,I,g,s,a,u),r.length-1}function px(r){wS(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);let e=r.bottom-r.top;return e>0?Math.max(10,e):null}function GD(r,e,i,s){let a=r.compareText;if(e in a){let u=a[e];for(let p=u.length-1;p>=0;p--)if(s.dist(u[p])<i)return!0}else a[e]=[];return a[e].push(s),!1}function qS(r,e){let i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,a=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),u=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01)),p=Math.sin(r._pitch)*u+a,g=a*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let b=Math.max(r.zoom-17,0);r.isOrthographic&&(b/=10),p*=1+b}return Math.min(1.01*p,g)}function Jf(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};let i=Math.pow(2,-r.z),s=r.x*i,a=(r.x+1)*i,u=r.y*i,p=(r.y+1)*i,g=se(s),b=se(a),w=ie(u),A=ie(p),k=e.project(g,w),I=e.project(b,w),D=e.project(b,A),B=e.project(g,A),V=Math.min(k.x,I.x,D.x,B.x),W=Math.min(k.y,I.y,D.y,B.y),H=Math.max(k.x,I.x,D.x,B.x),J=Math.max(k.y,I.y,D.y,B.y),te=i/16;function ne(de,xe,Ce,Ae,He,Oe){let Ze=(Ce+He)/2,Je=(Ae+Oe)/2,it=e.project(se(Ze),ie(Je)),_t=Math.max(0,V-it.x,W-it.y,it.x-H,it.y-J);V=Math.min(V,it.x),H=Math.max(H,it.x),W=Math.min(W,it.y),J=Math.max(J,it.y),_t>te&&(ne(de,it,Ce,Ae,Ze,Je),ne(it,xe,Ze,Je,He,Oe))}ne(k,I,s,u,a,u),ne(I,D,a,u,a,p),ne(D,B,a,p,s,p),ne(B,k,s,p,s,u),V-=te,W-=te,H+=te,J+=te;let _e=1/Math.max(H-V,J-W);return{scale:_e,x:V*_e,y:W*_e,x2:H*_e,y2:J*_e,projection:e}}function WS(r,{x:e,y:i},s=0){return new st(((e-s)*r.scale-r.x)*ht,(i*r.scale-r.y)*ht)}let HD=Re(new Float32Array(16));class Lu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new F(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,a=!0){return e._coordinatePoint(e.locationCoordinate(i,s),a)}pixelsPerMeter(e,i){return ee(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return qS(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,a){let u=e.horizonLineFromTop(!1),p=new st(i,Math.max(u,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,a))}pointCoordinate3D(e,i,s){let a=new st(i,s);if(e.elevation)return e.elevation.pointCoordinate(a);{let u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);let s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return HD}createTileMatrix(e,i,s){let a,u,p,g=s.canonical,b=Re(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=Jf(g,this);a=1,u=w.x+s.wrap*w.scale,p=w.y,St(b,b,[a/w.scale,a/w.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*s.wrap)*a,p=g.y*a;return qe(b,b,[u,p,0]),St(b,b,[a/ht,a/ht,1]),b}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class ZD extends Lu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,s]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Bi(i));this.n=(a+Math.sin(Bi(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:s,c:a,r0:u}=this,p=Bi(e-this.center[0]),g=Bi(i),b=Math.sqrt(a-2*s*Math.sin(g))/s;return{x:b*Math.sin(p*s),y:b*Math.cos(p*s)-u,z:0}}unproject(e,i){let{n:s,c:a,r0:u}=this,p=u+i,g=Math.atan2(e,Math.abs(p))*Math.sign(p);p*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(p));let b=Bi(this.center[0])*s;g=Te(g,-Math.PI-b,Math.PI-b);let w=X(bn(g/s)+this.center[0],-180,180),A=Math.asin(X((a-(e*e+p*p)*s*s)/(2*s),-1,1)),k=X(bn(A),-ae,ae);return new F(w,k)}}let Qf=1.340264,em=-.081106,tm=893e-6,im=.003796,a_=Math.sqrt(3)/2;class $D extends Lu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let s=Math.asin(a_*Math.sin(i)),a=s*s,u=a*a*a;return{x:.5*(e*Math.cos(s)/(a_*(Qf+3*em*a+u*(7*tm+9*im*a)))/Math.PI+.5),y:1-.5*(s*(Qf+em*a+u*(tm+im*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=s*s,u=a*a*a;for(let A,k,I,D=0;D<12&&(k=s*(Qf+em*a+u*(tm+im*a))-i,I=Qf+3*em*a+u*(7*tm+9*im*a),A=k/I,s=X(s-A,-Math.PI/3,Math.PI/3),a=s*s,u=a*a*a,!(Math.abs(A)<1e-12));++D);let p=a_*e*(Qf+3*em*a+u*(7*tm+9*im*a))/Math.cos(s),g=Math.asin(Math.sin(s)/a_),b=X(180*p/Math.PI,-180,180),w=X(180*g/Math.PI,-ae,ae);return new F(b,w)}}class XD extends Lu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let s=360*(e-.5),a=X(360*(.5-i),-ae,ae);return new F(s,a)}}let Hh=Math.PI/2;function l_(r){return Math.tan((Hh+r)/2)}class YD extends Lu{constructor(e){super(e),this.center=e.center||[0,30];let[i,s]=this.parallels=e.parallels||[30,30],a=Bi(i),u=Bi(s);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);let p=Math.cos(a),g=l_(a);this.n=a===u?Math.sin(a):Math.log(p/Math.cos(u))/Math.log(l_(u)/g),this.f=p*Math.pow(l_(a),this.n)/this.n}project(e,i){i=Bi(i),this.southernCenter&&(i=-i),e=Bi(e-this.center[0]);let s=1e-6,{n:a,f:u}=this;u>0?i<-Hh+s&&(i=-Hh+s):i>Hh-s&&(i=Hh-s);let p=u/Math.pow(l_(i),a),g=p*Math.sin(a*e),b=u-p*Math.cos(a*e);return g=.5*(g/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:g,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:s,f:a}=this,u=a-i,p=Math.sign(u),g=Math.sign(s)*Math.sqrt(e*e+u*u),b=Math.atan2(e,Math.abs(u))*p;u*s<0&&(b-=Math.PI*Math.sign(e)*p);let w=X(bn(b/s)+this.center[0],-180,180),A=X(bn(2*Math.atan(Math.pow(a/g,1/s))-Hh),-ae,ae);return new F(w,this.southernCenter?-A:A)}}class GS extends Lu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:K(e),y:$(i),z:0}}unproject(e,i){let s=se(e),a=ie(i);return new F(s,a)}}let HS=Bi(ae);class KD extends Lu{project(e,i){let s=(i=Bi(i))*i,a=s*s;return{x:.5*((e=Bi(e))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=25,u=0,p=s*s;do{p=s*s;let w=p*p;u=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-i)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=X(s-u,-HS,HS)}while(Math.abs(u)>1e-6&&--a>0);p=s*s;let g=X(bn(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=bn(s);return new F(g,b)}}let ZS=Bi(ae);class JD extends Lu{project(e,i){i=Bi(i),e=Bi(e);let s=Math.cos(i),a=2/Math.PI,u=Math.acos(s*Math.cos(e/2)),p=Math.sin(u)/u,g=.5*(e*a+2*s*Math.sin(e/2)/p)||0,b=.5*(i+Math.sin(i)/p)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,u=25,p=1e-6,g=0,b=0;do{let w=Math.cos(a),A=Math.sin(a),k=2*A*w,I=A*A,D=w*w,B=Math.cos(s/2),V=Math.sin(s/2),W=2*B*V,H=V*V,J=1-D*B*B,te=J?1/J:0,ne=J?Math.acos(w*B)*Math.sqrt(1/J):0,_e=.5*(2*ne*w*V+2*s/Math.PI)-e,de=.5*(ne*A+a)-i,xe=.5*te*(D*H+ne*w*B*I)+1/Math.PI,Ce=te*(W*k/4-ne*A*V),Ae=.125*te*(k*V-ne*A*D*W),He=.5*te*(I*B+ne*H*w)+.5,Oe=Ce*Ae-He*xe;g=(de*Ce-_e*He)/Oe,b=(_e*Ae-de*xe)/Oe,s=X(s-g,-Math.PI,Math.PI),a=X(a-b,-ZS,ZS)}while((Math.abs(g)>p||Math.abs(b)>p)&&--u>0);return new F(bn(s),bn(a))}}class $S extends Lu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Bi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:s,cosPhi:a}=this;return{x:Bi(e)*a*s+.5,y:-Math.sin(Bi(i))/a*s+.5,z:0}}unproject(e,i){let{scale:s,cosPhi:a}=this,u=-(i-.5)/s,p=X(bn((e-.5)/s)/a,-180,180),g=Math.asin(X(u*a,-1,1)),b=X(bn(g),-ae,ae);return new F(p,b)}}class QD extends GS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){let a=Af(e,i,s);return Wr(a,a,zg(Ql(s))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i,s){let a=E(i.lat,i.lng),u=Er([],a),p=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;nn(a,a,u,ee(1,0)*ht*p);let g=Re(new Float64Array(16));return yt(g,e.pixelMatrix,e.globeMatrix),Wr(a,a,g),new st(a[0],a[1])}pixelsPerMeter(e,i){return ee(1,0)*i}pixelSpaceConversion(e,i,s){let a=ee(1,e)*i,u=$t(ee(1,45)*i,a,s);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,s){let a=vv(Ql(s.canonical));return yt(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){let{center:s}=e,a=zg(Ql(i));return pi(a,a,Bi(s.lng)),ai(a,a,Bi(s.lat)),St(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,s,a){return y1(e,i,s,!0)||new ze(0,0)}pointCoordinate3D(e,i,s){let a=this.pointCoordinate(e,i,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!y1(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=(function(a,u){let p=a.cameraToCenterDistance,g=a._centerAltitude*u,b=a._camera,w=a._camera.forward(),A=oi([],er([],w,-p),[0,0,g]),k=a.worldSize/(2*Math.PI),I=[0,0,-k],D=a.width/a.height,B=Math.tan(a.fovAboveCenter),V=er([],b.up(),B),W=er([],b.right(),B*D),H=Er([],oi([],oi([],w,V),W)),J=[],te;if(new yi(A,H).closestPointOnSphere(I,k,J)){let ne=oi([],J,I),_e=on([],ne,A);te=Math.cos(a.fovAboveCenter)*kr(_e)}else{let ne=on([],A,I),_e=on([],I,A);Er(_e,_e);let de=kr(ne)-k;te=Math.sqrt(de*(de+2*k));let xe=Math.acos(te/(k+de))-Math.acos(_n(w,_e));te*=Math.cos(xe)}return 1.01*te})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Au(e.zoom);if(s>0){let a=qS(e,ee(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $t(i,a+u*(1-Math.cos(p)),Math.pow(s,10))}return i}upVector(e,i,s){return Af(i,s,e,1)}upVectorScale(e){return{metersToTile:Ig(Lg(Ql(e)))}}}function XS(r){let e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new GS(r);case"equirectangular":return new XD(r);case"naturalEarth":return new KD(r);case"equalEarth":return new $D(r);case"winkelTripel":return new JD(r);case"albers":return i?new $S(r):new ZD(r);case"lambertConformalConic":return i?new $S(r):new YD(r);case"globe":return new QD(r)}throw new Error(`Invalid projection name: ${r.name}`)}let eB=nt.types,tB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rm(r,e,i,s,a,u,p,g,b,w,A,k,I){let D=g?Math.min(Nc,Math.round(g[0])):0,B=g?Math.min(Nc,Math.round(g[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*a),u,p,(D<<1)+(b?1:0),0+(B<<1),16*w,16*A,256*k,256*I)}function nm(r,e,i){r.emplaceBack(e,i)}function om(r,e,i,s,a,u,p){r.emplaceBack(e,i,s,a,u,p)}let c_=(r,e,i,s)=>{for(let a=0;a<e;a++)r.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function Zh(r,e,i,s,a){r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a)}function iB(r){for(let e of r.sections)if(iv(e.text))return!0;return!1}class fx{constructor(e){this.layoutVertexArray=new bh,this.indexArray=new Yr,this.programConfigurations=e,this.segments=new tn,this.dynamicLayoutVertexArray=new Kl,this.opacityVertexArray=new df,this.placedSymbolArray=new gd,this.iconTransitioningVertexArray=new Js,this.globeExtVertexArray=new yu,this.zOffsetVertexArray=new hl,this.orientationVertexArray=new ff,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){let s=[],a=this.layoutVertexArray.uint16;for(let u=0;u<i;++u){let p=12*(e+u);s.push(...a.slice(p,p+12))}return s}updateIconVertexData(e,i,s,a,u,p,g,b,w,A,k,I,D){let B=this.layoutVertexArray.uint16,V=12*e;B[V]=i,B[V+1]=s,B[V+2]=a,B[V+3]=u,B[V+4]=p,B[V+5]=g,B[V+6]=b,B[V+7]=w,B[V+8]=A,B[V+9]=k,B[V+10]=I,B[V+11]=D}upload(e,i,s,a,u,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sD.members,!!p),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,lD.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,tB,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,dD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,aD.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,cD.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,uD.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ot(fx,"SymbolBuffers");class mx{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new tn,this.collisionVertexArray=new xu,this.collisionVertexArrayExt=new Kl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hD.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot(mx,"CollisionBuffers");class u_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Re([]),this.placementViewportMatrix=Re([]);let i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Uh(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Uh(this.zoom,i["icon-size"],this.worldview);let s=this.layers[0].layout,a=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map((p=>Rs[p])),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){let i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((s=>s.getProperty(e)!=null))}createArrays(){this.text=new fx(new ya(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new fx(new ya(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new bf,this.lineVertexArray=new vg,this.symbolInstances=new yg}calculateGlyphDependencies(e,i,s,a,u){for(let p of e){let g=p.codePointAt(0);if(g===void 0)break;if(i[g]=!0,a&&u&&g<=65535){let b=Hf[p];b&&(i[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,a,u,p){let g=1,b=e.getUnevaluatedProperties()._values["icon-size"],w=Uh(this.zoom,b,this.worldview),A=qh(w,i);if(w.kind!=="constant"&&w.kind!=="camera"||(g=A.uSize),w.kind==="composite"){let{minZoom:k,maxZoom:I}=w,D=b.possiblyEvaluate(new Rr(k,{worldview:this.worldview}),a),B=b.possiblyEvaluate(new Rr(I,{worldview:this.worldview}),a),V=D.evaluate(s,{},a,u);g=V+(B.evaluate(s,{},a,u)-V)*A.uSizeT}return w.kind==="source"&&(g=b.possiblyEvaluate(new Rr(this.zoom,{worldview:this.worldview}),a).evaluate(s,{},a,u)),g*p}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Fg(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Io.build(e):e}populate(e,i,s,a){let u=this.layers[0],p=u.layout,g=this.projection.name==="globe",b=p.get("text-font"),w=p.get("text-field"),A=p.get("icon-image"),[k,I]=p.get("icon-size-scale-range"),D=X(i.scaleFactor||1,k,I),B=(w.value.kind!=="constant"||w.value.value instanceof jn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),V=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,W=this.hasAnyAppearanceProperty("icon-image"),H=p.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!B&&!V&&!W)return;let J=i.iconDependencies,te=i.glyphDependencies,ne=i.availableImages,_e=new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),de=xe=>{let Ce=xe.id.toString();J.has(Ce)?J.get(Ce).push(xe):J.set(Ce,[xe])};for(let xe of e){let{feature:Ce,id:Ae,index:He,sourceLayerIndex:Oe}=xe,Ze=u._featureFilter.needGeometry,Je=Ne(Ce,Ze);if(!u._featureFilter.filter(_e,Je,s))continue;if(Ze||(Je.geometry=Ke(Ce,s,a)),g&&Ce.type!==1&&s.z<=5){let at=Je.geometry,mt=.98078528056,et=(Mt,Bt)=>_n(Af(Mt.x,Mt.y,s,1),Af(Bt.x,Bt.y,s,1))<mt;for(let Mt=0;Mt<at.length;Mt++)at[Mt]=Ye(at[Mt],et)}let it,_t;if(B){let at=u.getValueAndResolveTokens("text-field",Je,s,ne),mt=jn.factory(at);iB(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||tf()==="unavailable"||this.hasRTLText&&cs.isParsed())&&(it=mD(mt,u,Je))}if(V){let at=u.getValueAndResolveTokens("icon-image",Je,s,ne);_t=this.getResolvedImageFromTokens(at)}let ct=this.layers[0],Qe=!1;if(!_t&&W){let at=ct.getAppearances();for(let mt of at)if(mt.getProperty("icon-image")){let et=ct.getAppearanceValueAndResolveTokens(mt,"icon-image",Je,s,ne);if(et){_t=this.getResolvedImageFromTokens(et),Qe=!0;break}}}if(!it&&!_t)continue;let lt=this.sortFeaturesByKey?H.evaluate(Je,{},s):void 0,We={id:Ae,text:it,icon:_t,index:He,sourceLayerIndex:Oe,geometry:Je.geometry,properties:Ce.properties,type:eB[Ce.type],sortKey:lt};if(this.features.push(We),this.appearanceFeatureData.push({id:Ae,properties:Ce.properties,usesAppearanceIconAsPlaceholder:Qe,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),_t){let at=ct._unevaluatedLayout._values,{iconPrimary:mt,iconSecondary:et}=Yf(_t,this.iconSizeData,at["icon-size"],s,this.zoom,We,this.pixelRatio,D,this.worldview);de(mt),et&&(this.hasAnySecondaryIcon=!0,de(et))}let Ue=ct.getAppearances();if(Ue.length!==0&&Ue.forEach((at=>{if(!at.getProperty("icon-image"))return;let mt=this.getCombinedIconPrimary(at,ct,Je,s,ne,We,D);mt&&de(mt)})),it){let at=b.evaluate(Je,{},s).join(","),mt=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rs.vertical)>=0;for(let et of it.sections)if(et.image){let Mt=et.image.getPrimary().scaleSelf(this.pixelRatio),Bt=Mt.id.toString(),Pt=J.get(Bt)||[];Pt.push(Mt),J.set(Bt,Pt)}else{let Mt=Xp(it.toString()),Bt=et.fontStack||at,Pt=te[Bt]=te[Bt]||{};this.calculateGlyphDependencies(et.text,Pt,mt,this.allowVerticalPlacement,Mt)}}}if(p.get("symbol-placement")==="line"&&(this.features=(function(xe){let Ce={},Ae={},He=[],Oe=0;function Ze(ct){He.push(xe[ct]),Oe++}function Je(ct,Qe,lt){let We=Ae[ct];return delete Ae[ct],Ae[Qe]=We,He[We].geometry[0].pop(),He[We].geometry[0]=He[We].geometry[0].concat(lt[0]),We}function it(ct,Qe,lt){let We=Ce[Qe];return delete Ce[Qe],Ce[ct]=We,He[We].geometry[0].shift(),He[We].geometry[0]=lt[0].concat(He[We].geometry[0]),We}function _t(ct,Qe,lt){let We=lt?Qe[0][Qe[0].length-1]:Qe[0][0];return`${ct}:${We.x}:${We.y}`}for(let ct=0;ct<xe.length;ct++){let Qe=xe[ct],lt=Qe.geometry,We=Qe.text?Qe.text.toString():null;if(!We){Ze(ct);continue}let Ue=_t(We,lt),at=_t(We,lt,!0);if(Ue in Ae&&at in Ce&&Ae[Ue]!==Ce[at]){let mt=it(Ue,at,lt),et=Je(Ue,at,He[mt].geometry);delete Ce[Ue],delete Ae[at],Ae[_t(We,He[et].geometry,!0)]=et,He[mt].geometry=null}else Ue in Ae?Je(Ue,at,lt):at in Ce?it(Ue,at,lt):(Ze(ct),Ce[Ue]=Oe-1,Ae[at]=Oe-1)}return He.filter((ct=>ct.geometry))})(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(let xe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(xe.id,this.elevationFeatures.length),this.elevationFeatures.push(xe)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((xe,Ce)=>xe.sortKey-Ce.sortKey))}getCombinedIconPrimary(e,i,s,a,u,p,g){let b,w,A=e.getUnevaluatedProperties();if(A._values["icon-image"].value!==void 0){let k=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,a,u);b=this.getResolvedImageFromTokens(k)}else{let k=i.getValueAndResolveTokens("icon-image",s,a,u);b=this.getResolvedImageFromTokens(k)}if(b){let k=A._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];w=Yf(b,Uh(this.zoom,k,this.worldview),k,a,this.zoom,p,this.pixelRatio,g,this.worldview).iconPrimary}return w}updateAppearanceBasedIconTextures(e,i,s,a){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;let u=this.layers[0],p=!1,g=0,b=u.layout,[w,A]=b.get("icon-size-scale-range"),k=X(1,w,A);for(let I=0;I<this.symbolInstances.length;I++){let D=this.symbolInstances.get(I),B=this.appearanceFeatureData[D.featureIndex];if(B&&D.placedIconSymbolIndex>=0){let V=B.id,W=i&&V!==void 0?i[String(V)]:void 0,H={type:"Point",id:B.id,properties:B.properties,geometry:[]},J=this.layers[0].appearances&&this.layers[0].appearances.find((te=>te.isActive({globals:a,feature:H,canonical:e,featureState:W})));if(B.activeAppearance===J)continue;if(J){B.activeAppearance=J;let te={sortKey:void 0,text:void 0,icon:null,index:D.featureIndex,sourceLayerIndex:D.featureIndex,geometry:[],properties:B.properties,type:"Point",id:B.id};if(!J.hasCachedIconPrimary()){let xe=this.getCombinedIconPrimary(J,u,H,e,s,te,k);J.setCachedIconPrimary(xe)}let ne=J.getCachedIconPrimary();if(!ne)continue;let _e=ne.toString(),de=this.iconAtlasPositions&&this.iconAtlasPositions.get(_e);if(de){let xe=u.getAppearanceValueAndResolveTokens(J,"icon-offset",H,e,s),Ce=xe&&Array.isArray(xe)?xe:[0,0],Ae=e_(de,void 0,Ce,u.layout.get("icon-anchor").evaluate(H,{},e)),He=u.getAppearanceValueAndResolveTokens(J,"icon-rotate",H,e,s),Oe=typeof He=="number"?He:0,Ze=de.sdf,Je=u.layout.get("icon-text-fit").constantOr("none");Je!=="none"&&B.textShaping&&B.iconTextFitPadding&&B.fontScale&&(Ae=ox(Ae,B.textShaping,Je,B.iconTextFitPadding,Ce,B.fontScale));let it=this.calculateEffectiveAppearanceIconSize(J,a.zoom,H,e,s,k),_t=0,ct=1+(Math.min(Nc,Math.round(it*_l))<<1),Qe=cx(Ae,Oe,Ze,Je!=="none",k);B.isUsingAppearanceVertexData||(B.isUsingAppearanceVertexData=!0,B.layoutBasedVertexData=this.icon.getIconVertexData(g,D.numIconVertices));for(let We=0;We<Qe.length;++We){let Ue=Qe[We],at=B.layoutBasedVertexData[0]||D.tileAnchorX,mt=B.layoutBasedVertexData[1]||D.tileAnchorY,et=16*Ue.pixelOffsetTL.x,Mt=16*Ue.pixelOffsetTL.y,Bt=16*Ue.pixelOffsetBR.x,Pt=16*Ue.pixelOffsetBR.y,Ct=16*Ue.minFontScaleX,ui=16*Ue.minFontScaleY;this.icon.updateIconVertexData(g,at,mt,Math.round(32*Ue.tl.x),Math.round(32*Ue.tl.y),Ue.texPrimary.x,Ue.texPrimary.y,_t,ct,et,Mt,Ct,ui),this.icon.updateIconVertexData(g+1,at,mt,Math.round(32*Ue.tr.x),Math.round(32*Ue.tr.y),Ue.texPrimary.x+Ue.texPrimary.w,Ue.texPrimary.y,_t,ct,Bt,Mt,Ct,ui),this.icon.updateIconVertexData(g+2,at,mt,Math.round(32*Ue.bl.x),Math.round(32*Ue.bl.y),Ue.texPrimary.x,Ue.texPrimary.y+Ue.texPrimary.h,_t,ct,et,Pt,Ct,ui),this.icon.updateIconVertexData(g+3,at,mt,Math.round(32*Ue.br.x),Math.round(32*Ue.br.y),Ue.texPrimary.x+Ue.texPrimary.w,Ue.texPrimary.y+Ue.texPrimary.h,_t,ct,Bt,Pt,Ct,ui),g+=4}let lt=D.numIconVertices-4*Qe.length;for(let We=0;We<lt;++We)this.icon.updateIconVertexData(g+We,0,0,0,0,0,0,0,0,0,0,0,0);p=!0}else g+=D.numIconVertices}else if(B.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(g,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(g+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(g+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(g+3,0,0,0,0,0,0,0,0,0,0,0,0),p=!0),g+=D.numIconVertices,B.activeAppearance=null;else if(B.isUsingAppearanceVertexData){let ne=B.layoutBasedVertexData.length/12;for(let _e=0;_e<ne;++_e){let de=_e*12;this.icon.updateIconVertexData(g+_e,B.layoutBasedVertexData[de+0],B.layoutBasedVertexData[de+1],B.layoutBasedVertexData[de+2],B.layoutBasedVertexData[de+3],B.layoutBasedVertexData[de+4],B.layoutBasedVertexData[de+5],B.layoutBasedVertexData[de+6],B.layoutBasedVertexData[de+7],B.layoutBasedVertexData[de+8],B.layoutBasedVertexData[de+9],B.layoutBasedVertexData[de+10],B.layoutBasedVertexData[de+11])}g+=ne,B.isUsingAppearanceVertexData=!1,B.activeAppearance=null,p=!0}else g+=D.numIconVertices,B.activeAppearance=null}}return p}update(e,i,s,a,u,p,g){this.text.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,u,s,a,p,g,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1,s=ve(e),a=1/s,u=!1,p=!1;for(let g=0;g<this.symbolInstances.length;g++){let b=this.symbolInstances.get(g),w=Si(1,0,0),A=Si(0,1,0),{numHorizontalGlyphVertices:k,numVerticalGlyphVertices:I,numIconVertices:D,numVerticalIconVertices:B}=b,V=k>0||I>0,W=D>0,H=this.elevationFeatures[b.elevationFeatureIndex];if(H){let J=new st(b.tileAnchorX,b.tileAnchorY),te=.075+H.pointElevation(J);b.zOffset!==te&&(i=!0,b.zOffset=te),te!==0&&(this.hasAnyZOffset=!0);let ne=H.computeSlopeNormal(J,a),_e=Xa(Ea(),Si(0,0,1),ne);zo(w,w,_e),zo(A,A,_e),w[2]*=s,A[2]*=s,w[0]===1&&w[1]===0&&w[2]===0&&A[0]===0&&A[1]===1&&A[2]===0||(u=u||V,p=p||W)}if(V&&(c_(this.text.orientationVertexArray,k,w,A),c_(this.text.orientationVertexArray,I,w,A)),W){let{placedIconSymbolIndex:J,verticalPlacedIconSymbolIndex:te}=b;J>=0&&c_(this.icon.orientationVertexArray,D,w,A),te>=0&&c_(this.icon.orientationVertexArray,B,w,A)}}u||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let e=(u,p,g)=>{s+=p,s>u.length&&u.resize(s);for(let b=-p;b<0;b++)u.emplace(b+s,g)},i=(u,p,g)=>{a+=p,a>u.length&&u.resize(a);for(let b=-p;b<0;b++)u.emplace(b+a,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){let p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:b,numIconVertices:w}=p,A=p.zOffset,k=w>0;if((g>0||b>0)&&(e(this.text.zOffsetVertexArray,g,A),e(this.text.zOffsetVertexArray,b,A)),k){let{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:D}=p;I>=0&&i(this.icon.zOffsetVertexArray,w,A),D>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,a,u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((p=>p.appearances&&p.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,a){return!!(e&&i&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,s,a)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=XS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let s=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:a,y:u}of i)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,a,u,p,g,b,w,A,k,I,D,B,V,W,H,J){let te=e.indexArray,ne=e.layoutVertexArray,_e=e.globeExtVertexArray,de=e.segments.prepareSegment(4*J,ne,te,this.canOverlap?p.sortKey:void 0),xe=this.glyphOffsetArray.length,Ce=de.vertexLength,Ae=this.allowVerticalPlacement&&g===Rs.vertical?Math.PI/2:0,He=p.text&&p.text.sections;for(let Je=0;Je<i.length;Je++){let{tl:it,tr:_t,bl:ct,br:Qe,texPrimary:lt,texSecondary:We,pixelOffsetTL:Ue,pixelOffsetBR:at,minFontScaleX:mt,minFontScaleY:et,glyphOffset:Mt,isSDF:Bt,sectionIndex:Pt}=i[Je],Ct=de.vertexLength,ui=Mt[1];if(rm(ne,w.x,w.y,it.x,ui+it.y,lt.x,lt.y,s,Bt,Ue.x,Ue.y,mt,et),rm(ne,w.x,w.y,_t.x,ui+_t.y,lt.x+lt.w,lt.y,s,Bt,at.x,Ue.y,mt,et),rm(ne,w.x,w.y,ct.x,ui+ct.y,lt.x,lt.y+lt.h,s,Bt,Ue.x,at.y,mt,et),rm(ne,w.x,w.y,Qe.x,ui+Qe.y,lt.x+lt.w,lt.y+lt.h,s,Bt,at.x,at.y,mt,et),b){let{x:At,y:Ht,z:di}=b.anchor,[Ti,Xi,mi]=b.up;om(_e,At,Ht,di,Ti,Xi,mi),om(_e,At,Ht,di,Ti,Xi,mi),om(_e,At,Ht,di,Ti,Xi,mi),om(_e,At,Ht,di,Ti,Xi,mi),Zh(e.dynamicLayoutVertexArray,At,Ht,di,Ae)}else Zh(e.dynamicLayoutVertexArray,w.x,w.y,w.z,Ae);if(W){let At=We||lt;nm(e.iconTransitioningVertexArray,At.x,At.y),nm(e.iconTransitioningVertexArray,At.x+At.w,At.y),nm(e.iconTransitioningVertexArray,At.x,At.y+At.h),nm(e.iconTransitioningVertexArray,At.x+At.w,At.y+At.h)}te.emplaceBack(Ct,Ct+1,Ct+2),te.emplaceBack(Ct+1,Ct+2,Ct+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),Je!==i.length-1&&Pt===i[Je+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,p,p.index,{},D,B,V,He&&He[Pt],this.worldview)}let Oe=J-i.length;Oe!==0&&this._addNullVertices(Oe,ne,s,b,_e,e,W,de,te);let Ze=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,w.x,w.y,xe,this.glyphOffsetArray.length-xe,Ce,A,k,w.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],g,0,0,0,I,0),e.symbolInstanceIndices.push(H)}_addNullVertices(e,i,s,a,u,p,g,b,w){for(let A=0;A<e;A++){for(let I=0;I<4;I++)rm(i,0,0,0,0,0,0,s,!1,0,0,0,0),a&&om(u,0,0,0,0,0,0),Zh(p.dynamicLayoutVertexArray,0,0,0,0),g&&nm(p.iconTransitioningVertexArray,0,0);let k=b.vertexLength;w.emplaceBack(k,k+1,k+2),w.emplaceBack(k+1,k+2,k+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,a,u,p,g){e.emplaceBack(i,s,a,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,s,a,u,p,g){let b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,A=g.tileAnchorX,k=g.tileAnchorY;for(let D=0;D<4;D++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,u,p,A,k,new st(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,p,A,k,new st(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,p,A,k,new st(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,u,p,A,k,new st(e.x1,e.y2)),b.vertexLength+=4;let I=s.indexArray;I.emplaceBack(w,w+1),I.emplaceBack(w+1,w+2),I.emplaceBack(w+2,w+3),I.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,a,u,p){for(let g=a;g<u;g++){let b=s.get(g),w=this.getSymbolInstanceTextSize(e,p,i,g);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,s,a,u,p){for(let g=a;g<u;g++){let b=s.get(g),w=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mx(wh,hS.members,Js),this.iconCollisionBox=new mx(wh,hS.members,Js);let a=qh(this.iconSizeData,e),u=qh(this.textSizeData,e,s);for(let p=0;p<this.symbolInstances.length;p++){let g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,s,a){let u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),p=sx(this.textSizeData,e,u)/to;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,s){let a=this.icon.placedSymbolArray.get(s),u=sx(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,s,a){e.emplaceBack(i,-s,-s,a),e.emplaceBack(i,s,-s,a),e.emplaceBack(i,s,s,a),e.emplaceBack(i,-s,s,a)}_updateTextDebugCollisionBoxes(e,i,s,a,u,p,g){for(let b=a;b<u;b++){let w=s.get(b),A=this.getSymbolInstanceTextSize(e,p,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,w.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,a,u,p,g){for(let b=a;b<u;b++){let w=s.get(b),A=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,w.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,s,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=qh(this.iconSizeData,e,a),p=qh(this.textSizeData,e,s);for(let g=0;g<this.symbolInstances.length;g++){let b=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,e,i,b.textBoxStartIndex,b.textBoxEndIndex,b,s),this._updateTextDebugCollisionBoxes(p,e,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,s),this._updateIconDebugCollisionBoxes(u,e,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b,a),this._updateIconDebugCollisionBoxes(u,e,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,a,u,p,g,b,w){let A={};if(i<s){let{x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne,featureIndex:_e}=e.get(i);A.textBox={x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne},A.textFeatureIndex=_e}if(a<u){let{x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne,featureIndex:_e}=e.get(a);A.verticalTextBox={x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne},A.verticalTextFeatureIndex=_e}if(p<g){let{x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne,featureIndex:_e}=e.get(p);A.iconBox={x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne},A.iconFeatureIndex=_e}if(b<w){let{x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne,featureIndex:_e}=e.get(b);A.verticalIconBox={x1:k,y1:I,x2:D,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ne},A.verticalIconFeatureIndex=_e}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let s=e.placedSymbolArray.get(i),a=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),s=Math.cos(e),a=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);let b=this.symbolInstances.get(g);a.push(0|Math.round(i*b.tileAnchorX+s*b.tileAnchorY)),u.push(b.featureIndex)}return p.sort(((g,b)=>a[g]-a[b]||u[b]-u[g])),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){let s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);let{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==a&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){let i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex,s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function YS(r,e){return e.replace(/{([^{}]+)}/g,((i,s)=>s in r?String(r[s]):""))}let KS,JS,gx;Ot(u_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),u_.addDynamicAttributes=Zh;class QS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:tl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(QS,"FormatSectionOverride",{omit:["defaultValue"]});let _x=()=>gx||(gx={layout:KS||(KS=new hn({"symbol-placement":new pt(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(Me.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pt(Me.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new pt(Me.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new pt(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pt(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Me.layout_symbol["icon-size"]),"icon-size-scale-range":new pt(Me.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Me.layout_symbol["icon-image"]),"icon-image-use-theme":new pt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new kt(Me.layout_symbol["icon-rotate"]),"icon-padding":new pt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Me.layout_symbol["icon-offset"]),"icon-anchor":new kt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(Me.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Me.layout_symbol["text-field"]),"text-font":new kt(Me.layout_symbol["text-font"]),"text-size":new kt(Me.layout_symbol["text-size"]),"text-size-scale-range":new pt(Me.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Me.layout_symbol["text-max-width"]),"text-line-height":new kt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Me.layout_symbol["text-justify"]),"text-radial-offset":new kt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Me.layout_symbol["text-anchor"]),"text-max-angle":new pt(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(Me.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Me.layout_symbol["text-rotate"]),"text-padding":new pt(Me.layout_symbol["text-padding"]),"text-keep-upright":new pt(Me.layout_symbol["text-keep-upright"]),"text-transform":new kt(Me.layout_symbol["text-transform"]),"text-offset":new kt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new pt(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pt(Me.layout_symbol["text-ignore-placement"]),"text-optional":new pt(Me.layout_symbol["text-optional"]),visibility:new pt(Me.layout_symbol.visibility)})),paint:JS||(JS=new hn({"icon-opacity":new kt(Me.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Me.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Me.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Me.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Me.paint_symbol["icon-color"]),"icon-halo-color":new kt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(Me.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pt(Me.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Me.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Me.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Me.paint_symbol["text-color"],{runtimeType:xo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new kt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Me.paint_symbol["text-halo-blur"]),"text-translate":new pt(Me.paint_symbol["text-translate"]),"text-translate-anchor":new pt(Me.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pt(Me.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pt(Me.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pt(Me.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pt(Me.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Me.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},gx);class d_ extends Lo{constructor(e,i,s,a){super(e,_x(),i,s,a,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Re([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((a=>{a.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let s=this.layout.get("text-writing-mode");if(s){let a=[];for(let u of s)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===a||(this._colorAdjustmentMatrix=(function(u,p,g,b){u=Br(u),p=Ii(p);let w=oe(),A=u/3,k=1-2*A,I=[k,A,A,0,A,k,A,0,A,A,k,0,0,0,0,1],D=.5-.5*p,B=b-g;return yt(w,[B,0,0,0,0,B,0,0,0,0,B,0,g,g,g,1],[p,0,0,0,0,p,0,0,0,0,p,0,D,D,D,1]),yt(w,w,I),w})(e,i,s,a),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,a){let u=this.layout.get(e).evaluate(i,{},s,a),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ch(p.value)||!u?u:YS(i.properties,u)}getAppearanceValueAndResolveTokens(e,i,s,a,u){let p=e.getProperty(i);if(!p)return;let g=p.evaluate(s,{},a,u),b=e.getUnevaluatedProperties()._values[i];return b.isDataDriven()||ch(b.value)||!g||typeof g!="string"?g:YS(s.properties,g)}createBucket(e){return new u_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of _x().paint.overridableProperties){if(!d_.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),s=new QS(i),a=new lh(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme")),u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new ud("source",a):new Hl("composite",a,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ks(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&d_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let s=e.get("text-field"),a=_x().paint.properties[i],u=!1,p=g=>{for(let b of g)if(a.overrides&&a.overrides.hasOverride(b))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof jn)p(s.value.value.sections);else if(s.value.kind==="source"){let g=w=>{u||(w instanceof pa&&On(w.value)===Gs?p(w.value.sections):w instanceof Oa?p(w.sections):w.eachChild(g))},b=s.value;b._styleExpression&&g(b._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new fl(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let eT,tT,iT,rT;var yx=Li([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function h_(r,e,i,s,a,u,p,g){let b=[r,e,1,i,s,1,a,u,1],w=[p,g,1],A=me([],b),[k,I,D]=Ta(w,w,A);return be(b,b,[k,0,0,0,I,0,0,0,D])}function nT(r,e,i,s,a,u,p,g){let b=(function(w,A,k,I,D,B,V,W){let H=h_(0,0,1,0,1,1,0,1),J=h_(w,A,k,I,D,B,V,W);return be(J,J,me([],H))})(r,e,i,s,a,u,p,g);return[b[2]/b[8]/ht,b[5]/b[8]/ht]}function p_(r){return[r[0],Math.min(Math.max(r[1],-ae),ae)]}class oT extends ha{constructor(e,i,s,a){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new so("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Kc(this.map._requestManager.transformRequest(this.url,ua.Image),((s,a)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Ll(s)):a&&(this.image=a instanceof HTMLImageElement?Zr.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new qf(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new so("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof qf||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(let u of e)u[1]>s&&(s=u[1]),u[1]<i&&(i=u[1]);let a=(s+i)/2;if(a>ae?this.onNorthPole=!0:a<-ae&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(ze.fromLngLat);this.tileID=(function(p){let g=1/0,b=1/0,w=-1/0,A=-1/0;for(let V of p)g=Math.min(g,V.x),b=Math.min(b,V.y),w=Math.max(w,V.x),A=Math.max(A,V.y);let k=Math.max(w-g,A-b),I=Math.max(0,Math.floor(-Math.log2(k))),D=Math.pow(2,I),B=Math.floor((g+w)/2*D);return B>1&&(B-=1),new zs(I,B,Math.floor((b+A)/2*D))})(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new so("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof qf||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let H in this.tiles){let J=this.tiles[H];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=Jf(new zs(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(H){let J=H[1].x-H[0].x,te=H[1].y-H[0].y,ne=H[2].x-H[1].x,_e=H[2].y-H[1].y,de=H[3].x-H[2].x,xe=H[3].y-H[2].y,Ce=H[0].x-H[3].x,Ae=H[0].y-H[3].y,He=J*_e-ne*te,Oe=ne*xe-de*_e,Ze=de*Ae-Ce*xe,Je=Ce*te-J*Ae;return He>0&&Oe>0&&Ze>0&&Je>0||He<0&&Oe<0&&Ze<0&&Je<0})(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let a=Jf(this.tileID,this.map.transform.projection),[u,p,g,b]=this.coordinates.map((H=>{let J=a.projection.project(H[0],H[1]);return WS(a,J)._round()}));this.perspectiveTransform=nT(u.x,u.y,p.x,p.y,g.x,g.y,b.x,b.y);let w=this._boundsArray=new _u;w.emplaceBack(u.x,u.y,0,0),w.emplaceBack(p.x,p.y,ht,0),w.emplaceBack(b.x,b.y,0,ht),w.emplaceBack(g.x,g.y,ht,ht),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,yx.members),this.boundsSegments=tn.simpleSegment(0,0,4,2);let A=[],k=[p_((I=this.coordinates)[0]),p_(I[1]),p_(I[2]),p_(I[3])];var I;let[D,B,V,W]=(function(H){let J=H[0][0],te=J,ne=H[0][1],_e=ne;for(let de=1;de<H.length;de++)H[de][0]<J?J=H[de][0]:H[de][0]>te&&(te=H[de][0]),H[de][1]<ne?ne=H[de][1]:H[de][1]>_e&&(_e=H[de][1]);return[J,ne,te-J,_e-ne]})(k);{let H=new _u,[J,te,ne,_e]=(function(Qe){let lt=Qe[0].x,We=lt,Ue=Qe[0].y,at=Ue;for(let mt=1;mt<Qe.length;mt++)Qe[mt].x<lt?lt=Qe[mt].x:Qe[mt].x>We&&(We=Qe[mt].x),Qe[mt].y<Ue?Ue=Qe[mt].y:Qe[mt].y>at&&(at=Qe[mt].y);return[lt,Ue,We-lt,at-Ue]})(s),de=Qe=>[(Qe.x-J)/ne,(Qe.y-te)/_e],[xe,Ce,Ae,He]=s.map(de),Oe=(function(Qe,lt,We,Ue,at,mt,et,Mt){let Bt=h_(0,0,1,0,1,1,0,1);return be(Bt,Bt,me([],h_(Qe,lt,We,Ue,at,mt,et,Mt)))})(xe[0],xe[1],Ce[0],Ce[1],Ae[0],Ae[1],He[0],He[1]);this.elevatedGlobePerspectiveTransform=nT(xe[0],xe[1],Ce[0],Ce[1],Ae[0],Ae[1],He[0],He[1]);let Ze=(Qe,lt)=>{A.push(Qe.lng);let We=Math.round((Qe.lng-D)/V*ht),Ue=Math.round((Qe.lat-B)/W*ht),at=de(lt),mt=Ta([],[at[0],at[1],1],Oe),et=Math.round(mt[0]/mt[2]*ht),Mt=Math.round(mt[1]/mt[2]*ht);H.emplaceBack(We,Ue,et,Mt)},Je=s[3].x-s[0].x,it=s[3].y-s[0].y,_t=s[2].x-s[1].x,ct=s[2].y-s[1].y;for(let Qe=0;Qe<65;Qe++){let lt=Qe/64,We=[s[0].x+lt*Je,s[0].y+lt*it],Ue=[s[1].x+lt*_t,s[1].y+lt*ct],at=Ue[0]-We[0],mt=Ue[1]-We[1];for(let et=0;et<65;et++){let Mt=et/64,Bt={x:We[0]+at*Mt,y:We[1]+mt*Mt};Ze(i.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(H,yx.members)}{this.maxLongitudeTriangleSize=0;let H=[],J=new Yr,te=(ne,_e,de)=>{J.emplaceBack(ne,_e,de);let xe=A[ne],Ce=A[_e],Ae=A[de],He=Math.min(Math.min(xe,Ce),Ae),Oe=Math.max(Math.max(xe,Ce),Ae)-He;Oe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Oe),H.push(He+Oe/2)};for(let ne=0;ne<64;ne++)for(let _e=0;_e<64;_e++){let de=65*ne+_e,xe=de+1,Ce=de+65,Ae=Ce+1;te(de,Ce,xe),te(xe,Ce,Ae)}[H,J]=(function(ne,_e){let de=Array.from({length:ne.length},((Ae,He)=>He));de.sort(((Ae,He)=>ne[Ae]-ne[He]));let xe=[],Ce=new Yr;for(let Ae=0;Ae<de.length;Ae++){let He=de[Ae];xe.push(ne[He]);let Oe=3*He,Ze=Oe+1;Ce.emplaceBack(_e.uint16[Oe],_e.uint16[Ze],_e.uint16[Ze+1])}return[xe,Ce]})(H,J),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(J)}this.elevatedGlobeSegments=tn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,V/ht,0,W/ht,0,0,B,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof qf||(this.texture?this.texture.update(this.image):(this.texture=new Wv(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let s=this.elevatedGlobeTrianglesCenterLongitudes,a=(u=e+180)+360*Math.round((s[0]-u)/360);var u;let p=new tn,g=(k,I)=>{p.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-a)<=b){let k=Kt(s,0,s.length,a+b);return k===s.length||g(k,Ki(s,k+1,s.length,a+360-b)-k),p}a<s[0]&&(a+=360);let w=Ki(s,0,s.length,a-b);if(w===s.length)return g(0,s.length),p;g(0,w-0);let A=Kt(s,w+1,s.length,a+b);return A!==s.length&&g(A,s.length-A),p}}let rB=(Math.pow(256,2)-1)/16907520;class sT extends Lo{constructor(e,i,s,a){super(e,{layout:iT||(iT=new hn({visibility:new pt(Me.layout_raster.visibility)})),paint:rT||(rT=new hn({"raster-opacity":new pt(Me.paint_raster["raster-opacity"]),"raster-color":new hu(Me.paint_raster["raster-color"]),"raster-color-mix":new pt(Me.paint_raster["raster-color-mix"]),"raster-color-range":new pt(Me.paint_raster["raster-color-range"]),"raster-hue-rotate":new pt(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(Me.paint_raster["raster-saturation"]),"raster-contrast":new pt(Me.paint_raster["raster-contrast"]),"raster-resampling":new pt(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(Me.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pt(Me.paint_raster["raster-emissive-strength"]),"raster-array-band":new pt(Me.paint_raster["raster-array-band"]),"raster-elevation":new pt(Me.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof oT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[s,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(a)||s===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=kf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,a])}}let aT,lT,cT,uT,dT;class hT extends Lo{constructor(e,i,s,a){super(e,{layout:aT||(aT=new hn({visibility:new pt(Me["layout_raster-particle"].visibility)})),paint:lT||(lT=new hn({"raster-particle-array-band":new pt(Me["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pt(Me["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new hu(Me["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pt(Me["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pt(Me["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pt(Me["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pt(Me["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new pt(Me["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this._updateColorRamp(),this.lastInvalidatedAt=Zr.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Zr.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class nB extends Lo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function vx(r,e,i){let s=[0,0,1],a=ts([]);return Aa(a,a,i?-Bi(r)+Math.PI:Bi(r)),Us(a,a,-Bi(e)),zo(s,s,a),Er(s,s)}let pT={None:0,Model:1,Symbol:2,FillExtrusion:4};class f_{constructor(e,i,s,a){this.message=(e?`${e}: `:"")+s,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function xx(r,e){let i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class fT{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mT{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Th,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){let i=16*e,s=this.instancedDataArray.float32,a=Math.floor(s[i+2]),u=1.05*(s[i+2]-a);return a/=100,[s[i]%1*1.05,s[i+1]%1*1.05,u,a]}tileCoordinatesForInstance(e){let i=16*e,s=this.instancedDataArray.float32,a=s[i+0];return a=a>ht?a-ht:a,new st(Math.trunc(a),Math.trunc(s[i+1]))}translationForInstance(e){let i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){let i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){let i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class bx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.tileToMeter=ve(s);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:g,index:b,sourceLayerIndex:w}of e){let A=g??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),k=Ne(p,u);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,s))continue;let I={id:A,sourceLayerIndex:w,index:b,geometry:u?k.geometry:Ke(p,s,a),properties:p.properties,type:p.type,patterns:{}},D=this.addFeature(I,I.geometry,k);D&&i.featureIndex.insert(p,I.geometry,b,w,this.index,this.instancesPerModel[D].instancedDataArray.length,ht/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){let e=this.layers[0].modelManager,i=this.layers[0].scope,s=0;for(let a of this.modelUris){let u=e.getModel(a,i);if(!u)continue;let p=this.instancesPerModel[a];if(p){let g=.5*Kr(u.aabb.max,u.aabb.min)*p.maxScale+p.maxXYTranslationDistance,b=Math.min(ht,Math.max(g/this.tileToMeter,ht/32));s=Math.max(b,s)}}return s}update(e,i,s,a){for(let u in this.instancesPerModel){let p=this.instancesPerModel[u];for(let g in e)p.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(p.features[p.idToFeaturesIndex[g]],e[g],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let s=this.instancesPerModel[i];for(let a of s.features){let u=this.layers[0],p=a.feature,g=this.canonical,b=u.paint.get("model-rotation").evaluate(p,{},g),w=u.paint.get("model-scale").evaluate(p,{},g),A=u.paint.get("model-translation").evaluate(p,{},g);es(a.rotation,b)&&es(a.scale,w)&&es(a.translation,A)||(this.evaluate(a,a.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Fg(this.activeReplacements,u))return!1;this.activeReplacements=u;let p=!1;for(let g in this.instancesPerModel){let b=this.instancesPerModel[g],w=b.instancedDataArray;for(let A of b.features){let k=A.instancedDataOffset,I=A.instancedDataCount;for(let D=0;D<I;D++){let B=16*(D+k),V=w.float32[B+0],W=V>ht;V=W?V-ht:V;let H=Math.floor(V),J=Math.floor(w.float32[B+1]),te=!1;for(let ne of this.activeReplacements)if(!ew(ne,s,pT.Model,a)&&!(ne.min.x>H||H>ne.max.x||ne.min.y>J||J>ne.max.y)&&(te=zv(nw(H,J,e.canonical,ne.footprintTileId.canonical),ne.footprint),te))break;w.float32[B]=te?V+ht:V,p=p||te!==W}}}return p}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,LR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let i in this.instancesPerModel){let s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(let i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,s){let a=this.layers[0],u=a.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return Zt(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;(xx(u,!1)||this.styleDefinedModelURLs[u]!==void 0)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new mT);let p=this.instancesPerModel[u],g=p.instancedDataArray,b=new fT(s,g.length);for(let w of i)for(let A of w){if(A.x<0||A.x>=ht||A.y<0||A.y>=ht)continue;if(this.lookupDim!==0){let I=(this.lookupDim-1)/ht,D=this.lookupDim*(A.y*I|0)+A.x*I|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}}this.instanceCount++;let k=g.length;g.resize(k+1),p.instancesEvaluatedElevation.push(0),g.float32[16*k]=A.x,g.float32[16*k+1]=A.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),u}getModelUris(){return this.modelUris}evaluate(e,i,s,a){let u=this.layers[0],p=e.feature,g=this.canonical,b=e.rotation=u.paint.get("model-rotation").evaluate(p,i,g),w=e.scale=u.paint.get("model-scale").evaluate(p,i,g),A=e.translation=u.paint.get("model-translation").evaluate(p,i,g),k=Object.assign({},u.paint.get("model-color").evaluate(p,i,g));k.a=u.paint.get("model-color-mix-intensity").evaluate(p,i,g);let I=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]);let D=A[0]*A[0]+A[1]*A[1],B=D>0?Math.sqrt(D):0;s.maxScale=Math.max(Math.max(s.maxScale,w[0]),Math.max(w[1],w[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,B),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),Ww(I,b,w);let V=Math.round(100*k.a)+k.b/1.05;for(let W=0;W<e.instancedDataCount;++W){let H=e.instancedDataOffset+W,J=16*H,te=s.instancedDataArray.float32,ne=0;a&&(ne=te[J+6]-s.instancesEvaluatedElevation[H]);let _e=0|te[J+1];te[J]=(0|te[J])+k.r/1.05,te[J+1]=_e+k.g/1.05,te[J+2]=V,te[J+3]=1/(g.z>10?this.tileToMeter:ve(g,_e)),te[J+4]=A[0],te[J+5]=A[1],te[J+6]=A[2]+ne,te[J+7]=I[0],te[J+8]=I[1],te[J+9]=I[2],te[J+10]=I[4],te[J+11]=I[5],te[J+12]=I[6],te[J+13]=I[8],te[J+14]=I[9],te[J+15]=I[10],s.instancesEvaluatedElevation[H]=A[2]}}}let gT,_T;Ot(bx,"ModelBucket",{omit:["layers"]}),Ot(mT,"PerModelAttributes"),Ot(fT,"ModelFeature");class $h{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){let a=s||e.findDEMTileFor(i);if(!a||!a.dem)return;let u=a.dem,p=a.tileID,g=1<<i.canonical.z-p.canonical.z;return new $h(a,u.dim/ht/g,[(i.canonical.x/g-p.canonical.x)*u.dim,(i.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,i){let s=i*this._scale+this._offset[1];return new st(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,a){let u=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],g=Math.floor(u),b=Math.floor(p),w=this._dem;return a=!!a,s?$t($t(w.get(g,b,a),w.get(g,b+1,a),p-b),$t(w.get(g+1,b,a),w.get(g+1,b+1,a),p-b),u-g):w.get(g,b,a)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ee(1,e)*this._dem.stride}}let wx=new Float32Array(262144),kd=new Uint8Array(262144);function yT(r){let e=0;if(r.meshes)for(let i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(let i of r.children)e=Math.max(e,yT(i));return e}function vT(r,e,i){if(r.meshes)for(let s of r.meshes){if(s.aabb.min[0]===1/0)continue;let a=wi.applyTransform(s.aabb,r.globalMatrix);i.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(r.children)for(let s of r.children)vT(s,e,i)}let xT=["","wall","door","roof","window","lamp","logo"];class bT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:yT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=wi.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class m_{constructor(e,i,s,a,u,p,g,b){this.id=s,this.layers=e,this.layerIds=this.layers.map((w=>w.fqid)),this.stateDependentLayerIds=this.layers.filter((w=>w.isStateDependent())).map((w=>w.id)),this.modelTraits|=Nh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Nh.HasMapboxMeshFeatures),u&&(this.modelTraits|=Nh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(let w of i)this.nodesInfo.push(new bT(w)),vT(w,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(let s of this.getNodesInfo()){let a=s.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}updateAppearances(e,i,s,a){}update(e){let i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;let s=i?this.stateDependentLayers:this.layers;if(!oa(e,this.states))for(let a of s)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let s of i){let a=s.node;this.uploaded?this.updatePbrBuffer(a):Zv(a,e,!0)}for(let s of i)Yg(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){let a=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;if(!this.uploaded||this.dirty||a.name!==this.projection.name||sm(s.paint.get("model-color").value,p)||sm(s.paint.get("model-color-mix-intensity").value,p)||sm(s.paint.get("model-roughness").value,p)||sm(s.paint.get("model-emissive-strength").value,p)||sm(s.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=a,this.brightness=u;let g=this.getNodesInfo();for(let b of g)b.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let s=this.getNodesInfo(),a=this.id.canonical;for(let u of s){let p=u.feature;u.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},a),u.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},a)}}evaluate(e,i){let s=this.getNodesInfo();for(let a of s){if(!a.node.meshes)continue;let u=a.feature,p=i&&i[u.id];if(oa(p,a.state))continue;a.state=structuredClone(p);let g=a.node.meshes&&a.node.meshes[0].featureData,b=a.evaluatedColor[2],w=a.evaluatedRMEA[2],A=this.id.canonical;if(a.hasTranslucentParts=!1,g){for(let k=0;k<xT.length;k++){let I=xT[k];I.length&&(u.properties.part=I);let D=e.paint.get("model-color").evaluate(u,p,A).toPremultipliedRenderColor(null),B=e.paint.get("model-color-mix-intensity").evaluate(u,p,A);a.evaluatedColor[k]=[D.r,D.g,D.b,B],a.evaluatedRMEA[k][0]=e.paint.get("model-roughness").evaluate(u,p,A),a.evaluatedRMEA[k][2]=e.paint.get("model-emissive-strength").evaluate(u,p,A),a.evaluatedRMEA[k][3]=D.a,a.emissionHeightBasedParams[k]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,p,A),!a.hasTranslucentParts&&D.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,sB(a,b!==a.evaluatedColor[2]||w!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,p,A);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(u,p,A),a.evaluatedScale=e.paint.get("model-scale").evaluate(u,p,A),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,a){let u=e.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let p=$h.create(e,s,u);if(!p)return;this.modelTraits&Nh.HasMapboxMeshFeatures&&this.updateDEM(e,p,s,a);for(let g of this.getNodesInfo()){let b=g.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let w=b.footprint.vertices,A=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let k=1;k<w.length;k++)A=Math.min(A,p.getElevationAt(w[k].x,w[k].y,!0,!0));b.elevation=A}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,a){let u=i._dem._modifiedForSources[a];if(u===void 0&&(i._dem._modifiedForSources[a]=[],u=i._dem._modifiedForSources[a]),u.includes(s.canonical))return;let p=i._dem.dim;u.push(s.canonical);let g=!1;for(let b of this.getNodesInfo()){let w=b.node;if(!w.footprint||!w.footprint.grid)continue;let A=w.footprint.grid,k=i.tileCoordToPixel(A.min.x,A.min.y),I=i.tileCoordToPixel(A.max.x,A.max.y),D=Math.min(Math.min(p-I.y,k.x),Math.min(k.y,p-I.x));if(D<0)continue;let B=X(D,2,5),V=Math.max(0,k.x-B),W=Math.max(0,k.y-B),H=Math.min(I.x+B,p-1),J=Math.min(I.y+B,p-1);for(let de=W;de<=J;++de)for(let xe=V;xe<=H;++xe)kd[de*p+xe]=255;let te=0,ne=0;for(let de=0;de<A.cellsY;++de)for(let xe=0;xe<A.cellsX;++xe){if(!A.cells[de*A.cellsX+xe])continue;let Ce=i.tileCoordToPixel(A.min.x+xe/A.xScale,A.min.y+de/A.yScale),Ae=i.tileCoordToPixel(A.min.x+(xe+1)/A.xScale,A.min.y+(de+1)/A.yScale);for(let He=Ce.y;He<=Math.min(Ae.y+1,p-1);++He)for(let Oe=Ce.x;Oe<=Math.min(Ae.x+1,p-1);++Oe)kd[He*p+Oe]===255&&(kd[He*p+Oe]=0,te+=i.getElevationAtPixel(Oe,He),ne++)}let _e=te/ne;V=Math.max(1,k.x-B),W=Math.max(1,k.y-B),H=Math.min(I.x+B,p-2),J=Math.min(I.y+B,p-2),g=!0;for(let de=W;de<=J;++de)for(let xe=V;xe<=H;++xe)kd[de*p+xe]===0&&(wx[de*p+xe]=i._dem.set(xe,de,_e));for(let de=1;de<B;++de){V=Math.max(1,k.x-de),W=Math.max(1,k.y-de),H=Math.min(I.x+de,p-2),J=Math.min(I.y+de,p-2);for(let xe=W;xe<=J;++xe)for(let Ce=V;Ce<=H;++Ce){let Ae=xe*p+Ce;if(kd[Ae]===255){let He=0,Oe=0,Ze=-1,Je=-1;for(let it=-1;it<=1;++it)for(let _t=-1;_t<=1;++_t){let ct=(xe+it)*p+Ce+_t;if(kd[ct]>=de)continue;let Qe=wx[ct],lt=Math.abs(Qe);lt>Oe&&(He=Qe,Oe=lt,Ze=_t,Je=it)}if(Oe>.1){let it=1-(de+.5*Math.abs(Ze*Je))/B,_t=i._dem.get(Ce,xe)+He*it,ct=i._dem.get(Ce+Ze,xe+Je),Qe=i._dem.get(Ce-Ze,xe-Je,!0);(_t-ct)*(_t-Qe)>0&&(_t=(ct+Qe)/2),wx[Ae]=i._dem.set(Ce,xe,_t),kd[Ae]=de}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Zr.now())}setFilter(e){this.filter=e?mh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Rr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)Yg(i.node),$v(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let s=i.getReplacementRegionsForTile(e.toUnwrapped());for(let a of this.getNodesInfo()){let u=a.node.footprint;a.hiddenByReplacement=!!u&&!s.find((p=>p.footprint===u))}}getHeightAtTileCoord(e,i){let s=[],a=[0,0,0],u=Re([]);for(let p of this.getNodesInfo()){let g=p.node.meshes[0],b=g.transformedAabb;if(e<b.min[0]||i<b.min[1]||e>b.max[0]||i>b.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};tt(u,p.node.globalMatrix),a[0]=e,a[1]=i,Wr(a,a,u);let w=(a[0]-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*Cd|0,A=Math.min(63,(a[1]-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*Cd|0)*Cd+Math.min(63,w),k=g.heightmap[A];if(!(k<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:k,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new st(e,i),new st(e,i),s),s.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function sm(r,e){return r instanceof ud&&!r.isLightConstant&&e}function oB(r,e,i,s,a,u,p,g){let b=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,A=240&e|(240&e)>>4;i[3]>0&&(b=$t(b,255*i[0],i[3]),w=$t(w,255*i[1],i[3]),A=$t(A,255*i[2],i[3]));let k=b<<8|w,I=A<<8|Math.floor(255*s[3]),D=(function(de){let xe=X(de,0,2);return Math.min(Math.round(.5*xe*255),255)})(s[2])<<8|15*s[0]<<4|15*s[1],B=X(a[0],0,1),V=X(a[1],0,1),W=X(a[2],0,1),H=X(a[3],0,1),J,te,ne,_e;if(B!==V&&p!==u&&V!==B){let de=p-u;te=1/(de*(V-B)),ne=-(u+de*B)/(de*(V-B));let xe=X(a[4],-1,1);_e=Math.pow(10,xe),J=255*W<<8|255*H}else J=65535,te=0,ne=1,_e=1;if(r.emplaceBack(k,I,D,J,te,ne,_e),g){let de=g.length;g.clear();for(let xe=0;xe<de;xe++)g.emplaceBack(k,I,D,J,te,ne,_e)}}function sB(r,e,i){let s=r.node,a=0,u=i&Nh.HasMeshoptCompression;for(let p of s.meshes){if(s.lights&&s.lightMeshIndex===a||!p.featureData)continue;p.featureArray=new wu,p.featureArray.reserve(p.featureData.length);let g=e;for(let b of p.featureData){let w=u?65535&b:b>>16&65535,A=u?b>>16&65535:65535&b,k=(15&A)<8?15&A:0,I=r.evaluatedRMEA[k],D=r.evaluatedColor[k],B=r.emissionHeightBasedParams[k],V;if(g&&k===2&&s.lights&&(V=new wu,V.resize(10*s.lights.length)),oB(p.featureArray,w,D,I,B,p.aabb.min[2],p.aabb.max[2],V),V&&g){g=!1;let W=s.meshes[s.lightMeshIndex];W.featureArray=V,W.featureArray._trim()}}p.featureArray._trim(),a++}}Ot(m_,"Tiled3dModelBucket",{omit:["layers"]}),Ot(bT,"Tiled3dModelFeature");let aB=["id","tile","layer","source","sourceLayer","state"];class Id{constructor(e,i,s,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=a,this.properties=e?e.properties:{},this.id=u}clone(){let e=new Id(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let i of aB)this[i]!==void 0&&(e[i]=this[i]);return e}}class Pd extends ha{constructor(e,i,s,a){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){let e=[];for(let i in this._options.models){let s=this._options.models[i],a=this._modelsInfo.get(i);if(a){let u=a.model;u.position=s.position!=null?new F(s.position[0],s.position[1]):new F(0,0),u.orientation=s.orientation!=null?s.orientation:[0,0,0],a.modelSpec=s,Pd.applyModelSpecification(u,s),u.computeBoundsAndApplyParent(),this.models.push(u)}else{let u=jw(this.map._requestManager.transformRequest(s.uri,ua.Model).url).then((p=>{if(!p)return;let g=Yv(p),b=new Gw(i,s.uri,s.position,s.orientation,g);Pd.applyModelSpecification(b,s),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(i,{modelSpec:s,model:b})})).catch((p=>{this.fire(new Ll(new Error(`Could not load model ${i} from ${s.uri}: ${p.message}`)))}));e.push(u)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new so("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new Ll(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&Pd.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Pd.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.nodeOverrideNames=[];for(let s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach((([s,a])=>{let u={orientation:[0,0,0]};if(a.hasOwnProperty("orientation")){let p=a.orientation;p&&(u.orientation=p)}e.nodeOverrides.set(s,u)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.materialOverrideNames=[];for(let s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach((([s,a])=>{let u={color:new cr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},p=a["model-color"];p!==void 0&&(u.color.r=p[0],u.color.g=p[1],u.color.b=p[2]);let g=a["model-color-mix-intensity"];g!==void 0&&(u.colorMix=g);let b=a["model-emissive-strength"];b!==void 0&&(u.emissionStrength=b);let w=a["model-opacity"];w!==void 0&&(u.opacity=w),e.materialOverrides.set(s,u)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){let e=Lc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];let i=new Map;for(let s in e){let a=e[s];if(this._modelsInfo.has(s)){let u=this._modelsInfo.get(s);u&&u.modelSpec.uri===a.uri&&i.set(s,u)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function Sx(r,e,i,s){let a=1<<r.z;e.lat=ie((s/ht+r.y)/a),e.lng=se((i/ht+r.x)/a)}function lB(r,e,i,s){let a=r.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let u=Number.MAX_VALUE,p=a.node,g=i.tile,b=s.calculatePosMatrix(g.tileID.toUnwrapped(),s.worldSize),w=a.evaluatedScale,A=0;s.elevation&&p.elevation&&(A=p.elevation*s.elevation.exaggeration()),qe(b,b,[(p.anchor?p.anchor[0]:0)*(w[0]-1),(p.anchor?p.anchor[1]:0)*(w[1]-1),A]),St(b,b,w);let k=i.queryGeometry,I=k.isPointQuery()?k.screenBounds:k.screenGeometry,D=function(V){let W=yt([],b,V.globalMatrix);yt(W,s.expandedFarZProjMatrix,W);for(let H=0;H<V.meshes.length;++H){let J=V.meshes[H];if(H===V.lightMeshIndex)continue;let te=Hv(I,s,W,J.aabb);te!=null&&(u=Math.min(te,u))}if(V.children)for(let H of V.children)D(H)};if(D(p),u===Number.MAX_VALUE)return;let B=new F(0,0);return Sx(g.tileID.canonical,B,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:u,position:B,feature:a.feature}}let cB={circle:class extends Lo{constructor(r,e,i,s){super(r,{layout:ml||(ml=new hn({"circle-sort-key":new kt(Me.layout_circle["circle-sort-key"]),"circle-elevation-reference":new pt(Me.layout_circle["circle-elevation-reference"]),visibility:new pt(Me.layout_circle.visibility)})),paint:Cu||(Cu=new hn({"circle-radius":new kt(Me.paint_circle["circle-radius"]),"circle-color":new kt(Me.paint_circle["circle-color"]),"circle-blur":new kt(Me.paint_circle["circle-blur"]),"circle-opacity":new kt(Me.paint_circle["circle-opacity"]),"circle-translate":new pt(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Me.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pt(Me.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(r){return new Qr(r)}queryRadius(r){let e=r;return Xn("circle-radius",this,e)+Xn("circle-stroke-width",this,e)+ln(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,a,u,p,g){let b=Tu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return A1(r,s,u,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){let s=E1(this);return{config:new fl(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Lo{createBucket(r){return new I1(r)}constructor(r,e,i,s){super(r,{layout:P1||(P1=new hn({visibility:new pt(Me.layout_heatmap.visibility)})),paint:L1||(L1=new hn({"heatmap-radius":new kt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hu(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(Me.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Xn("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,a,u,p,g){let b=this.paint.get("heatmap-radius").evaluate(e,i);return A1(r,s,u,p,g,!0,!0,new st(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new fl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Lo{constructor(r,e,i,s){super(r,{layout:z1||(z1=new hn({visibility:new pt(Me.layout_hillshade.visibility)})),paint:M1||(M1=new hn({"hillshade-illumination-direction":new pt(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(Me.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pt(Me.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Lo{constructor(r,e,i,s){super(r,{layout:$1||($1=new hn({"fill-sort-key":new kt(Me.layout_fill["fill-sort-key"]),visibility:new pt(Me.layout_fill.visibility),"fill-elevation-reference":new pt(Me.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(Me.layout_fill["fill-construct-bridge-guard-rail"])})),paint:X1||(X1=new hn({"fill-antialias":new pt(Me.paint_fill["fill-antialias"]),"fill-opacity":new kt(Me.paint_fill["fill-opacity"]),"fill-color":new kt(Me.paint_fill["fill-color"]),"fill-outline-color":new kt(Me.paint_fill["fill-outline-color"]),"fill-translate":new pt(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Me.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new pt(Me.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new pt(Me.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Me.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(Me.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(Me.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){let r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new fl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Iv(r)}queryRadius(){return ln(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,a,u){return!r.queryGeometry.isAboveHorizon&&pn(Ls(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;let e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Lo{constructor(r,e,i,s){super(r,{layout:xw||(xw=new hn({visibility:new pt(Me["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pt(Me["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bw||(bw=new hn({"fill-extrusion-opacity":new pt(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new pt(Me["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new kt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new pt(Me["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new pt(Me["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new pt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pt(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pt(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pt(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pt(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pt(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pt(Me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pt(Me["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pt(Me["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Me["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Me["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new pt(Me["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new jg(r)}queryRadius(){return ln(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,s,a,u,p,g,b){let w=Tu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),k=this.paint.get("fill-extrusion-base").evaluate(e,i),I=[0,0],D=g&&u.elevation,B=u.elevation?u.elevation.exaggeration():1,V=r.tile.getBucket(this);if(D&&V instanceof jg){let ne=V.centroidVertexArray,_e=b+1;_e<ne.length&&(I[0]=ne.geta_centroid_pos0(_e),I[1]=ne.geta_centroid_pos1(_e))}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(s=vw([s],[new st(0,0),new st(ht,ht)],r.tileID.canonical).map((ne=>ne.polygon)).flat());let W=D?g:null,[H,J]=kw(u,s,k,A,w,p,W,I,B,u.center.lat,r.tileID.canonical),te=r.queryGeometry;return Aw(H,J,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},building:class extends Lo{constructor(r,e,i,s){super(r,{layout:Qw||(Qw=new hn({visibility:new pt(Me.layout_building.visibility),"building-facade":new kt(Me.layout_building["building-facade"]),"building-facade-floors":new kt(Me.layout_building["building-facade-floors"]),"building-facade-unit-width":new kt(Me.layout_building["building-facade-unit-width"]),"building-facade-window":new kt(Me.layout_building["building-facade-window"]),"building-roof-shape":new kt(Me.layout_building["building-roof-shape"]),"building-height":new kt(Me.layout_building["building-height"]),"building-base":new kt(Me.layout_building["building-base"]),"building-flood-light-wall-radius":new kt(Me.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new kt(Me.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new kt(Me.layout_building["building-flip-roof-orientation"])})),paint:eS||(eS=new hn({"building-opacity":new pt(Me.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new pt(Me.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new pt(Me.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new pt(Me.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new pt(Me.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new pt(Me.paint_building["building-vertical-scale"]),"building-cast-shadows":new pt(Me.paint_building["building-cast-shadows"]),"building-color":new kt(Me.paint_building["building-color"]),"building-emissive-strength":new kt(Me.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new pt(Me.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new pt(Me.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new pt(Me.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new pt(Me.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new pt(Me.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Jw(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,s,a,u,p,g,b){let w=this.layout.get("building-height").evaluate(e,i),A=this.layout.get("building-base").evaluate(e,i),k=r.tile.getBucket(this).getFootprint(e);if(k){if(k.hiddenFlags!==0)return!1;w=k.height}let[I,D]=kw(u,s,A,w,new st(0,0),p,null,[0,0],1,u.center.lat,r.tileID.canonical),B=r.queryGeometry;return Aw(I,D,B.isPointQuery()?B.screenBounds:B.screenGeometry)}},line:class extends Lo{constructor(r,e,i,s){let a=uS();super(r,a,e,i,s),a.layout&&(this.layout=new Pc(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Cc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Gf)return Gf;let i=uS();return Gf=new oD(i.paint.properties["line-width"].specification),Gf.useIntegerZoom=!0,Gf})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Jv(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){let s=lS(this);return{config:new fl(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(r){let e=r,i=dS(Xn("line-width",this,e),Xn("line-gap-width",this,e)),s=Xn("line-offset",this,e);return i/2+Math.abs(s)+ln(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,a,u){if(r.queryGeometry.isAboveHorizon)return!1;let p=Ls(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*dS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(s=(function(w,A){let k=[],I=new st(0,0);for(let D=0;D<w.length;D++){let B=w[D],V=[];for(let W=0;W<B.length;W++){let H=B[W],J=B[W+1],te=W===0?I:H.sub(B[W-1])._unit()._perp(),ne=W===B.length-1?I:J.sub(H)._unit()._perp(),_e=te._add(ne)._unit();_e._mult(1/(_e.x*ne.x+_e.y*ne.y)),V.push(_e._mult(A)._add(H))}k.push(V)}return k})(s,b*r.pixelToTileUnitsFactor)),(function(w,A,k){for(let I=0;I<A.length;I++){let D=A[I];if(w.length>=3){for(let B=0;B<D.length;B++)if($n(w,D[B]))return!0}if(Ko(w,D,k))return!0}return!1})(p,s,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:d_,background:class extends Lo{constructor(r,e,i,s){super(r,{layout:eT||(eT=new hn({visibility:new pt(Me.layout_background.visibility)})),paint:tT||(tT=new hn({"background-pitch-alignment":new pt(Me.paint_background["background-pitch-alignment"]),"background-color":new pt(Me.paint_background["background-color"]),"background-pattern":new pt(Me.paint_background["background-pattern"]),"background-opacity":new pt(Me.paint_background["background-opacity"]),"background-emissive-strength":new pt(Me.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:sT,"raster-particle":hT,sky:class extends Lo{constructor(r,e,i,s){super(r,{layout:cT||(cT=new hn({visibility:new pt(Me.layout_sky.visibility)})),paint:uT||(uT=new hn({"sky-type":new pt(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new pt(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pt(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pt(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pt(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new hu(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pt(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pt(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pt(Me.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){let s=this.paint.get("sky-atmosphere-sun"),a=!s,u=r.style.light,p=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&Zt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?vx(p.azimuthal,90-p.polar,e):vx(s[0],90-s[1],e)}let i=this.paint.get("sky-gradient-center");return vx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Lo{constructor(r,e,i,s){super(r,{paint:dT||(dT=new hn({}))},e,null)}},model:class extends Lo{constructor(r,e,i,s){super(r,{layout:gT||(gT=new hn({visibility:new pt(Me.layout_model.visibility),"model-id":new kt(Me.layout_model["model-id"])})),paint:_T||(_T=new hn({"model-opacity":new kt(Me.paint_model["model-opacity"]),"model-rotation":new kt(Me.paint_model["model-rotation"]),"model-scale":new kt(Me.paint_model["model-scale"]),"model-translation":new kt(Me.paint_model["model-translation"]),"model-color":new kt(Me.paint_model["model-color"]),"model-color-mix-intensity":new kt(Me.paint_model["model-color-mix-intensity"]),"model-type":new pt(Me.paint_model["model-type"]),"model-cast-shadows":new pt(Me.paint_model["model-cast-shadows"]),"model-receive-shadows":new pt(Me.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pt(Me.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Me.paint_model["model-emissive-strength"]),"model-roughness":new kt(Me.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Me.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pt(Me.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pt(Me.paint_model["model-front-cutoff"]),"model-elevation-reference":new pt(Me.paint_model["model-elevation-reference"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new bx(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof m_?ht-1:0}queryRenderedFeatures(r,e,i){let s=e.getSource();if(!(s&&s instanceof Pd))return{};let a=s,u={};u[this.id]=[];let p=u[this.id],g=0;for(let b of a.models){let w=e.getFeatureState(this.sourceLayer,b.id),A={type:"Unknown",id:b.id,properties:b.featureProperties},k=this.paint.get("model-rotation").evaluate(A,w),I=this.paint.get("model-scale").evaluate(A,w),D=this.paint.get("model-translation").evaluate(A,w),B=this.paint.get("model-elevation-reference"),V=[];Xg(V,b,i,b.position,k,I,D,B==="ground",B==="ground",!1),i.projection.name==="globe"&&(V=$g(V,i));let W=yt([],i.projMatrix,V),H=Hv(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,W,b.aabb);if(H!=null){let J=new Id(void 0,0,0,0,b.id);J.layer=this.layer,J.properties=structuredClone(b.featureProperties),J.properties.layer=this.id,J.properties.uri=b.uri,J.properties.orientation=b.orientation,J.sourceLayer=this.sourceLayer,J.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},J.state=w,J.source=this.source,p.push({featureIndex:g,feature:J,intersectionZ:H})}++g}return u}queryIntersectsFeature(r,e,i,s,a,u){if(!this.modelManager)return!1;let p=this.modelManager,g=r.tile.getBucket(this);if(!(g&&g instanceof bx))return!1;for(let b in g.instancesPerModel){let w=g.instancesPerModel[b],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(A)){let k=w.features[w.idToFeaturesIndex[A]],I=p.getModel(b,this.scope);if(!I)return!1;let D=[],B=new F(0,0),V=g.canonical,W=Number.MAX_VALUE;for(let H=0;H<k.instancedDataCount;++H){let J=16*(k.instancedDataOffset+H),te=w.instancedDataArray.float32,ne=[te[J+4],te[J+5],te[J+6]];Sx(V,B,Math.floor(te[J]),Math.floor(te[J+1])),Xg(D,I,u,B,k.rotation,k.scale,ne,!1,!1,!1),u.projection.name==="globe"&&(D=$g(D,u));let _e=yt([],u.projMatrix,D),de=r.queryGeometry,xe=Hv(de.isPointQuery()?de.screenBounds:de.screenGeometry,u,_e,I.aabb);xe!=null&&(W=Math.min(xe,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){let e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Hl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Lo{constructor(r,e,i,s){super(r,{layout:Y1||(Y1=new hn({"clip-layer-types":new pt(Me.layout_clip["clip-layer-types"]),"clip-layer-scope":new pt(Me.layout_clip["clip-layer-scope"])})),paint:K1||(K1=new hn({}))},e,i,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new J1(r)}is3D(r){return!0}}},Tx=new cr(0,0,0),Cx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Ex={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},g_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},uB={PAINT_ORDER_FILL_AND_STROKE:1},am={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},wT={MASK_TYPE_LUMINANCE:1};function dB(r,e,i){r===1&&e.icons.push((function(s,a){return(function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;let{metadata:p}=u;if(p.content_area){let{content_area:g}=p;g.left==null&&(g.left=0),g.top==null&&(g.top=g.left),g.width==null&&(g.width=u.usvg_tree.width),g.height==null&&(g.height=g.width)}if(p.text_placeholder){let{text_placeholder:g}=p;g.top==null&&(g.top=g.left),g.height==null&&(g.height=g.width)}return p.stretch_x&&p.stretch_x.length&&ST(p,"x"),p.stretch_y&&p.stretch_y.length&&ST(p,"y"),u})(s.readFields(hB,{name:void 0},a))})(i,i.readVarint()+i.pos))}function ST(r,e){let i=[],s=r[`stretch_${e}`],a=null;for(let u=0;u<s.length;u++)a===null?a=i.length===0?s[0]:i[i.length-1][1]+s[u]:(i.push([a,a+s[u]]),a=null);r[`stretch_${e}_areas`]=i}function hB(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(s,a){return s.readFields(pB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(s,a){return s.readFields(gB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function pB(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=TT(i,i.readVarint()+i.pos):r===4?e.variables.push((function(s,a){return s.readFields(mB,{name:void 0},a)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=TT(i,i.readVarint()+i.pos))}function TT(r,e){return r.readFields(fB,{},e)}function fB(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function mB(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=v_(i.readVarint()),e.value="rgb_color")}function gB(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(__(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(s,a){return s.readFields(SB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(s,a){return s.readFields(CB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(s,a){return s.readFields(EB,{children:[]},a)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(s,a){let u=s.readFields(AB,{left:0,width:20,mask_type:wT.MASK_TYPE_LUMINANCE,children:[]},a);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u})(i,i.readVarint()+i.pos))}function __(r,e){return r.readFields(_B,{},e)}function _B(r,e,i){r===1?(e.group=(function(s,a){return s.readFields(yB,{opacity:255,children:[]},a)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(s,a){return s.readFields(xB,{paint_order:1,commands:[],step:1,diffs:[],rule:Cx.PATH_RULE_NON_ZERO},a)})(i,i.readVarint()+i.pos),e.node="path")}function yB(r,e,i){r===1?e.transform=y_(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(__(i,i.readVarint()+i.pos))}function y_(r,e){return r.readFields(vB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function vB(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function xB(r,e,i){r===1?e.fill=(function(s,a){return s.readFields(bB,{rgb_color:Tx,paint:"rgb_color",opacity:255},a)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(s,a){return s.readFields(wB,{rgb_color:Tx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function bB(r,e,i){r===1?(e.rgb_color=v_(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function v_(r){return new cr((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function wB(r,e,i){r===1?(e.rgb_color=v_(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function SB(r,e,i){r===1?e.transform=y_(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(CT(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function CT(r,e){return r.readFields(TB,{offset:0,opacity:255,rgb_color:Tx},e)}function TB(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=v_(i.readVarint()))}function CB(r,e,i){r===1?e.transform=y_(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(CT(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function EB(r,e,i){r===1?e.transform=y_(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(__(i,i.readVarint()+i.pos))}function AB(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(__(i,i.readVarint()+i.pos))}class kB{static calculate(e={},i=[]){let s=new Map,a=new Map;if(Object.keys(e).length===0)return s;i.forEach((u=>{a.set(u.name,u.rgb_color||new cr(0,0,0))}));for(let[u,p]of Object.entries(e))a.has(u)?s.set(a.get(u).toString(),p):console.warn(`Ignoring unknown image variable "${u}"`);return s}}function Xh(r,e=255,i){let s=e/255,a=r.toString(),u=i.has(a)?i.get(a).clone():r.clone();return u.a*=s,u.toString()}function lm(r,e){if(!Un()){let i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function IB(r,e){let i=kB.calculate(e.params,r.metadata?r.metadata.variables:[]),s=r.usvg_tree,a=s.width,u=s.height,p=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(a*p.a)),b=Math.max(1,Math.round(u*p.d)),w=new DOMMatrix([g/a,0,0,b/u,0,0]),A=lm(g,b).getContext("2d");return Ax(A,w,s,s,i),A.getImageData(0,0,g,b)}function Ax(r,e,i,s,a){for(let u of s.children)ET(r,e,i,u,a)}function ET(r,e,i,s,a){s.group?(r.save(),(function(u,p,g,b,w){let A=b.mask_idx!=null?g.masks[b.mask_idx]:null,k=b.clip_path_idx!=null?g.clip_paths[b.clip_path_idx]:null;if(b.transform&&(p=Yh(b.transform).preMultiplySelf(p)),!(function(B,V,W){return B.opacity!==255||V||W})(b,k!=null,A!=null))return void Ax(u,p,g,b,w);let I=lm(u.canvas.width,u.canvas.height),D=I.getContext("2d");Ax(D,p,g,b,w),k&&MT(D,p,g,k),A&&OT(D,p,g,A,w),u.globalAlpha=b.opacity/255,u.drawImage(I,0,0)})(r,e,i,s.group,a),r.restore()):s.path&&(r.save(),(function(u,p,g,b,w){u.setTransform(p),b.paint_order===uB.PAINT_ORDER_FILL_AND_STROKE?(AT(u,g,b,w),IT(u,g,b,w)):(IT(u,g,b,w),AT(u,g,b,w))})(r,e,i,s.path,a),r.restore())}function AT(r,e,i,s){let a=i.fill;if(!a)return;let u=a.opacity/255;switch(r.save(),r.beginPath(),RT(i,r),a.paint){case"rgb_color":r.fillStyle=Xh(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":{let p=e.linear_gradients[a.linear_gradient_idx];p.transform&&r.setTransform(Yh(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=PT(r,p,u,s);break}case"radial_gradient_idx":{let p=e.radial_gradients[a.radial_gradient_idx];p.transform&&r.setTransform(Yh(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=LT(r,p,u,s)}}r.fill(kT(i)),r.restore()}function kT(r){return r.rule===Cx.PATH_RULE_NON_ZERO?"nonzero":r.rule===Cx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function IT(r,e,i,s){let a=i.stroke;if(!a)return;let u=DT(i);r.lineWidth=a.width,r.miterLimit=a.miterlimit,r.setLineDash(a.dasharray),r.lineDashOffset=a.dashoffset;let p=a.opacity/255;switch(a.paint){case"rgb_color":r.strokeStyle=Xh(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":r.strokeStyle=PT(r,e.linear_gradients[a.linear_gradient_idx],p,s,!0);break;case"radial_gradient_idx":r.strokeStyle=LT(r,e.radial_gradients[a.radial_gradient_idx],p,s,!0)}switch(a.linejoin){case g_.LINE_JOIN_MITER_CLIP:case g_.LINE_JOIN_MITER:r.lineJoin="miter";break;case g_.LINE_JOIN_ROUND:r.lineJoin="round";break;case g_.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(a.linecap){case Ex.LINE_CAP_BUTT:r.lineCap="butt";break;case Ex.LINE_CAP_ROUND:r.lineCap="round";break;case Ex.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(u)}function PT(r,e,i,s,a=!1){if(e.stops.length===1){let I=e.stops[0];return Xh(I.rgb_color,I.opacity*i,s)}let{x1:u,y1:p,x2:g,y2:b}=e,w=new DOMPoint(u,p),A=new DOMPoint(g,b);if(a){let I=Yh(e.transform);w=I.transformPoint(w),A=I.transformPoint(A)}let k=r.createLinearGradient(w.x,w.y,A.x,A.y);for(let I of e.stops)k.addColorStop(I.offset,Xh(I.rgb_color,I.opacity*i,s));return k}function LT(r,e,i,s,a=!1){if(e.stops.length===1){let H=e.stops[0];return Xh(H.rgb_color,H.opacity*i,s)}let u=Yh(e.transform),{fx:p,fy:g,fr:b,cx:w,cy:A,r:k}=e,I=new DOMPoint(p,g),D=new DOMPoint(w,A),B=b,V=k;if(a){I=u.transformPoint(I),D=u.transformPoint(D);let H=(u.a+u.d)/2;B=b*H,V=e.r*H}let W=r.createRadialGradient(I.x,I.y,B,D.x,D.y,V);for(let H of e.stops)W.addColorStop(H.offset,Xh(H.rgb_color,H.opacity*i,s));return W}function zT(r,e,i,s){let a=s.transform?Yh(s.transform).preMultiplySelf(e):e,u=lm(r.canvas.width,r.canvas.height),p=u.getContext("2d");for(let b of s.children)if(b.group)zT(p,a,i,b.group);else if(b.path){let w=b.path,A=new Path2D;A.addPath(DT(w),a),p.fill(A,kT(w))}let g=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;g&&MT(p,a,i,g),r.globalCompositeOperation="source-over",r.drawImage(u,0,0)}function MT(r,e,i,s){let a=lm(r.canvas.width,r.canvas.height);zT(a.getContext("2d"),e,i,s),r.globalCompositeOperation="destination-in",r.drawImage(a,0,0)}function OT(r,e,i,s,a){if(s.children.length===0)return;let u=s.mask_idx!=null?i.masks[s.mask_idx]:null;u&&OT(r,e,i,u,a);let p=r.canvas.width,g=r.canvas.height,b=lm(p,g),w=b.getContext("2d"),A=s.width,k=s.height,I=s.left,D=s.top,B=new Path2D,V=new Path2D;V.rect(I,D,A,k),B.addPath(V,e),w.clip(B);for(let J of s.children)ET(w,e,i,J,a);let W=w.getImageData(0,0,p,g),H=W.data;if(s.mask_type===wT.MASK_TYPE_LUMINANCE)for(let J=0;J<H.length;J+=4)H[J+3]=H[J+3]/255*(.2126*H[J]+.7152*H[J+1]+.0722*H[J+2]);w.putImageData(W,0,0),r.globalCompositeOperation="destination-in",r.drawImage(b,0,0)}function Yh(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function RT(r,e){let i=r.step,s=r.diffs[0]*i,a=r.diffs[1]*i;e.moveTo(s,a);for(let u=0,p=2;u<r.commands.length;u++)switch(r.commands[u]){case am.PATH_COMMAND_MOVE:s+=r.diffs[p++]*i,a+=r.diffs[p++]*i,e.moveTo(s,a);break;case am.PATH_COMMAND_LINE:s+=r.diffs[p++]*i,a+=r.diffs[p++]*i,e.lineTo(s,a);break;case am.PATH_COMMAND_QUAD:{let g=s+r.diffs[p++]*i,b=a+r.diffs[p++]*i;s=g+r.diffs[p++]*i,a=b+r.diffs[p++]*i,e.quadraticCurveTo(g,b,s,a);break}case am.PATH_COMMAND_CUBIC:{let g=s+r.diffs[p++]*i,b=a+r.diffs[p++]*i,w=g+r.diffs[p++]*i,A=b+r.diffs[p++]*i;s=w+r.diffs[p++]*i,a=A+r.diffs[p++]*i,e.bezierCurveTo(g,b,w,A,s,a);break}case am.PATH_COMMAND_CLOSE:e.closePath()}return e}function DT(r){return RT(r,new Path2D)}class x_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ot(x_,"LRUCache");class kx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new So(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new x_(150)),this.cacheMap.get(s).get(Lc(e.toString(),i))}setInCache(e,i,s,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new x_(150));let u=this.cacheDependenciesMap.get(a),p=Lc(e.id.toString(),s);u.get(p)||u.set(p,new Set);let g=this.cacheMap.get(a),b=e.toString();u.get(p).add(b),g.put(Lc(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;let a=this.cacheMap.get(s),u=this.cacheDependenciesMap.get(s);for(let p of e){let g=Lc(p.toString(),i);if(u.has(g)){for(let b of u.get(g))a.delete(b);u.delete(g)}}}rasterize(e,i,s,a,u=IB){let p=this.getFromCache(e,s,a);if(p)return p.clone();let g=u(i.icon,e.options),b=kx._getImage(g);return this.setInCache(e,b,s,a),b.clone()}}class BT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function FT(r,e,i,s){let a=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(s[p])<1e-15){if(i[p]<r[p]||i[p]>e[p])return null}else{let g=1/s[p],b=(r[p]-i[p])*g,w=(e[p]-i[p])*g;if(b>w){let A=b;b=w,w=A}if(b>a&&(a=b),w<u&&(u=w),a>u)return null}return a}function NT(r,e,i,s,a,u,p,g,b,w,A){let k=s-r,I=a-e,D=u-i,B=p-r,V=g-e,W=b-i,H=A[1]*W-A[2]*V,J=A[2]*B-A[0]*W,te=A[0]*V-A[1]*B,ne=k*H+I*J+D*te;if(Math.abs(ne)<1e-15)return null;let _e=1/ne,de=w[0]-r,xe=w[1]-e,Ce=w[2]-i,Ae=(de*H+xe*J+Ce*te)*_e;if(Ae<0||Ae>1)return null;let He=xe*D-Ce*I,Oe=Ce*k-de*D,Ze=de*I-xe*k,Je=(A[0]*He+A[1]*Oe+A[2]*Ze)*_e;return Je<0||Ae+Je>1?null:(B*He+V*Oe+W*Ze)*_e}function jT(r,e,i){return(r-e)/(i-e)}function VT(r,e,i,s,a,u,p,g,b){let w=1<<i,A=u-s,k=p-a,I=(r+1)/w*A+s,D=(e+0)/w*k+a,B=(e+1)/w*k+a;g[0]=(r+0)/w*A+s,g[1]=D,b[0]=I,b[1]=B}class UT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=(function(u){let p=Math.ceil(Math.log2(u.dim/8)),g=[],b=Math.ceil(Math.pow(2,p)),w=1/b,A=(D,B,V,W,H)=>{let J=W?1:0,te=(D+1)*V-J,ne=B*V,_e=(B+1)*V-J;H[0]=D*V,H[1]=ne,H[2]=te,H[3]=_e},k=new BT(b),I=[];for(let D=0;D<b*b;D++){A(D%b,Math.floor(D/b),w,!1,I);let B=zu(I[0],I[1],u),V=zu(I[2],I[1],u),W=zu(I[2],I[3],u),H=zu(I[0],I[3],u);k.minimums.push(Math.min(B,V,W,H)),k.maximums.push(Math.max(B,V,W,H)),k.leaves.push(1)}for(g.push(k),b/=2;b>=1;b/=2){let D=g[g.length-1];k=new BT(b);for(let B=0;B<b*b;B++){A(B%b,Math.floor(B/b),2,!0,I);let V=D.getElevation(I[0],I[1]),W=D.getElevation(I[2],I[1]),H=D.getElevation(I[2],I[3]),J=D.getElevation(I[0],I[3]),te=D.isLeaf(I[0],I[1]),ne=D.isLeaf(I[2],I[1]),_e=D.isLeaf(I[2],I[3]),de=D.isLeaf(I[0],I[3]),xe=Math.min(V.min,W.min,H.min,J.min),Ce=Math.max(V.max,W.max,H.max,J.max),Ae=te&&ne&&_e&&de;k.maximums.push(Ce),k.minimums.push(xe),k.leaves.push(Ce-xe<=5&&Ae?1:0)}g.push(k)}return g})(this.dem),s=i.length-1,a=i[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,a,u,p,g=1){return FT([e,i,-100],[s,a,this.maximums[0]*g],u,p)}raycast(e,i,s,a,u,p,g=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,i,s,a,u,p,g);if(b==null)return null;let w=[],A=[],k=[],I=[],D=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;D.length>0;){let{idx:B,t:V,nodex:W,nodey:H,depth:J}=D.pop();if(this.leaves[B]){VT(W,H,J,e,i,s,a,k,I);let ne=1<<J,_e=(W+0)/ne,de=(W+1)/ne,xe=(H+0)/ne,Ce=(H+1)/ne,Ae=zu(_e,xe,this.dem)*g,He=zu(de,xe,this.dem)*g,Oe=zu(de,Ce,this.dem)*g,Ze=zu(_e,Ce,this.dem)*g,Je=NT(k[0],k[1],Ae,I[0],k[1],He,I[0],I[1],Oe,u,p),it=NT(I[0],I[1],Oe,k[0],I[1],Ze,k[0],k[1],Ae,u,p),_t=Math.min(Je!==null?Je:Number.MAX_VALUE,it!==null?it:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{let ct=nn([],u,p,V);if(qT(Ae,He,Ze,Oe,jT(ct[0],k[0],I[0]),jT(ct[1],k[1],I[1]))>=ct[2])return V}continue}let te=0;for(let ne=0;ne<this._siblingOffset.length;ne++){VT((W<<1)+this._siblingOffset[ne][0],(H<<1)+this._siblingOffset[ne][1],J+1,e,i,s,a,k,I),k[2]=-100,I[2]=this.maximums[this.childOffsets[B]+ne]*g;let _e=FT(k,I,u,p);if(_e!=null){let de=_e;w[ne]=de;let xe=!1;for(let Ce=0;Ce<te&&!xe;Ce++)de>=w[A[Ce]]&&(A.splice(Ce,0,ne),xe=!0);xe||(A[te]=ne),te++}}for(let ne=0;ne<te;ne++){let _e=A[ne];D.push({idx:this.childOffsets[B]+_e,t:w[_e],nodex:(W<<1)+this._siblingOffset[_e][0],nodey:(H<<1)+this._siblingOffset[_e][1],depth:J+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,a,u){if(e[a].isLeaf(i,s)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let p=a-1,g=e[p],b=0,w=0;for(let A=0;A<this._siblingOffset.length;A++){let k=2*i+this._siblingOffset[A][0],I=2*s+this._siblingOffset[A][1],D=g.getElevation(k,I),B=g.isLeaf(k,I),V=this._addNode(D.min,D.max,B);B&&(b|=1<<A),w||(w=V)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*s+this._siblingOffset[A][1],p,w+A)}}function qT(r,e,i,s,a,u){return $t($t(r,i,u),$t(e,s,u),a)}function zu(r,e,i){let s=i.dim,a=X(r*s-.5,0,s-1),u=X(e*s-.5,0,s-1),p=Math.floor(a),g=Math.floor(u),b=Math.min(p+1,s-1),w=Math.min(g+1,s-1);return qT(i.get(p,g),i.get(b,g),i.get(p,w),i.get(b,w),a-p,u-g)}let PB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function LB(r,e,i){return(256*r*256+256*e+i)/10-1e4}function zB(r,e,i){return 256*r+e+i/256-32768}class b_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Zt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let u=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let b=0;b<u;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(u,b)]=p[this._idx(u-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,u)]=p[this._idx(b,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}let g=s==="terrarium"?zB:LB;for(let b=0;b<p.length;++b){let w=4*b;this.floatView[b]=g(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Zr.now()}_buildQuadTree(){this._tree=new UT(this)}get(e,i,s=!1){s&&(e=X(e,-1,this.dim),i=X(i,-1,this.dim));let a=this._idx(e,i);return this.floatView[a]}set(e,i,s){let a=this._idx(e,i),u=this.floatView[a];return this.floatView[a]=s,s-u}static getUnpackVector(e){return PB[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let s=[0,0,0,0],a=b_.getUnpackVector(i),u=Math.floor((e+a[3])/a[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new D1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,u=i*this.dim+this.dim,p=s*this.dim,g=s*this.dim+this.dim;switch(i){case-1:a=u-1;break;case 1:u=a+1}switch(s){case-1:p=g-1;break;case 1:g=p+1}let b=-i*this.dim,w=-s*this.dim;for(let A=p;A<g;A++)for(let k=a;k<u;k++){let I=4*this._idx(k,A),D=4*this._idx(k+b,A+w);this.pixels[I+0]=e.pixels[D+0],this.pixels[I+1]=e.pixels[D+1],this.pixels[I+2]=e.pixels[D+2],this.pixels[I+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function MB(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(s,a){return s.readFields(FB,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)})(i,i.readVarint()+i.pos))}function OB(r,e,i){r===1?(e.delta_filter=(function(s,a){return s.readFields(RB,{blockSize:0},a)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function RB(r,e,i){r===1&&(e.blockSize=i.readVarint())}function DB(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function BB(r,e,i){let s=0,a=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(u,p){return u.readFields(OB,{},p)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(u,p){return u.readFields(DB,{},p)})(i,i.readVarint()+i.pos):r===5?a=i.readFloat():r===6?s=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=s)}function FB(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(s,a){return s.readFields(BB,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)})(i,i.readVarint()+i.pos))}function NB(r,e,i){if(r===2)(function(s,a,u){s.readFields(jB,u,a)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function jB(r,e,i){if(r===1){let s=0,a=i.readVarint()+i.pos;for(;i.pos<a;)e[s++]=i.readVarint()}}function VB(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){let a=s===1?1:0,u=s===2?1:0;for(let p=0;p<e[0];p++){let g=e[1]*p;for(let b=a;b<e[1];b++){let w=e[2]*(b+g);for(let A=u;A<e[2];A++){let k=e[3]*(A+w);for(let I=0;I<e[3];I++){let D=k+I;r[D]+=r[D-i]}}}}i*=e[s]}return r}function UB(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function qB(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){let s=r[i],a=r[i+1];r[i]=(240&s)>>4|(61440&s)>>8|(240&a)<<4|61440&a,r[i+1]=15&s|(3840&s)>>4|(15&a)<<8|(3840&a)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){let s=r[i],a=r[i+1],u=r[i+2],p=r[i+3];r[i+0]=(192&s)>>6|(192&a)>>4|(192&u)>>2|192&p,r[i+1]=(48&s)>>4|(48&a)>>2|48&u|(48&p)<<2,r[i+2]=(12&s)>>2|12&a|(12&u)<<2|(12&p)<<4,r[i+3]=3&s|(3&a)<<2|(3&u)<<4|(3&p)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ot(b_,"DEMData"),Ot(UT,"DemMinMaxQuadTree",{omit:["dem"]});var va=Uint8Array,cm=Uint16Array,WB=Int32Array,WT=new va([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),GT=new va([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),GB=new va([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),HT=function(r,e){for(var i=new cm(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];var a=new WB(i[30]);for(s=1;s<30;++s)for(var u=i[s];u<i[s+1];++u)a[u]=u-i[s]<<5|s;return{b:i,r:a}},ZT=HT(WT,2),$T=ZT.b,HB=ZT.r;$T[28]=258,HB[258]=28;for(var ZB=HT(GT,0).b,XT=new cm(32768),Vn=0;Vn<32768;++Vn){var Kh=(43690&Vn)>>1|(21845&Vn)<<1;XT[Vn]=((65280&(Kh=(61680&(Kh=(52428&Kh)>>2|(13107&Kh)<<2))>>4|(3855&Kh)<<4))>>8|(255&Kh)<<8)>>1}var um=function(r,e,i){for(var s=r.length,a=0,u=new cm(e);a<s;++a)r[a]&&++u[r[a]-1];var p,g=new cm(e);for(a=1;a<e;++a)g[a]=g[a-1]+u[a-1]<<1;p=new cm(1<<e);var b=15-e;for(a=0;a<s;++a)if(r[a])for(var w=a<<4|r[a],A=e-r[a],k=g[r[a]-1]++<<A,I=k|(1<<A)-1;k<=I;++k)p[XT[k]>>b]=w;return p},dm=new va(288);for(Vn=0;Vn<144;++Vn)dm[Vn]=8;for(Vn=144;Vn<256;++Vn)dm[Vn]=9;for(Vn=256;Vn<280;++Vn)dm[Vn]=7;for(Vn=280;Vn<288;++Vn)dm[Vn]=8;var YT=new va(32);for(Vn=0;Vn<32;++Vn)YT[Vn]=5;var $B=um(dm,9),XB=um(YT,5),Ix=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},vl=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&i},Px=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},YB=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xl=function(r,e,i){var s=new Error(e||YB[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,xl),!i)throw s;return s},KB=new va(0),JB=typeof TextDecoder<"u"&&new TextDecoder;try{JB.decode(KB,{stream:!0})}catch{}let QB={gzip_data:"gzip"};class qa extends Error{constructor(e){super(e),this.name="MRTError"}}let e3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},KT={uint32:1,uint16:2,uint8:4},t3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},Lx;class w_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let i=this.layers[e];if(!i)throw new qa(`Layer '${e}' not found`);return i}getHeaderLength(e){let i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new qa("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new qa(`Expected header with length >= ${s} but got buffer of length ${i.length}`);let a=new Lx(i.subarray(0,s)).readFields(MB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new qa(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(let u of a.layers)this.layers[u.name]=new JT(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],s=this.getLayer(e.layerName);for(let a of e.blockIndices){let u=s.dataIndex[a],p=u.firstByte-e.firstByte,g=u.lastByte-e.firstByte;if(s._blocksInProgress.has(a))continue;let b={layerName:s.name,firstByte:p,lastByte:g,pixelFormat:s.pixelFormat,blockIndex:a,blockShape:[u.bands.length].concat(s.bandShape),buffer:s.buffer,codec:u.codec.codec,filters:u.filters.map((w=>w.filter))};s._blocksInProgress.add(a),i.push(b)}return new QT(i,(()=>{i.forEach((a=>s._blocksInProgress.delete(a.blockIndex)))}),((a,u)=>{if(i.forEach((p=>s._blocksInProgress.delete(p.blockIndex))),a)throw a;u.forEach((p=>{this.getLayer(p.layerName).processDecodedData(p)}))}))}}class JT{constructor({version:e,name:i,units:s,tileSize:a,pixelFormat:u,buffer:p,dataIndex:g},b){if(this.version=e,this.version!==1)throw new qa(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=a,this.buffer=p,this.pixelFormat=e3[u],this.dataIndex=g,this.bandShape=[a+2*p,a+2*p,KT[this.pixelFormat]],this._decodedBlocks=new x_(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return KT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[s,a]of this.dataIndex.entries()){for(let[u,p]of a.bands.entries())if(p===e)return{bandIndex:i+u,blockIndex:s,blockBandIndex:u};i+=a.bands.length}break;case"number":for(let[s,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new qa(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0,a=[],u=new Set;for(let p of e){let{blockIndex:g}=this.getBlockForBand(p);if(g<0)throw new qa(`Invalid band: ${JSON.stringify(p)}`);let b=this.dataIndex[g];a.includes(g)||a.push(g),u.add(g),i=Math.min(i,b.firstByte),s=Math.max(s,b.lastByte)}if(u.size>this.cacheSize)throw new qa(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:a}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new qa(`Band not found: ${JSON.stringify(e)}`);let a=this._decodedBlocks.get(i.toString());if(!a)throw new qa(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[i],p=this.bandShape.reduce(((w,A)=>w*A),1),g=s*p,b=a.subarray(g,g+p);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}w_.setPbf=function(r){Lx=r};class QT{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}w_.performDecoding=function(r,e){let i=new Uint8Array(r);return Promise.all(e.tasks.map((s=>{let{layerName:a,firstByte:u,lastByte:p,pixelFormat:g,blockShape:b,blockIndex:w,filters:A,codec:k}=s,I=i.subarray(u,p+1),D=new Uint32Array(b[0]*b[1]*b[2]),B;if(k!=="gzip_data")throw new qa(`Unhandled codec: ${k}`);return B=(function(V,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((ne=(function(xe){xe[0]==31&&xe[1]==139&&xe[2]==8||xl(6,"invalid gzip data");var Ce=xe[3],Ae=10;4&Ce&&(Ae+=2+(xe[10]|xe[11]<<8));for(var He=(Ce>>3&1)+(Ce>>4&1);He>0;He-=!xe[Ae++]);return Ae+(2&Ce)})(te=V))+8>te.length&&xl(6,"invalid gzip data"),(function(xe,Ce,Ae,He){var Oe=xe.length;if(!Oe||Ce.f&&!Ce.l)return Ae||new va(0);var Ze=!Ae,Je=Ze||Ce.i!=2,it=Ce.i;Ze&&(Ae=new va(3*Oe));var _t,ct,Qe=function(cn){var Vr=Ae.length;if(cn>Vr){var Mr=new va(Math.max(2*Vr,cn));Mr.set(Ae),Ae=Mr}},lt=Ce.f||0,We=Ce.p||0,Ue=Ce.b||0,at=Ce.l,mt=Ce.d,et=Ce.m,Mt=Ce.n,Bt=8*Oe;do{if(!at){lt=vl(xe,We,1);var Pt=vl(xe,We+1,3);if(We+=3,!Pt){var Ct=xe[(he=4+((We+7)/8|0))-4]|xe[he-3]<<8,ui=he+Ct;if(ui>Oe){it&&xl(0);break}Je&&Qe(Ue+Ct),Ae.set(xe.subarray(he,ui),Ue),Ce.b=Ue+=Ct,Ce.p=We=8*ui,Ce.f=lt;continue}if(Pt==1)at=$B,mt=XB,et=9,Mt=5;else if(Pt==2){var At=vl(xe,We,31)+257,Ht=vl(xe,We+10,15)+4,di=At+vl(xe,We+5,31)+1;We+=14;for(var Ti=new va(di),Xi=new va(19),mi=0;mi<Ht;++mi)Xi[GB[mi]]=vl(xe,We+3*mi,7);We+=3*Ht;var rr=Ix(Xi),nr=(1<<rr)-1,en=um(Xi,rr);for(mi=0;mi<di;){var he,ce=en[vl(xe,We,nr)];if(We+=15&ce,(he=ce>>4)<16)Ti[mi++]=he;else{var $e=0,Tt=0;for(he==16?(Tt=3+vl(xe,We,3),We+=2,$e=Ti[mi-1]):he==17?(Tt=3+vl(xe,We,7),We+=3):he==18&&(Tt=11+vl(xe,We,127),We+=7);Tt--;)Ti[mi++]=$e}}var Xe=Ti.subarray(0,At),Et=Ti.subarray(At);et=Ix(Xe),Mt=Ix(Et),at=um(Xe,et),mt=um(Et,Mt)}else xl(1);if(We>Bt){it&&xl(0);break}}Je&&Qe(Ue+131072);for(var qt=(1<<et)-1,Vt=(1<<Mt)-1,gi=We;;gi=We){var Qt=($e=at[Px(xe,We)&qt])>>4;if((We+=15&$e)>Bt){it&&xl(0);break}if($e||xl(2),Qt<256)Ae[Ue++]=Qt;else{if(Qt==256){gi=We,at=null;break}var Nt=Qt-254;Qt>264&&(Nt=vl(xe,We,(1<<(ri=WT[mi=Qt-257]))-1)+$T[mi],We+=ri);var Qi=mt[Px(xe,We)&Vt],wr=Qi>>4;if(Qi||xl(3),We+=15&Qi,Et=ZB[wr],wr>3){var ri=GT[wr];Et+=Px(xe,We)&(1<<ri)-1,We+=ri}if(We>Bt){it&&xl(0);break}Je&&Qe(Ue+131072);var Wi=Ue+Nt;if(Ue<Et){var Sr=0-Et,fr=Math.min(Et,Wi);for(Sr+Ue<0&&xl(3);Ue<fr;++Ue)Ae[Ue]=(void 0)[Sr+Ue]}for(;Ue<Wi;++Ue)Ae[Ue]=Ae[Ue-Et]}}Ce.l=at,Ce.p=gi,Ce.b=Ue,Ce.f=lt,at&&(lt=1,Ce.m=et,Ce.d=mt,Ce.n=Mt)}while(!lt);return Ue!=Ae.length&&Ze?(_t=Ae,((ct=Ue)==null||ct>_t.length)&&(ct=_t.length),new va(_t.subarray(0,ct))):Ae.subarray(0,Ue)})(te.subarray(ne,-8),{i:2},new va(((H=te)[(J=H.length)-4]|H[J-3]<<8|H[J-2]<<16|H[J-1]<<24)>>>0))));var H,J,te,ne;let _e=QB[W];if(!_e)throw new Error(`Unhandled codec: ${W}`);let de=new globalThis.DecompressionStream(_e);return new Response(new Blob([V]).stream().pipeThrough(de)).arrayBuffer().then((xe=>new Uint8Array(xe)))})(I,k).then((V=>((function(W,H){W.readFields(NB,H)})(new Lx(V),D),new t3[g](D.buffer)))),B.then((V=>{for(let W=A.length-1;W>=0;W--)switch(A[W]){case"delta_filter":VB(V,b);break;case"zigzag_filter":UB(V);break;case"bitshuffle_filter":qB(V,g);break;default:throw new qa(`Unhandled filter "${A[W]}"`)}return{layerName:a,blockIndex:w,data:V}})).catch((V=>{throw V}))})))},Ot(QT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ot(w_,"MapboxRasterTile"),Ot(JT,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class e2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class t2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ic(ht,16,0),this.featureIndexArray=new xg,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,a,u,p=0,g=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,u,p);let w=this.grid;for(let A=0;A<i.length;A++){let k=i[A],I=[1/0,1/0,-1/0,-1/0];for(let D=0;D<k.length;D++){let B=k[D];I[0]=Math.min(I[0],B.x),I[1]=Math.min(I[1],B.y),I[2]=Math.max(I[2],B.x),I[3]=Math.max(I[3],B.y)}g!==0&&(I[0]-=g,I[1]-=g,I[2]+=g,I[3]+=g),I[0]<ht&&I[1]<ht&&I[2]>=0&&I[3]>=0&&w.insert(b,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ft(new Jg(this.rawTileData)).layers,this.sourceLayerCoder=new e2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){let{tilespaceGeometry:s,transform:a,tileTransform:u,pixelPosMatrix:p,availableImages:g,worldview:b}=i;this.loadVTLayers(),this.serializedLayersCache.clear();let w=i.queryRadius?i.queryRadius:0,A=s.bufferedTilespaceBounds,k=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,((V,W,H,J)=>an(s.bufferedTilespaceGeometry,V-w,W-w,H+w,J+w)));k.sort(i3);let I=null;a.elevation&&k.length>0&&(I=$h.create(a.elevation,this.tileID));let D={},B;for(let V=0;V<k.length;V++){let W=k[V];if(W===B)continue;B=W;let H=this.featureIndexArray.get(W),J=null;this.is3DTile?this.loadMatchingModelFeature(D,H,e,s,a,b):this.loadMatchingFeature(D,H,e,g,b,((te,ne,_e,de=0)=>(J||(J=Ke(te,this.tileID.canonical,u)),ne.queryIntersectsFeature(s,te,_e,J,this.z,a,p,I,de))))}return D}loadMatchingFeature(e,i,s,a,u,p){let{featureIndex:g,bucketIndex:b,sourceLayerIndex:w,layoutVertexArrayOffset:A}=i,k=this.bucketLayerIDs[b],I=s.layers,D=Object.keys(I);if(D.length&&!ti(D,k))return;let B=s.sourceCache,V=this.sourceLayerCoder.decode(w),W=this.vtLayers[V].feature(g),H=this.getId(W,V);for(let J=0;J<k.length;J++){let te=k[J];if(!I[te])continue;let{styleLayer:ne,targets:_e}=I[te],de={};H!==void 0&&(de=B.getFeatureState(ne.sourceLayer,H));let xe=!p||p(W,ne,de,A);if(!xe)continue;let Ce=new Id(W,this.z,this.x,this.y,H);Ce.tile=this.tileID.canonical,Ce.state=de;let Ae=this.serializedLayersCache.get(te);Ae||(Ae=ne.serialize(),Ae.id=te,this.serializedLayersCache.set(te,Ae)),Ce.source=Ae.source,Ce.sourceLayer=Ae["source-layer"],Ce.layer=Object.assign({},Ae),Ce.layer.paint=i2(Ae.paint,ne.paint,W,de,a),Ce.layer.layout=i2(Ae.layout,ne.layout,W,de,a);let He=!1;for(let Oe of _e){this.updateFeatureProperties(Ce,Oe);let{filter:Ze}=Oe;if(Ze){if(W.properties=Ce.properties,Ze.needGeometry){let Je=Ne(W,!0);if(!Ze.filter(new Rr(this.tileID.overscaledZ,{worldview:u}),Je,this.tileID.canonical))continue}else if(!Ze.filter(new Rr(this.tileID.overscaledZ,{worldview:u}),W))continue}He=!0,Oe.targetId&&this.addFeatureVariant(Ce,Oe)}He&&this.appendToResult(e,te,g,Ce,xe)}}loadMatchingModelFeature(e,i,s,a,u,p){let{featureIndex:g,bucketIndex:b}=i,w=this.bucketLayerIDs[b],A=s.layers,k=Object.keys(A);if(!k.length||ti(k,w))for(let I=0;I<w.length;I++){let D=w[I],{styleLayer:B,targets:V}=A[D];if(B.type!=="model")continue;let W=a.tile,H=W.getBucket(B);if(!(H&&H instanceof m_))continue;let J=lB(H,g,a,u);if(!J)continue;let{z:te,x:ne,y:_e}=W.tileID.canonical,{feature:de,intersectionZ:xe,position:Ce}=J,Ae={};de.id!==void 0&&(Ae=s.sourceCache.getFeatureState(B.sourceLayer,de.id));let He=new Id({},te,ne,_e,de.id);He.tile=this.tileID.canonical,He.state=Ae,He.properties=de.properties,He.geometry={type:"Point",coordinates:[Ce.lng,Ce.lat]};let Oe=this.serializedLayersCache.get(D);Oe||(Oe=B.serialize(),Oe.id=D,this.serializedLayersCache.set(D,Oe)),He.source=Oe.source,He.sourceLayer=Oe["source-layer"],He.layer=Object.assign({},Oe);let Ze=!1;for(let Je of V){this.updateFeatureProperties(He,Je);let{filter:it}=Je;if(it){if(de.properties=He.properties,it.needGeometry){if(!it.filter(new Rr(this.tileID.overscaledZ,{worldview:p}),de,this.tileID.canonical))continue}else if(!it.filter(new Rr(this.tileID.overscaledZ,{worldview:p}),de))continue}Ze=!0,Je.targetId&&this.addFeatureVariant(He,Je)}Ze&&this.appendToResult(e,D,g,He,xe)}}updateFeatureProperties(e,i,s){if(i.properties){let a={};for(let u in i.properties){let p=i.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);p!=null&&(a[u]=p)}e.properties=a}}addFeatureVariant(e,i,s){let a={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(a)}appendToResult(e,i,s,a,u){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:s,feature:a,intersectionZ:u})}lookupSymbolFeatures(e,i,s,a,u,p){let g={};this.loadVTLayers();for(let b of e)this.loadMatchingFeature(g,{bucketIndex:i,sourceLayerIndex:s,featureIndex:b,layoutVertexArrayOffset:0},a,u,p);return g}loadFeature(e){let{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();let a=this.sourceLayerCoder.decode(s),u=this.vtFeatures[a];if(u[i])return u[i];let p=this.vtLayers[a].feature(i);return u[i]=p,p}hasLayer(e){for(let i of this.bucketLayerIDs)for(let s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){let a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){let u=ja(a);if(u.result!=="success"){let p=u.value.map((g=>`${g.key}: ${g.message}`)).join(", ");return void Zt(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=u.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[a];typeof s=="boolean"&&(s=Number(s))}return s}}function i2(r,e,i,s,a){return dt(r,((u,p)=>{let g=e instanceof Pc?e.get(p):null;return g&&g.evaluate?g.evaluate(i,s,void 0,a):g}))}function i3(r,e){return e-r}Ot(t2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let r2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class zx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let a=s>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);let u=r2[15&s];if(!u)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new zx(g,p,u,e)}constructor(e,i=64,s=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=r2.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+g+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Mx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:p,nodeSize:g}=this,b=[0,u.length-1,0],w=[];for(;b.length;){let A=b.pop()||0,k=b.pop()||0,I=b.pop()||0;if(k-I<=g){for(let W=I;W<=k;W++){let H=p[2*W],J=p[2*W+1];H>=e&&H<=s&&J>=i&&J<=a&&w.push(u[W])}continue}let D=I+k>>1,B=p[2*D],V=p[2*D+1];B>=e&&B<=s&&V>=i&&V<=a&&w.push(u[D]),(A===0?e<=B:i<=V)&&(b.push(I),b.push(D-1),b.push(1-A)),(A===0?s>=B:a>=V)&&(b.push(D+1),b.push(k),b.push(1-A))}return w}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:a,coords:u,nodeSize:p}=this,g=[0,a.length-1,0],b=[],w=s*s;for(;g.length;){let A=g.pop()||0,k=g.pop()||0,I=g.pop()||0;if(k-I<=p){for(let W=I;W<=k;W++)o2(u[2*W],u[2*W+1],e,i)<=w&&b.push(a[W]);continue}let D=I+k>>1,B=u[2*D],V=u[2*D+1];o2(B,V,e,i)<=w&&b.push(a[D]),(A===0?e-s<=B:i-s<=V)&&(g.push(I),g.push(D-1),g.push(1-A)),(A===0?e+s>=B:i+s>=V)&&(g.push(D+1),g.push(k),g.push(1-A))}return b}}function Mx(r,e,i,s,a,u){if(a-s<=i)return;let p=s+a>>1;n2(r,e,p,s,a,u),Mx(r,e,i,s,p-1,1-u),Mx(r,e,i,p+1,a,1-u)}function n2(r,e,i,s,a,u){for(;a>s;){if(a-s>600){let w=a-s+1,A=i-s+1,k=Math.log(w),I=.5*Math.exp(2*k/3),D=.5*Math.sqrt(k*I*(w-I)/w)*(A-w/2<0?-1:1);n2(r,e,i,Math.max(s,Math.floor(i-A*I/w+D)),Math.min(a,Math.floor(i+(w-A)*I/w+D)),u)}let p=e[2*i+u],g=s,b=a;for(hm(r,e,s,i),e[2*a+u]>p&&hm(r,e,s,a);g<b;){for(hm(r,e,g,b),g++,b--;e[2*g+u]<p;)g++;for(;e[2*b+u]>p;)b--}e[2*s+u]===p?hm(r,e,s,b):(b++,hm(r,e,b,a)),b<=i&&(s=b+1),i<=b&&(a=b-1)}}function hm(r,e,i,s){Ox(r,i,s),Ox(e,2*i,2*s),Ox(e,2*i+1,2*s+1)}function Ox(r,e,i){let s=r[e];r[e]=r[i],r[i]=s}function o2(r,e,i,s){let a=r-i,u=e-s;return a*a+u*u}n.$=Nl,n.A=Hs,n.B=Lc,n.C=2,n.D=Rh,n.E=ha,n.F=$f,n.G=LS,n.H=Ts,n.I=kn,n.J=of,n.K=Fl,n.L=vc,n.M=oh,n.N=nh,n.O=Gp,n.P=st,n.Q=ch,n.R=ua,n.S=pu,n.T=Wv,n.U=ja,n.V=f_,n.W=Zp,n.X=Cs,n.Y=co,n.Z=eo,n._=ao,n.a=function(r){return yr.API_CDN_URL_REGEX.test(r)},n.a$=_u,n.a0=Jt,n.a1=mc,n.a2=fu,n.a3=class extends f_{},n.a4=sh,n.a5=Wp,n.a6=Me,n.a7=function(r){let e=r.value;return e?Jt(e)?xx(e,!0)?[]:[new f_(r.key,e,`invalid url "${e}"`)]:[new f_(r.key,e,`string expected, "${Fl(e)}" found`)]:[]},n.a8=cg,n.a9=hn,n.aA=X,n.aB=yt,n.aC=_o,n.aD=Yo,n.aE=$n,n.aF=K,n.aG=Ge,n.aH=function(r,e){let i={};for(let s=0;s<e.length;s++){let a=e[s];a in r&&(i[a]=r[a])}return i},n.aI=O,n.aJ=$,n.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,s){let a=this.entries[r]=this.entries[r]||{callbacks:[]};if(a.result){let[u,p]=a.result;return this.scheduler?this.scheduler.add((()=>{s(u,p)}),e):s(u,p),()=>{}}return a.callbacks.push(s),a.cancel||(a.cancel=i(((u,p)=>{a.result=[u,p];for(let g of a.callbacks)this.scheduler?this.scheduler.add((()=>{g(u,p)}),e):g(u,p);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{a.result||(a.callbacks=a.callbacks.filter((u=>u!==s)),a.callbacks.length||(a.cancel(),delete this.entries[r]))}}},n.aL=function(r,e,i){let s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(a=>{let u=Ma(r.request,((p,g,b)=>{p?a(p):g&&a(null,{vectorTile:i?void 0:new Ft(new Jg(g)),rawData:g,responseHeaders:new Map(b.entries())})}));return()=>{u.cancel(),a()}}),e)},n.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},n.aN=function(r){Ka++,Ka>Hn&&(r.getActor().send("enforceCacheSizeLimit",Ya),Ka=0)},n.aO=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},n.aP=Wn,n.aQ=sT,n.aR=hT,n.aS=F,n.aT=oT,n.aU=function(r,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){let a=document.createElement("source");Ni(r[s])||(i.crossOrigin="Anonymous"),a.src=r[s],i.appendChild(a)}return{cancel:()=>{}}},n.aV=qf,n.aW=Pd,n.aX=Fe,n.aY=Jf,n.aZ=se,n.a_=ie,n.aa=pt,n.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return mr(r.expression.evaluate(e))}interpolate(r,e,i){return{x:$t(r.x,e.x,i),y:$t(r.y,e.y,i),z:$t(r.z,e.z,i),azimuthal:$t(r.azimuthal,e.azimuthal,i),polar:$t(r.polar,e.polar,i)}}},n.ac=Rr,n.ad=Hl,n.ae=ze,n.af=Wr,n.ag=kr,n.ah=le,n.ai=Pc,n.aj=Au,n.ak=$t,n.al=ht,n.am=Ml,n.an=Bi,n.ao=cr,n.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,s]){let a=mr([1,i,s]);return{x:a.x,y:a.y,z:a.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:$t(r.x,e.x,i),y:$t(r.y,e.y,i),z:$t(r.z,e.z,i)}}},n.aq=function(r,e,i=0,s=!0){let a=new st(i,i),u=r.sub(a),p=e.add(a),g=[u,new st(p.x,u.y),p,new st(u.x,p.y)];return s&&g.push(u.clone()),g},n.ar=function(r,e){let i=[];for(let s=0;s<r.length;s++){let a=Te(s-1,-1,r.length-1),u=Te(s+1,-1,r.length-1),p=r[s],g=r[u],b=r[a].sub(p).unit(),w=g.sub(p).unit(),A=w.angleWithSep(b.x,b.y),k=b.add(w).unit().mult(-1*e/Math.sin(A/2));i.push(p.add(k))}return i},n.as=WS,n.at=an,n.au=function(r,e,i=0){return Si(((e.x-i)*r.scale-r.x)*ht,(e.y*r.scale-r.y)*ht,ge(e.z,e.y))},n.av=on,n.aw=Er,n.ax=yi,n.ay=nS,n.az=function(r){let e=1/0,i=1/0,s=-1/0,a=-1/0;for(let u of r)e=Math.min(e,u.x),i=Math.min(i,u.y),s=Math.max(s,u.x),a=Math.max(a,u.y);return{min:new st(e,i),max:new st(s,a)}},n.b=function(r){return yr.API_FONTS_REGEX.test(r)},n.b$=zv,n.b0=Yr,n.b1=je,n.b2=_g,n.b3=u_,n.b4=function(){cs.isLoading()||cs.isLoaded()||tf()!=="deferred"||rf()},n.b5=mh,n.b6=Ne,n.b7=Id,n.b8=un,n.b9=Jv,n.bA=Cr,n.bB=oe,n.bC=function(r,e){let{x:i,y:s}=r.point,a=S1(i,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return yt(a,a,vv(Ql(e)))},n.bD=Y,n.bE=Qo,n.bF=Kr,n.bG=nn,n.bH=Mn,n.bI=_n,n.bJ=qh,n.bK=Rs,n.bL=sx,n.bM=function(r,e,i,s,a){let u=5*e+2;r.float32[u+0]=i,r.float32[u+1]=s,r.float32[u+2]=a},n.bN=Zh,n.bO=Ia,n.bP=is,n.bQ=qo,n.bR=Xc,n.bS=Te,n.bT=function(r,e,i,s){var a=new j(4);return a[0]=r,a[1]=e,a[2]=i,a[3]=s,a},n.bU=class{isDataAvailableAtPoint(r){let e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;let i=e.getSource().maxzoom,s=1<<i,a=Math.floor(r.x),u=Math.floor((r.x-a)*s),p=Math.floor(r.y*s),g=this.findDEMTileFor(new Wn(i,a,i,u,p));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let s=this._source();if(!s||r.y<0||r.y>1)return e;let a=s.getSource().maxzoom,u=1<<a,p=Math.floor(r.x),g=r.x-p,b=new Wn(a,p,a,Math.floor(g*u),Math.floor(r.y*u)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;let A=w.dem,k=1<<w.tileID.canonical.z,I=(g*k-w.tileID.canonical.x)*A.dim,D=(r.y*k-w.tileID.canonical.y)*A.dim,B=Math.floor(I),V=Math.floor(D);return(i?this.exaggeration():1)*$t($t(A.get(B,V),A.get(B,V+1),D-V),$t(A.get(B+1,V),A.get(B+1,V+1),D-V),I-B)}static getAtTileOffset(r,e,i,s){let a=1<<r.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new ze(r.wrap+(r.canonical.x+e.x/ht)/a,(r.canonical.y+e.y/ht)/a)):0}static getAtTileOffsetFunc(r,e,i,s){return(a,u,p)=>{let g=this.getAtTileOffset(r,a,u,p),b=s.upVector(r.canonical,a.x,a.y);return er(b,b,g*s.upVectorScale(r.canonical,e,i).metersToTile),b}}getForTilePoints(r,e,i,s){if(this.isUsingMockSource())return!1;let a=$h.create(this,r,s);return!!a&&(e.forEach((u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],i)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(r);if(!e||!e.dem)return null;let i=e.dem.tree,s=e.tileID,a=1<<r.canonical.z-s.canonical.z,u=r.canonical.x/a-s.canonical.x,p=r.canonical.y/a-s.canonical.y,g=0;for(let b=0;b<r.canonical.z-s.canonical.z&&!i.leaves[g];b++){u*=2,p*=2;let w=2*Math.floor(p)+Math.floor(u);g=i.childOffsets[g]+w,u%=1,p%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let a of r){let u=this.getMinMaxForTile(a.tileID);u&&(i=Math.min(i,u.min),s=Math.max(s,u.max),e=!0)}return e?{min:i,max:s}:null}},n.bV=Vg,n.bW=yn,n.bX=to,n.bY=ew,n.bZ=pT,n.b_=nw,n.ba=Iv,n.bb=Ke,n.bc=Xo,n.bd=Sh,n.be=_1,n.bf=tn,n.bg=Mh,n.bh=yx,n.bi=function(r,e){let i=Au(e.zoom);if(i===0)return Ql(r);let s=Pg(r),a=yv(s),u=K(s.getWest())*e.worldSize,p=K(s.getEast())*e.worldSize,g=$(s.getNorth())*e.worldSize,b=$(s.getSouth())*e.worldSize,w=[u,g,0],A=[p,g,0],k=[u,b,0],I=[p,b,0],D=tt([],e.globeMatrix);return Wr(w,w,D),Wr(A,A,D),Wr(k,k,D),Wr(I,I,D),a[0]=Dc(a[0],k,i),a[1]=Dc(a[1],I,i),a[2]=Dc(a[2],A,i),a[3]=Dc(a[3],w,i),wi.fromPoints(a)},n.bj=zg,n.bk=tt,n.bl=Af,n.bm=Dc,n.bn=zc,n.bo=AO,n.bp=lr,n.bq=qe,n.br=w_,n.bs=Jg,n.bt=Ma,n.bu=function(r,e){let i=[];for(let s in r)s in e||i.push(s);return i},n.bv=we,n.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bx=oa,n.by=Se,n.bz=Re,n.c=Ri,n.c$=function(r){return r*r*r*r*r},n.c0=nx,n.c1=FS,n.c2=dx,n.c3=zx,n.c4=er,n.c5=Ca,n.c6=ts,n.c7=function(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],p=e[3],g=Math.sin(i),b=Math.cos(i);return r[0]=s*b+a*g,r[1]=a*b-s*g,r[2]=u*b+p*g,r[3]=p*b-u*g,r},n.c8=Us,n.c9=sn,n.cA=dr,n.cB=Uw,n.cC=zs,n.cD=x1,n.cE=function(r,e,i,s,a,u,p,g,b){if(b.name==="globe")return x1(r,e,new zs(i,s,a),!1);let w=Jf({z:i,x:s,y:a},b);return new wi([(u+w.x/w.scale)*e,e*(w.y/w.scale),p],[(u+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},n.cF=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},n.cG=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},n.cH=function(r){let e=Math.round((r+45+360)%360/90)%4;return ki[e]},n.cI=ae,n.cJ=na,n.cK=t,n.cL=function(r){let e=Re(new Float64Array(16));yt(e,r.pixelMatrix,r.globeMatrix);let i=[0,_,0],s=[0,x,0];return Wr(i,i,e),Wr(s,s,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!bv(r,new F(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!bv(r,new F(r.center.lat,-90))]},n.cM=function(r,e){let{scale:i}=r.tileTransform,s=i*ht/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(a,u,p){var g=u[1],b=u[2],w=u[3],A=p[0],k=p[1];return a[0]=u[0]*A,a[1]=g*A,a[2]=b*k,a[3]=w*k,a})(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},n.cN=Hg,n.cO=Hi,n.cP=Vw,n.cQ=function(r){let e=Vw(r,!0);return Y([],[e[0],e[1],e[4],e[5]])},n.cR=St,n.cS=gr,n.cT=ai,n.cU=function(r){let{x:e,y:i}=r.point,{lng:s,lat:a}=r._center;return S1(e,i,r.worldSize,s,a)},n.cV=Mi,n.cW=bn,n.cX=Ms,n.cY=vn,n.cZ=l,n.c_=function(r,e,i){let s=0;for(let a=0;a<2;++a)r[a]>0&&(s+=(r[a]-0)*(r[a]-0)),e[a]<0&&(s+=(0-e[a])*(0-e[a]));return s},n.ca=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.cb=li,n.cc=function(r,e,i,s,a){var u=1/Math.tan(e/2);if(r[0]=u/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0){var p=1/(s-a);r[10]=(a+s)*p,r[14]=2*a*s*p}else r[10]=-1,r[14]=-2*s;return r},n.cd=function(r,e,i,s,a,u,p){var g=1/(e-i),b=1/(s-a),w=1/(u-p);return r[0]=-2*g,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(e+i)*g,r[13]=(a+s)*b,r[14]=(p+u)*w,r[15]=1,r},n.ce=ee,n.cf=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},n.cg=Ih,n.ch=Su,n.ci=An,n.cj=Va,n.ck=xd,n.cl=XS,n.cm=function(){var r=new j(4);return j!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.cn=function(r,e,i){var s=e[0],a=e[1],u=e[2],p=e[3],g=Math.sin(i),b=Math.cos(i);return r[0]=s*b+u*g,r[1]=a*b+p*g,r[2]=s*-g+u*b,r[3]=a*-g+p*b,r},n.co=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.cp=es,n.cq=function(r){var e=r[0],i=r[1],s=r[2],a=r[3];return Math.sqrt(e*e+i*i+s*s+a*a)},n.cr=Cl,n.cs=zo,n.ct=Ua,n.cu=3,n.cv=2,n.cw=7,n.cx=6,n.cy=Vs,n.cz=hi,n.d=function(r){return yr.API_TILEJSON_REGEX.test(r)},n.d$=E1,n.d0=G,n.d1=45,n.d2=vd,n.d3=function(r,e,i){let s=Math.sqrt(r*r+e*e+i*i),a=s>0?Math.acos(i/s)*dc:0,u=r!==0||e!==0?Math.atan2(-e,-r)*dc+90:0;return u<0&&(u+=360),[s,u,a]},n.d4=Si,n.d5=mr,n.d6=ve,n.d7=oi,n.d8=wi,n.d9=mo,n.dA=Sf,n.dB=class extends Qs{constructor(r){super(r),this.current=hv}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.dC=kl,n.dD=function(r,e,i){let s=Au(i.zoom),a=r.style.map._antialias,u=r.terrain&&r.terrain.exaggeration()>0;return s===0&&!a&&!u},n.dE=function(r){let e=r.pixelsPerMeter,i=e/ee(1,r.center.lat),s=Re(new Float64Array(16));return qe(s,s,[r.point.x,r.point.y,0]),St(s,s,[i,i,e]),Float32Array.from(s)},n.dF=Pg,n.dG=function(r){let e=ae-5;r=X(r,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(Bi(r))),3);return Math.round(i*(f.length-1))},n.dH=function(r,e,i,s){let a=e.getNorth(),u=e.getSouth(),p=e.getWest(),g=e.getEast(),b=1<<r.z,w=g-p,A=a-u,k=w/c,I=-A/f[i],D=[0,k,0,I,0,0,a,p,0];if(r.z>0){let B=180/s;be(D,D,[B/w+1,0,0,0,B/A+1,0,-.5*B/k,.5*B/I,1])}return D[2]=b,D[5]=r.x,D[8]=r.y,D},n.dI=Ql,n.dJ=function(r,e,i){let s=Re(new Float64Array(16)),a=(e/(1<<r)-.5)*Math.PI*2;return pi(s,i.globeMatrix,a),Float32Array.from(s)},n.dK=D1,n.dL=Ig,n.dM=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dN=re,n.dO=function(r,e){var i=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=i,r[2]=0,r[3]=-i,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dP=Ta,n.dQ=w1,n.dR=Ii,n.dS=Br,n.dT=256,n.dU=function(r,e){let i=[0,0,0];return Wr(i,i,zg(Ql(e.canonical))),Wr(i,i,r),i},n.dV=r=>({u_matrix:new xd(r),u_texsize:new Va(r),u_pixels_to_tile_units:new Tf(r),u_device_pixel_ratio:new An(r),u_width_scale:new An(r),u_floor_width_scale:new An(r),u_image:new Ih(r),u_units_to_pixels:new Va(r),u_tile_units_to_pixels:new An(r),u_alpha_discard_threshold:new An(r),u_trim_offset:new Va(r),u_trim_fade_range:new Va(r),u_trim_color:new vd(r),u_emissive_strength:new An(r),u_zbias_factor:new An(r),u_tile_to_meter:new An(r),u_ground_shadow_factor:new Su(r),u_pattern_transition:new An(r)}),n.dW=r=>({u_matrix:new xd(r),u_pixels_to_tile_units:new Tf(r),u_device_pixel_ratio:new An(r),u_width_scale:new An(r),u_floor_width_scale:new An(r),u_units_to_pixels:new Va(r),u_dash_image:new Ih(r),u_gradient_image:new Ih(r),u_image_height:new An(r),u_texsize:new Va(r),u_tile_units_to_pixels:new An(r),u_alpha_discard_threshold:new An(r),u_trim_offset:new Va(r),u_trim_fade_range:new Va(r),u_trim_color:new vd(r),u_emissive_strength:new An(r),u_zbias_factor:new An(r),u_tile_to_meter:new An(r),u_ground_shadow_factor:new Su(r)}),n.dX=r=>({u_camera_to_center_distance:new An(r),u_extrude_scale:new Tf(r),u_device_pixel_ratio:new An(r),u_matrix:new xd(r),u_inv_rot_matrix:new xd(r),u_merc_center:new Va(r),u_tile_id:new Su(r),u_zoom_transition:new An(r),u_up_dir:new Su(r),u_emissive_strength:new An(r)}),n.dY=vu,n.dZ=fD,n.d_=class{constructor(r,e,i,s){this.context=r,this.format=s,this.size=i,this.texture=r.gl.createTexture();let[a,u,p]=this.size,{gl:g}=r;g.bindTexture(g.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&g.texImage3D(g.TEXTURE_3D,0,this.format,a,u,p,0,Uv(this.format),qv(this.format),e.data)}bind(r,e){let{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.da=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.db=jw,n.dc=Yv,n.dd=Gw,n.de=xx,n.df=function(r,e){return r.readFields(dB,{icons:[]},e)},n.dg=Ug,n.dh=Wh,n.di=lx,n.dj=pc,n.dk=lg,n.dl=aa,n.dm=ko,n.dn=jt,n.dp=function(r){let e=r.indexOf(pd);return e>=0?r.slice(0,e):r},n.dq=function(r){return r.indexOf(pd)>=0},n.dr=function(r){let e=r.lastIndexOf(pd);return e>=0?r.slice(e+1):""},n.ds=function(r){let e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.dt=function(r,e,i,s){return r.type==="custom"?new nB(r,e):new cB[r.type](r,e,i,s)},n.du=rt,n.dv=function(r){let e=r.indexOf(pd);return e>=0?r.slice(e+1):""},n.dw=class extends Id{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){let r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.dx=ef,n.dy=xs,n.dz=function(r){return r({pluginStatus:Fo,pluginURL:Xl}),ef.on("pluginStateChange",r),r},n.e=yr,n.e$=function([r,e,i]){let s=Math.hypot(r,e,i),a=Math.atan2(r,i),u=.5*Math.PI-Math.acos(-e/s);return new F(bn(a),bn(u))},n.e0=(r,e,i,s,a,u)=>{let p=r.transform,g=p.projection.name==="globe",b;if(u.paint.get("circle-pitch-alignment")==="map")if(g){let A=w1(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([A,0,0,A])}else b=p.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(p.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Zr.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:zO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){w.u_inv_rot_matrix=s,w.u_merc_center=a,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Au(p.zoom);let A=a[0]*ht,k=a[1]*ht;w.u_up_dir=p.projection.upVector(new zs(0,0,0),A,k)}return w},n.e1=lS,n.e2=Io,n.e3=(r,e,i,s,a,u,p,g,b,w)=>{let A=r.transform,k=A.pitch<15?oS(.07,.7,X((14-A.zoom)/5,0,1)):.07,I=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:aS(r,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:u,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:sS(e,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(I?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:ve(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:w}},n.e4=(r,e,i,s,a,u,p,g,b,w)=>{let A=r.transform,k=A.calculatePixelsToTileUnitsMatrix(e),I=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=A.pitch<15?oS(.07,.7,X((14-A.zoom)/5,0,1)):.07;return{u_matrix:aS(r,e,i,s),u_pixels_to_tile_units:k,u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:g,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:cS(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:sS(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(I?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:ve(e.tileID.canonical,0),u_ground_shadow_factor:w}},n.e5=Pe,n.e6=kf,n.e7=ge,n.e8=Rc,n.e9=jg,n.eA=Sx,n.eB=Xg,n.eC=$g,n.eD=[1,1,1],n.eE=$h,n.eF=go,n.eG=function(r,e,i,s){var a=e[0],u=e[1],p=e[2],g=e[3];return r[0]=a+s*(i[0]-a),r[1]=u+s*(i[1]-u),r[2]=p+s*(i[2]-p),r[3]=g+s*(i[3]-g),r},n.eH=Nh,n.eI=Js,n.eJ=Jl,n.eK=function(r,e,i,s,a,u,p,g,b,w,A,k,I,D,B,V){var W=new j(16);return W[0]=r,W[1]=e,W[2]=i,W[3]=s,W[4]=a,W[5]=u,W[6]=p,W[7]=g,W[8]=b,W[9]=w,W[10]=A,W[11]=k,W[12]=I,W[13]=D,W[14]=B,W[15]=V,W},n.eL=P,n.eM=gf,n.eN=md,n.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){let i=iw(new st(0,0),new st(ht,ht),r),s=[];if(e&&!Pv(i,this._globalClipBounds))return s;for(let a of this._activeRegions){if(a.hiddenByOverlap||!Pv(i,a))continue;let u=aR(a.min,a.max,r);s.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return s}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let s of e.cache.getVisibleCoordinates()){let a=e.cache.getTile(s).buckets[e.layer];a&&a.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){let e=r.getFootprints();if(e.length===0)return;let i=r.getOrder(),s=r.getClipMask(),a=r.getClipScope();for(let u of e){if(!u.footprint)continue;let p=iw(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:i,clipMask:s,clipScope:a})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||Bg(e.min,i.min)||Bg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(s,a){let u=(p,g)=>p+g;return s.length-a.length||s.reduce(u,"").localeCompare(a.reduce(u,""))})(e.clipScope,i.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){let i=this._activeRegions[e],s=this._prevRegions[e];r=i.priority!==s.priority||!tw(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!oa(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(r){++this._updateTime;for(let i of this._activeRegions)i.order!==Of&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));let e=i=>{let s=this._activeRegions;if(i>=s.length)return i;let a=s[i].priority;for(;i<s.length&&s[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let a=i,u=i;for(;a!==s;){let p=this._activeRegions[a];p.hiddenByOverlap=!1;for(let g=0;g<u;g++){let b=this._activeRegions[g];if(!b.hiddenByOverlap&&p.order===Of&&Pv(p,b)&&(p.hiddenByOverlap=rw(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++a}i=s,s=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eP=Of,n.eQ=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let r of this._poleSegments)r.destroy();for(let r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){let i=new Xo,s=new Yr,a=[],u=r+1+2,p=e[0]+1,g=e[0]+1+(1+e.length),b=(w,A,k)=>{let I=w===u-1?w-2:w===0?w:w-1;return I+=k?24575:0,[I,A]};for(let w=0;w<u;++w)i.emplaceBack(...b(w,0,!0));for(let w=0;w<p;++w)for(let A=0;A<u;++A)i.emplaceBack(...b(A,w,(A===0||A===u-1)&&!0));for(let w=0;w<e.length;++w){let A=e[w];for(let k=0;k<u;++k)i.emplaceBack(...b(k,A,!0))}for(let w=0;w<e.length;++w){let A=s.length,k=e[w]+1+2,I=new Yr;for(let V=0;V<k-1;V++){let W=V===k-2,H=W?u*(g-e.length+w-V):u;for(let J=0;J<u-1;J++){let te=V*u+J;V===0||W||J===0||J===u-2?(I.emplaceBack(te+1,te,te+H),I.emplaceBack(te+H,te+H+1,te+1)):(s.emplaceBack(te+1,te,te+H),s.emplaceBack(te+H,te+H+1,te+1))}}let D=tn.simpleSegment(0,A,i.length,s.length-A);for(let V=0;V<I.uint16.length;V+=3)s.emplaceBack(I.uint16[V],I.uint16[V+1],I.uint16[V+2]);let B=tn.simpleSegment(0,A,i.length,s.length-A);a.push({withoutSkirts:D,withSkirts:B})}return{vertices:i,indices:s,segments:a}}_createGrid(r){let e=this._fillGridMeshWithLods(c,f);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,_1.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){let e=new Yr;for(let p=0;p<=c;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);let i=new Oc,s=new Oc,a=new Oc,u=new Oc;this._poleSegments=[];for(let p=0,g=0;p<l;p++){let b=360/(1<<p);i.emplaceBack(0,-Yo,0,.5,0),s.emplaceBack(0,-Yo,0,.5,1),a.emplaceBack(0,-Yo,0,.5,.5),u.emplaceBack(0,-Yo,0,.5,.5);for(let w=0;w<=c;w++){let A=w/c,k=0,I=$t(0,b,A),[D,B,V]=S(PO,LO,I,Yo);i.emplaceBack(D,B,V,A,k),s.emplaceBack(D,B,V,A,1-k);let W=Bi(I);A=.5+.5*Math.sin(W),k=.5+.5*Math.cos(W),a.emplaceBack(D,B,V,A,k),u.emplaceBack(D,B,V,A,1-k)}this._poleSegments.push(tn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,zh,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,zh,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(a,zh,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(u,zh,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.eR=Q1,n.eS=Le,n.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.eU=Z,n.eV=ue,n.eW=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.eX=lc,n.eY=E,n.eZ=Uo,n.e_=Ai,n.ea=yw,n.eb=Iu,n.ec=lw,n.ed=aw,n.ee=pe,n.ef=function(r,e){if(r===e){var i=e[1],s=e[2],a=e[3],u=e[6],p=e[7],g=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=u,r[11]=e[14],r[12]=a,r[13]=p,r[14]=g}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.eg=rB,n.eh=Li,n.ei=yf,n.ej=256,n.ek=vv,n.el=ks,n.em=pi,n.en=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.eo=Oc,n.ep=mf,n.eq=tg,n.er=function(r,e,i,s,a){return X((r-e)/(i-e)*(a-s)+s,s,a)},n.es=Aa,n.et=function(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],p=e[4],g=e[5],b=e[6],w=e[7],A=e[8],k=A*p-g*w,I=-A*u+g*b,D=w*u-p*b,B=i*k+s*I+a*D;return B?(r[0]=k*(B=1/B),r[1]=(-A*s+a*w)*B,r[2]=(g*s-a*p)*B,r[3]=I*B,r[4]=(A*i-a*b)*B,r[5]=(-g*i+a*u)*B,r[6]=D*B,r[7]=(-w*i+s*b)*B,r[8]=(p*i-s*u)*B,r):null},n.eu=2,n.ev=oo,n.ew=Ea,n.ex=Wt,n.ey=function(r,e){var i=new j(3);Wt(i,e);var s=1/i[0],a=1/i[1],u=1/i[2],p=e[0]*s,g=e[1]*a,b=e[2]*u,w=e[4]*s,A=e[5]*a,k=e[6]*u,I=e[8]*s,D=e[9]*a,B=e[10]*u,V=p+A+B,W=0;return V>0?(W=2*Math.sqrt(V+1),r[3]=.25*W,r[0]=(k-D)/W,r[1]=(I-b)/W,r[2]=(g-w)/W):p>A&&p>B?(W=2*Math.sqrt(1+p-A-B),r[3]=(k-D)/W,r[0]=.25*W,r[1]=(g+w)/W,r[2]=(I+b)/W):A>B?(W=2*Math.sqrt(1+A-p-B),r[3]=(I-b)/W,r[0]=(g+w)/W,r[1]=.25*W,r[2]=(k+D)/W):(W=2*Math.sqrt(1+B-p-A),r[3]=(g-w)/W,r[0]=(I+b)/W,r[1]=(k+D)/W,r[2]=.25*W),r},n.ez=function(r,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>R?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),i},n.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},n.f0=Tl,n.f1=Gv,n.f2=function(r){let e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(dn==null){let s=i.navigator?i.navigator.userAgent:null;dn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return dn})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.f3=function(r,e){Ya=r,Hn=e},n.f4=bv,n.f5=T1,n.f6=function(r){let e=[0,0,0],i=Re(new Float64Array(16));return yt(i,r.pixelMatrix,r.globeMatrix),Wr(e,e,i),new st(e[0],e[1])},n.f7=function(){let r=jf;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Bv),jf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.f8=function(){Ug().acquire(Bv)},n.f9=tf,n.fA=nt,n.fB=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==Rw){let i=new Uint32Array(r,0,7),[,,s,a,u,p]=i;e=i.byteLength+a+u+p+u,(s!==r.byteLength||e>=r.byteLength)&&Zt("Invalid b3dm header information.")}return Nw(r,e)},n.fC=function(r,e){let i=Yv(r);for(let s of i){for(let a of s.meshes)FR(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(NR(s.lights,e)))}return i},n.fD=m_,n.fE=Hr,n.fF=Pw,n.fG=cs,n.fH=ls,n.fI=function(r){ca(),Kn?.then((e=>{e.keys().then((i=>{for(let s=0;s<i.length-r;s++)e.delete(i[s]).catch((a=>Zt(a.message)))})).catch((i=>Zt(i.message)))})).catch((e=>Zt(e.message)))},n.fa=function(r,e,i=!1){if(Fo===ls.deferred||Fo===ls.loading||Fo===ls.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xl=Zr.resolveURL(r),Fo=ls.deferred,Jp=e,Qp(),i||rf()},n.fb=function(r){Dh=Zr.resolveURL(r),Bh||(Bh=new Rh(Ug(),new ha)),Bh.broadcast("setMeshoptUrl",Dh)},n.fc=Mw,n.fd=function(r){Nv=Zr.resolveURL(r),Bh||(Bh=new Rh(Ug(),new ha)),Bh.broadcast("setDracoUrl",Nv)},n.fe=zw,n.ff=Nf,n.fg=function(r){let e=ys();if(!e)return;let i=e.delete(la);r&&i.then((()=>r())).catch(r)},n.fh=Td,n.fi=Ot,n.fj=ku,n.fk=yl,n.fl=e2,n.fm=t2,n.fn=tS,n.fo=It,n.fp="hd_road_elevation",n.fq=ci,n.fr=dt,n.fs=Bc,n.ft=ax,n.fu=Ad,n.fv=function(r,e,i,s,a,u,p,g=1,b,w,A){r.createArrays(),r.tilePixelRatio=ht/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;let k=r.layers[0].layout,I=r.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=g,D.textSizeScaleRange=k.get("text-size-scale-range"),D.iconSizeScaleRange=k.get("icon-size-scale-range");let[B,V]=D.textSizeScaleRange,[W,H]=D.iconSizeScaleRange;D.textScaleFactor=X(D.scaleFactor,B,V),D.iconScaleFactor=X(D.scaleFactor,W,H);let J=I["text-size"],te=I["icon-size"];if(r.textSizeData.kind==="composite"){let{minZoom:Ae,maxZoom:He}=r.textSizeData;D.compositeTextSizes=[J.possiblyEvaluate(new Rr(Ae,{worldview:A}),u),J.possiblyEvaluate(new Rr(He,{worldview:A}),u)]}if(r.iconSizeData.kind==="composite"){let{minZoom:Ae,maxZoom:He}=r.iconSizeData;D.compositeIconSizes=[te.possiblyEvaluate(new Rr(Ae,{worldview:A}),u),te.possiblyEvaluate(new Rr(He,{worldview:A}),u)]}D.layoutTextSize=J.possiblyEvaluate(new Rr(p+1,{worldview:A}),u),D.layoutIconSize=te.possiblyEvaluate(new Rr(p+1,{worldview:A}),u),D.textMaxSize=J.possiblyEvaluate(new Rr(18,{worldview:A}),u);let ne=k.get("symbol-placement"),_e=k.get("text-rotation-alignment")==="map"&&ne!=="point",de=k.get("text-size"),xe=!1,Ce=[];for(let Ae of r.features){let He=k.get("text-font").evaluate(Ae,{},u).join(","),Oe=de.evaluate(Ae,{},u)*D.textScaleFactor,Ze=D.layoutTextSize.evaluate(Ae,{},u)*D.textScaleFactor,Je=D.layoutIconSize.evaluate(Ae,{},u)*D.iconScaleFactor,it={horizontal:{},vertical:void 0},_t=Ae.text,ct,Qe=[0,0];if(_t){let Ti=_t.toString(),Xi=k.get("text-letter-spacing").evaluate(Ae,{},u)*to,mi=k.get("text-line-height").evaluate(Ae,{},u)*to,rr=sg(Ti)?Xi:0,nr=k.get("text-anchor").evaluate(Ae,{},u),en=k.get("text-variable-anchor");if(!en){let Xe=k.get("text-radial-offset").evaluate(Ae,{},u);if(Xe)Qe=FS(nr,[Xe*to,ux]);else{let Et=k.get("text-offset").evaluate(Ae,{},u);Qe=[Et[0]*to,Et[1]*to]}}let he=_e?"center":k.get("text-justify").evaluate(Ae,{},u),ce=ne==="point",$e=ce?k.get("text-max-width").evaluate(Ae,{},u)*to:1/0,Tt=Xe=>{r.allowVerticalPlacement&&Xp(Ti)&&(it.vertical=rx(_t,e,i,a,He,$e,mi,nr,Xe,rr,Qe,Rs.vertical,!0,Ze,Oe,b))};if(!_e&&en){let Xe=he==="auto"?en.map((qt=>dx(qt))):[he],Et=!1;for(let qt=0;qt<Xe.length;qt++){let Vt=Xe[qt];if(!it.horizontal[Vt])if(Et)it.horizontal[Vt]=it.horizontal[0];else{let gi=rx(_t,e,i,a,He,$e,mi,"center",Vt,rr,Qe,Rs.horizontal,!1,Ze,Oe,b);gi&&(it.horizontal[Vt]=gi,Et=gi.positionedLines.length===1)}}Tt("left")}else{if(he==="auto"&&(he=dx(nr)),ce||k.get("text-writing-mode").indexOf("horizontal")>=0||!Xp(Ti)){let Xe=rx(_t,e,i,a,He,$e,mi,nr,he,rr,Qe,Rs.horizontal,!1,Ze,Oe,b);Xe&&(it.horizontal[he]=Xe)}Tt(ce?"left":he)}}let lt,We,Ue,at,mt,et,Mt=!1,Bt=k.get("icon-text-fit").evaluate(Ae,{},u);if(Ae.icon&&Ae.icon.hasPrimary()){let Ti=Yf(Ae.icon,r.iconSizeData,I["icon-size"],u,r.zoom,Ae,b,D.iconScaleFactor,A);lt=Ti.iconPrimary,Ue=Ti.iconSecondary;let Xi=lt.toString();if(We=s.get(Xi),We&&(mt=k.get("icon-offset").evaluate(Ae,{},u),et=k.get("icon-anchor").evaluate(Ae,{},u),ct=e_(a.get(Xi),Ue?a.get(Ue.toString()):void 0,mt,et),Mt=We.sdf,r.sdfIcons===void 0?r.sdfIcons=We.sdf:r.sdfIcons!==We.sdf&&Zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==r.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ue){let mi=Ue.toString();at=s.get(mi)}}xe=xe||!(!Ae.icon||!Ae.icon.hasSecondary());let Pt=hx(it.horizontal)||it.vertical;r.iconsInText||(r.iconsInText=!!Pt&&Pt.iconsInText);let Ct=Ze*D.textScaleFactor/to,{defaultShapedIcon:ui,verticallyShapedIcon:At}=qD(r,ct,k,Ae,u,it,Ct,mt,Bt);Bt!=="none"&&ct&&(SS(ct)||TS(ct))&&(o_(0,We,lt,ct,ui,Bt,w,s,a),o_(0,at,Ue,ct,ui,Bt,w,s,a),At&&(o_(0,We,lt,ct,At,Bt,w,s,a),o_(0,at,Ue,ct,At,Bt,w,s,a))),ct=ui;let{iconBBox:Ht,iconVerticalBBox:di}=jD(r,ct,At,k,Ae,u,Je,mt,D,a,et);Ce.push({feature:Ae,shapedTextOrientations:it,shapedText:Pt,shapedIcon:ct,iconPrimary:lt,iconSecondary:Ue,iconOffset:mt,iconAnchor:et,verticallyShapedIcon:At,layoutTextSize:Ze,layoutIconSize:Je,textOffset:Qe,isSDFIcon:Mt,iconTextFit:Bt,iconCollisionBounds:Ht,iconVerticalCollisionBounds:di})}return{featureData:Ce,sizes:D,hasAnySecondaryIcon:xe,textAlongLine:_e,symbolPlacement:ne}},n.fw=zS,n.fx=function(r,e,i,s,a,u,p,g,b,w){r.iconAtlasPositions=w.iconPositions;let{featureData:A,hasAnySecondaryIcon:k,sizes:I,textAlongLine:D,symbolPlacement:B}=e;for(let V of A){let{shapedIcon:W,verticallyShapedIcon:H,feature:J,shapedTextOrientations:te,shapedText:ne,layoutTextSize:_e,textOffset:de,isSDFIcon:xe,iconPrimary:Ce,iconSecondary:Ae,iconTextFit:He,iconOffset:Oe,iconCollisionBounds:Ze,iconVerticalCollisionBounds:Je}=V;jS(W,w.iconPositions,Ce,Ae),jS(H,w.iconPositions,Ce,Ae),UD(te,w.iconPositions),VD(Ce,Ae,w.iconPositions),(ne||W)&&WD(r,J,te,W,H,b,I,_e,0,de,xe,s,a,p,g,k,He,Oe,D,B,Ze,Je)}i&&r.generateCollisionDebugBuffers(u,r.collisionBoxArray,I.textScaleFactor)},n.fy=Ft,n.fz=b_,n.g=function(r,e){return xs(Object.assign(r,{method:"GET"}),e)},n.h=function(r){return r.indexOf("mapbox:")===0},n.i=function(r){return yr.API_STYLE_REGEX.test(r)&&!Ri(r)},n.j=Tn,n.k=hc,n.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},n.m=function(r,e){return xs(Object.assign(r,{type:"json"}),e)},n.n=Kc,n.o=Zr,n.p=function(r,e){return xs(Object.assign(r,{method:"POST"}),e)},n.q=So,n.r=Un,n.s=function(r){try{let e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=function(){return Fv||(Fv=new Td),Fv},n.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=Zt,n.x=kx,n.y=Ll,n.z=so})),y(["./shared"],(function(n){function R(Le){let Z=Le?Le.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function j(Le){if(typeof Le=="number"||typeof Le=="boolean"||typeof Le=="string"||Le==null)return JSON.stringify(Le);if(Array.isArray(Le)){let X="[";for(let le of Le)X+=`${j(le)},`;return`${X}]`}let Z="{";for(let X of Object.keys(Le).sort())Z+=`${X}:${j(Le[X])},`;return`${Z}}`}function Y(Le){let Z="";for(let X of n.bw)Z+=`/${j(Le[X])}`;return Z}class re{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,X){this._layerConfigs={},this._layers={},this.update(Z,[],X)}update(Z,X,le){this._options=le;for(let we of Z)this._layerConfigs[we.id]=we,(this._layers[we.id]=n.dt(we,this.scope,null,this._options)).compileFilter(le),this.keyCache[we.id]&&delete this.keyCache[we.id];for(let we of X)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};let Te=(function(we,ke){let je={};for(let Fe=0;Fe<we.length;Fe++){let dt=we[Fe],rt=ke&&ke[dt.id];rt||(dt.type==="symbol"?rt=dt.id:(rt=Y(dt),dt.type==="line"&&dt.paint&&(function ti(ii){return typeof ii=="string"&&ii==="line-progress"||(Array.isArray(ii)?ii.some(ti):!(!ii||typeof ii!="object")&&Object.values(ii).some(ti))})(dt.paint["line-width"])&&(rt+=`/${j(dt.paint["line-width"])}`))),ke&&(ke[dt.id]=rt);let jt=je[rt];jt||(jt=je[rt]=[]),jt.push(dt)}let Pe=[];for(let Fe in je)Pe.push(je[Fe]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(let we of Te){let ke=we.map((jt=>this._layers[jt.id])),je=ke[0];if(je.visibility==="none")continue;let Pe=je.source||"",Fe=this.familiesBySource[Pe];Fe||(Fe=this.familiesBySource[Pe]={});let dt=je.sourceLayer||"_geojsonTileLayer",rt=Fe[dt];rt||(rt=Fe[dt]=[]),rt.push(ke)}}}let me=1*n.fk;class be{constructor(Z){let X={},le=[];for(let je in Z){let Pe=Z[je],Fe=X[je]={};for(let dt in Pe.glyphs){let rt=Pe.glyphs[+dt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;let jt=rt.metrics.localGlyph?me:1,ti={x:0,y:0,w:rt.bitmap.width+2*jt,h:rt.bitmap.height+2*jt};le.push(ti),Fe[dt]=ti}}let{w:Te,h:we}=n.G(le),ke=new n.fj({width:Te||1,height:we||1});for(let je in Z){let Pe=Z[je];for(let Fe in Pe.glyphs){let dt=Pe.glyphs[+Fe];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;let rt=X[je][Fe],jt=dt.metrics.localGlyph?me:1;n.fj.copy(dt.bitmap,ke,{x:0,y:0},{x:rt.x+jt,y:rt.y+jt},dt.bitmap)}}this.image=ke,this.positions=X}}function oe(Le,Z,X){Le[Z]?X&&(Le[Z].center=X):Le[Z]={floorIds:new Set,center:X||[0,0],floors:{}}}function Se(Le,Z,X,le){for(let Te of Z)oe(Le,Te),Le[Te].floors[X]=le,Le[Te].floorIds.add(X)}function Re(Le){return{id:Le.properties.id.toString(),center:Le.properties.center.toString().split(";").map(Number)}}function tt(Le){return{id:Le.properties.id.toString(),isDefault:!!Le.properties.is_default&&Le.properties.is_default,connections:Le.properties.connected_floor_ids?new Set(Le.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Le.properties.conflicted_floor_ids?new Set(Le.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Le.properties.building_ids?new Set(Le.properties.building_ids.toString().split(";")):new Set,name:Le.properties.name.toString(),zIndex:Le.properties.z_index}}function yt(Le,Z){return Z.every((X=>Le.properties&&Le.properties[X]!=null))}function qe(Le){return yt(Le,["type","id","name"])&&Le.properties.type==="building"}function St(Le){return yt(Le,["type","id","name","z_index"])&&Le.properties.type==="floor"}n.fi(be,"GlyphAtlas");class ai{constructor(Z){this.tileID=new n.aP(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.request&&Z.request.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=n.aY(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.worldview=Z.worldview,this.localizableLayerIds=Z.localizableLayerIds,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep,this.scaleFactor=Z.scaleFactor,this.worldview=Z.worldview,this.indoor=Z.indoor}parse(Z,X,le,Te,we,ke){this.status="parsing",this.data=Z,this.collisionBoxArray=new n.b2;let je=new n.fl(Object.keys(Z.layers).sort()),Pe=new n.fm(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];let Fe={},dt=new n.fn(256,256),rt={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:dt,availableImages:le,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){let Zt=this.indoor.indoorState.activeFloorsVisible,bi=(function(Ci,mr,Hr){let un=(function(Ki,Kt){if(!Ki)return n.w("No source layers defined in indoor specification"),Kt;if(Ki.size===0)return Kt;let Ii=Ki.difference(Kt);for(let Br of Ii)n.w(`Missing source layer required in indoor specification: ${Br}`);return Kt.intersection(Kt)})(mr.sourceLayers,new Set(Object.keys(Ci.layers))),dn=mr.indoorState,sn=(function(Ki,Kt,Ii,Br){let tr=new Set,yr=new Set,Tn=new Set,Ri=new Map,Jr={},sa=Cn=>{let Pn=Ri.get(Cn)||new Set;for(let yo of tr)if((Ri.get(yo)||new Set).has(Cn)||Pn.has(yo))return!0;return!1};for(let Cn of Kt){let Pn=Ki.layers[Cn];if(Pn)for(let yo=0;yo<Pn.length;yo++){let Mo=Pn.feature(yo);if(qe(Mo)){let{id:Un,center:Zr}=Re(Mo);oe(Jr,Un,Zr),tr.add(Un)}else if(St(Mo)){let{id:Un,isDefault:Zr,connections:qs,conflicts:aa,buildings:la,name:Ya,zIndex:Hn}=tt(Mo);Se(Jr,la,Un,{name:Ya,zIndex:Hn}),Ri.set(Un,aa),(Un===Br||qs.has(Br))&&tr.add(Un),yr.add(Un),Zr&&Tn.add(Un)}}else n.w(`indoor source layer not found: ${Cn}`)}if(Ii)for(let Cn of Ii)yr.has(Cn)&&(sa(Cn)||tr.add(Cn));for(let Cn of Tn)tr.has(Cn)||sa(Cn)||tr.add(Cn);return{buildings:Jr,activeFloors:tr}})(Ci,un,dn.lastActiveFloors,dn.selectedFloorId);return Hr.send("setIndoorData",sn),sn})(Z,this.indoor,we);rt.activeFloors=Zt?bi.activeFloors:void 0}let jt=[],ti=X.familiesBySource[this.source];for(let Zt in ti){let bi=Z.layers[Zt];if(!bi)continue;let Ci=!1,mr=!1,Hr=!1;for(let Ki of ti[Zt])Ki[0].type==="symbol"?Ci=!0:mr=!0,Ki[0].is3D()&&Ki[0].type!=="model"&&(Hr=!0);if(this.extraShadowCaster&&!Hr||this.isSymbolTile===!0&&!Ci||this.isSymbolTile===!1&&!mr)continue;bi.version===1&&n.w(`Vector tile source "${this.source}" layer "${Zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let un=je.encode(Zt),dn=[],sn=!1;for(let Ki=0,Kt=0;Ki<bi.length;Ki++){let Ii=bi.feature(Ki),Br=Pe.getId(Ii,Zt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Zt)){let tr=Ii.properties?Ii.properties.worldview:null;if(this.worldview&&typeof tr=="string")if(tr==="all")Ii.properties.$localized=!0;else{if(!tr.split(",").includes(this.worldview))continue;Ii.properties.$localized=!0,Ii.properties.worldview=this.worldview}}!sn&&Ii.properties&&Ii.properties.hasOwnProperty(n.fo)&&(sn=!0),dn.push({feature:Ii,id:Br,index:Kt,sourceLayerIndex:un}),Kt++}sn&&!rt.elevationFeatures&&Z.layers.hasOwnProperty(n.fp)&&(rt.elevationFeatures=n.fq.parseFrom(Z.layers[n.fp],this.canonical));for(let Ki of ti[Zt]){let Kt=Ki[0];if(this.extraShadowCaster&&(!Kt.is3D()||Kt.type==="model")||this.isSymbolTile!==void 0&&Kt.type==="symbol"!==this.isSymbolTile||Kt.minzoom&&this.zoom<Math.floor(Kt.minzoom)||Kt.maxzoom&&this.zoom>=Kt.maxzoom||Kt.visibility==="none")continue;pi(Ki,this.zoom,rt.brightness,le,this.worldview);let Ii=Fe[Kt.id]=Kt.createBucket({index:Pe.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Te,worldview:this.worldview});Pe.bucketLayerIDs.push(Ki.map((tr=>n.B(tr.id,tr.scope))));let Br=Ii.prepare?Ii.prepare():null;Br!=null?(Br=Br.then((()=>Ii.populate(dn,rt,this.tileID.canonical,this.tileTransform))),jt.push(Br)):Ii.populate(dn,rt,this.tileID.canonical,this.tileTransform)}}let ii=()=>{let Zt,bi,Ci,mr,Hr,un;dt.trim();let dn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},sn=()=>{if(Zt)return this.status="done",ke(Zt);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:Object.values(Fe).filter((Kt=>!Kt.isEmpty())),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(bi&&Ci&&mr){let Kt=new be(bi),Ii=new Map;for(let[yr,Tn]of Ci.entries()){let{imagePosition:Ri}=n.ft(yr,Tn,n.fu);Ii.set(yr,Ri)}let Br={};for(let yr in Fe){let Tn=Fe[yr];Tn instanceof n.b3&&(pi(Tn.layers,this.zoom,rt.brightness,le,this.worldview),Br[yr]=n.fv(Tn,bi,Kt.positions,Ci,Ii,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Hr,this.worldview))}let tr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,Ci,Hr,(()=>{tr.iconsPending=!1,Ki(Br,Kt,tr)})),this.rasterizeIfNeeded(we,mr,un,(()=>{tr.patternsPending=!1,Ki(Br,Kt,tr)}))}},Ki=(Kt,Ii,Br,tr)=>{if(Br.iconsPending||Br.patternsPending)return;let yr=new n.fw(Ci,mr,this.lut);for(let Tn in Fe){let Ri=Fe[Tn];if(Tn in Kt)n.fx(Ri,Kt[Tn],this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ci,yr);else if(Ri.hasPattern&&(Ri instanceof n.b9||Ri instanceof n.ba||Ri instanceof n.e9)){pi(Ri.layers,this.zoom,rt.brightness,le,this.worldview);let Jr=Object.fromEntries(yr.patternPositions);Ri.addFeatures(rt,this.tileID.canonical,Jr,le,this.tileTransform,this.brightness)}}this.status="done",ke(null,{buckets:Object.values(Fe).filter((Tn=>!Tn.isEmpty())),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ii.image,lineAtlas:dt,imageAtlas:yr,brightness:rt.brightness})};if(!this.extraShadowCaster){let Kt=n.fr(rt.glyphDependencies,(tr=>Object.keys(tr).map(Number)));Object.keys(Kt).length?we.send("getGlyphs",{uid:this.uid,stacks:Kt},((tr,yr)=>{Zt||(Zt=tr,bi=yr,sn())}),void 0,!1,dn):bi={};let Ii=Array.from(rt.iconDependencies.keys()).map((tr=>n.I.parse(tr)));Ii.length?we.send("getImages",{images:Ii,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((tr,yr)=>{Zt||(Zt=tr,Ci=new Map,Hr=this.updateImageMapAndGetImageTaskQueue(Ci,yr,rt.iconDependencies),sn())}),void 0,!1,dn):(Ci=new Map,Hr=new Map);let Br=Array.from(rt.patternDependencies.keys()).map((tr=>n.I.parse(tr)));Br.length?we.send("getImages",{images:Br,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((tr,yr)=>{Zt||(Zt=tr,mr=new Map,un=this.updateImageMapAndGetImageTaskQueue(mr,yr,rt.patternDependencies),sn())}),void 0,!1,dn):(mr=new Map,un=new Map)}if(rt.elevationFeatures&&rt.elevationFeatures.length>0){let Kt=[];for(let Br of Object.values(Fe))if(Br instanceof n.ba){let tr=Br.getUnevaluatedPortalGraph();tr&&Kt.push(tr)}let Ii=n.fs.evaluate(Kt);for(let Br of Object.values(Fe))if(Br instanceof n.ba){let tr=Z.layers[je.decode(Br.sourceLayerIndex)];Br.setEvaluatedPortalGraph(Ii,tr,this.tileID.canonical,rt.availableImages,rt.brightness)}}sn()};jt.length>0?Promise.allSettled(jt).then(ii).catch(ke):ii()}updateParameters(Z){this.scaleFactor=Z.scaleFactor,this.showCollisionBoxes=Z.showCollisionBoxes,this.projection=Z.projection,this.brightness=Z.brightness,this.tileTransform=n.aY(Z.tileID.canonical,Z.projection),this.extraShadowCaster=Z.extraShadowCaster,this.lut=Z.lut,this.worldview=Z.worldview,this.indoor=Z.indoor}rasterizeIfNeeded(Z,X,le,Te){Array.from(X.values()).some((we=>we.usvg))?this.rasterize(Z,X,le,Te):Te()}updateImageMapAndGetImageTaskQueue(Z,X,le){let Te=new Map;for(let we of X.keys()){let ke=le.get(we)||[];for(let je of ke){let Pe=je.toString(),Fe=X.get(je.id.toString());Fe.usvg?Te.has(Pe)||(Te.set(Pe,je),Z.set(Pe,Object.assign({},Fe))):Z.set(Pe,Fe)}}return Te}rasterize(Z,X,le,Te){this.rasterizeTask=Z.send("rasterizeImages",{scope:this.scope,tasks:le},((we,ke)=>{if(!we)for(let[je,Pe]of ke.entries()){let Fe=Object.assign(X.get(je),{data:Pe});X.set(je,Fe)}Te()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function pi(Le,Z,X,le,Te){let we=new n.ac(Z,{brightness:X,worldview:Te});for(let ke of Le)ke.recalculate(we,le)}class Cr extends n.E{constructor(Z,X,le,Te,we,ke,je){super(),this.actor=Z,this.layerIndex=X,this.availableImages=le,this.availableModels=Te,this.loadVectorData=ke||n.aL,this.loading={},this.loaded={},this.deduped=new n.aK(Z.scheduler),this.isSpriteLoaded=we,this.scheduler=Z.scheduler,this.brightness=je}loadTile(Z,X){let le=Z.uid,Te=Z&&Z.request,we=Te&&Te.collectResourceTiming,ke=this.loading[le]=new ai(Z);ke.abort=this.loadVectorData(Z,((je,Pe)=>{let Fe=!this.loading[le];if(delete this.loading[le],ke.cancelRasterize(),Fe||je||!Pe)return ke.status="done",Fe||(this.loaded[le]=ke),X(je);let dt=Pe.rawData,rt={},jt=n.aM(Pe.responseHeaders);jt&&jt.expires&&(rt.expires=jt.expires),jt&&jt.cacheControl&&(rt.cacheControl=jt.cacheControl),ke.vectorTile=Pe.vectorTile||new n.fy(new n.bs(dt));let ti=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((ii,Zt)=>{if(ii||!Zt)return X(ii);let bi={};if(we){let Ci=R(Te);Ci.length>0&&(bi.resourceTiming=JSON.parse(JSON.stringify(Ci)))}X(null,Object.assign({rawTileData:dt.slice(0),responseHeaders:Pe.responseHeaders},Zt,rt,bi))}))};this.isSpriteLoaded?ti():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(ti,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):ti()})),this.loaded=this.loaded||{},this.loaded[le]=ke}))}reloadTile(Z,X){let le=this.loaded,Te=Z.uid;if(le&&le[Te]){let we=le[Te];we.updateParameters(Z);let ke=(je,Pe)=>{let Fe=we.reloadCallback;Fe&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe)),X(je,Pe)};we.status==="parsing"?we.reloadCallback=ke:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke):ke())}else X(null,void 0)}abortTile(Z,X){let le=Z.uid,Te=this.loading[le];Te&&(Te.abort&&Te.abort(),delete this.loading[le]),X()}removeTile(Z,X){let le=this.loaded,Te=Z.uid;le&&le[Te]&&delete le[Te],X()}}class lr{loadTile(Z,X){let{uid:le,encoding:Te,rawImageData:we,padding:ke}=Z,je=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,ke):we;X(null,new n.fz(le,je,Te,ke<1))}reloadTile(Z,X){X(null,null)}abortTile(Z,X){X()}removeTile(Z,X){X()}getImageData(Z,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);let le=this.offscreenCanvasContext.getImageData(-X,-X,Z.width+2*X,Z.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}n.br.setPbf(n.bs);class bt{constructor(Z){this._mrt=new n.br(Z.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Z.uid,this.tileID=Z.tileID,this.source=Z.source}parse(Z,X){let le=this._mrt;this.status="parsing",this._entireBuffer=Z;try{le.parseHeader(Z),this._isHeaderLoaded=!0;let Te=[];for(let we in le.layers){let ke=le.getLayer(we),je=ke.getDataRange(ke.getBandList()),Pe=le.createDecodingTask(je),Fe=Z.slice(je.firstByte,je.lastByte+1),dt=n.br.performDecoding(Fe,Pe).then((rt=>Pe.complete(null,rt))).catch((rt=>Pe.complete(rt,null)));Te.push(dt)}Promise.allSettled(Te).then((()=>X(null,le))).catch((we=>X(we)))}catch(Te){X(Te)}}}class Wt{constructor(Z){this.actor=Z,this.loading={},this.loaded={}}loadTile(Z,X){let le=Z.uid,Te=Z.request,we=this.loading[le]=new bt(Z),{cancel:ke}=n.bt(Te,((je,Pe,Fe)=>{let dt=!this.loading[le];if(delete this.loading[le],dt||je||!Pe)return we.status="done",dt||(this.loaded[le]=we),X(je);we.parse(Pe,((rt,jt)=>{if(rt||!jt)return X(rt);X(null,jt,Fe)})),this.loaded[le]=we}));we.abort=ke}reloadTile(Z,X){X(null,void 0)}abortTile(Z,X){let le=Z.uid,Te=this.loading[le];Te&&(Te.abort&&Te.abort(),delete this.loading[le]),X()}removeTile(Z,X){let le=Z.uid;this.loaded[le]&&delete this.loaded[le],X()}decodeRasterArray(Z,X){n.br.performDecoding(Z.buffer,Z.task).then((le=>X(null,le))).catch((le=>X(le)))}}let li=n.fA.prototype.toGeoJSON;class Hi{constructor(Z){this._feature=Z,this.extent=n.al,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){let Z=[];for(let X of this._feature.geometry)Z.push([new n.P(X[0],X[1])]);return Z}{let Z=[];for(let X of this._feature.geometry){let le=[];for(let Te of X)le.push(new n.P(Te[0],Te[1]));Z.push(le)}return Z}}toGeoJSON(Z,X,le){return li.call(this,Z,X,le)}}class hi{constructor(Z,X){this.name=Z,this.extent=n.al,this.length=X.length,this._jsonFeatures=X}feature(Z){return new Hi(this._jsonFeatures[Z])}}class Di{constructor(Z){this.layers={},this.extent=n.al;for(let X of Object.keys(Z))this.layers[X]=new hi(X,Z[X])}}let kr=64/4096,Si=128;class Ai{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],X){for(let le of Z){let Te=le.id;if(Te==null)continue;let we=this.features.get(Te);we&&this.updateCache(we,X),le.geometry?(we=mo(le),this.updateCache(we,X),this.features.set(Te,we)):this.features.delete(Te),this.updateCache(we,X)}}updateCache(Z,X){for(let{canonical:le,uid:Te}of Object.values(X)){let{z:we,x:ke,y:je}=le;oi(Z,Math.pow(2,we),ke,je)&&delete X[Te]}}getTile(Z,X,le){let Te=Math.pow(2,Z),we=[];for(let ke of this.features.values())oi(ke,Te,X,le)&&we.push(er(ke,Te,X,le));return{features:we}}getFeatures(){return[...this.features.values()]}}function oi({minX:Le,minY:Z,maxX:X,maxY:le},Te,we,ke){return Le<(we+1+kr)/Te&&Z<(ke+1+kr)/Te&&X>(we-kr)/Te&&le>(ke-kr)/Te}function mo(Le){let{id:Z,geometry:X,properties:le}=Le;if(!X)return;if(X.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:Te,coordinates:we}=X,ke={id:Z,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},je=ke.geometry;if(Te==="Point")Mi(we,je,ke);else if(Te==="MultiPoint")for(let Pe of we)Mi(Pe,je,ke);else if(Te==="LineString")ke.type=2,Dr(we,je,ke);else if(Te==="MultiLineString")ke.type=2,gn(we,je,ke);else if(Te==="Polygon")ke.type=3,gn(we,je,ke,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(let Pe of we)gn(Pe,je,ke,!0)}return ke}function Mi([Le,Z],X,le){let Te=n.aF(Le),we=n.aJ(Z);we=we<0?0:we>1?1:we,X.push(Te,we),le.minX=Math.min(le.minX,Te),le.minY=Math.min(le.minY,we),le.maxX=Math.max(le.maxX,Te),le.maxY=Math.max(le.maxY,we)}function Dr(Le,Z,X,le=!1,Te=!1){let we=[];for(let ke of Le)Mi(ke,we,X);Z.push(we),le&&(function(ke,je){let Pe=0;for(let Fe=0,dt=ke.length,rt=dt-2;Fe<dt;rt=Fe,Fe+=2)Pe+=(ke[Fe]-ke[rt])*(ke[Fe+1]+ke[rt+1]);if(Pe>0===je)for(let Fe=0,dt=ke.length;Fe<dt/2;Fe+=2){let rt=ke[Fe],jt=ke[Fe+1];ke[Fe]=ke[dt-2-Fe],ke[Fe+1]=ke[dt-1-Fe],ke[dt-2-Fe]=rt,ke[dt-1-Fe]=jt}})(we,Te)}function gn(Le,Z,X,le=!1){for(let Te=0;Te<Le.length;Te++)Dr(Le[Te],Z,X,le,Te===0)}function er(Le,Z,X,le){let{id:Te,type:we,geometry:ke,tags:je}=Le,Pe=[];if(we===1)(function(Fe,dt,rt,jt,ti){for(let ii=0;ii<Fe.length;ii+=2){let Zt=Math.round(n.al*(Fe[ii+0]*dt-rt)),bi=Math.round(n.al*(Fe[ii+1]*dt-jt));ti.push([Zt,bi])}})(ke,Z,X,le,Pe);else for(let Fe of ke)nn(Fe,Z,X,le,Pe);return{id:Te,type:we,geometry:Pe,tags:je}}function nn(Le,Z,X,le,Te){let we=-Si,ke=n.al+Si,je;for(let Pe=0;Pe<Le.length-2;Pe+=2){let Fe=Math.round(n.al*(Le[Pe+0]*Z-X)),dt=Math.round(n.al*(Le[Pe+1]*Z-le)),rt=Math.round(n.al*(Le[Pe+2]*Z-X)),jt=Math.round(n.al*(Le[Pe+3]*Z-le)),ti=rt-Fe,ii=jt-dt;Fe<we&&rt<we||(Fe<we?(dt+=Math.round(ii*((we-Fe)/ti)),Fe=we):rt<we&&(jt=dt+Math.round(ii*((we-Fe)/ti)),rt=we),dt<we&&jt<we||(dt<we?(Fe+=Math.round(ti*((we-dt)/ii)),dt=we):jt<we&&(rt=Fe+Math.round(ti*((we-dt)/ii)),jt=we),Fe>=ke&&rt>=ke||(Fe>=ke?(dt+=Math.round(ii*((ke-Fe)/ti)),Fe=ke):rt>=ke&&(jt=dt+Math.round(ii*((ke-Fe)/ti)),rt=ke),dt>=ke&&jt>=ke||(dt>=ke?(Fe+=Math.round(ti*((ke-dt)/ii)),dt=ke):jt>=ke&&(rt=Fe+Math.round(ti*((ke-dt)/ii)),jt=ke),je&&Fe===je[je.length-1][0]&&dt===je[je.length-1][1]||(je=[[Fe,dt]],Te.push(je)),je.push([rt,jt])))))}}function Kr({name:Le,features:Z},X){X.writeStringField(1,Le),X.writeVarintField(5,n.al);let le=new Map,Te=new Map,we={keys:le,values:Te,feature:null};for(let ke of Z)we.feature=ke,X.writeMessage(2,Pr,we);for(let ke of le.keys())X.writeStringField(3,ke);for(let ke of Te.keys())X.writeMessage(4,Mn,ke)}function Pr(Le,Z){let X=Le.feature;X.id!==void 0&&Number.isSafeInteger(+X.id)&&Z.writeVarintField(1,+X.id),X.tags&&Z.writeMessage(2,Uo,Le),Z.writeVarintField(3,X.type),Z.writeMessage(4,_n,X)}function Uo({keys:Le,values:Z,feature:X},le){for(let Te of Object.keys(X.tags)){let we=X.tags[Te];if(we===null)continue;let ke=Le.get(Te);ke===void 0&&(ke=Le.size,Le.set(Te,ke)),le.writeVarint(ke);let je=typeof we;je!=="string"&&je!=="boolean"&&je!=="number"&&(we=JSON.stringify(we));let Pe=Z.get(we);Pe===void 0&&(Pe=Z.size,Z.set(we,Pe)),le.writeVarint(Pe)}}function oo(Le,Z){return(Z<<3)+(7&Le)}function Er(Le){return Le<<1^Le>>31}function _n(Le,Z){let{geometry:X,type:le}=Le,Te=0,we=0;if(le===1){Z.writeVarint(oo(1,X.length));for(let ke of X){let je=ke[0]-Te,Pe=ke[1]-we;Z.writeVarint(Er(je)),Z.writeVarint(Er(Pe)),Te+=je,we+=Pe}}else for(let ke of X){Z.writeVarint(oo(1,1));let je=ke.length-(le===3?1:0);for(let Pe=0;Pe<je;Pe++){Pe===1&&Z.writeVarint(oo(2,je-1));let Fe=ke[Pe][0]-Te,dt=ke[Pe][1]-we;Z.writeVarint(Er(Fe)),Z.writeVarint(Er(dt)),Te+=Fe,we+=dt}le===3&&Z.writeVarint(oo(7,1))}}function Mn(Le,Z){let X=typeof Le;X==="string"?Z.writeStringField(1,Le):X==="boolean"?Z.writeBooleanField(7,Le):X==="number"&&(Le%1!=0?Z.writeDoubleField(3,Le):Le<0?Z.writeSVarintField(6,Le):Z.writeVarintField(5,Le))}let Vs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Wr=Math.fround||(Ta=new Float32Array(1),Le=>(Ta[0]=+Le,Ta[0]));var Ta;let zo=3,Qo=5,es=6;class on{constructor(Z){this.options=Object.assign(Object.create(Vs),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){let{log:X,minZoom:le,maxZoom:Te}=this.options;X&&console.time("total time");let we=`prepare ${Z.length} points`;X&&console.time(we),this.points=Z;let ke=[];for(let Pe=0;Pe<Z.length;Pe++){let Fe=Z[Pe];if(!Fe.geometry)continue;let[dt,rt]=Fe.geometry.coordinates,jt=Wr(go(dt)),ti=Wr(na(rt));ke.push(jt,ti,1/0,Pe,-1,1),this.options.reduce&&ke.push(0)}let je=this.trees[Te+1]=this._createTree(ke);X&&console.timeEnd(we);for(let Pe=Te;Pe>=le;Pe--){let Fe=+Date.now();je=this.trees[Pe]=this._createTree(this._cluster(je,Pe)),X&&console.log("z%d: %d clusters in %dms",Pe,je.numItems,+Date.now()-Fe)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let le=((Z[0]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,Z[1])),we=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,ke=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)le=-180,we=180;else if(le>we){let rt=this.getClusters([le,Te,180,ke],X),jt=this.getClusters([-180,Te,we,ke],X);return rt.concat(jt)}let je=this.trees[this._limitZoom(X)],Pe=je.range(go(le),na(ke),go(we),na(Te)),Fe=je.data,dt=[];for(let rt of Pe){let jt=this.stride*rt;dt.push(Fe[jt+Qo]>1?lc(Fe,jt,this.clusterProps):this.points[Fe[jt+zo]])}return dt}getChildren(Z){let X=this._getOriginId(Z),le=this._getOriginZoom(Z),Te="No cluster with the specified id.",we=this.trees[le];if(!we)throw new Error(Te);let ke=we.data;if(X*this.stride>=ke.length)throw new Error(Te);let je=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Pe=we.within(ke[X*this.stride],ke[X*this.stride+1],je),Fe=[];for(let dt of Pe){let rt=dt*this.stride;ke[rt+4]===Z&&Fe.push(ke[rt+Qo]>1?lc(ke,rt,this.clusterProps):this.points[ke[rt+zo]])}if(Fe.length===0)throw new Error(Te);return Fe}getLeaves(Z,X,le){let Te=[];return this._appendLeaves(Te,Z,X=X||10,le=le||0,0),Te}getTile(Z,X,le){let Te=this.trees[this._limitZoom(Z)],we=Math.pow(2,Z),{extent:ke,radius:je}=this.options,Pe=je/ke,Fe=(le-Pe)/we,dt=(le+1+Pe)/we,rt={features:[]};return this._addTileFeatures(Te.range((X-Pe)/we,Fe,(X+1+Pe)/we,dt),Te.data,X,le,we,rt),X===0&&this._addTileFeatures(Te.range(1-Pe/we,Fe,1,dt),Te.data,we,le,we,rt),X===we-1&&this._addTileFeatures(Te.range(0,Fe,Pe/we,dt),Te.data,-1,le,we,rt),rt.features.length?rt:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){let le=this.getChildren(Z);if(X++,le.length!==1)break;Z=le[0].properties.cluster_id}return X}_appendLeaves(Z,X,le,Te,we){let ke=this.getChildren(X);for(let je of ke){let Pe=je.properties;if(Pe&&Pe.cluster?we+Pe.point_count<=Te?we+=Pe.point_count:we=this._appendLeaves(Z,Pe.cluster_id,le,Te,we):we<Te?we++:Z.push(je),Z.length===le)break}return we}_createTree(Z){let X=new n.c3(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<Z.length;le+=this.stride)X.add(Z[le],Z[le+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,le,Te,we,ke){for(let je of Z){let Pe=je*this.stride,Fe=X[Pe+Qo]>1,dt,rt,jt;if(Fe)dt=Ca(X,Pe,this.clusterProps),rt=X[Pe],jt=X[Pe+1];else{let Zt=this.points[X[Pe+zo]];dt=Zt.properties;let[bi,Ci]=Zt.geometry.coordinates;rt=go(bi),jt=na(Ci)}let ti={type:1,geometry:[[Math.round(this.options.extent*(rt*we-le)),Math.round(this.options.extent*(jt*we-Te))]],tags:dt},ii;ii=Fe||this.options.generateId?X[Pe+zo]:this.points[X[Pe+zo]].id,ii!==void 0&&(ti.id=ii),ke.features.push(ti)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){let{radius:le,extent:Te,reduce:we,minPoints:ke}=this.options,je=le/(Te*Math.pow(2,X)),Pe=Z.data,Fe=[],dt=this.stride;for(let rt=0;rt<Pe.length;rt+=dt){if(Pe[rt+2]<=X)continue;Pe[rt+2]=X;let jt=Pe[rt],ti=Pe[rt+1],ii=Z.within(Pe[rt],Pe[rt+1],je),Zt=Pe[rt+Qo],bi=Zt;for(let Ci of ii){let mr=Ci*dt;Pe[mr+2]>X&&(bi+=Pe[mr+Qo])}if(bi>Zt&&bi>=ke){let Ci,mr=jt*Zt,Hr=ti*Zt,un=-1,dn=(rt/dt<<5)+(X+1)+this.points.length;for(let sn of ii){let Ki=sn*dt;if(Pe[Ki+2]<=X)continue;Pe[Ki+2]=X;let Kt=Pe[Ki+Qo];mr+=Pe[Ki]*Kt,Hr+=Pe[Ki+1]*Kt,Pe[Ki+4]=dn,we&&(Ci||(Ci=this._map(Pe,rt,!0),un=this.clusterProps.length,this.clusterProps.push(Ci)),we(Ci,this._map(Pe,Ki)))}Pe[rt+4]=dn,Fe.push(mr/bi,Hr/bi,1/0,dn,-1,bi),we&&Fe.push(un)}else{for(let Ci=0;Ci<dt;Ci++)Fe.push(Pe[rt+Ci]);if(bi>1)for(let Ci of ii){let mr=Ci*dt;if(!(Pe[mr+2]<=X)){Pe[mr+2]=X;for(let Hr=0;Hr<dt;Hr++)Fe.push(Pe[mr+Hr])}}}}return Fe}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,le){if(Z[X+Qo]>1){let ke=this.clusterProps[Z[X+es]];return le?Object.assign({},ke):ke}let Te=this.points[Z[X+zo]].properties,we=this.options.map(Te);return le&&we===Te?Object.assign({},we):we}}function lc(Le,Z,X){return{type:"Feature",id:Le[Z+zo],properties:Ca(Le,Z,X),geometry:{type:"Point",coordinates:[(le=Le[Z],360*(le-.5)),Tl(Le[Z+1])]}};var le}function Ca(Le,Z,X){let le=Le[Z+Qo],Te=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,we=Le[Z+es],ke=we===-1?{}:Object.assign({},X[we]);return Object.assign(ke,{cluster:!0,cluster_id:Le[Z+zo],point_count:le,point_count_abbreviated:Te})}function go(Le){return Le/360+.5}function na(Le){let Z=Math.sin(Le*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function Tl(Le){let Z=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function _o(Le,Z,X,le){let Te=le,we=Z+(X-Z>>1),ke,je=X-Z,Pe=Le[Z],Fe=Le[Z+1],dt=Le[X],rt=Le[X+1];for(let jt=Z+3;jt<X;jt+=3){let ti=Ea(Le[jt],Le[jt+1],Pe,Fe,dt,rt);if(ti>Te)ke=jt,Te=ti;else if(ti===Te){let ii=Math.abs(jt-we);ii<je&&(ke=jt,je=ii)}}Te>le&&(ke-Z>3&&_o(Le,Z,ke,le),Le[ke+2]=Te,X-ke>3&&_o(Le,ke,X,le))}function Ea(Le,Z,X,le,Te,we){let ke=Te-X,je=we-le;if(ke!==0||je!==0){let Pe=((Le-X)*ke+(Z-le)*je)/(ke*ke+je*je);Pe>1?(X=Te,le=we):Pe>0&&(X+=ke*Pe,le+=je*Pe)}return ke=Le-X,je=Z-le,ke*ke+je*je}function ts(Le,Z,X,le){let Te={id:Le??null,type:Z,geometry:X,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Us(Te,X);else if(Z==="Polygon")Us(Te,X[0]);else if(Z==="MultiLineString")for(let we of X)Us(Te,we);else if(Z==="MultiPolygon")for(let we of X)Us(Te,we[0]);return Te}function Us(Le,Z){for(let X=0;X<Z.length;X+=3)Le.minX=Math.min(Le.minX,Z[X]),Le.minY=Math.min(Le.minY,Z[X+1]),Le.maxX=Math.max(Le.maxX,Z[X]),Le.maxY=Math.max(Le.maxY,Z[X+1])}function Aa(Le,Z,X,le){if(!Z.geometry)return;let Te=Z.geometry.coordinates;if(Te&&Te.length===0)return;let we=Z.geometry.type,ke=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),je=[],Pe=Z.id;if(X.promoteId?Pe=Z.properties[X.promoteId]:X.generateId&&(Pe=le||0),we==="Point")Ao(Te,je);else if(we==="MultiPoint")for(let Fe of Te)Ao(Fe,je);else if(we==="LineString")ka(Te,je,ke,!1);else if(we==="MultiLineString"){if(X.lineMetrics){for(let Fe of Te)je=[],ka(Fe,je,ke,!1),Le.push(ts(Pe,"LineString",je,Z.properties));return}gs(Te,je,ke,!1)}else if(we==="Polygon")gs(Te,je,ke,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(let Fe of Z.geometry.geometries)Aa(Le,{id:Pe,geometry:Fe,properties:Z.properties},X,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Fe of Te){let dt=[];gs(Fe,dt,ke,!0),je.push(dt)}}Le.push(ts(Pe,we,je,Z.properties))}function Ao(Le,Z){Z.push(Cl(Le[0]),Xa(Le[1]),0)}function ka(Le,Z,X,le){let Te,we,ke=0;for(let Pe=0;Pe<Le.length;Pe++){let Fe=Cl(Le[Pe][0]),dt=Xa(Le[Pe][1]);Z.push(Fe,dt,0),Pe>0&&(ke+=le?(Te*dt-Fe*we)/2:Math.sqrt(Math.pow(Fe-Te,2)+Math.pow(dt-we,2))),Te=Fe,we=dt}let je=Z.length-3;Z[2]=1,_o(Z,0,je,X),Z[je+2]=1,Z.size=Math.abs(ke),Z.start=0,Z.end=Z.size}function gs(Le,Z,X,le){for(let Te=0;Te<Le.length;Te++){let we=[];ka(Le[Te],we,X,le),Z.push(we)}}function Cl(Le){return Le/360+.5}function Xa(Le){let Z=Math.sin(Le*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function xn(Le,Z,X,le,Te,we,ke,je){if(le/=Z,we>=(X/=Z)&&ke<le)return Le;if(ke<X||we>=le)return null;let Pe=[];for(let Fe of Le){let dt=Fe.geometry,rt=Fe.type,jt=Te===0?Fe.minX:Fe.minY,ti=Te===0?Fe.maxX:Fe.maxY;if(jt>=X&&ti<le){Pe.push(Fe);continue}if(ti<X||jt>=le)continue;let ii=[];if(rt==="Point"||rt==="MultiPoint")Ia(dt,ii,X,le,Te);else if(rt==="LineString")El(dt,ii,X,le,Te,!1,je.lineMetrics);else if(rt==="MultiLineString")_s(dt,ii,X,le,Te,!1);else if(rt==="Polygon")_s(dt,ii,X,le,Te,!0);else if(rt==="MultiPolygon")for(let Zt of dt){let bi=[];_s(Zt,bi,X,le,Te,!0),bi.length&&ii.push(bi)}if(ii.length){if(je.lineMetrics&&rt==="LineString"){for(let Zt of ii)Pe.push(ts(Fe.id,rt,Zt,Fe.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(ii.length===1?(rt="LineString",ii=ii[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=ii.length===3?"Point":"MultiPoint"),Pe.push(ts(Fe.id,rt,ii,Fe.tags))}}return Pe.length?Pe:null}function Ia(Le,Z,X,le,Te){for(let we=0;we<Le.length;we+=3){let ke=Le[we+Te];ke>=X&&ke<=le&&is(Z,Le[we],Le[we+1],Le[we+2])}}function El(Le,Z,X,le,Te,we,ke){let je=qo(Le),Pe=Te===0?Gr:Gn,Fe,dt,rt=Le.start;for(let bi=0;bi<Le.length-3;bi+=3){let Ci=Le[bi],mr=Le[bi+1],Hr=Le[bi+2],un=Le[bi+3],dn=Le[bi+4],sn=Te===0?Ci:mr,Ki=Te===0?un:dn,Kt=!1;ke&&(Fe=Math.sqrt(Math.pow(Ci-un,2)+Math.pow(mr-dn,2))),sn<X?Ki>X&&(dt=Pe(je,Ci,mr,un,dn,X),ke&&(je.start=rt+Fe*dt)):sn>le?Ki<le&&(dt=Pe(je,Ci,mr,un,dn,le),ke&&(je.start=rt+Fe*dt)):is(je,Ci,mr,Hr),Ki<X&&sn>=X&&(dt=Pe(je,Ci,mr,un,dn,X),Kt=!0),Ki>le&&sn<=le&&(dt=Pe(je,Ci,mr,un,dn,le),Kt=!0),!we&&Kt&&(ke&&(je.end=rt+Fe*dt),Z.push(je),je=qo(Le)),ke&&(rt+=Fe)}let jt=Le.length-3,ti=Le[jt],ii=Le[jt+1],Zt=Te===0?ti:ii;Zt>=X&&Zt<=le&&is(je,ti,ii,Le[jt+2]),jt=je.length-3,we&&jt>=3&&(je[jt]!==je[0]||je[jt+1]!==je[1])&&is(je,je[0],je[1],je[2]),je.length&&Z.push(je)}function qo(Le){let Z=[];return Z.size=Le.size,Z.start=Le.start,Z.end=Le.end,Z}function _s(Le,Z,X,le,Te,we){for(let ke of Le)El(ke,Z,X,le,Te,we,!1)}function is(Le,Z,X,le){Le.push(Z,X,le)}function Gr(Le,Z,X,le,Te,we){let ke=(we-Z)/(le-Z);return is(Le,we,X+(Te-X)*ke,1),ke}function Gn(Le,Z,X,le,Te,we){let ke=(we-X)/(Te-X);return is(Le,Z+(le-Z)*ke,we,1),ke}function Pa(Le,Z){let X=[];for(let le=0;le<Le.length;le++){let Te=Le[le],we=Te.type,ke;if(we==="Point"||we==="MultiPoint"||we==="LineString")ke=La(Te.geometry,Z);else if(we==="MultiLineString"||we==="Polygon"){ke=[];for(let je of Te.geometry)ke.push(La(je,Z))}else if(we==="MultiPolygon"){ke=[];for(let je of Te.geometry){let Pe=[];for(let Fe of je)Pe.push(La(Fe,Z));ke.push(Pe)}}X.push(ts(Te.id,we,ke,Te.tags))}return X}function La(Le,Z){let X=[];X.size=Le.size,Le.start!==void 0&&(X.start=Le.start,X.end=Le.end);for(let le=0;le<Le.length;le+=3)X.push(Le[le]+Z,Le[le+1],Le[le+2]);return X}function Wo(Le,Z){if(Le.transformed)return Le;let X=1<<Le.z,le=Le.x,Te=Le.y;for(let we of Le.features){let ke=we.geometry,je=we.type;if(we.geometry=[],je===1)for(let Pe=0;Pe<ke.length;Pe+=2)we.geometry.push(Xc(ke[Pe],ke[Pe+1],Z,X,le,Te));else for(let Pe=0;Pe<ke.length;Pe++){let Fe=[];for(let dt=0;dt<ke[Pe].length;dt+=2)Fe.push(Xc(ke[Pe][dt],ke[Pe][dt+1],Z,X,le,Te));we.geometry.push(Fe)}}return Le.transformed=!0,Le}function Xc(Le,Z,X,le,Te,we){return[Math.round(X*(Le*le-Te)),Math.round(X*(Z*le-we))]}function cc(Le,Z,X,le,Te){let we=Z===Te.maxZoom?0:Te.tolerance/((1<<Z)*Te.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:X,y:le,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let je of Le)Zu(ke,je,we,Te);return ke}function Zu(Le,Z,X,le){let Te=Z.geometry,we=Z.type,ke=[];if(Le.minX=Math.min(Le.minX,Z.minX),Le.minY=Math.min(Le.minY,Z.minY),Le.maxX=Math.max(Le.maxX,Z.maxX),Le.maxY=Math.max(Le.maxY,Z.maxY),we==="Point"||we==="MultiPoint")for(let je=0;je<Te.length;je+=3)ke.push(Te[je],Te[je+1]),Le.numPoints++,Le.numSimplified++;else if(we==="LineString")Al(ke,Te,Le,X,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let je=0;je<Te.length;je++)Al(ke,Te[je],Le,X,we==="Polygon",je===0);else if(we==="MultiPolygon")for(let je=0;je<Te.length;je++){let Pe=Te[je];for(let Fe=0;Fe<Pe.length;Fe++)Al(ke,Pe[Fe],Le,X,!0,Fe===0)}if(ke.length){let je=Z.tags||null;if(we==="LineString"&&le.lineMetrics){je={};for(let Fe in Z.tags)je[Fe]=Z.tags[Fe];je.mapbox_clip_start=Te.start/Te.size,je.mapbox_clip_end=Te.end/Te.size}let Pe={geometry:ke,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:je};Z.id!==null&&(Pe.id=Z.id),Le.features.push(Pe)}}function Al(Le,Z,X,le,Te,we){let ke=le*le;if(le>0&&Z.size<(Te?ke:le))return void(X.numPoints+=Z.length/3);let je=[];for(let Pe=0;Pe<Z.length;Pe+=3)(le===0||Z[Pe+2]>ke)&&(X.numSimplified++,je.push(Z[Pe],Z[Pe+1])),X.numPoints++;Te&&(function(Pe,Fe){let dt=0;for(let rt=0,jt=Pe.length,ti=jt-2;rt<jt;ti=rt,rt+=2)dt+=(Pe[rt]-Pe[ti])*(Pe[rt+1]+Pe[ti+1]);if(dt>0===Fe)for(let rt=0,jt=Pe.length;rt<jt/2;rt+=2){let ti=Pe[rt],ii=Pe[rt+1];Pe[rt]=Pe[jt-2-rt],Pe[rt+1]=Pe[jt-1-rt],Pe[jt-2-rt]=ti,Pe[jt-1-rt]=ii}})(je,we),Le.push(je)}let st={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class oa{constructor(Z,X){let le=(X=this.options=(function(we,ke){for(let je in ke)we[je]=ke[je];return we})(Object.create(st),X)).debug;if(le&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=(function(we,ke){let je=[];if(we.type==="FeatureCollection")for(let Pe=0;Pe<we.features.length;Pe++)Aa(je,we.features[Pe],ke,Pe);else Aa(je,we.type==="Feature"?we:{geometry:we},ke);return je})(Z,X);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=(function(we,ke){let je=ke.buffer/ke.extent,Pe=we,Fe=xn(we,1,-1-je,je,0,-1,2,ke),dt=xn(we,1,1-je,2+je,0,-1,2,ke);return(Fe||dt)&&(Pe=xn(we,1,-je,1+je,0,-1,2,ke)||[],Fe&&(Pe=Pa(Fe,1).concat(Pe)),dt&&(Pe=Pe.concat(Pa(dt,-1)))),Pe})(Te,X),Te.length&&this.splitTile(Te,0,0,0),le&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,X,le,Te,we,ke,je){let Pe=[Z,X,le,Te],Fe=this.options,dt=Fe.debug;for(;Pe.length;){Te=Pe.pop(),le=Pe.pop(),X=Pe.pop(),Z=Pe.pop();let rt=1<<X,jt=uc(X,le,Te),ti=this.tiles[jt];if(!ti&&(dt>1&&console.time("creation"),ti=this.tiles[jt]=cc(Z,X,le,Te,Fe),this.tileCoords.push({z:X,x:le,y:Te}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,le,Te,ti.numFeatures,ti.numPoints,ti.numSimplified),console.timeEnd("creation"));let Kt=`z${X}`;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(ti.source=Z,we==null){if(X===Fe.indexMaxZoom||ti.numPoints<=Fe.indexMaxPoints)continue}else{if(X===Fe.maxZoom||X===we)continue;if(we!=null){let Kt=we-X;if(le!==ke>>Kt||Te!==je>>Kt)continue}}if(ti.source=null,Z.length===0)continue;dt>1&&console.time("clipping");let ii=.5*Fe.buffer/Fe.extent,Zt=.5-ii,bi=.5+ii,Ci=1+ii,mr=null,Hr=null,un=null,dn=null,sn=xn(Z,rt,le-ii,le+bi,0,ti.minX,ti.maxX,Fe),Ki=xn(Z,rt,le+Zt,le+Ci,0,ti.minX,ti.maxX,Fe);Z=null,sn&&(mr=xn(sn,rt,Te-ii,Te+bi,1,ti.minY,ti.maxY,Fe),Hr=xn(sn,rt,Te+Zt,Te+Ci,1,ti.minY,ti.maxY,Fe),sn=null),Ki&&(un=xn(Ki,rt,Te-ii,Te+bi,1,ti.minY,ti.maxY,Fe),dn=xn(Ki,rt,Te+Zt,Te+Ci,1,ti.minY,ti.maxY,Fe),Ki=null),dt>1&&console.timeEnd("clipping"),Pe.push(mr||[],X+1,2*le,2*Te),Pe.push(Hr||[],X+1,2*le,2*Te+1),Pe.push(un||[],X+1,2*le+1,2*Te),Pe.push(dn||[],X+1,2*le+1,2*Te+1)}}getTile(Z,X,le){Z=+Z,X=+X,le=+le;let Te=this.options,{extent:we,debug:ke}=Te;if(Z<0||Z>24)return null;let je=1<<Z,Pe=uc(Z,X=X+je&je-1,le);if(this.tiles[Pe])return Wo(this.tiles[Pe],we);ke>1&&console.log("drilling down to z%d-%d-%d",Z,X,le);let Fe,dt=Z,rt=X,jt=le;for(;!Fe&&dt>0;)dt--,rt>>=1,jt>>=1,Fe=this.tiles[uc(dt,rt,jt)];return Fe&&Fe.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",dt,rt,jt),console.time("drilling down")),this.splitTile(Fe.source,dt,rt,jt,Z,X,le),ke>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Wo(this.tiles[Pe],we):null):null}}function uc(Le,Z,X){return 32*((1<<Le)*X+Z)+Le}function dc(Le,Z){let X=Le.tileID.canonical;if(!this._geoJSONIndex)return void Z(null,null);let le=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!le)return void Z(null,null);let Te=Fe=>Fe.tags&&"3d_elevation_id"in Fe.tags&&"source"in Fe.tags&&Fe.tags.source==="elevation",we=le.features.filter((Fe=>Te(Fe))),ke={_geojsonTileLayer:le.features};we.length>0&&(ke={_geojsonTileLayer:le.features.filter((Fe=>!Te(Fe))),hd_road_elevation:we});let je=new Di(ke),Pe=(function(Fe){let dt=new n.bs;for(let rt of Object.keys(Fe))dt.writeMessage(3,Kr,{name:rt,features:Fe[rt]});return dt.finish()})(ke).buffer;Z(null,{vectorTile:je,rawData:Pe})}class Bi extends Cr{constructor(Z,X,le,Te,we,ke,je){super(Z,X,le,Te,we,dc,je),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new Ai}loadData(Z,X){let le=Z&&Z.request,Te=le&&le.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Z,((we,ke)=>{if(we||!ke)return X(we);if(typeof ke!="object")return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){let Pe=n.U(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map((Fe=>`${Fe.key}: ${Fe.message}`)).join(", "));ke.features=ke.features.filter((Fe=>Pe.value.evaluate({zoom:0},Fe)))}Z.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),Z.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new on((function({superclusterOptions:Pe,clusterProperties:Fe}){if(!Fe||!Pe)return Pe;let dt={},rt={},jt={accumulated:null,zoom:0},ti={properties:null},ii=Object.keys(Fe);for(let Zt of ii){let[bi,Ci]=Fe[Zt],mr=n.U(Ci),Hr=n.U(typeof bi=="string"?[bi,["accumulated"],["get",Zt]]:bi);dt[Zt]=mr.value,rt[Zt]=Hr.value}return Pe.map=Zt=>{ti.properties=Zt;let bi={};for(let Ci of ii)bi[Ci]=dt[Ci].evaluate(jt,ti);return bi},Pe.reduce=(Zt,bi)=>{ti.properties=bi;for(let Ci of ii)jt.accumulated=Zt[Ci],Zt[Ci]=rt[Ci].evaluate(jt,ti)},Pe})(Z)).load(ke.features):Z.dynamic?this._dynamicIndex:(function(Pe,Fe){return new oa(Pe,Fe)})(ke,Z.geojsonVtOptions)}catch(Pe){return X(Pe)}let je={};if(Te){let Pe=R(le);Pe&&(je.resourceTiming={},je.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Pe)))}X(null,je)}}))}reloadTile(Z,X){let le=this.loaded;return le&&le[Z.uid]?Z.partial?X(null,void 0):super.reloadTile(Z,X):this.loadTile(Z,X)}loadGeoJSON(Z,X){if(Z.request)n.m(Z.request,X);else{if(typeof Z.data!="string")return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return X(null,JSON.parse(Z.data))}catch{return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(Z,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(le){X(le)}}getClusterChildren(Z,X){try{X(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(le){X(le)}}getClusterLeaves(Z,X){try{X(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(le){X(le)}}}class bn{constructor(Z,X,le){this.tileID=new n.aP(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=X,this.worldview=le}parse(Z,X,le,Te){this.status="parsing";let we=new n.aP(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),ke=[],je=X.familiesBySource[le.source],Pe=new n.fm(we,le.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,n.fB(Z).then((Fe=>{if(!Fe)return Te(new Error("Could not parse tile"));let dt=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Fe.json.asset.extras&&Fe.json.asset.extras.MAPBOX_mesh_features,rt=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("EXT_meshopt_compression"),jt=new n.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(let ti in je)for(let ii of je[ti]){let Zt=ii[0];Pe.bucketLayerIDs.push(ii.map((mr=>n.B(mr.id,mr.scope)))),Zt.recalculate(jt,[]);let bi=n.fC(Fe,1/n.d6(le.tileID.canonical)),Ci=new n.fD(ii,bi,we,dt,rt,this.brightness,Pe,this.worldview);dt||(Ci.needsUpload=!0),ke.push(Ci),Ci.evaluate(Zt)}this.status="done",Te(null,{buckets:ke,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Fe=>Te(new Error(Fe.message))))}}class ki{constructor(Z,X,le,Te,we,ke,je,Pe){this.actor=Z,this.layerIndex=X,this.availableImages=le,this.availableModels=Te,this.brightness=je,this.loading={},this.loaded={},this.worldview=Pe}loadTile(Z,X){let le=Z.uid,Te=this.loading[le]=new bn(Z,this.brightness,this.worldview);n.bt(Z.request,((we,ke)=>{let je=!this.loading[le];return delete this.loading[le],je||we?(Te.status="done",je||(this.loaded[le]=Te),X(we)):ke&&ke.byteLength!==0?void Te.parse(ke,this.layerIndex,Z,((Pe,Fe)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[le]=Te,Pe||!Fe?X(Pe):X(null,Fe)})):(Te.status="done",this.loaded[le]=Te,X())}))}reloadTile(Z,X){let le=this.loaded,Te=Z.uid;if(le&&le[Te]){let we=le[Te];we.projection=Z.projection,we.brightness=Z.brightness;let ke=(je,Pe)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(Z,X)),X(je,Pe)};we.status==="parsing"?we.reloadCallback=ke:we.status==="done"&&this.loadTile(Z,X)}}abortTile(Z,X){let le=Z.uid;this.loading[le]&&delete this.loading[le],X()}removeTile(Z,X){let le=this.loaded,Te=Z.uid;le&&le[Te]&&delete le[Te],X()}}class kl{constructor(Z){this.self=Z,this.actor=new n.fF(Z,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.cl({name:"mercator"}),this.workerSourceTypes={vector:Cr,geojson:Bi,"raster-dem":lr,"raster-array":Wt,"batched-model":ki},this.workerSources={},this.self.registerWorkerSource=(X,le)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=le},this.self.registerRTLTextPlugin=X=>{if(n.fG.isParsed())throw new Error("RTL text plugin already registered.");n.fG.setState({pluginStatus:n.fH.parsed,pluginURL:n.fG.getPluginURL()}),n.fG.applyArabicShaping=X.applyArabicShaping,n.fG.processBidirectionalText=X.processBidirectionalText,n.fG.processStyledBidirectionalText=X.processStyledBidirectionalText;for(let le of this.rtlPluginParsingListeners)le(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Z,X,le){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.availableModels[Z],delete this.workerSources[Z],le()}checkIfReady(Z,X,le){le()}setReferrer(Z,X){this.referrer=X}spriteLoaded(Z,X){this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={});let{scope:le,isLoaded:Te}=X;if(this.isSpriteLoaded[Z][le]=Te,this.workerSources[Z]&&this.workerSources[Z][le])for(let we in this.workerSources[Z][le]){let ke=this.workerSources[Z][le][we];for(let je in ke){let Pe=ke[je];Pe instanceof Cr&&(Pe.isSpriteLoaded=Te,Pe.fire(new n.z("isSpriteLoaded")))}}}setImages(Z,X,le){this.availableImages[Z]||(this.availableImages[Z]={});let{scope:Te,images:we}=X;if(this.availableImages[Z][Te]=we,this.workerSources[Z]&&this.workerSources[Z][Te]){for(let ke in this.workerSources[Z][Te]){let je=this.workerSources[Z][Te][ke];for(let Pe in je)je[Pe].availableImages=we}le()}else le()}setModels(Z,{scope:X,models:le},Te){if(this.availableModels[Z]||(this.availableModels[Z]={}),this.availableModels[Z][X]=le,this.workerSources[Z]&&this.workerSources[Z][X]){for(let we in this.workerSources[Z][X]){let ke=this.workerSources[Z][X][we];for(let je in ke)ke[je].availableModels=le}Te()}else Te()}setProjection(Z,X){this.projections[Z]=n.cl(X)}setBrightness(Z,X,le){this.brightness=X,le()}setWorldview(Z,X,le){this.worldview=X,le()}setLayers(Z,X,le){this.getLayerIndex(Z,X.scope).replace(X.layers,X.options),le()}updateLayers(Z,X,le){this.getLayerIndex(Z,X.scope).update(X.layers,X.removedIds,X.options),le()}loadTile(Z,X,le){X.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source,X.scope).loadTile(X,le)}decodeRasterArray(Z,X,le){this.getWorkerSource(Z,X.type,X.source,X.scope).decodeRasterArray(X,le)}reloadTile(Z,X,le){X.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source,X.scope).reloadTile(X,le)}abortTile(Z,X,le){this.getWorkerSource(Z,X.type,X.source,X.scope).abortTile(X,le)}removeTile(Z,X,le){this.getWorkerSource(Z,X.type,X.source,X.scope).removeTile(X,le)}removeSource(Z,X,le){if(!(this.workerSources[Z]&&this.workerSources[Z][X.scope]&&this.workerSources[Z][X.scope][X.type]&&this.workerSources[Z][X.scope][X.type][X.source]))return;let Te=this.workerSources[Z][X.scope][X.type][X.source];delete this.workerSources[Z][X.scope][X.type][X.source],Te.removeSource!==void 0?Te.removeSource(X,le):le()}loadWorkerSource(Z,X,le){try{this.self.importScripts(X.url),le()}catch(Te){le(Te.toString())}}syncRTLPluginState(Z,X,le){if(n.fG.isParsed())le(null,!0);else if(n.fG.isParsing())this.rtlPluginParsingListeners.push(le);else try{n.fG.setState(X);let Te=n.fG.getPluginURL();!n.fG.isLoaded()||n.fG.isParsed()||n.fG.isParsing()||Te==null||(n.fG.setState({pluginStatus:n.fH.parsing,pluginURL:n.fG.getPluginURL()}),this.self.importScripts(Te),n.fG.isParsed()?le(null,!0):this.rtlPluginParsingListeners.push(le))}catch(Te){le(Te.toString())}}setDracoUrl(Z,X){this.dracoUrl=X}getAvailableImages(Z,X){this.availableImages[Z]||(this.availableImages[Z]={});let le=this.availableImages[Z][X];return le||(le=[]),le}getAvailableModels(Z,X){this.availableModels[Z]||(this.availableModels[Z]={});let le=this.availableModels[Z][X];return le||(le={}),le}getLayerIndex(Z,X){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let le=this.layerIndexes[Z][X];return le||(le=this.layerIndexes[Z][X]=new re,le.scope=X),le}getWorkerSource(Z,X,le,Te){let we=this.workerSources;return we[Z]||(we[Z]={}),we[Z][Te]||(we[Z][Te]={}),we[Z][Te][X]||(we[Z][Te][X]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),we[Z][Te][X][le]||(we[Z][Te][X][le]=new this.workerSourceTypes[X]({send:(ke,je,Pe,Fe,dt,rt)=>this.actor.send(ke,je,Pe,Z,dt,rt),scheduler:this.actor.scheduler},this.getLayerIndex(Z,Te),this.getAvailableImages(Z,Te),this.getAvailableModels(Z,Te),this.isSpriteLoaded[Z][Te],void 0,this.brightness,this.worldview)),we[Z][Te][X][le]}rasterizeImagesWorker(Z,X,le){let Te=new Map;for(let[we,{image:ke,imageVariant:je}]of X.tasks.entries()){let Pe=this.imageRasterizer.rasterize(je,ke,X.scope,Z);Te.set(we,Pe)}le(void 0,Te)}removeRasterizedImages(Z,X,le){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,Z),le()}enforceCacheSizeLimit(Z,X){n.fI(X)}getWorkerPerformanceMetrics(Z,X,le){le(void 0,void 0)}}return n.fE(self)&&(self.worker=new kl(self)),kl})),y(["./shared"],(function(n){var R="3.16.0";let j={create:"create",load:"load",fullLoad:"fullLoad"},Y={mark(l){performance.mark(l)},measure(l,t,o){performance.measure(l,t,o)}};function re(l){let t=l.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var me,be={},oe=(function(){if(me)return be;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,S=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(S);try{x=new Worker(E),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(E),_})()?(function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===_.width})()?(o[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(o[f]=(function(_){var x,S=(function(E){var P=document.createElement("canvas"),M=Object.create(l.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,P.getContext("webgl2",M)})(_);if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),S.getShaderParameter(x,S.COMPILE_STATUS)===!0)})(f)),o[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}me=1,be.supported=l,be.notSupportedReason=t;var o={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},be})();function Se(l,t,o){let c=document.createElement(l);return t!=null&&(c.className=t),o&&o.appendChild(c),c}function Re(l,t,o){let c=document.createElementNS("http://www.w3.org/2000/svg",l);for(let f of Object.keys(t))c.setAttributeNS(null,f,String(t[f]));return o&&o.appendChild(c),c}let tt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,yt=tt&&tt.userSelect!==void 0?"userSelect":"WebkitUserSelect",qe;function St(){tt&&yt&&(qe=tt[yt],tt[yt]="none")}function ai(){tt&&yt&&(tt[yt]=qe)}function pi(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",pi,!0)}function Cr(){window.addEventListener("click",pi,!0),window.setTimeout((()=>{window.removeEventListener("click",pi,!0)}),0)}function lr(l,t){let o=l.getBoundingClientRect();return li(l,o,t)}function bt(l,t){let o=l.getBoundingClientRect(),c=[];for(let f=0;f<t.length;f++)c.push(li(l,o,t[f]));return c}function Wt(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function li(l,t,o){let c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new n.P((o.clientX-t.left)*c,(o.clientY-t.top)*c)}let Hi="01",hi="NO_ACCESS_TOKEN";class Di{constructor(t,o,c){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){let t=(function(){let o="";for(let c=0;c<10;c++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Hi,o].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!n.h(t))return t;let c=Si(t);return c.params.push(`sdk=js-${R}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!n.h(t))return t;let c=Si(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeModelURL(t,o){if(!n.h(t))return t;let c=Si(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeSourceURL(t,o,c,f){if(!n.h(t))return t;let _=Si(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),c&&_.params.push(`language=${c}`),f&&_.params.push(`worldview=${f}`),this._makeAPIURL(_,this._customAccessToken||o)}normalizeIconsetURL(t,o){let c=Si(t);return n.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||o)):Ai(c)}normalizeSpriteURL(t,o,c,f){let _=Si(t);return n.h(t)?(_.path=`/styles/v1${_.path}/sprite${o}${c}`,this._makeAPIURL(_,this._customAccessToken||f)):(_.path+=`${o}${c}`,Ai(_))}normalizeTileURL(t,o,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.h(t))return t;let f=Si(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||c&&f.authority!=="raster"&&c===512?"@2x":""}${n.k.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${n.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${n.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${n.e.TILE_URL_VERSION}${f.path}`);let _=this._customAccessToken||(function(x){for(let S of x){let E=S.match(/^access_token=(.*)$/);if(E)return E[1]}return null})(f.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,_)}canonicalizeTileURL(t,o){let c=Si(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let f="mapbox://";c.path.match(/^\/raster\/v1\//)?f+=`raster/${c.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${c.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${c.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let _=c.params;return o&&(_=_.filter((x=>!x.match(/^access_token=/)))),_.length&&(f+=`?${_.join("&")}`),f}canonicalizeTileset(t,o){let c=!!o&&n.h(o),f=[];for(let _ of t.tiles||[])n.j(_)?f.push(this.canonicalizeTileURL(_,c)):f.push(_);return f}_makeAPIURL(t,o){let c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Si(n.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){let _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Ai(t);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter((_=>_.indexOf("access_token")===-1)),t.params.push(`access_token=${o||""}`),Ai(t)}}let kr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Si(l){let t=l.match(kr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ai(l){let t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}let oi="mapbox.eventData";function mo(l){if(!l)return null;let t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.l(t[1]))}catch{return null}}class Mi{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let o=mo(n.e.ACCESS_TOKEN),c="";return c=o&&o.u?n.f(o.u):n.e.ACCESS_TOKEN||"",t?`${oi}.${t}:${c}`:`${oi}:${c}`}fetchEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.getStorageKey("uuidTimestamp");if(t)try{let _=localStorage.getItem(o);_&&(this.eventData=JSON.parse(_));let x=localStorage.getItem(c);x&&(this.anonId=x);let S=localStorage.getItem(f);S&&(this.anonIdTimestamp=Number(S));let E=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<E)&&this.refreshUUID()}catch{n.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=n.u(),this.anonIdTimestamp=Date.now()}saveEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.getStorageKey("uuidTimestamp"),_=this.anonId,x=this.anonIdTimestamp;if(t&&_)try{localStorage.setItem(c,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData)),x&&localStorage.setItem(f,x.toString())}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,c,f){if(!n.e.EVENTS_URL)return;let _=Si(n.e.EVENTS_URL);_.params.push(`access_token=${f||n.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(t).toISOString()},S=o?Object.assign(x,o):x,E={url:Ai(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=n.p(E,(P=>{this.pendingRequest=null,c(P),this.saveEventData(),this.processRequests(f)}))}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}let Dr=new class extends Mi{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some((o=>n.h(o)||n.j(o)))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=mo(n.e.ACCESS_TOKEN),o=t?t.u:n.e.ACCESS_TOKEN,c=o!==this.eventData.tokenU;n.v(this.anonId)||(this.refreshUUID(),c=!0);let f=this.queue.shift();if(this.eventData.lastSuccess){let _=new Date(this.eventData.lastSuccess),x=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;c=c||S>=1||S<-1||_.getDate()!==x.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Hi,"enabled.telemetry":!1,userId:this.anonId},(_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=o)}),l):this.processRequests()}},gn=Dr.postTurnstileEvent.bind(Dr),er=new class extends Mi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,o,c){this.skuToken=t,this.errorCb=c,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},o):this.errorCb(new Error(hi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID(),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Hi,skuToken:this.skuToken,userId:this.anonId},(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l))}remove(){this.errorCb=null}},nn=er.postMapLoadEvent.bind(er),Kr=new class extends Mi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=n.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){let t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){let{map:o,style:c,importedStyles:f}=t;if(!n.e.EVENTS_URL||!l&&!n.e.ACCESS_TOKEN)return;let _=this.getMapInstanceId(o),x={mapInstanceId:_,eventId:this.getEventId(_),style:c};f.length&&(x.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:x},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),l)}},Pr=Kr.postStyleLoadEvent.bind(Kr),Uo=new class extends Mi{constructor(l){super("metrics"),l&&(this.data=l)}postMetricsEvent(l){if(!n.e.EVENTS_URL||!l&&!n.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID();let t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),l)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),oo=Uo.postMetricsEvent.bind(Uo),Er=new class extends Mi{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){n.e.EVENTS_URL&&(l||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:o}=this.queue.shift(),c=(function(f){let _=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),S=(function(N){let q={};if(N){for(let G in N)if(G!=="other")for(let K of N[G]){let $=`${G}ResolveRangeMin`,ee=`${G}ResolveRangeMax`,se=`${G}RequestCount`,ie=`${G}RequestCachedCount`;q[$]=Math.min(q[$]||1/0,K.startTime),q[ee]=Math.max(q[ee]||-1/0,K.responseEnd);let ge=ae=>{q[ae]===void 0&&(q[ae]=0),++q[ae]};K.transferSize!==void 0&&K.transferSize===0&&ge(ie),ge(se)}}return q})((function(N,q){let G={};if(N)for(let K of N){let $=q(K);G[$]===void 0&&(G[$]=[]),G[$].push(K)}return G})(_,re)),E=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=P?P.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},O=(N,q,G)=>{G!=null&&N.push({name:q,value:G.toString()})};for(let N in S)O(F.counters,N,S[N]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(F.counters,"interactionRangeMin",f.interactionRange[0]),O(F.counters,"interactionRangeMax",f.interactionRange[1])),x)for(let N of Object.values(j)){let q=x.find((G=>G.name===N));q&&O(F.counters,N,q.startTime)}return O(F.counters,"visibilityHidden",f.visibilityHidden),O(F.attributes,"style",(function(N){if(N)for(let q of N){let G=q.name.split("?")[0];if(n.i(G)){let K=G.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}})(_)),O(F.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(F.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(F.attributes,"projection",f.projection),O(F.attributes,"zoom",f.zoom),O(F.metadata,"devicePixelRatio",E),O(F.metadata,"connectionEffectiveType",M),O(F.metadata,"navigatorUserAgent",navigator.userAgent),O(F.metadata,"screenWidth",window.screen.width),O(F.metadata,"screenHeight",window.screen.height),O(F.metadata,"windowWidth",window.innerWidth),O(F.metadata,"windowHeight",window.innerHeight),O(F.metadata,"mapWidth",f.width/E),O(F.metadata,"mapHeight",f.height/E),O(F.metadata,"webglRenderer",f.renderer),O(F.metadata,"webglVendor",f.vendor),O(F.metadata,"sdkVersion",R),O(F.metadata,"sdkIdentifier","mapbox-gl-js"),F})(o);for(let f of c.metadata);for(let f of c.counters);for(let f of c.attributes);this.postEvent(t,c,(()=>{}),l)}},_n=Er.postPerformanceEvent.bind(Er),Mn=new class extends Mi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,o,c){if(!n.e.API_URL||!n.e.SESSION_PATH)return;let f=Si(n.e.API_URL+n.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||n.e.ACCESS_TOKEN||""}`);let _={url:Ai(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(_,(x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(c)}))}getSessionAPI(l,t,o,c){this.skuToken=t,this.errorCb=c,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},o):this.errorCb(new Error(hi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l)}remove(){this.errorCb=null}},Vs=Mn.getSessionAPI.bind(Mn),Wr=new Set;function Ta(l,t){t?Wr.add(l):Wr.delete(l)}class zo{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){let o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(let o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Qo(l){let{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class es extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.r()&&(this.imageRasterizerDispatcher=new n.D(n.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);let o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){let t=[];for(let o of this.imageProviders.values())for(let c of o.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.x),this._imageRasterizer}isLoaded(){for(let t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(let{ids:c,callback:f}of this.requestors)this._notify(c,o,f);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,c){this._validate(t,c)&&this.images.get(o).set(t.toString(),c)}_validate(t,o){let c=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(o.content,o)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,o){if(!t)return!0;let c=0;for(let f of t){if(f[0]<c||f[1]<f[0]||o<f[1])return!1;c=f[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,c){let f=this.images.get(o).get(t.toString());c.version=f.version+1,this.images.get(o).set(t.toString(),c),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(n.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){let c=this.images.get(o),f=c.get(t.toString());c.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((o=>n.I.from(o)))}getImages(t,o,c){let f=[],_=[],x=this.imageProviders.get(o);for(let M of t){if(!M.iconsetId){f.push(M);continue}let F=x.get(M.iconsetId);F&&(this.getImage(M,o)?_.push(M):F.addPendingRequest(M))}if(f.length===0)return void this._notify(_,o,c);let S=!0,E=!!this.loaded.get(o),P=this.images.get(o);if(!E)for(let M of f)P.has(M.toString())||(S=!1);E||S?this._notify(f,o,c):this.requestors.push({ids:f,scope:o,callback:c})}rasterizeImages(t,o){let c=new Map,{tasks:f,scope:_}=t;for(let[x,S]of f.entries()){let E=this.getImage(S.id,_);E&&c.set(x,{image:E,imageVariant:S})}this._rasterizeImages(_,c,o)}_rasterizeImages(t,o,c){if(n.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},c);else{let f=new Map;for(let[_,{image:x,imageVariant:S}]of o.entries())f.set(_,this.imageRasterizer.rasterize(S,x,t,0));c(void 0,f)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,c){let f=this.images.get(o),_=new Map;for(let x of t){if(!f.get(x.toString())){if(x.iconsetId)continue;this.fire(new n.z("styleimagemissing",{id:x.name}))}let S=f.get(x.toString());if(!S){n.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let E={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(E,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),_.set(n.I.toString(x),E)}c(null,_)}getPixelSize(t){let{width:o,height:c}=this.atlasImage.get(t);return{width:o,height:c}}getPattern(t,o,c){let f=t.toString(),_=this.patterns.get(o),x=_.get(f),S=this.getImage(t,o);if(!S)return null;if(x){if(x.position.version===S.version)return x.position;x.position.version=S.version}else{if(S.usvg&&!S.data){let E=this.getPatternInFlightId(f,o);if(this.patternsInFlight.has(E))return null;this.patternsInFlight.add(E);let P=new n.A(t).scaleSelf(n.o.devicePixelRatio),M=new Map([[P.toString(),{image:S,imageVariant:P}]]);return this._rasterizeImages(o,M,((F,O)=>this.storePatternImage(P,o,S,c,O))),null}this.storePattern(t,o,S)}return this._updatePatternAtlas(o,c),_.get(f).position}getPatternInFlightId(t,o){return n.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,c,f,_){let x=t.toString(),S=_?_.get(x):void 0;S&&(c.data=S,this.storePattern(t.id,o,c),this._updatePatternAtlas(o,f),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,c){let f={w:c.data.width+2*n.C,h:c.data.height+2*n.C,x:0,y:0},_=new n.F(f,c,n.C);this.patterns.get(o).set(t.toString(),{bin:f,position:_})}destroyAtlasTextures(){for(let t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){let c=t.gl,f=this.atlasTexture.get(o);f?this.dirty&&(f.update(this.atlasImage.get(o)),this.dirty=!1):(f=new n.T(t,this.atlasImage.get(o),c.RGBA8),this.atlasTexture.set(o,f)),f.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){let c=this.patterns.get(t),f=Array.from(c.values()).map((({bin:P})=>P)),{w:_,h:x}=n.G(f),S=this.atlasImage.get(t);S.resize({width:_||1,height:x||1});let E=this.images.get(t);for(let[P,{bin:M,position:F}]of c.entries()){let O=F.padding,N=M.x+O,q=M.y+O,G=E.get(P).data,K=G.width,$=G.height;O=O>1?O-1:O,n.q.copy(G,S,{x:0,y:0},{x:N,y:q},{width:K,height:$},o),n.q.copy(G,S,{x:0,y:$-O},{x:N,y:q-O},{width:K,height:O},o),n.q.copy(G,S,{x:0,y:0},{x:N,y:q+$},{width:K,height:O},o),n.q.copy(G,S,{x:K-O,y:0},{x:N-O,y:q},{width:O,height:$},o),n.q.copy(G,S,{x:0,y:0},{x:N+K,y:q},{width:O,height:$},o),n.q.copy(G,S,{x:K-O,y:$-O},{x:N-O,y:q-O},{width:O,height:O},o),n.q.copy(G,S,{x:0,y:$-O},{x:N+K,y:q-O},{width:O,height:O},o),n.q.copy(G,S,{x:0,y:0},{x:N+K,y:q+$},{width:O,height:O},o),n.q.copy(G,S,{x:K-O,y:0},{x:N-O,y:q+$},{width:O,height:O},o)}this.dirty=!0}beginFrame(){for(let t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){let c=this.images.get(o);for(let f of t){if(this.callbackDispatchedThisFrame.get(o).has(f.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(f.toString());let _=c.get(f.toString());Qo(_)&&this.updateImage(f,o,_)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function on(l){let t=l.value,o=l.valueSpec,c=l.style,f=l.styleSpec,_=l.key,x=l.arrayElementValidator||Gr;if(!Array.isArray(t))return[new n.V(_,t,`array expected, ${n.K(t)} found`)];if(o.length&&t.length!==o.length)return[new n.V(_,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new n.V(_,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let S={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};f.$version<7&&(S.function=o.function),n.H(o.value)&&(S=o.value);let E=[];for(let P=0;P<t.length;P++)E=E.concat(x({array:t,arrayIndex:P,value:t[P],valueSpec:S,style:c,styleSpec:f,key:`${_}[${P}]`},!0));return E}function lc(l){let t=l.key,o=l.value,c=l.valueSpec;if(!n.L(o))return[new n.V(t,o,`number expected, ${n.K(o)} found`)];if(o!=o)return[new n.V(t,o,"number expected, NaN found")];if("minimum"in c){let f=c.minimum;if(Array.isArray(c.minimum)&&(f=c.minimum[l.arrayIndex]),o<f)return[new n.V(t,o,`${o} is less than the minimum value ${f}`)]}if("maximum"in c){let f=c.maximum;if(Array.isArray(c.maximum)&&(f=c.maximum[l.arrayIndex]),o>f)return[new n.V(t,o,`${o} is greater than the maximum value ${f}`)]}return[]}function Ca(l){let t=l.key,o=l.value;if(!n.H(o))return[new n.V(t,o,`object expected, ${n.K(o)} found`)];let c=l.valueSpec,f=n.J(o.type),_,x,S,E={},P=f!=="categorical"&&o.property===void 0,M=!P,F=(function(G){let K=G.stops;return Array.isArray(K)&&Array.isArray(K[0])&&n.H(K[0][0])})(o),O=Gn({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(G){if(f==="identity")return[new n.V(G.key,G.value,'identity function may not have a "stops" property')];let K=[],$=G.value;return K=K.concat(on({key:G.key,value:$,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:N})),Array.isArray($)&&$.length===0&&K.push(new n.V(G.key,$,"array must have at least one stop")),K},default:function(G){return Gr({key:G.key,value:G.value,valueSpec:c,style:G.style,styleSpec:G.styleSpec})}}});return f==="identity"&&P&&O.push(new n.V(l.key,l.value,'missing required property "property"')),f==="identity"||o.stops||O.push(new n.V(l.key,l.value,'missing required property "stops"')),f==="exponential"&&c.expression&&!n.M(c)&&O.push(new n.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(M&&!n.N(c)?O.push(new n.V(l.key,l.value,"property functions not supported")):P&&!n.O(c)&&O.push(new n.V(l.key,l.value,"zoom functions not supported"))),f!=="categorical"&&!F||o.property!==void 0||O.push(new n.V(l.key,l.value,'"property" property is required')),O;function N(G){let K=[],$=G.value,ee=G.key;if(!Array.isArray($))return[new n.V(ee,$,`array expected, ${n.K($)} found`)];if($.length!==2)return[new n.V(ee,$,`array length 2 expected, length ${$.length} found`)];if(F){if(!n.H($[0]))return[new n.V(ee,$,`object expected, ${n.K($[0])} found`)];let se=$[0];if(se.zoom===void 0)return[new n.V(ee,$,"object stop key must have zoom")];if(se.value===void 0)return[new n.V(ee,$,"object stop key must have value")];let ie=n.J(se.zoom);if(typeof ie!="number")return[new n.V(ee,se.zoom,"stop zoom values must be numbers")];if(S&&S>ie)return[new n.V(ee,se.zoom,"stop zoom values must appear in ascending order")];ie!==S&&(S=ie,x=void 0,E={}),K=K.concat(Gn({key:`${ee}[0]`,value:$[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:lc,value:q}}))}else K=K.concat(q({key:`${ee}[0]`,value:$[0],style:G.style,styleSpec:G.styleSpec},$));return n.Q(n.S($[1]))?K.concat([new n.V(`${ee}[1]`,$[1],"expressions are not allowed in function stops.")]):K.concat(Gr({key:`${ee}[1]`,value:$[1],valueSpec:c,style:G.style,styleSpec:G.styleSpec}))}function q(G,K){let $=n.K(G.value),ee=n.J(G.value),se=G.value!==null?G.value:K;if(_){if($!==_)return[new n.V(G.key,se,`${$} stop domain type must match previous stop domain type ${_}`)]}else _=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new n.V(G.key,se,"stop domain value must be a number, string, or boolean")];if($!=="number"&&f!=="categorical"){let ie=`number expected, ${$} found`;return n.N(c)&&f===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(G.key,se,ie)]}return f!=="categorical"||$!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?f!=="categorical"&&$==="number"&&typeof ee=="number"&&typeof x=="number"&&x!==void 0&&ee<x?[new n.V(G.key,se,"stop domain values must appear in ascending order")]:(x=ee,f==="categorical"&&ee in E?[new n.V(G.key,se,"stop domain values must be unique")]:(E[ee]=!0,[])):[new n.V(G.key,se,`integer expected, found ${String(ee)}`)]}}function go(l){let t=(l.expressionContext==="property"?n.W:n.U)(n.S(l.value),l.valueSpec);if(t.result==="error")return t.value.map((c=>new n.V(`${l.key}${c.key}`,l.value,c.message)));let o=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!n.Z(o))return[new n.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return na(o,l);if(l.expressionContext==="appearance")return Tl(o,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!n.X(o,["zoom","feature-state"]))return[new n.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!n.Y(o))return[new n.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function na(l,t){let o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let f of t.valueSpec.expression.parameters)o.delete(f);if(o.size===0)return[];let c=[];return l instanceof n._&&o.has(l.name)?[new n.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild((f=>{c.push(...na(f,t))})),c)}function Tl(l,t){let o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(let f of t.valueSpec.expression.parameters)o.add(f);if(o.size===0)return[];let c=[];return l instanceof n._&&!o.has(l.name)?[new n.V(t.key,t.value,`["${l.name}"] is not an allowed parameter`)]:(l.eachChild((f=>{c.push(...Tl(f,t))})),c)}function _o(l){let t=l.key,o=l.value,c=l.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(n.J(o))===-1&&f.push(new n.V(t,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(n.J(o))===-1&&f.push(new n.V(t,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function Ea(l){return n.a2(n.S(l.value))?go(Object.assign({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):ts(l)}function ts(l){let t=l.value,o=l.key;if(!Array.isArray(t))return[new n.V(o,t,`array expected, ${n.K(t)} found`)];if(t.length<1)return[new n.V(o,t,"filter array must have at least 1 element")];let c=l.styleSpec,f=_o({key:`${o}[0]`,value:t[0],valueSpec:c.filter_operator});switch(n.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.J(t[1])==="$type"&&f.push(new n.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new n.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n.a0(t[1])||f.push(new n.V(`${o}[1]`,t[1],`string expected, ${n.K(t[1])} found`)));for(let _=2;_<t.length;_++)n.J(t[1])==="$type"?f=f.concat(_o({key:`${o}[${_}]`,value:t[_],valueSpec:c.geometry_type})):n.a0(t[_])||n.L(t[_])||n.$(t[_])||f.push(new n.V(`${o}[${_}]`,t[_],`string, number, or boolean expected, ${n.K(t[_])} found.`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)f=f.concat(ts({key:`${o}[${_}]`,value:t[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":t.length!==2?f.push(new n.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):n.a0(t[1])||f.push(new n.V(`${o}[1]`,t[1],`string expected, ${n.K(t[1])} found`))}return f}function Us(l,t){let o=l.key,c=l.style,f=l.layer,_=l.styleSpec,x=l.value,S=l.objectKey,E=_[`${t}_${l.layerType}`];if(!E)return[];let P=S.match(/^(.*)-use-theme$/);if(P&&E[P[1]])return n.Q(n.S(x))?[].concat(Gr({key:o,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S})):Gr({key:o,value:x,valueSpec:{type:"string"},style:c,styleSpec:_});let M=S.match(/^(.*)-transition$/);if(t==="paint"&&M&&E[M[1]]&&E[M[1]].transition)return Gr({key:o,value:x,valueSpec:_.transition,style:c,styleSpec:_});let F=l.valueSpec||E[S];if(!F)return[new n.a3(o,x,`unknown property "${S}"`)];let O;if(n.a0(x)&&n.N(F)&&!F.tokens&&(O=/^{([^}]+)}$/.exec(x))){let q=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new n.V(o,x,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}let N=[];if(l.layerType==="symbol")S!=="text-field"||!c||c.glyphs||c.imports||N.push(new n.V(o,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&n.a4(n.S(x))&&n.J(x.type)==="identity"&&N.push(new n.V(o,x,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&n.N(F)&&(n.a5(F)||n.O(F))){let q=n.W(n.S(x),F).value,G="expression"in q&&q.expression||"_styleExpression"in q&&q._styleExpression&&q._styleExpression.expression;G&&!n.X(G,["measure-light"])&&(S==="model-emissive-strength"&&n.Y(G)&&n.Z(G)||N.push(new n.V(o,x,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(Gr({key:l.key,value:x,valueSpec:F,style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S}))}function Aa(l){return Us(l,"paint")}function Ao(l){return Us(l,"layout")}function ka(l){let t=[],o=l.value,c=l.key,f=l.style,_=l.styleSpec;if(!n.H(o))return[new n.V(c,o,"object expected")];o.type||o.ref||t.push(new n.V(c,o,'either "type" or "ref" is required'));let x=n.J(o.type),S=n.J(o.ref);if(o.id){let E=n.J(o.id);for(let P=0;P<l.arrayIndex;P++){let M=f.layers[P];n.J(M.id)===E&&t.push(new n.V(c,o.id,`duplicate layer id "${E}", previously used at line ${M.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach((P=>{P in o&&t.push(new n.V(c,o[P],`"${P}" is prohibited for ref layers`))})),f.layers.forEach((P=>{n.J(P.id)===S&&(E=P)})),E?E.ref?t.push(new n.V(c,o.ref,"ref cannot reference another ref layer")):x=n.J(E.type):typeof S=="string"&&t.push(new n.V(c,o.ref,`ref layer "${S}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(o.source)if(n.a0(o.source)){let E=f.sources&&f.sources[o.source],P=E&&n.J(E.type);E?P==="vector"&&x==="raster"?t.push(new n.V(c,o.source,`layer "${o.id}" requires a raster source`)):P==="raster"&&x!=="raster"?t.push(new n.V(c,o.source,`layer "${o.id}" requires a vector source`)):P!=="vector"||o["source-layer"]?P==="raster-dem"&&x!=="hillshade"?t.push(new n.V(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&P==="geojson"&&!E.lineMetrics?t.push(new n.V(c,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&P!=="raster-array"&&t.push(new n.V(c,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new n.V(c,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(c,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new n.V(c,o.source,`source "${o.source}" not found`))}else t.push(new n.V(`${c}.source`,o.source,'"source" must be a string'));else t.push(new n.V(c,o,'missing required property "source"'));return t=t.concat(Gn({key:c,value:o,valueSpec:_.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gr({key:`${c}.type`,value:o.type,valueSpec:_.layer.type,style:l.style,styleSpec:l.styleSpec,object:o,objectKey:"type"}),filter:E=>Ea(Object.assign({layerType:x},E)),layout:E=>Gn({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":P=>Ao(Object.assign({layerType:x},P))}}),paint:E=>Gn({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":P=>Aa(Object.assign({layerType:x,layer:o},P))}}),appearances(E){let P=on({key:E.key,value:E.value,valueSpec:E.valueSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:O=>(function(N){let{key:q,layer:G,layerType:K}=N,$=n.J(N.value),ee=n.J($.name),se=n.J($.condition),ie=Gn({key:q,value:$,valueSpec:N.styleSpec.appearance,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{condition:ge=>(function(ae){let ye=[];return ye.push(...go({key:ae.key,value:ae.object.condition,valueSpec:n.a6.appearance.condition,expressionContext:"appearance"})),ye})(Object.assign({layer:G,layerType:K},ge)),properties:ge=>(function(ae){let ye=[],{styleSpec:pe,layer:ue,layerType:ve}=ae,ze=pe[`paint_${ve}`],Ie=pe[`layout_${ve}`],Ge=ae.object[ae.objectKey];for(let Be in Ge){let Ye=Be in ze?"paint":Be in Ie?"layout":void 0;if(!Ye){ye.push(new n.V(ae.key,Be,`unknown property "${Be}" for layer type "${ve}"`));continue}let gt=Object.assign({},ae,{key:`${ae.key}.${Be}`,object:Ge,objectKey:Be,layer:ue,layerType:ve,value:Ge[Be],valueSpec:Ye==="paint"?ze[Be]:Ie[Be]});ye.push(...Us(gt,Ye))}return ye})(Object.assign({layer:G,layerType:K},ge))}});return ee!=="hidden"&&se===void 0&&ie.push(new n.V(N.key,"name",'Appearance with name different than "hidden" must have a condition')),ie})(Object.assign({layerType:x,layer:o},O))}),M=Array.isArray(E.value)?E.value:[],F=new Set;return M.forEach(((O,N)=>{let q=n.J(O.name);if(q)if(F.has(q)){let G=n.J(o.id);P.push(new n.V(E.key,q,`Duplicated appearance name "${q}" for layer "${G}"`))}else F.add(q)})),P}}})),t}function gs({key:l,value:t}){return n.a0(t)?[]:[new n.V(l,t,`string expected, ${n.K(t)} found`)]}let Cl={promoteId:function l({key:t,value:o}){if(n.a0(o))return gs({key:t,value:o});if(Array.isArray(o)){let f=[],_=n.S(o),x=n.U(_);return x.result==="error"&&x.value.forEach((S=>{f.push(new n.V(`${t}${S.key}`,null,`${S.message}`))})),n.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),f}if(!n.H(o))return[new n.V(t,o,`string, expression or object expected, "${n.K(o)}" found`)];let c=[];for(let f in o)c.push(...l({key:`${t}.${f}`,value:o[f]}));return c}};function Xa(l){let t=l.value,o=l.key,c=l.styleSpec,f=l.style;if(!n.H(t))return[new n.V(o,t,`object expected, ${n.K(t)} found`)];if(!("type"in t))return[new n.V(o,t,'"type" is required')];let _=n.J(t.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&("url"in t||"tiles"in t||x.push(new n.a3(o,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Gn({key:o,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:Cl})),x;case"geojson":if(x=Gn({key:o,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Cl}),"cluster"in t&&"clusterProperties"in t){if(!n.H(t.clusterProperties))return[new n.V(`${o}.clusterProperties`,t,`object expected, ${n.K(t)} found`)];for(let S in t.clusterProperties){let E=t.clusterProperties[S];if(!Array.isArray(E))return[new n.V(`${o}.clusterProperties.${S}`,E,"array expected")];let[P,M]=E,F=typeof P=="string"?[P,["accumulated"],["get",S]]:P;x.push(...go({key:`${o}.${S}.map`,value:M,expressionContext:"cluster-map"})),x.push(...go({key:`${o}.${S}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return x;case"video":return Gn({key:o,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Gn({key:o,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _o({key:`${o}.type`,value:t.type,valueSpec:{values:xn(c)}})}}function xn(l){return l.source.reduce(((t,o)=>{let c=l[o];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values||{}))),t}),[])}function Ia(l){let t=l.value,o=l.styleSpec,c=o.light,f=l.style;if(t===void 0)return[];if(!n.H(t))return[new n.V("light",t,`object expected, ${n.K(t)} found`)];let _=[];for(let x in t){let S=x.match(/^(.*)-transition$/),E=x.match(/^(.*)-use-theme$/);_=_.concat(E&&c[E[1]]?Gr({key:x,value:t[x],valueSpec:{type:"string"},style:f,styleSpec:o}):S&&c[S[1]]&&c[S[1]].transition?Gr({key:x,value:t[x],valueSpec:o.transition,style:f,styleSpec:o}):c[x]?Gr({key:x,value:t[x],valueSpec:c[x],style:f,styleSpec:o}):[new n.V(x,t[x],`unknown property "${x}"`)])}return _}function El(l){let t=l.value;if(!t)return[];let o=l.key;if(!n.H(t))return[new n.V(o,t,`object expected, ${n.K(t)} found`)];let c=[],f=l.styleSpec,_=f["light-3d"],x=l.style,S=l.style.lights;for(let M of["type","id"])if(!(M in t))return c=c.concat([new n.V(o,t,`missing property "${M}"`)]),c;if(!n.a0(t.type))return c=c.concat([new n.V(`${o}.type`,t.type,"string expected")]),c;if(S)for(let M=0;M<l.arrayIndex;M++){let F=n.J(t.type),O=S[M];n.J(O.type)===F&&c.push(new n.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${O.id.__line__}`))}let E=`properties_light_${t.type}`;if(!(E in f))return c=c.concat([new n.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),c;let P=f[E];for(let M in t)if(M==="properties"){let F=t[M];if(!n.H(F))return c=c.concat([new n.V("properties",F,`object expected, ${n.K(F)} found`)]),c;for(let O in F){let N=O.match(/^(.*)-transition$/),q=O.match(/^(.*)-use-theme$/);c=c.concat(q&&P[q[1]]?Gr({key:M,value:F[O],valueSpec:{type:"string"},style:x,styleSpec:f}):N&&P[N[1]]&&P[N[1]].transition?Gr({key:M,value:t[M],valueSpec:f.transition,style:x,styleSpec:f}):P[O]?Gr({key:O,value:F[O],valueSpec:P[O],style:x,styleSpec:f}):[new n.a3(l.key,F[O],`unknown property "${O}"`)])}}else c=c.concat(_[M]?Gr({key:M,value:t[M],valueSpec:_[M],style:x,styleSpec:f}):[new n.a3(M,t[M],`unknown property "${M}"`)]);return c}function qo(l){let t=l.value,o=l.key,c=l.style,f=l.styleSpec,_=f.terrain;if(t==null)return[];if(!n.H(t))return[new n.V("terrain",t,`object expected, ${n.K(t)} found`)];let x=[];for(let S in t){let E=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);x=x.concat(P&&_[P[1]]?Gr({key:S,value:t[S],valueSpec:{type:"string"},style:c,styleSpec:f}):E&&_[E[1]]&&_[E[1]].transition?Gr({key:S,value:t[S],valueSpec:f.transition,style:c,styleSpec:f}):_[S]?Gr({key:S,value:t[S],valueSpec:_[S],style:c,styleSpec:f}):[new n.a3(S,t[S],`unknown property "${S}"`)])}if(t.source)if(n.a0(t.source)){let S=c.sources&&c.sources[t.source],E=S&&n.J(S.type);S?E!=="raster-dem"&&x.push(new n.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${E}, it only be used with a "raster-dem" source type`)):x.push(new n.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else x.push(new n.V(`${o}.source`,t.source,"source must be a string"));else x.push(new n.V(o,t,'terrain is missing required property "source"'));return x}function _s(l){let t=l.value,o=l.style,c=l.styleSpec,f=c.fog;if(t===void 0)return[];if(!n.H(t))return[new n.V("fog",t,`object expected, ${n.K(t)} found`)];let _=[];for(let x in t){let S=x.match(/^(.*)-transition$/),E=x.match(/^(.*)-use-theme$/);_=_.concat(E&&f[E[1]]?Gr({key:x,value:t[x],valueSpec:{type:"string"},style:o,styleSpec:c}):S&&f[S[1]]&&f[S[1]].transition?Gr({key:x,value:t[x],valueSpec:c.transition,style:o,styleSpec:c}):f[x]?Gr({key:x,value:t[x],valueSpec:f[x],style:o,styleSpec:c}):[new n.a3(x,t[x],`unknown property "${x}"`)])}return _}let is={"*":()=>[],array:on,boolean:function(l){let t=l.value,o=l.key;return n.$(t)?[]:[new n.V(o,t,`boolean expected, ${n.K(t)} found`)]},number:lc,color:function({key:l,value:t}){return n.a0(t)?n.a1.parseCSSColor(t)===null?[new n.V(l,t,`color expected, "${t}" found`)]:[]:[new n.V(l,t,`color expected, ${n.K(t)} found`)]},enum:_o,filter:Ea,function:Ca,layer:ka,object:Gn,source:Xa,model:n.a7,light:Ia,"light-3d":El,terrain:qo,fog:_s,string:gs,formatted:function(l){return gs(l).length===0?[]:go(l)},resolvedImage:function(l){return gs(l).length===0?[]:go(l)},projection:function(l){let t=l.value,o=l.styleSpec,c=o.projection,f=l.style;if(n.H(t)){let _=[];for(let x in t)_=_.concat(Gr({key:x,value:t[x],valueSpec:c[x],style:f,styleSpec:o}));return _}return n.a0(t)?[]:[new n.V("projection",t,`object or string expected, ${n.K(t)} found`)]},import:function(l){let t=l.key,{value:o,styleSpec:c}=l;if(!n.H(o))return[new n.V(t,o,"import must be an object")];let{data:f,..._}=o;Object.defineProperty(_,"__line__",{value:o.__line__,enumerable:!1});let x=Gn(Object.assign({},l,{value:_,valueSpec:c.import}));return n.J(_.id)===""&&x.push(new n.V(`${l.key}.id`,_,"import id can't be an empty string")),f&&(x=x.concat(La(f,c,{key:`${l.key}.data`}))),x},iconset:function(l){let t=l.value,o=l.key,c=l.styleSpec,f=l.style;if(!n.H(t))return[new n.V(o,t,"object expected")];if(!t.type)return[new n.V(o,t,'"type" is required')];let _=n.J(t.type),x=[];if(x=x.concat(Gn({key:o,value:t,valueSpec:c[`iconset_${_}`],style:f,styleSpec:c})),(function(S,E){return!(S!=="source"||!E.source)})(_,t)){let S=f.sources&&f.sources[t.source],E=S&&n.J(S.type);S?E!=="raster-array"&&x.push(new n.V(o,t.source,`iconset cannot be used with a source of type ${String(E)}, it only be used with a "raster-array" source type`)):x.push(new n.V(o,t.source,`source "${t.source}" not found`))}return x}};function Gr(l,t=!1){let o=l.value,c=l.valueSpec,f=l.styleSpec;if(c.expression){if(n.a4(n.J(o)))return Ca(l);if(n.Q(n.S(o)))return go(l)}if(c.type&&is[c.type]){let _=is[c.type](l);return t===!0&&_.length>0&&Array.isArray(l.value)?go(l):_}return Gn(Object.assign({},l,{valueSpec:c.type?f[c.type]:c}))}function Gn(l){let t=l.key,o=l.value,c=l.valueSpec||{},f=l.objectElementValidators||{},_=l.style,x=l.styleSpec;if(!n.H(o))return[new n.V(t,o,`object expected, ${n.K(o)} found`)];let S=[];for(let E in o){let P=E.split(".")[0],M;f[P]?M=f[P]:c[P]?M=Gr:f["*"]?M=f["*"]:c["*"]&&(M=Gr),M?S=S.concat(M({key:(t&&`${t}.`)+E,value:o[E],valueSpec:c[P]||c["*"],style:_,styleSpec:x,object:o,objectKey:E},o)):S.push(new n.a3(t,o[E],`unknown property "${E}"`))}for(let E in c){if(f[E])continue;let P=c[E];P.required&&P.default===void 0&&o[E]===void 0&&S.push(new n.V(t,o,`missing required property "${E}"`))}return S}function Pa({key:l,value:t}){let o=gs({key:l,value:t});if(o.length)return o;let c=t;return c.indexOf("{fontstack}")===-1&&o.push(new n.V(l,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&o.push(new n.V(l,t,'"glyphs" url must include a "{range}" token')),o}function La(l,t=n.a6,o={}){return Gn({key:o.key||"",value:l,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:l,objectElementValidators:{glyphs:Pa}})}function Wo(l,t=n.a6){return Le(La(l,t))}let Xc=l=>Le(Xa(l)),cc=l=>Le(Ia(l)),Zu=l=>Le(El(l)),Al=l=>Le(qo(l)),st=l=>Le(_s(l)),oa=l=>Le((function(t){let o=t.value,c=t.style,f=t.styleSpec,_=f.snow;if(o===void 0)return[];if(!n.H(o))return[new n.V("snow",o,`object expected, ${n.K(o)} found`)];let x=[];for(let S in o){let E=S.match(/^(.*)-transition$/);x=x.concat(E&&_[E[1]]&&_[E[1]].transition?Gr({key:S,value:o[S],valueSpec:f.transition,style:c,styleSpec:f}):_[S]?Gr({key:S,value:o[S],valueSpec:_[S],style:c,styleSpec:f}):[new n.a3(S,o[S],`unknown property "${S}"`)])}return x})(l)),uc=l=>Le((function(t){let o=t.value,c=t.style,f=t.styleSpec,_=f.rain;if(o===void 0)return[];if(!n.H(o))return[new n.V("rain",o,`object expected, ${n.K(o)} found`)];let x=[];for(let S in o){let E=S.match(/^(.*)-transition$/);x=x.concat(E&&_[E[1]]&&_[E[1]].transition?Gr({key:S,value:o[S],valueSpec:f.transition,style:c,styleSpec:f}):_[S]?Gr({key:S,value:o[S],valueSpec:_[S],style:c,styleSpec:f}):[new n.a3(S,o[S],`unknown property "${S}"`)])}return x})(l)),dc=l=>Le(ka(l)),Bi=l=>Le(Ea(l)),bn=l=>Le(Aa(l)),ki=l=>Le(Ao(l)),kl=l=>Le(n.a7(l));function Le(l){return l.slice().sort(((t,o)=>t.line&&o.line?t.line-o.line:0))}function Z(l,t){let o=!1;if(t&&t.length)for(let c of t)c instanceof n.a3?n.w(c.message):(l.fire(new n.y(new Error(c.message))),o=!0);return o}let X=n.a6.light,le;class Te extends n.E{constructor(t,o="flat"){super(),this._transitionable=new n.a8(le||(le=new n.a9({anchor:new n.aa(X.anchor),position:new n.ab(X.position),color:new n.aa(X.color),intensity:new n.aa(X.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,c={}){this._validate(cc,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,c){return(!c||c.validate!==!1)&&Z(this,t.call(Wo,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let we=n.a6.terrain,ke=class extends n.E{constructor(l,t,o,c,f){super(),this.scope=o,this._transitionable=new n.a8(new n.a9({source:new n.aa(we.source),exaggeration:new n.aa(we.exaggeration)}),o,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=f}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new n.ac(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let l=this._transitionable._values.exaggeration;if(!l)return null;let t=l.value.expression;if(!t)return null;let o=-1,c=-1,f=1;for(let _ of t.zoomStops)f=t.evaluate(new n.ac(_,{worldview:this.worldview})),f>.01?(o=_,c=-1):c=_;return f<.01&&o>0&&c>o?[o,c]:null}isZoomDependent(){let l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof n.ad}},je=45,Pe=65,Fe=.05;function dt(l,t,o,c){let f=n.ah(je,Pe,o),[_,x]=rt(l,c),S=1-Math.min(1,Math.exp((t-_)/(x-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*f*l.alpha}function rt(l,t){let o=.5/Math.tan(.5*t);return[l.range[0]+o,l.range[1]+o]}function jt(l,t,o,c,f){let _=n.af([],[t,o,c],f.mercatorFogMatrix);return dt(l,n.ag(_),f.pitch,f._fov)}function ti(l,t,o,c,f,_,x){let S=[[o,c,0],[f,c,0],[f,_,0],[o,_,0]],E=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let M of S){let F=n.af([],M,t),O=n.ag(F);E=Math.min(E,O),P=Math.max(P,O)}return[dt(l,E,x.pitch,x._fov),dt(l,P,x.pitch,x._fov)]}let ii=n.a6.fog;class Zt extends n.E{constructor(t,o,c,f){super();let _=new n.a9({range:new n.aa(ii.range),color:new n.aa(ii.color),"color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.aa(ii["high-color"]),"high-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.aa(ii["space-color"]),"space-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.aa(ii["horizon-blend"]),"star-intensity":new n.aa(ii["star-intensity"]),"vertical-range":new n.aa(ii["vertical-range"])});this._transitionable=new n.a8(_,c,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.ai(_),this.scope=c}get state(){let t=this._transform,o=t.projection.name==="globe",c=n.aj(t.zoom),f=this.properties.get("range"),_=[.5,3];return{range:o?[n.ak(_[0],f[0],c),n.ak(_[1],f[1],c)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,c={}){if(this._validate(st,t,c))return;let f=Object.assign({},t);for(let _ of Object.keys(ii))f[_]===void 0&&(f[_]=ii[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ah(je,Pe,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?(function(c,f,_){let x=n.ae.fromLngLat(f),S=_.elevation?_.elevation.getAtPointOrZero(x):0;return jt(c,x.x,x.y,S,_)})(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ti(this.state,o,0,0,n.al,n.al,this._transform)}getOpacityForBounds(t,o,c,f,_){return this._transform.projection.supportsFog?ti(this.state,t,o,c,f,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?rt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let o=[4,5,6,7];for(let c of o){let f=t.points[c],_;if(f[2]>=0)_=f;else{let x=t.points[c-4];_=n.am(x,f,x[2]/(x[2]-f[2]))}if(jt(this.state,_[0],_[1],0,this._transform)>=Fe)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,c){return(!c||c.validate!==!1)&&Z(this,t.call(Wo,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let bi,Ci,mr,Hr,un=class extends n.E{constructor(l,t,o,c){super();let f=bi||(bi=new n.a9({density:new n.aa(n.a6.snow.density),intensity:new n.aa(n.a6.snow.intensity),color:new n.aa(n.a6.snow.color),opacity:new n.aa(n.a6.snow.opacity),vignette:new n.aa(n.a6.snow.vignette),"vignette-color":new n.aa(n.a6.snow["vignette-color"]),"center-thinning":new n.aa(n.a6.snow["center-thinning"]),direction:new n.aa(n.a6.snow.direction),"flake-size":new n.aa(n.a6.snow["flake-size"])}));this._transitionable=new n.a8(f,o,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(f),this.scope=o}get state(){let l=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),c=n.an(o[0]),f=-Math.max(n.an(o[1]),.01),_=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],x=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*l),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(l,t,o={}){if(this._validate(oa,l,o))return;let c=Object.assign({},l),f=n.a6.snow;for(let _ of Object.keys(f))c[_]===void 0&&(c[_]=f[_].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,o){return(!o||o.validate!==!1)&&Z(this,l.call(Wo,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}},dn=class extends n.E{constructor(l,t,o,c){super();let f=Ci||(Ci=new n.a9({density:new n.aa(n.a6.rain.density),intensity:new n.aa(n.a6.rain.intensity),color:new n.aa(n.a6.rain.color),opacity:new n.aa(n.a6.rain.opacity),vignette:new n.aa(n.a6.rain.vignette),"vignette-color":new n.aa(n.a6.rain["vignette-color"]),"center-thinning":new n.aa(n.a6.rain["center-thinning"]),direction:new n.aa(n.a6.rain.direction),"droplet-size":new n.aa(n.a6.rain["droplet-size"]),"distortion-strength":new n.aa(n.a6.rain["distortion-strength"])}));this._transitionable=new n.a8(f,o,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(f),this.scope=o}get state(){let l=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),c=n.an(o[0]),f=-Math.max(n.an(o[1]),.01),_=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*l),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(l,t,o={}){if(this._validate(uc,l,o))return;let c=Object.assign({},l),f=n.a6.rain;for(let _ of Object.keys(f))c[_]===void 0&&(c[_]=f[_].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,o){return(!o||o.validate!==!1)&&Z(this,l.call(Wo,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}};class sn extends n.E{constructor(t,o,c,f){super(),this.scope=c,this._options=t,this.properties=new n.ai(o),this._transitionable=new n.a8(o,c,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ki{constructor(t,o,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,o){let c,f;if(t instanceof n.P||typeof t[0]=="number"){let _=n.P.convert(t);c=[_],f=o.isPointAboveHorizon(_)}else{let _=n.P.convert(t[0]),x=n.P.convert(t[1]),S=_.add(x)._div(2);c=[_,x],f=n.aq(_,x).every((E=>o.isPointAboveHorizon(E)))&&o.isPointAboveHorizon(S)}return new Ki(c,f,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let o=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],f=n.aq(o,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<c.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?f[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(f[3]=this.cameraPoint)),n.ar(f,t)}bufferedCameraGeometryGlobe(t){let o=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],f=n.aq(o,c,t),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>c.y))+((_.x>o.x)+(_.x>c.x))){case 0:f[0]=_,f[4]=_.clone();break;case 1:f.splice(1,0,_);break;case 2:f[1]=_;break;case 3:f.splice(4,0,_);break;case 5:f.splice(2,0,_);break;case 6:f[3]=_;break;case 7:f.splice(3,0,_);break;case 8:f[2]=_}return f}containsTile(t,o,c,f=0){let _=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/o._pixelsPerMercatorPixel+1,x=c?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o),S=t.tileID.wrap+(x.unwrapped?f:0),E=x.polygon.map((K=>n.as(t.tileTransform,K,S)));if(!n.at(E,0,0,n.al,n.al))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);let P=this.screenGeometryMercator.polygon.map((K=>n.au(t.tileTransform,K,S))),M=P.map((K=>new n.P(K[0],K[1]))),F=o.getFreeCameraOptions().position||new n.ae(0,0,0),O=n.au(t.tileTransform,F,S),N=P.map((K=>{let $=n.av(K,K,O);return n.aw($,$),new n.ax(O,$)})),q=n.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:N,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(G=n.az(E),G.min.x=n.aA(G.min.x,0,n.al),G.min.y=n.aA(G.min.y,0,n.al),G.max.x=n.aA(G.max.x,0,n.al),G.max.y=n.aA(G.max.y,0,n.al),G),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var G}_bufferedScreenMercator(t,o){let c=Br(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let f;return f=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map((_=>o.pointCoordinate3D(_))),unwrapped:!0},this._screenRaycastCache[c]=f,f}}_bufferedCameraMercator(t,o){let c=Br(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let f;return f=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map((_=>o.pointCoordinate3D(_))),unwrapped:!0},this._cameraRaycastCache[c]=f,f}}_projectAndResample(t,o){let c=(function(_,x){let S=n.aB([],x.pixelMatrix,x.globeMatrix),E=[0,-n.aD,0,1],P=[0,n.aD,0,1],M=[0,0,0,1];n.aC(E,E,S),n.aC(P,P,S),n.aC(M,M,S);let F=new n.P(E[0]/E[3],E[1]/E[3]),O=new n.P(P[0]/P[3],P[1]/P[3]),N=n.aE(_,F)&&E[3]<M[3],q=n.aE(_,O)&&P[3]<M[3];if(!N&&!q)return null;let G=(function(ye,pe,ue){for(let ve=1;ve<ye.length;ve++){let ze=Ii(pe.pointCoordinate3D(ye[ve-1]).x),Ie=Ii(pe.pointCoordinate3D(ye[ve]).x);if(ue<0){if(ze<Ie)return{idx:ve,t:-ze/(Ie-1-ze)}}else if(Ie<ze)return{idx:ve,t:(1-ze)/(Ie+1-ze)}}return null})(_,x,N?-1:1);if(!G)return null;let{idx:K,t:$}=G,ee=K>1?Kt(_.slice(0,K),x):[],se=K<_.length?Kt(_.slice(K),x):[];ee=ee.map((ye=>new n.P(Ii(ye.x),ye.y))),se=se.map((ye=>new n.P(Ii(ye.x),ye.y)));let ie=[...ee];ie.length===0&&ie.push(se[se.length-1]);let ge=n.ak(ie[ie.length-1].y,(se.length===0?ee[0]:se[0]).y,$),ae;return ae=N?[new n.P(0,ge),new n.P(0,0),new n.P(1,0),new n.P(1,ge)]:[new n.P(1,ge),new n.P(1,1),new n.P(0,1),new n.P(0,ge)],ie.push(...ae),se.length===0?ie.push(ee[0]):ie.push(...se),{polygon:ie.map((ye=>new n.ae(ye.x,ye.y))),unwrapped:!1}})(t,o);if(c)return c;let f=(function(_,x){let S=!1,E=-1/0,P=0;for(let F=0;F<_.length-1;F++)_[F].x>E&&(E=_[F].x,P=F);for(let F=0;F<_.length-1;F++){let O=(P+F)%(_.length-1),N=_[O],q=_[O+1];Math.abs(N.x-q.x)>.5&&(N.x<q.x?(N.x+=1,O===0&&(_[_.length-1].x+=1)):(q.x+=1,O+1===_.length-1&&(_[0].x+=1)),S=!0)}let M=n.aF(x.center.lng);return S&&M<Math.abs(M-1)&&_.forEach((F=>{F.x-=1})),{polygon:_,unwrapped:S}})(Kt(t,o).map((_=>new n.P(Ii(_.x),_.y))),o);return{polygon:f.polygon.map((_=>new n.ae(_.x,_.y))),unwrapped:f.unwrapped}}}function Kt(l,t){return n.aG(l,(o=>{let c=t.pointCoordinate3D(o);o.x=c.x,o.y=c.y}),1/256)}function Ii(l){return l<0?1+l%1:l%1}function Br(l){return 100*l|0}function tr(l,t,o,c,f){let _=function(S,E){if(S)return f(S);if(E){if(l.url&&E.tiles&&l.tiles&&delete l.tiles,E.variants){if(!Array.isArray(E.variants))return f(new Error("variants must be an array"));for(let M of E.variants){if(M==null||typeof M!="object"||M.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(M.capabilities))return f(new Error("capabilities must be an array"));if(M.capabilities.length===1&&M.capabilities[0]==="meshopt"){E=Object.assign(E,M);break}}}let P=n.aH(Object.assign({},E,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,l.url),f(null,P)}},x=(function(S,E,P){if(!S)return null;if(!E&&!P)return S;P=P||S.worldview_default;let M=Object.values(S.language||{});if(M.length===0)return null;let F=Object.values(S.worldview||{});if(F.length===0)return null;let O=M.every((q=>q===E)),N=F.every((q=>q===P));return O&&N?S:E in(S.language_options||{})||P in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null})(l.data,o,c);return x?n.o.frame((()=>_(null,x))):l.url?n.m(t.transformRequest(t.normalizeSourceURL(l.url,null,o,c),n.R.Source),_):n.o.frame((()=>{let{data:S,...E}=l;_(null,E)}))}function yr(l,t){let o=Math.pow(2,t.z),c=Math.floor(n.aF(l.getWest())*o),f=Math.floor(n.aJ(l.getNorth())*o),_=Math.ceil(n.aF(l.getEast())*o),x=Math.ceil(n.aJ(l.getSouth())*o);return t.x>=c&&t.x<_&&t.y>=f&&t.y<x}class Tn{constructor(t,o,c){this.bounds=t?n.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(let o of t)this.extraBounds.push(n.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!yr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(let o of this.extraBounds)if(yr(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;let o=new Tn(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class Ri extends n.E{constructor(t,o,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,n.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new n.aK}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,o,c,((f,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,f)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new n.y(f));else if(_){if(Object.assign(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of _.vector_layers)this.vectorLayerIds.push(x.id),_.worldview&&_.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Tn.fromTileJSON(_),gn(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(f)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){let c=t.tileID.canonical.url(this.tiles,this.scheme),f=this.map._requestManager.normalizeTileURL(c),_=this.map._requestManager.transformRequest(f,n.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S=x?{image:x.image.clone()}:null,E={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&n.h(c)&&(E.localizableLayerIds=this.localizableLayerIds),E.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",E,P.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",E,P.bind(this),void 0,!0);else{let M=n.aL.call({deduped:this._deduped},E,((F,O)=>{if(F||!O)P.call(this,F);else{let N=n.aM(O.responseHeaders);E.data={cacheControl:N.cacheControl,expires:N.expires,rawData:O.rawData.slice(0)},t.actor&&t.actor.send("loadTile",E,P.bind(this),void 0,!0)}}),!0);t.request={cancel:M}}function P(M,F){return delete t.request,t.aborted?o(null):M&&M.status!==404?o(M):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),n.aN(this.dispatcher),o(null,F),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Jr extends n.E{constructor(t,o,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,n.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));let o=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,null,o,((c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new n.y(c)):f&&(Object.assign(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map((_=>_.id))),this.tileBounds=Tn.fromTileJSON(f),gn(f.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){let c=n.o.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=n.n(this.map._requestManager.transformRequest(f,n.R.Tile),((_,x,S)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(_)return t.state="errored",o(_);if(!x)return o(null);let E=n.aM(S);this.map._refreshExpiredTiles&&t.setExpiryData(E),t.setTexture(x,this.map.painter),t.state="loaded",n.aN(this.dispatcher),o(null)}))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sa([l,t],o,c,{scaled:f=!0}={}){let{tileSize:_,buffer:x}=c,{x:S,y:E,z:P}=o;if(!isFinite(S)||!isFinite(E)||!isFinite(P))throw new Error("Invalid MRT header");let M=2**P,F=M*n.aF(l),O=M*n.aJ(t);return(function([N,q],G,{scaled:K=!0}={}){if(!G)throw new Error("bandView is undefined");let{data:$,tileSize:ee,buffer:se,offset:ie,scale:ge,dimension:ae}=G;if(N<-se||N>ee+se||q<-se||q>ee+se)throw new Error(`Point (${N}, ${q}) out of bounds for tileSize=${ee}, buffer=${se}`);let ye=(q+se)*(ee+2*se)+(N+se);if(new Uint32Array($.buffer)[ye]===4294967295)return null;let pe=[];pe=K?[]:new G.data.constructor(ae);for(let ue=0;ue<ae;ue++)pe[ue]=Math.round(1e12*($[ae*ye+ue]*ge+ie))/1e12;return pe})([Math.min(Math.max(-x,Math.floor((F-S)*_)),_-1+x),Math.min(Math.max(-x,Math.floor((O-E)*_)),_-1+x)],c,{scaled:f})}class Cn extends Jr{constructor(t,o,c,f){super(t,o,c,f),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){let o=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);o&&o.enabled&&c&&o._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){let c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,n.R.Tile),_={request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor());let x=(S,E,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(S)return S.name==="AbortError"?void 0:(t.state="errored",o(S));if(this.map._refreshExpiredTiles&&E){let M=n.aM(P);t.setExpiryData(M)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!E)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=E}o(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",_,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){let c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!0);for(let f of c.values())this.map.painter.saveTileTexture(f)}else t.destroy()}prepareTile(t,o,c,f){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,c,f,((_,x)=>{if(_)return t.state="errored",this.fire(new n.y(_)),void this.triggerRepaint(t);x&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,x,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;let o=this.rasterLayers.find((({id:_})=>_===t)),c=o&&o.fields,f=c&&c.bands&&c.bands;return f?f[0]:0}getTextureDescriptor(t,o,c){if(!t)return;let f=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let _=null;o instanceof n.aQ?_=o.paint.get("raster-array-band"):o instanceof n.aR&&(_=o.paint.get("raster-particle-array-band"));let x=_||this.getInitialBand(f);if(x==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,f,o.id,x);if(t.updateNeeded(o.id,x)&&!c)return;let S=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},S,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){let c=new Map;for(let f of t)for(let _ of o){let[x,S]=_.split("/"),E=f.getLayer(x);if(!E||!E.hasBand(S)||!E.hasDataForBand(S))continue;let{bytes:P,tileSize:M,buffer:F}=E.getBandView(S),O=M+2*F,N={data:new n.q({width:O,height:O},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(_,N)}return c}queryRasterArrayValueByBandId(t,o,c){let f=o._mrt;return new Promise((_=>{let x={},S=new Set;for(let[E,P]of Object.entries(f.layers)){if(c.layerName&&E!==c.layerName)continue;let M={};x[E]=M;for(let{bands:F}of P.dataIndex)for(let O of F)c.bands&&!c.bands.includes(O)||(S.add(n.B(E,O)),o.fetchBand(E,null,O,(N=>{n.o.frame((()=>{M[O]=N?null:sa([t.lng,t.lat],f,P.getBandView(O)),S.delete(n.B(E,O)),S.size===0&&_(x)}))}),!1))}S.size===0&&_(x)}))}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];let c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,n.R.Tile);t.actor.send("loadTile",{request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((_,x,S)=>{if(_)return this._loadTilePending[t.uid].forEach((E=>E(_,null))),void delete this._loadTilePending[t.uid];if(!x)return this._loadTilePending[t.uid].forEach((E=>E(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&x){let E=n.aM(S);t.setExpiryData(E)}t._mrt=x,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((E=>E(null,x))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,o,c){return new Promise(((f,_)=>{this._loadTileForQuery(o,((x,S)=>{x?_(x):f(S?this.queryRasterArrayValueByBandId(t,o,c):null)}))}))}queryRasterArrayValue(t,o){let c=n.aS.convert(t),f=this.findLoadedParent(c);return f&&f._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(c,f,o):this.queryRasterArrayValueByAllBands(c,f,o):Promise.resolve(null)}findLoadedParent(t){let o=n.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,f=1<<c,_=Math.floor(o.x),x=Math.floor((o.x-_)*f),S=Math.floor(o.y*f),E=this.map.style.getSourceCache(this.id),P=new n.aP(c,_,c,x,S);return E.findLoadedParent(P,this.minzoom)}}let Pn={vector:Ri,raster:Jr,"raster-dem":class extends Jr{constructor(l,t,o,c){super(l,t,o,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){let o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(f,_){f&&(l.state="errored",t(f)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=n.n(this.map._requestManager.transformRequest(o,n.R.Tile),function(f,_,x){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(_){let S=n.aM(x);this.map._refreshExpiredTiles&&l.setExpiryData(S);let E=ImageBitmap&&_ instanceof ImageBitmap&&n.r(),P=1-(_.width-n.aO(_.width))/2;P<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));let M=E?_:n.o.getImageData(_,P),F={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:M,encoding:this.encoding,padding:P};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",F,c.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){let t=l.canonical,o=Math.pow(2,t.z),c=(t.x-1+o)%o,f=t.x===0?l.wrap-1:l.wrap,_=(t.x+1+o)%o,x=t.x+1===o?l.wrap+1:l.wrap,S={};return S[new n.aP(l.overscaledZ,f,t.z,c,t.y).key]={backfilled:!1},S[new n.aP(l.overscaledZ,x,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(S[new n.aP(l.overscaledZ,f,t.z,c,t.y-1).key]={backfilled:!1},S[new n.aP(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new n.aP(l.overscaledZ,x,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<o&&(S[new n.aP(l.overscaledZ,f,t.z,c,t.y+1).key]={backfilled:!1},S[new n.aP(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new n.aP(l.overscaledZ,x,t.z,_,t.y+1).key]={backfilled:!1}),S}},"raster-array":Cn,geojson:class extends n.E{constructor(l,t,o,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let f=n.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:n.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let o of this._data.features)t.set(o.id,o);for(let o of l.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:o},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;let t=Object.assign({append:l},this.workerOptions);t.scope=this.scope;let o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(n.o.resolveURL(o),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new n.y(c));else{let _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new n.z("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){let l=n.B(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){let o=l.actor?"reloadTile":"loadTile";l.actor=this.actor;let c=this.map.style?this.map.style.getLut(this.scope):null,f=c?{image:c.image.clone()}:null,_=this._partialReload,x={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};l.request=this.actor.send(o,x,((S,E)=>_&&!E?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):S?t(S):(l.loadVectorData(E,this.map.painter,o==="reloadTile"),t(null)))),void 0,o==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aT{constructor(l,t,o,c){super(l,t,o,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let l=this.options;this.urls=[];for(let t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aU(this.urls,((t,o)=>{this._loaded=!0,t?this.fire(new n.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){let t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aT,model:n.aW,"batched-model":class extends n.E{constructor(l,t,o,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();let l=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(l)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,t,o,((c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.y(c))):f&&(Object.assign(this,f),f.bounds&&(this.tileBounds=new Tn(f.bounds,this.minzoom,this.maxzoom)),gn(f.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)}))}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){let o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.o.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){let _=Object.values(l.buckets);for(let x of _)x.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,f.bind(this),void 0,!0);function f(_,x){return l.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&x&&l.setExpiryData(x),l.loadModelData(x,this.map.painter),l.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends n.aT{constructor(l,t,o,c){super(l,t,o,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((f=>!Array.isArray(f)||f.length!==2||f.some((_=>typeof _!="number"))))||this.fire(new n.y(new n.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof n.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends n.E{constructor(l,t,o,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Tn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,n.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){let{x:t,y:o,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:o,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){let{x:o,y:c,z:f}=l.tileID.canonical,_=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:o,y:c,z:f},{signal:_.signal})).then(function(x){return delete l.request,l.aborted?(l.state="unloaded",t(null)):x===void 0?(l.state="errored",t(null)):x===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):(function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement})(x)?(this.loadTileData(l,x),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((x=>{x.name!=="AbortError"&&(l.state="errored",t(x))})),l.request.cancel=()=>_.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof n.T?(l.destroy(!0),l.texture&&l.texture instanceof n.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){let{x:o,y:c,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:o,y:c,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z})))}_clearTiles(){let l=n.B(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},yo=function(l,t,o,c){let f=new Pn[t.type](l,t,o,c);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return n.aX(["load","abort","unload","serialize","prepare"],f),f};function Mo(l,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${(function(c){if("layerId"in c)return`layer:${c.layerId}`;{let{featuresetId:f,importId:_}=c;return`featureset:${f}${_?`:import:${_}`:""}`}})(l.target)}`}function Un(l,t,o,c=""){if(l.uniqueFeatureID){let f=Mo(l,t,c);if(o.has(f))return!0;o.add(f)}return!1}function Zr(l,t,o,c,f=!1){let _=t.sourceCache.transform,x=t.sourceCache.tilesIn(l,t.has3DLayers,f);x.sort(la);let S=[];for(let E of x){let P=E.tile.queryRenderedFeatures(t,E,o,c,_,f);Object.keys(P).length&&S.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:P})}for(let E in t.layers){let P=t.layers[E];if(P.styleLayer){let M=P.styleLayer.queryRenderedFeatures(l,t.sourceCache,c);Object.keys(M).length&&S.push({wrappedTileID:0,queryResults:M})}}return S.length===0?{}:(function(E){let P={},M={};for(let F of E){let O=F.queryResults,N=F.wrappedTileID,q=M[N]=M[N]||{};for(let G in O){let K=O[G],$=q[G]=q[G]||{},ee=P[G]=P[G]||[];for(let se of K)$[se.featureIndex]||($[se.featureIndex]=!0,ee.push(se))}}return P})(S)}function qs(l,t,o,c,f,_){let x={},S=c.queryRenderedSymbols(l),E=[];for(let P of Object.keys(S).map(Number))E.push(f[P]);E.sort(la);for(let P of E){let M=P.featureIndex.lookupSymbolFeatures(S[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,o,_);for(let F in M){let O=x[F]=x[F]||[],N=M[F];N.sort(((q,G)=>{let K=P.featureSortOrder;if(K){let $=K.indexOf(q.featureIndex);return K.indexOf(G.featureIndex)-$}return G.featureIndex-q.featureIndex}));for(let q of N)O.push(q)}}return x}function aa(l,t){let o=l.getRenderableIds().map((_=>l.getTileByID(_))),c=[],f={};for(let _=0;_<o.length;_++){let x=o[_],S=x.tileID.canonical.key;f[S]||(f[S]=!0,x.querySourceFeatures(c,t))}return c}function la(l,t){let o=l.tileID,c=t.tileID;return o.overscaledZ-c.overscaledZ||o.canonical.y-c.canonical.y||o.wrap-c.wrap||o.canonical.x-c.canonical.x}function Ya(l,t){let o={};if(!t)return o;for(let c of l){let f=c.layerIds.map((_=>t.getLayer(_))).filter(Boolean);if(f.length!==0){c.layers=f,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map((_=>f.filter((x=>x.id===_))[0])));for(let _ of f)o[_.fqid]=c}}return o}let Hn=32,Go=33,Kn=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,o=0,c=0,f=0,_=0,x=0,S=0;for(1&t?f=_=x=Hn:o=c=S=Hn;(t>>=1)>1;){let P=o+f>>1,M=c+_>>1;1&t?(f=o,_=c,o=x,c=S):(o=f,c=_,f=x,_=S),x=P,S=M}let E=4*l;Kn[E+0]=o,Kn[E+1]=c,Kn[E+2]=f,Kn[E+3]=_}let vo=new Uint16Array(2178),ys=new Uint8Array(1089),ca=new Uint16Array(1089);function Ka(l){return l===0?-.03125:l===32?.03125:0}let hc={type:2,extent:n.al,loadGeometry:()=>[[new n.P(0,0),new n.P(n.al+1,0),new n.P(n.al+1,n.al+1),new n.P(0,n.al+1),new n.P(0,0)]]};class rs{constructor(t,o,c,f,_,x){this.tileID=t,this.uid=n.b1(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(t){let o=t+this.timeAdded;o<n.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ya(t.buckets,o.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let _=this.buckets[f];if(_ instanceof n.b3){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let _=this.buckets[f];if(_ instanceof n.b3&&_.hasRTLText){this.hasRTLText=!0,n.b4();break}}this.queryPadding=0;for(let f in this.buckets){let _=this.buckets[f],x=o.style.getOwnLayer(f);if(!x)continue;let S=x.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b2}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Ya(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,o){for(let _ in this.buckets){let x=this.buckets[_];if(x.uploadPending()){let S={},E=[],P={zoom:0,pitch:0,brightness:0,worldview:""};if(o){if(o.style){E=o.style.listImages();let M=x.layers[0],F=M.sourceLayer||"_geojsonTileLayer",O=o.style.getLayerSourceCache(M);O&&(S=O._state.getState(F,void 0))}P={zoom:o.transform.zoom||0,pitch:o.transform.pitch||0,brightness:o.style.getBrightness()||0,worldview:o.worldview||""}}x.upload(t,this.tileID.canonical,S,E,P)}}let c=t.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new n.T(t,f.image,c.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let f=o.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(o)),(this._lastUpdatedBrightness||f||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==f),this._lastUpdatedBrightness=f))}evaluateQueryRenderedFeaturePadding(){let t=0;for(let o in this.buckets){let c=this.buckets[o];c.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,c.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,o,c,f,_,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let S=this.evaluateQueryRenderedFeaturePadding(),E=(function(P,M){let F=n.bp([],[.5*P.width,.5*-P.height,1]);return n.bq(F,F,[1,-1,0]),n.aB(F,F,P.calculateProjMatrix(M.toUnwrapped())),Float32Array.from(F)})(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:E,transform:f,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:S})}querySourceFeatures(t,o){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let f=c.loadVTLayers(),_=o?o.sourceLayer:"",x=f._geojsonTileLayer||f[_];if(!x)return;let S=n.b5(o&&o.filter),{z:E,x:P,y:M}=this.tileID.canonical,F={z:E,x:P,y:M};for(let O=0;O<x.length;O++){let N=x.feature(O);if(S.needGeometry){let K=n.b6(N,!0);if(!S.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),K,this.tileID.canonical))continue}else if(!S.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),N))continue;let q=c.getId(N,_),G=new n.b7(N,E,P,M,q);G.tile=F,t.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){let o=this.expirationTime;if(t.cacheControl){let c=n.b8(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let c=Date.now(),f=!1;if(this.expirationTime>c)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{let _=this.expirationTime-o;_?this.expirationTime=c+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(let o in this.buckets)if(t.style.hasLayer(o)&&this.buckets[o].layers.some((c=>c.appearances&&c.appearances.length>0)))return!0;return!1}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;let c=this.latestFeatureIndex.loadVTLayers(),f=t.style.listImages(),_=t.style.getBrightness();for(let x in this.buckets){if(!t.style.hasLayer(x))continue;let S=this.buckets[x],E=S.layers[0],P=E.sourceLayer||"_geojsonTileLayer",M=c[P],F=t.style.getLayerSourceCache(E),O={};F&&(O=F._state.getState(P,void 0));let N=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},q=Object.keys(O).length>0&&!o;if(S.hasAppearances=S.layers.some((K=>K.appearances&&K.appearances.length>0)),(q&&S.stateDependentLayers.length!==0||o)&&S.update(O,M,f,N,q?S.stateDependentLayers:S.layers,o,_),q&&S.stateDependentLayers.length!==0||o||S.hasAppearances){let K={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};S.updateAppearances(this.tileID.canonical,O,f,K)}(S instanceof n.b9||S instanceof n.ba)&&t._terrain&&t._terrain.enabled&&F&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);let G=t&&t.style&&t.style.getOwnLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.o.now()+t}setTexture(t,o){let c=o.context,f=c.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(c,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,o){let c={};for(let f of o)c[f]=!0;this.dependencies[t]=c}hasDependency(t,o){for(let c of t){let f=this.dependencies[c];if(f){for(let _ of o)if(f[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;let c=n.bb(hc,this.tileID.canonical,this.tileTransform)[0],f=new n.bc,_=new n.bd;for(let x=0;x<c.length;x++){let{x:S,y:E}=c[x];f.emplaceBack(S,E),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(f,n.be.members),this._tileDebugSegments=n.bf.simpleSegment(0,0,f.length,_.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;let c=n.bb(hc,this.tileID.canonical,this.tileTransform)[0],f,_;if(this.isRaster){let x=(function(S,E){let P=n.aY(S,E),M=Math.pow(2,S.z);for(let K=0;K<Go;K++)for(let $=0;$<Go;$++){let ee=n.aZ((S.x+($+Ka($))/Hn)/M),se=n.a_((S.y+(K+Ka(K))/Hn)/M),ie=E.project(ee,se),ge=K*Go+$;vo[2*ge+0]=Math.round((ie.x*P.scale-P.x)*n.al),vo[2*ge+1]=Math.round((ie.y*P.scale-P.y)*n.al)}ys.fill(0),ca.fill(0);for(let K=2045;K>=0;K--){let $=4*K,ee=Kn[$+0],se=Kn[$+1],ie=Kn[$+2],ge=Kn[$+3],ae=ee+ie>>1,ye=se+ge>>1,pe=ae+ye-se,ue=ye+ee-ae,ve=se*Go+ee,ze=ge*Go+ie,Ie=ye*Go+ae,Ge=Math.hypot((vo[2*ve+0]+vo[2*ze+0])/2-vo[2*Ie+0],(vo[2*ve+1]+vo[2*ze+1])/2-vo[2*Ie+1])>=16;ys[Ie]=ys[Ie]||(Ge?1:0),K<1022&&(ys[Ie]=ys[Ie]||ys[(se+ue>>1)*Go+(ee+pe>>1)]||ys[(ge+ue>>1)*Go+(ie+pe>>1)])}let F=new n.a$,O=new n.b0,N=0;function q(K,$){let ee=$*Go+K;return ca[ee]===0&&(F.emplaceBack(vo[2*ee+0],vo[2*ee+1],K*n.al/Hn,$*n.al/Hn),ca[ee]=++N),ca[ee]-1}function G(K,$,ee,se,ie,ge){let ae=K+ee>>1,ye=$+se>>1;if(Math.abs(K-ie)+Math.abs($-ge)>1&&ys[ye*Go+ae])G(ie,ge,K,$,ae,ye),G(ee,se,ie,ge,ae,ye);else{let pe=q(K,$),ue=q(ee,se),ve=q(ie,ge);O.emplaceBack(pe,ue,ve)}}return G(0,0,Hn,Hn,Hn,0),G(Hn,Hn,0,0,0,Hn),{vertices:F,indices:O}})(this.tileID.canonical,o);f=x.vertices,_=x.indices}else{f=new n.a$,_=new n.b0;for(let{x:S,y:E}of c)f.emplaceBack(S,E,0,0);let x=n.bg(f.int16.subarray(0,4*f.length),void 0,4);for(let S=0;S<x.length;S+=3)_.emplaceBack(x[S],x[S+1],x[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,n.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=n.bf.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugBuffers(t,o){let c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;let f=this.tileID.canonical,_=n.bi(f,o),x=n.bj(_),S=n.aj(o.zoom),E;S>0&&(E=n.bk(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,o,x,E,S),this._makeGlobeTileDebugTextBuffer(t,f,o,x,E,S)}_globePoint(t,o,c,f,_,x,S){let E=n.bl(t,o,c);if(x){let P=1<<c.z,M=n.aF(f.center.lng),F=n.aJ(f.center.lat),O=(c.x+.5)/P-M,N=0;O>.5?N=-1:O<-.5&&(N=1);let q=(t/n.al+c.x)/P+N,G=(o/n.al+c.y)/P;q=(q-M)*f._pixelsPerMercatorPixel+M,G=(G-F)*f._pixelsPerMercatorPixel+F;let K=[q*f.worldSize,G*f.worldSize,0];n.af(K,K,x),E=n.bm(E,K,S)}return n.af(E,E,_)}_makeGlobeTileDebugBorderBuffer(t,o,c,f,_,x){let S=new n.bc,E=new n.bd,P=new n.bn,M=(O,N,q,G,K)=>{let $=(q-O)/(K-1),ee=(G-N)/(K-1),se=S.length;for(let ie=0;ie<K;ie++){let ge=O+ie*$,ae=N+ie*ee;S.emplaceBack(ge,ae);let ye=this._globePoint(ge,ae,o,c,f,_,x);P.emplaceBack(ye[0],ye[1],ye[2]),E.emplaceBack(se+ie)}},F=n.al;M(0,0,F,0,16),M(F,0,F,F,16),M(F,F,0,F,16),M(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(S,n.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,n.bo.members),this._tileDebugSegments=n.bf.simpleSegment(0,0,S.length,E.length)}_makeGlobeTileDebugTextBuffer(t,o,c,f,_,x){let S=n.al/4,E=new n.bc,P=new n.b0,M=new n.bn,F=25;P.reserve(32),E.reserve(F),M.reserve(F);let O=(N,q)=>F*N+q;for(let N=0;N<F;N++){let q=N*S;for(let G=0;G<F;G++){let K=G*S;E.emplaceBack(K,q);let $=this._globePoint(K,q,o,c,f,_,x);M.emplaceBack($[0],$[1],$[2])}}for(let N=0;N<4;N++)for(let q=0;q<4;q++){let G=O(N,q),K=O(N,q+1),$=O(N+1,q),ee=O(N+1,q+1);P.emplaceBack(G,K,$),P.emplaceBack($,K,ee)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(E,n.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,n.bo.members),this._tileDebugTextSegments=n.bf.simpleSegment(0,0,F,32)}destroy(t=!1){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.br.setPbf(n.bs);class za extends rs{constructor(t,o,c,f,_){super(t,o,c,f,_),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,c){let f=c.context,_=f.gl,x=this.texturePerLayer.get(t)||c.getTileTexture(o.width);x&&x instanceof n.T?x.update(o,{premultiply:!1}):x=new n.T(f,o,_.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,x)}flushQueues(t){let o=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(let t of this._workQueuePerLayer.keys()){let o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(let t of this._fetchQueuePerLayer.keys()){let o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){let c=this._mrt=new n.br(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bt(f,((_,x,S)=>{if(_)o(_);else try{let E=c.getHeaderLength(x);if(E>t)return void(this.request=this.fetchHeader(E,o));c.parseHeader(x),this._isHeaderLoaded=!0;let P=0;for(let M of Object.values(c.layers))P=Math.max(P,M.dataIndex[M.dataIndex.length-1].lastByte);x.byteLength>=P&&(this.entireBuffer=x),o(null,this.entireBuffer||x,S)}catch(E){o(E)}})),this.request}fetchBandForRender(t,o,c,f){this.fetchBand(t,o,c,(_=>{if(_)return void f(_);this.updateTextureDescriptor(t,o,c);let x=this.textureDescriptorPerLayer.get(o);f(null,x?x.img:null)}))}fetchBand(t,o,c,f,_=!0){let x=this._mrt;if(!this._isHeaderLoaded||!x)return void f(new Error("Tile header is not ready"));let S=this.actor;if(!S)return void f(new Error("Can't fetch tile band without an actor"));let E,P=n.B(String(c),n.B(this.tileID.key,t)),M=this._taskQueue.get(P);M?M.add(f):(M=new Set,M.add(f),this._taskQueue.set(P,M));let F=(G,K)=>{E.complete(G,K),G?f(G):(M.values().forEach(($=>$(null,K))),this._taskQueue.delete(P))},O=(G,K)=>{if(G)return f(G);let $=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:K,task:E},F,void 0,!0);if(o!==null){let ee=this._workQueuePerLayer.get(o)||[];ee.push((()=>{$&&$.cancel(),E.cancel()})),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,ee)}},N;try{N=x.getLayer(t)}catch(G){if(this.state==="reloading")return;throw G}if(!N)return void f(new Error(`Unknown sourceLayer "${t}"`));if(N.hasDataForBand(c))return M.values().forEach((G=>G(null,null))),void this._taskQueue.delete(P);let q=N.getDataRange([c]);if(E=x.createDecodingTask(q),!E||E.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)O(null,this.entireBuffer.slice(q.firstByte,q.lastByte+1));else{let G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${q.firstByte}-${q.lastByte}`}}),K=n.bt(G,O);if(o!==null){let $=this._fetchQueuePerLayer.get(o)||[];$.push((()=>{K.cancel(),E.cancel()})),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,$)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,c){if(!this._mrt)return;let f=this._mrt.getLayer(t);if(!f||!f.hasBand(c)||!f.hasDataForBand(c))return;let{bytes:_,tileSize:x,buffer:S,offset:E,scale:P}=f.getBandView(c),M=x+2*S,F=new n.q({width:M,height:M},_),O=this.texturePerLayer.get(o);O&&O instanceof n.T&&O.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:c,img:F,buffer:S,offset:E,tileSize:x,format:f.pixelFormat,mix:[P,256*P,65536*P,16777216*P]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(let o of this.texturePerLayer.values())o&&o instanceof n.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class pr{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(let t in this.data)for(let o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,c){let f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let _={value:o,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout((()=>{this.remove(t,_)}),c)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){let o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;let c=t.wrapped().key,f=o===void 0?0:this.data[c].indexOf(o),_=this.data[c][f];return this.data[c].splice(f,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){let o=[];for(let c in this.data)for(let f of this.data[c])t(f.value)||o.push(f);for(let c of o)this.remove(c.value.tileID,c)}}class vs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,c){let f=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},Object.assign(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(let _ in this.state[t])_!==f&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(let _ in this.state[t][f])c[_]||(this.deletedStates[t][f][_]=null)}else for(let _ in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][_]===null&&delete this.deletedStates[t][f][_]}removeFeatureState(t,o,c){if(this.deletedStates[t]===null)return;let f=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&o!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,o){let c=this.state[t]||{},f=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(o!==void 0){let S=String(o),E=Object.assign({},c[S],f[S]);if(_){let P=_[o];if(P===null)return{};for(let M in P)delete E[M]}return E}let x=Object.assign({},c,f);if(_)for(let S in _)delete x[S];return x}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){let c={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let _={};for(let x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),Object.assign(this.state[f][x],this.stateChanges[f][x]),_[x]=this.state[f][x];c[f]=_}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let _={};if(this.deletedStates[f]===null)for(let x in this.state[f])_[x]={},this.state[f][x]={};else for(let x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else if(this.state[f][x])for(let S of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][S];_[x]=this.state[f][x]}c[f]=c[f]||{},Object.assign(c[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let f in t)t[f].refreshFeatureState(o)}}class Lr extends n.E{constructor(t,o,c){super(),this.id=t,this._onlySymbols=c,o.on("data",(f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),o.on("error",(()=>{this._sourceErrored=!0})),this._source=o,this._tiles={},this._cache=new pr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new vs,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let c=this._tiles[o];c.upload(t,this.map?this.map.painter:void 0),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Yc).map((t=>t.key))}getRenderableIds(t,o){let c=[];for(let f in this._tiles)this._isIdRenderable(+f,t,o)&&c.push(this._tiles[f]);return t?c.sort(((f,_)=>{let x=f.tileID,S=_.tileID,E=new n.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new n.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-S.overscaledZ||P.y-E.y||P.x-E.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(Yc).map((f=>f.key))}hasRenderableParent(t){let o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){let c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,t,o)))}_tileLoaded(t,o,c,f,_){if(f){if(t.state="errored",f.status!==404)this._source.fire(new n.y(f,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=n.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let x=new Map;_&&_.responseHeaders&&(x=_.responseHeaders),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(t){let o=this.getRenderableIds();for(let f=0;f<o.length;f++){let _=o[f];if(t.neighboringTiles&&t.neighboringTiles[_]){let x=this.getTileByID(_);c(t,x),c(x,t)}}function c(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-f.tileID.canonical.x,S=_.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),P=_.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,x,S),f.neighboringTiles&&f.neighboringTiles[P]&&(f.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,c,f){for(let _ in this._tiles){let x=this._tiles[_];if(f[_]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>c)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){let P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(S=P)}let E=S;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){f[S.key]=S;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){let c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=t.overscaledZ-1;c>=o;c--){let f=t.scaledTo(c),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(t){let o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;let c=Math.ceil(t.width/o)+1,f=Math.ceil(t.height/o)+1,_=Math.floor(c*f*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(t){let o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){let c={};for(let f in this._tiles){let _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),c[_.tileID.key]=_}this._tiles=c;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,o,c,f,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let x=this._source.type==="batched-model",S,E=this._source.maxzoom,P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){let O=P.attenuationRange()[0],N=Math.floor(O)-Math.log2(P.getDemUpscale());E>N&&(E=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((O=>new n.aP(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)));else if(this.tileCoverLift!==0){let O=t.clone();O.tileCoverLift=this.tileCoverLift,S=O.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new n.aP(1,0,1,0,0)),S.push(new n.aP(1,0,1,1,0)),S.push(new n.aP(1,0,1,0,1)),S.push(new n.aP(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){let O=this._source.hasTile.bind(this._source);S=S.filter((N=>O(N)))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ua(this._source.type)){let O=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),N=Math.min(O,this._source.maxzoom);if(x){let q=t.extendTileCover(S,N);for(let G of q)S.push(G)}else if(_){let q=t.extendTileCoverToNearPlane(S,this.transform.getFrustum(N),N);for(let G of q)S.push(G)}else if(this.castsShadows&&f){let q=t.extendTileCover(S,N,f);for(let G of q)this._shadowCasterTiles[G.key]=!0,S.push(G)}}let M=this._updateRetainedTiles(S);if(ua(this._source.type)&&S.length!==0){let O={},N={},q=Object.keys(M);for(let K of q){let $=M[K],ee=this._tiles[K];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=n.o.now())continue;let se=this.findLoadedParent($,Math.max($.overscaledZ-Lr.maxOverzooming,this._source.minzoom));se&&(this._addTile(se.tileID),O[se.tileID.key]=se.tileID),N[K]=$}let G=S[S.length-1].overscaledZ;for(let K in this._tiles){let $=this._tiles[K];if(M[K]||!$.hasData())continue;let ee=$.tileID;for(;ee.overscaledZ>G;){ee=ee.scaledTo(ee.overscaledZ-1);let se=this._tiles[ee.key];if(se&&se.hasData()&&N[ee.key]){M[K]=$.tileID;break}}}for(let K in O)M[K]||(this._coveredTiles[K]=!0,M[K]=O[K])}for(let O in M)this._tiles[O].clearFadeHold();let F=n.bu(this._tiles,M);for(let O of F){let N=this._tiles[O];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let o={};if(t.length===0)return o;let c={},f=t.reduce(((P,M)=>Math.min(P,M.overscaledZ)),1/0),_=t[0].overscaledZ,x=Math.max(_-Lr.maxOverzooming,this._source.minzoom),S=Math.max(_+Lr.maxUnderzooming,this._source.minzoom),E={};for(let P of t){let M=this._addTile(P);o[P.key]=P,M.hasData()||f<this._source.maxzoom&&(E[P.key]=P)}this._retainLoadedChildren(E,f,S,o);for(let P of t){let M=this._tiles[P.key];if(M.hasData())continue;if(P.canonical.z>=this._source.maxzoom){let O=P.children(this._source.maxzoom)[0],N=this.getTile(O);if(N&&N.hasData()){o[O.key]=O;continue}}else{let O=P.children(this._source.maxzoom);if(o[O[0].key]&&o[O[1].key]&&o[O[2].key]&&o[O[3].key])continue}let F=M.wasRequested();for(let O=P.overscaledZ-1;O>=x;--O){let N=P.scaledTo(O);if(c[N.key]||(c[N.key]=!0,M=this.getTile(N),!M&&F&&(M=this._addTile(N)),M&&(o[N.key]=N,F=M.wasRequested(),M.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let o=[],c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}o.push(f.key);let _=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;f=_}for(let _ of o)this._loadedParentTiles[_]=c}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));let c=!!o;if(!c){let f=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new za(t,_,this.transform.tileZoom,f,this._isRaster):new rs(t,_,this.transform.tileZoom,f,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,c||this._source.fire(new n.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let c=o.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_removeTile(t){let o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,c){let f=[],_=this.transform;if(!_)return f;let x=_.projection.name==="globe",S=n.aF(_.center.lng);for(let E in this._tiles){let P=this._tiles[E];if(c&&P.clearQueryDebugViz(),P.holdingForFade())continue;let M;if(x){let F=P.tileID.canonical;if(F.z===0){let O=[Math.abs(n.aA(S,...da(F,-1))-S),Math.abs(n.aA(S,...da(F,1))-S)];M=[0,2*O.indexOf(Math.min(...O))-1]}else{let O=[Math.abs(n.aA(S,...da(F,-1))-S),Math.abs(n.aA(S,...da(F,0))-S),Math.abs(n.aA(S,...da(F,1))-S)];M=[O.indexOf(Math.min(...O))-1]}}else M=[0];for(let F of M){let O=t.containsTile(P,_,o,F);O&&f.push(O)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){let c=this.getRenderableIds(t,o).map((_=>this._tiles[_].tileID)),f=this.transform.projection.name==="globe";for(let _ of c)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=f?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return c}sortCoordinatesByDistance(t){let o=t.slice(),c=this.transform._camera.position,f=this.transform._camera.forward(),_={};for(let x of o){let S=1/(1<<x.canonical.z);_[x.key]=((x.canonical.x+.5)*S+x.wrap-c[0])*f[0]+((x.canonical.y+.5)*S-c[1])*f[1]-c[2]*f[2]}return o.sort(((x,S)=>_[x.key]-_[S.key])),o}hasTransition(){if(this._source.hasTransition())return!0;if(ua(this._source.type))for(let t in this._tiles){let o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.o.now())return!0}return!1}setFeatureState(t,o,c){this._state.updateState(t=t||"_geojsonTileLayer",o,c)}removeFeatureState(t,o,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,c)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,c){let f=this._tiles[t];f&&f.setDependencies(o,c)}reloadTilesForDependencies(t,o){for(let c in this._tiles)this._tiles[c].hasDependency(t,o)&&this._reloadTile(+c,"reloading");this._cache.filter((c=>!c.hasDependency(t,o)))}_preloadTiles(t,o){if(!this._sourceLoaded){let E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(t,o))};return void this._source.on("data",E)}let c=new Map,f=Array.isArray(t)?t:[t],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(let E of f){let P=E.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let M of P)c.set(M.key,M);this.usedForTerrain&&E.updateElevation(!1)}let S=Array.from(c.values());n.bv(S,((E,P)=>{let M=new rs(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(M,(F=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),P(F,M)}))}),o)}}function Yc(l,t){let o=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-o||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function ua(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function da(l,t){let o=1<<l.z;return[l.x/o+t,(l.x+1)/o+t]}Lr.maxOverzooming=10,Lr.maxUnderzooming=3;class pc{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,o=!1;for(let c in this.style._mergedLayers){let f=this.style._mergedLayers[c];if(f.type==="fill-extrusion"||f.type==="building")this.layers.push({layer:f,visible:t,visibilityChanged:o});else if(f.type==="model"){let _=this.style.getLayerSource(f);_&&_.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(let o of this.layers){let c=o.layer,f=!1;c.type==="fill-extrusion"?f=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?f=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(f=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!f&&o.visible,o.visible=f}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(let f of this.layers){let _=f.layer,x=this.style.getLayerSourceCache(_),S=1;_.type==="fill-extrusion"?S=f.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(S=f.visible?_.paint.get("building-vertical-scale"):0);let E=x?x.getTile(o):null;if(!E&&x)for(let P in x._tiles){let M=x._tiles[P];if(o.canonical.isChildOf(M.tileID.canonical)){E=M;break}}this.currentBuildingBuckets.push({bucket:E?E.getBucket(_):null,tileID:E?E.tileID:o,verticalScale:S})}t.hasAnyZOffset=!1;let c=!1;for(let f=0;f<t.symbolInstances.length;f++){let _=t.symbolInstances.get(f),x=_.zOffset,S=this._getHeightAtTileOffset(o,_.tileAnchorX,_.tileAnchorY);_.zOffset=S!==Number.NEGATIVE_INFINITY?S:x,c||x===_.zOffset||(c=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,c,f){let _=o,x=c;if(t.canonical.z!==f.canonical.z){let S=f.canonical,E=1/(1<<t.canonical.z-S.z);_=(o+t.canonical.x*n.al)*E-S.x*n.al|0,x=(c+t.canonical.y*n.al)*E-S.y*n.al|0}return{tileX:_,tileY:x}}_getHeightAtTileOffset(t,o,c){let f,_;for(let x=0;x<this.layers.length;++x){let S=this.layers[x].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;let{bucket:E,tileID:P,verticalScale:M}=this.currentBuildingBuckets[x];if(!E)continue;let{tileX:F,tileY:O}=this._mapCoordToOverlappingTile(t,o,c,P),N=E.getHeightAtTileCoord(F,O);N&&N.height!==void 0&&(N.hidden?f=N.height:_=Math.max(N.height*M,_||0))}if(_!==void 0)return _;for(let x=0;x<this.layers.length;++x){let S=this.layers[x];if(S.layer.type!=="model"||!S.visible)continue;let{bucket:E,tileID:P}=this.currentBuildingBuckets[x];if(!E)continue;let{tileX:M,tileY:F}=this._mapCoordToOverlappingTile(t,o,c,P),O=E.getHeightAtTileCoord(M,F);if(O&&!O.hidden)return O.height===void 0&&f!==void 0?Math.min(O.maxHeight,f)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xs(l,t){let o={};for(let c in l)c!=="ref"&&(o[c]=l[c]);return n.bw.forEach((c=>{c in t&&(o[c]=t[c])})),o}function Ma(l){l=l.slice();let t=Object.create(null);for(let o=0;o<l.length;o++)t[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=xs(l[o],t[l[o].ref]));return l}let Ni={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Zn(l,t,o){o.push({command:Ni.addSource,args:[l,t[l]]})}function bs(l,t,o){t.push({command:Ni.removeSource,args:[l]}),o[l]=!0}function Il(l,t,o,c){bs(l,o,c),Zn(l,t,o)}function Kc(l,t,o){let c;for(c in l[o])if(l[o].hasOwnProperty(c)&&c!=="data"&&!n.bx(l[o][c],t[o][c]))return!1;for(c in t[o])if(t[o].hasOwnProperty(c)&&c!=="data"&&!n.bx(l[o][c],t[o][c]))return!1;return!0}function fc(l,t,o,c,f,_){let x;for(x in t=t||{},l=l||{})l.hasOwnProperty(x)&&(n.bx(l[x],t[x])||o.push({command:_,args:[c,x,t[x],f]}));for(x in t)t.hasOwnProperty(x)&&!l.hasOwnProperty(x)&&(n.bx(l[x],t[x])||o.push({command:_,args:[c,x,t[x],f]}))}function Pl(l){return l.id}function Ja(l,t){return l[t.id]=t,l}function Qa(l,t,o){let c=t.createTileMatrix(l,l.worldSize,o.toUnwrapped());return n.aB(new Float32Array(16),l.projMatrix,c)}function $u(l,t,o){if(t.projection.name===o.projection.name)return l.projMatrix;let c=o.clone();return c.setProjection(t.projection),Qa(c,t.getProjection(),l)}function zr(l,t,o){return t.name===o.projection.name?l.projMatrix:Qa(o,t,l)}class Lp{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aA(t,0,1);let o=1,c=this._distances[o],f=t*this.paddedLength+this.padding;for(;c<f&&o<this._distances.length;)c=this._distances[++o];let _=o-1,x=this._distances[_],S=c-x,E=S>0?(f-x)/S:0;return this.points[_].mult(1-E).add(this.points[o].mult(E))}}class ko{constructor(t,o,c){let f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(o/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,c,f,_){this._forEachCell(o,c,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(t,o,c,f){this._forEachCell(o-f,c-f,o+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,o,c,f,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,o,c,f,_,x){this.circleCells[_].push(x)}_query(t,o,c,f,_,x){if(c<0||t>this.width||f<0||o>this.height)return!_&&[];let S=[];if(t<=0&&o<=0&&this.width<=c&&this.height<=f){if(_)return!0;for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){let P=this.circles[3*E],M=this.circles[3*E+1],F=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:P-F,y1:M-F,x2:P+F,y2:M+F})}return x?S.filter(x):S}return this._forEachCell(t,o,c,f,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?S.length>0:S}_queryCircle(t,o,c,f,_){let x=t-c,S=t+c,E=o-c,P=o+c;if(S<0||x>this.width||P<0||E>this.height)return!f&&[];let M=[];return this._forEachCell(x,E,S,P,this._queryCellCircle,M,{hitTest:f,circle:{x:t,y:o,radius:c},seenUids:{box:{},circle:{}}},_),f?M.length>0:M}query(t,o,c,f,_){return this._query(t,o,c,f,!1,_)}hitTest(t,o,c,f,_){return this._query(t,o,c,f,!0,_)}hitTestCircle(t,o,c,f){return this._queryCircle(t,o,c,!0,f)}_queryCell(t,o,c,f,_,x,S,E){let P=S.seenUids,M=this.boxCells[_];if(M!==null){let O=this.bboxes;for(let N of M)if(!P.box[N]){P.box[N]=!0;let q=4*N;if(t<=O[q+2]&&o<=O[q+3]&&c>=O[q+0]&&f>=O[q+1]&&(!E||E(this.boxKeys[N]))){if(S.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[N],x1:O[q],y1:O[q+1],x2:O[q+2],y2:O[q+3]})}}}let F=this.circleCells[_];if(F!==null){let O=this.circles;for(let N of F)if(!P.circle[N]){P.circle[N]=!0;let q=3*N;if(this._circleAndRectCollide(O[q],O[q+1],O[q+2],t,o,c,f)&&(!E||E(this.circleKeys[N]))){if(S.hitTest)return x.push(!0),!0;{let G=O[q],K=O[q+1],$=O[q+2];x.push({key:this.circleKeys[N],x1:G-$,y1:K-$,x2:G+$,y2:K+$})}}}}}_queryCellCircle(t,o,c,f,_,x,S,E){let P=S.circle,M=S.seenUids,F=this.boxCells[_];if(F!==null){let N=this.bboxes;for(let q of F)if(!M.box[q]){M.box[q]=!0;let G=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,N[G+0],N[G+1],N[G+2],N[G+3])&&(!E||E(this.boxKeys[q])))return x.push(!0),!0}}let O=this.circleCells[_];if(O!==null){let N=this.circles;for(let q of O)if(!M.circle[q]){M.circle[q]=!0;let G=3*q;if(this._circlesCollide(N[G],N[G+1],N[G+2],P.x,P.y,P.radius)&&(!E||E(this.circleKeys[q])))return x.push(!0),!0}}}_forEachCell(t,o,c,f,_,x,S,E){let P=this._convertToXCellCoord(t),M=this._convertToYCellCoord(o),F=this._convertToXCellCoord(c),O=this._convertToYCellCoord(f);for(let N=P;N<=F;N++)for(let q=M;q<=O;q++)if(_.call(this,t,o,c,f,this.xCellCount*q+N,x,S,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,c,f,_,x){let S=f-t,E=_-o,P=c+x;return P*P>S*S+E*E}_circleAndRectCollide(t,o,c,f,_,x,S){let E=(x-f)/2,P=Math.abs(t-(f+E));if(P>E+c)return!1;let M=(S-_)/2,F=Math.abs(o-(_+M));if(F>M+c)return!1;if(P<=E||F<=M)return!0;let O=P-E,N=F-M;return O*O+N*N<=c*c}}let so={unknown:0,flipRequired:1,flipNotRequired:2},Ll=Math.tan(85*Math.PI/180);function zl(l,t,o,c,f,_,x){let S=n.bB();if(o)if(_.name==="globe"){let E=n.bC(f,t);n.aB(S,S,E)}else{let E=n.bD([],x);S[0]=E[0],S[1]=E[1],S[4]=E[2],S[5]=E[3],c||n.bA(S,S,f.angle)}else n.aB(S,f.labelPlaneMatrix,l);return S}function el(l,t,o,c,f,_,x){let S=zl(l,t,o,c,f,_,x);return _.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function ha(l,t,o,c,f,_,x){if(o){if(_.name==="globe"){let S=zl(l,t,o,c,f,_,x);return n.bk(S,S),n.aB(S,l,S),S}{let S=n.by(l),E=n.bz([]);return E[0]=x[0],E[1]=x[1],E[4]=x[2],E[5]=x[3],n.aB(S,S,E),c||n.bA(S,S,-f.angle),S}}return f.glCoordMatrix}function kn(l,t,o,c){let f=[l,t,o,1];o?n.aC(f,f,c):Oo(f,f,c);let _=f[3];return f[0]/=_,f[1]/=_,f[2]/=_,f}function Xu(l,t){return Math.min(.5+l/t*.5,1.5)}function Yu(l,t){let o=l[0]/l[3],c=l[1]/l[3];return o>=-t[0]&&o<=t[0]&&c>=-t[1]&&c<=t[1]}function mc(l,t,o,c,f,_,x,S,E,P,M=1){let F=o.transform,O=c?l.textSizeData:l.iconSizeData,N=n.bJ(O,o.transform.zoom,M),q=F.projection.name==="globe",G=[256/o.width*2+1,256/o.height*2+1],K=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;K.clear();let $=null;q&&($=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);let ee=l.lineVertexArray,se=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,ie=o.transform.width/o.transform.height,ge,ae=!1;for(let ye=0;ye<se.length;ye++){let pe=se.get(ye),{numGlyphs:ue,writingMode:ve}=pe;if(ve!==n.bK.vertical||ae||ge===n.bK.horizontal||(ae=!0),ge=ve,(pe.hidden||ve===n.bK.vertical)&&!ae){Ws(ue,K);continue}ae=!1;let ze=new n.P(pe.tileAnchorX,pe.tileAnchorY),Ie=l.elevationType==="road",Ge=!!F.elevation||Ie,{x:Be,y:Ye,z:gt}=F.projection.projectTilePoint(ze.x,ze.y,P.canonical),De=null;if(Ge){let zt=Ie?l.getElevationFeatureForText(ye):null;De={getElevation:E,elevation:F.elevation,elevationFeature:zt};let[Yt,zi,Ui]=E(ze,F.elevation,zt);Be+=Yt,Ye+=zi,gt+=Ui}let Ee=[Be,Ye,gt,1];if(n.aC(Ee,Ee,t),!Yu(Ee,G)){Ws(ue,K);continue}let Ke=Ee[3],Ne=Xu(o.transform.getCameraToCenterDistance(F.projection),Ke),nt=n.bL(O,N,pe),xt=x?nt/Ne:nt*Ne,Dt=kn(Be,Ye,gt,f);if(Dt[3]<=0){Ws(ue,K);continue}let ft={},vt=n.an(l.layers[0].layout.get("text-max-angle")),Ft=Math.cos(vt),Lt=x?null:De,It=Fd(pe,xt,!1,S,t,f,_,l.glyphOffsetArray,ee,K,$,Dt,ze,ft,ie,Lt,F.projection,P,x,Ft);ae=It.useVertical,Lt&&It.needsFlipping&&(ft={}),(It.notEnoughRoom||ae||It.needsFlipping&&Fd(pe,xt,!0,S,t,f,_,l.glyphOffsetArray,ee,K,$,Dt,ze,ft,ie,Lt,F.projection,P,x,Ft).notEnoughRoom)&&Ws(ue,K)}c?(l.text.dynamicLayoutVertexBuffer.updateData(K),$&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData($)):(l.icon.dynamicLayoutVertexBuffer.updateData(K),$&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData($))}function cr(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K){let{lineStartIndex:$,glyphStartIndex:ee,segment:se}=S,ie=ee+S.numGlyphs,ge=$+S.lineLength,ae=t.getoffsetX(ee),ye=t.getoffsetX(ie-1),pe=Ml(l*ae,o,c,f,_,x,se,$,ge,E,P,M,F,O,!0,N,q,G,K);if(!pe)return null;let ue=Ml(l*ye,o,c,f,_,x,se,$,ge,E,P,M,F,O,!0,N,q,G,K);return ue?{first:pe,last:ue}:null}function ns(l,t,o,c){return l===n.bK.horizontal&&Math.abs(c)>Math.abs(o)?{useVertical:!0}:l===n.bK.vertical?c>0?{needsFlipping:!0}:null:t!==so.unknown&&(function(f,_){return f===0||Math.abs(_/f)>Ll})(o,c)?t===so.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Fd(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee,se){let ie=t/24,ge=l.lineOffsetX*ie,ae=l.lineOffsetY*ie,{lineStartIndex:ye,glyphStartIndex:pe,numGlyphs:ue,segment:ve,writingMode:ze,flipState:Ie}=l,Ge=ye+l.lineLength,Be=Ye=>{if(M){let[Ke,Ne,nt]=Ye.up,xt=P.length;n.bM(M,xt+0,Ke,Ne,nt),n.bM(M,xt+1,Ke,Ne,nt),n.bM(M,xt+2,Ke,Ne,nt),n.bM(M,xt+3,Ke,Ne,nt)}let[gt,De,Ee]=Ye.point;n.bN(P,gt,De,Ee,Ye.angle)};if(ue>1){let Ye=cr(ie,S,ge,ae,o,F,O,l,E,_,N,G,!1,K,$,ee,se);if(!Ye)return{notEnoughRoom:!0};if(c&&!o){let[gt,De,Ee]=Ye.first.point,[Ke,Ne,nt]=Ye.last.point;[gt,De]=kn(gt,De,Ee,x),[Ke,Ne]=kn(Ke,Ne,nt,x);let xt=ns(ze,Ie,(Ke-gt)*q,Ne-De);if(l.flipState=xt&&xt.needsFlipping?so.flipRequired:so.flipNotRequired,xt)return xt}Be(Ye.first);for(let gt=pe+1;gt<pe+ue-1;gt++){let De=Ml(ie*S.getoffsetX(gt),ge,ae,o,F,O,ve,ye,Ge,E,_,N,G,!1,!1,K,$,ee,se);if(!De)return P.length-=4*(gt-pe),{notEnoughRoom:!0};Be(De)}Be(Ye.last)}else{if(c&&!o){let gt=kn(O.x,O.y,0,f),De=ye+ve+1,Ee=new n.P(E.getx(De),E.gety(De)),Ke=kn(Ee.x,Ee.y,0,f),Ne=Ke[3]>0?Ke:$t(O,Ee,gt,1,f,void 0,K,$.canonical),nt=ns(ze,Ie,(Ne[0]-gt[0])*q,Ne[1]-gt[1]);if(l.flipState=nt&&nt.needsFlipping?so.flipRequired:so.flipNotRequired,nt)return nt}let Ye=Ml(ie*S.getoffsetX(pe),ge,ae,o,F,O,ve,ye,Ge,E,_,N,G,!1,!1,K,$,ee,se);if(!Ye)return{notEnoughRoom:!0};Be(Ye)}return{}}function Ku(l,t,o,c,f){let{x:_,y:x,z:S}=c.projectTilePoint(l.x,l.y,t);if(!f)return kn(_,x,S,o);let[E,P,M]=f.getElevation(l,f.elevation,f.elevationFeature);return kn(_+E,x+P,S+M,o)}function $t(l,t,o,c,f,_,x,S){let E=Ku(l.sub(t)._unit()._add(l),S,f,x,_);return n.av(E,o,E),n.aw(E,E),n.bG(E,o,E,c)}function Ml(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee){let se=c?l-t:l+t,ie=se>0?1:-1,ge=0;c&&(ie*=-1,ge=Math.PI),ie<0&&(ge+=Math.PI);let ae=S+x+(ie>0?0:1)|0,ye=f,pe=f,ue=0,ve=0,ze=Math.abs(se),Ie=[],Ge=[],Be=_,Ye=Be,gt=n.bE([]),De=()=>$t(Ye,Be,pe,ze-ue+1,M,O,G,K.canonical);for(;ue+ve<=ze;){if(ae+=ie,ae<S||ae>=E)return null;if(pe=ye,Ye=Be,Ie.push(pe),N&&Ge.push(Ye),Be=new n.P(P.getx(ae),P.gety(ae)),ye=F[ae],!ye){let Lt=Ku(Be,K.canonical,M,G,O);ye=Lt[3]>0?F[ae]=Lt:De()}ue+=ve;let vt=n.av([],ye,pe),Ft=n.bF(pe,ye);if(o&&Ft>0&&ve>0&&n.bI(gt,vt)/(ve*Ft)<ee)return null;ve=Ft,gt=vt}q&&O&&(F[ae]&&(ye=De(),ve=n.bF(pe,ye),gt=n.av([],ye,pe)),F[ae]=ye);let Ee=(ze-ue)/ve,Ke=Be.sub(Ye)._mult(Ee)._add(Ye),Ne=n.bG([],pe,gt,Ee),nt=[0,0,1],xt=gt[0],Dt=gt[1];if($&&(nt=G.upVector(K.canonical,Ke.x,Ke.y),nt[0]!==0||nt[1]!==0||nt[2]!==1)){let vt=[nt[2],0,-nt[0]],Ft=n.bH([],nt,vt);n.aw(vt,vt),n.aw(Ft,Ft),xt=n.bI(gt,vt),Dt=n.bI(gt,Ft)}if(o){let vt=n.bH([],nt,gt);n.aw(vt,vt),n.bG(Ne,Ne,vt,o*ie)}let ft=ge+Math.atan2(Dt,xt);return Ie.push(Ne),N&&Ge.push(Ke),{point:Ne,angle:ft,path:Ie,tilePath:Ge,up:nt}}function Ws(l,t){let o=t.length,c=o+4*l;t.resize(c),t.float32.fill(-1/0,4*o,4*c)}function Oo(l,t,o){let c=t[0],f=t[1];return l[0]=o[0]*c+o[4]*f+o[12],l[1]=o[1]*c+o[5]*f+o[13],l[3]=o[3]*c+o[7]*f+o[15],l}let os=100;class tl{constructor(t,o,c=new ko(t.width+200,t.height+200,25),f=new ko(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+os,this.screenBottomBoundary=t.height+os,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,c,f,_,x,S,E,P,M,F){let O=c.projectedAnchorX,N=c.projectedAnchorY,q=c.projectedAnchorZ,G=c.tileAnchorX,K=c.tileAnchorY,$=c.elevation,ee=c.tileID,se=t.getProjection();if($&&ee){let[Ge,Be,Ye]=se.upVector(ee.canonical,c.tileAnchorX,c.tileAnchorY),gt=se.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=Ge*$*gt,N+=Be*$*gt,q+=Ye*$*gt}let ie=t.projection.name==="globe",ge=t.projection.name==="globe"?n.aj(this.transform.zoom):0;if(ee&&ie&&ge<1&&!x){let Ge=1<<ee.canonical.z,Be=n.bO(G,K);n.bP(Be,Be,1/n.al),n.bQ(Be,Be,n.bO(ee.canonical.x,ee.canonical.y)),n.bP(Be,Be,1/Ge),n.bR(Be,Be,n.bO(f[0],f[1])),Be[0]=n.bS(Be[0],-.5,.5),n.bP(Be,Be,n.al);let Ye=n.bT(Be[0],Be[1],n.al/(2*Math.PI),1);n.aC(Ye,Ye,_),O=n.ak(O,Ye[0],ge),N=n.ak(N,Ye[1],ge),q=n.ak(q,Ye[2],ge)}let ae=this.projectAndGetPerspectiveRatio(M,O,N,q,c.tileID,se.name==="globe"||!!$||this.transform.pitch>0,se),ye=P*ae.perspectiveRatio,pe=(c.x1*o+S.x-c.padding)*ye+ae.point.x,ue=(c.y1*o+S.y-c.padding)*ye+ae.point.y,ve=(c.x2*o+S.x+c.padding)*ye+ae.point.x,ze=(c.y2*o+S.y+c.padding)*ye+ae.point.y,Ie=ae.perspectiveRatio<=.55||ae.occluded;return!this.isInsideGrid(pe,ue,ve,ze)||!E&&this.grid.hitTest(pe,ue,ve,ze,F)||Ie?{box:[],offscreen:!1,occluded:ae.occluded}:{box:[pe,ue,ve,ze],offscreen:this.isOffscreen(pe,ue,ve,ze),occluded:!1}}placeCollisionCircles(t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K){let $=[],ee=this.transform.elevation,se=t.getProjection(),ie=t.elevationType==="road",ge=!!ee||ie,ae=n.bU.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,se),ye=new n.P(c.tileAnchorX,c.tileAnchorY),pe=new n.P(c.tileAnchorX,c.tileAnchorY),{x:ue,y:ve,z:ze}=se.projectTilePoint(pe.x,pe.y,K.canonical),Ie=null;if(ge){let Ft=ie?t.getElevationFeatureForText(f):null;Ie={getElevation:ae,elevation:ee,elevationFeature:Ft};let[Lt,It,zt]=ae(ye,ee,Ft);ue+=Lt,ve+=It,ze+=zt}let Ge=se.name==="globe",Be=this.projectAndGetPerspectiveRatio(E,ue,ve,ze,K,Ge||!!ee||this.transform.pitch>0,se),{perspectiveRatio:Ye}=Be,gt=(O?S/Ye:S*Ye)/n.bX,De=kn(ue,ve,ze,P),Ee=c.lineOffsetX*gt,Ke=c.lineOffsetY*gt,Ne=n.an(t.layers[0].layout.get("text-max-angle")),nt=Math.cos(Ne),xt=Be.signedDistanceFromCamera>0?cr(gt,x,Ee,Ke,ie&&c.flipState===1,De,pe,c,_,P,{},ge&&!O?Ie:null,O&&ge,se,K,O,nt):null,Dt=!1,ft=!1,vt=!0;if(xt&&!Be.occluded){let Ft=.5*q*Ye+G,Lt=new n.P(-100,-100),It=new n.P(this.screenRightBoundary,this.screenBottomBoundary),zt=new Lp,{first:Yt,last:zi}=xt,Ui=Yt.path.length,xr=[];for(let yi=Ui-1;yi>=1;yi--)xr.push(Yt.path[yi]);for(let yi=1;yi<zi.path.length;yi++)xr.push(zi.path[yi]);let si=2.5*Ft;M&&(xr=xr.map((([yi,gr,qi],Ir)=>(ge&&!Ge&&(qi=ae(Ir<Ui-1?Yt.tilePath[Ui-1-Ir]:zi.tilePath[Ir-Ui+2],ee,Ie.elevationFeature)[2]),kn(yi,gr,qi,M)))),xr.some((yi=>yi[3]<=0))&&(xr=[]));let ji=[];if(xr.length>0){let yi=1/0,gr=-1/0,qi=1/0,Ir=-1/0;for(let Ji of xr)yi=Math.min(yi,Ji[0]),qi=Math.min(qi,Ji[1]),gr=Math.max(gr,Ji[0]),Ir=Math.max(Ir,Ji[1]);gr>=Lt.x&&yi<=It.x&&Ir>=Lt.y&&qi<=It.y&&(ji=[xr.map((Ji=>new n.P(Ji[0],Ji[1])))],(yi<Lt.x||gr>It.x||qi<Lt.y||Ir>It.y)&&(ji=n.bV(ji,Lt.x,Lt.y,It.x,It.y)))}for(let yi of ji){zt.reset(yi,.25*Ft);let gr=0;gr=zt.length<=.5*Ft?1:Math.ceil(zt.paddedLength/si)+1;for(let qi=0;qi<gr;qi++){let Ir=qi/Math.max(gr-1,1),Ji=zt.lerp(Ir),xi=Ji.x+os,dr=Ji.y+os;$.push(xi,dr,Ft,0);let wi=xi-Ft,Fr=dr-Ft,hr=xi+Ft,ci=dr+Ft;if(vt=vt&&this.isOffscreen(wi,Fr,hr,ci),ft=ft||this.isInsideGrid(wi,Fr,hr,ci),!o&&this.grid.hitTestCircle(xi,dr,Ft,N)&&(Dt=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!F&&Dt||!ft?[]:$,offscreen:vt,collisionDetected:Dt,occluded:Be.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],c=1/0,f=1/0,_=-1/0,x=-1/0;for(let M of t){let F=new n.P(M.x+os,M.y+os);c=Math.min(c,F.x),f=Math.min(f,F.y),_=Math.max(_,F.x),x=Math.max(x,F.y),o.push(F)}let S=this.grid.query(c,f,_,x).concat(this.ignoredGrid.query(c,f,_,x)),E={},P={};for(let M of S){let F=M.key;if(E[F.bucketInstanceId]===void 0&&(E[F.bucketInstanceId]={}),E[F.bucketInstanceId][F.featureIndex])continue;let O=[new n.P(M.x1,M.y1),new n.P(M.x2,M.y1),new n.P(M.x2,M.y2),new n.P(M.x1,M.y2)];n.bW(o,O)&&(E[F.bucketInstanceId][F.featureIndex]=!0,P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]=[]),P[F.bucketInstanceId].push(F.featureIndex))}return P}insertCollisionBox(t,o,c,f,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,c,f,_){let x=o?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:f,collisionGroupID:_};for(let E=0;E<t.length;E+=4)x.insertCircle(S,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,o,c,f,_,x,S){let E=[o,c,f,1],P=!1;f||this.transform.pitch>0?(n.aC(E,E,t),this.fogState&&_&&S.name!=="globe"&&(P=(function(O,N,q,G,K,$){let ee=$.calculateFogTileMatrix(K),se=[N,q,G];return n.af(se,se,ee),dt(O,n.ag(se),$.pitch,$._fov)})(this.fogState,o,c,f,_.toUnwrapped(),this.transform)>.9)):Oo(E,E,t);let M=E[3];return{point:new n.P((E[0]/M+1)/2*this.transform.width+os,(-E[1]/M+1)/2*this.transform.height+os),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/M*.5,1.5),signedDistanceFromCamera:M,occluded:x&&E[2]>M||P}}isOffscreen(t,o,c,f){return c<os||t>=this.screenRightBoundary||f<os||o>this.screenBottomBoundary}isInsideGrid(t,o,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let t=n.bz([]);return n.bq(t,t,[-100,-100,0]),t}}class Gt{constructor(t,o,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Zi{constructor(t,o,c,f,_,x=!1){this.text=new Gt(t?t.text:null,o,c,_),this.icon=new Gt(t?t.icon:null,o,f,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ir{constructor(t,o,c,f=!1){this.text=t,this.icon=o,this.skipFade=c,this.clipped=f}}class xo{constructor(){this.invProjMatrix=n.bB(),this.viewportMatrix=n.bB(),this.circles=[]}}class Ol{constructor(t,o,c,f,_){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=_}}class ur{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:c=>c.collisionGroupID===o}}return this.collisionGroups[t]}}function Rl(l,t,o,c,f){let{horizontalAlign:_,verticalAlign:x}=n.c0(l),S=-(_-.5)*t,E=-(x-.5)*o,P=n.c1(l,c);return new n.P(S+P[0]*f,E+P[1]*f)}function Gs(l,t,o,c,f){let _=new n.P(l,t);return o&&_._rotate(c?f:-f),_}class ws{constructor(t,o,c,f,_,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new tl(this.transform,_),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ur(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,c,f,_=1){let x=c.getBucket(o),S=c.latestFeatureIndex;if(!x||!S||o.fqid!==x.layerIds[0])return;let E=x.layers[0].layout,P=x.layers[0].paint,M=c.collisionBoxArray,F=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),O=c.tileSize/n.al,N=c.tileID.toUnwrapped();this.transform.setProjection(x.projection);let q=(G=c.tileID,K=x.getProjection(),$=this.transform,K.name===this.projection?$.calculateProjMatrix(G.toUnwrapped()):Qa($,K,G));var G,K,$;let ee=E.get("text-pitch-alignment")==="map",se=E.get("text-rotation-alignment")==="map";o.compileFilter(o.options);let ie=o.dynamicFilter(),ge=o.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(c),ye=el(q,c.tileID.canonical,ee,se,this.transform,x.getProjection(),ae),pe=null,ue=x.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(ee){let Ee=ha(q,c.tileID.canonical,ee,se,this.transform,x.getProjection(),ae);pe=n.aB([],this.transform.labelPlaneMatrix,Ee)}let ve=null;ie&&c.latestFeatureIndex&&(ve={unwrappedTileID:N,dynamicFilter:ie,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new Ol(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,c.tileID);let[ze,Ie]=x.layers[0].layout.get("text-size-scale-range"),Ge=n.aA(_,ze,Ie),[Be,Ye]=E.get("icon-size-scale-range"),gt=n.aA(_,Be,Ye),De={bucket:x,layout:E,paint:P,posMatrix:q,invMatrix:ue,mercatorCenter:[n.aF(this.transform.center.lng),n.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ye,labelToScreenMatrix:pe,clippingData:ve,scale:F,textPixelRatio:O,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:n.bJ(x.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:n.bJ(x.iconSizeData,this.transform.zoom,gt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(f)for(let Ee of x.sortKeyRanges){let{sortKey:Ke,symbolInstanceStart:Ne,symbolInstanceEnd:nt}=Ee;t.push({sortKey:Ke,symbolInstanceStart:Ne,symbolInstanceEnd:nt,parameters:De})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:De})}attemptAnchorPlacement(t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee,se,ie,ge){let{textOffset0:ae,textOffset1:ye,crossTileID:pe}=G,ue=[ae,ye],ve=Rl(t,x,S,ue,E),ze=this.collisionIndex.placeCollisionBox($,E,o,c,f,_,Gs(ve.x,ve.y,P,M,this.transform.angle),q,F,O,N.predicate);if(se){let Ie=$.getSymbolInstanceIconSize(ge,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,Ie,se,c,f,_,Gs(ve.x,ve.y,P,M,this.transform.angle),q,F,O,N.predicate).box.length===0)return}if(ze.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(Ie=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:ue,width:x,height:S,anchor:t,textScale:E,prevAnchor:Ie},this.markUsedJustification($,t,G,ee),$.allowVerticalPlacement&&(this.markUsedOrientation($,ee,G),this.placedOrientations[pe]=ee),{shift:ve,placedGlyphBoxes:ze}}}placeLayerBucketPart(t,o,c,f,_=1){let{bucket:x,layout:S,paint:E,posMatrix:P,textLabelPlaneMatrix:M,labelToScreenMatrix:F,clippingData:O,textPixelRatio:N,mercatorCenter:q,invMatrix:G,holdingForFade:K,collisionBoxArray:$,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:se,collisionGroup:ie,latestFeatureIndex:ge}=t.parameters,ae=S.get("text-optional"),ye=S.get("icon-optional"),pe=S.get("text-allow-overlap"),ue=S.get("icon-allow-overlap"),ve=S.get("text-rotation-alignment")==="map",ze=S.get("icon-rotation-alignment")==="map",Ie=S.get("text-pitch-alignment")==="map",Ge=E.get("symbol-z-offset"),Be=S.get("symbol-elevation-reference")==="sea",Ye=S.get("symbol-placement"),[gt,De]=S.get("text-size-scale-range"),[Ee,Ke]=S.get("icon-size-scale-range"),Ne=n.aA(_,gt,De),nt=n.aA(_,Ee,Ke),xt=S.get("text-variable-anchor"),Dt=ve&&Ye!=="point",ft=ze&&Ye!=="point",vt=xt&&x.hasTextData(),Ft=x.hasIconTextFit()&&vt&&x.hasIconData();this.transform.setProjection(x.projection);let Lt=vt||Dt,It=ft||Ft,zt=pe&&(ue||!x.hasIconData()||ye),Yt=ue&&(pe||!x.hasTextData()||ae),zi=!Ge.isConstant();!x.collisionArrays&&$&&x.deserializeCollisionBoxes($),c&&f&&x.updateCollisionDebugBuffers(this.transform.zoom,$,Ne,nt);let Ui=(si,ji,yi)=>{let{crossTileID:gr,numVerticalGlyphVertices:qi}=si,Ir=null;if(O&&O.dynamicFilterNeedsFeature||zi){let an=this.retainedQueryData[x.bucketInstanceId];Ir=ge.loadFeature({featureIndex:si.featureIndex,bucketIndex:an.bucketIndex,sourceLayerIndex:an.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},Ir,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new n.P(si.tileAnchorX,si.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[gr]=new ir(!1,!1,!1,!0),void o.add(gr);let Ji=Ge.evaluate(Ir,{});if(o.has(gr))return;if(K)return void(this.placements[gr]=new ir(!1,!1,!1));let xi=!1,dr=!1,wi=!0,Fr=!1,hr=!1,ci=null,$i={box:null,offscreen:null,occluded:null},Qr={box:null},yn=null,rn=null,pn=null,Ko=0,No=0,uo=0;yi.textFeatureIndex?Ko=yi.textFeatureIndex:si.useRuntimeCollisionCircles&&(Ko=si.featureIndex),yi.verticalTextFeatureIndex&&(No=yi.verticalTextFeatureIndex);let wo=x.elevationFeatures?x.elevationFeatures[si.elevationFeatureIndex]:void 0,Is=an=>{an.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let vn=this.transform.elevation;an.elevation=Be?Ji:Ji+n.bU.getAtTileOffset(an.tileID,new n.P(an.tileAnchorX,an.tileAnchorY),vn,wo),an.elevation+=si.zOffset},ho=yi.textBox;if(ho){Is(ho);let an=Ar=>{let wn=n.bK.horizontal;if(x.allowVerticalPlacement&&!Ar&&this.prevPlacement){let Xn=this.prevPlacement.placedOrientations[gr];Xn&&(this.placedOrientations[gr]=Xn,wn=Xn,this.markUsedOrientation(x,wn,si))}return wn},vn=(Ar,wn)=>{if(x.allowVerticalPlacement&&qi>0&&yi.verticalTextBox){for(let Xn of x.writingModes)if(Xn===n.bK.vertical?($i=wn(),Qr=$i):$i=Ar(),$i&&$i.box&&$i.box.length)break}else $i=Ar()};if(xt){let Ar=xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[gr]){let ln=this.prevPlacement.variableOffsets[gr];Ar.indexOf(ln.anchor)>0&&(Ar=Ar.filter((Ls=>Ls!==ln.anchor)),Ar.unshift(ln.anchor))}let wn=(ln,Ls,Tu)=>{let ml=x.getSymbolInstanceTextSize(ee,si,this.transform.zoom,ji),Cu=(ln.x2-ln.x1)*ml+2*ln.padding,Eu=(ln.y2-ln.y1)*ml+2*ln.padding,zs=si.hasIconTextFit&&!ue?Ls:null;zs&&Is(zs);let Ua={box:[],offscreen:!1,occluded:!1},Wn=pe?2*Ar.length:Ar.length;for(let Ms=0;Ms<Wn;++Ms){let Rc=this.attemptAnchorPlacement(Ar[Ms%Ar.length],ln,q,G,Lt,Cu,Eu,ml,ve,Ie,N,P,ie,Ms>=Ar.length,si,ji,x,Tu,zs,ee,se);if(Rc&&(Ua=Rc.placedGlyphBoxes,Ua&&Ua.box&&Ua.box.length)){xi=!0,ci=Rc.shift;break}}return Ua};vn((()=>wn(ho,yi.iconBox,n.bK.horizontal)),(()=>{let ln=yi.verticalTextBox;return ln&&Is(ln),x.allowVerticalPlacement&&!($i&&$i.box&&$i.box.length)&&qi>0&&ln?wn(ln,yi.verticalIconBox,n.bK.vertical):{box:null,offscreen:null,occluded:null}})),$i&&(xi=$i.box,wi=$i.offscreen,Fr=$i.occluded);let Xn=an(!(!$i||!$i.box));if(!xi&&this.prevPlacement){let ln=this.prevPlacement.variableOffsets[gr];ln&&(this.variableOffsets[gr]=ln,this.markUsedJustification(x,ln.anchor,si,Xn))}}else{let Ar=(wn,Xn)=>{let ln=x.getSymbolInstanceTextSize(ee,si,this.transform.zoom,ji),Ls=this.collisionIndex.placeCollisionBox(x,ln,wn,q,G,Lt,new n.P(0,0),pe,N,P,ie.predicate);return Ls&&Ls.box&&Ls.box.length&&(this.markUsedOrientation(x,Xn,si),this.placedOrientations[gr]=Xn),Ls};vn((()=>Ar(ho,n.bK.horizontal)),(()=>{let wn=yi.verticalTextBox;return x.allowVerticalPlacement&&qi>0&&wn?(Is(wn),Ar(wn,n.bK.vertical)):{box:null,offscreen:null,occluded:null}})),an(!!($i&&$i.box&&$i.box.length))}}if(yn=$i,xi=yn&&yn.box&&yn.box.length>0,wi=yn&&yn.offscreen,Fr=yn&&yn.occluded,si.useRuntimeCollisionCircles){let an=si.centerJustifiedTextSymbolIndex>=0?si.centerJustifiedTextSymbolIndex:si.verticalPlacedTextSymbolIndex,vn=x.text.placedSymbolArray.get(an),Ar=n.bL(x.textSizeData,ee,vn),wn=S.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(x,pe,vn,an,x.lineVertexArray,x.glyphOffsetArray,Ar,P,M,F,c,Ie,ie.predicate,si.collisionCircleDiameter*Ar/n.bX,wn,this.retainedQueryData[x.bucketInstanceId].tileID),xi=pe||rn.circles.length>0&&!rn.collisionDetected,wi=wi&&rn.offscreen,Fr=rn.occluded}if(yi.iconFeatureIndex&&(uo=yi.iconFeatureIndex),yi.iconBox){let an=vn=>{Is(vn);let Ar=si.hasIconTextFit&&ci?Gs(ci.x,ci.y,ve,Ie,this.transform.angle):new n.P(0,0),wn=x.getSymbolInstanceIconSize(se,this.transform.zoom,si.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,wn,vn,q,G,It,Ar,ue,N,P,ie.predicate)};Qr&&Qr.box&&Qr.box.length&&yi.verticalIconBox?(pn=an(yi.verticalIconBox),dr=pn.box.length>0):(pn=an(yi.iconBox),dr=pn.box.length>0),wi=wi&&pn.offscreen,hr=pn.occluded}let Ps=ae||si.numHorizontalGlyphVertices===0&&qi===0,ea=ye||si.numIconVertices===0;if(Ps||ea?ea?Ps||(dr=dr&&xi):xi=dr&&xi:dr=xi=dr&&xi,xi&&yn&&yn.box&&this.collisionIndex.insertCollisionBox(yn.box,S.get("text-ignore-placement"),x.bucketInstanceId,Qr&&Qr.box&&No?No:Ko,ie.ID),dr&&pn&&this.collisionIndex.insertCollisionBox(pn.box,S.get("icon-ignore-placement"),x.bucketInstanceId,uo,ie.ID),rn&&(xi&&this.collisionIndex.insertCollisionCircles(rn.circles,S.get("text-ignore-placement"),x.bucketInstanceId,Ko,ie.ID),c)){let an=x.bucketInstanceId,vn=this.collisionCircleArrays[an];vn===void 0&&(vn=this.collisionCircleArrays[an]=new xo);for(let Ar=0;Ar<rn.circles.length;Ar+=4)vn.circles.push(rn.circles[Ar+0]),vn.circles.push(rn.circles[Ar+1]),vn.circles.push(rn.circles[Ar+2]),vn.circles.push(rn.collisionDetected?1:0)}let $n=x.projection.name!=="globe";zt=zt&&($n||!Fr),Yt=Yt&&($n||!hr),this.placements[gr]=new ir(xi||zt,dr||Yt,wi||x.justReloaded),o.add(gr)},xr=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,xr),x.elevationType==="road"&&x.updateRoadElevation(xr.canonical),x.updateZOffset(),x.sortFeaturesByY){let si=x.getSortedSymbolIndexes(this.transform.angle);for(let ji=si.length-1;ji>=0;--ji){let yi=si[ji];Ui(x.symbolInstances.get(yi),yi,x.collisionArrays[yi])}x.hasAnyZOffset&&n.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let si=x.getSortedIndexesByZOffset();for(let ji=0;ji<si.length;++ji){let yi=si[ji];Ui(x.symbolInstances.get(yi),yi,x.collisionArrays[yi])}}else for(let si=t.symbolInstanceStart;si<t.symbolInstanceEnd;si++)Ui(x.symbolInstances.get(si),si,x.collisionArrays[si]);if(c&&x.bucketInstanceId in this.collisionCircleArrays){let si=this.collisionCircleArrays[x.bucketInstanceId];n.bk(si.invProjMatrix,P),si.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,o,c,f){let{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:E,crossTileID:P}=c,M=n.c2(o),F=f===n.bK.vertical?E:M==="left"?_:M==="center"?x:M==="right"?S:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=F>=0&&_!==F?0:P),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:P),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:P),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:P)}markUsedOrientation(t,o,c){let f=o===n.bK.horizontal||o===n.bK.horizontalOnly?o:0,_=o===n.bK.vertical?o:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:P}=c,M=t.text.placedSymbolArray;x>=0&&(M.get(x).placedOrientation=f),S>=0&&(M.get(S).placedOrientation=f),E>=0&&(M.get(E).placedOrientation=f),P>=0&&(M.get(P).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,c=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let f=o?o.symbolFadeChange(t):1,_=o?o.opacities:{},x=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(let E in this.placements){let P=this.placements[E],M=_[E];M?(this.opacities[E]=new Zi(M,f,P.text,P.icon,null,P.clipped),c=c||P.text!==M.text.placed||P.icon!==M.icon.placed):(this.opacities[E]=new Zi(null,f,P.text,P.icon,P.skipFade,P.clipped),c=c||P.text||P.icon)}for(let E in _){let P=_[E];if(!this.opacities[E]){let M=new Zi(P,f,!1,!1);M.isHidden()||(this.opacities[E]=M,c=c||P.text.placed||P.icon.placed)}}for(let E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(let E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,c,f){let _=new Set;for(let x of o){let S=x.getBucket(t);S&&x.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,_,x,x.collisionBoxArray,c,f,x.tileID,t.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,x.tileID),S.elevationType==="road"&&S.updateRoadElevation(x.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(t,o,c,f,_,x,S,E){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let P=t.layers[0].layout,M=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),O=new Zi(null,0,!1,!1,!0),N=P.get("text-allow-overlap"),q=P.get("icon-allow-overlap"),G=P.get("text-variable-anchor"),K=P.get("text-rotation-alignment")==="map",$=P.get("text-pitch-alignment")==="map",ee=M.get("symbol-z-offset"),se=P.get("symbol-elevation-reference")==="sea",ie=!ee.isConstant(),ge=new Zi(null,0,N&&(q||!t.hasIconData()||P.get("icon-optional")),q&&(N||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);let ae=(pe,ue,ve)=>{for(let ze=0;ze<ue/4;ze++)pe.opacityVertexArray.emplaceBack(ve)},ye=0;x&&t.updateReplacement(S,x);for(let pe=0;pe<t.symbolInstances.length;pe++){let ue=t.symbolInstances.get(pe),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:ze,crossTileID:Ie,numIconVertices:Ge,tileAnchorX:Be,tileAnchorY:Ye}=ue,gt=null,De=this.retainedQueryData[t.bucketInstanceId];ie&&ue&&De&&(gt=c.latestFeatureIndex.loadFeature({featureIndex:ue.featureIndex,bucketIndex:De.bucketIndex,sourceLayerIndex:De.sourceLayerIndex,layoutVertexArrayOffset:0}));let Ee=ee.evaluate(gt,{}),Ke=o.has(Ie),Ne=this.opacities[Ie];Ke?Ne=O:Ne||(Ne=ge,this.opacities[Ie]=Ne),o.add(Ie);let nt=ve>0||ze>0,xt=Ge>0,Dt=this.placedOrientations[Ie],ft=Dt===n.bK.vertical,vt=Dt===n.bK.horizontal||Dt===n.bK.horizontalOnly;!nt&&!xt||Ne.isHidden()||ye++;let Ft=!1;if((nt||xt)&&x)for(let Lt of t.activeReplacements){if(n.bY(Lt,_,n.bZ.Symbol,E)||Lt.min.x>Be||Be>Lt.max.x||Lt.min.y>Ye||Ye>Lt.max.y)continue;let It=n.b_(Be,Ye,S.canonical,Lt.footprintTileId.canonical);if(Ft=n.b$(It,Lt.footprint),Ft)break}if(nt){let Lt=Ft?jn:yc(Ne.text);ae(t.text,ve,ft?jn:Lt),ae(t.text,ze,vt?jn:Lt);let It=Ne.text.isHidden(),{leftJustifiedTextSymbolIndex:zt,centerJustifiedTextSymbolIndex:Yt,rightJustifiedTextSymbolIndex:zi,verticalPlacedTextSymbolIndex:Ui}=ue,xr=t.text.placedSymbolArray,si=It||ft?1:0;zt>=0&&(xr.get(zt).hidden=si),Yt>=0&&(xr.get(Yt).hidden=si),zi>=0&&(xr.get(zi).hidden=si),Ui>=0&&(xr.get(Ui).hidden=It||vt?1:0);let ji=this.variableOffsets[Ie];ji&&this.markUsedJustification(t,ji.anchor,ue,Dt);let yi=this.placedOrientations[Ie];yi&&(this.markUsedJustification(t,"left",ue,yi),this.markUsedOrientation(t,yi,ue))}if(xt){let Lt=Ft?jn:yc(Ne.icon),{placedIconSymbolIndex:It,verticalPlacedIconSymbolIndex:zt}=ue,Yt=t.icon.placedSymbolArray,zi=Ne.icon.isHidden()?1:0;It>=0&&(ae(t.icon,Ge,ft?jn:Lt),Yt.get(It).hidden=zi),zt>=0&&(ae(t.icon,ue.numVerticalIconVertices,vt?jn:Lt),Yt.get(zt).hidden=zi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let Lt=t.collisionArrays[pe];if(Lt){let It=new n.P(0,0),zt=!0;if(Lt.textBox||Lt.verticalTextBox){if(G){let zi=this.variableOffsets[Ie];zi?(It=Rl(zi.anchor,zi.width,zi.height,zi.textOffset,zi.textScale),K&&It._rotate($?this.transform.angle:-this.transform.angle)):zt=!1}F&&(zt=!Ne.clipped),Lt.textBox&&qn(t.textCollisionBox.collisionVertexArray,Ne.text.placed,!zt||ft,Ee,se,It.x,It.y),Lt.verticalTextBox&&qn(t.textCollisionBox.collisionVertexArray,Ne.text.placed,!zt||vt,Ee,se,It.x,It.y)}let Yt=zt&&!!(!vt&&Lt.verticalIconBox);Lt.iconBox&&qn(t.iconCollisionBox.collisionVertexArray,Ne.icon.placed,Yt,Ee,se,ue.hasIconTextFit?It.x:0,ue.hasIconTextFit?It.y:0),Lt.verticalIconBox&&qn(t.iconCollisionBox.collisionVertexArray,Ne.icon.placed,!Yt,Ee,se,ue.hasIconTextFit?It.x:0,ue.hasIconTextFit?It.y:0)}}}if(t.fullyClipped=ye===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let pe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=pe.invProjMatrix,t.placementViewportMatrix=pe.viewportMatrix,t.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){let c=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function qn(l,t,o,c,f,_,x){l.emplaceBack(t?1:0,o?1:0,_||0,x||0,c,f?1:0),l.emplaceBack(t?1:0,o?1:0,_||0,x||0,c,f?1:0),l.emplaceBack(t?1:0,o?1:0,_||0,x||0,c,f?1:0),l.emplaceBack(t?1:0,o?1:0,_||0,x||0,c,f?1:0)}let fn=Math.pow(2,25),ss=Math.pow(2,24),Dl=Math.pow(2,17),Jc=Math.pow(2,16),gc=Math.pow(2,9),Bl=Math.pow(2,8),_c=Math.pow(2,1);function yc(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;let t=l.placed?1:0,o=Math.floor(127*l.opacity);return o*fn+t*ss+o*Dl+t*Jc+o*gc+t*Bl+o*_c+t}let jn=0;class Hs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,c,f,_,x){let S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(S,f,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((E,P)=>E.sortKey-P.sortKey)));this._currentPartIndex<S.length;){let E=S[this._currentPartIndex];if(o.placeLayerBucketPart(E,this._seenCrossTileIDs,c,E.symbolInstanceStart===0,x),this._currentPartIndex++,_())return!0}return!1}}class Io{constructor(t,o,c,f,_,x,S,E,P){this.placement=new ws(t,_,x,S,E,P),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,o,c,f,_){let x=n.o.now(),S=()=>{let E=n.o.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=o[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=P)&&(!E.maxzoom||E.maxzoom>P)){let M=E,F=M.layout.get("symbol-z-elevate"),O=M.layout.get("symbol-sort-key").constantOr(1)!==void 0,N=M.layout.get("symbol-z-order"),q=N==="viewport-y"||N==="auto"&&!(N!=="viewport-y"&&O),G=M.layout.get("text-allow-overlap")||M.layout.get("icon-allow-overlap")||M.layout.get("text-ignore-placement")||M.layout.get("icon-ignore-placement"),K=q&&G,$=this._inProgressLayer=this._inProgressLayer||new Hs(M),ee=n.B(E.source,E.scope);if($.continuePlacement(F||K?f[ee]:c[ee],this.placement,this._showCollisionBoxes,E,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let Ro=512/n.al/2;class Ss{constructor(t,o,c){this.tileID=t,this.bucketInstanceId=c,this.index=new n.c3(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let f=t.canonical.x*n.al,_=t.canonical.y*n.al;for(let x=0;x<o.length;x++){let{key:S,crossTileID:E,tileAnchorX:P,tileAnchorY:M}=o.get(x),F=Math.floor((f+P)*Ro),O=Math.floor((_+M)*Ro);this.index.add(F,O),this.keys.push(S),this.crossTileIDs.push(E)}this.index.finish()}findMatches(t,o,c){let f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=Ro/Math.pow(2,o.canonical.z-this.tileID.canonical.z),x=o.canonical.x*n.al,S=o.canonical.y*n.al;for(let E=0;E<t.length;E++){let P=t.get(E);if(P.crossTileID)continue;let{key:M,tileAnchorX:F,tileAnchorY:O}=P,N=Math.floor((x+F)*_),q=Math.floor((S+O)*_),G=this.index.range(N-f,q-f,N+f,q+f).sort(((K,$)=>K-$));for(let K of G){let $=this.crossTileIDs[K];if(this.keys[K]===M&&!c.has($)){c.add($),P.crossTileID=$;break}}}}}class On{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let o=Math.round((t-this.lng)/360);if(o!==0)for(let c in this.indexes){let f=this.indexes[c],_={};for(let x in f){let S=f[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),_[S.tileID.key]=S}this.indexes[c]=_}this.lng=t}addBucket(t,o,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let f=this.usedCrossTileIDs[t.overscaledZ];for(let _ in this.indexes){let x=this.indexes[_];if(Number(_)>t.overscaledZ)for(let S in x){let E=x[S];E.tileID.isChildOf(t)&&E.findMatches(o.symbolInstances,t,f)}else{let S=x[t.scaledTo(Number(_)).key];S&&S.findMatches(o.symbolInstances,t,f)}}for(let _=0;_<o.symbolInstances.length;_++){let x=o.symbolInstances.get(_);x.crossTileID||(x.crossTileID=c.generate(),f.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ss(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(let c of o.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let o=!1;for(let c in this.indexes){let f=this.indexes[c];for(let _ in f)t[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[_]),delete f[_],o=!0)}return o}}class pa{constructor(){this.layerIndexes={},this.crossTileIDs=new On,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,c,f){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new Jn);let x=!1,S={};f.name!=="globe"&&_.handleWrapJump(c);for(let E of o){let P=E.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(E.tileID,P,this.crossTileIDs)&&(x=!0),S[P.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(t){let o={};t.forEach((c=>{o[c]=!0}));for(let c in this.layerIndexes)o[c]||delete this.layerIndexes[c]}}let $r=771;class vi{constructor(t,o,c,f){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=f}}vi.Replace=[1,0,1,0],vi.disabled=new vi(vi.Replace,n.ao.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,n.ao.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,$r,1,$r],n.ao.transparent,[!0,!0,!0,!0]),vi.alphaBlendedNonPremultiplied=new vi([770,$r,770,$r],n.ao.transparent,[!0,!0,!0,!0]),vi.multiply=new vi([774,0,774,0],n.ao.transparent,[!0,!0,!0,!0]),vi.additive=new vi([1,1,1,1],n.ao.transparent,[!0,!0,!0,!0]);class Rt{constructor(t,o,c){this.func=t,this.mask=o,this.range=c}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);let Oa=7680;class ni{constructor(t,o,c,f,_,x){this.test=t,this.ref=o,this.mask=c,this.fail=f,this.depthFail=_,this.pass=x}}ni.disabled=new ni({func:519,mask:0},0,0,Oa,Oa,Oa);let Fl=1029,Ts=2305;class Jt{constructor(t,o,c){this.enable=t,this.mode=o,this.frontFace=c}}function vc(l,t){let o=n.c9(l,3);n.cb(l,t),n.cf(l,3,o)}function Nl(l,t){let o=n.c6([]);return n.c7(o,o,-t),n.c8(o,o,-l),o}function Nd(l,t){let o=[l[0],l[1],0],c=[t[0],t[1],0];if(n.ag(o)>=1e-15){let x=n.aw([],o);n.c4(c,x,n.bI(c,x)),t[0]=c[0],t[1]=c[1]}let f=n.bH([],t,l);if(n.c5(f)<1e-15)return null;let _=Math.atan2(-f[1],f[0]);return Nl(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}Jt.disabled=new Jt(!1,Fl,Ts),Jt.backCCW=new Jt(!0,Fl,Ts),Jt.backCW=new Jt(!0,Fl,2304),Jt.frontCW=new Jt(!0,1028,2304),Jt.frontCCW=new Jt(!0,1028,Ts);class Qn{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){let o=t instanceof n.ae?t:new n.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=n.bS(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o,c){if(this.orientation=null,!this.position)return;let f=this.position,_=c||(this._elevation?this._elevation.getAtPointOrZero(n.ae.fromLngLat(t)):0),x=n.ae.fromLngLat(t,_),S=[x.x-f.x,x.y-f.y,x.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Nd(S,o)}setPitchBearing(t,o){this.orientation=Nl(n.an(t),n.an(-o))}}class Qc{constructor(t,o){this._transform=n.bz([]),this.orientation=o,this.position=t}get mercatorPosition(){let t=this.position;return new n.ae(t[0],t[1],t[2])}get position(){let t=n.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&n.cf(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.c6([]),t&&vc(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=Nl(t,o),vc(this._transform,this._orientation)}forward(){let t=n.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=n.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=n.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){let c=new Float64Array(16);return n.bk(c,this.getWorldToCamera(t,o)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,c){let f=this.position;n.c4(f,f,-t);let _=new Float64Array(16);return n.bp(_,[c,c,c]),n.bq(_,_,f),_[10]*=o,_}getWorldToCamera(t,o){let c=new Float64Array(16),f=new Float64Array(4),_=this.position;return n.ca(f,this._orientation),n.c4(_,_,-t),n.cb(c,f),n.bq(c,c,_),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=o,c[9]*=o,c[10]*=o,c[11]*=o,c}getCameraToClipPerspective(t,o,c,f){let _=new Float64Array(16);return n.cc(_,t,o,c,f),_}getCameraToClipOrthographic(t,o,c,f,_,x){let S=new Float64Array(16);return n.cd(S,t,o,c,f,_,x),S}getDistanceToElevation(t,o=!1){let c=t===0?0:n.ce(t,o?n.a_(this.position[1]):this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new Qc([...this.position],[...this.orientation])}}let En={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ao{constructor(t=0,o=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=c,this.right=f}interpolate(t,o,c){return o.top!=null&&t.top!=null&&(this.top=n.ak(t.top,o.top,c)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.ak(t.bottom,o.bottom,c)),o.left!=null&&t.left!=null&&(this.left=n.ak(t.left,o.left,c)),o.right!=null&&t.right!=null&&(this.right=n.ak(t.right,o.right,c)),this}getCenter(t,o){let c=n.aA((this.left+t-this.right)/2,0,t),f=n.aA((this.top+o-this.bottom)/2,0,o);return new n.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ao(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Po=15;class fa{constructor(t,o,c,f,_,x,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=c??0,this._maxPitch=f??60,this.setProjection(x),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ao,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let t=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Po}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){let c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let o=this.projection?this.getProjection():void 0;this.projection=n.cl(this.projectionOptions);let c=this.getProjection(),f=!n.bx(o,c);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.cl({name:"mercator"});let o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.cm(),n.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let o=n.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let c=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;let t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop(),f=0,_=0;for(let x=0;x<o.length;x++){let S=new n.P(o[x][0]*this.width,c+o[x][1]*(this.height-c)),E=t.pointCoordinate(S);if(!E)continue;let P=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);f+=E[3]*P,_+=P}return _===0?NaN:f/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*o,f=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(f-c,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),c;c=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];let f=n.ag(n.av([],this._camera.position,c));return n.aA(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!n.co(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){let c=[t.position.x,t.position.y,t.position.z];n.cp(c,this._camera.position)||(this._setCameraPosition(c),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,o=new Qn;return o.position=new n.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!n.cq(t))return!1;n.cr(t,t);let o=n.cs([],[0,0,-1],t),c=n.cs([],[0,-1,0],t);if(c[2]<0)return!1;let f=Nd(o,c);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){let o=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=n.aA(t[2],f/c,f/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,c){this._unmodified=!1,this._edgeInsets.interpolate(t,o,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){let o=[new n.ct(0,t)];if(this.renderWorldCopies){let c=this.pointCoordinate(new n.P(0,0)),f=this.pointCoordinate(new n.P(this.width,0)),_=this.pointCoordinate(new n.P(this.width,this.height)),x=this.pointCoordinate(new n.P(0,this.height)),S=Math.floor(Math.min(c.x,f.x,_.x,x.x)),E=Math.floor(Math.max(c.x,f.x,_.x,x.x)),P=1;for(let M=S-P;M<=E+P;M++)M!==0&&o.push(new n.ct(M,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,c){let f=[],_=c!=null,x=!_;if(x&&this.zoom<o||_&&c[0]===0&&c[1]===0)return f;let S=new Set,E=(M,F,O,N,q)=>{let G=n.cX(F,M,O,N,q);S.has(G)||(f.push(new n.aP(M,F,O,N,q)),S.add(G))};for(let M=0;M<t.length;M++){let F=t[M];if(x&&F.canonical.z!==o)continue;let O=F.canonical,N=F.overscaledZ,q=F.wrap,G=1<<O.z,K=O.x+1<G,$=O.x>0,ee=O.y+1<G,se=O.y>0,ie=F.wrap-($?0:1),ge=F.wrap+(K?0:1),ae=$?O.x-1:G-1,ye=K?O.x+1:0;if(_)c[0]<0?(E(N,ge,O.z,ye,O.y),c[1]<0&&ee&&(E(N,q,O.z,O.x,O.y+1),E(N,ge,O.z,ye,O.y+1)),c[1]>0&&se&&(E(N,q,O.z,O.x,O.y-1),E(N,ge,O.z,ye,O.y-1))):c[0]>0?(E(N,ie,O.z,ae,O.y),c[1]<0&&ee&&(E(N,q,O.z,O.x,O.y+1),E(N,ie,O.z,ae,O.y+1)),c[1]>0&&se&&(E(N,q,O.z,O.x,O.y-1),E(N,ie,O.z,ae,O.y-1))):c[1]<0&&ee?E(N,q,O.z,O.x,O.y+1):se&&E(N,q,O.z,O.x,O.y-1);else{let pe=F.visibleQuadrants;1&pe&&(E(N,ie,O.z,ae,O.y),se&&(E(N,q,O.z,O.x,O.y-1),E(N,ie,O.z,ae,O.y-1))),2&pe&&(E(N,ge,O.z,ye,O.y),se&&(E(N,q,O.z,O.x,O.y-1),E(N,ge,O.z,ye,O.y-1))),4&pe&&(E(N,ie,O.z,ae,O.y),ee&&(E(N,q,O.z,O.x,O.y+1),E(N,ie,O.z,ae,O.y+1))),8&pe&&(E(N,ge,O.z,ye,O.y),ee&&(E(N,q,O.z,O.x,O.y+1),E(N,ge,O.z,ye,O.y+1)))}}let P=[];for(let M of f)f.some((F=>M.isChildOf(F)))||P.push(M);if(f=P.filter((M=>!t.some((F=>!!(M.overscaledZ<o&&F.isChildOf(M))||M.equals(F)||M.isChildOf(F))))),x){let M=1<<o,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[M*F.x,M*F.y],N=4,q=N*N;f=f.filter((G=>{let K=G.canonical.x+.5-O[0],$=G.canonical.y+.5-O[1];return K*K+$*$<q}))}return f}extendTileCoverToNearPlane(t,o,c){let f=[],_=new Set;for(let ee of t)_.add(ee.key);let x=(ee,se,ie,ge,ae)=>{let ye=n.cX(se,ee,ie,ge,ae);_.has(ye)||(f.push(new n.aP(ee,se,ie,ge,ae)),_.add(ye))},S=t.reduce(((ee,se)=>Math.max(ee,se.overscaledZ)),c),E=1<<c,P=[new n.P(0,0),new n.P(n.al,0),new n.P(n.al,n.al),new n.P(0,n.al)],M=new n.P(0,0),F=new n.P(0,0),O=(ee,se)=>{let ie=Math.floor(ee[0]),ge=Math.floor(ee[1]),ae=(ee[0]-ie)*n.al,ye=(ee[1]-ge)*n.al,pe=Math.floor(se[0]),ue=Math.floor(se[1]),ve=(se[0]-pe)*n.al,ze=(se[1]-ue)*n.al;for(let Ie=-1;Ie<=1;Ie++){let Ge=ie+Ie;if(!(Ge<0||Ge>=E)){M.x=ae-Ie*n.al,F.x=ve-(Ge-pe)*n.al;for(let Be=-1;Be<=1;Be++){let Ye=ge+Be;M.y=ye-Be*n.al,F.y=ze-(Ye-ue)*n.al,n.cY(M,F,P)&&x(S,0,c,Ge,Ye)}}}},N=o.points,q=N[n.cu],G=N[n.cv],K=this._projectToGround(q,N[n.cw]),$=this._projectToGround(G,N[n.cx]);return O(q,K),O(G,$),f}_projectToGround(t,o){return n.cy(n.cz(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t),c=o,f=this.elevation&&this.elevation.exaggeration(),_=f&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);let S=this.locationCoordinate(this.center),E=this.center.lat,P=1<<o,M=[P*S.x,P*S.y,0],F=this.projection.name==="globe",O=!F,N=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,O),q=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=P*n.ce(1,this.center.lat),K=this._camera.position[2]/n.ce(1,this.center.lat),$=[P*q.x,P*q.y,K*(O?1:G)],ee=F||f,se=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ie=this.isLODDisabled(!0)?o:0,ge;if(this._elevation&&t.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let Ee=this._elevation.getMinMaxForVisibleTiles();ge=Ee?Ee.max:this._centerAltitude}else ge=this._centerAltitude;let ae=t.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=this.projection.isReprojectedInTileSpace?n.cB(this):1,pe=Ee=>{let Ne=new n.ae(Ee.x+25e-6,Ee.y,Ee.z),nt=new n.ae(Ee.x,Ee.y+25e-6,Ee.z),xt=Ee.toLngLat(),Dt=Ne.toLngLat(),ft=nt.toLngLat(),vt=this.locationCoordinate(xt),Ft=this.locationCoordinate(Dt),Lt=this.locationCoordinate(ft),It=Math.hypot(Ft.x-vt.x,Ft.y-vt.y),zt=Math.hypot(Lt.x-vt.x,Lt.y-vt.y);return Math.sqrt(It*zt)*ye/25e-6},ue=Ee=>{let Ke=ge,Ne=ae;return{aabb:n.cE(this,P,0,0,0,Ee,Ne,Ke,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Ke,wrap:Ee,fullyVisible:!1}},ve=[],ze=[],Ie=o,Ge=t.reparseOverscaled?c:o,Be=(K-this._centerAltitude)*G,Ye=Ee=>{if(!this._elevation||!Ee.tileID||!x)return;let Ke=this._elevation.getMinMaxForTile(Ee.tileID),Ne=Ee.aabb;Ke?(Ne.min[2]=Ke.min,Ne.max[2]=Ke.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(Ee.shouldSplit=De(Ee),Ee.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},gt=(Ee,Ke)=>{if(.707*Ke<Ee)return 1;let Ne=Ke/Ee;return Ne/(1.4144271570014144+(Math.pow(1.1,Ne-1.4144271570014144+1)-1)/(1.1-1)-1)},De=Ee=>{if(Ee.zoom<ie)return!0;if(Ee.zoom===Ie)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;let Ke=Ee.aabb.distanceX($),Ne=Ee.aabb.distanceY($),nt=Be,xt=1;if(F){nt=Ee.aabb.distanceZ($);let zt=Math.pow(2,Ee.zoom),Yt=n.a_((Ee.y+1)/zt),zi=n.a_(Ee.y/zt),Ui=Math.min(Math.max(E,Yt),zi),xr=n.d0(Ui)/n.d0(E);if(xt=Ui===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xr/this._mercatorScaleRatio),this.zoom<=n.cZ&&Ee.zoom===Ie-1&&xr>=.9)return!0}else if(_&&(nt=Ee.aabb.distanceZ($)*G),this.projection.isReprojectedInTileSpace&&c<=5){let zt=Math.pow(2,Ee.zoom),Yt=pe(new n.ae((Ee.x+.5)/zt,(Ee.y+.5)/zt));xt=Yt>.85?1:Yt}if(!x&&!F){let zt=Math.sqrt(Ke*Ke+Ne*Ne+nt*nt),Yt=(1<<Ie-Ee.zoom)*se*xt;return Yt*=gt(Math.max(nt,Be),zt),zt<Yt}let Dt=Number.MAX_VALUE,ft=0,vt=Ee.aabb.getCorners(),Ft=[];for(let zt of vt){n.av(Ft,zt,$),F||(_?Ft[2]*=G:Ft[2]=Be);let Yt=n.bI(Ft,this._camera.forward());Yt<Dt&&(Dt=Yt,ft=Math.abs(Ft[2]))}let Lt=(1<<Ie-Ee.zoom)*se*xt;if(Lt*=gt(Math.max(ft,Be),Dt),Dt<Lt)return!0;let It=Ee.aabb.closestPoint(M);return It[0]===M[0]&&It[1]===M[1]};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)ve.push(ue(-Ee)),ve.push(ue(Ee));for(ve.push(ue(0));ve.length>0;){let Ee=ve.pop(),Ke=Ee.x,Ne=Ee.y,nt=Ee.fullyVisible,xt=()=>this.projection.name==="globe"&&(Ee.y===0||Ee.y===(1<<Ee.zoom)-1);if(!nt){let Dt=ee?Ee.aabb.intersects(N):Ee.aabb.intersectsFlat(N);if(Dt===0&&xt()){let ft=new n.cC(Ee.zoom,Ke,Ne);Dt=n.cD(this,P,ft,!0).intersects(N)}if(Dt===0)continue;nt=Dt===2}if(Ee.zoom!==Ie&&De(Ee))for(let Dt=0;Dt<4;Dt++){let ft=(Ke<<1)+Dt%2,vt=(Ne<<1)+(Dt>>1),Ft={aabb:x?Ee.aabb.quadrant(Dt):n.cE(this,P,Ee.zoom+1,ft,vt,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:ft,y:vt,wrap:Ee.wrap,fullyVisible:nt,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};_&&!F&&(Ft.tileID=new n.aP(Ee.zoom+1===Ie?Ge:Ee.zoom+1,Ee.wrap,Ee.zoom+1,ft,vt),Ye(Ft)),ve.push(Ft)}else{let Dt=Ee.zoom===Ie?Ge:Ee.zoom;if(t.minzoom&&t.minzoom>Dt)continue;let ft=0;if(!nt){let It=ee?Ee.aabb.intersectsPrecise(N):Ee.aabb.intersectsPreciseFlat(N);if(It===0&&xt()){let zt=new n.cC(Ee.zoom,Ke,Ne);It=n.cD(this,P,zt,!0).intersectsPrecise(N)}if(It===0)continue;if(t.calculateQuadrantVisibility)if(N.containsPoint(Ee.aabb.center))ft=15;else for(let zt=0;zt<4;zt++)Ee.aabb.quadrant(zt).intersects(N)!==0&&(ft|=1<<zt)}let vt=M[0]-(.5+Ke+(Ee.wrap<<Ee.zoom))*(1<<o-Ee.zoom),Ft=M[1]-.5-Ne,Lt=Ee.tileID?Ee.tileID:new n.aP(Dt,Ee.wrap,Ee.zoom,Ke,Ne);t.calculateQuadrantVisibility&&(Lt.visibleQuadrants=ft),ze.push({tileID:Lt,distanceSq:vt*vt+Ft*Ft})}}if(this.fogCullDistSq){let Ee=this.fogCullDistSq,Ke=this.horizonLineFromTop();ze=ze.filter((Ne=>{let nt=[0,0,0,1],xt=[n.al,n.al,0,1],Dt=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());n.aC(nt,nt,Dt),n.aC(xt,xt,Dt);let ft=n.cF([],nt,xt),vt=n.cG([],nt,xt),Ft=n.c_(ft,vt);if(Ft===0)return!0;let Lt=!1,It=this._elevation;if(It&&Ft>Ee&&Ke!==0){let zt=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),Yt;t.isTerrainDEM||(Yt=It.getMinMaxForTile(Ne.tileID)),Yt||(Yt={min:ae,max:ge});let zi=n.cH(this.rotation),Ui=[zi[0]*n.al,zi[1]*n.al,Yt.max];n.af(Ui,Ui,zt),Lt=(1-Ui[1])*this.height*.5<Ke}return Ft<Ee||Lt}))}return ze.sort(((Ee,Ke)=>Ee.distanceSq-Ke.distanceSq)).map((Ee=>Ee.tileID))}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){let o=n.aA(t.lat,-n.cI,n.cI),c=this.projection.project(t.lng,o);return new n.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let c,f,_=this.centerPoint;if(this.projection.name==="globe"){let S=this.worldSize;c=(o.x-_.x)/S,f=(o.y-_.y)/S}else{let S=this.pointCoordinate(o),E=this.pointCoordinate(_);c=S.x-E.x,f=S.y-E.y}let x=this.locationCoordinate(t);this.setLocation(new n.ae(x.x-c,x.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){let c=o?n.ce(o,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new n.ae(f.x,f.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){let c=o??this._centerAltitude,f=[t.x,t.y,0,1],_=[t.x,t.y,1,1];n.aC(f,f,this.pixelMatrixInverse),n.aC(_,_,this.pixelMatrixInverse);let x=_[3];n.cJ(f,f,1/f[3]),n.cJ(_,_,1/x);let S=f[2],E=_[2];return{p0:f,p1:_,t:S===E?0:(c-S)/(E-S)}}screenPointToMercatorRay(t){let o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return n.aC(o,o,this.pixelMatrixInverse),n.aC(c,c,this.pixelMatrixInverse),n.cJ(o,o,1/o[3]),n.cJ(c,c,1/c[3]),o[2]=n.ce(o[2],this._center.lat)*this.worldSize,c[2]=n.ce(c[2],this._center.lat)*this.worldSize,n.cJ(o,o,1/this.worldSize),n.cJ(c,c,1/this.worldSize),new n.ax([o[0],o[1],o[2]],n.aw([],n.av([],c,o)))}rayIntersectionCoordinate(t){let{p0:o,p1:c,t:f}=t,_=n.ce(o[2],this._center.lat),x=n.ce(c[2],this._center.lat);return new n.ae(n.ak(o[0],c[0],f)/this.worldSize,n.ak(o[1],c[1],f)/this.worldSize,n.ak(_,x,f))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new n.ae(c[0],c[1],c[2]);let f=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,o);let x=.02*_,S=t.clone();for(let E=0;E<10&&_-f>x;E++){S.y=n.ak(f,_,.66);let P=this.projection.pointCoordinate3D(this,S.x,S.y);P?(_=S.y,c=P):f=S.y}return c?new n.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cK)return!this.isPointAboveHorizon(t);let o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){let c=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return n.aC(f,f,this.pixelMatrix),f[3]>0?new n.P(f[0]/f[3],f[1]/f[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:o}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.P(o,t)),x=this.pointLocation3D(new n.P(f,t)),S=this.pointLocation3D(new n.P(f,c)),E=this.pointLocation3D(new n.P(o,c)),P=Math.min(_.lng,x.lng,S.lng,E.lng),M=Math.max(_.lng,x.lng,S.lng,E.lng),F=Math.min(_.lat,x.lat,S.lat,E.lat),O=Math.max(_.lat,x.lat,S.lat,E.lat),N=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,G=(K,$,ee,se,ie)=>{let ge=(K+ee)/2,ae=($+se)/2,ye=new n.P(ge,ae),{lng:pe,lat:ue}=this.pointLocation3D(ye),ve=Math.max(0,P-pe,F-ue,pe-M,ue-O);P=Math.min(P,pe),M=Math.max(M,pe),F=Math.min(F,ue),O=Math.max(O,ue),(ie<q||ve>N)&&(G(K,$,ge,ae,ie+1),G(ge,ae,ee,se,ie+1))};if(G(o,t,f,t,1),G(f,t,f,c,1),G(f,c,o,c,1),G(o,c,o,t,1),this.projection.name==="globe"){let[K,$]=n.cL(this);K?(O=90,M=180,P=-180):$&&(F=-90,M=180,P=-180)}return new n.aI(new n.aS(P,F),new n.aS(M,O))}_getBoundsRectangular(t,o){let{top:c,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=new n.P(f,c),E=new n.P(x,c),P=new n.P(x,_),M=new n.P(f,_),F=this.pointCoordinate(S,t),O=this.pointCoordinate(E,t),N=this.pointCoordinate(P,o),q=this.pointCoordinate(M,o),G=(K,$)=>($.y-K.y)/($.x-K.x);return F.y>1&&O.y>=0?F=new n.ae((1-q.y)/G(q,F)+q.x,1):F.y<0&&O.y<=1&&(F=new n.ae(-q.y/G(q,F)+q.x,0)),O.y>1&&F.y>=0?O=new n.ae((1-N.y)/G(N,O)+N.x,1):O.y<0&&F.y<=1&&(O=new n.ae(-N.y/G(N,O)+N.x,0)),new n.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let o=t.visibleDemTiles.reduce(((c,f)=>{if(f.dem){let _=f.dem.tree;c.min=Math.min(c.min,_.minimums[0]),c.max=Math.max(c.max,_.maximums[0])}return c}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.cI,this.maxLat=n.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aF(this.minLng)*this.tileSize,this.worldMaxX=n.aF(this.maxLng)*this.tileSize,this.worldMinY=n.aJ(this.maxLat)*this.tileSize,this.worldMaxY=n.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){let o=t.key,c=this._distanceTileDataCache;if(c[o])return c[o];let f=t.canonical,_=1/this.height,x=this.cameraWorldSize,S=x/this.zoomScale(f.z),E=(f.x+Math.pow(2,f.z)*t.wrap)*S,P=f.y*S,M=this.point;M.x*=x/this.worldSize,M.y*=x/this.worldSize;let F=this.angle,O=Math.sin(-F),N=-Math.cos(-F);return c[o]={bearing:[O,N],center:[(M.x-E)*_,(M.y-P)*_],scale:S/n.al*_},c[o]}calculateFogTileMatrix(t){let o=t.key,c=this._fogTileMatrixCache;if(c[o])return c[o];let f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.aB(f,this.worldToFogMatrix,f),c[o]=new Float32Array(f),c[o]}calculateProjMatrix(t,o=!1,c=!1){let f=t.key,_;if(_=c?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,_[f])return _[f];let x=this.calculatePosMatrix(t,this.worldSize),S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.aB(x,S,x),_[f]=new Float32Array(x),_[f]}calculatePixelsToTileUnitsMatrix(t){let o=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[o])return c[o];let f=n.cM(t,this);return c[o]=f,c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,o=n.bp([],[t,t,t]);return n.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let o=n.ce(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(o),f=this._camera.forward(),_=n.ce(1,this._center.lat);c[2]/=_,f[2]/=_,n.aw(f,f);let x=t.raycast(c,f,t.exaggeration());if(x){let S=n.bG([],c,f,x),E=new n.ae(S[0],S[1],n.ce(S[2],n.a_(S[1]))),P=(E.z+n.ag([E.x-c[0],E.y-c[1],E.z-c[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let o=this._elevation,c=n.ce(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=o.getAtPointOrZero(new n.ae(...f)),x=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),E=f[2]-x;if(E<=S)if(E<0||t){let P=this.locationCoordinate(this._center,this._centerAltitude),M=[f[0],f[1],P.z-f[2]],F=n.ag(M);M[2]-=(S-E)/this._pixelsPerMercatorPixel;let O=n.ag(M);if(O===0)return;n.c4(M,M,F/O*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],P.z*this._pixelsPerMercatorPixel-M[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let O=this.center;return O.lat=n.aA(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(O.lng=n.aA(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}let o=this._unmodified,{x:c,y:f}=this.point,_=0,x=c,S=f,E=this.width/2,P=this.height/2,M=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(f-P<M&&(S=M+P),f+P>F&&(S=F-P),F-M<this.height&&(_=Math.max(_,this.height/(F-M)),S=(F+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let O=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,q=this.worldSize/2-(O+N)/2;x=(c+q+this.worldSize)%this.worldSize-q,x-E<O&&(x=O+E),x+E>N&&(x=N-E),N-O<this.width&&(_=Math.max(_,this.width/(N-O)),x=(N+O)/2)}x===c&&S===f||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(x,S))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,o=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.ce(1,this.center.lat)/n.ce(1,n.d1));let f=n.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let _=this.projection.zAxisUnit==="meters"?c:1,x=this._camera.getWorldToCamera(this.worldSize,_),S,E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(E[8]=2*-t.x/this.width,E[9]=2*t.y/this.height,this.isOrthographic){let ue=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ve=ue*this.aspect,ze=-ve,Ie=-ue;ve-=t.x,ze-=t.x,ue+=t.y,Ie+=t.y,S=this._camera.getCameraToClipOrthographic(ze,ve,Ie,ue,this._nearZ,this._farZ),((Ge,Be,Ye,gt)=>{for(let De=0;De<16;De++)Ge[De]=n.ak(Be[De],Ye[De],gt)})(S,S,E,n.c$(this.pitch>=Po?1:this.pitch/Po))}else S=E;let P=n.cO([],E,x),M=n.cO([],S,x);if(this.projection.isReprojectedInTileSpace){let ue=this.locationCoordinate(this.center),ve=n.bz([]);n.bq(ve,ve,[ue.x*this.worldSize,ue.y*this.worldSize,0]),n.aB(ve,ve,n.cP(this)),n.bq(ve,ve,[-ue.x*this.worldSize,-ue.y*this.worldSize,0]),n.aB(M,M,ve),n.aB(P,P,ve),this.inverseAdjustmentMatrix=n.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cR([],M,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=M,this.invProjMatrix=n.bk(new Float64Array(16),this.projMatrix),o){let ue=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ue[8]=2*-t.x/this.width,ue[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cO([],ue,x)}else this.expandedFarZProjMatrix=this.projMatrix;let F=n.bk([],S);this.frustumCorners=n.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);let O=new Float32Array(16);n.bz(O),n.cR(O,O,[1,-1,1]),n.cT(O,O,this._pitch),n.bA(O,O,this.angle);let N=n.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.by(N);let q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-t.x/this.width,N[9]=2*(t.y+q)/this.height,this.skyboxMatrix=n.aB(O,N,O);let G=this.point,K=G.x,$=G.y,ee=this.width%2/2,se=this.height%2/2,ie=Math.cos(this.angle),ge=Math.sin(this.angle),ae=K-Math.round(K)+ie*ee+ge*se,ye=$-Math.round($)+ie*se+ge*ee,pe=new Float64Array(M);if(n.bq(pe,pe,[ae>.5?ae-1:ae,ye>.5?ye-1:ye,0]),this.alignedProjMatrix=pe,M=n.bB(),n.cR(M,M,[this.width/2,-this.height/2,1]),n.bq(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=n.bB(),n.cR(M,M,[1,-1,1]),n.bq(M,M,[-1,-1,0]),n.cR(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=n.aB(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},M=n.bk(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cU(this);let ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.af(ue,ue,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,c=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,o];n.c4(_,_,f),n.c4(c,c,-1),n.cV(c,c,_);let x=n.bB();n.bq(x,x,c),n.cR(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,f)}_computeCameraPosition(t){let o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),f=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-c[0]*_,f.y/this.worldSize-c[1]*_,t/this.worldSize*this._centerAltitude-c[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],f=t[2],_=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(_=Math.min((o-c)/f,1)),this._camera.position=n.bG([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,o=this._camera.forward(),{pitch:c,bearing:f}=this._camera.getPitchBearing(),_=n.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.an(this._maxPitch)),S=Math.max((t[2]-_)/Math.cos(c),x),E=this._zoomFromMercatorZ(S);n.bG(t,t,o,S),this._pitch=n.aA(c,n.an(this.minPitch),n.an(this.maxPitch)),this.angle=n.bS(f,-Math.PI,Math.PI),this._setZoom(n.aA(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,c=n.cK,f=0,_=1/0;for(;c-o>1e-6&&c>o;){let x=o+.5*(c-o),S=this.tileSize*Math.pow(2,x),E=this.getCameraToCenterDistance(this.projection,x,S),P=this.scaleZoom(E/(Math.max(0,t)*this.tileSize)),M=Math.abs(x-P);M<_&&(_=M,f=x),x<P?o=x:c=x}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){let c=Math.min(t.x,o.x),f=Math.max(t.x,o.x),_=Math.min(t.y,o.y),x=Math.max(t.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let S=[new n.P(c,_),new n.P(f,x),new n.P(c,x),new n.P(f,_)],E=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let M of S){let F=this.pointRayIntersection(M);if(F.t<0)return!0;let O=this.rayIntersectionCoordinate(F);if(O.x<E||O.y<0||O.x>P||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,o){let c=n.ag(n.av([],this._camera.position,t)),f=this._zoomFromMercatorZ(c)+o;return c-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){let t=(function([o,c,f],_){let x=[o,c,f,1];n.aC(x,x,_);let S=x[3]=Math.max(x[3],1e-6);return x[0]/=S,x[1]/=S,x[2]/=S,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,c=this.worldSize){let f=n.cN(t,o,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,c,f),x=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(x=n.ak(1,x,n.c$(this.pitch>=Po?1:this.pitch/Po))),x}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.aB(t,t,this.globeMatrix),t}getFrustum(t){return n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let Zs=(l,t)=>{if(t>0&&l.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let o=l.transform,c=Math.max(Math.abs(o._zoom-(l.minCutoffZoom-1)),1),f=o.isLODDisabled(!1)?n.ah(60,45,o.pitch):n.ah(30,15,o.pitch),_=o._farZ-o._nearZ,x=t*o.height,S=((1-(E=f))*o.cameraToCenterDistance+E*(o._farZ+x))*c;var E;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(S-o._nearZ)/_,(S-x-o._nearZ)/_]}}},Rn={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class eu{constructor(t,o){this.aabb=t,this.lastCascade=o}}class Ju{add(t,o){let c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],o.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],o.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],o.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],o.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],o.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],o.max[2])):this.receivers[t.key]=new eu(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,c){let f=n.d8.fromPoints(t.points),_=0;for(let x in this.receivers){let S=this.receivers[x];if(!S||!f.intersectsAabb(S.aabb))continue;S.aabb.min=f.closestPoint(S.aabb.min),S.aabb.max=f.closestPoint(S.aabb.max);let E=S.aabb.getCorners();for(let P=0;P<c.length;P++){let M=!0;for(let F of E){let O=[F[0]*o,F[1]*o,F[2]];if(n.af(O,O,c[P].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){M=!1;break}}if(S.lastCascade=P,_=Math.max(_,P),M)break}}return _+1}}class Ra{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ju,this._depthMode=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(Rn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Rn,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Rn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){let c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;let f=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||f<=0||(this._shadowLayerCount=c.style.order.reduce(((q,G)=>{let K=c.style._mergedLayers[G];return q+(K.hasShadowPass()&&!K.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let _=c.context,x=Rn.shadowMapResolution,S=Rn.shadowMapResolution;if(this._cascades.length===0||Rn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<Rn.cascadeCount;++q){let G=c._shadowMapDebug,K=_.gl,$=_.createFramebuffer(x,S,G,"texture"),ee=new n.T(_,{width:x,height:S,data:null},K.DEPTH_COMPONENT16);if($.depthAttachment.set(ee.texture),G){let se=new n.T(_,{width:x,height:S,data:null},K.RGBA8);$.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:$,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cA,scale:0})}}this.shadowDirection=xc(o);let E=0;if(t.elevation){let q=t.elevation,G=[1e4,-1e4];q.visibleDemTiles.filter((K=>K.dem)).forEach((K=>{let $=K.dem.tree;G[0]=Math.min(G[0],$.minimums[0]),G[1]=Math.max(G[1],$.maximums[0])})),G[0]!==1e4&&(E=(G[1]-G[0])*q.exaggeration())}let P=1.5*t.cameraToCenterDistance,M=3*P,F=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){let G=this._cascades[q],K=t.height/50,$=1;Rn.cascadeCount===1?$=M:q===0?$=P:(K=P,$=M);let[ee,se]=Qu(t,this.shadowDirection,K,$,Rn.shadowMapResolution,E);G.scale=t.scale,G.matrix=ee,G.boundingSphereRadius=se,n.bk(F,G.matrix),G.frustum=n.cA.fromInvProjectionMatrix(F,1,0,!0),G.far=$}let O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Rn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Rn.shadowMapResolution,this._uniformValues.u_shadowmap_0=En.ShadowMap0,this._uniformValues.u_shadowmap_1=En.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let N=c.transform.elevation;for(let q of this._groundShadowTiles){let G={min:0,max:0};if(N){let K=N.getMinMaxForTile(q);K&&(G=K)}this.addShadowReceiver(q.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;let c=this.painter,f=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),f.viewport.set([0,0,Rn.shadowMapResolution,Rn.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){c.currentShadowCascade=_,f.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),f.clear({color:n.ao.white,depth:1});for(let x of t.order){let S=t._mergedLayers[x];if(!S.hasShadowPass()||S.isHidden(c.transform.zoom))continue;let E=t.getLayerSourceCache(S),P=E?o[E.id]:void 0;(S.type==="model"||P&&P.length)&&c.renderLayer(c,E,S,P)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,o=t.style,c=t.context,f=c.gl,_=o.directionalLight,x=o.ambientLight;if(!_||!x)return;let S=[],E=Zs(t,t.longestCutoffRange);E.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");let P=Do(o,_,x),M=new Rt(f.LEQUAL,Rt.ReadOnly,t.depthRangeFor3D),F=new ni({func:f.EQUAL,mask:255},0,255,f.KEEP,f.KEEP,f.KEEP);for(let O of this._groundShadowTiles){let N=O.toUnwrapped(),q=t.isTileAffectedByFog(O),G=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:q});this.setupShadows(N,G),t.uploadCommonUniforms(c,G,N,null,E);let K={u_matrix:t.transform.calculateProjMatrix(N),u_ground_shadow_factor:P};G.draw(t,f.TRIANGLES,M,F,vi.multiply,Jt.disabled,K,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?vi.unblended:vi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let o=this.painter.transform,c=o.calculatePosMatrix(t,o.worldSize);return n.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){let o=n.by(t);return n.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,t),o}setupShadows(t,o,c){if(!this.enabled)return;let f=this.painter.transform,_=this.painter.context,x=_.gl,S=this._uniformValues,E=new Float64Array(16),P=f.calculatePosMatrix(t,f.worldSize);for(let M=0;M<this._cascades.length;M++)n.aB(E,this._cascades[M].matrix,P),S[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(x.TEXTURE0+En.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){let M=n.d6(t.canonical),F=2/f.tileSize*n.al/Rn.shadowMapResolution,O=F*this._cascades[0].boundingSphereRadius,N=F*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(c==="vector-tile"?1:3)*(function(G,K,$,ee,se){let ie=n.aA((G-22)/-22,0,1);return .125*(1-ie)+4*ie})(f.zoom);S.u_shadow_normal_offset=[M,O*q,N*q],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(_,S)}setupShadowsFromMatrix(t,o,c=!1){if(!this.enabled)return;let f=this.painter.context,_=f.gl,x=this._uniformValues,S=new Float64Array(16);for(let E=0;E<Rn.cascadeCount;E++)n.aB(S,this._cascades[E].matrix,t),x[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),f.activeTexture.set(_.TEXTURE0+En.ShadowMap0+E),this._cascades[E].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=c,c){let E=Rn.normalOffset;x.u_shadow_normal_offset=[1,E,E],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(f,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,c,f){if(f[2]>=0)return{};let _=(function(E,P,M){let F=M/(1<<E.canonical.z);return new n.d8([E.canonical.x*F+E.wrap*M,E.canonical.y*F+E.wrap*M,0],[(E.canonical.x+1)*F+E.wrap*M,(E.canonical.y+1)*F+E.wrap*M,P])})(t,o,c).getCorners(),x=o/-f[2];f[0]<0?(n.d7(_[0],_[0],[f[0]*x,0,0]),n.d7(_[3],_[3],[f[0]*x,0,0])):f[0]>0&&(n.d7(_[1],_[1],[f[0]*x,0,0]),n.d7(_[2],_[2],[f[0]*x,0,0])),f[1]<0?(n.d7(_[0],_[0],[0,f[1]*x,0]),n.d7(_[1],_[1],[0,f[1]*x,0])):f[1]>0&&(n.d7(_[2],_[2],[0,f[1]*x,0]),n.d7(_[3],_[3],[0,f[1]*x,0]));let S={};return S.vertices=_,S.planes=[Ho(_[1],_[0],_[4]),Ho(_[2],_[1],_[5]),Ho(_[3],_[2],_[6]),Ho(_[0],_[3],_[7])],S}addShadowReceiver(t,o,c){this._receivers.add(t,n.d8.fromTileIdAndHeight(t,o,c))}getMaxCascadeForTile(t){let o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Ho(l,t,o){let c=n.av([],o,t),f=n.av([],l,t),_=n.bH([],c,f),x=n.ag(_);return x===0?[0,0,1,0]:(n.c4(_,_,1/x),[_[0],_[1],_[2],-n.bI(_,t)])}function xc(l){let t=l.properties.get("direction"),o=n.d3(t.x,t.y,t.z);o[2]=n.aA(o[2],0,75);let c=n.d5([o[0],o[1],o[2]]);return n.d4(c.x,c.y,c.z)}function Do(l,t,o){let c=t.properties.get("color-use-theme")==="none",f=t.properties.get("color"),_=t.properties.get("intensity"),x=t.properties.get("direction"),S=[x.x,x.y,x.z],E=o.properties.get("color-use-theme")==="none",P=o.properties.get("color"),M=o.properties.get("intensity"),F=Math.max(n.bI([0,0,1],S),0),O=[0,0,0];n.c4(O,P.toPremultipliedRenderColor(E?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),M);let N=[0,0,0];return n.c4(N,f.toPremultipliedRenderColor(c?null:l.getLut(o.scope)).toArray01Linear().slice(0,3),F*_),n.da([O[0]>0?O[0]/(O[0]+N[0]):0,O[1]>0?O[1]/(O[1]+N[1]):0,O[2]>0?O[2]/(O[2]+N[2]):0])}function Qu(l,t,o,c,f,_){let x=l.zoom,S=l.scale,E=l.worldSize,P=1/E,M=l.aspect,F=Math.sqrt(1+M*M)*Math.tan(.5*l.fovX),O=F*F,N=c-o,q=c+o,G,K;O>N/q?(G=c,K=c*F):(G=.5*q*(1+O),K=.5*Math.sqrt(N*N+2*(c*c+o*o)*O+q*q*O*O));let $=l.projection.pixelsPerMeter(l.center.lat,E),ee=l._camera.getCameraToWorldMercator(),se=[0,0,-G*P];n.af(se,se,ee);let ie=K*P,ge=l._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let nt=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?$:1),xt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,o,c);xt[8]=2*-l.centerOffset.x/l.width,xt[9]=2*l.centerOffset.y/l.height;let Dt=new Float64Array(16);n.cO(Dt,xt,nt);let ft=new Float64Array(16);n.bk(ft,Dt);let vt=n.cA.fromInvProjectionMatrix(ft,E,x,!0);for(let Ft of vt.points){let Lt=((ae=Ft)[0]/=S,ae[1]/=S,ae[2]=n.ce(ae[2],l._center.lat),ae);ie=Math.max(ie,n.c5(n.d9([],se,Lt)))}}var ae;ie*=f/(f-1);let ye=Math.acos(t[2]),pe=Math.atan2(-t[0],-t[1]),ue=new Qc;ue.position=se,ue.setPitchBearing(ye,pe);let ve=ue.getWorldToCamera(E,$),ze=ie*E,Ie=Math.min(l._mercatorZfromZoom(17)*E*-2,-2*ze),Ge=ue.getCameraToClipOrthographic(-ze,ze,-ze,ze,Ie,(ze+_*$)/t[2]),Be=new Float64Array(16);n.aB(Be,Ge,ve);let Ye=n.d4(Math.floor(1e6*se[0])/1e6*E,Math.floor(1e6*se[1])/1e6*E,0),gt=.5*f,De=[0,0,0];n.af(De,Ye,Be),n.c4(De,De,gt);let Ee=[Math.floor(De[0]),Math.floor(De[1]),Math.floor(De[2])],Ke=[0,0,0];n.av(Ke,De,Ee),n.c4(Ke,Ke,-1/gt);let Ne=new Float64Array(16);return n.bz(Ne),n.bq(Ne,Ne,Ke),n.aB(Be,Ne,Be),[Be,ze]}class tu extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return n.db(this.requestManager.transformRequest(o,n.R.Model).url).then((c=>{if(!c)return;let f=n.dc(c),_=new n.dd(t,o,void 0,void 0,f);return _.computeBoundsAndApplyParent(),_})).catch((c=>{if(c&&c.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${o}: ${c.message}`)))}))}load(t,o,c={forceReload:!1}){this.models[o]||(this.models[o]={});let f=Object.keys(t),_=[],x=[];for(let S of f){let E=t[S];this.hasURLBeenRequested(E)&&!c.forceReload||(this.modelByURL[E]={modelId:S,scope:o},_.push(this.loadModel(S,E)),x.push(S)),this.models[o][S]||(this.models[o][S]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+x.length,Promise.allSettled(_).then((S=>{for(let E=0;E<S.length;E++){let{status:P}=S[E];if(P==="rejected")continue;let{value:M}=S[E];this.models[o][x[E]]||(this.models[o][x[E]]={model:null,numReferences:1}),this.models[o][x[E]].model=M}this.numModelsLoading[o]-=x.length,this.fire(new n.z("data",{dataType:"style"}))})).catch((S=>{this.fire(new n.y(new Error(`Could not load models: ${S.message}`)))}))}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;let o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let f=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===f)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(f)){let{scope:_,modelId:x}=this.modelByURL[f];this.models[_][x].numReferences++}else this.modelUris[c][t]=f,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});let c=this.modelUris[o];for(let f in t)c[f]=this.requestManager.normalizeModelURL(t[f])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});let c={};for(let f of t)this.hasModel(f,o,{exactIdMatch:!0})||this.hasURLBeenRequested(f)?this.models[o][f].numReferences++:this.modelUris[o][f]&&!this.hasURLBeenRequested(f)?c[f]=this.modelUris[o][f]:!this.hasURLBeenRequested(f)&&n.de(f,!1)&&(this.modelUris[o][f]=this.requestManager.normalizeModelURL(f),c[f]=this.modelUris[o][f]);this.load(c,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,c=!1,f=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||f)){let _=this.modelUris[o][t];c||delete this.modelUris[o][t],delete this.modelByURL[_];let x=this.models[o][t].model;if(!x)return;delete this.models[o][t],x.destroy()}}destroy(){for(let t of Object.keys(this.models))for(let o of Object.keys(this.models[t])){let c=this.models[t][o].model;delete this.models[t][o],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(let c in this.models[o])this.models[o][c].model&&this.models[o][c].model.upload(t.context)}}let Da=n.a6.colorTheme,Ba=new n.a9({data:new n.aa(Da.data)});function jd(l){if(!l.metadata||!l.metadata.content_area)return;let t=n.o.devicePixelRatio,{left:o,top:c,width:f,height:_}=l.metadata.content_area,x=o*t,S=c*t;return[x,S,x+f*t,S+_*t]}function Vd(l){if(l)return l.map((([t,o])=>[t*n.o.devicePixelRatio,o*n.o.devicePixelRatio]))}class Ud{constructor(t,o,c){this.id=t,this.scope=o,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let t=new Map;if(!this.sourceCache.loaded())return t;let o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;let c=this.sourceCache.getSource();if(!(c instanceof Cn))return t;let f=o.map((x=>this.sourceCache.getTile(x))),_=c.getImages(f,Array.from(this.pendingRequests));for(let[x,S]of _)t.set(n.I.from({name:x,iconsetId:this.id}),S),this.pendingRequests.delete(x);for(let x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),t}}let Fa=(l,t)=>Z(l,t&&t.filter((o=>o.identifier!=="source.canvas"))),$s=n.aH(Ni,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),jl=n.aH(Ni,["setCenter","setZoom","setBearing","setPitch"]),iu=new Set(["background","sky","slot","custom"]),Vl={version:8,layers:[],sources:{}},ed={duration:300,delay:0};class Zo extends n.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},ed),this._buildingIndex=new pc(this),this.crossTileSymbolIndex=new pa,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=o.styleChanges||new zo,this.dispatcher=o.dispatcher?o.dispatcher:new n.D(n.dg(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new es(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.dh(t._requestManager,o.localFontFamily?n.di.all:o.localIdeographFontFamily?n.di.ideographs:n.di.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new tu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._indoorDependentLayers=o.indoorDependentLayers?o.indoorDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.dj());let c=this;this._rtlTextPluginCallback=Zo.registerForPluginStateChange((f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},((_,x)=>{if(n.dk(_),x&&x.every((S=>S)))for(let S in c._sourceCaches){let E=c._sourceCaches[S],P=E.getSource().type;P!=="vector"&&P!=="geojson"||E.reload()}}))})),this.on("data",(f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;let _=this.getOwnSource(f.sourceId);if(_&&_.vectorLayerIds)for(let x in this._layers){let S=this._layers[x];S.source===_.id&&this._validateLayer(S)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.h(t))return t;let o=n.dl(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.dm(JSON.stringify(t))}`}_diffStyle(t,o,c){this.globalId=this._getGlobalId(t);let f=(_,x)=>{try{x(null,this.setState(_,c))}catch(S){x(S,!1)}};if(typeof t=="string"){let _=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(_,n.R.Style);n.m(x,((S,E)=>{S?this.fire(new n.y(S)):E&&f(E,o)}))}else typeof t=="object"&&f(t,o)}loadURL(t,o={}){this.fire(new n.z("dataloading",{dataType:"style"}));let c=typeof o.validate=="boolean"?o.validate:!n.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);let f=this.importsCache.get(t);if(f)return this._load(f,c);let _=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.m(_,((x,S)=>{if(this._request=null,x)this.fire(new n.y(x));else if(S)return this.importsCache.set(t,S),this._load(S,c)}))}loadJSON(t,o={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.o.frame((()=>{this._request=null,this._load(t,o.validate!==!1)}))}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(Vl,!1)}_loadImports(t,o,c){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let f=[];for(let _ of t){let x=this._createFragmentStyle(_),S=new Promise((M=>{x.once("style.import.load",M),x.once("error",M)})).then((()=>this.mergeAll()));if(f.push(S),this.resolvedImports.has(_.url)){x.loadEmpty();continue}let E=_.data||this.importsCache.get(_.url);E?(x.loadJSON(E,{validate:o}),this._isInternalStyle(E)&&(x.globalId=null)):_.url?x.loadURL(_.url,{validate:o}):x.loadEmpty();let P={style:x,id:_.id,config:_.config};if(c){let M=this.fragments.findIndex((({id:F})=>F===c));this.fragments=this.fragments.slice(0,M).concat(P).concat(this.fragments.slice(M))}else this.fragments.push(P)}return Promise.allSettled(f)}getImportGlobalIds(t=this,o=new Set){for(let c of t.fragments)c.style.globalId&&o.add(c.style.globalId),this.getImportGlobalIds(c.style,o);return[...o.values()]}_createFragmentStyle(t){let o=this.scope?n.B(t.id,this.scope):t.id,c,f=this._initialConfig&&this._initialConfig[o];(t.config||f)&&(c=Object.assign({},t.config,f));let _=new Zo(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){let _=Object.assign({},Vl,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(_,o)}if(this.updateConfig(this._config,t.schema),o&&Fa(this,Wo(t)))return;this._loaded=!0,this.stylesheet=n.dn(t);let c=()=>{for(let E in t.sources)this.addSource(E,t.sources[E],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(let E in t.iconsets)this.addIconset(E,t.iconsets[E]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);let _=Ma(this.stylesheet.layers);if(this._order=_.map((E=>E.id)),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let E=this.stylesheet.lights[0];this.light=new Te(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Te(this.stylesheet.light)),this._layers={};for(let E of _){let P=n.dt(E,this.scope,this._styleColorTheme.lut,this.options);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),this._hasAppearances=this._hasAppearances||P.getAppearances().length!==0,P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;let M=this.getOwnLayerSourceCache(P),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&P.canCastShadows()&&F&&(M.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));let S=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then((()=>{this._reloadImports(),this.fire(new n.z(S?"style.load":"style.import.load"))})).catch((E=>{this.fire(new n.y(new Error("Failed to load imports",E))),this.fire(new n.z(S?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new n.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(f){let _=this._evaluateColorThemeData(f);this._loadColorTheme(_).then((()=>{c()})).catch((x=>{n.w(`Couldn't load color theme from the stylesheet: ${x}`),c()}))}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,o,c,f,_,x,S,E,P,M,F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((O=>{if(O.stylesheet){if(O.light!=null&&(t=O.light),O.stylesheet.lights)for(let N of O.stylesheet.lights)N.type==="ambient"&&O.ambientLight!=null&&(o=O.ambientLight),N.type==="directional"&&O.directionalLight!=null&&(c=O.directionalLight);f=this._prioritizeTerrain(f,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(_=O.fog),O.stylesheet.snow&&O.snow!=null&&(x=O.snow),O.stylesheet.rain&&O.rain!=null&&(S=O.rain),O.stylesheet.camera!=null&&(M=O.stylesheet.camera),O.stylesheet.projection!=null&&(E=O.stylesheet.projection),O.stylesheet.transition!=null&&(P=O.stylesheet.transition),F[O.scope]=O._styleColorTheme}})),this.light=t,this.ambientLight=o,this.directionalLight=c,this.fog=_,this.snow=x,this.rain=S,this._styleColorThemeForScope=F,f===null?delete this.terrain:this.terrain=f,this.camera=M||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=Object.assign({},ed,P),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){let o=c=>{for(let f of c.fragments)o(f.style);t(c)};o(this)}_prioritizeTerrain(t,o,c){let f=t&&t.drapeRenderMode===0;return c===null?o&&o.drapeRenderMode===0?o:f?t:null:o!=null&&(!t||f||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){let t={},o={},c={};this.forEachFragmentStyle((f=>{for(let _ in f._sourceCaches){let x=n.B(_,f.scope);t[x]=f._sourceCaches[_]}for(let _ in f._otherSourceCaches){let x=n.B(_,f.scope);o[x]=f._otherSourceCaches[_]}for(let _ in f._symbolSourceCaches){let x=n.B(_,f.scope);c[x]=f._symbolSourceCaches[_]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=c}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(let o of Object.values(t.stylesheet.indoor)){let c=o,f=n.B(c.sourceId,t.scope);this._mergedIndoor[f]=new Set(c.sourceLayers||[])}}))}mergeLayers(){let t={},o=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((x=>{for(let S of x._order){let E=x._layers[S];if(E.type==="slot"){let P=n.dp(S);if(t[P])continue;t[P]=[]}E.slot&&t[E.slot]?t[E.slot].push(E):o.push(E)}})),this._mergedOrder=[];let f=-1,_=(x=[])=>{for(let S of x)if(S.type==="slot"){let E=n.dp(S.id);t[E]&&_(t[E]),this._mergedSlots.push(E)}else{let E=n.B(S.id,S.scope);this._mergedOrder.push(E),c[E]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,f=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(_(o),this._has3DLayers){let x={};for(let S=0;S<this._mergedOrder.length;++S){let E=this._mergedOrder[S];x[E]=S===f?1:S<f?c[E].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((S,E)=>x[S]-x[E]))}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(o,c,f,_){let x=Object.assign({},c);for(let E of Object.keys(Da))x[E]===void 0&&(x[E]=Da[E].default);let S=new n.a8(Ba,o,new Map(f));return S.setTransitionOrValue(x,f),S.untransitioned().possiblyEvaluate(new n.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((c,f)=>{let _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let x=t;x.startsWith(_)||(x=_+x);let S=n.I.from("mapbox-reserved-lut"),E=new Image;E.src=x,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},E.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void c();this._styleColorTheme.lutLoading=!1;let{width:P,height:M,data:F}=n.o.getImageData(E);if(M>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==M*M)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new n.q({width:P,height:M},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});let O=this.imageManager.getImage(S,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:t},c()):f(new Error("Missing LUT image."))}}))}getLut(t){let o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(o,c,f){let _,x,S,E=n.o.devicePixelRatio>1?"@2x":"",P=n.m(c.transformRequest(c.normalizeSpriteURL(o,E,".json"),n.R.SpriteJSON),((O,N)=>{P=null,S||(S=O,_=N,F())})),M=n.n(c.transformRequest(c.normalizeSpriteURL(o,E,".png"),n.R.SpriteImage),((O,N)=>{M=null,S||(S=O,x=N,F())}));function F(){if(S)f(S);else if(_&&x){let O=n.o.getImageData(x),N={};for(let q in _){let{width:G,height:K,x:$,y:ee,sdf:se,pixelRatio:ie,stretchX:ge,stretchY:ae,content:ye}=_[q],pe=new n.q({width:G,height:K});n.q.copy(O,pe,{x:$,y:ee},{x:0,y:0},{width:G,height:K},null),N[q]={data:pe,pixelRatio:ie!==void 0?ie:1,sdf:se!==void 0&&se,stretchX:ge,stretchY:ae,content:ye,usvg:!1,version:0}}f(null,N)}}return{cancel(){P&&(P.cancel(),P=null),M&&(M.cancel(),M=null)}}})(t,this.map._requestManager,((o,c)=>{if(this._spriteRequest=null,o)this.fire(new n.y(o));else if(c){let f=new Map;for(let _ in c)f.set(n.I.from(_),c[_]);this.addImages(f)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))}))}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);let c=this.getOwnSourceCache(o.source);if(!c)return void this.fire(new n.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));let f=c.getSource();if(f.type!=="raster-array")return void this.fire(new n.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));f.partial=!1;let _=new Ud(t,this.scope,c);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);let o=this.map._spriteFormat==="auto";var c,f;this._spriteRequest=(f=(_,x)=>{if(this._spriteRequest=null,_)o?this._loadSprite(t):this.fire(new n.y(_));else if(x){let S=new Map;for(let E in x)S.set(n.I.from(E),x[E]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bt((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),n.R.Iconset),((_,x)=>{if(_)return void f(_);let S={},E=n.df(new n.bs(x));for(let P of E.icons){let M={version:1,pixelRatio:n.o.devicePixelRatio,content:jd(P),stretchX:P.metadata?Vd(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?Vd(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};S[P.name]=M}f(null,S)})))}_validateLayer(t){let o=this.getOwnSource(t.source);if(!o)return;let c=t.sourceLayer;c&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(c)===-1)&&this.fire(new n.y(new Error(`Source layer "${c}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,o)=>{let c=this.fragments[o];return c&&c.style&&(t.data=c.style.serialize()),t}))}_serializeSources(){let t={};for(let o in this._sourceCaches){let c=this._sourceCaches[o].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){let o=[];for(let c of t){let f=this._layers[c];f&&f.type!=="custom"&&o.push(f.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let o=this.getOwnLayer(t);if(o)return o;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let o=this.getOwnSource(t);if(o)return o;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){let c=this.map.painter;if(c)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){let _=t.getProgramIds();if(_)for(let x of _){let S=t.getDefaultProgramParams(x,o.zoom,this._styleColorTheme.lut);S&&(c.style=this,this.fog&&(c._fogVisible=!0,S.overrideFog=!0,c.getOrCreateProgram(x,S)),c._fogVisible=!1,S.overrideFog=!1,c.getOrCreateProgram(x,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,c.getOrCreateProgram(x,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));let c=this._changes.isDirty(),f=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let E in S){let{updatedIds:P,removedIds:M}=S[E];(P||M)&&(this._updateWorkerLayers(E,P,M),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}let _={};for(let S in this._mergedSourceCaches){let E=this._mergedSourceCaches[S];_[S]=E.used,E.used=!1,E.tileCoverLift=0}for(let S of this._mergedOrder){let E=this._mergedLayers[S];if(E.recalculate(t,this._availableImages),!E.isHidden(t.zoom)){let P=this.getLayerSourceCache(E);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,E.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(E,t)})):this.precompilePrograms(E,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();let x=this.imageManager.getPendingImageProviders();for(let S of x)S.sourceCache.used=!0;for(let S in _){let E=this._mergedSourceCaches[S];_[S]!==E.used&&E.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new n.z("data",{dataType:"style"}))}updateImageProviders(){let t=this.imageManager.getPendingImageProviders();for(let o of t){let c=o.resolvePendingRequests(),f=this.getFragmentStyle(o.scope);f&&f.addImages(c)}}_updateTilesForChangedImages(){let t={};for(let o in this._mergedSourceCaches){let c=this._mergedSourceCaches[o].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[c])}for(let o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,c){let f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:o?f._serializeLayers(o):[],scope:t,removedIds:c||[],options:f.options})}setState(t,o){if(this._checkLoaded(),Fa(this,Wo(t)))return!1;(t=n.dn(t)).layers=Ma(t.layers);let c=(function(x,S){if(!x)return[{command:Ni.setStyle,args:[S]}];let E=[];try{if(!n.bx(x.version,S.version))return[{command:Ni.setStyle,args:[S]}];if(n.bx(x.center,S.center)||E.push({command:Ni.setCenter,args:[S.center]}),n.bx(x.zoom,S.zoom)||E.push({command:Ni.setZoom,args:[S.zoom]}),n.bx(x.bearing,S.bearing)||E.push({command:Ni.setBearing,args:[S.bearing]}),n.bx(x.pitch,S.pitch)||E.push({command:Ni.setPitch,args:[S.pitch]}),n.bx(x.sprite,S.sprite)||E.push({command:Ni.setSprite,args:[S.sprite]}),n.bx(x.glyphs,S.glyphs)||E.push({command:Ni.setGlyphs,args:[S.glyphs]}),n.bx(x.imports,S.imports)||(function(N=[],q=[],G){q=q||[];let K=(N=N||[]).map(Pl),$=q.map(Pl),ee=N.reduce(Ja,{}),se=q.reduce(Ja,{}),ie=K.slice(),ge,ae,ye,pe;for(ge=0,ae=0;ge<K.length;ge++)ye=K[ge],se.hasOwnProperty(ye)?ae++:(G.push({command:Ni.removeImport,args:[ye]}),ie.splice(ie.indexOf(ye,ae),1));for(ge=0,ae=0;ge<$.length;ge++)ye=$[$.length-1-ge],ie[ie.length-1-ge]!==ye&&(ee.hasOwnProperty(ye)?(G.push({command:Ni.removeImport,args:[ye]}),ie.splice(ie.lastIndexOf(ye,ie.length-ae),1)):ae++,pe=ie[ie.length-ge],G.push({command:Ni.addImport,args:[se[ye],pe]}),ie.splice(ie.length-ge,0,ye));for(let ue of q){let ve=ee[ue.id];ve&&(delete ve.data,n.bx(ve,ue)||G.push({command:Ni.updateImport,args:[ue.id,ue]}))}})(x.imports,S.imports,E),n.bx(x.transition,S.transition)||E.push({command:Ni.setTransition,args:[S.transition]}),n.bx(x.light,S.light)||E.push({command:Ni.setLight,args:[S.light]}),n.bx(x.fog,S.fog)||E.push({command:Ni.setFog,args:[S.fog]}),n.bx(x.snow,S.snow)||E.push({command:Ni.setSnow,args:[S.snow]}),n.bx(x.rain,S.rain)||E.push({command:Ni.setRain,args:[S.rain]}),n.bx(x.projection,S.projection)||E.push({command:Ni.setProjection,args:[S.projection]}),n.bx(x.lights,S.lights)||E.push({command:Ni.setLights,args:[S.lights]}),n.bx(x.camera,S.camera)||E.push({command:Ni.setCamera,args:[S.camera]}),n.bx(x.iconsets,S.iconsets)||(function(N,q,G){let K;for(K in q=q||{},N=N||{})N.hasOwnProperty(K)&&(q.hasOwnProperty(K)||G.push({command:Ni.removeIconset,args:[K]}));for(K in q){if(!q.hasOwnProperty(K))continue;let $=q[K];N.hasOwnProperty(K)?n.bx(N[K],$)||(G.push({command:Ni.removeIconset,args:[K]}),G.push({command:Ni.addIconset,args:[K,$]})):G.push({command:Ni.addIconset,args:[K,$]})}})(x.iconsets,S.iconsets,E),!n.bx(x["color-theme"],S["color-theme"]))return[{command:Ni.setStyle,args:[S]}];let P={},M=[];(function(N,q,G,K){let $;for($ in q=q||{},N=N||{})N.hasOwnProperty($)&&(q.hasOwnProperty($)||bs($,G,K));for($ in q){if(!q.hasOwnProperty($))continue;let ee=q[$];N.hasOwnProperty($)?n.bx(N[$],ee)||(N[$].type==="geojson"&&ee.type==="geojson"&&Kc(N,q,$)?G.push({command:Ni.setGeoJSONSourceData,args:[$,ee.data]}):Il($,q,G,K)):Zn($,q,G)}})(x.sources,S.sources,M,P);let F=[];x.layers&&x.layers.forEach((N=>{N.source&&P[N.source]?E.push({command:Ni.removeLayer,args:[N.id]}):F.push(N)}));let O=x.terrain;O&&P[O.source]&&(E.push({command:Ni.setTerrain,args:[void 0]}),O=void 0),E=E.concat(M),n.bx(O,S.terrain)||E.push({command:Ni.setTerrain,args:[S.terrain]}),(function(N,q,G){q=q||[];let K=(N=N||[]).map(Pl),$=q.map(Pl),ee=N.reduce(Ja,{}),se=q.reduce(Ja,{}),ie=K.slice(),ge=Object.create(null),ae,ye,pe,ue,ve,ze,Ie;for(ae=0,ye=0;ae<K.length;ae++)pe=K[ae],se.hasOwnProperty(pe)?ye++:(G.push({command:Ni.removeLayer,args:[pe]}),ie.splice(ie.indexOf(pe,ye),1));for(ae=0,ye=0;ae<$.length;ae++)pe=$[$.length-1-ae],ie[ie.length-1-ae]!==pe&&(ee.hasOwnProperty(pe)?(G.push({command:Ni.removeLayer,args:[pe]}),ie.splice(ie.lastIndexOf(pe,ie.length-ye),1)):ye++,ze=ie[ie.length-ae],G.push({command:Ni.addLayer,args:[se[pe],ze]}),ie.splice(ie.length-ae,0,pe),ge[pe]=!0);for(ae=0;ae<$.length;ae++)if(pe=$[ae],ue=ee[pe],ve=se[pe],!ge[pe]&&!n.bx(ue,ve))if(n.bx(ue.source,ve.source)&&n.bx(ue["source-layer"],ve["source-layer"])&&n.bx(ue.type,ve.type)){for(Ie in fc(ue.layout,ve.layout,G,pe,null,Ni.setLayoutProperty),fc(ue.paint,ve.paint,G,pe,null,Ni.setPaintProperty),n.bx(ue.slot,ve.slot)||G.push({command:Ni.setSlot,args:[pe,ve.slot]}),n.bx(ue.filter,ve.filter)||G.push({command:Ni.setFilter,args:[pe,ve.filter]}),n.bx(ue.minzoom,ve.minzoom)&&n.bx(ue.maxzoom,ve.maxzoom)||G.push({command:Ni.setLayerZoomRange,args:[pe,ve.minzoom,ve.maxzoom]}),ue)ue.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?fc(ue[Ie],ve[Ie],G,pe,Ie.slice(6),Ni.setPaintProperty):n.bx(ue[Ie],ve[Ie])||G.push({command:Ni.setLayerProperty,args:[pe,Ie,ve[Ie]]}));for(Ie in ve)ve.hasOwnProperty(Ie)&&!ue.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?fc(ue[Ie],ve[Ie],G,pe,Ie.slice(6),Ni.setPaintProperty):n.bx(ue[Ie],ve[Ie])||G.push({command:Ni.setLayerProperty,args:[pe,Ie,ve[Ie]]}))}else G.push({command:Ni.removeLayer,args:[pe]}),ze=ie[ie.lastIndexOf(pe)+1],G.push({command:Ni.addLayer,args:[ve,ze]})})(F,S.layers,E)}catch(P){console.warn("Unable to compute style diff:",P),E=[{command:Ni.setStyle,args:[S]}]}return E})(this.serialize(),t).filter((x=>!(x.command in jl)));if(c.length===0)return!1;let f=c.filter((x=>!(x.command in $s)));if(f.length>0)throw new Error(`Unimplemented: ${f.map((x=>x.command)).join(", ")}.`);let _=[];return c.forEach((x=>{_.push(this[x.command](...x.args))})),o&&Promise.all(_).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(let[o,c]of t.entries()){if(this.getImage(o))return this.fire(new n.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,c),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new n.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this)}updateImage(t,o,c=!1){this.imageManager.updateImage(t,this.scope,o),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new n.z("data",{dataType:"style"})),this}addModel(t,o,c={}){return this._checkLoaded(),this._validate(kl,`models.${t}`,o,null,c)||(this.modelManager.addModel(t,o,this.scope),this.fire(new n.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Xc,`sources.${t}`,o,null,c))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let f=yo(t,o,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id})));let _=x=>{let S=(x?"symbol:":"other:")+f.id,E=n.B(S,this.scope),P=this._sourceCaches[S]=new Lr(E,f,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=P,P.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),f.onAdd&&f.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(let f in this._layers)if(this._layers[f].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let f=Object.entries(this.stylesheet.iconsets).find((([_,x])=>x.type==="source"&&x.source===t));if(f)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while iconset "${f[0]}" is using it.`)))}let c=this.getOwnSourceCaches(t);for(let f of c){let _=n.dp(f.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(f.id),f.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){let o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){let t=[];for(let o in this._otherSourceCaches){let c=this.getOwnSourceCache(o);c&&t.push(c.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let o in t){let c=t[o]._tiles;for(let f in c){let _=c[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let o=this._getTransitionParameters();for(let _ of t){if(this._validate(Zu,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(_),x.updateTransitions(o)}else this.ambientLight=new sn(_,mr||(mr=new n.a9({color:new n.aa(n.a6.properties_light_ambient.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(_),x.updateTransitions(o)}else this.directionalLight=new sn(_,Hr||(Hr=new n.a9({direction:new n.ap(n.a6.properties_light_directional.direction),color:new n.aa(n.a6.properties_light_directional.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_directional.intensity),"cast-shadows":new n.aa(n.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new n.aa(n.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.aa(n.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let c=Object.assign(o,{worldview:this.map.getWorldview()}),f=new n.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;let c=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),f=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),x=t.properties.get("direction"),S=1-n.d3(x.x,x.y,x.z)[2]/90,E=c(f)*_*S,P=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=o.properties.get("intensity"),F=c(P)*M;return Number(((E+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.dq(t)){let o=n.dr(t),c=this.fragments.find((({id:_})=>_===o));if(!c)return;let f=n.dp(t);return c.style.getFragmentStyle(f)}{let o=this.fragments.find((({id:c})=>c===t));return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;let o={},c=(f,_="")=>`${f}::${_}`;this._featuresetSelectors={};for(let f in t){let _=this._featuresetSelectors[f]=[];for(let x of t[f].selectors){if(x.featureNamespace){let E=this.getOwnLayer(x.layer);if(!E){n.w(`Layer is undefined for selector: ${x.layer}`);continue}let P=c(E.source,E.sourceLayer);if(P in o&&o[P]!==x.featureNamespace){n.w(`"featureNamespace ${x.featureNamespace} of featureset ${f}'s selector is not associated to the same source, skip this selector`);continue}o[P]=x.featureNamespace}let S;if(x.properties)for(let E in x.properties){let P=n.U(x.properties[E]);P.result==="success"&&(S=S||{},S[E]=P.value)}_.push({layerId:x.layer,namespace:x.featureNamespace,properties:S,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){let o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];let c=[];for(let f in o.stylesheet.featuresets)c.push({featuresetId:f,importId:o.scope?o.scope:void 0});return c}getFeaturesetLayers(t,o){let c=this.getFragmentStyle(o),f=c.stylesheet.featuresets;if(!f||!f[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];let _=[];for(let x of f[t].selectors){let S=c.getOwnLayer(x.layer);S&&_.push(S)}return _}getConfigProperty(t,o){let c=this.getFragmentStyle(t);if(!c)return null;let f=n.B(o,c.scope),_=c.options.get(f),x=_?_.value||_.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,o){let c=n.B(t,o);return this._mergedIndoor[c]}setIndoorData(t,o){this.map.indoor.setIndoorData(o)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,o,c){let f=this.getFragmentStyle(t);if(!f)return;let _=f.stylesheet.schema;if(!_||!_[o])return;let x=n.U(c);if(x.result!=="success")return void Fa(this,x.value);let S=x.value.expression,E=n.B(o,f.scope),P=f.options.get(E);if(!P)return;let M,{minValue:F,maxValue:O,stepValue:N,type:q,values:G}=_[o],K=n.U(_[o].default);K.result==="success"&&(M=K.value.expression),M?(this.options.set(E,Object.assign({},P,{value:S,default:M,minValue:F,maxValue:O,stepValue:N,type:q,values:G})),this.updateConfigDependencies(o)):this.fire(new n.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){let o=this.getFragmentStyle(t);if(!o)return null;let c=o.stylesheet.schema;if(!c)return null;let f={};for(let _ in c){let x=n.B(_,o.scope),S=o.options.get(x),E=S?S.value||S.default:null;f[_]=E?E.serialize():null}return f}setConfig(t,o){let c=this.getFragmentStyle(t);c&&(c.updateConfig(o,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){let c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=o,c.updateConfig(c._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(let c in o){let f,_,x=n.U(o[c].default);if(x.result==="success"&&(f=x.value.expression),t&&t[c]!==void 0){let O=n.U(t[c]);O.result==="success"&&(_=O.value.expression)}let{minValue:S,maxValue:E,stepValue:P,type:M,values:F}=o[c];if(f){let O=n.B(c,this.scope);this.options.set(O,{default:f,value:_,minValue:S,maxValue:E,stepValue:P,type:M,values:F})}else this.fire(new n.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,o=(()=>!0)){for(let c of t){let f=this.getLayer(c);f&&o(f)&&(f.possiblyEvaluateVisibility(),this._updateLayer(f),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(o=>!t||o.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((o=>{let c=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(c){let f=o._evaluateColorThemeData(c);(!o._styleColorTheme.lut&&f!==""||o._styleColorTheme.lut&&f!==o._styleColorTheme.lut.data)&&o.setColorTheme(c)}})),this._changes.setDirty()}addLayer(t,o,c={}){this._checkLoaded();let f=t.id;if(this._layers[f])return void this.fire(new n.y(new Error(`Layer with id "${f}" already exists on this map`)));let _;if(t.type==="custom"){if(Fa(this,n.ds(t)))return;_=n.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=n.dn(t),t=Object.assign(t,{source:f})),this._validate(dc,`layers.${f}`,t,{arrayIndex:-1},c))return;_=n.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}let x=n.B(_.source,_.scope);_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let S=this._order.length;if(o){let F=this._order.indexOf(o);if(F===-1)return void this.fire(new n.y(new Error(`Layer with id "${o}" does not exist on this map.`)));_.slot===this._layers[o].slot?S=F:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,f),this._layerOrderChanged=!0,this._layers[f]=_;let E=this.getOwnLayerSourceCache(_),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&_.canCastShadows()&&P&&(E.castsShadows=!0);let M=this._changes.getRemovedLayer(_);if(M&&_.source&&E&&_.type!=="custom"){this._changes.discardLayerRemoval(_);let F=n.B(_.source,_.scope);M.type!==_.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),E.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();let c=this._checkLayer(t);if(!c||t===o)return;let f=this._order.indexOf(t);this._order.splice(f,1);let _=this._order.length;if(o){let x=this._order.indexOf(o);if(x===-1)return void this.fire(new n.y(new Error(`Layer with id "${o}" does not exist on this map.`)));c.slot===this._layers[o].slot?_=x:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);let c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._indoorDependentLayers.delete(o.fqid),this._changes.removeLayer(o);let f=this.getOwnLayerSourceCache(o);if(f&&f.castsShadows){let _=!1;for(let x in this._layers)if(this._layers[x].source===o.source&&this._layers[x].canCastShadows()){_=!0;break}f.castsShadows=_}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,c){this._checkLoaded();let f=this._checkLayer(t);f&&(f.minzoom===o&&f.maxzoom===c||(o!=null&&(f.minzoom=o),c!=null&&(f.maxzoom=c),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();let c=this._checkLayer(t);c&&c.slot!==o&&(c.slot=o,this._updateLayer(c))}setFilter(t,o,c={}){this._checkLoaded();let f=this._checkLayer(t);if(f&&!n.bx(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(Bi,`layers.${f.id}.filter`,o,{layerType:f.type},c)||(f.filter=n.dn(o),this._updateLayer(f)))}getFilter(t){let o=this._checkLayer(t);if(o)return n.dn(o.filter)}setLayoutProperty(t,o,c,f={}){this._checkLoaded();let _=this._checkLayer(t);if(_&&!n.bx(_.getLayoutProperty(o),c)){if(c!=null&&(!f||f.validate!==!1)&&Fa(_,ki.call(Wo,{key:`layers.${t}.layout.${o}`,layerType:_.type,objectKey:o,value:c,styleSpec:n.a6,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(o,c),_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_.fqid),this._updateLayer(_)}}setLayerProperty(t,o,c,f={}){this._checkLoaded();let _=this._checkLayer(t);_&&(o==="appearances"?(_.setAppearances(c),this._changes.setDirty()):_.isPaintProperty(o)?this.setPaintProperty(t,o,c,f):this.setLayoutProperty(t,o,c,f))}getLayoutProperty(t,o){let c=this._checkLayer(t);if(c)return c.getLayoutProperty(o)}setPaintProperty(t,o,c,f={}){this._checkLoaded();let _=this._checkLayer(t);if(!_||n.bx(_.getPaintProperty(o),c)||c!=null&&(!f||f.validate!==!1)&&Fa(_,bn.call(Wo,{key:`layers.${t}.paint.${o}`,layerType:_.type,objectKey:o,value:c,styleSpec:n.a6})))return;let x=_.setPaintProperty(o,c);_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_.fqid),x&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,o){let c=this._checkLayer(t);if(c)return c.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){let{featuresetId:E,importId:P}=t.target,M=this.getFragmentStyle(P),F=M.getFeaturesetLayers(E);for(let{source:O,sourceLayer:N}of F)M.setFeatureState({id:t.id,source:O,sourceLayer:N},o)}else if("layerId"in t.target){let{layerId:E}=t.target,P=this.getLayer(E);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}let c=t.source,f=t.sourceLayer,_=this._checkSource(c);if(!_)return;let x=_.type;if(x==="geojson"&&f)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!f)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));let S=this.getOwnSourceCaches(c);for(let E of S)E.setFeatureState(f,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){let{featuresetId:E,importId:P}=t.target,M=this.getFragmentStyle(P),F=M.getFeaturesetLayers(E);for(let{source:O,sourceLayer:N}of F)M.removeFeatureState({id:t.id,source:O,sourceLayer:N},o)}else if("layerId"in t.target){let{layerId:E}=t.target,P=this.getLayer(E);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}let c=t.source,f=this._checkSource(c);if(!f)return;let _=f.type,x=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));let S=this.getOwnSourceCaches(c);for(let E of S)E.removeFeatureState(x,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){let{featuresetId:x,importId:S}=t.target,E=this.getFragmentStyle(S),P=E.getFeaturesetLayers(x);for(let{source:M,sourceLayer:F}of P){let O=E.getFeatureState({id:t.id,source:M,sourceLayer:F});if(O&&!_)_=O;else if(!n.bx(_,O))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){let{layerId:x}=t.target,S=this.getLayer(x);_=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return _}let o=t.source,c=t.sourceLayer,f=this._checkSource(o);if(f){if(f.type!=="vector"||c)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(c,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(c=>c!==void 0))}_updateFilteredLayers(t){for(let o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);let o=this.getLayerSourceCache(t),c=n.B(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[c]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let o=S=>this._mergedLayers[S].is3D(!!this.terrain),c=this.order,f={},_=[];for(let S=c.length-1;S>=0;S--){let E=c[S];if(o(E)){f[E]=S;for(let P of t){let M=P[E];if(M)for(let F of M)_.push(F)}}}_.sort(((S,E)=>E.intersectionZ-S.intersectionZ));let x=[];for(let S=c.length-1;S>=0;S--){let E=c[S];if(o(E))for(let P=_.length-1;P>=0;P--){let M=_[P].feature;if(M.layer&&f[M.layer.id]<S)break;x.push(M),_.pop()}else for(let P of t){let M=P[E];if(M)for(let F of M)x.push(F.feature)}}return x}queryRasterValue(t,o,c){let f=this.getOwnSource(t);return f?f.type!=="raster-array"?(this.fire(new n.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):f.queryRasterArrayValue(o,c):(this.fire(new n.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,c){let f;o&&!Array.isArray(o)&&o.filter&&(this._validate(Bi,"queryRenderedFeatures.filter",o.filter,null,o),f=n.b5(o.filter));let _={},x=M=>{if(iu.has(M.type))return;let F=this.getOwnLayerSourceCache(M),O=_[F.id]=_[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};M.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[M.fqid]=O.layers[M.fqid]||{styleLayer:M,targets:[]},O.layers[M.fqid].targets.push({filter:f})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(let M of o.layers){let F=this._layers[M];if(!F)return this.fire(new n.y(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(let M in this._layers)x(this._layers[M]);let S=this._queryRenderedFeatures(t,_,c),E=this._flattenAndSortRenderedFeatures(S),P=[];for(let M of E)n.dv(M.layer.id)===this.scope&&P.push(M);return P}queryRenderedFeatureset(t,o,c){let f;o&&!Array.isArray(o)&&o.filter&&(this._validate(Bi,"queryRenderedFeatures.filter",o.filter,null,o),f=n.b5(o.filter));let _="mock",x=[];if(o&&o.target)x.push(Object.assign({},o,{targetId:_,filter:f}));else{let M=this.getFeaturesetDescriptors();for(let F of M)x.push({targetId:_,filter:f,target:F});for(let{style:F}of this.fragments){let O=F.getFeaturesetDescriptors();for(let N of O)x.push({targetId:_,filter:f,target:N})}}let S=this.queryRenderedTargets(t,x,c),E=[],P=new Set;for(let M of S)for(let F of M.variants[_])Un(F,M,P)||E.push(new n.dw(M,F));return E}queryRenderedTargets(t,o,c){let f={},_=(S,E,P,M)=>{let F=f[E.id]=f[E.id]||{sourceCache:E,layers:{},has3DLayers:!1};if(F.layers[S.fqid]=F.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(F.has3DLayers=!0),!M)return P.uniqueFeatureID=!1,void F.layers[S.fqid].targets.push(P);F.layers[S.fqid].targets.push(Object.assign({},P,{namespace:M.namespace,properties:M.properties,uniqueFeatureID:M.uniqueFeatureID}))};for(let S of o)if("featuresetId"in S.target){let{featuresetId:E,importId:P}=S.target,M=this.getFragmentStyle(P);if(!M||!M._featuresetSelectors)continue;let F=M._featuresetSelectors[E];if(!F){this.fire(new n.y(new Error(`The featureset '${E}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let O of F){let N=M.getOwnLayer(O.layerId);N&&!iu.has(N.type)&&_(N,M.getOwnLayerSourceCache(N),S,O)}}else if("layerId"in S.target){let{layerId:E}=S.target,P=this.getLayer(E);if(!P||iu.has(P.type))continue;_(P,this.getLayerSourceCache(P),S)}let x=this._queryRenderedFeatures(t,f,c);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,o,c){let f=[],_=!!this.map._showQueryGeometry,x=Ki.createFromScreenPoints(t,c);for(let S in o){let E=Zr(x,o[S],this._availableImages,c,_);Object.keys(E).length&&f.push(E)}if(this.placement)for(let S in o){if(!o[S].sourceCache._onlySymbols)continue;let E=qs(x.screenGeometry,o[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(E).length&&f.push(E)}return f}querySourceFeatures(t,o){let c=o&&o.filter;c&&this._validate(Bi,"querySourceFeatures.filter",c,null,o);let f=[],_=this.getOwnSourceCaches(t);for(let x of _)f=f.concat(aa(x,o));return f}addSourceType(t,o,c){return Zo.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Zo.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,c={}){this._checkLoaded();let f=this.light.getLight(),_=!1;for(let S in t)if(!n.bx(t[S],f[S])){_=!0;break}if(!_)return;let x=this._getTransitionParameters();this.light.setLight(t,o,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t,f=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){let S="terrain-dem-src";this.addSource(S,c.source),c=n.dn(c),c=Object.assign(c,{source:S})}let _=Object.assign({},c),x={};if(this.terrain&&f){_.source=this.terrain.get().source;let S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(x.style=S.serialize())}if(this._validate(Al,"terrain",_,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&o!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,o),this.fire(new n.z("data",{dataType:"style"}))}else{let _=this.terrain,x=_.get();for(let S of Object.keys(n.a6.terrain))!c.hasOwnProperty(S)&&n.a6.terrain[S].default&&(c[S]=n.a6.terrain[S].default);for(let S in t)if(!n.bx(t[S],x[S])){_.set(t,this.options),this.stylesheet.terrain=t;let E=this._getTransitionParameters({duration:0});_.updateTransitions(E),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let o=this.fog=new Zt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}_createSnow(t){let o=this.snow=new un(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}_createRain(t){let o=this.rain=new dn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(let t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let o=this.fog;if(!n.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let o=this.snow;if(!n.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let o=this.rain;if(!n.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){let t=()=>{for(let f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(let f in this._sourceCaches)this._sourceCaches[f].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();let c=this._evaluateColorThemeData(o);this._loadColorTheme(c).then((()=>{this.fire(new n.z("colorthemeset")),t()})).catch((f=>{n.w(`Couldn't set color theme: ${f}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){let c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=o,c._reloadColorTheme())}_getTransitionParameters(t){return{now:n.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],o=[];for(let c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):o.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){let c=this.terrain=new ke(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_force3DLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,c,f,_={}){if(_&&_.validate===!1)return!1;let x=Object.assign({},this.serialize());return Fa(this,t.call(Wo,Object.assign({key:o,style:x,value:c,styleSpec:n.a6},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){let o=this.getSourceCaches(t);for(let c of o)c.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(let t in this._mergedLayers){let o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){let o=this.getSourceCaches(t);for(let c of o)c.resume(),c.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let o;this.directionalLight&&(o=xc(this.directionalLight));let c=new Set;for(let f in this._mergedLayers){let _=this._mergedLayers[f];_.hasElevation()&&!c.has(_.source)&&c.add(_.source)}for(let f in this._mergedSourceCaches){let _=this._mergedSourceCaches[f],x=c.has(_._source.id);_.update(t,void 0,void 0,o,x)}}_generateCollisionBoxes(){for(let t in this._sourceCaches){let o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,c,f,_,x,S=!1){let E=!1,P=!1,M={},F={};for(let O of this._mergedOrder){let N=this._mergedLayers[O];if(N.type!=="symbol")continue;let q=n.B(N.source,N.scope),G=M[q];if(!G){let $=this.getLayerSourceCache(N);if(!$)continue;let ee=$.getRenderableIds(!0).map((se=>$.getTileByID(se)));F[q]=ee.slice(),G=M[q]=ee.sort(((se,ie)=>ie.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(ie.tileID)?-1:1)))}let K=this.crossTileSymbolIndex.addLayer(N,G,o.center.lng,o.projection);E=E||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.o.now(),o.zoom))&&(this.pauseablePlacement=new Io(o,this._mergedOrder,S,c,f,_,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.o.now()),P=!0),E&&this.pauseablePlacement.placement.setStale()),P||E){this._buildingIndex.onNewFrame(o.zoom);for(let O=0;O<this._mergedOrder.length;O++){let N=this._mergedLayers[this._mergedOrder[O]];if(N.type!=="symbol")continue;let q=this.isLayerClipped(N);this.placement.updateLayerOpacities(N,M[n.B(N.source,N.scope)],O,q?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.o.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();let c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex((({id:_})=>_===t.id))!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return c.push(t),this._loadImports([t],!0);let f=c.findIndex((({id:_})=>_===o));return f===-1&&this.fire(new n.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,f).concat(t).concat(c.slice(f)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==c[f].url&&this.setImportUrl(t,o.url),n.bx(o.config,c[f].config)||this.setImportConfig(t,o.config,o.data.schema),n.bx(o.data,c[f].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;let _=this.getImportIndex(o);if(_===-1)return this;let x=c[f],S=this.fragments[f];return c=c.filter((({id:E})=>E!==t)),this.fragments=this.fragments.filter((({id:E})=>E!==t)),this.stylesheet.imports=c.slice(0,_).concat(x).concat(c.slice(_)),this.fragments=this.fragments.slice(0,_).concat(S).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();let c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;c[f].url=o;let _=this.fragments[f];return _.style=this._createFragmentStyle(c[f]),_.style.on("style.import.load",(()=>this.mergeAll())),_.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();let c=this.getImportIndex(t),f=this.stylesheet.imports||[];return c===-1?this:o?(this.fragments[c].style.setState(o),this._reloadImports(),this):(delete f[c].data,this.setImportUrl(t,f[c].url))}setImportConfig(t,o,c){this._checkLoaded();let f=this.getImportIndex(t),_=this.stylesheet.imports||[];if(f===-1)return this;o?_[f].config=o:delete _[f].config;let x=this.fragments[f];c&&x.style.stylesheet&&(x.style.stylesheet.schema=c);let S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=o,x.style.updateConfig(o,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let o=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(o.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){let o=(this.stylesheet.imports||[]).findIndex((c=>c.id===t));return o===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let o in this._mergedOtherSourceCaches){let c=this._mergedOtherSourceCaches[o];c&&t.push(c.getSource())}return t}getSource(t,o){let c=this.getSourceCache(t,o);return c&&c.getSource()}getLayerSource(t){let o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){let c=n.B(t,o);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){let o=n.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let o in t){let c=t[o];c==="reload"?this.reloadSource(o):c==="clear"&&this.clearSource(o)}}updateLayers(t){let o=this._changes.getUpdatedPaintProperties();for(let c of o){let f=this.getLayer(c);f&&f.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,c){this.imageManager.getImages(o.images,o.scope,c),this._updateTilesForChangedImages();let f=x=>{if(x){let S=o.images.map((E=>n.I.toString(E)));x.setDependencies(o.tileID.key,o.type,S)}},_=n.B(o.source,o.scope);f(this._mergedOtherSourceCaches[_]),f(this._mergedSymbolSourceCaches[_]),o.images.some((x=>x.iconsetId))&&this.fire(new n.z("data",{dataType:"style"}))}rasterizeImages(t,o,c){this.imageManager.rasterizeImages(o,c)}getGlyphs(t,o,c){this.glyphManager.getGlyphs(o.stacks,c)}getResource(t,o,c){return n.dy(o,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){let o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):o.every((c=>c.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;let c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),f=t.type==="building";if(t.is3D(!!this.terrain)){if(c||f||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zo.getSourceType=function(l){return Pn[l]},Zo.setSourceType=function(l,t){Pn[l]=t},Zo.registerForPluginStateChange=n.dz;class il extends n.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},n.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(let[o,c]of Object.entries(t.buildings))if(this._buildings[o])for(let f of c.floorIds)this._buildings[o].floors[f]||(this._buildings[o].floors[f]=c.floors[f]);else this._buildings[o]=c;for(let o of t.activeFloors)this._activeFloors.add(o);this._updateIndoorSelector()}getIndoorTileOptions(t,o){let c=this._style.getIndoorSourceLayers(t,o);return c&&this._indoorState?{sourceLayers:c,indoorState:this._indoorState}:null}_updateUI(t,o,c){let f=(function(_,x,S,E){let P=null,M=Number.MAX_SAFE_INTEGER;if(E<16)return null;for(let[F,O]of Object.entries(_)){let N=O.center;if(N){let q=x.distanceTo(n.aS.convert(N));q<M&&S.contains(N)&&(M=q,P=F)}}return P})(this._buildings,o,c,t);f!==this._closestBuildingId&&(this._closestBuildingId=f,this._updateIndoorSelector())}_updateIndoorSelector(){let t=this._buildings,o=this._closestBuildingId,c=o&&t?t[o]:void 0;if(!c)return void this.fire(new n.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let f=null;for(let x of c.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){f=x;break}let _=Array.from(c.floorIds).map((x=>({id:x,name:c.floors[x].name,zIndex:c.floors[x].zIndex}))).sort(((x,S)=>S.zIndex-x.zIndex));this.fire(new n.z("selector-update",{selectedFloorId:f,activeFloorsVisible:this._activeFloorsVisible,floors:_}))}_updateActiveFloors(){let t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var ma=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,td=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Na=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,rl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,id=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,as=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Bo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ht=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,rd=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let ga=[];$o(ma,ga),$o(Na,ga),$o(td,ga);let Xs={"_prelude_fog.vertex.glsl":id,"_prelude_terrain.vertex.glsl":nl,"_prelude_shadow.vertex.glsl":ht,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":as,"_prelude_shadow.fragment.glsl":rd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Bo,"_prelude_raster_particle.glsl":bc},Ul={};Pi("",nl),Pi(as,id),Pi(rd,ht),Pi(Bo,""),Pi(bc,"");let ql=Pi(td,Na),Ys=ma;var wc={background:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Pi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Pi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Pi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Pi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Pi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Pi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Pi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Pi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Pi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Pi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Pi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Pi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Pi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Pi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Pi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Pi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rl),skyboxGradient:Pi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rl),skyboxCapture:Pi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Pi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Pi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Pi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Pi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Pi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Pi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Pi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Pi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function $o(l,t){let o=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of o)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let f=c.split(" ");for(let _ of f)t.includes(_)||t.push(_)}}function Pi(l,t){let o=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,f={},_=[],x=[];if(l=l.replace(o,((E,P)=>(x.push(P),""))),(t=t.replace(o,((E,P)=>(_.push(P),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...ga];$o(l,S),$o(t,S);for(let E of[..._,...x])Xs[E]||console.error(`Undefined include: ${E}`),Ul[E]||(Ul[E]=[],$o(Xs[E],Ul[E])),S=[...S,...Ul[E]];return{fragmentSource:l=l.replace(c,((E,P,M,F,O)=>(f[O]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${M} ${F} ${O};
#else
uniform ${M} ${F} u_${O};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${M} ${F} ${O} = u_${O};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${M} ${F} ${O};
#endif
`:P==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(c,((E,P,M,F,O)=>{let N=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,q=F==="float"?"vec2":F,G=`GET_ATTRIBUTE_${q}(a_${O}, materialInfo, ${N})`,K=O.match(/color/)?"color":q;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${M} ${F} a_${O};
#endif
`:f[O]?P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${N})
        in ${M} ${q} a_${O};
    #endif
out ${M} ${F} ${O};
#else
uniform ${M} ${F} u_${O};
#endif
`:P==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${M} ${F} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O}) 
    #ifdef ${N}
        ${O} = unpack_mix_${K}(${G}, u_${O}_t);
    #else
        ${O} = unpack_mix_${K}(a_${O}, u_${O}_t);
    #endif
#else
    ${M} ${F} ${O} = u_${O};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${M} ${F} a_${O};
    out ${M} ${F} ${O};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${N})
        in ${M} ${q} a_${O};
    #endif  
#else
uniform ${M} ${F} u_${O};
#endif
`:P==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${M} ${F} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${q} a_${O};
#else
uniform ${M} ${F} u_${O};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${M} ${F} ${O} = a_${O};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${N}
        ${M} ${F} ${O} = ${G};
    #else
        ${M} ${F} ${O} = a_${O};
    #endif
#else
    ${M} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${N}
        ${M} ${F} ${O} = unpack_mix_${K}(${G}, u_${O}_t);
    #else
        ${M} ${F} ${O} = unpack_mix_${K}(a_${O}, u_${O}_t);
    #endif
#else
    ${M} ${F} ${O} = u_${O};
#endif
`})),usedDefines:S,vertexIncludes:_,fragmentIncludes:x}}class ol{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,c,f,_,x,S,E){this.context=t;let P=this.boundPaintVertexBuffers.length!==f.length;for(let F=0;!P&&F<f.length;F++)this.boundPaintVertexBuffers[F]!==f[F]&&(P=!0);let M=this.boundDynamicVertexBuffers.length!==S.length;for(let F=0;!M&&F<S.length;F++)this.boundDynamicVertexBuffers[F]!==S[F]&&(M=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==c||P||M||this.boundIndexBuffer!==_||this.boundVertexOffset!==x)this.freshBind(o,c,f,_,x,S,E);else{t.bindVertexArrayOES.set(this.vao);for(let F of S)F&&(F.bind(),E&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,o,E));_&&_.dynamicDraw&&_.bind()}}freshBind(t,o,c,f,_,x,S){let E=this.context,P=E.gl;this.vao&&this.destroy(),this.vao=E.gl.createVertexArray(),E.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=x,o.enableAttributes(P,t),o.bind(),o.setVertexAttribPointers(P,t,_);for(let M of c)M.enableAttributes(P,t),M.bind(),M.setVertexAttribPointers(P,t,_);for(let M of x)M&&(M.enableAttributes(P,t),M.bind(),M.setVertexAttribPointers(P,t,_),S&&M.instanceCount&&M.setVertexAttribDivisor(P,t,S));f&&f.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qd(l,t){let o=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new n.ae(0,c/o).toLngLat().lat,new n.ae(0,(c+1)/o).toLngLat().lat]}function zp(l,t,o,c,f,_,x){let S=l.context,E=S.gl,P=o.hillshadeFBO;if(!P)return;l.prepareDrawTile();let M=l.isTileAffectedByFog(t),F=l.getOrCreateProgram("hillshade",{overrideFog:M});S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.colorAttachment.get());let O=((K,$,ee,se)=>{let ie=ee.paint.get("hillshade-shadow-color"),ge=ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ae=ee.paint.get("hillshade-highlight-color"),ye=ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pe=ee.paint.get("hillshade-accent-color"),ue=ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ve=ee.paint.get("hillshade-emissive-strength"),ze=n.an(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")ze-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){let Ge=K.style.directionalLight.properties.get("direction"),Be=n.d3(Ge.x,Ge.y,Ge.z);ze=n.an(Be[1])}let Ie=!K.options.moving;return{u_matrix:se||K.transform.calculateProjMatrix($.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:qd(0,$.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ze],u_shadow:ie.toPremultipliedRenderColor(ge?null:ee.lut),u_highlight:ae.toPremultipliedRenderColor(ye?null:ee.lut),u_emissive_strength:ve,u_accent:pe.toPremultipliedRenderColor(ue?null:ee.lut)}})(l,o,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(S,F,t.toUnwrapped());let{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:G}=l.getTileBoundsBuffers(o);F.draw(l,E.TRIANGLES,f,_,x,Jt.disabled,O,c.id,N,q,G)}function Sc(l,t,o){if(!t.needsDEMTextureUpload)return;let c=l.context,f=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(o.stride);let _=o.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new n.T(c,_,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Wd(l,t,o){let c=l.context,f=c.gl;if(!t.dem)return;let _=t.dem;if(c.activeTexture.set(f.TEXTURE1),Sc(l,t,_),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);let x=_.dim;c.activeTexture.set(f.TEXTURE0);let S=t.hillshadeFBO;if(!S){let O=new n.T(c,{width:x,height:x,data:null},f.RGBA8);O.bind(f.LINEAR,f.CLAMP_TO_EDGE),S=t.hillshadeFBO=c.createFramebuffer(x,x,!0,"renderbuffer"),S.colorAttachment.set(O.texture)}c.bindFramebuffer.set(S.framebuffer),c.viewport.set([0,0,x,x]);let{tileBoundsBuffer:E,tileBoundsIndexBuffer:P,tileBoundsSegments:M}=l.getMercatorTileBoundsBuffers(),F=[];l.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(l,f.TRIANGLES,Rt.disabled,ni.disabled,vi.unblended,Jt.disabled,((O,N)=>{let q=N.stride,G=n.bB();return n.cd(G,0,n.al,-n.al,0,0,1),n.bq(G,G,[0,-n.al,0]),{u_matrix:G,u_image:1,u_dimension:[q,q],u_zoom:O.overscaledZ}})(t.tileID,_),o.id,E,P,M),t.needsHillshadePrepare=!1}class Xr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class m extends Xr{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class C extends Xr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class z extends Xr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class U extends Xr{getDefault(){return[!0,!0,!0,!0]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Q extends Xr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class fe extends Xr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ve extends Xr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ut extends Xr{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wt extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ut extends Xr{getDefault(){return[0,1]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class fi extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Vi extends Xr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vr extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class lo extends Xr{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class In extends Xr{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class co extends Xr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class eo extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Cs extends Xr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Gd extends Xr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let nd=class extends Xr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Hd extends Xr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class sl extends Xr{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ru extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Tc extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Dn extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class al extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cc extends Xr{getDefault(){return null}set(t){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zd extends Xr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class $d extends Xr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class nu extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ll extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ou extends Xr{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class $y extends ou{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Xm extends ou{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Xy extends ou{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mp extends Xm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let Op=(l,t,o)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),Xd=(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:o,u_zoom_transition:f,u_merc_center:_,u_image0:0,u_frustum_tl:x,u_frustum_tr:S,u_frustum_br:E,u_frustum_bl:P,u_globe_pos:M,u_globe_radius:F,u_viewport:O,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:q});function Yd(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}let Ec=new class{constructor(){this.operations={}}newMorphing(l,t,o,c,f){if(l in this.operations){let _=this.operations[l];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[l]={startTime:c,phase:0,duration:f,from:t,to:o,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;let t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(let t in this.operations){let o=this.operations[t];for(o.phase=(l-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Rp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ym(l,t,o){if(t===0)return 0;let c=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function od(l,t){let o=1<<l.z;return!t&&(l.x===0||l.x===o-1)||l.y===0||l.y===o-1}let Ac=l=>({u_matrix:l});function Kd(l,t,o,c,f){if(f>0){let _=n.o.now(),x=(_-l.timeAdded)/f,S=t?(_-t.timeAdded)/f:-1,E=o.getSource(),P=c.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(l.tileID.overscaledZ-P),F=M&&l.refreshedUponExpiration?1:n.aA(M?x:1-S,0,1);return t?{opacity:1,mix:1-F,isFading:x<1}:{opacity:F,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class Es extends Lr{constructor(t){let o=yo("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Dp extends Lr{constructor(t){let o=yo("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,c){if(t.freezeTileCoverage)return;this.transform=t;let f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){let S=new rs(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[x.key]=S}return _}),{});for(let _ in this._tiles)_ in f||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){let o=this.proxyCachedFBO[t];if(o!==void 0){let c=Object.values(o);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sd extends n.aP{constructor(t,o,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=c}}class ad extends n.bU{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[c,f,_]=(function(E){let P=new n.bc,M=new n.b0,F=131;P.reserve(17161),M.reserve(33800);let O=n.al/128,N=n.al+O/2,q=N+O;for(let K=-O;K<q;K+=O)for(let $=-O;$<q;$+=O){let ee=$<0||$>N||K<0||K>N?24575:0,se=n.aA(Math.round($),0,n.al),ie=n.aA(Math.round(K),0,n.al);P.emplaceBack(se+ee,ie)}let G=(K,$)=>{let ee=$*F+K;M.emplaceBack(ee+1,ee,ee+F),M.emplaceBack(ee+F,ee+F+1,ee+1)};for(let K=1;K<129;K++)for(let $=1;$<129;$++)G($,K);return[0,129].forEach((K=>{for(let $=0;$<130;$++)G($,K),G(K,$)})),[P,M,32768]})(),x=t.context;this.gridBuffer=x.createVertexBuffer(c,n.be.members),this.gridIndexBuffer=x.createIndexBuffer(f),this.gridSegments=n.bf.simpleSegment(0,0,c.length,f.length),this.gridNoSkirtSegments=n.bf.simpleSegment(0,0,c.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dp(o.map),this.orthoMatrix=n.bB(),n.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.al,0,n.al,0,1);let S=x.gl;this._overlapStencilMode=new ni({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Es(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,o,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let f=t.terrain.properties,_=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.o.now();let S=t.terrain&&t.terrain.scope,E=f.get("source"),P=_?this._mockSourceCache:t.getSourceCache(E,S);if(!P)return void n.w(`Couldn't find terrain source "${E}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(o):f.get("exaggeration"),!o.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let M=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(o,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),o.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);let o=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;let f=o!=null?c-o:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;let _=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(_);let S=_-this._previousZoom,E=this._previousUpdateTimestamp,P=_;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(_-P)>.5&&(S=.5*(_-P+S)),S*f<0&&(P+=S)),this._evaluationZoom=P;let M=x.getExaggeration(P),F=M===x.getExaggeration(Math.max(0,P-.1));if(F&&Math.abs(M-this._exaggeration)<.01)return M;let O=Math.min(.1,.00375*(this._updateTimestamp-E));return(F||M<.1||Math.abs(S)<1e-4)&&(O=Math.min(.2,4*O)),n.ak(this._exaggeration,M,O)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let o=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(n.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let f=this.proxyCoords=o.getIds().map((E=>{let P=o.getTileByID(E).tileID;return P.projMatrix=c.calculateProjMatrix(P.toUnwrapped()),P}));(function(E,P){let M=P.transform.pointCoordinate(P.transform.getCameraPoint()),F=new n.P(M.x,M.y);E.sort(((O,N)=>{if(N.overscaledZ-O.overscaledZ)return N.overscaledZ-O.overscaledZ;let q=new n.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),G=new n.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),K=F.mult(1<<O.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(q)-K.distSqr(G)}))})(f,this.painter);let _=this.proxyToSource||{};this.proxyToSource={},f.forEach((E=>{this.proxyToSource[E.key]={}})),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let E in x){let P=x[E];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[E],_),P.usedForTerrain))continue;let M=t[E];P.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[o.id]=f.map((E=>new sd(E,E.key,this.orthoMatrix))),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;let S={};this._visibleDemTiles=[];for(let E of this.proxyCoords){let P=this.terrainTileForTile[E.key];if(!P)continue;let M=P.tileID.key;M in S||(this._visibleDemTiles.push(P),S[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach((o=>{if(this.terrainTileForTile[o.key])return;let c=this._findTileCoveringTileID(o,this.sourceCache);c&&(this.terrainTileForTile[o.key]=c)}))}_prepareDEMTextures(){let t=this.painter.context,o=t.gl;for(let c in this.terrainTileForTile){let f=this.terrainTileForTile[c],_=f.dem;!_||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Sc(this.painter,f,_))}}_prepareDemTileUniforms(t,o,c,f){if(!o||o.demTexture==null)return!1;let _=t.tileID.canonical,x=Math.pow(2,o.tileID.canonical.z-_.z),S=f||"";return c[`u_dem_tl${S}`]=[_.x*x%1,_.y*x%1],c[`u_dem_scale${S}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,o=this._visibleDemTiles.reduce(((c,f)=>{if(!f.dem)return c;let _=f.dem.tree.minimums[0];return _>0&&t++,c+_}),0);return t?o/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);let c=this._getLoadedAreaMinimum(),f=new n.dK({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(f,{premultiply:!1}):_=this._emptyDEMTexture=new n.T(t,f,o.R32F,{premultiply:!1}),_}setupElevationDraw(t,o,c){let f=this.painter.context,_=f.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let S=null,E=null,P=1;if(c&&c.morphing&&this._useVertexMorphing){let N=c.morphing.srcDemTile,q=c.morphing.dstDemTile;P=c.morphing.phase,N&&q&&(this._prepareDemTileUniforms(t,N,x,"_prev")&&(E=N),this._prepareDemTileUniforms(t,q,x)&&(S=q))}let M=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST,F=null;var O;if(this.enabled?E&&S?(F=S.demTexture,f.activeTexture.set(_.TEXTURE4),E.demTexture.bind(M(E),_.CLAMP_TO_EDGE),x.u_dem_lerp=P):(S=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,S,x)?S.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,f.activeTexture.set(_.TEXTURE2),F&&(x.u_dem_size=(O=F).size[0]===1?1:O.size[0]-2,F.bind(M(S),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,o,x),c&&c.useMeterToDem&&S){let N=(1<<S.tileID.canonical.z)*n.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=N}if(c&&c.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),o.setTerrainUniformValues(f,x),this.painter.transform.projection.name==="globe"){let N=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);o.setGlobeUniformValues(f,N)}}globeUniformValues(t,o,c){let f=t.projection;return{u_tile_tl_up:f.upVector(o,0,0),u_tile_tr_up:f.upVector(o,n.al,0),u_tile_br_up:f.upVector(o,n.al,n.al),u_tile_bl_up:f.upVector(o,0,n.al),u_tile_up_scale:c?n.dL(1):f.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let o=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(f,_,x,S,E){if(f.transform.projection.name==="globe")(function(P,M,F,O,N){let q=P.context,G=q.gl,K,$,ee=P.transform,se=n.dD(P,q,ee),ie=(Ge,Be)=>{if($===Be)return;let Ye=[Rp[Be],"PROJECTION_GLOBE_VIEW"];se&&Ye.push("CUSTOM_ANTIALIASING");let gt=P.isTileAffectedByFog(Ge);K=P.getOrCreateProgram("globeRaster",{defines:Ye,overrideFog:gt}),$=Be},ge=P.colorModeForRenderPass(),ae=new Rt(G.LEQUAL,Rt.ReadWrite,P.depthRangeFor3D);Ec.update(N);let ye=n.dE(ee),pe=[n.aF(ee.center.lng),n.aJ(ee.center.lat)],ue=P.globeSharedBuffers,ve=[ee.width*n.o.devicePixelRatio,ee.height*n.o.devicePixelRatio],ze=Float32Array.from(ee.globeMatrix),Ie={useDenormalizedUpVectorScale:!0};{let Ge=P.transform,Be=Ym(Ge.zoom,M.exaggeration(),M.sourceCache._source.tileSize);$=-1;let Ye=G.TRIANGLES;for(let gt of O){let De=F.getTile(gt),Ee=ni.disabled,Ke=M.prevTerrainTileForTile[gt.key],Ne=M.terrainTileForTile[gt.key];Yd(Ke,Ne)&&Ec.newMorphing(gt.key,Ke,Ne,N,250),q.activeTexture.set(G.TEXTURE0),De.texture&&De.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let nt=Ec.getMorphValuesForProxy(gt.key),xt=nt?1:0;nt&&Object.assign(Ie,{morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:n.dC(nt.phase)}});let Dt=n.dF(gt.canonical),ft=n.dG(Dt.getCenter().lat),vt=n.dH(gt.canonical,Dt,ft,Ge.worldSize/Ge._pixelsPerMercatorPixel),Ft=n.bj(n.dI(gt.canonical)),Lt=Xd(Ge.expandedFarZProjMatrix,ze,ye,Ft,n.aj(Ge.zoom),pe,Ge.frustumCorners.TL,Ge.frustumCorners.TR,Ge.frustumCorners.BR,Ge.frustumCorners.BL,Ge.globeCenterInViewSpace,Ge.globeRadius,ve,Be,Ge._farZ,vt);if(ie(gt,xt),K&&(M.setupElevationDraw(De,K,Ie),P.uploadCommonUniforms(q,K,gt.toUnwrapped()),ue)){let[It,zt,Yt]=ue.getGridBuffers(ft,Be!==0);K.draw(P,Ye,ae,Ee,ge,Jt.backCCW,Lt,"globe_raster",It,zt,Yt)}}}if(ue&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Ge=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&Ge.push("CUSTOM_ANTIALIASING"),K=P.getOrCreateProgram("globeRaster",{defines:Ge});for(let Be of O){let{x:Ye,y:gt,z:De}=Be.canonical,Ee=gt===0,Ke=gt===(1<<De)-1,[Ne,nt,xt,Dt]=ue.getPoleBuffers(De,!1);if(Dt&&(Ee||Ke)){let ft=F.getTile(Be);q.activeTexture.set(G.TEXTURE0),ft.texture&&ft.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let vt=n.dJ(De,Ye,ee),Ft=n.bj(n.dI(Be.canonical)),Lt=(It,zt)=>It.draw(P,G.TRIANGLES,ae,ni.disabled,ge,Jt.disabled,Xd(ee.expandedFarZProjMatrix,vt,vt,Ft,0,pe,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ve,0,ee._farZ),"globe_pole_raster",zt,xt,Dt);M.setupElevationDraw(ft,K,Ie),P.uploadCommonUniforms(q,K,Be.toUnwrapped()),Ee&&P.renderDefaultNorthPole&&Lt(K,Ne),Ke&&P.renderDefaultSouthPole&&(vt=n.cR(n.bB(),vt,[1,-1,1]),Lt(K,nt))}}}})(f,_,x,S,E);else{let P=f.context,M=P.gl,F,O,N=f.shadowRenderer,q=Zs(f,f.longestCutoffRange),G=ge=>{if(O===ge)return;let ae=[];ae.push(Rp[ge]),q.shouldRenderCutoff&&ae.push("RENDER_CUTOFF"),N&&(ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&ae.push("NORMAL_OFFSET")),F=f.getOrCreateProgram("terrainRaster",{defines:ae}),O=ge},K=f.colorModeForRenderPass(),$=new Rt(M.LEQUAL,Rt.ReadWrite,f.depthRangeFor3D);Ec.update(E);let ee=f.transform,se=Ym(ee.zoom,_.exaggeration(),_.sourceCache._source.tileSize),ie=[0,0,0];if(N){let ge=f.style.directionalLight,ae=f.style.ambientLight;ge&&ae&&(ie=Do(f.style,ge,ae))}{O=-1;let ge=M.TRIANGLES,[ae,ye]=[_.gridIndexBuffer,_.gridSegments];for(let pe of S){let ue=x.getTile(pe),ve=ni.disabled,ze=_.prevTerrainTileForTile[pe.key],Ie=_.terrainTileForTile[pe.key];Yd(ze,Ie)&&Ec.newMorphing(pe.key,ze,Ie,E,250),P.activeTexture.set(M.TEXTURE0),ue.texture&&ue.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);let Ge=Ec.getMorphValuesForProxy(pe.key),Be=Ge?1:0,Ye;Ge&&(Ye={morphing:{srcDemTile:Ge.from,dstDemTile:Ge.to,phase:n.dC(Ge.phase)}});let gt=Op(pe.projMatrix,od(pe.canonical,ee.renderWorldCopies)?se/10:se,ie);if(G(Be),!F)continue;_.setupElevationDraw(ue,F,Ye);let De=pe.toUnwrapped();N&&N.setupShadows(De,F),f.uploadCommonUniforms(P,F,De,null,q),F.draw(f,ge,$,ve,K,Jt.backCCW,gt,"terrain_raster",_.gridBuffer,ae,ye)}}}})(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let o=this.painter,c=this.painter.context,f=this.proxySourceCache,_=this.proxiedCoords[f.id],x=this._drapedRenderBatches.shift(),S=o.style.order,E=[],P=0;for(let M of _){let F=f.getTileByID(M.proxyTileKey),O=f.proxyCachedFBO[M.key]?f.proxyCachedFBO[M.key][t]:void 0,N=O!==void 0?f.renderCache[O]:this.pool[P++],q=O!==void 0;if(F.texture=N.tex,q&&!N.dirty){E.push(F.tileID);continue}let G;c.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(c.clear({color:n.ao.transparent,stencil:0}),N.dirty=!1);for(let K=x.start;K<=x.end;++K){let $=o.style._mergedLayers[S[K]];if($.isHidden(o.transform.zoom))continue;let ee=o.style.getLayerSourceCache($),se=ee?this.proxyToSource[M.key][ee.id]:[M];if(!se)continue;let ie=se;c.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(N,se,$,ee),G=ee?ee.id:null),o.renderLayer(o,ee,$,ie)}if(this._drapedRenderBatches.length===0)for(let K of this._pendingGroundEffectLayers){let $=o.style._mergedLayers[S[K]];if($.isHidden(o.transform.zoom))continue;let ee=o.style.getLayerSourceCache($),se=ee?this.proxyToSource[M.key][ee.id]:[M];if(!se)continue;let ie=se;c.viewport.set([0,0,N.fb.width,N.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(N,se,$,ee),G=ee?ee.id:null),o.renderLayer(o,ee,$,ie)}this.renderedToTile?(N.dirty=!0,E.push(F.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,o.width,o.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){let o=t.order.length,c=-1,f=o;for(let _=0;_<o;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?c=Math.max(c,_):f=Math.min(f,_);return f>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((o=>o.dem)).forEach((o=>{t=Math.min(t,o.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,o,c){if(!this._visibleDemTiles)return null;let f=this._visibleDemTiles.filter((_=>_.dem)).map((_=>{let x=_.tileID,S=1<<x.overscaledZ,{x:E,y:P}=x.canonical,M=E/S,F=(E+1)/S,O=P/S,N=(P+1)/S;return{minx:M,miny:O,maxx:F,maxy:N,t:_.dem.tree.raycastRoot(M,O,F,N,t,o,c),tile:_}}));f.sort(((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE)));for(let _ of f){if(_.t==null)return null;let x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,o,c);if(x!=null)return x}return null}_createFBO(){let t=this.painter.context,o=t.gl,c=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);let f=new n.T(t,{width:c[0],height:c[1],data:null},o.RGBA8);f.bind(o.LINEAR,o.CLAMP_TO_EDGE);let _=t.createFramebuffer(c[0],c[1],!0,null);return _.colorAttachment.set(f.texture),_.depthAttachment=new Mp(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{let o=this._style._mergedLayers[t],c=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!c&&o.shouldRedrape():!c&&o.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(let c of this._style.getSources())if(c instanceof Ri){t=!0;break}if(!t)return;let o={};for(let c=0;c<this._style.order.length;++c){let f=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(f);if(_&&!o[_.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof n.ad){o[_.id]=!0;for(let x of this.proxyCoords){let S=this.proxyToSource[x.key][_.id];if(S)for(let E of S)this._clearRenderCacheForTile(_.id,E)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof Jr){t=!0;break}if(!t)return;let o={};for(let c=0;c<this._style.order.length;++c){let f=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(f);if(!_||o[_.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;let x=f.paint.get("raster-fade-duration");for(let S of this.proxyCoords){let E=this.proxyToSource[S.key][_.id];if(E)for(let P of E){let M=Kd(_.getTile(P),_.findLoadedParent(P,0),_,this.painter.transform,x);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(_.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let t=this._style.order,o=t.length;if(o===0)return;let c=[];this._pendingGroundEffectLayers=[];let f,_=0,x=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<o;)x=this._style._mergedLayers[t[_]];for(;_<o;++_){let S=this._style._mergedLayers[t[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?f===void 0&&(f=_):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),f!==void 0&&(c.push({start:f,end:_-1}),f=void 0)))}if(f!==void 0&&c.push({start:f,end:_-1}),c.length!==0){let S=c[c.length-1];this._pendingGroundEffectLayers.every((E=>E>S.end))||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){let o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){let x=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<x.length;++S){let E=Object.values(x[S]);o.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();let c=this.proxyCoords,f=this._tilesDirty;for(let x=c.length-1;x>=0;x--){let S=c[x];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){let E=t[S.key],P=this.proxyToSource[S.key],M=0;for(let F in P){let O=P[F],N=E[F];if(!N||N.length!==O.length||O.some(((q,G)=>q!==N[G]||f[F]&&f[F].hasOwnProperty(q.key)))){M=-1;break}++M}for(let F in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][F]].dirty=M<0||M!==Object.values(E).length}}let _=[...this._drapedRenderBatches];_.sort(((x,S)=>S.end-S.start-(x.end-x.start)));for(let x of _)for(let S of c){if(o.proxyCachedFBO[S.key])continue;let E=o.renderCachePool.pop();E===void 0&&o.renderCache.length<50&&(E=o.renderCache.length,o.renderCache.push(this._createFBO())),E!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][x.start]=E,o.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,c,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let _=this.painter.context,x=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(c.isTileClipped())S=o.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ni.disabled}_renderTileClippingMasks(t,o){let c=this.painter,f=this.painter.context,_=f.gl;c._tileClippingMaskIDs={},f.setColorMode(vi.disabled),f.setDepthMode(Rt.disabled);let x=c.getOrCreateProgram("clippingMask");for(let S of t){let E=c._tileClippingMaskIDs[S.key]=--o;x.draw(c,_.TRIANGLES,Rt.disabled,new ni({func:_.ALWAYS,mask:0},E,255,_.KEEP,_.KEEP,_.REPLACE),vi.disabled,Jt.disabled,Ac(S.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){let o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;let c=[t.x,t.y,1,1];n.aC(c,c,o.pixelMatrixInverse),n.cJ(c,c,1/c[3]),c[0]/=o.worldSize,c[1]/=o.worldSize;let f=o._camera.position,_=n.ce(1,o.center.lat),x=[f[0],f[1],f[2]/_,0],S=n.d9([],c.slice(0,3),x);n.aw(S,S);let E=this.raycast(x,S,this._exaggeration);return E!==null&&E?(n.bG(x,x,S,E),x[3]=x[2],x[2]*=_,x):null}_setupProxiedCoordsForOrtho(t,o,c){if(t.getSource()instanceof n.aT)return this._setupProxiedCoordsForImageSource(t,o,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let f=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let E=0;E<_.length;E++){let P=_[E],M=this._findTileCoveringTileID(P,t);if(M){let F=this._createProxiedId(P,M,c[P.key]&&c[P.key][t.id]);f.push(F),this.proxyToSource[P.key][t.id]=[F]}}let x=!1,S=new Set;for(let E=0;E<o.length;E++){let P=t.getTile(o[E]);if(!P||!P.hasData())continue;let M=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==P.tileID.canonical.z){let F=this.proxyToSource[M.tileID.key][t.id],O=this._createProxiedId(M.tileID,P,c[M.tileID.key]&&c[M.tileID.key][t.id]);F?F.splice(F.length-1,0,O):this.proxyToSource[M.tileID.key][t.id]=[O];let N=this.proxyToSource[M.tileID.key][t.id];S.has(N)||S.add(N),f.push(O),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let E of S)E.sort(((P,M)=>M.overscaledZ-P.overscaledZ))}_setupProxiedCoordsForImageSource(t,o,c){if(!t.getSource().loaded())return;let f=this.proxiedCoords[t.id]=[],_=this.proxyCoords,x=t.getSource(),S=x.tileID;if(!S)return;let E=new n.P(S.x,S.y)._div(1<<S.z),P=x.coordinates.map(n.ae.fromLngLat).reduce(((F,O)=>(F.min.x=Math.min(F.min.x,O.x-E.x),F.min.y=Math.min(F.min.y,O.y-E.y),F.max.x=Math.max(F.max.x,O.x-E.x),F.max.y=Math.max(F.max.y,O.y-E.y),F)),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(F,O)=>{let N=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z),G=n.al/(1<<F.canonical.z),K=O.wrap+O.canonical.x/(1<<O.canonical.z),$=O.canonical.y/(1<<O.canonical.z);return N+G<K+P.min.x||N>K+P.max.x||q+G<$+P.min.y||q>$+P.max.y};for(let F=0;F<_.length;F++){let O=_[F];for(let N=0;N<o.length;N++){let q=t.getTile(o[N]);if(!q||!q.hasData()||M(O,q.tileID))continue;let G=this._createProxiedId(O,q,c[O.key]&&c[O.key][t.id]),K=this.proxyToSource[O.key][t.id];K?K.push(G):this.proxyToSource[O.key][t.id]=[G],f.push(G)}}}_createProxiedId(t,o,c){let f=this.orthoMatrix;if(c){let _=c.find((x=>x.key===o.tileID.key));if(_)return _}if(o.tileID.key!==t.key){let _=t.canonical.z-o.tileID.canonical.z,x,S,E;f=n.bB();let P=o.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(x=n.al>>_,S=x*((o.tileID.canonical.x<<_)-t.canonical.x+P),E=x*((o.tileID.canonical.y<<_)-t.canonical.y)):(x=n.al<<-_,S=n.al*(o.tileID.canonical.x-(t.canonical.x+P<<-_)),E=n.al*(o.tileID.canonical.y-(t.canonical.y<<-_))),n.cd(f,0,x,0,x,0,1),n.bq(f,f,[S,E,0])}return new sd(o.tileID,t.key,f)}_findTileCoveringTileID(t,o){let c=o.getTile(t);if(c&&c.hasData())return c;let f=this._findCoveringTileCache[o.id],_=f[t.key];if(c=_?o.getTileByID(_):null,c&&c.hasData()||_===null)return c;let x=c?c.tileID:t,S=x.overscaledZ,E=o.getSource().minzoom,P=[];if(!_){let F=o.getSource().maxzoom;if(t.canonical.z>=F){let O=t.canonical.z-F;o.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,o.transform.tileZoom),x=new n.aP(S,t.wrap,F,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(S=F,x=new n.aP(S,t.wrap,F,t.canonical.x>>O,t.canonical.y>>O))}x.key!==t.key&&(P.push(x.key),c=o.getTile(x))}let M=F=>{P.forEach((O=>{f[O]=F})),P.length=0};for(S-=1;S>=E&&(!c||!c.hasData());S--){c&&M(c.tileID.key);let F=x.calculateScaledKey(S);if(c=o.getTileByID(F),c&&c.hasData())break;let O=f[F];if(O===null)break;O===void 0?P.push(F):c=o.getTileByID(O)}return M(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[o.key]=!0}}function Bp(l,t,o){let c=(function(S,E,P){let M=n.bI(E,S),F=n.bI(P,[.2126,.7152,.0722]),O=(q,G,K)=>(1-K)*q+K*G,N=O(1-.3*Math.min(F,1),1,Math.min(M+1,1));return O(.92,1,Math.asin(n.aA(E[2],-1,1))/Math.PI+.5)*N})(l,[0,0,1],t),f=[0,0,0];n.c4(f,o.slice(0,3),c);let _=[0,0,0];n.c4(_,t.slice(0,3),l[2]);let x=[0,0,0];return n.d7(x,f,_),n.da(x)}let Fp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Np=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ld{static cacheKey(t,o,c,f){let _=`${o}${f?f.cacheKey:""}`;for(let x of c)t.usedDefines.includes(x)&&(_+=`/${x}`);return _}constructor(t,o,c,f,_,x){let S=t.gl;this.program=S.createProgram(),this.configuration=f,this.name=o,this.fixedDefines=[...x];let E=f?f.defines():[];E=E.concat(x.map((q=>`#define ${q}`)));let P=`#version 300 es
`,M=P+E.concat("precision mediump float;",Ys,ql.fragmentSource).join(`
`);for(let q of c.fragmentIncludes)M+=`
${Xs[q]}`;M+=`
${c.fragmentSource}`;let F=P+E.concat("precision highp float;",Ys,ql.vertexSource).join(`
`);for(let q of c.vertexIncludes)F+=`
${Xs[q]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));let O=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(O,M),S.compileShader(O),S.attachShader(this.program,O);let N=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(N,F),S.compileShader(N),S.attachShader(this.program,N),this.attributes={},S.linkProgram(this.program),S.deleteShader(N),S.deleteShader(O),this.fixedUniforms=_(t),this.binderUniforms=f?f.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(q=>({u_instanceID:new n.cg(q)}))(t)),(x.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(q=>({u_dem:new n.cg(q),u_dem_prev:new n.cg(q),u_dem_tl:new n.cj(q),u_dem_scale:new n.ci(q),u_dem_tl_prev:new n.cj(q),u_dem_scale_prev:new n.ci(q),u_dem_size:new n.ci(q),u_dem_lerp:new n.ci(q),u_exaggeration:new n.ci(q),u_depth:new n.cg(q),u_depth_size_inv:new n.cj(q),u_depth_range_unpack:new n.cj(q),u_occluder_half_size:new n.ci(q),u_occlusion_depth_offset:new n.ci(q),u_meter_to_dem:new n.ci(q),u_label_plane_matrix_inv:new n.ck(q)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new n.ch(q),u_tile_tr_up:new n.ch(q),u_tile_br_up:new n.ch(q),u_tile_bl_up:new n.ch(q),u_tile_up_scale:new n.ci(q)}))(t)),x.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new n.ck(q),u_fog_range:new n.cj(q),u_fog_color:new n.d2(q),u_fog_horizon_blend:new n.ci(q),u_fog_vertical_limit:new n.cj(q),u_fog_temporal_offset:new n.ci(q),u_frustum_tl:new n.ch(q),u_frustum_tr:new n.ch(q),u_frustum_br:new n.ch(q),u_frustum_bl:new n.ch(q),u_globe_pos:new n.ch(q),u_globe_radius:new n.ci(q),u_globe_transition:new n.ci(q),u_is_globe:new n.cg(q),u_viewport:new n.cj(q)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new n.d2(q)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new n.ch(q),u_lighting_directional_dir:new n.ch(q),u_lighting_directional_color:new n.ch(q),u_ground_radiance:new n.ch(q)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new n.ck(q),u_light_matrix_1:new n.ck(q),u_fade_range:new n.cj(q),u_shadow_normal_offset:new n.ch(q),u_shadow_intensity:new n.ci(q),u_shadow_texel_size:new n.ci(q),u_shadow_map_resolution:new n.ci(q),u_shadow_direction:new n.ch(q),u_shadow_bias:new n.ch(q),u_shadowmap_0:new n.cg(q),u_shadowmap_1:new n.cg(q)}))(t)))}getAttributeLocation(t,o){let c=this.attributes[o];return c===void 0&&(c=this.attributes[o]=t.getAttribLocation(this.program,o)),c}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;let c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in o)c[f]&&c[f].set(this.program,f,o[f])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;let c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in o)c[f]&&c[f].set(this.program,f,o[f])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;let c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in o)c[f].set(this.program,f,o[f])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;let c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in o)c[f].set(this.program,f,o[f])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;let c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in o)c[f].set(this.program,f,o[f])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;let c=this.shadowUniforms;t.program.set(this.program);for(let f in o)c[f].set(this.program,f,o[f])}_drawDebugWireframe(t,o,c,f,_,x,S,E,P,M){let F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let O=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!Fp.includes(this.name))||!(!F.layers3D||!Np.includes(this.name))))return;let N=O.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,O);if(!q)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let K=t.getOrCreateProgram(this.name,{config:this.configuration,defines:G});O.program.set(K.program);let $=(ie,ge,ae)=>{if(ge[ie]&&ae[ie])for(let ye in ge[ie])ae[ie][ye]&&ae[ie][ye].set(ae.program,ye,ge[ie][ye].current)};P&&P.setUniforms(K.program,O,K.binderUniforms,S,{zoom:E}),$("fixedUniforms",this,K),$("terrainUniforms",this,K),$("globeUniforms",this,K),$("fogUniforms",this,K),$("lightsUniforms",this,K),$("shadowUniforms",this,K),q.bind(),O.setColorMode(new vi([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],n.ao.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Rt(o.func===N.LESS?N.LEQUAL:o.func,Rt.ReadOnly,o.range)),O.setStencilMode(ni.disabled);let ee=3*x.primitiveLength*2,se=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let ie=M||1;for(let ge=0;ge<ie;++ge)K.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,se)}else M&&M>1?N.drawElementsInstanced(N.LINES,ee,N.UNSIGNED_SHORT,se,M):N.drawElements(N.LINES,ee,N.UNSIGNED_SHORT,se);_.bind(),O.program.set(this.program),O.setDepthMode(o),O.setStencilMode(c),O.setColorMode(f)}checkUniforms(t,o,c){if(this.fixedDefines.includes(o)){for(let f of Object.keys(c))if(!c[f].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${f} not set but required by ${o} being defined`)}}draw(t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K){let $=t.context,ee=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(c),$.setStencilMode(f),$.setColorMode(_),$.setCullFace(x);for(let ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,S[ge]);q&&q.setUniforms(this.program,$,this.binderUniforms,O,{zoom:N});let se={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[o];this.checkUniforms(E,"RENDER_SHADOWS",this.shadowUniforms);let ie=K&&K>0?1:void 0;for(let ge of F.get()){let ae=ge.vaos||(ge.vaos={});if((ae[E]||(ae[E]=new ol)).bind($,this,P,q?q.getPaintVertexBuffers():[],M,ge.vertexOffset,G||[],ie),this.forceManualRenderingForInstanceIDShaders){let ye=K||1;for(let pe=0;pe<ye;++pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pe),M?ee.drawElements(o,ge.primitiveLength*se,ee.UNSIGNED_SHORT,ge.primitiveOffset*se*2):ee.drawArrays(o,ge.vertexOffset,ge.vertexLength)}else K&&K>1?ee.drawElementsInstanced(o,ge.primitiveLength*se,ee.UNSIGNED_SHORT,ge.primitiveOffset*se*2,K):M?ee.drawElements(o,ge.primitiveLength*se,ee.UNSIGNED_SHORT,ge.primitiveOffset*se*2):ee.drawArrays(o,ge.vertexOffset,ge.vertexLength);o===ee.TRIANGLES&&M&&this._drawDebugWireframe(t,c,f,_,M,ge,O,N,q,K)}}}function Jd(l,t,o=0){let c=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,_=f*(t.tileID.canonical.x+t.tileID.wrap*c),x=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ay(t,1,l.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x],u_pattern_transition:o}}let su={terrain:0,flat:1},Qd=n.bB(),eh=(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$)=>{let ee=t.style.light,se=ee.properties.get("position"),ie=[se.x,se.y,se.z],ge=n.dN();ee.properties.get("anchor")==="viewport"&&(n.dO(ge,-t.transform.angle),n.dP(ie,ie,ge));let ae=ee.properties.get("color").toPremultipliedRenderColor(null),ye=t.transform,pe={u_matrix:l,u_lightpos:ie,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+o,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:su[P],u_base_type:su[M],u_ao:f,u_edge_radius:_,u_width_scale:x,u_flood_light_color:q,u_vertical_scale:G,u_flood_light_intensity:K,u_ground_shadow_factor:$};return ye.projection.name==="globe"&&(pe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],pe.u_zoom_transition=F,pe.u_inv_rot_matrix=N,pe.u_merc_center=O,pe.u_up_dir=ye.projection.upVector(new n.cC(0,0,0),O[0]*n.al,O[1]*n.al),pe.u_height_lift=E),pe},Km=(l,t,o,c,f,_)=>({u_matrix:l,u_edge_radius:t,u_width_scale:o,u_vertical_scale:c,u_height_type:su[f],u_base_type:su[_]}),Jm=(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$)=>{let ee=eh(l,t,o,c,f,_,x,S,P,M,F,O,N,q,G,K,1,[0,0,0]),se={u_height_factor:-Math.pow(2,S.overscaledZ)/E.tileSize/8};return Object.assign(ee,Jd(t,E,$),se)},au=(l,t,o,c,f,_,x,S,E,P,M)=>({u_matrix:t,u_opacity:o,u_ao_pass:c?1:0,u_meter_to_tile:f,u_ao:_,u_flood_light_intensity:x,u_flood_light_color:S,u_attenuation:E,u_edge_radius:P,u_fb:0,u_fb_size:M,u_dynamic_offset:1}),Qm=(l,t,o)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:o}),eg=(l,t,o,c,f,_=0)=>Object.assign(Qm(l,t,f),Jd(o,c,_)),Yy=(l,t,o,c)=>({u_matrix:l,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:c}),Ky=(l,t,o,c,f,_,x=0)=>Object.assign(eg(l,t,o,c,_,x),{u_world:f}),Jy=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),th=(l,t,o,c,f)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:c,u_reset_depth:f}),jp=(l,t,o,c,f,_,x,S,E)=>({u_matrix:l,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:c,u_camera_pos:f,u_tile_to_meter:_,u_facade_emissive_chance:x,u_flood_light_color:S,u_flood_light_intensity:E}),Vp=l=>({u_matrix:l}),tg=l=>({u_matrix:l}),lu=(l,t,o,c,f,_,x,S)=>{let E=n.al/_.tileSize;return{u_matrix:l,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(S),u_extrude_scale:[o.pixelsToGLUnits[0]/E,o.pixelsToGLUnits[1]/E],u_zoom_transition:c,u_tile_id:x,u_merc_center:f}},Up=(l,t,o=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:o}),ig=n.bB(),rg=(l,t,o,c,f,_,x)=>{let S=l.transform,E=S.projection.name==="globe",P=E?n.dQ(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:n.ay(o,1,_),M={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:x,u_inv_rot_matrix:ig,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){M.u_inv_rot_matrix=c,M.u_merc_center=f,M.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],M.u_zoom_transition=n.aj(S.zoom);let F=f[0]*n.al,O=f[1]*n.al;M.u_up_dir=S.projection.upVector(new n.cC(0,0,0),F,O)}return M};function ih(l,[t,o,c,f],[_,x]){if(_===x)return[0,0,0,0];let S=255*(l-1)/(l*(x-_));return[t*S,o*S,c*S,f*S]}function cl(l,t,[o,c]){return o===c?0:.5/l+(t-o)*(l-1)/(l*(c-o))}let cd=(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee,se,ie)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:_,u_scale_parent:P,u_fade_t:M.mix,u_opacity:M.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:n.dS(F.paint.get("raster-saturation")),u_contrast_factor:n.dR(F.paint.get("raster-contrast")),u_spin_weights:rh(F.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:N,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:E,u_colorization_mix:ih(n.dT,G,$),u_colorization_offset:cl(n.dT,K,$),u_color_ramp:q,u_texture_offset:[se/(ee+2*se),ee/(ee+2*se)],u_texture_res:[ee+2*se,ee+2*se],u_emissive_strength:ie});function rh(l){l*=Math.PI/180;let t=Math.sin(l),o=Math.cos(l);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}let kc=.05,Wl=(l,t,o,c,f,_,x,S,E,P,M,F)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:_,u_scale_parent:P,u_fade_t:M.mix,u_opacity:M.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:E}),qp=(l,t,o,c,f,_,x,S,E,P)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:c,u_color_ramp:_,u_velocity_res:f,u_max_speed:x,u_uv_offset:S,u_data_scale:[255*E[0],255*E[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[kc,kc]}),nh=(l,t,o,c,f,_,x,S,E,P)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:c,u_max_speed:f,u_speed_factor:_,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*E[0],255*E[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[kc,kc]}),Wp=n.bB(),Gp=(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee,se,ie,ge,ae,ye)=>{let pe=f.transform,ue={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(ee),u_rotate_symbol:+o,u_aspect_ratio:pe.width/pe.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+P,u_elevation_from_sea:E?1:0,u_pitch_with_map:+c,u_texsize:M,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Wp,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:ae||0,u_gamma_scale:c?f.transform.getCameraToCenterDistance(ee)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:n.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ye||1,u_ground_shadow_factor:se,u_inv_matrix:n.bk(n.bB(),x),u_normal_scale:ie,u_lutTexture:En.LUT};return ee.name==="globe"&&(ue.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],ue.u_zoom_transition=q,ue.u_inv_rot_matrix=K,ue.u_merc_center=G,ue.u_camera_forward=pe._camera.forward(),ue.u_ecef_origin=n.dU(pe.globeMatrix,N.toUnwrapped()),ue.u_tile_matrix=Float32Array.from(pe.globeMatrix),ue.u_up_vector=$),ue},oh=(l,t,o,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:o,u_color:c}),sh=(l,t,o,c,f,_,x,S,E)=>Object.assign((function(P,M,F,O,N,q){let{width:G,height:K}=O.imageManager.getPixelSize(M),$=Math.pow(2,q.tileID.overscaledZ),ee=q.tileSize*Math.pow(2,O.transform.tileZoom)/$,se=ee*(q.tileID.canonical.x+q.tileID.wrap*$),ie=ee*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[G,K],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:N?[O.transform.width,-1*O.transform.height]:[1/n.ay(q,1,O.transform.tileZoom),1/n.ay(q,1,O.transform.tileZoom)],u_pixel_coord_upper:[se>>16,ie>>16],u_pixel_coord_lower:[65535&se,65535&ie]}})(0,_,x,c,S,E),{u_matrix:l,u_emissive_strength:t,u_opacity:o}),Hp=new Float32Array(n.bz([])),ah=(l,t,o,c,f,_,x,S,E,P,M,F,O,N=[0,0,0],q,G,K)=>{let $=f.style.light,ee=$.properties.get("position"),se=[-ee.x,-ee.y,ee.z],ie=n.dN();$.properties.get("anchor")==="viewport"&&(n.dO(ie,-f.transform.angle),n.dP(se,se,ie));let ge=M.alphaMode==="MASK",ae=$.properties.get("color").toNonPremultipliedRenderColor(null),ye=O.paint.get("model-ambient-occlusion-intensity"),pe=O.paint.get("model-color").constantOr(n.ao.white).toNonPremultipliedRenderColor(null);return pe.a=O.paint.get("model-color-mix-intensity").constantOr(0),K&&(pe.r=K[0],pe.g=K[1],pe.b=K[2],pe.a=K[3]),G&&(pe.r=G.color.r,pe.g=G.color.g,pe.b=G.color.b,pe.a=G.colorMix,F=G.emissionStrength,_=G.opacity),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:c||Hp,u_lightpos:se,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:N,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:M.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:E,u_roughnessFactor:P,u_baseColorTexture:En.BaseColor,u_metallicRoughnessTexture:En.MetallicRoughness,u_normalTexture:En.Normal,u_occlusionTexture:En.Occlusion,u_emissionTexture:En.Emission,u_lutTexture:En.LUT,u_color_mix:pe.toArray01(),u_aoIntensity:ye,u_emissive_strength:F,u_occlusionTextureTransform:q||[0,0,0,0]}},cu=(l,t=Hp,o=Hp)=>({u_matrix:l,u_instance:t,u_node_matrix:o}),Qy={fillExtrusion:l=>({u_matrix:new n.ck(l),u_lightpos:new n.ch(l),u_lightintensity:new n.ci(l),u_lightcolor:new n.ch(l),u_vertical_gradient:new n.ci(l),u_opacity:new n.ci(l),u_edge_radius:new n.ci(l),u_width_scale:new n.ci(l),u_ao:new n.cj(l),u_height_type:new n.cg(l),u_base_type:new n.cg(l),u_tile_id:new n.ch(l),u_zoom_transition:new n.ci(l),u_inv_rot_matrix:new n.ck(l),u_merc_center:new n.cj(l),u_up_dir:new n.ch(l),u_height_lift:new n.ci(l),u_flood_light_color:new n.ch(l),u_vertical_scale:new n.ci(l),u_flood_light_intensity:new n.ci(l),u_ground_shadow_factor:new n.ch(l)}),fillExtrusionDepth:l=>({u_matrix:new n.ck(l),u_edge_radius:new n.ci(l),u_width_scale:new n.ci(l),u_vertical_scale:new n.ci(l),u_height_type:new n.cg(l),u_base_type:new n.cg(l)}),fillExtrusionPattern:l=>({u_matrix:new n.ck(l),u_lightpos:new n.ch(l),u_lightintensity:new n.ci(l),u_lightcolor:new n.ch(l),u_vertical_gradient:new n.ci(l),u_height_factor:new n.ci(l),u_edge_radius:new n.ci(l),u_width_scale:new n.ci(l),u_ao:new n.cj(l),u_height_type:new n.cg(l),u_base_type:new n.cg(l),u_tile_id:new n.ch(l),u_zoom_transition:new n.ci(l),u_inv_rot_matrix:new n.ck(l),u_merc_center:new n.cj(l),u_up_dir:new n.ch(l),u_height_lift:new n.ci(l),u_image:new n.cg(l),u_texsize:new n.cj(l),u_pixel_coord_upper:new n.cj(l),u_pixel_coord_lower:new n.cj(l),u_tile_units_to_pixels:new n.ci(l),u_opacity:new n.ci(l),u_pattern_transition:new n.ci(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new n.ck(l),u_opacity:new n.ci(l),u_ao_pass:new n.ci(l),u_meter_to_tile:new n.ci(l),u_ao:new n.cj(l),u_flood_light_intensity:new n.ci(l),u_flood_light_color:new n.ch(l),u_attenuation:new n.ci(l),u_edge_radius:new n.ci(l),u_fb:new n.cg(l),u_fb_size:new n.ci(l),u_dynamic_offset:new n.ci(l)}),fill:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_ground_shadow_factor:new n.ch(l)}),fillPattern:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_image:new n.cg(l),u_texsize:new n.cj(l),u_pixel_coord_upper:new n.cj(l),u_pixel_coord_lower:new n.cj(l),u_tile_units_to_pixels:new n.ci(l),u_ground_shadow_factor:new n.ch(l),u_pattern_transition:new n.ci(l)}),fillOutline:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_world:new n.cj(l),u_ground_shadow_factor:new n.ch(l)}),fillOutlinePattern:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_world:new n.cj(l),u_image:new n.cg(l),u_texsize:new n.cj(l),u_pixel_coord_upper:new n.cj(l),u_pixel_coord_lower:new n.cj(l),u_tile_units_to_pixels:new n.ci(l),u_ground_shadow_factor:new n.ch(l),u_pattern_transition:new n.ci(l)}),building:l=>({u_matrix:new n.ck(l),u_normal_matrix:new n.ck(l),u_opacity:new n.ci(l),u_faux_facade_ao_intensity:new n.ci(l),u_camera_pos:new n.ch(l),u_tile_to_meter:new n.ci(l),u_facade_emissive_chance:new n.ci(l),u_flood_light_color:new n.ch(l),u_flood_light_intensity:new n.ci(l)}),buildingBloom:l=>({u_matrix:new n.ck(l)}),buildingDepth:l=>({u_matrix:new n.ck(l)}),elevatedStructuresDepth:l=>({u_matrix:new n.ck(l),u_depth_bias:new n.ci(l)}),elevatedStructures:l=>({u_matrix:new n.ck(l),u_ground_shadow_factor:new n.ch(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new n.ck(l),u_camera_pos:new n.ch(l),u_depth_bias:new n.ci(l),u_height_scale:new n.ci(l),u_reset_depth:new n.ci(l)}),circle:n.dX,collisionBox:l=>({u_matrix:new n.ck(l),u_inv_rot_matrix:new n.ck(l),u_camera_to_center_distance:new n.ci(l),u_extrude_scale:new n.cj(l),u_zoom_transition:new n.ci(l),u_merc_center:new n.cj(l),u_tile_id:new n.ch(l)}),collisionCircle:l=>({u_matrix:new n.ck(l),u_inv_matrix:new n.ck(l),u_camera_to_center_distance:new n.ci(l),u_viewport_size:new n.cj(l)}),debug:l=>({u_color:new n.dA(l),u_matrix:new n.ck(l),u_overlay:new n.cg(l),u_overlay_scale:new n.ci(l)}),clippingMask:l=>({u_matrix:new n.ck(l)}),heatmap:l=>({u_extrude_scale:new n.ci(l),u_intensity:new n.ci(l),u_matrix:new n.ck(l),u_inv_rot_matrix:new n.ck(l),u_merc_center:new n.cj(l),u_tile_id:new n.ch(l),u_zoom_transition:new n.ci(l),u_up_dir:new n.ch(l)}),heatmapTexture:l=>({u_image:new n.cg(l),u_color_ramp:new n.cg(l),u_opacity:new n.ci(l)}),hillshade:l=>({u_matrix:new n.ck(l),u_image:new n.cg(l),u_latrange:new n.cj(l),u_light:new n.cj(l),u_shadow:new n.dA(l),u_highlight:new n.dA(l),u_emissive_strength:new n.ci(l),u_accent:new n.dA(l)}),hillshadePrepare:l=>({u_matrix:new n.ck(l),u_image:new n.cg(l),u_dimension:new n.cj(l),u_zoom:new n.ci(l)}),line:n.dW,linePattern:n.dV,raster:l=>({u_matrix:new n.ck(l),u_normalize_matrix:new n.ck(l),u_globe_matrix:new n.ck(l),u_merc_matrix:new n.ck(l),u_grid_matrix:new n.dB(l),u_tl_parent:new n.cj(l),u_scale_parent:new n.ci(l),u_fade_t:new n.ci(l),u_opacity:new n.ci(l),u_image0:new n.cg(l),u_image1:new n.cg(l),u_brightness_low:new n.ci(l),u_brightness_high:new n.ci(l),u_saturation_factor:new n.ci(l),u_contrast_factor:new n.ci(l),u_spin_weights:new n.ch(l),u_perspective_transform:new n.cj(l),u_raster_elevation:new n.ci(l),u_zoom_transition:new n.ci(l),u_merc_center:new n.cj(l),u_cutoff_params:new n.d2(l),u_colorization_mix:new n.d2(l),u_colorization_offset:new n.ci(l),u_color_ramp:new n.cg(l),u_texture_offset:new n.cj(l),u_texture_res:new n.cj(l),u_emissive_strength:new n.ci(l)}),rasterParticle:l=>({u_matrix:new n.ck(l),u_normalize_matrix:new n.ck(l),u_globe_matrix:new n.ck(l),u_merc_matrix:new n.ck(l),u_grid_matrix:new n.dB(l),u_tl_parent:new n.cj(l),u_scale_parent:new n.ci(l),u_fade_t:new n.ci(l),u_opacity:new n.ci(l),u_image0:new n.cg(l),u_image1:new n.cg(l),u_raster_elevation:new n.ci(l),u_zoom_transition:new n.ci(l),u_merc_center:new n.cj(l),u_cutoff_params:new n.d2(l)}),rasterParticleTexture:l=>({u_texture:new n.cg(l),u_opacity:new n.ci(l)}),rasterParticleDraw:l=>({u_particle_texture:new n.cg(l),u_particle_texture_side_len:new n.ci(l),u_tile_offset:new n.cj(l),u_velocity:new n.cg(l),u_color_ramp:new n.cg(l),u_velocity_res:new n.cj(l),u_max_speed:new n.ci(l),u_uv_offset:new n.cj(l),u_data_scale:new n.cj(l),u_data_offset:new n.ci(l),u_particle_pos_scale:new n.ci(l),u_particle_pos_offset:new n.cj(l)}),rasterParticleUpdate:l=>({u_particle_texture:new n.cg(l),u_particle_texture_side_len:new n.ci(l),u_velocity:new n.cg(l),u_velocity_res:new n.cj(l),u_max_speed:new n.ci(l),u_speed_factor:new n.ci(l),u_reset_rate:new n.ci(l),u_rand_seed:new n.ci(l),u_uv_offset:new n.cj(l),u_data_scale:new n.cj(l),u_data_offset:new n.ci(l),u_particle_pos_scale:new n.ci(l),u_particle_pos_offset:new n.cj(l)}),symbol:l=>({u_is_size_zoom_constant:new n.cg(l),u_is_size_feature_constant:new n.cg(l),u_size_t:new n.ci(l),u_size:new n.ci(l),u_camera_to_center_distance:new n.ci(l),u_rotate_symbol:new n.cg(l),u_aspect_ratio:new n.ci(l),u_fade_change:new n.ci(l),u_matrix:new n.ck(l),u_label_plane_matrix:new n.ck(l),u_coord_matrix:new n.ck(l),u_is_text:new n.cg(l),u_elevation_from_sea:new n.cg(l),u_pitch_with_map:new n.cg(l),u_texsize:new n.cj(l),u_texsize_icon:new n.cj(l),u_texture:new n.cg(l),u_texture_icon:new n.cg(l),u_gamma_scale:new n.ci(l),u_device_pixel_ratio:new n.ci(l),u_tile_id:new n.ch(l),u_zoom_transition:new n.ci(l),u_inv_rot_matrix:new n.ck(l),u_merc_center:new n.cj(l),u_camera_forward:new n.ch(l),u_tile_matrix:new n.ck(l),u_up_vector:new n.ch(l),u_ecef_origin:new n.ch(l),u_is_halo:new n.cg(l),u_icon_transition:new n.ci(l),u_color_adj_mat:new n.ck(l),u_scale_factor:new n.ci(l),u_ground_shadow_factor:new n.ch(l),u_inv_matrix:new n.ck(l),u_normal_scale:new n.ci(l),u_lutTexture:new n.cg(l)}),background:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_opacity:new n.ci(l),u_color:new n.dA(l)}),backgroundPattern:l=>({u_matrix:new n.ck(l),u_emissive_strength:new n.ci(l),u_opacity:new n.ci(l),u_image:new n.cg(l),u_pattern_tl:new n.cj(l),u_pattern_br:new n.cj(l),u_texsize:new n.cj(l),u_pattern_size:new n.cj(l),u_pixel_coord_upper:new n.cj(l),u_pixel_coord_lower:new n.cj(l),u_pattern_units_to_pixels:new n.cj(l)}),terrainRaster:l=>({u_matrix:new n.ck(l),u_image0:new n.cg(l),u_skirt_height:new n.ci(l),u_ground_shadow_factor:new n.ch(l)}),skybox:l=>({u_matrix:new n.ck(l),u_sun_direction:new n.ch(l),u_cubemap:new n.cg(l),u_opacity:new n.ci(l),u_temporal_offset:new n.ci(l)}),skyboxGradient:l=>({u_matrix:new n.ck(l),u_color_ramp:new n.cg(l),u_center_direction:new n.ch(l),u_radius:new n.ci(l),u_opacity:new n.ci(l),u_temporal_offset:new n.ci(l)}),skyboxCapture:l=>({u_matrix_3f:new n.dB(l),u_sun_direction:new n.ch(l),u_sun_intensity:new n.ci(l),u_color_tint_r:new n.d2(l),u_color_tint_m:new n.d2(l),u_luminance:new n.ci(l)}),globeRaster:l=>({u_proj_matrix:new n.ck(l),u_globe_matrix:new n.ck(l),u_normalize_matrix:new n.ck(l),u_merc_matrix:new n.ck(l),u_zoom_transition:new n.ci(l),u_merc_center:new n.cj(l),u_image0:new n.cg(l),u_grid_matrix:new n.dB(l),u_skirt_height:new n.ci(l),u_far_z_cutoff:new n.ci(l),u_frustum_tl:new n.ch(l),u_frustum_tr:new n.ch(l),u_frustum_br:new n.ch(l),u_frustum_bl:new n.ch(l),u_globe_pos:new n.ch(l),u_globe_radius:new n.ci(l),u_viewport:new n.cj(l)}),globeAtmosphere:l=>({u_frustum_tl:new n.ch(l),u_frustum_tr:new n.ch(l),u_frustum_br:new n.ch(l),u_frustum_bl:new n.ch(l),u_horizon:new n.ci(l),u_transition:new n.ci(l),u_fadeout_range:new n.ci(l),u_atmosphere_fog_color:new n.d2(l),u_high_color:new n.d2(l),u_space_color:new n.d2(l),u_temporal_offset:new n.ci(l),u_horizon_angle:new n.ci(l)}),model:l=>({u_matrix:new n.ck(l),u_lighting_matrix:new n.ck(l),u_normal_matrix:new n.ck(l),u_node_matrix:new n.ck(l),u_lightpos:new n.ch(l),u_lightintensity:new n.ci(l),u_lightcolor:new n.ch(l),u_camera_pos:new n.ch(l),u_opacity:new n.ci(l),u_baseColorFactor:new n.d2(l),u_emissiveFactor:new n.d2(l),u_metallicFactor:new n.ci(l),u_roughnessFactor:new n.ci(l),u_baseTextureIsAlpha:new n.cg(l),u_alphaMask:new n.cg(l),u_alphaCutoff:new n.ci(l),u_baseColorTexture:new n.cg(l),u_metallicRoughnessTexture:new n.cg(l),u_normalTexture:new n.cg(l),u_occlusionTexture:new n.cg(l),u_emissionTexture:new n.cg(l),u_lutTexture:new n.cg(l),u_color_mix:new n.d2(l),u_aoIntensity:new n.ci(l),u_emissive_strength:new n.ci(l),u_occlusionTextureTransform:new n.d2(l)}),modelDepth:l=>({u_matrix:new n.ck(l),u_instance:new n.ck(l),u_node_matrix:new n.ck(l)}),groundShadow:l=>({u_matrix:new n.ck(l),u_ground_shadow_factor:new n.ch(l)}),stars:l=>({u_matrix:new n.ck(l),u_up:new n.ch(l),u_right:new n.ch(l),u_intensity_multiplier:new n.ci(l)}),snowParticle:l=>({u_modelview:new n.ck(l),u_projection:new n.ck(l),u_time:new n.ci(l),u_cam_pos:new n.ch(l),u_velocityConeAperture:new n.ci(l),u_velocity:new n.ci(l),u_horizontalOscillationRadius:new n.ci(l),u_horizontalOscillationRate:new n.ci(l),u_boxSize:new n.ci(l),u_billboardSize:new n.ci(l),u_simpleShapeParameters:new n.cj(l),u_screenSize:new n.cj(l),u_thinningCenterPos:new n.cj(l),u_thinningShape:new n.ch(l),u_thinningAffectedRatio:new n.ci(l),u_thinningParticleOffset:new n.ci(l),u_particleColor:new n.d2(l),u_direction:new n.ch(l)}),rainParticle:l=>({u_modelview:new n.ck(l),u_projection:new n.ck(l),u_time:new n.ci(l),u_cam_pos:new n.ch(l),u_texScreen:new n.cg(l),u_velocityConeAperture:new n.ci(l),u_velocity:new n.ci(l),u_boxSize:new n.ci(l),u_rainDropletSize:new n.cj(l),u_distortionStrength:new n.ci(l),u_rainDirection:new n.ch(l),u_color:new n.d2(l),u_screenSize:new n.cj(l),u_thinningCenterPos:new n.cj(l),u_thinningShape:new n.ch(l),u_thinningAffectedRatio:new n.ci(l),u_thinningParticleOffset:new n.ci(l),u_shapeDirectionalPower:new n.ci(l),u_shapeNormalPower:new n.ci(l),u_mode:new n.ci(l)}),vignette:l=>({u_vignetteShape:new n.ch(l),u_vignetteColor:new n.d2(l)}),occlusion:l=>({u_matrix:new n.ck(l),u_anchorPos:new n.ch(l),u_screenSizePx:new n.cj(l),u_occluderSizePx:new n.cj(l),u_color:new n.d2(l)})};class Gl{constructor(t,o,c,f){this.id=Gl.uniqueIdxCounter,Gl.uniqueIdxCounter++,this.context=t;let _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||f||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Gl.uniqueIdxCounter,Gl.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Gl.uniqueIdxCounter=0;let ng={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ev{constructor(t,o,c,f,_,x){this.length=o.length,this.attributes=c,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.instanceCount=x,this.context=t;let S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let c=0;c<this.attributes.length;c++){let f=o.getAttributeLocation(t,this.attributes[c].name);f!==-1&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,o,c){for(let f=0;f<this.attributes.length;f++){let _=this.attributes[f],x=o.getAttributeLocation(t,_.name);x!==-1&&t.vertexAttribPointer(x,_.components,t[ng[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,o,c){for(let f=0;f<this.attributes.length;f++){let _=o.getAttributeLocation(t,this.attributes[f].name);_!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lh{constructor(t,o,c,f,_){this.context=t,this.width=o,this.height=c;let x=this.framebuffer=t.gl.createFramebuffer();f&&(this.colorAttachment=new $y(t,x)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Xm(t,x):new Xy(t,x))}destroy(){let t=this.context.gl;if(this.colorAttachment){let o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{let o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class ch{constructor(t,o){this.gl=t,this.clearColor=new m(this),this.clearDepth=new C(this),this.clearStencil=new z(this),this.colorMask=new U(this),this.depthMask=new Q(this),this.stencilMask=new fe(this),this.stencilFunc=new Ve(this),this.stencilOp=new ut(this),this.stencilTest=new wt(this),this.depthRange=new Ut(this),this.depthTest=new fi(this),this.depthFunc=new Vi(this),this.blend=new vr(this),this.blendFunc=new lo(this),this.blendColor=new In(this),this.blendEquation=new co(this),this.cullFace=new eo(this),this.cullFaceSide=new Cs(this),this.frontFace=new Gd(this),this.program=new nd(this),this.activeTexture=new Hd(this),this.viewport=new sl(this),this.bindFramebuffer=new ru(this),this.bindRenderbuffer=new Tc(this),this.bindTexture=new Dn(this),this.bindVertexBuffer=new al(this),this.bindElementBuffer=new Cc(this),this.bindVertexArrayOES=new Zd(this),this.pixelStoreUnpack=new $d(this),this.pixelStoreUnpackPremultiplyAlpha=new nu(this),this.pixelStoreUnpackFlipY=new ll(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,c){return new Gl(this,t,o,c)}createVertexBuffer(t,o,c,f,_){return new ev(this,t,o,c,f,_)}createRenderbuffer(t,o,c){let f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,t,o,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,o,c,f){return new lh(this,t,o,c,f)}clear({color:t,depth:o,stencil:c,colorMask:f}){let _=this.gl,x=0;t&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(f||[!0,!0,!0,!0])),o!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),c!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),_.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bx(t.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ja;function ud(l,t,o,c,f,_,x){let S=l.context,E=S.gl,P=l.transform,M=[n.aF(P.center.lng),n.aJ(P.center.lat)],F=o.layout.get("symbol-placement"),O=o.layout.get("text-variable-anchor"),N=o.layout.get("icon-rotation-alignment")==="map",q=o.layout.get("text-rotation-alignment")==="map",G=F!=="point",K=[],$=0,ee=0;for(let ue=0;ue<c.length;ue++){let ve=c[ue],ze=t.getTile(ve),Ie=ze.getBucket(o);if(!Ie)continue;let Ge=Ie.getProjection().createInversionMatrix(P,ve.canonical),Be=[],Ye=$u(ve,Ie,P),gt=!x&&N&&G,De=x&&q&&G,Ee=O&&Ie.hasTextData(),Ke=Ie.hasIconTextFit()&&Ee&&Ie.hasIconData(),Ne=gt||De||x&&Ee||Ke,nt=Ie.projection.name==="globe",xt=nt?n.aj(P.zoom):0;nt&&(Be.push("PROJECTION_GLOBE_VIEW"),Ne&&Be.push("PROJECTED_POS_ON_VIEWPORT"));let Dt=l.getOrCreateProgram("collisionBox",{defines:Be}),ft=Ye;f[0]===0&&f[1]===0||(ft=l.translatePosMatrix(Ye,ze,f,_));let vt=x?Ie.textCollisionBox:Ie.iconCollisionBox,Ft=Ie.collisionCircleArray;if(Ft.length>0){let It=n.bB(),zt=ft;n.cO(It,Ie.placementInvProjMatrix,P.glCoordMatrix),n.cO(It,It,Ie.placementViewportMatrix),K.push({circleArray:Ft,circleOffset:ee,transform:zt,invTransform:It,projection:Ie.getProjection()}),$+=Ft.length/4,ee=$}if(!vt)continue;l.terrain&&l.terrain.setupElevationDraw(ze,Dt);let Lt=nt?[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z]:[0,0,0];Dt.draw(l,E.LINES,Rt.disabled,ni.disabled,l.colorModeForRenderPass(),Jt.disabled,lu(ft,Ge,P,xt,M,ze,Lt,Ie.getProjection()),o.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,null,P.zoom,null,[vt.collisionVertexBuffer,vt.collisionVertexBufferExt])}if(!x||!K.length)return;let se=l.getOrCreateProgram("collisionCircle"),ie=new n.dY;ie.resize(4*$),ie._trim();let ge=0;for(let ue of K)for(let ve=0;ve<ue.circleArray.length/4;ve++){let ze=4*ve,Ie=ue.circleArray[ze+0],Ge=ue.circleArray[ze+1],Be=ue.circleArray[ze+2],Ye=ue.circleArray[ze+3];ie.emplace(ge++,Ie,Ge,Be,Ye,0),ie.emplace(ge++,Ie,Ge,Be,Ye,1),ie.emplace(ge++,Ie,Ge,Be,Ye,2),ie.emplace(ge++,Ie,Ge,Be,Ye,3)}(!ja||ja.length<2*$)&&(ja=(function(ue){let ve=2*ue,ze=new n.b0;ze.resize(ve),ze._trim();for(let Ie=0;Ie<ve;Ie++){let Ge=6*Ie;ze.uint16[Ge+0]=4*Ie+0,ze.uint16[Ge+1]=4*Ie+1,ze.uint16[Ge+2]=4*Ie+2,ze.uint16[Ge+3]=4*Ie+2,ze.uint16[Ge+4]=4*Ie+3,ze.uint16[Ge+5]=4*Ie+0}return ze})($));let ae=S.createIndexBuffer(ja,!0),ye=S.createVertexBuffer(ie,n.dZ.members,!0);for(let ue of K){let ve={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(pe=P).getCameraToCenterDistance(ue.projection),u_viewport_size:[pe.width,pe.height]};se.draw(l,E.TRIANGLES,Rt.disabled,ni.disabled,l.colorModeForRenderPass(),Jt.disabled,ve,o.id,ye,ae,n.bf.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,P.zoom)}var pe;ye.destroy(),ae.destroy()}let Hl=n.bB();function Zp(l){let t=l._camera.getWorldToCamera(l.worldSize,1),o=n.aB([],t,l.globeMatrix);n.bk(o,o);let c=[0,0,0],f=[0,1,0,0];return n.aC(f,f,o),c[0]=f[0],c[1]=f[1],c[2]=f[2],n.aw(c,c),c}function uh({width:l,height:t,anchor:o,textOffset:c,textScale:f},_){let{horizontalAlign:x,verticalAlign:S}=n.c0(o),E=-(x-.5)*l,P=-(S-.5)*t,M=n.c1(o,c);return new n.P((E/f+M[0])*_,(P/f+M[1])*_)}function dh(l,t,o,c,f,_,x,S,E,P){let M=l.text.placedSymbolArray,F=l.text.dynamicLayoutVertexArray,O=l.icon.dynamicLayoutVertexArray,N={},q=l.getProjection(),G=zr(x,q,f),K=f.elevation,$=q.upVectorScale(x.canonical,f.center.lat,f.worldSize).metersToTile;F.clear();for(let ee=0;ee<M.length;ee++){let se=M.get(ee),{tileAnchorX:ie,tileAnchorY:ge,numGlyphs:ae}=se,ye=se.hidden||!se.crossTileID||l.allowVerticalPlacement&&!se.placedOrientation?null:c[se.crossTileID];if(ye){let pe=0,ue=0,ve=0,ze=l.elevationType==="road";if(K||ze){let Ne=ze?l.getElevationFeatureForText(ee):null,nt=n.bU.getAtTileOffset(x,new n.P(ie,ge),K,Ne),[xt,Dt,ft]=q.upVector(x.canonical,ie,ge);pe=nt*xt*$,ue=nt*Dt*$,ve=nt*ft*$}let[Ie,Ge,Be,Ye]=kn(se.projectedAnchorX+pe,se.projectedAnchorY+ue,se.projectedAnchorZ+ve,o?G:_),gt=Xu(f.getCameraToCenterDistance(q),Ye),De=n.bL(l.textSizeData,E,se)*gt/n.bX;o&&(De*=l.tilePixelRatio/S);let Ee=uh(ye,De);o?({x:Ie,y:Ge,z:Be}=q.projectTilePoint(ie+Ee.x,ge+Ee.y,x.canonical),[Ie,Ge,Be]=kn(Ie+pe,Ge+ue,Be+ve,_)):(t&&Ee._rotate(-f.angle),Ie+=Ee.x,Ge+=Ee.y,Be=0);let Ke=l.allowVerticalPlacement&&se.placedOrientation===n.bK.vertical?Math.PI/2:0;for(let Ne=0;Ne<ae;Ne++)n.bN(F,Ie,Ge,Be,Ke);P&&se.associatedIconIndex>=0&&(N[se.associatedIconIndex]={x:Ie,y:Ge,z:Be,angle:Ke})}else Ws(ae,F)}if(P){O.clear();let ee=l.icon.placedSymbolArray;for(let se=0;se<ee.length;se++){let ie=ee.get(se),{numGlyphs:ge}=ie,ae=N[se];if(ie.hidden||!ae)Ws(ge,O);else{let{x:ye,y:pe,z:ue,angle:ve}=ae;for(let ze=0;ze<ge;ze++)n.bN(O,ye,pe,ue,ve)}}l.icon.dynamicLayoutVertexBuffer.updateData(O)}l.text.dynamicLayoutVertexBuffer.updateData(F)}function dd(l,t,o,c,f,_,x={}){let S=o.paint.get("icon-translate"),E=o.paint.get("text-translate"),P=o.paint.get("icon-translate-anchor"),M=o.paint.get("text-translate-anchor"),F=o.layout.get("icon-rotation-alignment"),O=o.layout.get("text-rotation-alignment"),N=o.layout.get("icon-pitch-alignment"),q=o.layout.get("text-pitch-alignment"),G=o.layout.get("icon-keep-upright"),K=o.layout.get("text-keep-upright"),$=o.paint.get("icon-color-saturation"),ee=o.paint.get("icon-color-contrast"),se=o.paint.get("icon-color-brightness-min"),ie=o.paint.get("icon-color-brightness-max"),ge=o.layout.get("symbol-elevation-reference")==="sea",ae=o.layout.get("icon-image-use-theme")==="none",ye=l.context,pe=ye.gl,ue=l.transform,ve=F==="map",ze=O==="map",Ie=N==="map",Ge=q==="map",Be=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ye=!1,gt=l.depthModeForSublayer(0,Rt.ReadOnly),De=new Rt(l.context.gl.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D),Ee=[n.aF(ue.center.lng),n.aJ(ue.center.lat)],Ke=o.layout.get("text-variable-anchor"),Ne=ue.projection.name==="globe",nt=[],xt=[0,-1,0];for(let Dt of c){let ft=t.getTile(Dt),vt=ft.getBucket(o);if(!vt||vt.projection.name==="mercator"&&Ne||vt.fullyClipped)continue;let Ft=vt.projection.name==="globe",Lt=Ft?n.aj(ue.zoom):0,It=zr(Dt,vt.getProjection(),ue),zt=ue.calculatePixelsToTileUnitsMatrix(ft),Yt=Ke&&vt.hasTextData(),zi=vt.hasIconTextFit()&&Yt&&vt.hasIconData(),Ui=vt.getProjection().createInversionMatrix(ue,Dt.canonical),xr=(1<<ft.tileID.canonical.z)*n.al/l.transform.worldSize,si=hr=>{let ci=[0,0,0];if(hr){let $i=l.style.directionalLight,Qr=l.style.ambientLight;$i&&Qr&&(ci=Do(l.style,$i,Qr))}return ci},ji=hr=>{ue.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||l.terrain)&&(hr.push("DEPTH_D24"),hr.push("DEPTH_OCCLUSION"))},yi=hr=>{o.lut&&!ae&&(o.lut.texture||(o.lut.texture=new n.d_(l.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],ye.gl.RGBA8)),ye.activeTexture.set(ye.gl.TEXTURE0+En.LUT),o.lut.texture&&o.lut.texture.bind(ye.gl.LINEAR,ye.gl.CLAMP_TO_EDGE),hr.push("APPLY_LUT_ON_GPU"))},gr=()=>{let hr=ve&&o.layout.get("symbol-placement")!=="point",ci=[];ji(ci),yi(ci);let $i=hr||zi,Qr=vt.elevationType==="road",yn=l.shadowRenderer,rn=Qr&&Ie&&!!yn&&yn.enabled,pn=si(rn),Ko=Qr&&Ie&&!l.terrain?De:gt,No=o.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&Ie&&ci.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(ci.push("PROJECTION_GLOBE_VIEW"),$i&&ci.push("PROJECTED_POS_ON_VIEWPORT")),No>0&&vt.hasAnySecondaryIcon&&ci.push("ICON_TRANSITION"),!vt.icon.zOffsetVertexBuffer||Qr&&l.terrain||ci.push("Z_OFFSET"),$===0&&ee===0&&se===0&&ie===1||ci.push("COLOR_ADJUSTMENT"),vt.sdfIcons&&ci.push("RENDER_SDF"),rn&&ci.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Qr&&Ie&&!l.terrain&&vt.icon.orientationVertexBuffer&&ci.push("ELEVATED_ROADS");let uo=vt.icon.programConfigurations.get(o.id),wo=l.getOrCreateProgram("symbol",{config:uo,defines:ci}),Is=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],ho=vt.iconSizeData,Ps=n.bJ(ho,ue.zoom),ea=Ie||!ue.isOrthographic,$n=zl(It,ft.tileID.canonical,Ie,ve,ue,vt.getProjection(),zt),an=ha(It,ft.tileID.canonical,Ie,ve,ue,vt.getProjection(),zt),vn=l.translatePosMatrix(an,ft,S,P,!0),Ar=l.translatePosMatrix(It,ft,S,P),wn=$i?Hl:$n,Xn=ve&&!Ie&&!hr,ln=xt;!Ne&&!ue.mercatorFromTransition||ve||(ln=Zp(ue));let Ls=Ft?ln:xt,Tu=o.getColorAdjustmentMatrix($,ee,se,ie),ml=Gp(ho.kind,Ps,Xn,Ie,l,Ar,wn,vn,ge,!1,Is,[0,0],0,Dt,Lt,Ee,Ui,Ls,vt.getProjection(),pn,xr,Tu,No,null),Cu=ft.imageAtlasTexture?ft.imageAtlasTexture:null,Eu=o.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear,zs=vt.sdfIcons||l.options.rotating||l.options.zooming||Eu||ea?pe.LINEAR:pe.NEAREST,Ua=vt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Wn=l.terrain&&Ie&&hr?n.bk(n.bB(),$n):Hl;if(hr&&vt.icon){let Ms=n.bU.getAtTileOffsetFunc(Dt,ue.center.lat,ue.worldSize,vt.getProjection()),Rc=el(It,ft.tileID.canonical,Ie,ve,ue,vt.getProjection(),zt),kg=o.layout.get("icon-size-scale-range"),zh=n.aA(l.scaleFactor,kg[0],kg[1]);mc(vt,It,l,!1,Rc,an,Ie,G,Ms,Dt,zh)}return{program:wo,buffers:vt.icon,uniformValues:ml,atlasTexture:Cu,atlasTextureIcon:null,atlasInterpolation:zs,atlasInterpolationIcon:null,isSDF:vt.sdfIcons,hasHalo:Ua,depthMode:Ko,tile:ft,renderWithShadows:rn,labelPlaneMatrixInv:Wn}},qi=()=>{let hr=ze&&o.layout.get("symbol-placement")!=="point",ci=[],$i=hr||Ke||zi,Qr=vt.elevationType==="road",yn=l.shadowRenderer,rn=Qr&&Ge&&!!yn&&yn.enabled,pn=si(rn),Ko=Qr&&Ge&&!l.terrain?De:gt;l.terrainRenderModeElevated()&&Ge&&ci.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(ci.push("PROJECTION_GLOBE_VIEW"),$i&&ci.push("PROJECTED_POS_ON_VIEWPORT")),!vt.text.zOffsetVertexBuffer||Qr&&l.terrain||ci.push("Z_OFFSET"),vt.iconsInText&&ci.push("RENDER_TEXT_AND_SYMBOL"),ci.push("RENDER_SDF"),rn&&ci.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Qr&&Ge&&!l.terrain&&vt.text.orientationVertexBuffer&&ci.push("ELEVATED_ROADS"),ji(ci);let No=vt.text.programConfigurations.get(o.id),uo=l.getOrCreateProgram("symbol",{config:No,defines:ci}),wo,Is=[0,0],ho=null,Ps=vt.textSizeData;vt.iconsInText&&(Is=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],ho=ft.imageAtlasTexture?ft.imageAtlasTexture:null,wo=Ge||!ue.isOrthographic||l.options.rotating||l.options.zooming||Ps.kind==="composite"||Ps.kind==="camera"?pe.LINEAR:pe.NEAREST);let ea=ft.glyphAtlasTexture?ft.glyphAtlasTexture.size:[0,0],$n=o.layout.get("text-size-scale-range"),an=n.aA(l.scaleFactor,$n[0],$n[1]),vn=n.bJ(Ps,ue.zoom,an),Ar=zl(It,ft.tileID.canonical,Ge,ze,ue,vt.getProjection(),zt),wn=ha(It,ft.tileID.canonical,Ge,ze,ue,vt.getProjection(),zt),Xn=l.translatePosMatrix(wn,ft,E,M,!0),ln=l.translatePosMatrix(It,ft,E,M),Ls=$i?Hl:Ar,Tu=ze&&!Ge&&!hr,ml=xt;!Ne&&!ue.mercatorFromTransition||ze||(ml=Zp(ue));let Cu=Gp(Ps.kind,vn,Tu,Ge,l,ln,Ls,Xn,ge,!0,ea,Is,0,Dt,Lt,Ee,Ui,Ft?ml:xt,vt.getProjection(),pn,xr,null,null,an),Eu=ft.glyphAtlasTexture?ft.glyphAtlasTexture:null,zs=pe.LINEAR,Ua=o.paint.get("text-halo-width").constantOr(1)!==0,Wn=l.terrain&&Ge&&hr?n.bk(n.bB(),Ar):Hl;if(hr&&vt.text){let Ms=n.bU.getAtTileOffsetFunc(Dt,ue.center.lat,ue.worldSize,vt.getProjection()),Rc=el(It,ft.tileID.canonical,Ge,ze,ue,vt.getProjection(),zt);mc(vt,It,l,!0,Rc,wn,Ge,K,Ms,Dt,an)}return{program:uo,buffers:vt.text,uniformValues:Cu,atlasTexture:Eu,atlasTextureIcon:ho,atlasInterpolation:zs,atlasInterpolationIcon:wo,isSDF:!0,hasHalo:Ua,depthMode:Ko,tile:ft,renderWithShadows:rn,labelPlaneMatrixInv:Wn}},Ir=vt.icon.segments.get().length,Ji=vt.text.segments.get().length,xi=Ir&&!x.onlyText?gr():null,dr=Ji&&!x.onlyIcons?qi():null,wi=o.paint.get("icon-opacity").constantOr(1),Fr=o.paint.get("text-opacity").constantOr(1);if(Be&&vt.canOverlap){Ye=!0;let hr=wi&&!x.onlyText?vt.icon.segments.get():[],ci=Fr&&!x.onlyIcons?vt.text.segments.get():[];for(let $i of hr)nt.push({segments:new n.bf([$i]),sortKey:$i.sortKey,state:xi});for(let $i of ci)nt.push({segments:new n.bf([$i]),sortKey:$i.sortKey,state:dr})}else x.onlyText||nt.push({segments:wi?vt.icon.segments:new n.bf([]),sortKey:0,state:xi}),x.onlyIcons||nt.push({segments:Fr?vt.text.segments:new n.bf([]),sortKey:0,state:dr})}Ye&&nt.sort(((Dt,ft)=>Dt.sortKey-ft.sortKey));for(let Dt of nt){let ft=Dt.state;if(ft)if(l.terrain?l.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}):l.setupDepthForOcclusion(ue.depthOcclusionForSymbolsAndCircles,ft.program),ye.activeTexture.set(pe.TEXTURE0),ft.atlasTexture&&ft.atlasTexture.bind(ft.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),ft.atlasTextureIcon&&(ye.activeTexture.set(pe.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),ft.renderWithShadows&&l.shadowRenderer.setupShadows(ft.tile.tileID.toUnwrapped(),ft.program,"vector-tile"),l.uploadCommonLightUniforms(l.context,ft.program),ft.hasHalo){let vt=ft.uniformValues;vt.u_is_halo=1,hh(ft.buffers,Dt.segments,o,l,ft.program,ft.depthMode,f,_,vt,2),vt.u_is_halo=0}else{if(ft.isSDF){let vt=ft.uniformValues;ft.hasHalo&&(vt.u_is_halo=1,hh(ft.buffers,Dt.segments,o,l,ft.program,ft.depthMode,f,_,vt,1)),vt.u_is_halo=0}hh(ft.buffers,Dt.segments,o,l,ft.program,ft.depthMode,f,_,ft.uniformValues,1)}}}function hh(l,t,o,c,f,_,x,S,E,P){let M=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];f.draw(c,c.context.gl.TRIANGLES,_,x,S,Jt.disabled,E,o.id,l.layoutVertexBuffer,l.indexBuffer,t,o.paint,c.transform.zoom,l.programConfigurations.get(o.id),M,P)}function og(l,t){let o=1<<l.canonical.z,c=(t.x*o-l.canonical.x-l.wrap*o)*n.al,f=(t.y*o-l.canonical.y)*n.al,_=n.e7(t.z,t.y);return n.d4(c,f,_)}function Ic(l,t,o,c,f){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;let _=l.context.gl,x=new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),S=new Rt(l.context.gl.GREATER,Rt.ReadWrite,l.depthRangeFor3D),E=(function(N){let q=.01;return N.isOrthographic&&(q=n.ak(1e-4,q,n.c$(N.pitch>=Po?1:N.pitch/Po))),2*q})(l.transform),P=l.transform.getFreeCameraOptions().position,M="elevatedStructuresDepthReconstruct",F=l.getOrCreateProgram(M,{defines:["DEPTH_RECONSTRUCTION"]}),O=l.getOrCreateProgram(M);for(let N of c){let q=t.getTile(N),G=q.getBucket(o);if(!G)continue;let K=G.elevatedStructures;if(!K)continue;let $=G.elevationBufferData.heightRange,ee=og(N.toUnwrapped(),P),se=l.translatePosMatrix(N.projMatrix,q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),ie,ge,ae,ye;if(f==="initialize"){if(!$||$.min>=1||K.depthSegments.segments[0].primitiveLength===0)continue;ie=th(se,ee,E,1,0),ge=x,ae=K.depthSegments,ye=F}else if(f==="reset"){if(!$||$.min>=0||K.maskSegments.segments[0].primitiveLength===0)continue;ie=th(se,ee,0,0,1),ge=S,ae=K.maskSegments,ye=F}else if(f==="geometry"){if(K.depthSegments.segments[0].primitiveLength===0)continue;ie=th(se,ee,E,1,0),ge=x,ae=K.depthSegments,ye=O}ye.draw(l,_.TRIANGLES,ge,ni.disabled,vi.disabled,Jt.disabled,ie,o.id,K.vertexBuffer,K.indexBuffer,ae,o.paint,l.transform.zoom)}}function uu(l,t,o){let{painter:c,sourceCache:f,layer:_,coords:x,colorMode:S,elevationType:E,terrainEnabled:P,pass:M}=l,F=c.context.gl,O=_.paint.get("fill-pattern"),N=_.paint.get("fill-pattern-cross-fade"),q=O.constantOr(null),G=E;E!=="road"||t&&!P||(G="none");let K=G==="road",$=l.painter.shadowRenderer,ee=K&&!!$&&$.enabled,se=new Rt(c.context.gl.LEQUAL,Rt.ReadOnly,c.depthRangeFor3D),ie=[0,0,0];if(ee){let ye=c.style.directionalLight,pe=c.style.ambientLight;ye&&pe&&(ie=Do(c.style,ye,pe))}let ge=O&&O.constantOr(1),ae=(ye,pe)=>{let ue,ve,ze,Ie,Ge;pe?(ue=ge&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ze=F.LINES):(ue=ge?"fillPattern":"fill",ze=F.TRIANGLES);for(let Be of x){let Ye=f.getTile(Be);if(ge&&!Ye.patternsLoaded())continue;let gt=Ye.getBucket(_);if(!gt)continue;let De=t?gt.elevationBufferData:gt.bufferData;if(De.isEmpty())continue;c.prepareDrawTile();let Ee=De.programConfigurations.get(_.id),Ke=c.isTileAffectedByFog(Be),Ne=[],nt=[];K&&(Ne.push("ELEVATED_ROADS"),nt.push(De.elevatedLayoutVertexBuffer)),ee&&Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&(c.context.activeTexture.set(F.TEXTURE0),Ye.imageAtlasTexture&&Ye.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ee.updatePaintBuffers());let xt=!1;if(q&&Ye.imageAtlas){let Lt=Ye.imageAtlas,It=n.e2.from(q),zt=It.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Yt=It.getSecondary(),zi=Lt.patternPositions.get(zt),Ui=Yt?Lt.patternPositions.get(Yt.scaleSelf(n.o.devicePixelRatio).toString()):null;xt=!!zi&&!!Ui,zi&&Ee.setConstantPatternPositions(zi,Ui)}N>0&&(xt||Ee.getPatternTransitionVertexBuffer("fill-pattern"))&&Ne.push("FILL_PATTERN_TRANSITION");let Dt=c.getOrCreateProgram(ue,{config:Ee,overrideFog:Ke,defines:Ne}),ft=c.translatePosMatrix(Be.projMatrix,Ye,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));ee&&$.setupShadows(Ye.tileID.toUnwrapped(),Dt,"vector-tile");let vt=_.paint.get("fill-emissive-strength");if(pe){Ie=De.lineIndexBuffer,Ge=De.lineSegments;let Lt=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];ve=ue==="fillOutlinePattern"&&ge?Ky(ft,vt,c,Ye,Lt,ie,N):Yy(ft,vt,Lt,ie)}else Ie=De.indexBuffer,Ge=De.triangleSegments,ve=ge?eg(ft,vt,c,Ye,ie,N):Qm(ft,vt,ie);c.uploadCommonUniforms(c.context,Dt,Be.toUnwrapped());let Ft=ye;(E==="road"&&!P||E==="offset")&&(Ft=se),Dt.draw(c,ze,Ft,o||c.stencilModeForClipping(Be),S,Jt.disabled,ve,_.id,De.layoutVertexBuffer,Ie,Ge,_.paint,c.transform.zoom,Ee,nt)}};c.renderPass===M&&ae(c.depthModeForSublayer(1,c.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly),!1),G==="none"&&c.renderPass==="translucent"&&_.paint.get("fill-antialias")&&ae(c.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly),!0)}function Ot(l,t,o,c,f,_,x,S){o.resetLayerRenderingStats(l);let E=l.context,P=E.gl,M=l.transform,F=o.paint.get("fill-extrusion-pattern"),O=o.paint.get("fill-extrusion-pattern-cross-fade"),N=F.constantOr(null),q=F.constantOr(1),G=o.paint.get("fill-extrusion-opacity"),K=l.style.enable3dLights(),$=o.paint.get(K&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],se=o.layout.get("fill-extrusion-edge-radius"),ie=se>0&&!o.paint.get("fill-extrusion-rounded-roof"),ge=ie?0:se,ae=M.projection.name==="globe"?n.ea():0,ye=M.projection.name==="globe",pe=ye?n.aj(M.zoom):0,ue=[n.aF(M.center.lng),n.aJ(M.center.lat)],ve=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ze=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ve?null:o.lut).toArray01().slice(0,3),Ie=o.paint.get("fill-extrusion-flood-light-intensity"),Ge=o.paint.get("fill-extrusion-vertical-scale"),Be=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=o.paint.get("fill-extrusion-height-alignment"),gt=o.paint.get("fill-extrusion-base-alignment"),De=Zs(l,o.paint.get("fill-extrusion-cutoff-fade-range")),Ee=[],Ke;ye&&Ee.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Ee.push("FAUX_AO"),ie&&Ee.push("ZERO_ROOF_RADIUS"),S&&Ee.push("HAS_CENTROID"),Ie>0&&Ee.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),Be&&Ee.push("RENDER_WALL_MODE");let Ne=l.renderPass==="shadow",nt=l.shadowRenderer,xt=Ne&&!!nt,Dt=Ne?Jt.disabled:Jt.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let ft=[0,0,0];if(nt){let Lt=l.style.directionalLight,It=l.style.ambientLight;Lt&&It&&(ft=Do(l.style,Lt,It)),Ne||(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nt.useNormalOffset&&Ee.push("NORMAL_OFFSET")),Ke=Ee.concat(["SHADOWS_SINGLE_CASCADE"])}let vt=xt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",Ft=o.getLayerRenderingStats();for(let Lt of c){let It=t.getTile(Lt),zt=It.getBucket(o);if(!zt||zt.projection.name!==M.projection.name)continue;let Yt=!1;nt&&(Yt=nt.getMaxCascadeForTile(Lt.toUnwrapped())===0);let zi=l.isTileAffectedByFog(Lt),Ui=zt.programConfigurations.get(o.id),xr=!1;if(N&&It.imageAtlas){let Ji=It.imageAtlas,xi=n.e2.from(N),dr=xi.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),wi=xi.getSecondary(),Fr=Ji.patternPositions.get(dr),hr=wi?Ji.patternPositions.get(wi.scaleSelf(n.o.devicePixelRatio).toString()):null;xr=!!Fr&&!!hr,Fr&&Ui.setConstantPatternPositions(Fr,hr)}O>0&&(xr||Ui.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ee.push("FILL_EXTRUSION_PATTERN_TRANSITION");let si=l.getOrCreateProgram(vt,{config:Ui,defines:Yt?Ke:Ee,overrideFog:zi});if(l.terrain&&l.terrain.setupElevationDraw(It,si,{useMeterToDem:!0}),!zt.centroidVertexBuffer){let Ji=si.getAttributeLocation(P,"a_centroid_pos");Ji!==-1&&P.vertexAttrib2f(Ji,0,0)}!Ne&&nt&&nt.setupShadows(It.tileID.toUnwrapped(),si,"vector-tile"),q&&(l.context.activeTexture.set(P.TEXTURE0),It.imageAtlasTexture&&It.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ui.updatePaintBuffers());let ji=o.paint.get("fill-extrusion-vertical-gradient"),yi=1/zt.tileToMeter,gr;if(Ne&&nt){if(sg(It.tileID,zt.maxHeight,l))continue;let Ji=nt.calculateShadowPassMatrixFromTile(It.tileID.toUnwrapped());gr=Km(Ji,ge,yi,Ge,Ye,gt)}else{let Ji=l.translatePosMatrix(Lt.expandedProjMatrix,It,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),xi=M.projection.createInversionMatrix(M,Lt.canonical);gr=q?Jm(Ji,l,ji,G,ee,ge,yi,Lt,It,ae,Ye,gt,pe,ue,xi,ze,Ge,O):eh(Ji,l,ji,G,ee,ge,yi,Lt,ae,Ye,gt,pe,ue,xi,ze,Ge,Ie,ft)}l.uploadCommonUniforms(E,si,Lt.toUnwrapped(),null,De);let qi=zt.segments;if(M.projection.name==="mercator"&&!Ne&&(qi=zt.getVisibleSegments(It.tileID,l.terrain,l.transform.getFrustum(0)),!qi.get().length))continue;if(Ft)if(Ne)for(let Ji of qi.get())Ft.numRenderedVerticesInShadowPass+=Ji.primitiveLength;else for(let Ji of qi.get())Ft.numRenderedVerticesInTransparentPass+=Ji.primitiveLength;let Ir=[];(l.terrain||S)&&Ir.push(zt.centroidVertexBuffer),ye&&Ir.push(zt.layoutVertexExtBuffer),Be&&Ir.push(zt.wallVertexBuffer),si.draw(l,E.gl.TRIANGLES,f,_,x,Dt,gr,o.id,zt.layoutVertexBuffer,zt.indexBuffer,qi,o.paint,l.transform.zoom,Ui,Ir)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}class $p{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ul(l,t,o,c,f,_,x,S,E,P,M,F,O,N,q,G,K,$,ee,se){let ie=t.context,ge=ie.gl,ae=t.transform,ye=t.transform.zoom,pe=[],ue=l.translate,ve=l.translateAnchor,ze=l.edgeRadius,Ie=Zs(t,l.cutoffFadeRange);M==="clear"?(pe.push("CLEAR_SUBPASS"),se&&(pe.push("CLEAR_FROM_TEXTURE"),ie.activeTexture.set(ge.TEXTURE0),se.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):M==="sdf"&&pe.push("SDF_SUBPASS"),$&&pe.push("HAS_CENTROID"),Ie.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");let Ge=(Be,Ye,gt,De,Ee)=>{let Ke=pe;Ye.groundRadiusBuffer!=null&&(Ke=pe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));let Ne=Ye.programConfigurations.get(c.id),nt=t.isTileAffectedByFog(Be),xt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ne,defines:Ke,overrideFog:nt}),Dt=au(t,De,F,P,Ee,[O,N*Ee],q,G,K,ye>=17?0:ze*Ee,se?se.size[0]:0),ft=[];$&&ft.push(Ye.hiddenByLandmarkVertexBuffer),Ye.groundRadiusBuffer!=null&&ft.push(Ye.groundRadiusBuffer),t.uploadCommonUniforms(ie,xt,Be.toUnwrapped(),null,Ie),xt.draw(t,ie.gl.TRIANGLES,_,x,S,E,Dt,c.id,Ye.vertexBuffer,Ye.indexBuffer,gt,c.paint,ye,Ne,ft)};for(let Be of f){let Ye=o.getTile(Be),gt=Ye.getBucket(c);if(!gt||gt.projection.name!==ae.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;let De=gt.groundEffect,Ee=1/gt.tileToMeter;{let Ke=t.translatePosMatrix(Be.projMatrix,Ye,ue,ve),Ne=De.getDefaultSegment();Ge(Be,De,Ne,Ke,Ee)}if(ee)for(let Ke=0;Ke<4;Ke++){let Ne=n.e8[Ke](Be),nt=o.getTile(Ne);if(!nt)continue;let xt=nt.getBucket(c);if(!xt||xt.projection.name!==ae.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;let Dt=xt.groundEffect,ft,vt;Ke===0?(ft=[-n.al,0,0],vt=1):Ke===1?(ft=[n.al,0,0],vt=0):Ke===2?(ft=[0,-n.al,0],vt=3):(ft=[0,n.al,0],vt=2);let Ft=Dt.regionSegments[vt];if(!Ft)continue;let Lt=new Float32Array(16);n.bq(Lt,Be.projMatrix,ft),Ge(Be,Dt,Ft,t.translatePosMatrix(Lt,Ye,ue,ve),Ee)}}}function Zl(l,t,o,c,f,_,x){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();let S=_?_.findDEMTileFor(o):null;if(!(S&&S.dem||x))return;_&&S&&S.dem&&c.selfDEMTileTimestamp!==S.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=S.dem._timestamp);let E=$=>new n.P(Math.ceil(($+n.ec)*n.ed),0),P=$=>{let ee=t.getSource().minzoom,se=ge=>{let ae=t.getTileByID(ge);if(ae&&ae.hasData())return ae.getBucket(f)},ie=[0,-1,1];for(let ge of ie){if($.overscaledZ+ge<ee)continue;let ae=se($.calculateScaledKey($.overscaledZ+ge));if(ae)return ae}},M=[0,0,0],F=($,ee)=>(M[0]=Math.min($.min.y,ee.min.y),M[1]=Math.max($.max.y,ee.max.y),M[2]=n.al-ee.min.x>$.max.x?ee.min.x-n.al:$.max.x,M),O=($,ee)=>(M[0]=Math.min($.min.x,ee.min.x),M[1]=Math.max($.max.x,ee.max.x),M[2]=n.al-ee.min.y>$.max.y?ee.min.y-n.al:$.max.y,M),N=[($,ee)=>F($,ee),($,ee)=>F(ee,$),($,ee)=>O($,ee),($,ee)=>O(ee,$)],q=($,ee,se,ie,ge,ae,ye)=>{if(!_)return 0;let pe=[[ae?se:$,ae?$:se,0],[ae?se:ee,ae?ee:se,0]],ue=ye<0?n.al+ye:ye,ve=[ae?ue:($+ee)/2,ae?($+ee)/2:ue,0];return se===0&&ye<0||se!==0&&ye>0?_.getForTilePoints(ge,[ve],!0,ie):pe.push(ve),_.getForTilePoints(o,pe,!0,S),Math.max(pe[0][2],pe[1][2],ve[2])/_.exaggeration()};for(let $=0;$<4;$++){let ee=c.borderFeatureIndices[$];if(ee.length===0)continue;let se=n.e8[$](o),ie=P(se);if(!(ie&&ie instanceof n.e9))continue;let ge=_?_.findDEMTileFor(se):null;if(!(ge&&ge.dem||x)||(_&&ge&&ge.dem&&c.borderDEMTileTimestamp[$]!==ge.dem._timestamp&&(c.borderDoneWithNeighborZ[$]=-1,c.borderDEMTileTimestamp[$]=ge.dem._timestamp),c.borderDoneWithNeighborZ[$]===ie.canonical.z))continue;ie.centroidVertexArray.length===0&&ie.createCentroidsBuffer();let ae=($<2?1:5)-$,ye=ie.borderDoneWithNeighborZ[ae]!==c.canonical.z,pe=ie.borderFeatureIndices[ae],ue=0;if(c.canonical.z!==ie.canonical.z){for(let ve of ee)c.showCentroid(c.featuresOnBorder[ve]);if(ye)for(let ve of pe)ie.showCentroid(ie.featuresOnBorder[ve]);c.borderDoneWithNeighborZ[$]=ie.canonical.z,ie.borderDoneWithNeighborZ[ae]=c.canonical.z}for(let ve of ee){let ze=c.featuresOnBorder[ve],Ie=c.centroidData[ze.centroidDataIndex],Ge=ze.borders[$],Be;for(;ue<pe.length;){Be=ie.featuresOnBorder[pe[ue]];let Ye=Be.borders[ae];if(Ye[1]>Ge[0]+3||Ye[0]>Ge[0]-3)break;ie.showCentroid(Be),ue++}if(Be&&ue<pe.length){let Ye=ue,gt=0;for(;!(Be.borders[ae][0]>Ge[1]-3)&&(gt++,++ue!==pe.length);)Be=ie.featuresOnBorder[pe[ue]];Be=ie.featuresOnBorder[pe[Ye]];let De=!1;if(gt>=1){let Ne=Be.borders[ae];Math.abs(Ge[0]-Ne[0])<3&&Math.abs(Ge[1]-Ne[1])<3&&(gt=1,De=!0,ue=Ye+1)}else if(gt===0){c.showCentroid(ze);continue}let Ee=ie.centroidData[Be.centroidDataIndex];x&&De&&(((G=Ie).flags|(K=Ee).flags)&n.eb?(G.flags|=n.eb,K.flags|=n.eb):(G.flags&=~n.eb,K.flags&=~n.eb));let Ke=ze.intersectsCount()>1||Be.intersectsCount()>1;if(gt>1)ue=Ye,Ie.centroidXY=Ee.centroidXY=new n.P(0,0);else if(ge&&ge.dem&&!Ke){let Ne=N[$](Ie,Ee),nt=$%2?n.al-1:0,xt=q(Ne[0],Math.min(n.al-1,Ne[1]),nt,ge,se,$<2,Ne[2]);Ie.centroidXY=Ee.centroidXY=E(xt)}else Ke?Ie.centroidXY=Ee.centroidXY=new n.P(0,0):(Ie.centroidXY=c.encodeBorderCentroid(ze),Ee.centroidXY=ie.encodeBorderCentroid(Be));c.writeCentroidToBuffer(Ie),ie.writeCentroidToBuffer(Ee)}else c.showCentroid(ze)}c.borderDoneWithNeighborZ[$]=ie.canonical.z,ie.borderDoneWithNeighborZ[ae]=c.canonical.z}var G,K;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}let $l=[1,0,0],Xt=[0,1,0],Xp=[0,0,1];function sg(l,t,o){let c=o.transform,f=o.shadowRenderer;if(!f)return!0;let _=l.toUnwrapped(),x=c.tileSize*f._cascades[o.currentShadowCascade].scale,S=t;if(c.elevation){let G=c.elevation.getMinMaxForTile(l);G&&(S+=G.max)}let E=[...f.shadowDirection];E[2]=-E[2];let P=f.computeSimplifiedTileShadowVolume(_,S,x,E);if(!P)return!1;let M=[$l,Xt,Xp,E,[E[0],0,E[2]],[0,E[1],E[2]]],F=c.projection.name==="globe",O=c.scaleZoom(x),N=n.cA.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,O,!F),q=f.getCurrentCascadeFrustum();return N.intersectsPrecise(P.vertices,P.planes,M)===0||q.intersectsPrecise(P.vertices,P.planes,M)===0}function ph(l){let{painter:t,source:o,layer:c,coords:f}=l,_=l.defines,x=t.context,S=t.renderPass==="shadow",E=t.renderPass==="light-beam",P=t.shadowRenderer,M=n.ee(t.transform.center.lat,t.transform.zoom),F=Zs(t,c.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(_=_.concat("RENDER_CUTOFF")),l.floodLightIntensity>0&&(_=_.concat("FLOOD_LIGHT"));for(let O of f){let N=o.getTile(O),q=N.getBucket(c);if(!q)continue;P&&P.getMaxCascadeForTile(O.toUnwrapped())===0&&(_=_.concat("SHADOWS_SINGLE_CASCADE"));let G=q.programConfigurations.get(c.id),K,$,ee,se=t.translatePosMatrix(O.expandedProjMatrix,N,[0,0],"map");if(se=n.cR(n.bB(),se,[1,1,l.verticalScale]),S&&P){if(sg(N.tileID,q.maxHeight*M,t))continue;let ge=P.calculateShadowPassMatrixFromTile(N.tileID.toUnwrapped());ge=n.cR(n.bB(),ge,[1,1,l.verticalScale]),ee=tg(ge),K=$=t.getOrCreateProgram("buildingDepth",{config:G,defines:_,overrideFog:!1})}else if(E)K=$=t.getOrCreateProgram("buildingBloom",{config:G,defines:_,overrideFog:!1}),ee=Vp(se);else{let ge=t.transform.calculatePosMatrix(O.toUnwrapped(),t.transform.worldSize);n.cR(ge,ge,[1,1,l.verticalScale]);let ae=n.bB();n.cR(ae,ge,[1,-1,1/M]),n.bk(ae,ae),n.ef(ae,ae);let ye=t.transform.getFreeCameraOptions().position,pe=1<<O.canonical.z;if(ee=jp(se,ae,l.opacity,l.facadeAOIntensity,[((ye.x-O.wrap)*pe-O.canonical.x)*n.al,(ye.y*pe-O.canonical.y)*n.al,ye.z*pe*n.al],q.tileToMeter,l.facadeEmissiveChance,l.floodLightColor,l.floodLightIntensity),$=t.getOrCreateProgram("building",{config:G,defines:_,overrideFog:!1}),l.depthOnly===!0)K=$;else{let ue=_.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);K=t.getOrCreateProgram("building",{config:G,defines:ue,overrideFog:!1})}P&&(P.setupShadowsFromMatrix(ge,$,!0),K!==$&&P.setupShadowsFromMatrix(ge,K,!0))}let ie=(ge,ae)=>{if(E){let ye=ge.entranceBloom;ae.draw(t,x.gl.TRIANGLES,l.depthMode,ni.disabled,l.blendMode,Jt.disabled,ee,c.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segmentsBucket,c.paint,t.transform.zoom,G,[ye.layoutAttenuationBuffer,ye.layoutColorBuffer])}else{let ye=ge.segmentsBucket,pe=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(pe=pe.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),ae.draw(t,x.gl.TRIANGLES,l.depthMode,ni.disabled,l.blendMode,S?Jt.disabled:Jt.backCW,ee,c.id,ge.layoutVertexBuffer,ge.indexBuffer,ye,c.paint,t.transform.zoom,G,pe)}};t.uploadCommonUniforms(x,$,O.toUnwrapped(),null,F),q.buildingWithoutFacade&&ie(q.buildingWithoutFacade,$),q.buildingWithFacade&&(K!==$&&t.uploadCommonUniforms(x,K,O.toUnwrapped(),null,F),ie(q.buildingWithFacade,K))}}function fh(l,t,o,c,f,_,x,S,E,P,M,F,O){let N=l.context.gl,q=l.depthModeForSublayer(1,Rt.ReadOnly,N.LEQUAL,!0),G=.1*(1-(K=M))+3*K;var K;let $=l._showOverdrawInspector,ee=F,se=new $p;$||ul(se,l,t,o,c,q,new ni({func:N.ALWAYS,mask:255},255,255,N.KEEP,N.KEEP,N.REPLACE),new vi([N.ONE,N.ONE,N.ONE,N.ONE],n.ao.transparent,[!1,!1,!1,!0],N.MIN),Jt.disabled,f,"sdf",_,x,S,E,P,G,ee,!1);{let ie=$?ni.disabled:new ni({func:N.EQUAL,mask:255},255,255,N.KEEP,N.DECR,N.DECR),ge=$?l.colorModeForRenderPass():new vi([N.ONE_MINUS_DST_ALPHA,N.DST_ALPHA,N.ONE,N.ONE],n.ao.transparent,[!0,!0,!0,!0]);ul(se,l,t,o,c,q,ie,ge,Jt.disabled,f,"color",_,x,S,E,P,G,ee,!1)}}function Yp(l){return[l[0]*n.eg,l[1]*n.eg,l[2]*n.eg,0]}function Kp(l,t,o,c,f,_,x,S,E){let P=c.getSource(),M=o.globeSharedBuffers;if(!M)return;let F,O,N;if(t&&(F=c.getTile(t)),P instanceof n.aT?(O=P.texture,N=n.dJ(0,0,o.transform)):F&&t&&(O=F.texture,N=n.dJ(t.canonical.z,t.canonical.x,o.transform)),!O||!N)return;l||(N=n.cR(n.bB(),N,[1,-1,1]));let q=o.context,G=q.gl,K=f.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,$=o.colorModeForDrapableLayerRenderPass(_),ee=x.defines;ee.push("GLOBE_POLES");let se=new Rt(G.LEQUAL,Rt.ReadWrite,o.depthRangeFor3D),ie=Float32Array.from(o.transform.expandedFarZProjMatrix),ge=Float32Array.from(n.bj(n.dI(new n.cC(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),q.activeTexture.set(G.TEXTURE0),O.bind(K,G.CLAMP_TO_EDGE),q.activeTexture.set(G.TEXTURE1),O.bind(K,G.CLAMP_TO_EDGE),"useMipmap"in O&&q.extTextureFilterAnisotropic&&o.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);let[ae,ye,pe,ue]=t?M.getPoleBuffers(t.canonical.z,!1):M.getPoleBuffers(0,!0),ve=f.paint.get("raster-elevation"),ze;l?(ze=ae,o.renderDefaultNorthPole=ve!==0):(ze=ye,o.renderDefaultSouthPole=ve!==0);let Ie=Yp(x.mix),Ge=((Ye,gt,De,Ee,Ke,Ne,nt,xt,Dt,ft,vt,Ft,Lt)=>cd(Ye,gt,De,new Float32Array(16),new Float32Array(9),[0,0],Ee,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ne,[0,0],xt,2,ft,vt,Ft,1,0,Lt))(ie,ge,N,n.aj(o.transform.zoom),0,f,0,ve,0,Ie,x.offset,x.range,_),Be=o.getOrCreateProgram("raster",{defines:ee});o.uploadCommonUniforms(q,Be,null),Be.draw(o,G.TRIANGLES,se,E,$,S,Ge,f.id,ze,pe,ue)}function ag(l){let t=l._nearZ,o=l.projection.farthestPixelDistance(l),c=o-t,f=.2*l.height,_=t+f;return[t,o,(_-f-t)/c,(_-t)/c]}function tv(l,t,o,c){if(l)return t instanceof Cn&&l instanceof za?t.getTextureDescriptor(l,o,!0):{texture:l.texture,mix:Yp(c.mix),offset:c.offset,buffer:0,tileSize:1}}var iv=n.eh([{name:"a_index",type:"Int16",components:1}]);class ls{constructor(t,o,c,f){let _={width:c[0],height:c[1],data:null},x=t.gl;this.targetColorTexture=new n.T(t,_,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,_,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,f),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let c=this.context.gl,f=o.width*o.height;this.particleTexture0=new n.T(this.context,o,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,c.RGBA8,{premultiply:!1,useMipmap:!1});let _=new n.ei;_.reserve(f);for(let x=0;x<f;x++)_.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(_,iv.members,!0),this.particleSegment=n.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Jp(l,t,o){if(!l)return null;let c=t.getTextureDescriptor(l,o,!0);if(!c)return null;let{texture:f,mix:_,offset:x,tileSize:S,buffer:E,format:P}=c;if(!f||!P)return null;let M=!1;return P==="uint32"&&(M=!0,_[3]=0,_=ih(n.ej,_,[0,o.paint.get("raster-particle-max-speed")]),x=cl(n.ej,x,[0,o.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[E/(S+2*E),S/(S+2*E)],tileSize:S,scalarData:M,scale:_,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Fo(l){let t=l._nearZ,o=l.projection.farthestPixelDistance(l),c=o-t,f=.2*l.height,_=t+f;return[t,o,(_-f-t)/c,(_-t)/c]}let Xl=new n.ao(1,0,0,1),lg=new n.ao(0,1,0,1),Qp=new n.ao(0,0,1,1),ef=new n.ao(1,0,1,1),tf=new n.ao(0,1,1,1);function rf(l,t,o,c,f,_){for(let x=0;x<o.length;x++)if(f){let P=new n.ao(c.r*.8,c.g*.8,c.b*.8,1);cs(l,t,o[x],c,-1,-1,_),cs(l,t,o[x],c,-1,1,_),cs(l,t,o[x],c,1,1,_),cs(l,t,o[x],c,1,-1,_),cs(l,t,o[x],P,0,0,_)}else cs(l,t,o[x],c,0,0,_)}function cs(l,t,o,c,f,_,x){let S=l.context,E=l.transform,P=S.gl,M=E.projection.name==="globe",F=M?["PROJECTION_GLOBE_VIEW"]:[],O=n.by(o.projMatrix);if(M&&n.aj(E.zoom)>0){let Ie=n.bi(o.canonical,E),Ge=n.ek(Ie);O=n.aB(new Float32Array(16),E.globeMatrix,Ge),n.aB(O,E.projMatrix,O)}let N=n.bB();N[12]+=2*f/(n.o.devicePixelRatio*E.width),N[13]+=2*_/(n.o.devicePixelRatio*E.height),n.aB(O,N,O);let q=l.getOrCreateProgram("debug",{defines:F}),G=t.getTileByID(o.key);l.terrain&&l.terrain.setupElevationDraw(G,q);let K=Rt.disabled,$=ni.disabled,ee=l.colorModeForRenderPass(),se="$debug";S.activeTexture.set(P.TEXTURE0),l.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),M?G._makeGlobeTileDebugBuffers(l.context,E):G._makeDebugTileBoundsBuffers(l.context,E.projection);let ie=G._tileDebugBuffer||l.debugBuffer,ge=G._tileDebugIndexBuffer||l.debugIndexBuffer,ae=G._tileDebugSegments||l.debugSegments;if(q.draw(l,P.LINE_STRIP,K,$,ee,Jt.disabled,Up(O,c.toPremultipliedRenderColor(null)),se,ie,ge,ae,null,null,null,[G._globeTileDebugBorderBuffer]),x){let Ie=G.latestRawTileData,Ge=Math.floor((Ie&&Ie.byteLength||0)/1024),Be=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Be+=` => ${o.overscaledZ}`),Be+=` ${G.state}`,Be+=` ${Ge}kb`,(function(Ye,gt){Ye.initDebugOverlayCanvas();let De=Ye.debugOverlayCanvas,Ee=Ye.context.gl,Ke=Ye.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,De.width,De.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(gt,5,5),Ke.strokeText(gt,5,5),Ye.debugOverlayTexture.update(De),Ye.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)})(l,Be)}let ye=t.getTile(o).tileSize,pe=512/Math.min(ye,512)*(o.overscaledZ/E.zoom)*.5,ue=G._tileDebugTextBuffer||l.debugBuffer,ve=G._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,ze=G._tileDebugTextSegments||l.debugSegments;q.draw(l,P.TRIANGLES,K,$,vi.alphaBlended,Jt.disabled,Up(O,n.ao.transparent.toPremultipliedRenderColor(null),pe),se,ue,ve,ze,null,null,null,[G._globeTileDebugTextBuffer])}function Rr(l,t,o,c){du(l,0,t+o/2,l.transform.width,o,c)}function hd(l,t,o,c){du(l,t-o/2,0,o,l.transform.height,c)}function du(l,t,o,c,f,_){let x=l.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*n.o.devicePixelRatio,o*n.o.devicePixelRatio,c*n.o.devicePixelRatio,f*n.o.devicePixelRatio),x.clear({color:_}),S.disable(S.SCISSOR_TEST)}let cg=n.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ug}=cg;function dl(l,t,o,c){l.emplaceBack(t,o,c)}class nf{constructor(t){this.vertexArray=new n.el,this.indices=new n.b0,dl(this.vertexArray,-1,-1,1),dl(this.vertexArray,1,-1,1),dl(this.vertexArray,-1,1,1),dl(this.vertexArray,1,1,1),dl(this.vertexArray,-1,-1,-1),dl(this.vertexArray,1,-1,-1),dl(this.vertexArray,-1,1,-1),dl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ug),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bf.simpleSegment(0,0,36,12)}}function Ks(l,t,o,c,f,_){let x=l.context.gl,S=t.paint.get("sky-atmosphere-color"),E=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),M=((F,O,N,q,G)=>({u_matrix_3f:F,u_sun_direction:O,u_sun_intensity:N,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(n.en(n.dN(),c),f,P,S.toPremultipliedRenderColor(null),E.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),o.draw(l,x.TRIANGLES,Rt.disabled,ni.disabled,vi.unblended,Jt.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let Pc=n.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class pt{constructor(t){let o=new n.eo;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);let c=new n.b0;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,Pc.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=n.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let kt=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class hn{constructor(t){this.colorModeAlphaBlendedWriteRGB=new vi([1,$r,1,$r],n.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new vi([1,0,1,0],n.ao.transparent,[!1,!1,!1,!0]),this.params=new hu,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){let o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new pt(o);let c=this.params.sizeRange,f=this.params.intensityRange,_=(function(M){let F=n.eq(30),O=[];for(let N=0;N<M;++N){let q=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;O.push(n.d4(Math.cos(G)*Math.cos(q),Math.cos(G)*Math.sin(q),Math.sin(G)))}return O})(this.params.starsCount),x=n.eq(300),S=new n.ep,E=new n.b0,P=0;for(let M=0;M<_.length;++M){let F=n.c4([],_[M],200),O=Math.max(0,1+.01*c*(1*x()-.5)),N=Math.max(0,1+.01*f*(1*x()-.5));S.emplaceBack(F[0],F[1],F[2],-1,-1,O,N),S.emplaceBack(F[0],F[1],F[2],1,-1,O,N),S.emplaceBack(F[0],F[1],F[2],1,1,O,N),S.emplaceBack(F[0],F[1],F[2],-1,1,O,N),E.emplaceBack(P+0,P+1,P+2),E.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=o.createVertexBuffer(S,kt.members),this.starsIdx=o.createIndexBuffer(E),this.starsSegments=n.bf.simpleSegment(0,0,S.length,E.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){let c=t.context,f=c.gl,_=t.transform,x=new Rt(f.LEQUAL,Rt.ReadOnly,[0,1]),S=n.aj(_.zoom),E=t.style.getLut(o.scope),P=o.properties.get("color-use-theme")==="none",M=o.properties.get("color").toNonPremultipliedRenderColor(P?null:E),F=o.properties.get("high-color-use-theme")==="none",O=o.properties.get("high-color").toNonPremultipliedRenderColor(F?null:E),N=o.properties.get("space-color-use-theme")==="none",q=o.properties.get("space-color").toNonPremultipliedRenderColor(N?null:E),G=5e-4,K=n.er(o.properties.get("horizon-blend"),0,1,G,.25),$=n.dD(t,c,_)&&K===G?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,ee=t.frameCounter/1e3%1,se=n.ag(_.globeCenterInViewSpace),ie=Math.sqrt(Math.pow(se,2)-Math.pow($,2)),ge=Math.acos(ie/se),ae=ye=>{let pe=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ye&&pe.push("ALPHA_PASS");let ue=t.getOrCreateProgram("globeAtmosphere",{defines:pe}),ve=((Ie,Ge,Be,Ye,gt,De,Ee,Ke,Ne,nt,xt,Dt)=>({u_frustum_tl:Ie,u_frustum_tr:Ge,u_frustum_br:Be,u_frustum_bl:Ye,u_horizon:gt,u_transition:De,u_fadeout_range:Ee,u_atmosphere_fog_color:Ke.toArray01(),u_high_color:Ne.toArray01(),u_space_color:nt.toArray01(),u_temporal_offset:xt,u_horizon_angle:Dt}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,S,K,M,O,q,ee,ge);t.uploadCommonUniforms(c,ue);let ze=this.atmosphereBuffer;ze&&ue.draw(t,f.TRIANGLES,x,ni.disabled,ye?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Jt.backCW,ve,ye?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};ae(!1),ae(!0)}drawStars(t,o){let c=n.aA(o.properties.get("star-intensity"),0,1);if(c===0)return;let f=t.context,_=f.gl,x=t.transform,S=t.getOrCreateProgram("stars"),E=n.c6([]);n.c8(E,E,-x._pitch),n.c7(E,E,-x.angle),n.c8(E,E,n.an(x._center.lat)),n.es(E,E,-n.an(x._center.lng));let P=n.cb(new Float32Array(16),E),M=n.aB([],x.starsProjMatrix,P),F=n.en([],P),O=n.et([],F),N=[0,1,0];n.dP(N,N,O),n.c4(N,N,this.params.sizeMultiplier);let q=[1,0,0];n.dP(q,q,O),n.c4(q,q,this.params.sizeMultiplier);let G=(K=N,$=q,ee=c,{u_matrix:Float32Array.from(M),u_up:K,u_right:$,u_intensity_multiplier:ee});var K,$,ee;t.uploadCommonUniforms(f,S),this.starsVx&&this.starsIdx&&S.draw(t,_.TRIANGLES,Rt.disabled,ni.disabled,this.colorModeAlphaBlendedWriteRGB,Jt.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Me{constructor(){this.visibleTiles=[]}updateBorders(t,o){let c=[],f=[],_=t._getRenderableCoordinates(!1,!0);for(let E of _){let P=t.getTile(E);if(!P.hasData())continue;let M=P.getBucket(o);M&&(M.isEmpty()||(c.push(E.key),f.push({bucket:M,tileID:E.canonical})))}let x=c.length!==this.visibleTiles.length;if(!x){c.sort();for(let E=0;E<c.length;E++)if(c[E]!==this.visibleTiles[E]){x=!0;break}}if(!x)return;let S=new Set;this.visibleTiles=c,f.sort(((E,P)=>E.tileID.z-P.tileID.z||E.tileID.x-P.tileID.x||E.tileID.y-P.tileID.y));for(let E of f){let P=new Array,M=new Array,F=E.bucket;for(let O of F.featuresOnBorder)S.has(O.featureId)?M.push(O.footprintIndex):(S.add(O.featureId),P.push(O.footprintIndex));F.updateFootprintHiddenFlags(P,n.eu,!1),F.updateFootprintHiddenFlags(M,n.eu,!0)}}}function of(l,t){let o=[...l],c=t.cameraWorldSizeForFog/t.worldSize,f=n.bz([]);return n.cR(f,f,[c,c,1]),n.aB(o,f,o),n.aB(o,t.worldToFogMatrix,o),o}function pu(l,t,o,c,f){let _=o.material,x=c.context,{baseColorTexture:S,metallicRoughnessTexture:E}=_.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:M,emissionTexture:F}=_;function O(q,G,K){if(q&&(l.push(G),x.activeTexture.set(x.gl.TEXTURE0+K),q.gfxTexture)){let{minFilter:$,magFilter:ee,wrapS:se,wrapT:ie}=q.sampler;q.gfxTexture.bindExtraParam($,ee,se,ie)}}O(S,"HAS_TEXTURE_u_baseColorTexture",En.BaseColor),O(E,"HAS_TEXTURE_u_metallicRoughnessTexture",En.MetallicRoughness),O(P,"HAS_TEXTURE_u_normalTexture",En.Normal),O(M,"HAS_TEXTURE_u_occlusionTexture",En.Occlusion),O(F,"HAS_TEXTURE_u_emissionTexture",En.Emission),f&&(f.texture||(f.texture=new n.d_(c.context,f.image,[f.image.height,f.image.height,f.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+En.LUT),f.texture&&f.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(l.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||l.push("DIFFUSE_SHADED");let N=c.shadowRenderer;N&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&l.push("NORMAL_OFFSET"))}function fu(l,t,o,c,f,_){let x=o.paint.get("model-opacity").constantOr(1),S=t.context,E=new Rt(t.context.gl.LEQUAL,l.isLightMesh?Rt.ReadOnly:Rt.ReadWrite,t.depthRangeFor3D),P=t.transform,M=l.mesh,F=M.material,O=F.pbrMetallicRoughness,N=t.style.fog,q;q=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:n.aB([],c.zScaleMatrix,l.nodeModelMatrix),n.aB(q,c.negCameraPosMatrix,q);let G=n.bk([],q);n.ef(G,G);let K=o.paint.get("model-color-use-theme").constantOr("default")==="none",$=o.paint.get("model-emissive-strength").constantOr(0),ee=ah(new Float32Array(l.worldViewProjection),new Float32Array(q),new Float32Array(G),null,t,x,O.baseColorFactor,F.emissiveFactor,O.metallicFactor,O.roughnessFactor,F,$,o,void 0,void 0,l.materialOverride,l.modelColor),se={defines:[]},ie=[],ge=t.shadowRenderer;ge&&(ge.useNormalOffset=!1),pu(se.defines,ie,M,t,K?null:o.lut);let ae=null;if(N){let ue=of(l.nodeModelMatrix,t.transform);if(ae=new Float32Array(ue),P.projection.name!=="globe"){let ve=M.aabb.min,ze=M.aabb.max,[Ie,Ge]=N.getOpacityForBounds(ue,ve[0],ve[1],ze[0],ze[1]);se.overrideFog=Ie>=Fe||Ge>=Fe}}let ye=Zs(t,o.paint.get("model-cutoff-fade-range"));ye.shouldRenderCutoff&&se.defines.push("RENDER_CUTOFF");let pe=t.getOrCreateProgram("model",se);t.uploadCommonUniforms(S,pe,null,ae,ye),t.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(l.nodeModelMatrix,pe),pe.draw(t,S.gl.TRIANGLES,E,f,_,M.material.doubleSided?Jt.disabled:Jt.backCCW,ee,o.id,M.vertexBuffer,M.indexBuffer,M.segments,o.paint,t.transform.zoom,void 0,ie)}function mh(l,t,o){return l.type==="vector"?t.scope:o?"basemap":""}function gh(l,t,o,c,f,_,x,S,E){let P=l.transform,M=!!t.isGeometryBloom&&t.isGeometryBloom;if(M&&l.renderPass==="shadow")return;let F=P.projection.name==="globe"?n.eC(o,P):[...o];n.aB(F,F,t.globalMatrix);let O=n.aB([],c,F);if(t.meshes)for(let N of t.meshes){let q=S.get(N.material.name);if(q&&q.opacity<=0)continue;if(N.material.alphaMode!=="BLEND"){x.push({mesh:N,depth:0,modelIndex:f,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:M,materialOverride:q,modelColor:E});continue}let G=n.af([],N.centroid,O);!P.isOrthographic&&G[2]<=0||_.push({mesh:N,depth:G[2],modelIndex:f,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:M,materialOverride:q,modelColor:E})}if(t.children)for(let N of t.children)gh(l,N,o,c,f,_,x,S,E)}function mu(l,t,o,c){let f=o.shadowRenderer;if(!f)return;let _=f.getShadowPassDepthMode(),x=f.getShadowPassColorMode(),S=f.calculateShadowPassMatrixFromMatrix(t),E=cu(S);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,_,ni.disabled,x,Jt.disabled,E,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,o.transform.zoom,void 0,void 0)}function gu(l,t,o,c,f,_){for(let x of f){let S=Object.assign({},c);S.part=x;let E={type:"Unknown",id:t,properties:S},P={orientation:l.paint.get("model-rotation").evaluate(E,o)};_.set(x,P)}}function rv(l,t,o,c,f,_){for(let x of f){let S=Object.assign({},c);S.part=x;let E={type:"Unknown",id:t,properties:S},P={color:l.paint.get("model-color").evaluate(E,o),colorMix:l.paint.get("model-color-mix-intensity").evaluate(E,o),opacity:l.paint.get("model-opacity").evaluate(E,o),emissionStrength:l.paint.get("model-emissive-strength").evaluate(E,o)};_.set(x,P)}}function dg(l,t,o,c,f,_){if(o===1)for(let S of f)fu(S,l,t,_[S.modelIndex],ni.disabled,l.colorModeForRenderPass());else{for(let S of f)fu(S,l,t,_[S.modelIndex],ni.disabled,vi.disabled);for(let S of f)fu(S,l,t,_[S.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}let x=vi.additive;for(let S of c)fu(S,l,t,_[S.modelIndex],ni.disabled,S.isLightMesh?x:l.colorModeForRenderPass())}function hg(l,t,o){let c=t.updateZoomBasedPaintProperties(),f=(function(_,x,S){let E,P,M,F=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&F>0){let O=_.terrain,N=O.findDEMTileFor(S);N&&N.dem?E=n.eE.create(O,S,N):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||E&&E._demTile&&E._demTile.tileID===x.validForDEMTile.id&&E._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let O in x.instancesPerModel){let N=x.instancesPerModel[O];for(let q=0;q<N.instancedDataArray.length;++q){let G=(E?F*E.getElevationAt(0|N.instancedDataArray.float32[16*q],0|N.instancedDataArray.float32[16*q+1],!0,!0):0)+N.instancesEvaluatedElevation[q];N.instancedDataArray.float32[16*q+6]=G,P=P?Math.min(x.terrainElevationMin,G):G,M=M?Math.max(x.terrainElevationMax,G):G}}return x.terrainElevationMin=P||0,x.terrainElevationMax=M||0,x.validForExaggeration=F,x.validForDEMTile=E&&E._demTile?{id:E._demTile.tileID,timestamp:E._dem._timestamp}:{id:void 0,timestamp:0},!0})(l,t,o);(c||f)&&(t.uploaded=!1,t.upload(l.context))}let As={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.d8([0,0,0],[n.al,n.al,0])};function sf(l,t){let o=1<<l.canonical.z,c=t.getFreeCameraOptions().position,f=t.elevation,_=l.canonical.x/o,x=(l.canonical.x+1)/o,S=l.canonical.y/o,E=(l.canonical.y+1)/o,P=t._centerAltitude;if(f){let N=f.getMinMaxForTile(l);N&&N.max>P&&(P=N.max)}let M=n.aA(c.x,_,x)-c.x,F=n.aA(c.y,S,E)-c.y,O=n.ce(P,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(M*M+F*F+O*O))}function af(l,t,o,c,f,_,x){let S=l.context,E=l.renderPass==="shadow",P=l.shadowRenderer,M=E&&P?P.getShadowPassDepthMode():new Rt(S.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),F=l.isTileAffectedByFog(_),O=l.transform.projection.name==="globe";if(o.meshes)for(let N of o.meshes){let q=O?[]:["MODEL_POSITION_ON_GPU"],G=[],K,$,ee,se=!O&&c.instancedDataArray.length>20;se&&q.push("INSTANCED_ARRAYS");let ie=Zs(l,t.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),E&&P)K=l.getOrCreateProgram("modelDepth",{defines:q}),$=cu(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(o.globalMatrix)),ee=P.getShadowPassColorMode();else{pu(q,G,N,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),K=l.getOrCreateProgram("model",{defines:q,overrideFog:F});let ae=N.material,ye=ae.pbrMetallicRoughness,pe=t.paint.get("model-opacity").constantOr(1),ue=t.paint.get("model-emissive-strength").constantOr(0);$=ah(_.expandedProjMatrix,Float32Array.from(o.globalMatrix),new Float32Array(16),null,l,pe,ye.baseColorFactor,ae.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ae,ue,t,f),P&&(x.shadowUniformsInitialized?K.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(_.toUnwrapped(),K,"model-tile"),x.shadowUniformsInitialized=!0)),ee=ie.shouldRenderCutoff||pe<1||ae.alphaMode!=="OPAQUE"?vi.alphaBlended:vi.unblended}l.uploadCommonUniforms(S,K,_.toUnwrapped(),null,ie);let ge=N.material.doubleSided?Jt.disabled:Jt.backCCW;if(se)G.push(c.instancedDataBuffer),K.draw(l,S.gl.TRIANGLES,M,ni.disabled,ee,ge,$,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,G,c.instancedDataArray.length);else{let ae=E?"u_instance":"u_normal_matrix";for(let ye=0;ye<c.instancedDataArray.length;++ye)$[ae]=new Float32Array(c.instancedDataArray.arrayBuffer,64*ye,16),K.draw(l,S.gl.TRIANGLES,M,ni.disabled,ee,ge,$,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,l.transform.zoom,void 0,G)}}if(o.children)for(let N of o.children)af(l,t,N,c,f,_,x)}let pg=[1,-1,1];function _h(l,t,o,c){if(!o.modelManager)return!0;let f=o.modelManager;if(!o.shadowRenderer)return!0;let _=o.shadowRenderer,x=t.aabb,S=!0,E=l.maxHeight;if(E===0){let M=0;for(let F in l.instancesPerModel){let O=f.getModel(F,c);O?M=Math.max(M,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):S=!1}E=l.maxScale*M*1.41+l.maxVerticalOffset,S&&(l.maxHeight=E)}x.max[2]=E,x.min[2]+=l.terrainElevationMin,x.max[2]+=l.terrainElevationMax,n.af(x.min,x.min,t.tileMatrix),n.af(x.max,x.max,t.tileMatrix);let P=x.intersects(_.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=P===2),P===0}function pd(l,t){let o=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],_=l.uniformValues.u_cutoff_params[3];return c===o||_===f?1:n.aA(((t-o)/(c-o)-f)/(_-f),0,1)}function Lc(l,t,o,c){if(t.pitch<20)return 1;let f=t.getWorldToCameraMatrix();n.aB(f,f,l);let _=n.bT(o.min[0],o.min[1],o.min[2],1),x=n.aC(n.eF(),_,f),S=x,E=x;_[1]=o.max[1],x=n.aC(n.eF(),_,f),S=x[1]<S[1]?x:S,E=x[1]>E[1]?x:E,_[0]=o.max[0],x=n.aC(n.eF(),_,f),S=x[1]<S[1]?x:S,E=x[1]>E[1]?x:E,_[1]=o.min[1],x=n.aC(n.eF(),_,f),S=x[1]<S[1]?x:S,E=x[1]>E[1]?x:E;let P=n.aA(c[0],0,1),M=100*t.pixelsPerMeter*n.aA(c[1],0,1),F=n.aA(c[2],0,1),O=n.eG(n.eF(),S,E,P),N=Math.tan(.5*t.fovX),q=-O[2]*N;if(M===0)return O[1]<-Math.abs(q)?F:1;let G=(-Math.abs(q)-O[1])/M,K=(ee,se,ie)=>(1-ie)*ee+ie*se,$=n.aA(K(1,F,G),F,1);return K(1,$,n.aA((t.pitch-20)/20,0,1))}class fg{}class mg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,c){{let F=this._storage.get(o.id);if(F)return F.lastUsedFrameIdx=t,F.buf}let f=c.gl,_=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),x=new ArrayBuffer(_),S=new Int16Array(x);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let E=new n.eI;for(let F=0;F<_/2;F+=3){let O=S[F],N=S[F+1],q=S[F+2];E.emplaceBack(O,N),E.emplaceBack(N,q),E.emplaceBack(q,O)}let P=c.bindVertexArrayOES.current,M=new fg;return M.buf=new Gl(c,E),M.lastUsedFrameIdx=t,this._storage.set(o.id,M),c.bindVertexArrayOES.set(P),M.buf}update(t){for(let[o,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(o))}destroy(){for(let[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class nv{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let gg=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ov{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Lo{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}let sv=n.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class fd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){let c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new n.eJ,S=new n.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,sv.members),this.vignetteIdx=t.context.createIndexBuffer(S)}let f=n.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);let x={u_vignetteShape:(_={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,Rt.disabled,ni.disabled,vi.alphaBlended,Jt.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,f)}var _}}class jr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){let c=t.getFreeCameraOptions().position,f=c.toAltitude(),_=c.toLngLat(),x=n.an(_.lng),S=n.an(_.lat),E=t.pixelsPerMeter/o,P=x*n.eL,M=n.eL*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let F=-this._offsetYPrev+M,O=-this._elevationPrev+f;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*E,this._accumulatedOffsetY+=F*E,this._accumulatedElevation+=O*E,this._offsetXPrev=P,this._offsetYPrev=M,this._elevationPrev=f}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Li(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function lf(l){let t=n.eq(1323123451230),o=[];for(let c=0;c<l;++c){let f=2*t()-1,_=2*t()-1,x=2*t()-1;o.push(n.d4(f,_,x))}return o}function Xo(l,t,o,c,f){let _=n.aA((f-o)/(c-o),0,1);return(1-_)*l+_*t}class zc{constructor(t){this._movement=new jr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new fd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){let c=t.transform;this._movement.update(c,this._ppmScaleFactor);let f=c.starsProjMatrix,_=n.c6([]);n.c8(_,_,n.an(90)-c._pitch),n.c7(_,_,-c.angle);let x=n.cb(new Float32Array(16),_),S=n.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),E=n.ef([],S),P=n.aB([],E,x),M=Date.now()/1e3;return this._accumulatedTimeFromStart+=(M-this._prevTime)*o,this._prevTime=M,{projectionMatrix:f,modelviewMatrix:P}}}class _u extends zc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Lo(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){let o=t.context;if(!this.particlesVx){let c=lf(this.particlesCount),f=new n.eM,_=new n.b0,x=0,S=n.eq(1323123451230);for(let E=0;E<c.length;++E){let P=c[E],M=[2*S()-1,S(),S(),S()];f.emplaceBack(P[0],P[1],P[2],-1,-1,...M),f.emplaceBack(P[0],P[1],P[2],1,-1,...M),f.emplaceBack(P[0],P[1],P[2],1,1,...M),f.emplaceBack(P[0],P[1],P[2],-1,1,...M),_.emplaceBack(x+0,x+1,x+2),_.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=o.createVertexBuffer(f,gg.members),this.particlesIdx=o.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;let o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(o.revealStart>c)return;let f=Xo(0,1,o.revealStart,o.revealStart+o.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;let _=structuredClone(this._params),x=[-_.direction.x,_.direction.y,-100];n.aw(x,x);let S=structuredClone(this._vignetteParams);S.strength*=f,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));let E=this.updateOnRender(t,_.timeFactor),P=t.context,M=P.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(P,{width:t.width,height:t.height,data:null},M.RGBA8)),_.distortionStrength>0&&(P.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,t.width,t.height));let O=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,O),P.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);let N=[_.color.r,_.color.g,_.color.b,_.color.a],q=(G,K)=>{let $=Li(this._movement.getPosition(),G),ee=_.dropletSizeX,se=_.dropletSizeX*_.dropletSizeYScale,ie=t.width/2,ge=t.height/2,ae=Xo(0,_.screenThinning.start,0,1,_.screenThinning.intensity),ye=Xo(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),pe=Xo(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),ue=(ve={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:G,rainDropletSize:[ee,se],distortionStrength:_.distortionStrength,rainDirection:x,color:N,screenSize:[F.width,F.height],thinningCenterPos:[ie,ge],thinningShape:[ae,ye,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:K?0:1},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_texScreen:0,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_boxSize:ve.boxSize,u_rainDropletSize:ve.rainDropletSize,u_distortionStrength:ve.distortionStrength,u_rainDirection:ve.rainDirection,u_color:ve.color,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_shapeDirectionalPower:ve.shapeDirectionalPower,u_shapeNormalPower:ve.shapeNormalPower,u_mode:ve.mode});var ve;let ze=Math.round(_.intensity*this.particlesCount),Ie=n.bf.simpleSegment(0,0,4*ze,2*ze);O.draw(t,M.TRIANGLES,Rt.disabled,ni.disabled,vi.alphaBlended,Jt.disabled,ue,"rain_particles",this.particlesVx,this.particlesIdx,Ie)};_.distortionStrength>0&&q(_.boxSize,!0),q(_.boxSize,!1),this._vignette.draw(t,S)}}let hl=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class cf extends zc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Lo(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){let o=t.context;if(!this.particlesVx){let c=lf(this.particlesCount),f=new n.eN,_=new n.b0,x=0,S=n.eq(1323123451230);for(let E=0;E<c.length;++E){let P=c[E],M=S(),F=S(),O=S(),N=[E/c.length,M,F,O],q=[S(),S()];f.emplaceBack(P[0],P[1],P[2],-1,-1,...N,...q),f.emplaceBack(P[0],P[1],P[2],1,-1,...N,...q),f.emplaceBack(P[0],P[1],P[2],1,1,...N,...q),f.emplaceBack(P[0],P[1],P[2],-1,1,...N,...q),_.emplaceBack(x+0,x+1,x+2),_.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=o.createVertexBuffer(f,hl.members),this.particlesIdx=o.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;let o=structuredClone(this._params),c=[-o.direction.x,o.direction.y,-100];n.aw(c,c);let f=structuredClone(this._vignetteParams),_=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(_.revealStart>x)return;let S=Xo(0,1,_.revealStart,_.revealStart+_.revealRange,x);f.strength*=S,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,f.strength=1,f.color=structuredClone(t.style.snow.state.vignetteColor));let E=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let P=t.context,M=P.gl,F=t.transform,O=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,O),((N,q,G)=>{let K=Li(this._movement.getPosition(),N),$=F.width/2,ee=F.height/2,se=Xo(0,G.screenThinning.start,0,1,G.screenThinning.intensity),ie=Xo(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),ge=Xo(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),ae=(ye={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:N,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[$,ee],thinningShape:[se,ie,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:c},{u_modelview:Float32Array.from(ye.modelview),u_projection:Float32Array.from(ye.projection),u_time:ye.time,u_cam_pos:ye.camPos,u_velocityConeAperture:ye.velocityConeAperture,u_velocity:ye.velocity,u_horizontalOscillationRadius:ye.horizontalOscillationRadius,u_horizontalOscillationRate:ye.horizontalOscillationRate,u_boxSize:ye.boxSize,u_billboardSize:ye.billboardSize,u_simpleShapeParameters:ye.simpleShapeParameters,u_screenSize:ye.screenSize,u_thinningCenterPos:ye.thinningCenterPos,u_thinningShape:ye.thinningShape,u_thinningAffectedRatio:ye.thinningAffectedRatio,u_thinningParticleOffset:ye.thinningParticleOffset,u_particleColor:ye.color,u_direction:ye.direction});var ye;let pe=Math.round(G.intensity*this.particlesCount),ue=n.bf.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&O.draw(t,M.TRIANGLES,Rt.disabled,ni.disabled,vi.alphaBlended,Jt.disabled,ae,"snow_particles",this.particlesVx,this.particlesIdx,ue)})(o.boxSize,0,o),this._vignette.draw(t,f)}}let uf={symbol:function(l,t,o,c,f){if(l.renderPass!=="translucent")return;let _=ni.disabled,x=l.colorModeForRenderPass(),S=o.layout.get("text-variable-anchor"),E=o.layout.get("text-size-scale-range"),P=n.aA(l.scaleFactor,E[0],E[1]);S&&(function(O,N,q,G,K,$,ee,se){let ie=N.transform,ge=K==="map",ae=$==="map";for(let ye of O){let pe=G.getTile(ye),ue=pe.getBucket(q);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let ve=n.bJ(ue.textSizeData,ie.zoom,se),ze=zr(ye,ue.getProjection(),ie),Ie=ie.calculatePixelsToTileUnitsMatrix(pe),Ge=zl(ze,pe.tileID.canonical,ae,ge,ie,ue.getProjection(),Ie),Be=ue.hasIconTextFit()&&ue.hasIconData();ve&&dh(ue,ge,ae,ee,ie,Ge,ye,Math.pow(2,ie.zoom-pe.tileID.overscaledZ),ve,Be)}})(c,l,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),f,P);let M=o.paint.get("icon-opacity").constantOr(1)!==0,F=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||F)?dd(l,t,o,c,_,x):(M&&dd(l,t,o,c,_,x,{onlyIcons:!0}),F&&dd(l,t,o,c,_,x,{onlyText:!0})),t.map.showCollisionBoxes&&(ud(l,t,o,c,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ud(l,t,o,c,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,o,c){if(l.renderPass!=="translucent")return;let f=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),x=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0,E=o.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;let P=l.context,M=P.gl,F=l.transform,O=!(!l.terrain||!l.terrain.enabled),N=o.layout.get("circle-elevation-reference"),q=l.depthModeForSublayer(0,Rt.ReadOnly),G=new Rt(l.context.gl.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D),K=N==="none"||O?q:G,$=ni.disabled,ee=l.colorModeForDrapableLayerRenderPass(E),se=F.projection.name==="globe",ie=[n.aF(F.center.lng),n.aJ(F.center.lat)],ge=[];for(let ye=0;ye<c.length;ye++){let pe=c[ye],ue=t.getTile(pe),ve=ue.getBucket(o);if(!ve||ve.projection.name!==F.projection.name)continue;let ze=ve.programConfigurations.get(o.id),Ie=ve.layoutVertexBuffer,Ge=ve.globeExtVertexBuffer,Be=ve.indexBuffer,Ye=n.d$(o),gt=[Ge],De=l.isTileAffectedByFog(pe);se&&Ye.push("PROJECTION_GLOBE_VIEW"),Ye.push("DEPTH_D24"),l.terrain&&F.depthOcclusionForSymbolsAndCircles&&Ye.push("DEPTH_OCCLUSION"),ve.hasElevation&&!l.terrain&&(Ye.push("ELEVATED_ROADS"),gt.push(ve.elevatedLayoutVertexBuffer));let Ee=l.getOrCreateProgram("circle",{config:ze,defines:Ye,overrideFog:De}),Ke=F.projection.createInversionMatrix(F,pe.canonical),Ne={programConfiguration:ze,program:Ee,layoutVertexBuffer:Ie,dynamicBuffers:gt,indexBuffer:Be,uniformValues:n.e0(l,pe,ue,Ke,ie,o),tile:ue};if(S){let nt=ve.segments.get();for(let xt of nt)ge.push({segments:new n.bf([xt]),sortKey:xt.sortKey,state:Ne})}else ge.push({segments:ve.segments,sortKey:0,state:Ne})}S&&ge.sort(((ye,pe)=>ye.sortKey-pe.sortKey));let ae={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let ye of ge){let{programConfiguration:pe,program:ue,layoutVertexBuffer:ve,dynamicBuffers:ze,indexBuffer:Ie,uniformValues:Ge,tile:Be}=ye.state,Ye=ye.segments;l.terrain&&l.terrain.setupElevationDraw(Be,ue,ae),l.uploadCommonUniforms(P,ue,Be.tileID.toUnwrapped()),ue.draw(l,M.TRIANGLES,K,$,ee,Jt.disabled,Ge,o.id,ve,Ie,Ye,o.paint,F.zoom,pe,ze)}},heatmap:function(l,t,o,c){if(o.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){let f=l.context,_=f.gl,x=ni.disabled,S=new vi([_.ONE,_.ONE,_.ONE,_.ONE],n.ao.transparent,[!0,!0,!0,!0]);(function(N,q,G,K){let $=N.gl,ee=q.width*K,se=q.height*K;N.activeTexture.set($.TEXTURE1),N.viewport.set([0,0,ee,se]);let ie=G.heatmapFbo;if(!ie||ie&&(ie.width!==ee||ie.height!==se)){ie&&ie.destroy();let ge=$.createTexture();$.bindTexture($.TEXTURE_2D,ge),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ie=G.heatmapFbo=N.createFramebuffer(ee,se,!0,null),(function(ae,ye,pe,ue,ve,ze){let Ie=ae.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,ae.extRenderToTextureHalfFloat?Ie.RGBA16F:Ie.RGBA,ve,ze,0,Ie.RGBA,ae.extRenderToTextureHalfFloat?Ie.HALF_FLOAT:Ie.UNSIGNED_BYTE,null),ue.colorAttachment.set(pe)})(N,0,ge,ie,ee,se)}else $.bindTexture($.TEXTURE_2D,ie.colorAttachment.get()),N.bindFramebuffer.set(ie.framebuffer)})(f,l,o,l.transform.projection.name==="globe"?.5:.25),f.clear({color:n.ao.transparent});let E=l.transform,P=E.projection.name==="globe",M=P?["PROJECTION_GLOBE_VIEW"]:[],F=P?Jt.frontCCW:Jt.disabled,O=[n.aF(E.center.lng),n.aJ(E.center.lat)];for(let N=0;N<c.length;N++){let q=c[N];if(t.hasRenderableParent(q))continue;let G=t.getTile(q),K=G.getBucket(o);if(!K||K.projection.name!==E.projection.name)continue;let $=l.isTileAffectedByFog(q),ee=K.programConfigurations.get(o.id),se=l.getOrCreateProgram("heatmap",{config:ee,defines:M,overrideFog:$}),{zoom:ie}=l.transform;l.terrain&&l.terrain.setupElevationDraw(G,se),l.uploadCommonUniforms(f,se,q.toUnwrapped());let ge=E.projection.createInversionMatrix(E,q.canonical);se.draw(l,_.TRIANGLES,Rt.disabled,x,S,F,rg(l,q,G,ge,O,ie,o.paint.get("heatmap-intensity")),o.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,o.paint,l.transform.zoom,ee,P?[K.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),(function(f,_){let x=f.context,S=x.gl,E=_.heatmapFbo;if(!E)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let P=_.colorRampTexture;P||(P=_.colorRampTexture=new n.T(x,_.colorRamp,S.RGBA8)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,S.TRIANGLES,Rt.disabled,ni.disabled,f.colorModeForRenderPass(),Jt.disabled,((M,F,O,N)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,_),_.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,_.paint,f.transform.zoom)})(l,o))},line:function(l,t,o,c){if(l.renderPass!=="translucent")return;let f=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(f.constantOr(1)===0||_.constantOr(1)===0)return;let x=o.paint.get("line-emissive-strength"),S=o.paint.get("line-occlusion-opacity"),E=o.layout.get("line-elevation-reference"),P=o.layout.get("line-width-unit")==="meters",M=E==="sea",F=!(!l.terrain||!l.terrain.enabled),O=l.context,N=O.gl;if(o.hasElevatedBuckets&&l.transform.projection.name==="globe")return;let q=o.layout.get("line-cross-slope"),G=q!==void 0,K=q<1,$=l.colorModeForDrapableLayerRenderPass(x),ee=l.terrain&&l.terrain.renderingToTexture,se=ee?1:n.o.devicePixelRatio,ie=o.paint.get("line-dasharray"),ge=ie.constantOr(1),ae=o.layout.get("line-cap"),ye=ie.constantOr(null),pe=ae.constantOr(null),ue=o.paint.get("line-pattern"),ve=ue.constantOr(1),ze=o.paint.get("line-pattern-cross-fade"),Ie=ue.constantOr(null),Ge=o.paint.get("line-opacity").constantOr(1),Be=!ve&&Ge!==1||l.depthOcclusion&&S>0&&S<1,Ye=o.paint.get("line-gradient"),gt=ve?"linePattern":"line",De=n.e1(o),Ee;if(ee&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),S!==0&&l.depthOcclusion){let xt=o.paint._values["line-opacity"];xt&&xt.value&&xt.value.kind==="constant"?Ee=xt.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&De.push("VARIABLE_LINE_WIDTH");let Ke=(xt,Dt,ft,vt,Ft,Lt)=>{for(let It of xt){let zt=t.getTile(It);if(ve&&!zt.patternsLoaded())continue;let Yt=zt.getBucket(o);if(!Yt||Yt.elevationType!=="none"&&!Ft||Yt.elevationType==="none"&&Ft)continue;l.prepareDrawTile();let zi=[...Dt],Ui=l.shadowRenderer,xr=Yt.elevationType==="road"&&!!Ui&&Ui.enabled,si=[0,0,0];if(xr){let ci=l.style.directionalLight,$i=l.style.ambientLight;ci&&$i&&(si=Do(l.style,ci,$i)),zi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let ji=Yt.programConfigurations.get(o.id),yi=!1;if(Ie&&zt.imageAtlas){let ci=n.e2.from(Ie),$i=ci.getPrimary().scaleSelf(se).toString(),Qr=zt.imageAtlas.patternPositions.get($i),yn=ci.getSecondary(),rn=yn?zt.imageAtlas.patternPositions.get(yn.scaleSelf(se).toString()):null;yi=!!Qr&&!!rn,Qr&&ji.setConstantPatternPositions(Qr,rn)}ze>0&&(yi||ji.getPatternTransitionVertexBuffer("line-pattern"))&&zi.push("LINE_PATTERN_TRANSITION");let gr=l.isTileAffectedByFog(It),qi=l.getOrCreateProgram(gt,{config:ji,defines:zi,overrideFog:gr});if(!ve&&ye&&pe&&zt.lineAtlas){let ci=zt.lineAtlas.getDash(ye,pe);ci&&ji.setConstantPatternPositions(ci)}xr&&Ui.setupShadows(zt.tileID.toUnwrapped(),qi,"vector-tile");let[Ir,Ji]=o.paint.get("line-trim-offset");(pe==="round"||pe==="square")&&Ir!==Ji&&(Ir===0&&(Ir-=1),Ji===1&&(Ji+=1));let xi=ee?It.projMatrix:null,dr=P?1/Yt.tileToMeter/n.ay(zt,1,l.transform.zoom):1,wi=P?1/Yt.tileToMeter/n.ay(zt,1,Math.floor(l.transform.zoom)):1,Fr=ve?n.e3(l,zt,o,xi,se,dr,wi,[Ir,Ji],si,ze):n.e4(l,zt,o,xi,Yt.lineClipsArray.length,se,dr,wi,[Ir,Ji],si);if(Ye){let ci=Yt.gradients[o.id],$i=ci.texture;if(o.gradientVersion!==ci.version){let Qr=256;if(o.stepInterpolant){let yn=t.getSource().maxzoom,rn=It.canonical.z===yn?Math.ceil(1<<l.transform.maxZoom-It.canonical.z):1;Qr=n.aA(n.e5(Yt.maxLineLength/n.al*1024*rn),256,O.maxTextureSize)}ci.gradient=n.e6({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Qr,image:ci.gradient||void 0,clips:Yt.lineClipsArray}),ci.texture?ci.texture.update(ci.gradient):ci.texture=new n.T(O,ci.gradient,N.RGBA8),ci.version=o.gradientVersion,$i=ci.texture}O.activeTexture.set(N.TEXTURE1),$i.bind(o.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}ge&&(O.activeTexture.set(N.TEXTURE0),zt.lineAtlasTexture&&zt.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),ji.updatePaintBuffers()),ve&&(O.activeTexture.set(N.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ji.updatePaintBuffers()),Ft&&!M&&l.terrain.setupElevationDraw(zt,qi),l.uploadCommonUniforms(O,qi,It.toUnwrapped());let hr=ci=>{Ee!=null&&(Ee.value=Ge*S),qi.draw(l,N.TRIANGLES,ft,ci,$,Jt.disabled,Fr,o.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,o.paint,l.transform.zoom,ji,[Yt.layoutVertexBuffer2,Yt.patternVertexBuffer,Yt.zOffsetVertexBuffer]),Ee!=null&&(Ee.value=Ge)};if(Be&&!Ft){let ci=l.stencilModeForClipping(It).ref;ci===0&&ee&&O.clear({stencil:0});let $i={func:N.EQUAL,mask:255};Fr.u_alpha_discard_threshold=.8,hr(new ni($i,ci,255,N.KEEP,N.KEEP,N.INVERT)),Fr.u_alpha_discard_threshold=0,hr(new ni($i,ci,255,N.KEEP,N.KEEP,N.KEEP))}else Fr.u_alpha_discard_threshold=Be&&Ft&&Lt?.8:0,hr(Ft?vt:l.stencilModeForClipping(It))}},Ne=l.depthModeForSublayer(0,Rt.ReadOnly),nt=new Rt(l.depthOcclusion?N.GREATER:N.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D);if(o.hasNonElevatedBuckets){let xt=!ee&&l.terrain;S!==0&&xt?n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):xt?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):Ke(c,De,Ne,ni.disabled,!1,!0)}if(o.hasElevatedBuckets){E==="hd-road-markup"?F||(Ne=nt,De.push("ELEVATED_ROADS")):(De.push("ELEVATED"),Ne=nt,G&&De.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),M&&De.push("ELEVATION_REFERENCE_SEA"));let xt=Be?l.stencilModeFor3D():ni.disabled;l.forceTerrainMode=!0,Ke(c,De,Ne,xt,!0,!0),Be&&Ke(c,De,Ne,xt,!0,!1),l.forceTerrainMode=!1}Be&&(l.resetStencilClippingMasks(),ee&&O.clear({stencil:0})),S===0||l.depthOcclusion||ee||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,o,c){let f=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;let x=o.paint.get("fill-emissive-strength"),S=l.colorModeForDrapableLayerRenderPass(x),E=o.paint.get("fill-pattern"),P=l.opaquePassEnabledForLayer()&&!E.constantOr(1)&&f.constantOr(n.ao.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent",M="none";o.layout.get("fill-elevation-reference")!=="none"?M="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(M="offset");let F=!(!l.terrain||!l.terrain.enabled),O={painter:l,sourceCache:t,layer:o,coords:c,colorMode:S,elevationType:M,terrainEnabled:F,pass:P};if(l.renderPass!=="shadow")if(M!=="offset"){if(uu(O,!1),M==="road"){let N=!F&&l.renderPass==="translucent";N&&Ic(l,t,o,c,"geometry"),uu(O,!0,ni.disabled),N&&(function(q){let{painter:G,sourceCache:K,layer:$,coords:ee,colorMode:se}=q,ie=G.context.gl,ge=q.painter.shadowRenderer,ae=!!ge&&ge.enabled,ye=new Rt(G.context.gl.LEQUAL,Rt.ReadOnly,G.depthRangeFor3D),pe=[0,0,0];if(ae){let ve=G.style.directionalLight,ze=G.style.ambientLight;ve&&ze&&(pe=Do(G.style,ve,ze))}let ue=ve=>{for(let ze of ee){let Ie=K.getTile(ze),Ge=Ie.getBucket($);if(!Ge)continue;let Be=Ge.elevatedStructures;if(!Be)continue;let Ye,gt;if(ve?(Ye=Be.renderableBridgeSegments,gt=Be.bridgeProgramConfigurations.get($.id)):(Ye=Be.renderableTunnelSegments,gt=Be.tunnelProgramConfigurations.get($.id)),!Ye||Ye.segments[0].primitiveLength===0)continue;gt.updatePaintBuffers(),G.prepareDrawTile();let De=G.isTileAffectedByFog(ze),Ee=[];ae&&Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let Ke=G.getOrCreateProgram("elevatedStructures",{config:gt,overrideFog:De,defines:Ee}),Ne=G.translatePosMatrix(ze.projMatrix,Ie,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));ae&&ge.setupShadows(Ie.tileID.toUnwrapped(),Ke,"vector-tile");let nt=Jy(Ne,pe);G.uploadCommonUniforms(G.context,Ke,ze.toUnwrapped()),Ke.draw(G,ie.TRIANGLES,ye,ni.disabled,se,Jt.backCCW,nt,$.id,Be.vertexBuffer,Be.indexBuffer,Ye,$.paint,G.transform.zoom,gt,[Be.vertexBufferNormal])}};ue(!0),ue(!1)})(O)}}else uu(O,!1,l.stencilModeFor3D());else l.shadowRenderer&&M==="road"&&!F&&(function(N){let{painter:q,sourceCache:G,layer:K,coords:$}=N,ee=q.context.gl,se=N.painter.shadowRenderer;for(let ie of $){let ge=G.getTile(ie),ae=ge.getBucket(K);if(!ae)continue;let ye=ae.elevatedStructures;if(!ye||!ye.shadowCasterSegments||ye.shadowCasterSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();let pe=ae.bufferData.programConfigurations.get(K.id),ue=q.isTileAffectedByFog(ie),ve=q.getOrCreateProgram("elevatedStructuresDepth",{config:pe,overrideFog:ue}),ze=se.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());q.uploadCommonUniforms(q.context,ve,ie.toUnwrapped());let Ie={u_matrix:ze,u_depth_bias:0};ve.draw(q,ee.TRIANGLES,se.getShadowPassDepthMode(),ni.disabled,se.getShadowPassColorMode(),Jt.disabled,Ie,K.id,ye.vertexBuffer,ye.indexBuffer,ye.shadowCasterSegments,K.paint,q.transform.zoom,pe)}})(O)},"fill-extrusion":function(l,t,o,c){let f=o.paint.get("fill-extrusion-opacity"),_=l.context,x=_.gl,S=l.terrain,E=S&&S.renderingToTexture;if(f===0)return;let P=l.conflationActive&&l.style.isLayerClipped(o,t.getSource()),M=l.style.order.indexOf(o.fqid);if(P&&(function(F,O,N,q,G){for(let K of q){let $=O.getTile(K).getBucket(N);$&&($.updateReplacement(K,F.replacementSource,G),$.uploadCentroid(F.context))}})(l,t,o,c,M),S||P)for(let F of c){let O=t.getTile(F).getBucket(o);O&&Zl(l.context,t,F,O,o,S,P)}if(l.renderPass==="shadow"&&l.shadowRenderer){let F=l.shadowRenderer;if(S&&f<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ad)return;let O=F.getShadowPassDepthMode(),N=F.getShadowPassColorMode();Ot(l,t,o,c,O,ni.disabled,N,P)}else if(l.renderPass==="translucent"){let F=!o.paint.get("fill-extrusion-pattern").constantOr(1),O=o.paint.get("fill-extrusion-color").constantOr(n.ao.white);if(!E&&O.a!==0){let N=new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D);f===1&&F?Ot(l,t,o,c,N,ni.disabled,vi.unblended,P):(Ot(l,t,o,c,N,ni.disabled,vi.disabled,P),Ot(l,t,o,c,N,l.stencilModeFor3D(),l.colorModeForRenderPass(),P),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&F&&(!S&&l.transform.projection.name!=="globe"||E)){let N=o.paint.get("fill-extrusion-opacity"),q=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=o.paint.get("fill-extrusion-flood-light-intensity"),$=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ee=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor($?null:o.lut).toArray01().slice(0,3),se=q>0&&G>0,ie=K>0,ge=(pe,ue,ve)=>(1-ve)*pe+ve*ue,ae=new $p;ae.translate=o.paint.get("fill-extrusion-translate"),ae.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),ae.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),ae.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");let ye=pe=>{let ue=l.depthModeForSublayer(1,Rt.ReadOnly,x.LEQUAL,!0),ve=o.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=ge(.1,3,ve),Ie=l._showOverdrawInspector;if(!Ie){let Ge=new ni({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Be=new vi([x.ONE,x.ONE,x.ONE,x.ONE],n.ao.transparent,[!1,!1,!1,!0],x.MIN);ul(ae,l,t,o,c,ue,Ge,Be,Jt.disabled,pe,"sdf",N,q,G,K,ee,ze,P,!1)}{let Ge=Ie?ni.disabled:new ni({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Be=Ie?l.colorModeForRenderPass():new vi([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],n.ao.transparent,[!0,!0,!0,!0]);ul(ae,l,t,o,c,ue,Ge,Be,Jt.disabled,pe,"color",N,q,G,K,ee,ze,P,!1)}};if(E){let pe=(ue,ve,ze)=>{let Ie=l.depthModeForSublayer(1,Rt.ReadOnly,x.LEQUAL,!1),Ge=o.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Be=ge(.1,3,Ge);{let Ye=new vi([x.ONE,x.ONE,x.ONE,x.ONE],n.ao.transparent,[!1,!1,!1,!0]);ul(ae,l,t,o,c,Ie,ni.disabled,Ye,Jt.disabled,ue,"clear",N,q,G,K,ee,Be,P,ve)}{let Ye=new ni({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),gt=new vi([x.ONE,x.ONE,x.ONE,x.ONE],n.ao.transparent,[!1,!1,!1,!0],x.MIN);ul(ae,l,t,o,c,Ie,Ye,gt,Jt.disabled,ue,"sdf",N,q,G,K,ee,Be,P,ve)}{let Ye=ue?x.ZERO:x.ONE_MINUS_DST_ALPHA,gt=new ni({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),De=new vi([Ye,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],n.ao.transparent,[!0,!0,!0,!0]);ul(ae,l,t,o,c,Ie,gt,De,Jt.disabled,ue,"color",N,q,G,K,ee,Be,P,ve)}{let Ye=new vi([x.ONE,x.ONE,x.ONE,ue?x.ZERO:x.ONE],n.ao.transparent,[!1,!1,!1,!0],ue?x.FUNC_ADD:x.MAX);ul(ae,l,t,o,c,Ie,ni.disabled,Ye,Jt.disabled,ue,"clear",N,q,G,K,ee,Be,P,ve,ze)}};if(se||ie){let ue;if(l.prepareDrawTile(),S){let ve=S.drapeBufferSize[0],ze=S.drapeBufferSize[1];ue=S.framebufferCopyTexture,ue&&(!ue||ue.size[0]===ve&&ue.size[1]===ze)||(ue&&ue.destroy(),ue=S.framebufferCopyTexture=new n.T(_,new n.q({width:ve,height:ze}),x.RGBA8)),ue.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,ve,ze)}se&&pe(!0,!1,ue),ie&&pe(!1,!0,ue)}}else se&&ye(!0),ie&&ye(!1),(se||ie)&&l.resetStencilClippingMasks()}}},building:function(l,t,o,c){l.currentLayer<l.firstLightBeamLayer&&(l.firstLightBeamLayer=l.currentLayer);let f=o.paint.get("building-ambient-occlusion-ground-intensity"),_=o.paint.get("building-ambient-occlusion-ground-radius"),x=o.paint.get("building-ambient-occlusion-ground-attenuation"),S=o.paint.get("building-opacity");if(S<=0)return;let E=f>0&&_>0,P=!0,M=o.paint.get("building-vertical-scale");if(M<=0)return;(!l.shadowRenderer||M<1)&&(P=!1);let F=l.conflationActive&&l.style.isLayerClipped(o,t.getSource()),O=l.style.order.indexOf(o.fqid);if((function(N,q,G,K,$,ee){for(let se of ee){let ie=q.getTile(se).getBucket(G);ie&&($&&ie.updateReplacement(se,N.replacementSource,K),ie.uploadUpdatedIndexBuffer(N.context))}})(l,t,o,O,F,c),(function(N,q,G,K){for(let $ of K){let ee=q.getTile($).getBucket(G);ee&&ee.needsEvaluation()&&ee.uploadUpdatedColorBuffer(N.context)}})(l,t,o,c),o.resetLayerRenderingStats(l),l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0),l.renderPass==="shadow"&&l.shadowRenderer){let N=l.shadowRenderer,q=[],G=N.getShadowPassDepthMode();ph({painter:l,source:t,layer:o,coords:c,defines:q,blendMode:N.getShadowPassColorMode(),depthMode:G,opacity:S,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(l.renderPass==="translucent"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];P&&(N=N.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),l.shadowRenderer&&l.shadowRenderer.useNormalOffset&&(N=N.concat("NORMAL_OFFSET"));let q=o.paint.get("building-facade-emissive-chance"),G=o.paint.get("building-ambient-occlusion-intensity"),K=o.paint.get("building-flood-light-intensity"),$=o.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ee=o.paint.get("building-flood-light-color").toNonPremultipliedRenderColor($?null:o.lut).toArray01().slice(0,3),se=o.paint.get("building-flood-light-ground-attenuation"),ie=K>0,ge=new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D);S<1&&ph({painter:l,source:t,layer:o,coords:c,defines:N,blendMode:vi.disabled,depthMode:ge,opacity:S,verticalScale:M,facadeEmissiveChance:q,facadeAOIntensity:G,floodLightIntensity:K,floodLightColor:ee,depthOnly:!0});let ae=l.colorModeForRenderPass();ph({painter:l,source:t,layer:o,coords:c,defines:N,blendMode:ae,depthMode:ge,opacity:S,verticalScale:M,facadeEmissiveChance:q,facadeAOIntensity:G,floodLightIntensity:K,floodLightColor:ee}),E&&fh(l,t,o,c,!0,S,f,_,K,ee,x,F),ie&&fh(l,t,o,c,!1,S,f,_,K,ee,se,F)}else if(l.renderPass==="light-beam"){let N=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],q=new Rt(l.context.gl.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D);ph({painter:l,source:t,layer:o,coords:c,defines:N,blendMode:vi.alphaBlended,depthMode:q,opacity:S,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1),l.resetStencilClippingMasks()},hillshade:function(l,t,o,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;let f=l.context,_=l.terrain&&l.terrain.renderingToTexture,[x,S]=l.renderPass!=="translucent"||_?[{},c]:l.stencilConfigForOverlap(c);for(let E of S){let P=t.getTile(E);if(P.needsHillshadePrepare&&l.renderPass==="offscreen")Wd(l,P,o);else if(l.renderPass==="translucent"){let M=l.depthModeForSublayer(0,Rt.ReadOnly),F=o.paint.get("hillshade-emissive-strength"),O=l.colorModeForDrapableLayerRenderPass(F),N=_&&l.terrain?l.terrain.stencilModeForRTTOverlap(E):x[E.overscaledZ];zp(l,E,P,o,M,N,O)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,o,c,f,_){if(l.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;let x=l.transform.projection.name==="globe",S=o.paint.get("raster-elevation")!==0,E=S&&x;if(l.renderElevatedRasterBackface&&!E)return;let P=l.context,M=P.gl,F=t.getSource(),O=(function(ae,ye,pe,ue){let ve=ye.paint.get("raster-color"),ze=ae.type==="raster-array",Ie=[],Ge=ye.paint.get("raster-resampling"),Be=ye.paint.get("raster-color-mix"),Ye=ye.paint.get("raster-color-range"),gt=[Be[0],Be[1],Be[2],0],De=Be[3],Ee=Ge==="nearest"?ue.NEAREST:ue.LINEAR;if(ze&&(Ie.push("RASTER_ARRAY"),ve||Ie.push("RASTER_COLOR"),Ge==="linear"&&Ie.push("RASTER_ARRAY_LINEAR"),Ee=ue.NEAREST,!Ye&&ae.rasterLayers)){let Ke=ae.rasterLayers.find((({id:Ne})=>Ne===ye.sourceLayer));Ke&&Ke.fields&&Ke.fields.range&&(Ye=Ke.fields.range)}if(Ye=Ye||[0,1],ve){Ie.push("RASTER_COLOR"),pe.activeTexture.set(ue.TEXTURE2),ye.updateColorRamp(Ye);let Ke=ye.colorRampTexture;Ke||(Ke=ye.colorRampTexture=new n.T(pe,ye.colorRamp,ue.RGBA8)),Ke.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}return{mix:gt,range:Ye,offset:De,defines:Ie,resampling:Ee}})(F,o,P,M);if(F instanceof n.aT&&!c.length&&!x)return;let N=o.paint.get("raster-emissive-strength"),q=l.colorModeForDrapableLayerRenderPass(N),G=l.terrain&&l.terrain.renderingToTexture,K=!l.options.moving,$=o.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;if(F instanceof n.aT&&!c.length&&(F.onNorthPole||F.onSouthPole)){let ae=S?l.stencilModeFor3D():ni.disabled;return void Kp(!!F.onNorthPole,null,l,t,o,N,O,Jt.disabled,ae)}if(!c.length)return;let[ee,se]=F instanceof n.aT||G?[{},c]:l.stencilConfigForOverlap(c),ie=se[se.length-1].overscaledZ;E&&O.defines.push("PROJECTION_GLOBE_VIEW"),S&&O.defines.push("RENDER_CUTOFF");let ge=(ae,ye,pe)=>{for(let ue of ae){let ve=ue.toUnwrapped(),ze=t.getTile(ue);if(G&&(!ze||!ze.hasData()))continue;P.activeTexture.set(M.TEXTURE0);let Ie=tv(ze,F,o,O);if(!Ie||!Ie.texture)continue;let{texture:Ge,mix:Be,offset:Ye,tileSize:gt,buffer:De}=Ie,Ee,Ke;G?(Ee=Rt.disabled,Ke=ue.projMatrix):S?(Ee=new Rt(M.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),Ke=x?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(ve,K)):(Ee=l.depthModeForSublayer(ue.overscaledZ-ie,o.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,M.LESS),Ke=l.transform.calculateProjMatrix(ve,K));let Ne=l.terrain&&G?l.terrain.stencilModeForRTTOverlap(ue):ee[ue.overscaledZ],nt=_?0:o.paint.get("raster-fade-duration");ze.registerFadeDuration(nt);let xt=t.findLoadedParent(ue,0),Dt=Kd(ze,xt,t,l.transform,nt),ft,vt;!Dt.isFading&&ze.refreshedUponExpiration&&(ze.refreshedUponExpiration=!1),l.terrain&&l.terrain.prepareDrawTile(),P.activeTexture.set(M.TEXTURE0),Ge.bind($,M.CLAMP_TO_EDGE),P.activeTexture.set(M.TEXTURE1),xt?(xt.texture&&xt.texture.bind($,M.CLAMP_TO_EDGE),ft=Math.pow(2,xt.tileID.overscaledZ-ze.tileID.overscaledZ),vt=[ze.tileID.canonical.x*ft%1,ze.tileID.canonical.y*ft%1]):Ge.bind($,M.CLAMP_TO_EDGE),"useMipmap"in Ge&&P.extTextureFilterAnisotropic&&l.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let Ft=l.transform,Lt,It=S?ag(Ft):[0,0,0,0],zt,Yt,zi,Ui,xr,si=0;if(E&&F instanceof n.aT&&F.coordinates.length>3)zt=Float32Array.from(n.bj(n.dI(new n.cC(0,0,0)))),Yt=Float32Array.from(Ft.globeMatrix),zi=Float32Array.from(n.dE(Ft)),Ui=[n.aF(Ft.center.lng),n.aJ(Ft.center.lat)],Lt=F.elevatedGlobePerspectiveTransform,xr=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(E){let qi=n.dF(ue.canonical);si=n.dG(qi.getCenter().lat),zt=Float32Array.from(n.bj(n.dI(ue.canonical))),Yt=Float32Array.from(Ft.globeMatrix),zi=Float32Array.from(n.dE(Ft)),Ui=[n.aF(Ft.center.lng),n.aJ(Ft.center.lat)],Lt=[0,0],xr=Float32Array.from(n.dH(ue.canonical,qi,si,Ft.worldSize/Ft._pixelsPerMercatorPixel))}else Lt=F instanceof n.aT?F.perspectiveTransform:[0,0],zt=new Float32Array(16),Yt=new Float32Array(9),zi=new Float32Array(16),Ui=[0,0],xr=new Float32Array(9);let ji=cd(Ke,zt,Yt,zi,xr,vt||[0,0],n.aj(l.transform.zoom),Ui,It,ft||1,Dt,o,Lt,S?o.paint.get("raster-elevation"):0,2,Be,Ye,O.range,gt,De,N),yi=l.isTileAffectedByFog(ue),gr=l.getOrCreateProgram("raster",{defines:O.defines,overrideFog:yi});if(l.uploadCommonUniforms(P,gr,ve),F instanceof n.aT){let qi=F.elevatedGlobeVertexBuffer,Ir=F.elevatedGlobeIndexBuffer;if(G||!x)F.boundsBuffer&&F.boundsSegments&&gr.draw(l,M.TRIANGLES,Ee,ni.disabled,q,Jt.disabled,ji,o.id,F.boundsBuffer,l.quadTriangleIndexBuffer,F.boundsSegments);else if(qi&&Ir){let Ji=Ft.zoom<=n.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Ft.center.lng);Ji&&gr.draw(l,M.TRIANGLES,Ee,ni.disabled,q,ye,ji,o.id,qi,Ir,Ji)}}else if(E){Ee=new Rt(M.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D);let qi=l.globeSharedBuffers;if(qi){let[Ir,Ji,xi]=qi.getGridBuffers(si,!1);gr.draw(l,M.TRIANGLES,Ee,pe||Ne,l.colorModeForRenderPass(),ye,ji,o.id,Ir,Ji,xi)}}else{let{tileBoundsBuffer:qi,tileBoundsIndexBuffer:Ir,tileBoundsSegments:Ji}=l.getTileBoundsBuffers(ze);gr.draw(l,M.TRIANGLES,Ee,Ne,q,Jt.disabled,ji,o.id,qi,Ir,Ji)}}if(!(F instanceof n.aT)&&E)for(let ue of ae){let ve=ue.canonical.y===(1<<ue.canonical.z)-1;ue.canonical.y===0&&Kp(!0,ue,l,t,o,N,O,ye,pe||ni.disabled),ve&&Kp(!1,ue,l,t,o,N,O,ye===Jt.frontCW?Jt.backCW:Jt.frontCW,pe||ni.disabled)}};E?ge(se,l.renderElevatedRasterBackface?Jt.backCW:Jt.frontCW,l.stencilModeFor3D()):ge(se,Jt.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,o,c,f,_){l.renderPass==="offscreen"&&(function(x,S,E,P){if(!P.length)return;let M=x.context,F=M.gl,O=S.getSource();if(!(O instanceof Cn))return;let N=Math.ceil(Math.sqrt(E.paint.get("raster-particle-count"))),q=E.particlePositionRGBAImage;if(!q||q.width!==N){let se=(function(ie){let ge=ie*ie,ae=new Uint8Array(4*ge),ye=function(ue){return ue|=0,ue=Math.imul(2747636419^ue,2654435769),ue=Math.imul(ue^ue>>>16,2654435769),((ue=Math.imul(ue^ue>>>16,2654435769))>>>0)/4294967296},pe=1/1.1;for(let ue=0;ue<ge;ue++){let ve=pe*(ye(2*ue+0)+kc),ze=pe*(ye(2*ue+1)+kc),Ie=255*ve%1,Ge=255*ze%1,Be=Ie,Ye=ze-Ge/255,gt=Ge;ae[4*ue+0]=255*(ve-Ie/255),ae[4*ue+1]=255*Be,ae[4*ue+2]=255*Ye,ae[4*ue+3]=255*gt}return ae})(N);q=E.particlePositionRGBAImage=new n.q({width:N,height:N},se)}let G=E.particleFramebuffer;G?G.width!==N&&(G.destroy(),G=E.particleFramebuffer=M.createFramebuffer(N,N,!0,null)):G=E.particleFramebuffer=M.createFramebuffer(N,N,!0,null);let K=[];for(let se of P){let ie=S.getTile(se);if(!(ie instanceof za))continue;let ge=Jp(ie,O,E);if(!ge)continue;let ae=[ie.tileSize,ie.tileSize],ye=E.tileFramebuffer;ye||(ye=E.tileFramebuffer=M.createFramebuffer(ae[0],ae[1],!0,null));let pe=ie.rasterParticleState;pe||(pe=ie.rasterParticleState=new ls(M,se,ae,q));let ue=pe.update(E.lastInvalidatedAt);pe.particleTextureDimension!==N&&pe.updateParticleTexture(se,q);let ve=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=ve;let ze=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=ze,K.push([se,ge,pe,ue])}if(K.length===0)return;let $=n.o.now(),ee=E.previousDrawTimestamp?.001*($-E.previousDrawTimestamp):.0167;if(E.previousDrawTimestamp=$,E.hasColorMap()){M.activeTexture.set(F.TEXTURE0+2);let se=E.colorRampTexture;se||(se=E.colorRampTexture=new n.T(M,E.colorRamp,F.RGBA8)),se.bind(F.LINEAR,F.CLAMP_TO_EDGE)}M.bindFramebuffer.set(E.tileFramebuffer.framebuffer),(function(se,ie,ge){let ae=se.context,ye=ae.gl,pe=ie.tileFramebuffer;ae.activeTexture.set(ye.TEXTURE0);let ue={u_texture:0,u_opacity:1.05*(ze=ie.paint.get("raster-particle-fade-opacity-factor"))/(ze+.05)},ve=se.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ze;for(let Ie of ge){let[,,Ge,Be]=Ie;pe.colorAttachment.set(Ge.targetColorTexture.texture),ae.viewport.set([0,0,pe.width,pe.height]),ae.clear({color:n.ao.transparent}),Be&&(Ge.backgroundColorTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE),ve.draw(se,ye.TRIANGLES,Rt.disabled,ni.disabled,vi.alphaBlended,Jt.disabled,ue,ie.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments))}})(x,E,K),(function(se,ie,ge,ae){let ye=se.context,pe=ye.gl,ue=ge.tileFramebuffer,ve=se.transform.projection.name==="globe",ze=ge.paint.get("raster-particle-max-speed");for(let Ie of ae){let[Ge,Be,Ye]=Ie;ye.activeTexture.set(pe.TEXTURE0+0),Be.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ue.colorAttachment.set(Ye.targetColorTexture.texture);let gt=se.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});ye.activeTexture.set(pe.TEXTURE0+1);let De=Be.scalarData?[]:[0,1,2,3].map((Ne=>n.e8[Ne](Ge)));De.push(Ge);let Ee=Ge.canonical.x,Ke=Ge.canonical.y;for(let Ne of De){let nt=ie.getTile(ve?Ne.wrapped():Ne);if(!nt)continue;let xt=nt.rasterParticleState;if(!xt)continue;let Dt=Ne.canonical.x+(1<<Ne.canonical.z)*(Ne.wrap-Ge.wrap),ft=Ne.canonical.y;xt.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);let vt=qp(1,xt.particleTexture0.size[0],[Dt-Ee,ft-Ke],0,Be.texture.size,2,ze,Be.textureOffset,Be.scale,Be.offset);gt.draw(se,pe.POINTS,Rt.disabled,ni.disabled,vi.alphaBlended,Jt.disabled,vt,ge.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}})(x,S,E,K),M.bindFramebuffer.set(E.particleFramebuffer.framebuffer),(function(se,ie,ge,ae){let ye=se.context,pe=ye.gl,ue=ie.paint.get("raster-particle-max-speed"),ve=ae*ie.paint.get("raster-particle-speed-factor")*.15,ze=(function(Ge){return Math.pow(Ge,6)})(.01+1*ie.paint.get("raster-particle-reset-rate-factor")),Ie=ie.particleFramebuffer;ye.viewport.set([0,0,Ie.width,Ie.height]);for(let Ge of ge){let[,Be,Ye]=Ge;ye.activeTexture.set(pe.TEXTURE0+0),Be.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ye.activeTexture.set(pe.TEXTURE0+1);let gt=Ye.particleTexture0;gt.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);let De=nh(1,gt.size[0],0,Be.texture.size,ue,ve,ze,Be.textureOffset,Be.scale,Be.offset);Ie.colorAttachment.set(Ye.particleTexture1.texture),ye.clear({color:n.ao.transparent}),se.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(se,pe.TRIANGLES,Rt.disabled,ni.disabled,vi.unblended,Jt.disabled,De,ie.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments)}})(x,E,K,ee)})(l,t,o,c),l.renderPass==="translucent"&&((function(x,S,E,P,M){let F=x.context,O=F.gl,N=S.getSource().tileSize,q=5*(1-n.ah(n.cK,n.cK+1,x.transform.zoom))*N+E.paint.get("raster-particle-elevation"),G=!x.options.moving,K=x.transform.projection.name==="globe";if(!P.length)return;let[$,ee]=x.stencilConfigForOverlap(P),se=[];K&&se.push("PROJECTION_GLOBE_VIEW");let ie=x.stencilModeFor3D();for(let ge of ee){let ae=ge.toUnwrapped(),ye=S.getTile(ge);if(!ye.rasterParticleState)continue;let pe=ye.rasterParticleState,ue=100;ye.registerFadeDuration(ue);let ve=S.findLoadedParent(ge,0),ze=Kd(ye,ve,S,x.transform,ue),Ie,Ge;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(O.TEXTURE0),pe.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),F.activeTexture.set(O.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ie=Math.pow(2,ve.tileID.overscaledZ-ye.tileID.overscaledZ),Ge=[ye.tileID.canonical.x*Ie%1,ye.tileID.canonical.y*Ie%1]):pe.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let Be=K?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ae,G),Ye=x.transform,gt=Fo(Ye),De=n.dF(ge.canonical),Ee=n.dG(De.getCenter().lat),Ke,Ne,nt,xt,Dt;K?(Ke=Float32Array.from(n.bj(n.dI(ge.canonical))),Ne=Float32Array.from(Ye.globeMatrix),nt=Float32Array.from(n.dE(Ye)),xt=[n.aF(Ye.center.lng),n.aJ(Ye.center.lat)],Dt=Float32Array.from(n.dH(ge.canonical,De,Ee,Ye.worldSize/Ye._pixelsPerMercatorPixel))):(Ke=new Float32Array(16),Ne=new Float32Array(9),nt=new Float32Array(16),xt=[0,0],Dt=new Float32Array(9));let ft=Wl(Be,Ke,Ne,nt,Dt,Ge||[0,0],n.aj(x.transform.zoom),xt,gt,Ie||1,ze,q),vt=x.isTileAffectedByFog(ge),Ft=x.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:vt});if(x.uploadCommonUniforms(F,Ft,ae),K){let Lt=new Rt(O.LEQUAL,Rt.ReadOnly,x.depthRangeFor3D),It=0,zt=x.globeSharedBuffers;if(zt){let[Yt,zi,Ui]=zt.getGridBuffers(Ee,It!==0);Ft.draw(x,O.TRIANGLES,Lt,ie,vi.alphaBlended,x.renderElevatedRasterBackface?Jt.frontCCW:Jt.backCCW,ft,E.id,Yt,zi,Ui)}}else{let Lt=x.depthModeForSublayer(0,Rt.ReadOnly),It=$[ge.overscaledZ],{tileBoundsBuffer:zt,tileBoundsIndexBuffer:Yt,tileBoundsSegments:zi}=x.getTileBoundsBuffers(ye);Ft.draw(x,O.TRIANGLES,Lt,It,vi.alphaBlended,Jt.disabled,ft,E.id,zt,Yt,zi)}}x.resetStencilClippingMasks()})(l,t,o,c),l.style.map.triggerRepaint())},background:function(l,t,o,c){let f=o.paint.get("background-color"),_=o.paint.get("background-color-use-theme").constantOr("default")==="none",x=o.paint.get("background-opacity"),S=o.paint.get("background-emissive-strength"),E=o.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let P=l.context,M=P.gl,F=l.transform,O=F.tileSize,N=o.paint.get("background-pattern"),q;if(N!==void 0&&(N===null||(q=l.imageManager.getPattern(n.I.from(N.toString()),o.scope,l.style.getLut(o.scope)),!q)))return;let G=!N&&f.a===1&&x===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==G)return;let K=ni.disabled,$=l.depthModeForSublayer(0,G==="opaque"?Rt.ReadWrite:Rt.ReadOnly),ee=l.colorModeForDrapableLayerRenderPass(S),se=N?"backgroundPattern":"background",ie,ge=c;if(ge||(ie=l.getBackgroundTiles(),ge=Object.values(ie).map((ae=>ae.tileID))),N&&(P.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context,o.scope)),E){let ae=l.getOrCreateProgram(se,{overrideFog:!1,overrideRtt:!0}),ye=new Float32Array(n.bz([])),pe=new n.aP(0,0,0,0,0),ue=N?sh(ye,S,x,l,0,o.scope,q,E,{tileID:pe,tileSize:O}):oh(ye,S,x,f.toPremultipliedRenderColor(_?null:o.lut));ae.draw(l,M.TRIANGLES,$,K,ee,Jt.disabled,ue,o.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(let ae of ge){let ye=l.isTileAffectedByFog(ae),pe=l.getOrCreateProgram(se,{overrideFog:ye}),ue=ae.toUnwrapped(),ve=c?ae.projMatrix:l.transform.calculateProjMatrix(ue);l.prepareDrawTile();let ze=t?t.getTile(ae):ie?ie[ae.key]:new rs(ae,O,F.zoom,l),Ie=N?sh(ve,S,x,l,0,o.scope,q,E,{tileID:ae,tileSize:O}):oh(ve,S,x,f.toPremultipliedRenderColor(_?null:o.lut));l.uploadCommonUniforms(P,pe,ue);let{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:Be,tileBoundsSegments:Ye}=l.getTileBoundsBuffers(ze);pe.draw(l,M.TRIANGLES,$,K,ee,Jt.disabled,Ie,o.id,Ge,Be,Ye)}},sky:function(l,t,o){let c=l._atmosphere?n.aj(l.transform.zoom):1,f=o.paint.get("sky-opacity")*c;if(f===0)return;let _=l.context,x=o.paint.get("sky-type"),S=new Rt(_.gl.LEQUAL,Rt.ReadOnly,[0,1]),E=l.frameCounter/1e3%1;x==="atmosphere"?l.renderPass==="offscreen"?o.needsSkyboxCapture(l)&&((function(P,M,F,O){let N=P.context,q=N.gl,G=M.skyboxFbo;if(!G){G=M.skyboxFbo=N.createFramebuffer(32,32,!0,null),M.skyboxGeometry=new nf(N),M.skyboxTexture=N.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,M.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let se=0;se<6;++se)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(G.framebuffer),N.viewport.set([0,0,32,32]);let K=M.getCenter(P,!0),$=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);n.bz(ee),n.em(ee,ee,.5*-Math.PI),Ks(P,M,$,ee,K,0),n.bz(ee),n.em(ee,ee,.5*Math.PI),Ks(P,M,$,ee,K,1),n.bz(ee),n.cT(ee,ee,.5*-Math.PI),Ks(P,M,$,ee,K,2),n.bz(ee),n.cT(ee,ee,.5*Math.PI),Ks(P,M,$,ee,K,3),n.bz(ee),Ks(P,M,$,ee,K,4),n.bz(ee),n.em(ee,ee,Math.PI),Ks(P,M,$,ee,K,5),N.viewport.set([0,0,P.width,P.height])})(l,o),o.markSkyboxValid(l)):l.renderPass==="sky"&&(function(P,M,F,O,N){let q=P.context,G=q.gl,K=P.transform,$=P.getOrCreateProgram("skybox");q.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,M.skyboxTexture);let ee=((se,ie,ge,ae,ye)=>({u_matrix:se,u_sun_direction:ie,u_cubemap:0,u_opacity:ae,u_temporal_offset:ye}))(K.skyboxMatrix,M.getCenter(P,!1),0,O,N);P.uploadCommonUniforms(q,$),$.draw(P,G.TRIANGLES,F,ni.disabled,P.colorModeForRenderPass(),Jt.backCW,ee,"skybox",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)})(l,o,S,f,E):x==="gradient"&&l.renderPass==="sky"&&(function(P,M,F,O,N){let q=P.context,G=q.gl,K=P.transform,$=P.getOrCreateProgram("skyboxGradient");M.skyboxGeometry||(M.skyboxGeometry=new nf(q)),q.activeTexture.set(G.TEXTURE0);let ee=M.colorRampTexture;ee||(ee=M.colorRampTexture=new n.T(q,M.colorRamp,G.RGBA8)),ee.bind(G.LINEAR,G.CLAMP_TO_EDGE);let se=((ie,ge,ae,ye,pe)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:ge,u_radius:n.an(ae),u_opacity:ye,u_temporal_offset:pe}))(K.skyboxMatrix,M.getCenter(P,!1),M.paint.get("sky-gradient-radius"),O,N);P.uploadCommonUniforms(q,$),$.draw(P,G.TRIANGLES,F,ni.disabled,P.colorModeForRenderPass(),Jt.backCW,se,"skyboxGradient",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)})(l,o,S,f,E)},custom:function(l,t,o,c){let f=l.context,_=o.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&o.isDraped(t)){if(l.renderPass==="offscreen"){let x=_.prerender;if(x){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){let S=l.transform.pointMerc;x.call(_,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),n.aj(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else x.call(_,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){let S=_.renderToTile;if(S){let E=c[0].canonical,P={x:E.x+c[0].wrap*(_.wrapTileId?0:1<<E.z),y:E.y,z:E.z};f.setDepthMode(Rt.disabled),f.setStencilMode(ni.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),S.call(_,f.gl,P),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(ni.disabled);let x=_.renderingMode==="3d"?new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Rt.ReadOnly);if(f.setDepthMode(x),l.transform.projection.name==="globe"){let S=l.transform.pointMerc;_.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),n.aj(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else _.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,o,c){if(l.renderPass==="opaque")return;let f=o.paint.get("model-opacity").constantOr(1),_=o.paint.get("model-elevation-reference"),x=_==="ground",S=_==="ground";if(f===0)return;let E=o.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!E||l.terrain&&f<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.ad))return;let P=l.shadowRenderer,M=o.paint.get("model-receive-shadows");P&&(P.useNormalOffset=!0,M||(P.enabled=!1));let F=()=>{P&&(P.useNormalOffset=!0,M||(P.enabled=!0))},O=t.getSource();if(l.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return(function(ie,ge,ae,ye,pe){let ue=ie.transform,ve=ue.projection.name==="globe",ze=ue.getFreeCameraOptions().position;if(!ie.modelManager)return;let Ie=ie.modelManager;ae.modelManager=Ie;let Ge=ie.shadowRenderer;if(!ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Be=ae._unevaluatedLayout._values["model-id"],Ye=Object.assign({},ae.layout.get("model-id").parameters),gt=ie.style.order.indexOf(ae.fqid);for(let De of ye){let Ee=ge.getTile(De).getBucket(ae);if(!Ee||Ee.projection.name!==ue.projection.name)continue;let Ke=Ee.getModelUris();if(Ke&&!Ee.modelsRequested&&(Ie.addModelsFromBucket(Ke,pe),Ee.modelsRequested=!0),ve)Ye.zoom=De.overscaledZ;else{let Lt=sf(De,ue);Ye.zoom=Lt}let Ne=Be.possiblyEvaluate(Ye);if(hg(ie,Ee,De),As.shadowUniformsInitialized=!1,As.useSingleShadowCascade=!!Ge&&Ge.getMaxCascadeForTile(De.toUnwrapped())===0,ie.renderPass==="shadow"&&Ge){if(ie.currentShadowCascade===1&&Ee.isInsideFirstShadowMapFrustum)continue;let Lt=ue.calculatePosMatrix(De.toUnwrapped(),ue.worldSize);if(As.tileMatrix.set(Lt),As.shadowTileMatrix=Float32Array.from(Ge.calculateShadowPassMatrixFromMatrix(Lt)),As.aabb.min=[0,0,0],As.aabb.max[0]=As.aabb.max[1]=n.al,As.aabb.max[2]=0,_h(Ee,As,ie,ae.scope))continue}let nt=1<<De.canonical.z,xt=[((ze.x-De.wrap)*nt-De.canonical.x)*n.al,(ze.y*nt-De.canonical.y)*n.al,ze.z*nt*n.al];ie.conflationActive&&Object.keys(Ee.instancesPerModel).length>0&&ie.style.isLayerClipped(ae,ge.getSource())&&Ee.updateReplacement(De,ie.replacementSource,gt,pe)&&(Ee.uploaded=!1,Ee.upload(ie.context));let Dt=0,ft=new Array,vt=new Array,Ft=new Array;for(let Lt in Ee.instancesPerModel){let It=Ee.instancesPerModel[Lt];It.features.length>0&&!ve&&(Lt=Ne.evaluate(It.features[0].feature,{}));let zt=Ie.getModel(Lt,pe);if(zt||Ie.hasURLBeenRequested(Lt)||Ee.modelUris.includes(Lt)||(Ee.modelUris.push(Lt),Ee.modelsRequested=!1),zt&&zt.uploaded)if(ve){let Yt=n.c4([],[ze.x,ze.y,ze.z],ie.transform.worldSize);n.ev(Yt,Yt);for(let zi=0;zi<It.instancedDataArray.length;++zi){let Ui=[0,0,0],xr=[1,1,1],si=n.ew(),ji=It.tileCoordinatesForInstance(zi),yi=It.transformForInstance(zi);n.ex(xr,yi),n.ey(si,yi),n.ez(Ui,si);let gr=It.translationForInstance(zi),qi=new n.aS(0,0);n.eA(Ee.canonical,qi,ji.x,ji.y);let Ir=n.bB();n.eB(Ir,zt,ie.transform,qi,Ui,xr,gr,!0,!1,!1);let Ji=It.colorForInstance(zi),xi=n.bz([]),dr=n.ee(qi.lat,ie.transform.zoom),wi=n.bp([],[1,1,1/dr]);n.bq(xi,xi,Yt),Ft.push({zScaleMatrix:wi,negCameraPosMatrix:xi});for(let Fr of zt.nodes)gh(ie,Fr,Ir,ie.transform.expandedFarZProjMatrix,Dt,ft,vt,zt.materialOverrides,Ji);++Dt}}else for(let Yt of zt.nodes)af(ie,ae,Yt,It,xt,De,As)}if(ve)if(ie.renderPass==="shadow"){for(let Lt of vt)mu(Lt.mesh,Lt.nodeModelMatrix,ie,ae);for(let Lt of ft)mu(Lt.mesh,Lt.nodeModelMatrix,ie,ae)}else dg(ie,ae,1,ft,vt,Ft)}})(l,t,o,c,mh(O,o,l.style._importedAsBasemap)),void F();if(!O.loaded())return;if(O.type==="batched-model")return(function(ie,ge,ae,ye){ae.resetLayerRenderingStats(ie);let pe=ie.context,ue=ie.transform,ve=ie.style.fog,ze=ie.shadowRenderer;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ue.projection.name} projection is not yet implemented`);let Ie=ie.transform.getFreeCameraOptions().position,Ge=n.c4([],[Ie.x,Ie.y,Ie.z],ie.transform.worldSize),Be=n.ev([],Ge),Ye=n.bz([]),gt=n.ee(ue.center.lat,ue.zoom),De=n.bp([],[1,1,1/gt]);n.bq(Ye,Ye,Be);let Ee=ae.paint.get("model-opacity").constantOr(1),Ke=new Rt(pe.gl.LEQUAL,Rt.ReadWrite,ie.depthRangeFor3D),Ne=new Rt(pe.gl.LEQUAL,Rt.ReadOnly,ie.depthRangeFor3D),nt=new n.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xt=ie.renderPass==="shadow",Dt=xt&&ze?ze.getCurrentCascadeFrustum():ue.getFrustum(ue.scaleZoom(ue.worldSize)),ft=ae.paint.get("model-front-cutoff"),vt=ft[2]<1,Ft=Zs(ie,ae.paint.get("model-cutoff-fade-range")),Lt=ae.getLayerRenderingStats();(function(It,zt,Yt,zi){let Ui=It.terrain?It.terrain.exaggeration():0,xr=It.transform.zoom;for(let si of zi){let ji=zt.getTile(si).getBucket(Yt);ji&&(ji.setFilter(Yt.filter),It.conflationActive&&ji.updateReplacement(si,It.replacementSource),ji.evaluateTransform(It,Yt),It.terrain&&Ui>0&&ji.elevationUpdate(It.terrain,Ui,si,Yt.source),ji.needsReEvaluation(It,xr,Yt)&&ji.evaluate(Yt))}})(ie,ge,ae,ye),(function(){let It,zt,Yt;vt?(It=ye.length-1,zt=-1,Yt=-1):(It=0,zt=ye.length,Yt=1);let zi=new Float64Array(16),Ui=n.cz(),xr=new n.P(0,0);for(let si=It;si!==zt;si+=Yt){let ji=ye[si],yi=ge.getTile(ji).getBucket(ae);if(!yi||!yi.uploaded)continue;let gr=!1;ze&&(gr=ze.getMaxCascadeForTile(ji.toUnwrapped())===0);let qi=ue.calculatePosMatrix(ji.toUnwrapped(),ue.worldSize),Ir=yi.modelTraits;!xt&&vt&&(n.bk(zi,qi),n.af(Ui,Ge,zi),xr.x=Ui[0],xr.y=Ui[1]);let Ji=[];yi.setFilter(ae.filter);for(let xi of yi.getNodesInfo()){if(xi.hiddenByReplacement||!xi.node.meshes)continue;let dr=xi.node,wi=0;ie.terrain&&dr.elevation&&(wi=dr.elevation*ie.terrain.exaggeration());let Fr=(()=>{let wo=xi.aabb;return nt.min=[...wo.min],nt.max=[...wo.max],nt.min[2]+=wi,nt.max[2]+=wi,n.af(nt.min,nt.min,qi),n.af(nt.max,nt.max,qi),nt})(),hr=xi.evaluatedScale;if(hr[0]<=1&&hr[1]<=1&&hr[2]<=1&&Fr.intersects(Dt)===0)continue;if(!xt&&vt){let wo=.16666666666666666;xi.cameraCollisionOpacity=Ge[0]>Fr.min[0]&&Ge[0]<Fr.max[0]&&Ge[1]>Fr.min[1]&&Ge[1]<Fr.max[1]&&Ge[2]*gt<Fr.max[2]&&dr.footprint&&n.b$(xr,dr.footprint)?Math.max(xi.cameraCollisionOpacity-wo,0):Math.min(1,xi.cameraCollisionOpacity+wo)}let ci=[...qi],$i=1/n.d6(ji.canonical),Qr=dr.anchor?dr.anchor[0]:0,yn=dr.anchor?dr.anchor[1]:0;n.bq(ci,ci,[Qr*(hr[0]-1)+xi.evaluatedTranslation[0]*$i,yn*(hr[1]-1)+xi.evaluatedTranslation[1]*$i,wi+xi.evaluatedTranslation[2]]),n.cp(hr,n.eD)||n.cR(ci,ci,hr);let rn=n.aB([],ci,dr.globalMatrix),pn=n.aB([],ue.expandedFarZProjMatrix,rn),Ko=n.aB([],ue.expandedFarZProjMatrix,ci),No=n.aC([],[Qr,yn,wi,1],pn)[2];dr.hidden=!1;let uo=Ee;xt||(vt&&(uo*=xi.cameraCollisionOpacity,uo*=Lc(ci,ue,xi.aabb,ft)),uo*=pd(Ft,No)),uo!==0?Ji.push({nodeInfo:xi,depth:No,opacity:uo,wvpForNode:pn,wvpForTile:Ko,nodeModelMatrix:rn,tileModelMatrix:ci}):dr.hidden=!0}xt||Ji.sort(((xi,dr)=>!vt||xi.opacity===1&&dr.opacity===1?xi.depth<dr.depth?-1:1:xi.opacity===1?-1:dr.opacity===1?1:xi.depth>dr.depth?-1:1));for(let xi of Ji){let dr=xi.nodeInfo,wi=dr.node,Fr=n.aB([],De,xi.tileModelMatrix);n.aB(Fr,Ye,Fr);let hr=n.bk([],Fr);n.ef(hr,hr),n.cR(hr,hr,pg),Fr=n.aB(Fr,Fr,wi.globalMatrix);let ci=ie.renderPass==="light-beam",$i=ae.paint.get("model-color-use-theme").constantOr("default")==="none",Qr=Ir&n.eH.HasMapboxMeshFeatures,yn=Qr?0:dr.evaluatedRMEA[0][2];for(let rn=0;rn<wi.meshes.length;++rn){let pn=wi.meshes[rn],Ko=rn===wi.lightMeshIndex,No=xi.wvpForNode;if(Ko){if(!ci&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}No=xi.wvpForTile}else if(ci)continue;let uo={defines:[]},wo=[];if(!xt&&ze&&(ze.useNormalOffset=!!pn.normalBuffer),pu(uo.defines,wo,pn,ie,$i?null:ae.lut),Qr||uo.defines.push("DIFFUSE_SHADED"),gr&&uo.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(xt?Lt.numRenderedVerticesInShadowPass+=pn.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=pn.vertexArray.length),xt){mu(pn,xi.nodeModelMatrix,ie,ae);continue}let Is=null;if(ve){let vn=of(xi.nodeModelMatrix,ie.transform);if(Is=new Float32Array(vn),ue.projection.name!=="globe"){let Ar=pn.aabb.min,wn=pn.aabb.max,[Xn,ln]=ve.getOpacityForBounds(vn,Ar[0],Ar[1],wn[0],wn[1]);uo.overrideFog=Xn>=Fe||ln>=Fe}}let ho=pn.material,Ps;ho.occlusionTexture&&ho.occlusionTexture.offsetScale&&(Ps=ho.occlusionTexture.offsetScale,uo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let ea=ie.getOrCreateProgram("model",uo);!xt&&ze&&ze.setupShadowsFromMatrix(xi.tileModelMatrix,ea,ze.useNormalOffset),ie.uploadCommonUniforms(pe,ea,null,Is);let $n=ho.pbrMetallicRoughness;$n.metallicFactor=.9,$n.roughnessFactor=.5;let an=ah(new Float32Array(No),new Float32Array(Fr),new Float32Array(hr),new Float32Array(wi.globalMatrix),ie,xi.opacity,$n.baseColorFactor,ho.emissiveFactor,$n.metallicFactor,$n.roughnessFactor,ho,yn,ae,[0,0,0],Ps);!Ko&&(dr.hasTranslucentParts||xi.opacity<1)&&ea.draw(ie,pe.gl.TRIANGLES,Ke,ni.disabled,vi.disabled,Jt.backCCW,an,ae.id,pn.vertexBuffer,pn.indexBuffer,pn.segments,ae.paint,ie.transform.zoom,void 0,wo),ea.draw(ie,pe.gl.TRIANGLES,Ko?Ne:Ke,ni.disabled,Ko||xi.opacity<1||dr.hasTranslucentParts?vi.alphaBlended:vi.unblended,Jt.backCCW,an,ae.id,pn.vertexBuffer,pn.indexBuffer,pn.segments,ae.paint,ie.transform.zoom,void 0,wo)}}}})()})(l,t,o,c),void F();if(O.type!=="model")return;let N=O.getModels(),q=[],G=l.transform.getFreeCameraOptions().position,K=n.c4([],[G.x,G.y,G.z],l.transform.worldSize);n.ev(K,K);let $=[],ee=[],se=0;for(let ie of N){let ge=t.getFeatureState("",ie.id),ae={type:"Unknown",id:ie.id,properties:ie.featureProperties},ye=o.paint.get("model-rotation").evaluate(ae,ge),pe=o.paint.get("model-scale").evaluate(ae,ge),ue=o.paint.get("model-translation").evaluate(ae,ge);gu(o,ie.id,ge,ie.featureProperties,ie.nodeOverrideNames,ie.nodeOverrides),rv(o,ie.id,ge,ie.featureProperties,ie.materialOverrideNames,ie.materialOverrides),ie.nodeOverrides.size>0&&ie.computeBoundsAndApplyParent(),ie.computeModelMatrix(l,ye,pe,ue,S,x,!1);let ve=n.bz([]),ze=n.ee(ie.position.lat,l.transform.zoom),Ie=n.bp([],[1,1,1/ze]);n.bq(ve,ve,K),q.push({zScaleMatrix:Ie,negCameraPosMatrix:ve});for(let Ge of ie.nodes)gh(l,Ge,ie.matrix,l.transform.expandedFarZProjMatrix,se,$,ee,ie.materialOverrides);se++}if($.sort(((ie,ge)=>ge.depth-ie.depth)),l.renderPass!=="shadow")dg(l,o,f,$,ee,q),F();else{for(let ie of ee)mu(ie.mesh,ie.nodeModelMatrix,l,o);for(let ie of $)mu(ie.mesh,ie.nodeModelMatrix,l,o);F()}}},yh={line:function(l,t,o){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){let c=t.getVisibleCoordinates();for(let f of c){let _=t.getTile(f).getBucket(l);if(_&&(_.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,o){let c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson"){let _=mh(c,l,o.style._importedAsBasemap);return void(o.modelManager&&o.modelManager.upload(o,_))}if(c.type==="batched-model"||c.type!=="model")return;let f=c.getModels();for(let _ of f)_.upload(o.context)},raster:function(l,t,o){let c=t.getSource();if(!(c instanceof Cn&&c.loaded()))return;let f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;let _=l.paint.get("raster-array-band")||c.getInitialBand(f);if(_==null)return;let x=t.getIds().map((S=>t.getTileByID(S)));for(let S of x)S.updateNeeded(l.id,_)&&c.prepareTile(S,f,l.id,_)},"raster-particle":function(l,t,o){let c=t.getSource();if(!(c instanceof Cn&&c.loaded()))return;let f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;let _=l.paint.get("raster-particle-array-band")||c.getInitialBand(f);if(_==null)return;let x=t.getIds().map((S=>t.getTileByID(S)));for(let S of x)S.updateNeeded(l.id,_)&&c.prepareTile(S,f,l.id,_)}},vh={fill:Ic},ks={fill:function(l,t,o,c){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;let f=l.context.gl,_=new Rt(f.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D),x=new ni({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),S=l.transform.getFreeCameraOptions().position,E=l.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(let P of c){let M=t.getTile(P),F=M.getBucket(o);if(!F)continue;let O=F.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;let N=og(P.toUnwrapped(),S),q=l.translatePosMatrix(P.projMatrix,M,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),G=th(q,N,0,1,0);E.draw(l,f.TRIANGLES,_,x,vi.disabled,Jt.disabled,G,o.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,o.paint,l.transform.zoom)}}};class Yl{constructor(t,o,c,f,_,x){this.context=new ch(t,o),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=n.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(let P of S)this._debugParams.enabledLayers[P]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let P of S)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new nv(_),this.setup(),this.numSublayers=Lr.maxUnderzooming+Lr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ra(this),this._wireframeDebugCache=new mg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let E=new n.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,E,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=f,this.worldview=x}updateTerrain(t,o){let c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ad(this,t));let f=this._terrain;this.transform.elevation=c?f:null,f.update(t,this.transform,o),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){let o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[c,f]=o.getFovAdjustedRange(this.transform._fov);if(c>f)return void(this.transform.fogCullDistSq=null);let _=c+.78*(f-c);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new ad(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*n.o.devicePixelRatio,this.height=o*n.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let c of this.style.order)this.style._mergedLayers[c].resize()}setup(){let t=this.context,o=new n.bc;o.emplaceBack(0,0),o.emplaceBack(n.al,0),o.emplaceBack(0,n.al),o.emplaceBack(n.al,n.al),this.tileExtentBuffer=t.createVertexBuffer(o,n.be.members),this.tileExtentSegments=n.bf.simpleSegment(0,0,4,2);let c=new n.bc;c.emplaceBack(0,0),c.emplaceBack(n.al,0),c.emplaceBack(0,n.al),c.emplaceBack(n.al,n.al),this.debugBuffer=t.createVertexBuffer(c,n.be.members),this.debugSegments=n.bf.simpleSegment(0,0,4,5);let f=new n.bc;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,n.be.members),this.viewportSegments=n.bf.simpleSegment(0,0,4,2);let _=new n.a$;_.emplaceBack(0,0,0,0),_.emplaceBack(n.al,0,n.al,0),_.emplaceBack(0,n.al,0,n.al),_.emplaceBack(n.al,n.al,n.al,n.al),this.mercatorBoundsBuffer=t.createVertexBuffer(_,n.bh.members),this.mercatorBoundsSegments=n.bf.simpleSegment(0,0,4,2);let x=new n.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);let S=new n.bd;for(let P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new n.T(t,new n.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bB();let E=this.context.gl;this.stencilClearMode=new ni({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Rt.disabled,this.stencilClearMode,vi.disabled,Jt.disabled,Ac(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,c){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(let E of c)if(this._tileClippingMaskIDs[E.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;let f=this.context,_=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(vi.disabled),f.setDepthMode(Rt.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let S of c){let E=o.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:F,tileBoundsSegments:O}=this.getTileBoundsBuffers(E);x.draw(this,_.TRIANGLES,Rt.disabled,new ni({func:_.ALWAYS,mask:0},P,255,_.KEEP,_.KEEP,_.REPLACE),vi.disabled,Jt.disabled,Ac(S.projMatrix),"$clipping",M,F,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,o=this.context.gl;return new ni({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let o=this.context.gl;return new ni({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){let o=this.context.gl,c=t.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),f=c[c.length-1].overscaledZ,_=c[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();let x={};for(let S=0;S<_;S++)x[S+f]=new ni({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[x,c]}return[{[f]:ni.disabled},c]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new vi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vi.unblended:vi.alphaBlended}colorModeForDrapableLayerRenderPass(t){let o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new vi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,c,f=!1){if(this.depthOcclusion)return new Rt(this.context.gl.GREATER,Rt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return Rt.disabled;let _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Rt(c||this.context.gl.LEQUAL,o,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,o=Math.ceil(this.width),c=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&c!==0&&(this.depthFBO=new lh(this.context,o,c,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,c,0,0,o,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,o)=>t+o/this._fpsHistory.length),0))}render(t,o){let c=n.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;let f=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(_).filter((De=>{let Ee=f[De];return!(Ee.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ee.type]})),S=x(),E=!1,P=!1,M=null;for(let De of S){let Ee=f[De];Ee.type==="circle"?E=!0:Ee.type==="building"?M=Ee:Ee.type==="symbol"&&(Ee.hasOcclusionOpacityProperties?P=!0:E=!0)}let F=S.map((De=>f[De])),O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.o.now()),this.imageManager.beginFrame();let N=0,q=!1;for(let De in O){let Ee=O[De];Ee.used&&(Ee.prepare(this.context),Ee.getSource().usedInConflation&&++N)}let G=!1;for(let De of F)De.isHidden(this.transform.zoom)||(De.type==="clip"&&(G=!0),this.prepareLayer(De));let K={},$={},ee={},se={},ie={};for(let De in O){let Ee=O[De];K[De]=Ee.getVisibleCoordinates(),$[De]=K[De].slice().reverse(),ee[De]=Ee.getVisibleCoordinates(!0).reverse(),se[De]=Ee.getShadowCasterCoordinates(),ie[De]=Ee.sortCoordinatesByDistance(K[De])}let ge=De=>{let Ee=this.style.getLayerSourceCache(De);return Ee&&Ee.used?Ee.getSource():null};if(N||G||this._clippingActiveLastFrame){let De=[],Ee=[],Ke=0;for(let Ne of F)this.isSourceForClippingOrConflation(Ne,ge(Ne))&&(De.push(Ne),Ee.push(Ke)),Ke++;if(De&&(G||De.length>1)||this._clippingActiveLastFrame){G=!1;let Ne=[];for(let nt=0;nt<De.length;nt++){let xt=De[nt],Dt=Ee[nt],ft=this.style.getLayerSourceCache(xt);if(!ft||!ft.used||!ft.getSource().usedInConflation&&xt.type!=="clip"&&xt.type!=="building")continue;let vt=n.eP,Ft=n.bZ.None,Lt=[],It=!0;if(xt.type==="building")vt=n.eR;else if(xt.type==="clip"){vt=Dt;for(let zt of xt.layout.get("clip-layer-types"))Ft|=zt==="model"?n.bZ.Model:zt==="symbol"?n.bZ.Symbol:n.bZ.FillExtrusion;for(let zt of xt.layout.get("clip-layer-scope"))Lt.push(zt);xt.isHidden(this.transform.zoom)?It=!1:G=!0}It&&Ne.push({layer:xt.fqid,cache:ft,order:vt,clipMask:Ft,clipScope:Lt})}this.replacementSource.setSources(Ne),q=!0}}this._clippingActiveLastFrame=G,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let De=0;De<F.length;De++){let Ee=F[De],Ke=Ee.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){let Ne=ge(Ee);Ne&&(this.minCutoffZoom=Math.max(Ne.minzoom,this.minCutoffZoom)),Ee.minzoom&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom))}Ee.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=De),this._lastOcclusionLayer=De)}let ae=this.style&&this.style.fog;ae?(this._fogVisible=ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,S=x(),F=S.map((De=>f[De])));let ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(let De in O)for(let Ee of K[De]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(Ee)||Ke),ye.addShadowReceiver(Ee.toUnwrapped(),Ke.min,Ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new cf(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),ue&&!this._rain&&(this._rain=new _u(this)),!ue&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),M){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Me);let De=this.style.getLayerSourceCache(M);this.buildingTileBorderManager.updateBorders(De,M)}if(!Wr.has(this.context.gl))return;this.renderPass="offscreen";for(let De of F){let Ee=t.getLayerSourceCache(De);if(!De.hasOffscreenPass()||De.isHidden(this.transform.zoom))continue;let Ke=Ee?$[Ee.id]:void 0;(De.type==="custom"||De.type==="raster"||De.type==="raster-particle"||De.isSky()||Ke&&Ke.length)&&this.renderLayer(this,Ee,De,Ke)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ve=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(o.showOverdrawInspector)return n.ao.black;let De=this.style.fog;if(De&&this.transform.projection.supportsFog){let Ee=this.style.getLut(De.scope);if(!ve){let Ke=De.properties.get("color-use-theme")==="none",Ne=De.properties.get("color").toNonPremultipliedRenderColor(Ke?null:Ee).toArray01();return new n.ao(...Ne)}if(ve){let Ke=De.properties.get("space-color-use-theme")==="none",Ne=De.properties.get("space-color").toNonPremultipliedRenderColor(Ke?null:Ee).toArray01();return new n.ao(...Ne)}}return n.ao.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let De=F[this.currentLayer],Ee=t.getLayerSourceCache(De);if(De.isSky())continue;let Ke=Ee?(De.is3D(_)?ie:$)[Ee.id]:void 0;this._renderTileClippingMasks(De,Ee,Ke),this.renderLayer(this,Ee,De,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let De=F[this.currentLayer],Ee=t.getLayerSourceCache(De);De.isSky()&&this.renderLayer(this,Ee,De,Ee?$[Ee.id]:void 0)}function Ie(De,Ee){let Ke;return Ee&&(Ke=(De.type==="symbol"?ee:De.is3D(_)?ie:$)[Ee.id]),Ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){let De=F[this.currentLayer];if(De.type==="raster"||De.type==="raster-particle"){let Ee=t.getLayerSourceCache(De);this.renderLayer(this,Ee,De,Ie(De,Ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;ye&&(Ge=ye.getShadowCastingLayerCount());let Be=!1,Ye=-1;for(let De=0;De<S.length;++De){let Ee=F[De];Ee.isHidden(this.transform.zoom)||Ee.is3D(_)&&(Ye=De)}P&&Ye===-1&&(E=!0);let gt=!1;for(;this.currentLayer<S.length;){let De=F[this.currentLayer],Ee=t.getLayerSourceCache(De);if(De.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(De)){if(De.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!gt&&De.is3D(_)&&!_){let Ke=this.currentLayer,Ne=nt=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){let xt=F[this.currentLayer];if(vh[xt.type]){let Dt=this.style.getLayerSourceCache(xt);vh[xt.type](this,Dt,xt,Ie(xt,Dt),nt)}}};Ne("initialize"),Ne("reset"),this.currentLayer=Ke,gt=!0}if(E&&!Be&&this.terrain&&!this.transform.isOrthographic&&(Be=!0,this.blitDepth()),P&&Ye!==-1&&this.currentLayer===Ye+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(De,Ee,Ee?K[Ee.id]:void 0),this.renderLayer(this,Ee,De,Ie(De,Ee)),!this.terrain&&ye&&Ge>0&&De.hasShadowPass()&&--Ge==0){{this.clearStencil(),this.resetStencilClippingMasks();let Ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){let Ne=F[this.currentLayer];if(ks[Ne.type]){let nt=this.style.getLayerSourceCache(Ne);ks[Ne.type](this,nt,Ne,Ie(Ne,nt))}}this.currentLayer=Ke}if(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){let Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){let Ne=F[this.currentLayer];if(!Ne.hasLightBeamPass())continue;let nt=t.getLayerSourceCache(Ne);this.renderLayer(this,nt,Ne,nt?$[nt.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Ke=this.currentLayer;this.depthOcclusion=!0;for(let Ne of this.layersWithOcclusionOpacity){this.currentLayer=Ne;let nt=F[this.currentLayer],xt=t.getLayerSourceCache(nt),Dt=xt?$[xt.id]:void 0;this.terrain||this._renderTileClippingMasks(nt,xt,xt?K[xt.id]:void 0),this.renderLayer(this,xt,nt,Dt)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let De=null;F.forEach((Ee=>{let Ke=t.getLayerSourceCache(Ee);Ke&&!Ee.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!De||De.getSource().maxzoom<Ke.getSource().maxzoom)&&(De=Ke)})),De&&this.options.showTileBoundaries&&rf(this,De,De.getVisibleCoordinates(),n.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&rf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(De){let Ee=De.transform.padding;Rr(De,De.transform.height-(Ee.top||0),3,Xl),Rr(De,Ee.bottom||0,3,lg),hd(De,Ee.left||0,3,Qp),hd(De,De.transform.width-(Ee.right||0),3,ef);let Ke=De.transform.centerPoint;(function(Ne,nt,xt,Dt){du(Ne,nt-1,xt-10,2,20,Dt),du(Ne,nt-10,xt-1,20,2,Dt)})(De,Ke.x,De.transform.height-Ke.y,tf)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:o}=this.transform.projection,c=!o||!o.includes(t.type);if(yh[t.type]&&(c||this.terrain&&t.type==="custom")){let f=this.style.getLayerSourceCache(t);yh[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,o,c,f){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||f&&f.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||uf[c.type](t,o,c,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let o=this.context.extTimerQuery,c=this.context.gl,f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),f.calls++,c.beginQuery(o.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,o=this.context.gl,c=o.createQuery();this.deferredRenderGpuTimeQueries.push(c),o.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let o={};for(let c in t){let f=t[c],_=this.context.extTimerQuery,x=_.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(f.query),o[c]=x}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let o=this.context.gl,c=0;for(let f of t)c+=o.getQueryParameter(f,o.QUERY_RESULT)/1e6,o.deleteQuery(f);return c}translatePosMatrix(t,o,c,f,_){if(!c[0]&&!c[1])return t;let x=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(x){let P=Math.sin(x),M=Math.cos(x);c=[c[0]*M-c[1]*P,c[0]*P+c[1]*M]}let S=[_?c[0]:n.ay(o,c[0],this.transform.zoom),_?c[1]:n.ay(o,c[1],this.transform.zoom),0],E=new Float32Array(16);return n.bq(E,t,S),E}saveTileTexture(t){if(t.context!==this.context)return;let o=t.size[0],c=this._tileTextures[o];c?c.push(t):this._tileTextures[o]=[t]}getTileTexture(t){let o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,c){let f=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||f||o!==void 0&&!o||_.push("FOG","FOG_DITHERING"),f&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,o){this.cache=this.cache||{};let c=o&&o.defines||[],f=o&&o.config,_=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(c),x=ld.cacheKey(wc[t],t,_,f);return this.cache[x]||(this.cache[x]=new ld(this.context,t,wc[t],f,Qy[t],_)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){let c=this.style.directionalLight,f=this.style.ambientLight;if(c&&f){let _=((x,S,E)=>{let P=x.properties.get("direction"),M=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toNonPremultipliedRenderColor(M?null:E.getLut(x.scope)).toArray01(),O=x.properties.get("intensity"),N=S.properties.get("color-use-theme")==="none",q=S.properties.get("color").toNonPremultipliedRenderColor(N?null:E.getLut(S.scope)).toArray01(),G=S.properties.get("intensity"),K=[P.x,P.y,P.z],$=n.dM(q,G),ee=n.dM(F,O);return{u_lighting_ambient_color:$,u_lighting_directional_dir:K,u_lighting_directional_color:ee,u_ground_radiance:Bp(K,ee,$)}})(c,f,this.style);o.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,o,c,f,_){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let S=x.getOpacity(this.transform.pitch),E=((P,M,F,O,N,q,G,K,$,ee,se,ie)=>{let ge=P.transform,ae=M.properties.get("color-use-theme")==="none",ye=M.properties.get("color").toNonPremultipliedRenderColor(ae?null:P.style.getLut(M.scope)).toArray01();ye[3]=O;let pe=P.frameCounter/1e3%1,[ue,ve]=M.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):ie||P.identityMat,u_fog_range:M.getFovAdjustedRange(ge._fov),u_fog_color:ye,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ue,ve),ve],u_fog_temporal_offset:pe,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:G,u_frustum_bl:K,u_globe_pos:$,u_globe_radius:ee,u_viewport:se,u_globe_transition:n.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,c,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.o.devicePixelRatio,this.transform.height*n.o.devicePixelRatio],f);o.setFogUniformValues(t,E)}_&&o.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,o=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(let f of c)o[f.key]=t[f.key]||new rs(f,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Fe||o[1]>=Fe}setupDepthForOcclusion(t,o,c){let f=this.context,_=f.gl,x=!!c;var S;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),f.activeTexture.set(_.TEXTURE0),x||o.setTerrainUniformValues(f,c)}}function Mc(l,t){let o=!1,c=null,f=()=>{c=null,o&&(l(),c=setTimeout(f,t),o=!1)};return()=>(o=!0,c||f(),c)}class xh{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let o=bh(t);if(this._hashName){let c=this._hashName,f=!1,_=location.hash.slice(1).split("&").map((x=>{let S=x.split("=")[0];return S===c?(f=!0,`${S}=${o}`):x})).filter((x=>x));return f||_.push(`${c}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(o=c)})),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let o=this._getCurrentHash();if(o.length>=3&&!o.some((c=>isNaN(Number(c))))){let c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function bh(l,t){let o=l.getCenter(),c=Math.round(100*l.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),x=Math.round(o.lng*_)/_,S=Math.round(o.lat*_)/_,E=l.getBearing(),P=l.getPitch(),M=t?`/${x}/${S}/${c}`:`${c}/${S}/${x}`;return(E||P)&&(M+="/"+Math.round(10*E)/10),P&&(M+=`/${Math.round(P)}`),M}let yu={linearity:.3,easing:n.eS(0,0,.3,1)},Kl=Object.assign({deceleration:2500,maxSpeed:1400},yu),df=Object.assign({deceleration:20,maxSpeed:1400},yu),Js=Object.assign({deceleration:1e3,maxSpeed:360},yu),hf=Object.assign({deceleration:1e3,maxSpeed:90},yu);class wh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.o.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,o=n.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){let _=xu(o.pan.mag(),c,Object.assign({},Kl,t||{}));f.offset=o.pan.mult(_.amount/o.pan.mag()),f.center=this._map.transform.center,vu(f,_)}if(o.zoom){let _=xu(o.zoom,c,df);f.zoom=this._map.transform.zoom+_.amount,vu(f,_)}if(o.bearing){let _=xu(o.bearing,c,Js);f.bearing=this._map.transform.bearing+n.aA(_.amount,-179,179),vu(f,_)}if(o.pitch){let _=xu(o.pitch,c,hf);f.pitch=this._map.transform.pitch+_.amount,vu(f,_)}if(f.zoom||f.bearing){let _=o.pinchAround===void 0?o.around:o.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function vu(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function xu(l,t,o){let{maxSpeed:c,linearity:f,deceleration:_}=o,x=n.aA(l*f/(t/1e3),-c,c),S=Math.abs(x)/(_*f);return{easing:o.easing,duration:1e3*S,amount:x*(S/2)}}class Yr extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,c,f={}){let _=lr(o.getCanvasContainer(),c),x=o.unproject(_);super(t,Object.assign({point:_,lngLat:x,originalEvent:c},f)),this._defaultPrevented=!1,this.target=o}}class bu extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,c){let f=t==="touchend"?c.changedTouches:c.touches,_=bt(o.getCanvasContainer(),f),x=_.map((E=>o.unproject(E))),S=_.reduce(((E,P,M,F)=>E.add(P.div(F.length))),new n.P(0,0));super(t,{points:_,point:S,lngLats:x,lngLat:o.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class pf extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class ff{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new pf(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Yr(t.type,this._map,t))}mouseup(t){this._map.fire(new Yr(t.type,this._map,t))}preclick(t){let o=new MouseEvent("preclick",t);this._map.fire(new Yr(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Yr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Yr(t.type,this._map,t))}mouseover(t){this._map.fire(new Yr(t.type,this._map,t))}mouseout(t){this._map.fire(new Yr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new bu(t.type,this._map,t))}touchmove(t){this._map.fire(new bu(t.type,this._map,t))}touchend(t){this._map.fire(new bu(t.type,this._map,t))}touchcancel(t){this._map.fire(new bu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Yr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Yr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mf{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(St(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;let c=o,f=this._startPos,_=this._lastPos;if(!f||!_||_.equals(c)||!this._box&&c.dist(f)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let x=Math.min(f.x,c.x),S=Math.max(f.x,c.x),E=Math.min(f.y,c.y),P=Math.max(f.y,c.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${x}px,${E}px)`,this._box.style.width=S-x+"px",this._box.style.height=P-E+"px")}))}mouseupWindow(t,o){if(!this._active)return;let c=this._startPos,f=o;if(c&&t.button===0){if(this.reset(),Cr(),c.x!==f.x||c.y!==f.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ai(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.z(t,{originalEvent:o}))}}function md(l,t){let o={};for(let c=0;c<l.length;c++)o[l[c].identifier]=t[c];return o}class gf{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){let _=new n.P(0,0);for(let x of f)_._add(x);return _.div(f.length)})(o),this.touches=md(c,o)))}touchmove(t,o,c){if(this.aborted||!this.centroid)return;let f=md(c,o);for(let _ in this.touches){let x=f[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,o,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Jl{constructor(t){this.singleTap=new gf(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,c){this.singleTap.touchstart(t,o,c)}touchmove(t,o,c){this.singleTap.touchmove(t,o,c)}touchend(t,o,c){let f=this.singleTap.touchend(t,o,c);if(f){let _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class _f{constructor(){this._zoomIn=new Jl({numTouches:1,numTaps:2}),this._zoomOut=new Jl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,c){this._zoomIn.touchstart(t,o,c),this._zoomOut.touchstart(t,o,c)}touchmove(t,o,c){this._zoomIn.touchmove(t,o,c),this._zoomOut.touchmove(t,o,c)}touchend(t,o,c){let f=this._zoomIn.touchend(t,o,c),_=this._zoomOut.touchend(t,o,c);return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(f)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Sh={0:1,2:2},Th={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class wu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;let c=Wt(t);this._correctButton(t,c)&&(this._lastPoint=o,this._eventButton=c)}mousemoveWindow(t,o){let c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&(function(f,_){let x=Sh[_];return f.buttons===void 0||(f.buttons&x)!==x})(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(c,o)}}mouseupWindow(t){this._lastPoint&&Wt(t)===this._eventButton&&(this._moved&&Cr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yf extends wu{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Ch extends wu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Th[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){let c=.8*(o.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class vf extends wu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Th[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){let c=-.5*(o.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class _g{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,o,c){return this._calculateTransform(t,o,c)}touchmove(t,o,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!n.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,c)}}touchend(t,o,c){this._calculateTransform(t,o,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,c){c.length>0&&(this._active=!0);let f=md(c,o),_=new n.P(0,0),x=new n.P(0,0),S=0;for(let P in f){let M=f[P],F=this._touches[P];F&&(_._add(M),x._add(M.sub(F)),S++,f[P]=M)}if(this._touches=f,S<this._minTouches||!x.mag())return;let E=x.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Eh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,c){return{}}touchstart(t,o,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,c){let f=this._firstTwoTouches;if(!f)return;t.preventDefault();let[_,x]=f,S=gd(c,o,_),E=gd(c,o,x);if(!S||!E)return;let P=this._aroundCenter?null:S.add(E).div(2);return this._move([S,E],P,t)}touchend(t,o,c){if(!this._firstTwoTouches)return;let[f,_]=this._firstTwoTouches,x=gd(c,o,f),S=gd(c,o,_);x&&S||(this._active&&Cr(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function gd(l,t,o){for(let c=0;c<l.length;c++)if(l[c].identifier===o)return t[c]}function xf(l,t){return Math.log2(l/t)}class yg extends Eh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){let c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xf(this._distance,c),pinchAround:o}}}function bf(l,t){return 180*l.angleWith(t)/Math.PI}class vg extends Eh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){let c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bf(this._vector,c),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let o=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;let f=bf(t,c);return Math.abs(f)<o}}function Ah(l){return Math.abs(l.y)>Math.abs(l.x)}class xg extends Eh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ah(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,c){let f=this._lastPoints;if(!f)return;let _=t[0].sub(f[0]),x=t[1].sub(f[1]);return this._map._cooperativeGestures&&!n.eT()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(t,o,c){if(this._valid!==void 0)return this._valid;let f=t.mag()>=2,_=o.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;let x=t.y>0==o.y>0;return Ah(t)&&Ah(o)&&x}}let bg={panStep:100,bearingStep:15,pitchStep:10};class wg{constructor(){let t=bg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,c=0,f=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:S=>{let E=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Sg,zoom:o?Math.round(E)+o*(t.shiftKey?2:1):E,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+f*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sg(l){return l*(2-l)}let Tg=4.000244140625,av=1/450;class lv{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=av,n.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,c=n.o.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,o!==0&&o%Tg==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=lr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>Tg?this._wheelZoomRate:this._defaultZoomRate,M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);let F=o(),O=Math.pow(2,F),N=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(N*M))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let c=typeof this._targetZoom=="number"?this._targetZoom:o(),f=this._startZoom,_=this._easing,x,S=!1;if(this._type==="wheel"&&f&&_){let P=Math.min((n.o.now()-this._lastWheelEventTime)/200,1),M=_(P);x=n.ak(f,c,M),P<1?this._frameId||(this._frameId=!0):S=!0}else x=c,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let E=x-o();return E*this._lastDelta<0&&(E=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:E,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.eU;if(this._prevEase){let c=this._prevEase,f=(n.o.now()-c.start)/c.duration,_=c.easing(f+.01)-c.easing(f),x=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-x*x);o=n.eS(x,S,.25,1)}return this._prevEase={start:n.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class tn{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cv{constructor(){this._tap=new Jl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=o[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,o,c))}touchmove(t,o,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let f=o[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,o,c)}touchend(t,o,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,o,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uv{constructor(t,o,c){this._el=t,this._mousePan=o,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dv{constructor(t,o,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _d{constructor(t,o,c,f){this._el=t,this._touchZoom=o,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let yd=l=>l.zoom||l.drag||l.pitch||l.rotate;class wf extends n.z{}class kh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){let c=n.av([],o,t);this.radius=n.ag(c[2]<0?n.eW([],c,this.constants):[c[0],c[1],0])}projectRay(t){n.eW(t,t,this.constants),n.aw(t,t),n.eX(t,t,this.constants);let o=n.c4([],t,this.radius);if(o[2]>0){let c=n.c4([],[0,0,1],n.bI(o,[0,0,1])),f=n.c4([],n.aw([],[o[0],o[1],0]),this.radius),_=n.d7([],o,n.c4([],n.av([],n.d7([],f,c),o),2));o[0]=_[0],o[1]=_[1]}return o}}function Qs(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Ih{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wh(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aX(["handleEvent","handleWindowEvent"],this);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[f,_,x]of this._listeners){let S=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(_,S,x)}}destroy(){for(let[t,o,c]of this._listeners){let f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,f,c)}}_addDefaultHandlers(t){let o=this._map,c=o.getCanvasContainer();this._add("mapEvent",new ff(o,t));let f=o.boxZoom=new mf(o,t);this._add("boxZoom",f);let _=new _f,x=new Cg;o.doubleClickZoom=new tn(x,_),this._add("tapZoom",_),this._add("clickZoom",x);let S=new cv;this._add("tapDragZoom",S);let E=o.touchPitch=new xg(o);this._add("touchPitch",E);let P=new Ch(t),M=new vf(t);o.dragRotate=new dv(t,P,M),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);let F=new yf(t),O=new _g(o,t);o.dragPan=new uv(c,F,O),this._add("mousePan",F),this._add("touchPan",O,["touchZoom","touchRotate"]);let N=new vg,q=new yg;o.touchZoomRotate=new _d(c,q,N,S),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oc(o));let G=o.scrollZoom=new lv(o,this);this._add("scrollZoom",G,["mousePan"]);let K=o.keyboard=new wg;this._add("keyboard",K);for(let $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[$]&&o[$].enable(t[$])}_add(t,o,c){this._handlers.push({handlerName:t,handler:o,allowed:c}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,c){for(let f in t)if(f!==c&&(!o||o.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let o=[];for(let c of t)this._el.contains(c.target)&&o.push(c);return o}handleEvent(t,o){this._updatingCamera=!0;let c=t.type==="renderFrame",f=c?void 0:t,_={needsRenderFrame:!1},x={},S={},E=t.touches?this._getMapTouches(t.touches):void 0,P=E?bt(this._el,E):c?void 0:lr(this._el,t);for(let{handlerName:O,handler:N,allowed:q}of this._handlers){if(!N.isEnabled())continue;let G;this._blockedByActive(S,q,O)?N.reset():N[o||t.type]&&(G=N[o||t.type](t,P,E),this.mergeHandlerResult(_,x,G,O,f),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||N.isActive())&&(S[O]=N)}let M={};for(let O in this._previousActiveHandlers)S[O]||(M[O]=f);this._previousActiveHandlers=S,(Object.keys(M).length||Qs(_))&&(this._changes.push([_,x,M]),this._triggerRenderFrame()),(Object.keys(S).length||Qs(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=_;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,o,c,f,_){if(!c)return;Object.assign(t,c);let x={handlerName:f,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(o.zoom=x),c.panDelta!==void 0&&(o.drag=x),c.pitchDelta!==void 0&&(o.pitch=x),c.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){let t={},o={},c={};for(let[f,_,x]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),Object.assign(o,_),Object.assign(c,x);this._updateMapTransform(t,o,c),this._changes=[]}_updateMapTransform(t,o,c){let f=this._map,_=f.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{let se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Qs(t)){let ee=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),ee!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&f._stop(!0),!Qs(t))return void this._fireEvents(o,c,!0);let{panDelta:S,zoomDelta:E,bearingDelta:P,pitchDelta:M,around:F,aroundCoord:O,pinchAround:N}=t;_._isCameraConstrained&&(E>0&&(E=0),_._isCameraConstrained=!1),N!==void 0&&(F=N),(E||(ee=>o[ee]&&!this._eventsInProgress[ee])("drag"))&&F&&(this._dragOrigin=x(_.pointCoordinate3D(F)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",f._stop(!0),F=F||f.transform.centerPoint,P&&(_.bearing+=P),M&&(_.pitch+=M),_._updateCameraState();let q=[0,0,0];if(S)if(_.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F).dir),se=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F.sub(S)).dir);q[0]=se[0]-ee[0],q[1]=se[1]-ee[1]}else{let ee=_.pointCoordinate(F);if(_.projection.name==="globe"){S=S.rotate(-_.angle);let se=_._pixelsPerMercatorPixel/_.worldSize;q[0]=-S.x*n.eV(n.a_(ee.y))*se,q[1]=-S.y*n.eV(_.center.lat)*se}else{let se=_.pointCoordinate(F.sub(S));ee&&se&&(q[0]=se.x-ee.x,q[1]=se.y-ee.y)}}let G=_.zoom,K=[0,0,0];if(E){let ee=x(O||_.pointCoordinate3D(F)),se={dir:n.aw([],n.av([],ee,_._camera.position))};if(se.dir[2]<0){let ie=_.zoomDeltaToMovement(ee,E);n.c4(K,se.dir,ie)}}let $=n.d7(q,q,K);_._translateCameraConstrained($),E&&Math.abs(_.zoom-G)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,c,!0)}_fireEvents(t,o,c){let f=yd(this._eventsInProgress),_=yd(t),x={};for(let M in t){let{originalEvent:F}=t[M];this._eventsInProgress[M]||(x[`${M}start`]=F),this._eventsInProgress[M]=t[M]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(let M in x)this._fireEvent(M,x[M]);_&&this._fireEvent("move",_.originalEvent);for(let M in t){let{originalEvent:F}=t[M];this._fireEvent(M,F)}let S={},E;for(let M in this._eventsInProgress){let{handlerName:F,originalEvent:O}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],E=o[F]||O,S[`${M}end`]=E)}for(let M in S)this._fireEvent(M,S[M]);let P=yd(this._eventsInProgress);if(c&&(f||_)&&!P){this._updatingCamera=!0;let M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;M?(F(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:E})):(this._map.fire(new n.z("moveend",{originalEvent:E})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new wf("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let An="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Va extends n.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aX(["_renderFrameCallback"],this)}getCenter(){return new n.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,c){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),c)}panTo(t,o,c){return this.easeTo(Object.assign({center:t},o),c)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,c){return this.easeTo(Object.assign({zoom:t},o),c)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,c){return this.easeTo(Object.assign({bearing:t},o),c)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=n.aI.convert(t);let c=o&&o.bearing||0,f=o&&o.pitch||0,_=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,_,x,c,f,o)}_extendPadding(t){let o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){let c=o.max[0]-o.min[0],f=o.max[1]-o.min[1];return c/f>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,c,f,_,x){let S=t.clone(),E=this._extendCameraOptions(x);S.bearing=f,S.pitch=_;let P=n.aS.convert(o),M=n.aS.convert(c),F=.5*(P.lat+M.lat),O=.5*(P.lng+M.lng),N=n.eY(F,O),q=n.aw([],N),G=n.aw([],n.bH([],q,[0,1,0])),K=n.bH([],G,q),$=[G[0],G[1],G[2],0,K[0],K[1],K[2],0,q[0],q[1],q[2],0,0,0,0,1],ee=[N,n.eY(P.lat,P.lng),n.eY(M.lat,P.lng),n.eY(M.lat,M.lng),n.eY(P.lat,M.lng),n.eY(F,P.lng),n.eY(F,M.lng),n.eY(P.lat,O),n.eY(M.lat,O)],se=n.d8.fromPoints(ee.map((Ne=>[n.bI(G,Ne),n.bI(K,Ne),n.bI(q,Ne)]))),ie=n.af([],se.center,$);n.eZ(ie)===0&&n.e_(ie,0,0,1),n.aw(ie,ie),n.c4(ie,ie,n.aD),S.center=n.e$(ie);let ge=S.getWorldToCameraMatrix(),ae=n.bk(new Float64Array(16),ge);se=n.d8.applyTransform(se,n.aB([],ge,$));let ye=this._extendAABB(se,S,E,f);if(!ye)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=ye,n.af(ie,ie,ge);let pe=.5*(se.max[2]-se.min[2]),ue=this._minimumAABBFrustumDistance(S,se),ve=n.c4([],[0,0,1],pe),ze=n.d7(ve,ie,ve),Ie=ue+(S.pitch===0?0:n.bF(ie,ze)),Ge=S.globeCenterInViewSpace,Be=n.av([],ie,[Ge[0],Ge[1],Ge[2]]);n.aw(Be,Be),n.c4(Be,Be,Ie);let Ye=n.d7([],ie,Be);n.af(Ye,Ye,ae);let gt=n.eL/n.aD,De=n.ag(Ye),Ee=n.ce(Math.max(De*gt-n.eL,Number.EPSILON),0),Ke=Math.min(S.zoomFromMercatorZAdjusted(Ee),E.maxZoom);return Ke>.5*(n.cZ+n.cK)?(S.setProjection({name:"mercator"}),S.zoom=Ke,this._cameraForBounds(S,o,c,f,_,x)):{center:S.center,zoom:Ke,bearing:f,pitch:_}}_extendAABB(t,o,c,f){let _=.5*((c.padding.left||0)+(c.padding.right||0)),x=.5*((c.padding.top||0)+(c.padding.bottom||0)),S=x,E=_,P=_,M=x,F=o.width-(E+P),O=o.height-(S+M),N=n.av([],t.max,t.min),q=Math.min(F/N[0],O/N[1]),G=Math.min(o.scaleZoom(o.scale*q),c.maxZoom);if(isNaN(G))return null;let K=o.scale/o.zoomScale(G),$=new n.d8([t.min[0]-E*K,t.min[1]-M*K,t.min[2]],[t.max[0]+P*K,t.max[1]+S*K,t.max[2]]),ee=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new n.P(c.offset.x,c.offset.y):n.P.convert(c.offset)).rotate(-n.an(f));return $.center[0]-=ee.x*K,$.center[1]+=ee.y*K,$}queryTerrainElevation(t,o){let c=this.transform.elevation;return c?(o=Object.assign({},{exaggerated:!0},o),c.getAtPoint(n.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,c,f,_,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,c,f,_,x);let S=t.clone(),E=this._extendCameraOptions(x);S.bearing=f,S.pitch=_;let P=n.aS.convert(o),M=n.aS.convert(c),F=new n.aS(P.lng,M.lat),O=new n.aS(M.lng,P.lat),N=S.project(P),q=S.project(M),G=this.queryTerrainElevation(P),K=this.queryTerrainElevation(M),$=this.queryTerrainElevation(F),ee=this.queryTerrainElevation(O),se=[[N.x,N.y,Math.min(G||0,K||0,$||0,ee||0)],[q.x,q.y,Math.max(G||0,K||0,$||0,ee||0)]],ie=n.d8.fromPoints(se),ge=S.getWorldToCameraMatrix(),ae=n.bk(new Float64Array(16),ge);ie=n.d8.applyTransform(ie,ge);let ye=this._extendAABB(ie,S,E,f);if(!ye)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=ye;let pe=.5*n.av([],ie.max,ie.min)[2],ue=this._minimumAABBFrustumDistance(S,ie),ve=[0,0,1,0];n.aC(ve,ve,ge),n.f0(ve,ve);let ze=n.c4([],ve,ue+pe),Ie=n.d7([],ie.center,ze);n.af(ie.center,ie.center,ae),n.af(Ie,Ie,ae);let Ge=S.unproject(new n.P(ie.center[0],ie.center[1])),Be=n.f1(S.projection,Ge),Ye=Math.pow(2,Be),gt=Math.min(S._zoomFromMercatorZ(Ie[2]*S.pixelsPerMeter*Ye/S.worldSize),E.maxZoom);return S.mercatorFromTransition&&gt<.5*(n.cZ+n.cK)?(S.setProjection({name:"globe"}),S.zoom=gt,this._cameraForBounds(S,o,c,f,_,x)):{center:Ge,zoom:gt,bearing:f,pitch:_}}fitBounds(t,o,c){let f=this.cameraForBounds(t,o);return this._fitInternal(f,o,c)}fitScreenCoordinates(t,o,c,f,_){let x=n.P.convert(t),S=n.P.convert(o),E=new n.P(Math.min(x.x,S.x),Math.min(x.y,S.y)),P=new n.P(Math.max(x.x,S.x),Math.max(x.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,S))return this;let M=this.transform.pointLocation3D(E),F=this.transform.pointLocation3D(P),O=this.transform.pointLocation3D(new n.P(E.x,P.y)),N=this.transform.pointLocation3D(new n.P(P.x,E.y)),q=[Math.min(M.lng,F.lng,O.lng,N.lng),Math.min(M.lat,F.lat,O.lat,N.lat)],G=[Math.max(M.lng,F.lng,O.lng,N.lng),Math.max(M.lat,F.lat,O.lat,N.lat)],K=f&&f.pitch?f.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,q,G,c,K,f);return this._fitInternal($,f,_)}_fitInternal(t,o,c){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,c):this.flyTo(o,c):this}jumpTo(t,o){this.stop();let c=t.preloadOnly?this.transform.clone():this.transform,f=!1,_=!1,x=!1;"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=n.aS.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(_=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch);let S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(S))if(t.retainPadding===!1){let E=c.clone();E.padding=S,c.setLocationAtPoint(c.center,E.centerPoint)}else c.padding=S;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new n.z("movestart",o)).fire(new n.z("move",o)),f&&this.fire(new n.z("zoomstart",o)).fire(new n.z("zoom",o)).fire(new n.z("zoomend",o)),_&&this.fire(new n.z("rotatestart",o)).fire(new n.z("rotate",o)).fire(new n.z("rotateend",o)),x&&this.fire(new n.z("pitchstart",o)).fire(new n.z("pitch",o)).fire(new n.z("pitchend",o)),this.fire(new n.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(An),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){let c=this.transform;if(!c.projection.supportsFreeCamera)return n.w(An),this;this.stop();let f=c.zoom,_=c.pitch,x=c.bearing;c.setFreeCameraOptions(t);let S=f!==c.zoom,E=_!==c.pitch,P=x!==c.bearing;return this.fire(new n.z("movestart",o)).fire(new n.z("move",o)),S&&this.fire(new n.z("zoomstart",o)).fire(new n.z("zoom",o)).fire(new n.z("zoomend",o)),P&&this.fire(new n.z("rotatestart",o)).fire(new n.z("rotate",o)).fire(new n.z("rotateend",o)),E&&this.fire(new n.z("pitchstart",o)).fire(new n.z("pitch",o)).fire(new n.z("pitchend",o)),this.fire(new n.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:n.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let c=this.transform,f=this.getZoom(),_=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?+t.zoom:f,P="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),O=n.P.convert(t.offset),N,q,G;if(c.projection.name==="globe"){let ve=n.ae.fromLngLat(c.center),ze=O.rotate(-c.angle);ve.x+=ze.x/c.worldSize,ve.y+=ze.y/c.worldSize;let Ie=ve.toLngLat(),Ge=n.aS.convert(t.center||Ie);this._normalizeCenter(Ge),N=c.centerPoint.add(ze),q=new n.P(ve.x,ve.y).mult(c.worldSize),G=new n.P(n.aF(Ge.lng),n.aJ(Ge.lat)).mult(c.worldSize).sub(q)}else{N=c.centerPoint.add(O);let ve=c.pointLocation(N),ze=n.aS.convert(t.center||ve);this._normalizeCenter(ze),q=c.project(ve),G=c.project(ze).sub(q)}let K=c.zoomScale(E-f),$,ee;t.around&&($=n.aS.convert(t.around),ee=c.locationPoint($));let se=this._zooming||E!==f,ie=this._rotating||_!==P,ge=this._pitching||M!==x,ae=!c.isPaddingEqual(F),ye=t.retainPadding===!1?c.clone():c,pe=ve=>ze=>{if(se&&(ve.zoom=n.ak(f,E,ze)),ie&&(ve.bearing=n.ak(_,P,ze)),ge&&(ve.pitch=n.ak(x,M,ze)),ae&&(ye.interpolatePadding(S,F,ze),N=ye.centerPoint.add(O)),$)ve.setLocationAtPoint($,ee);else{let Ie=ve.zoomScale(ve.zoom-f),Ge=E>f?Math.min(2,K):Math.max(.5,K),Be=Math.pow(Ge,1-ze),Ye=ve.unproject(q.add(G.mult(ze*Be)).mult(Ie));ve.setLocationAtPoint(ve.renderWorldCopies?Ye.wrap():Ye,N)}return t.preloadOnly||this._fireMoveEvents(o),ve};if(t.preloadOnly){let ve=this._emulate(pe,t.duration,c);return this._preloadTiles(ve),this}let ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=ie,this._pitching=ge,this._padding=ae,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,ue),this._ease(pe(c),(ve=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(o,ve)}),t),this}_prepareEase(t,o,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||c.moving||this.fire(new n.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let c=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new n.z("zoomend",t)),f&&this.fire(new n.z("rotateend",t)),_&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){let Ne=n.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ne,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:n.eU},t);let c=this.transform,f=this.getZoom(),_=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?n.aA(+t.zoom,c.minZoom,c.maxZoom):f,P="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),O=c.zoomScale(E-f),N=n.P.convert(t.offset),q=c.centerPoint.add(N),G=c.pointLocation(q),K=n.aS.convert(t.center||G);this._normalizeCenter(K);let $=c.project(G),ee=c.project(K).sub($),se=t.curve,ie=Math.max(c.width,c.height),ge=ie/O,ae=ee.mag();if("minZoom"in t){let Ne=n.aA(Math.min(t.minZoom,f,E),c.minZoom,c.maxZoom),nt=ie/c.zoomScale(Ne-f);se=Math.sqrt(nt/ae*2)}let ye=se*se;function pe(Ne){let nt=(ge*ge-ie*ie+(Ne?-1:1)*ye*ye*ae*ae)/(2*(Ne?ge:ie)*ye*ae);return Math.log(Math.sqrt(nt*nt+1)-nt)}function ue(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function ve(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}let ze=pe(0),Ie=function(Ne){return ve(ze)/ve(ze+se*Ne)},Ge=function(Ne){return ie*((ve(ze)*(ue(nt=ze+se*Ne)/ve(nt))-ue(ze))/ye)/ae;var nt},Be=(pe(1)-ze)/se;if(Math.abs(ae)<1e-6||!isFinite(Be)){if(Math.abs(ie-ge)<1e-6)return this.easeTo(t,o);let Ne=ge<ie?-1:1;Be=Math.abs(Math.log(ge/ie))/se,Ge=function(){return 0},Ie=function(nt){return Math.exp(Ne*se*nt)}}t.duration="duration"in t?+t.duration:1e3*Be/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let Ye=_!==P,gt=M!==x,De=!c.isPaddingEqual(F),Ee=t.retainPadding===!1?c.clone():c,Ke=Ne=>nt=>{let xt=nt*Be,Dt=1/Ie(xt);Ne.zoom=nt===1?E:f+Ne.scaleZoom(Dt),Ye&&(Ne.bearing=n.ak(_,P,nt)),gt&&(Ne.pitch=n.ak(x,M,nt)),De&&(Ee.interpolatePadding(S,F,nt),q=Ee.centerPoint.add(N));let ft=nt===1?K:Ne.unproject($.add(ee.mult(Ge(xt))).mult(Dt));return Ne.setLocationAtPoint(Ne.renderWorldCopies?ft.wrap():ft,q),Ne._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Ne};if(t.preloadOnly){let Ne=this._emulate(Ke,t.duration,c);return this._preloadTiles(Ne),this}return this._zooming=!0,this._rotating=Ye,this._pitching=gt,this._padding=De,this._prepareEase(o,!1),this._ease(Ke(c),(()=>this._afterEase(o)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,o)}if(!t){let c=this.handlers;c&&c.stop(!1)}return this}_ease(t,o,c){c.animate===!1||c.duration===0?(t(1),o()):(this._easeStart=n.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((n.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=n.bS(t,-180,180);let c=Math.abs(t-o);return Math.abs(t-360-o)<c&&(t-=360),Math.abs(t+360-o)<c&&(t+=360),t}_normalizeCenter(t){let o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;let c=t.lng-o.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,c){let f=Math.ceil(15*o/1e3),_=[],x=t(c.clone());for(let S=0;S<=f;S++){let E=x(S/f);_.push(E.clone())}return _}_preloadTiles(t,o){}}class Su{constructor(t={}){this.options=t,n.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let o=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);let f=Se("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",c),this._innerContainer=Se("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){let c=o.reduce(((f,_,x)=>(_.value&&(f+=`${_.key}=${_.value}${x<o.length-1?"&":""}`),f)),"?");t.href=`${n.e.FEEDBACK_URL}/${c}#${bh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}let o=this._map.style._mergedSourceCaches;for(let f in o){let _=o[f];if(_.used){let x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort(((f,_)=>f.length-_.length)),t=t.filter(((f,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(f)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vd{constructor(){n.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Se("div","mapboxgl-ctrl");let o=Se("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let o in t){let c=t[o].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Sf{constructor(){n.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(o=>this._onIndoorUpdate(o))),this._container}_createButton(t,o){let c=Se("button",t,this._container);return c.type="button",c.addEventListener("click",o),c}_createSeparator(){return Se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");let o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",o&&Array.from(this._container.children).forEach((c=>c.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){let t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{let o=this._map;this._model&&o&&o._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));Se("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){let t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,o){for(let c=0;c<t.length;c++){let f=t[c],_=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(f.id)}));this._setButtonTitle(_,f.zIndex.toString()),this._model&&f.id===this._model.selectedFloorId&&o&&_.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(_),c<t.length-1&&this._createSeparator()}}}class Eg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){let o=this._currentlyRunning,c=o?this._queue.concat(o):this._queue;for(let f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){let o=this._currentlyRunning=this._queue;this._queue=[];for(let c of o)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class xd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let o=n.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,c){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+c}}let hv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ag extends n.z{constructor(t,o,c,f){let{point:_,lngLat:x,originalEvent:S,target:E}=t;super(t.type,{point:_,lngLat:x,originalEvent:S,target:E}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=c,this.feature=f}}class Tf{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let c=o.filter,f=o.type;c&&this.filters.set(t,n.b5(c)),f==="mouseover"&&(f="mouseenter"),f==="mouseout"&&(f="mouseleave");let _=this.interactionsByType.get(f)||new Map;f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):_.size===0&&this.map.on(f,this.handleType),_.size===0&&this.interactionsByType.set(f,_),_.set(t,o),this.typeById.set(t,f)}get(t){let o=this.typeById.get(t);if(!o)return;let c=this.interactionsByType.get(o);return c?c.get(t):void 0}remove(t){let o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);let c=this.interactionsByType.get(o);c&&(c.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){let c=[];for(let[f,_]of o)_.target&&c.push({targetId:f,target:_.target,filter:this.filters.get(f)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));let c=new Map;for(let[f,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(f)||c.set(_.id,_);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){let o=Array.from(this.hoveredFeatures.values()).map((({feature:c})=>c));o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){let c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void n.w("mouseenter interaction required for mouseleave to work.");let f=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!o;o=o||this.queryTargets(t.point,f);let x=!1,S=new Set;for(let E of o){for(let[P,M]of f){if(!M.target)continue;let F=E.variants?E.variants[P]:null;if(F){for(let O of F){if(Un(O,E,S,P))continue;let N=new n.dw(E,O),q=Mo(O,E,P);_&&N.id!==void 0&&(N.state=this.map.getFeatureState(N));let G=c?this.prevHoveredFeatures.get(q):null,K=new Ag(t,P,M,N),$=G?G.stop:M.handler(K);if(c&&this.hoveredFeatures.set(q,{feature:E,stop:$}),$!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[E,P]of f){let{handler:M,target:F}=P;if(!F&&M(new Ag(t,E,P,null))!==!1)break}}}function Cf(l,t){if(Array.isArray(l)&&Array.isArray(t)){let o=new Set(l),c=new Set(t);return o.size===c.size&&l.every((f=>c.has(f)))}return n.bx(l,t)}let Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class bd{constructor(t,o,c=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Ch({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new vf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),St()}move(t,o){let c=this.map,f=this.mouseRotate.mousemoveWindow(t,o),_=f&&f.bearingDelta;if(_&&c.setBearing(c.getBearing()+_),this.mousePitch){let x=this.mousePitch.mousemoveWindow(t,o),S=x&&x.pitchDelta;S&&c.setPitch(c.getPitch()+S)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ai(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),lr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,lr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=bt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=bt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pl(l,t,o){if(l=new n.aS(l.lng,l.lat),t){let c=new n.aS(l.lng-360,l.lat),f=new n.aS(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-o.center.lng)/360),x=o.locationPoint3D(l).distSqr(t),S=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(c).distSqr(t)<x&&(S||Math.abs(c.lng-o.center.lng)<_)?l=c:o.locationPoint3D(f).distSqr(t)<x&&(S||Math.abs(f.lng-o.center.lng)<_)&&(l=f)}for(;Math.abs(l.lng-o.center.lng)>180;){let c=o.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;l.lng>o.center.lng?l.lng-=360:l.lng+=360}return l}let _a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},bo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class fl extends n.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),n.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:c="center",color:f="#3FB1CE",scale:_=1,draggable:x=!1,clickTolerance:S=0,rotation:E=bo.rotation,rotationAlignment:P=bo.rotationAlignment,pitchAlignment:M=bo.pitchAlignment,occludedOpacity:F=bo.occludedOpacity,altitude:O=bo.altitude}=t||{};this._anchor=c,this._color=f,this._scale=_,this._draggable=x,this._clickTolerance=S,this._rotation=E,this._rotationAlignment=P,this._pitchAlignment=M,this._occludedOpacity=F,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(G=>{G.preventDefault()})),this._element.addEventListener("mousedown",(G=>{G.preventDefault()}));let N=this._element.classList;for(let G in _a)N.remove(`mapboxgl-marker-anchor-${G}`);N.add(`mapboxgl-marker-anchor-${this._anchor}`);let q=t&&t.className?t.className.trim().split(/\s+/):[];N.add(...q),this._popup=null}_createDefaultMarker(){let t=Se("div"),o=Re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){let c=Re("radialGradient",{id:"shadowGradient"},Re("defs",{},o));Re("stop",{offset:"10%","stop-opacity":.4},c),Re("stop",{offset:"100%","stop-opacity":.05},c),Re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||bo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let o=t.code,c=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){let o=t.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,o=this._pos;if(!t||!o)return!1;let c=t.unproject(o,this._altitude),f=t.getFreeCameraOptions();if(!f.position)return!1;let _=f.position.toLngLat();return _.distanceTo(c)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();let c=t.unproject(o,this._altitude),f;t._showingGlobe()&&n.f4(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${_a[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){let t=this._pos,o=this._map,c=this.getPitchAlignment();if(!o||!t||c!=="map")return"";if(!o._showingGlobe()){let E=o.getPitch();return E?`rotateX(${E}deg)`:""}let f=n.cW(n.f5(o.transform,this._lngLat)),_=t.sub(n.f6(o.transform)),x=Math.abs(_.x)+Math.abs(_.y);if(x===0)return"";let S=f/x;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){let t=this._pos,o=this._map;if(!o||!t)return"";let c=0,f=this.getRotationAlignment();if(f==="map")if(o._showingGlobe()){let _=o.project(new n.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=o.project(new n.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);c=n.cW(Math.atan2(x.y,x.x))-90}else c=-o.getBearing();else if(f==="horizon"){let _=n.ah(4,6,o.getZoom()),x=n.f6(o.transform);x.y+=_*o.transform.height;let S=t.sub(x),E=n.cW(Math.atan2(S.y,S.x));c=(E>90?E-270:E+90)*(1-_)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=pl(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),o._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let o=this._map;if(!o)return;let c=this._pointerdownPos,f=this._positionDelta;if(c&&f){if(!this._isDragging){let _=this._clickTolerance||o._clickTolerance;if(t.point.dist(c)<_)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){let o=this._map,c=this._pos;o&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||bo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||bo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||bo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||bo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pv={maxWidth:100,unit:"metric"},fv={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},mv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},gv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ef(l=new n.P(0,0),t="bottom"){if(typeof l=="number"){let o=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new n.P(0,l);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-l);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(l,0);case"right":return new n.P(-l,0)}return new n.P(0,0)}return l instanceof n.P||Array.isArray(l)?n.P.convert(l):n.P.convert(l[t]||[0,0])}return{version:R,supported:oe.supported,setRTLTextPlugin:n.fa,getRTLTextPluginStatus:n.f9,Map:class extends Va{constructor(l){Y.mark(j.create);let t=l;if((l=Object.assign({},Ph,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&n.f2(window)&&(l.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new fa(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Eg,this._domRenderTaskQueue=new Eg,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.b1(),this._locale=Object.assign({},hv,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Di(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){let o=document.getElementById(l.container);if(!o)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=o}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,n.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ov),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ih(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||n.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new xh(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});let o=l.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new Su({customAttribution:l.customAttribution})),this._logoControl=new vd,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new n.z(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new n.z(`${o.dataType}dataloading`,o))})),this._interactions=new Tf(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=l.onAdd(this);this._controls.push(l);let c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(o,c.firstChild):c.appendChild(o),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new n.z("movestart",l)).fire(new n.z("move",l)),this.fire(new n.z("resize",l)),t&&this.fire(new n.z("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(n.aI.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map((t=>t==="auto"?navigator.language:t)):l}setLanguage(l){let t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let l=this.transform,t=l.projection.name,o;t==="globe"&&l.zoom>=n.cK?(l.setMercatorFromTransition(),o=!0):t==="mercator"&&l.zoom<n.cK&&(l.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t,o=this.transform.mercatorFromTransition;t=l.name==="globe"&&this.transform.zoom>=n.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate();let c=this.transform.getProjection().name==="mercator"&&o!==this.transform.mercatorFromTransition;return(t||c)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(n.aS.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(n.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,o){let c=f=>{let _=[];if(Array.isArray(t)){let x=t.filter((S=>this.getLayer(S)));_=x.length?this.queryRenderedFeatures(f,{layers:x}):[]}else _=this.queryRenderedFeatures(f,{target:t});return _};if(l==="mouseenter"||l==="mouseover"){let f=!1;return{listener:o,targets:t,delegates:{mousemove:x=>{let S=c(x.point);S.length?f||(f=!0,o.call(this,new Yr(l,this,x.originalEvent,{features:S}))):f=!1},mouseout:()=>{f=!1}}}}if(l==="mouseleave"||l==="mouseout"){let f=!1;return{listener:o,targets:t,delegates:{mousemove:S=>{c(S.point).length?f=!0:f&&(f=!1,o.call(this,new Yr(l,this,S.originalEvent)))},mouseout:S=>{f&&(f=!1,o.call(this,new Yr(l,this,S.originalEvent)))}}}}{let f=_=>{let x=c(_.point);x.length&&(_.features=x,o.call(this,_),delete _.features)};return{listener:o,targets:t,delegates:{[l]:f}}}}on(l,t,o){if(typeof t=="function"||o===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let c=this._createDelegatedListener(l,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(let f in c.delegates)this.on(f,c.delegates[f]);return this}once(l,t,o){if(typeof t=="function"||o===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let c=this._createDelegatedListener(l,t,o);for(let f in c.delegates)this.once(f,c.delegates[f]);return this}off(l,t,o){if(typeof t=="function"||o===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(f=>{for(let _=0;_<f.length;_++){let x=f[_];if(x.listener===o&&Cf(x.targets,t)){for(let S in x.delegates)this.off(S,x.delegates[S]);return f.splice(_,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof n.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){let _=this.style.queryRenderedFeatures(l,void 0,this.transform),x=this.style.queryRenderedFeatureset(l,void 0,this.transform);return _.concat(x)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(let _ of t.layers)if(!this._isValidId(_)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let f=[];return c&&(f=f.concat(this.style.queryRenderedFeatures(l,t,this.transform))),o&&(f=f.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),f}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}queryRasterValue(l,t,o){return this._isValidId(l)?this.style.queryRasterValue(l,t,o):Promise.resolve(null)}isPointOnSurface(l){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,((o,c)=>{if(o){let f=typeof o=="string"?o:o instanceof Error?o.message:o.error;n.w(`Unable to perform style diff: ${f}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){let t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){let o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new Zo(this,o).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.dq(l)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(let t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,o)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:o=1,sdf:c=!1,stretchX:f,stretchY:_,content:x}={}){this._lazyInitEmptyStyle();let S=n.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:E,height:P,data:M}=n.o.getImageData(t);this.style.addImage(S,{data:new n.q({width:E,height:P},M),pixelRatio:o,stretchX:f,stretchY:_,content:x,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:P}=t,M=t;this.style.addImage(S,{data:new n.q({width:E,height:P},new Uint8Array(M.data)),pixelRatio:o,stretchX:f,stretchY:_,content:x,sdf:c,usvg:!1,version:0,userImage:M}),M.onAdd&&M.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();let o=n.I.from(l),c=this.style.getImage(o);if(!c)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.o.getImageData(t):t,{width:_,height:x,data:S}=f;if(_===void 0||x===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||x!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));let E=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap),P=!1;c.usvg?(c.data=new n.q({width:_,height:x},new Uint8Array(S)),c.usvg=!1,c.icon=void 0,P=!0):c.data.replace(S,E),this.style.updateImage(o,c,P)}hasImage(l){return l?!!this.style&&!!this.style.getImage(n.I.from(l)):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(n.I.from(l))}loadImage(l,t){n.n(this._requestManager.transformRequest(l,n.R.Image),((o,c)=>{t(o,c instanceof HTMLImageElement?n.o.getImageData(c):c)}))}listImages(){return this.style.listImages().map((l=>l.name))}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){let t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch((o=>this.fire(new n.y(new Error("Failed to add import",o))))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;let t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,o){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,o),this._update(!0)):this}setFilter(l,t,o={}){return this._isValidId(l)?(this.style.setFilter(l,t,o),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,o,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,o,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,o,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,o,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}setLayerProperty(l,t,o,c={}){return this._isValidId(l)?(this.style.setLayerProperty(l,t,o,c),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,o){return this.style.setConfigProperty(l,t,o),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){let t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aS.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_selectIndoorFloor(l){this.indoor.selectFloor(l)}_setIndoorActiveFloorsVisibility(l){this.indoor.setActiveFloorsVisibility(l)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Sf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;let l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,o,c,f,_=this._container;for(;_&&(!c||!f);){let x=window.getComputedStyle(_).transform;x&&x!=="none"&&(o=x.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(c=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(f=o[3])),_=_.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new il(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){let l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Se("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Se("div","mapboxgl-canvas-container",l);this._canvas=Se("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let o=this._controlContainer=Se("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((f=>{c[f]=Se("div",`mapboxgl-ctrl-${f}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){let o=n.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(l),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){let t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){let t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let l=Object.assign({},oe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Ta(t,!0),this.painter=new Yl(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),n.k.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new n.z("renderstart")),++this._frameId;let o=this.painter.context.extTimerQuery,c=n.o.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();let _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,M=this.transform.pitch,F=n.o.now(),O=new n.ac(P,{now:F,fadeDuration:_,pitch:M,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(c);let S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Y.mark(j.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let P=n.o.now()-c;f.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{let M=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:P,gpuTime:M}))}),50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout((()=>{let M=this.painter.queryGpuTimers(P);this.fire(new n.z("gpu-timing-layer",{layerTimes:M}))}),50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{let M=this.painter.queryGpuTimeDeferredRender(P);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:M}))}),50)}let E=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(E||this._repaint)this.triggerRepaint();else{let P=this.idle();if(P&&(x=this._updateAverageElevation(c,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let M=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,Y.mark(j.fullLoad),this._performanceMetricsCollection&&_n(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(let t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){let o=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);let c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){let f=this.transform.averageElevation,_=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=l;let x=Math.abs(f-_);if(x>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(_),o(_);this._averageElevation.easeTo(_,l,300)}else if(x>1e-4)return this._averageElevation.jumpTo(_),o(_)}return!!this._averageElevation.isEasing(l)&&o(this._averageElevation.getValue(l))}_authenticate(){Vs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(l=>{if(l&&(l.message===hi||l.status===401)){let t=this.painter.context.gl;Ta(t,!1),this._logoControl instanceof vd&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Pr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&oo(this._requestManager._customAccessToken)}_updateTerrain(){let l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){let l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let o=this.painter.context.gl,c=o.createFramebuffer();function f(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);let x=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,x),x}return o.bindFramebuffer(o.FRAMEBUFFER,c),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,o){let c=o[1]-o[0],f=l.length/4;for(let _=0;_<t.length;_++){let x=t[_],S=0;for(let E=0;E<x.length;E+=4)x[E]===l[E]&&x[E+1]===l[E+1]&&x[E+2]===l[E+2]&&x[E+3]===l[E+3]&&(S+=1);c+=(o[_+2]-o[_+1])*(1-S/f)}return c}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Wr.delete(this.painter.context.gl),Mn.remove(),er.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=n.o.frame((t=>{let o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)})))}_preloadTiles(l){let t=this.style?this.style.getSourceCaches():[];return n.bv(t,((o,c)=>o._preloadTiles(l,c)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){n.f3(l,t)}get version(){return R}},NavigationControl:class{constructor(l={}){this.options=Object.assign({},Lh,l),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(n.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),Se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),Se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{let o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))})),this._compassIcon=Se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let l=this._map;if(!l)return;let t=l.getZoom(),o=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){let l=this._map;if(!l)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bd(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){let l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){let o=Se("button",l,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(l,t){if(!this._map)return;let o=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",o),l.firstElementChild&&l.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(l={}){super();let t=navigator.geolocation;this.options=Object.assign({geolocation:t},ya,l),n.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){let t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,l(o)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((o=>t(o.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(l){let t=this._map.getMaxBounds(),o=l.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",Object.assign({coords:l.coords,timestamp:l.timestamp},l.toJSON?{toJSON:l.toJSON.bind(l)}:{}))),this._finish()}}_updateCamera(l){let t=new n.aS(l.coords.longitude,l.coords.latitude),o=l.coords.accuracy,c=this._map.getBearing(),f=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),f,{geolocateSource:!0})}_updateMarker(l){if(l){let t=new n.aS(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let l=this._map.transform,t=n.ce(1,l._center.lat)*l.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Se("button","mapboxgl-ctrl-geolocate",this._container),Se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se("div","mapboxgl-user-location"),this._dotElement.appendChild(Se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))}))}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&l()})).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Su,ScaleControl:class{constructor(l={}){this.options=Object.assign({},pv,l),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),n.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let l=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,c=t._containerWidth/2-l/2,f=t.unproject([c,o]),_=t.unproject([c+l,o]),x=f.distanceTo(_);if(this.options.unit==="imperial"){let S=3.2808*x;S>5280?this._setScale(l,S/5280,"mile"):this._setScale(l,S,"foot")}else this.options.unit==="nautical"?this._setScale(l,x/1852,"nautical-mile"):x>=1e3?this._setScale(l,x/1e3,"kilometer"):this._setScale(l,x,"meter")}_setScale(l,t,o){this._map._requestDomTask((()=>{let c=(function(_){let x=Math.pow(10,`${Math.floor(_)}`.length-1),S=_/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(E){let P=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*P)/P})(S),x*S})(t),f=c/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(c):`${c}&nbsp;${fv[o]}`,this._container.style.width=l*f+"px"}))}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:n.w("Full screen control 'container' must be a DOM element.")),n.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let l=this._fullscreenButton=Se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Se("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Sf,Popup:class extends n.E{constructor(l){super(),this.options=Object.assign(Object.create(mv),l),this._altitude=this.options.altitude,n.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=n.aS.convert(l),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){let t=document.createDocumentFragment(),o=document.createElement("body"),c;for(o.innerHTML=l;c=o.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Se("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){let o=this._closeButton=Se("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;let t=this._map,o=this._container,c=this._pos;if(!t||!o||!c)return"bottom";let f=o.offsetWidth,_=o.offsetHeight,x=c.x<f/2,S=c.x>t.transform.width-f/2;if(c.y+l<_)return x?"top-left":S?"top-right":"top";if(c.y>t.transform.height-_){if(x)return"bottom-left";if(S)return"bottom-right"}return x?"left":S?"right":"bottom"}_updateClassList(){let l=this._container;if(!l)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){let t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let c=this._container;if(c||(c=this._container=Se("div","mapboxgl-popup",t.getContainer()),this._tip=Se("div","mapboxgl-popup-tip",c),c.appendChild(o)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pl(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){let f=this._pos=this._trackPointer&&l instanceof n.P?l:t.project(this._lngLat,this._altitude),_=Ef(this.options.offset),x=this._anchor=this._getAnchor(_.y),S=Ef(this.options.offset,x),E=f.add(S).round();t._requestDomTask((()=>{this._container&&x&&(this._container.style.transform=`${_a[x]} translate(${E.x}px,${E.y}px)`)}))}if(!this._marker&&t._showingGlobe()){let f=n.f4(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let l=this._container.querySelector(gv);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:fl,Style:Zo,LngLat:n.aS,LngLatBounds:n.aI,Point:n.P,MercatorCoordinate:n.ae,FreeCameraOptions:Qn,Evented:n.E,config:n.e,prewarm:n.f8,clearPrewarmedResources:n.f7,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(l){n.e.ACCESS_TOKEN=l},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(l){n.e.API_URL=l},get workerCount(){return n.fh.workerCount},set workerCount(l){n.fh.workerCount=l},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){n.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){n.fg(l)},get workerUrl(){return n.ff.workerUrl},set workerUrl(l){n.ff.workerUrl=l},get workerClass(){return n.ff.workerClass},set workerClass(l){n.ff.workerClass=l},get workerParams(){return n.ff.workerParams},set workerParams(l){n.ff.workerParams=l},get dracoUrl(){return n.fe()},set dracoUrl(l){n.fd(l)},get meshoptUrl(){return n.fc()},set meshoptUrl(l){n.fb(l)},setNow:n.o.setNow,restoreNow:n.o.restoreNow}}));var T=v;return T}))});var CO=ot((f1,TO)=>{(function(d,h){typeof define=="function"&&define.amd?define(["leaflet","mapbox-gl"],h):typeof f1=="object"?TO.exports=h(c1(),SO()):d.returnExports=h(window.L,window.mapboxgl)})(f1,function(d,h){d.MapboxGL=d.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(v){d.setOptions(this,v),v.accessToken&&(h.accessToken=v.accessToken),this._throttledUpdate=d.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(v){this._container||this._initContainer();var y=this.getPaneName();v.getPane(y).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),v.options.zoomAnimation&&d.DomEvent.on(v._proxy,d.DomUtil.TRANSITION_END,this._transitionEnd,this),v._addZoomLimit(this)},onRemove:function(v){this._map._proxy&&this._map.options.zoomAnimation&&d.DomEvent.off(this._map._proxy,d.DomUtil.TRANSITION_END,this._transitionEnd,this);var y=this.getPaneName();v.getPane(y).removeChild(this._container)},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMapboxMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){var v=this.getSize().multiplyBy(.5),y=this._map.latLngToContainerPoint(this._map.getCenter());return d.latLngBounds(this._map.containerPointToLatLng(y.subtract(v)),this._map.containerPointToLatLng(y.add(v)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_initContainer:function(){var v=this._container=d.DomUtil.create("div","leaflet-gl-layer"),y=this.getSize(),T=this._map.getSize().multiplyBy(this.options.padding);v.style.width=y.x+"px",v.style.height=y.y+"px";var n=this._map.containerPointToLayerPoint([0,0]).subtract(T);d.DomUtil.setPosition(v,n)},_initGL:function(){var v=this._map.getCenter(),y=d.extend({},this.options,{container:this._container,center:[v.lng,v.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap?(this._glMap.setCenter(y.center),this._glMap.setZoom(y.zoom)):this._glMap=new h.Map(y),this._glMap.transform.latRange=null,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var T=this._glMap._actualCanvas;d.DomUtil.addClass(T,"leaflet-image-layer"),d.DomUtil.addClass(T,"leaflet-zoom-animated"),this.options.interactive&&d.DomUtil.addClass(T,"leaflet-interactive"),this.options.className&&d.DomUtil.addClass(T,this.options.className)},_update:function(v){if(this._map&&(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming)){var y=this.getSize(),T=this._container,n=this._glMap,R=this._map.getSize().multiplyBy(this.options.padding),j=this._map.containerPointToLayerPoint([0,0]).subtract(R);d.DomUtil.setPosition(T,j),this._transformGL(n);var Y=Math.round(y.x),re=Math.round(y.y);Math.round(n.transform.width)!==Y||Math.round(n.transform.height)!==re?(T.style.width=Y+"px",T.style.height=re+"px",n._resize!==null&&n._resize!==void 0?n._resize():n.resize()):n._update!==null&&n._update!==void 0?n._update():n.update()}},_transformGL:function(v){var y=this._map.getCenter(),T=v.transform;T.center=h.LngLat.convert([y.lng,y.lat]),T.zoom=this._map.getZoom()-1},_pinchZoom:function(v){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(v){var y=this._map.getZoomScale(v.zoom),T=this._map.getSize().multiplyBy(this.options.padding*y),n=this.getSize()._divideBy(2),R=this._map.project(v.center,v.zoom)._subtract(n)._add(this._map._getMapPanePos().add(T))._round(),j=this._map.project(this._map.getBounds().getNorthWest(),v.zoom)._subtract(R);d.DomUtil.setTransform(this._glMap._actualCanvas,j.subtract(this._offset),y)},_zoomStart:function(v){this._zooming=!0},_zoomEnd:function(){var v=this._map.getZoomScale(this._map.getZoom());d.DomUtil.setTransform(this._glMap._actualCanvas,null,v),this._zooming=!1,this._update()},_transitionEnd:function(v){d.Util.requestAnimFrame(function(){var y=this._map.getZoom(),T=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());d.DomUtil.setTransform(this._glMap._actualCanvas,n,1),this._glMap.once("moveend",d.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:T,zoom:y-1})},this)},_resize:function(v){this._transitionEnd(v)}}),d.mapboxGL=function(v){return new d.MapboxGL(v)}})});function T_(d){if(!d)return;let h;if(typeof d.getBoundingClientRect<"u")h=d.getBoundingClientRect();else{let v=document.createRange();v.selectNode(d),h=v.getBoundingClientRect()}return h}function m2(d){if(!d)return;let h;if(typeof d.getClientRects<"u")h=d.getClientRects();else{let v=document.createRange();v.selectNode(d),h=v.getClientRects()}return h}function Ns(){var d=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var v=(d+Math.random()*16)%16|0;return d=Math.floor(d/16),(h==="x"?v:v&3|8).toString(16)})}function C_(d,h){for(var v=0;v<h.length;v++)if(d.hasAttribute(h[v]))return d.getAttribute(h[v])}function E_(d){if(arguments.length==0)throw new TypeError("`CSS.escape` requires an argument.");for(var h=String(d),v=h.length,y=-1,T,n="",R=h.charCodeAt(0);++y<v;){if(T=h.charCodeAt(y),T==0){n+="\uFFFD";continue}if(T>=1&&T<=31||T==127||y==0&&T>=48&&T<=57||y==1&&T>=48&&T<=57&&R==45){n+="\\"+T.toString(16)+" ";continue}if(y==0&&v==1&&T==45){n+="\\"+h.charAt(y);continue}if(T==46&&h.charAt(0)=="#"){n+="\\.";continue}if(T>=128||T==45||T==95||T==35||T==46||T>=48&&T<=57||T>=65&&T<=90||T>=97&&T<=122){n+=h.charAt(y);continue}n+="\\"+h.charAt(y)}return n}function A_(){this.resolve=null,this.reject=null,this.id=Ns(),this.promise=new Promise((d,h)=>{this.resolve=d,this.reject=h}),Object.freeze(this)}var g2=typeof window<"u"&&("requestIdleCallback"in window?window.requestIdleCallback:window.requestAnimationFrame);function Oi(d){return d.value+(d.unit||"")}function Vo(d){return d&&d.nodeType===1}function jc(d){return d&&d.nodeType===3}function*fm(d,h){let v=d;for(;v;)if(yield v,v.childNodes.length)v=v.firstChild;else if(v.nextSibling){if(h&&v===h){v=void 0;break}v=v.nextSibling}else for(;v;){if(v=v.parentNode,h&&v===h){v=void 0;break}if(v&&v.nextSibling){v=v.nextSibling;break}}}function Ru(d,h){if(h&&d===h)return;let v=I_(d);if(v)return v;if(d.parentNode)for(;d=d.parentNode;){if(h&&d===h)return;if(v=I_(d),v)return v}}function pm(d,h){if(h&&d===h)return;let v=k_(d);if(v)return v;if(d.parentNode)for(;d=d.parentNode;){if(h&&d===h)return;if(v=k_(d),v)return v}}function _2(d,h){let v=Ru(d,h);for(;v&&v.nodeType!==1;)v=Ru(v,h);return v}function y2(d,h){let v=pm(d,h);for(;v&&v.nodeType!==1;)v=pm(v,h);return v}function Dx(d,h){let v=_2(d,h);for(;v&&v.dataset.undisplayed;)v=_2(v,h);return v}function x2(d,h){let v=y2(d,h);for(;v&&v.dataset.undisplayed;)v=y2(v,h);return v}function P_(d){let h,v,y=[],T=[],n=document.createDocumentFragment();if(d.nodeName==="TR"){let Y=d.previousElementSibling,re=1;for(;Y;){if(Y.childElementCount>d.childElementCount){let me=Array.from(d.children);for(;d.firstChild;)d.firstChild.remove();let be=0;for(let oe=0;oe<Y.children.length;oe++){let Se=Y.children[oe];if(Se.rowSpan&&Se.rowSpan>re){let Re=Se.cloneNode(!0);Re.rowSpan=Se.rowSpan-re,d.appendChild(Re)}else{let Re=me[be++];Re&&d.appendChild(Re)}}}Y=Y.previousElementSibling,re++}}let R=d;for(;R.parentNode&&R.parentNode.nodeType===1;)y.unshift(R.parentNode),R=R.parentNode;for(var j=0;j<y.length;j++){if(v=y[j],h=v.cloneNode(!1),h.setAttribute("data-split-from",h.getAttribute("data-ref")),h.hasAttribute("id")){let Y=h.getAttribute("id");h.setAttribute("data-id",Y),h.removeAttribute("id")}if(h.hasAttribute("data-break-before")&&h.removeAttribute("data-break-before"),h.hasAttribute("data-previous-break-after")&&h.removeAttribute("data-previous-break-after"),T.length?T[T.length-1].appendChild(h):n.appendChild(h),T.push(h),h.nodeName==="TD"&&v.parentElement.contains(v)){let Y=v,re=h;for(;Y=Y.previousElementSibling;){let me=Y.cloneNode(!1);h.parentElement.insertBefore(me,re),re=me}}}return T=void 0,n}function L_(d){return typeof d<"u"&&typeof d.dataset<"u"&&typeof d.dataset.breakBefore<"u"&&(d.dataset.breakBefore==="always"||d.dataset.breakBefore==="page"||d.dataset.breakBefore==="left"||d.dataset.breakBefore==="right"||d.dataset.breakBefore==="recto"||d.dataset.breakBefore==="verso")}function b2(d){return typeof d<"u"&&typeof d.dataset<"u"&&typeof d.dataset.previousBreakAfter<"u"&&(d.dataset.previousBreakAfter==="always"||d.dataset.previousBreakAfter==="page"||d.dataset.previousBreakAfter==="left"||d.dataset.previousBreakAfter==="right"||d.dataset.previousBreakAfter==="recto"||d.dataset.previousBreakAfter==="verso")}function z_(d,h){if(typeof d>"u"||!h||gm(d)||d.dataset&&d.dataset.undisplayed)return!1;let v=h.dataset?h.dataset.page:void 0;if(typeof v>"u"){let T=v2(h);T&&(v=T.dataset.page)}let y=d.dataset?d.dataset.page:void 0;if(typeof y>"u"){let T=v2(d,h);T&&(y=T.dataset.page)}return y!==v}function*w2(d){let h=d.nodeValue,v=h.length,y=0,T,n,R=d.parentElement&&d.parentElement.nodeName==="PRE";for(;y<v;)T=h[y],/^[\S\u202F\u00A0]$/.test(T)||R?n||(n=document.createRange(),n.setStart(d,y)):n&&(n.setEnd(d,y),yield n,n=void 0),y+=1;n&&(n.setEnd(d,y),yield n)}function*S2(d){let h=d.startContainer,v=h.length,y=d.startOffset,T;for(;y<v;)T=document.createRange(),T.setStart(h,y),T.setEnd(h,y+1),yield T,y+=1}function M_(d){let h;if(typeof d.tagName>"u")return!0;if(d.style&&d.style.display==="none")return!1;switch(d.tagName){case"A":case"ABBR":case"ACRONYM":case"B":case"BDO":case"BIG":case"BR":case"BUTTON":case"CITE":case"CODE":case"DFN":case"EM":case"I":case"IMG":case"INPUT":case"KBD":case"LABEL":case"MAP":case"OBJECT":case"Q":case"SAMP":case"SCRIPT":case"SELECT":case"SMALL":case"SPAN":case"STRONG":case"SUB":case"SUP":case"TEXTAREA":case"TIME":case"TT":case"VAR":case"P":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"FIGCAPTION":case"BLOCKQUOTE":case"PRE":case"LI":case"TD":case"DT":case"DD":case"VIDEO":case"CANVAS":h=!1;break;default:h=!0}return h}function T2(d,h=!1){return d.cloneNode(h)}function Jo(d,h,v){let y=d.getAttribute("data-ref");return y3(y,h,v)}function y3(d,h,v){return!v&&h.indexOfRefs&&h.indexOfRefs[d]?h.indexOfRefs[d]:h.querySelector(`[data-ref='${d}']`)}function O_(d){return!!(jc(d)||Vo(d)&&d.dataset.ref)}function mm(d){for(;!O_(d)&&(d.previousSibling?d=d.previousSibling:d=d.parentNode,!!d););return d}function C2(d){let h=d.parentNode;return h?Array.prototype.indexOf.call(h.childNodes,d):0}function R_(d,h){return d.childNodes[h]}function E2(d){return Vo(d)?!0:!!(jc(d)&&d.textContent.trim().length)}function Bx(d,h){if(!jc(d))return-1;let v=d.textContent,y,T=-1;for(var n=0;n<h.childNodes.length;n++)if(y=h.childNodes[n],y.nodeType===3&&h.childNodes[n].textContent.includes(v)){T=n;break}return T}function gm(d){return d.nodeType===8||d.nodeType===3&&v3(d)}function v3(d){return!/[^\t\n\r ]/.test(d.textContent)}function k_(d){for(;d=d.previousSibling;)if(!gm(d))return d;return null}function v2(d,h){if(d&&d.dataset&&d.dataset.page)return d;if(d.parentNode)for(;d=d.parentNode;){if(h&&d===h)return;if(d.dataset&&d.dataset.page)return d}return null}function A2(d){for(;d=d.parentNode;)if(d&&d.dataset&&d.dataset.breakInside==="avoid")return d;return null}function D_(d,h,v){if(!(v&&d===v)&&d.parentNode)for(;d=d.parentNode;){if(v&&d===v)return;if(d.nodeName===h)return d}}function I_(d){for(;d=d.nextSibling;)if(!gm(d))return d;return null}function B_(d,h,v){let y=document.createTreeWalker(d||this.dom,v||NodeFilter.SHOW_ALL,h?{acceptNode:h}:null,!1),T,n;for(T=y.nextNode();T;)n=T,T=y.nextNode(),n.parentNode.removeChild(n)}var Fx=class{constructor(h,v){this.node=h,this.offset=v}equals(h){return!(!h||this.node&&h.node&&this.node!==h.node||this.offset&&h.offset&&this.offset!==h.offset)}toJSON(h){let v,y=0;return this.node?(Vo(this.node)&&this.node.dataset.ref?v=this.node.dataset.ref:h&&(v=this.node.parentElement.dataset.ref),this.node.parentElement&&(y=Array.from(this.node.parentElement.childNodes).indexOf(this.node)),JSON.stringify({node:v,index:y,offset:this.offset})):{}}},tp=Fx;var Nx=class{constructor(h,v){this.breakToken=h,this.error=v}},Du=class extends Error{constructor(h,v){super(h),this.items=v}},ip=Nx;var _C=Fn(Bu(),1);var Jx=class{constructor(h){this.context=h||this,this.hooks=[]}register(){for(var h=0;h<arguments.length;++h)if(typeof arguments[h]=="function")this.hooks.push(arguments[h]);else for(var v=0;v<arguments[h].length;++v)this.hooks.push(arguments[h][v])}trigger(){var h=arguments,v=this.context,y=[];return this.hooks.forEach(function(T){var n=T.apply(v,h);n&&typeof n.then=="function"?y.push(n):y.push(new Promise((R,j)=>{R(n)}))}),Promise.all(y)}triggerSync(){var h=arguments,v=this.context,y=[];return this.hooks.forEach(function(T){var n=T.apply(v,h);y.push(n)}),y}list(){return this.hooks}clear(){return this.hooks=[]}},Gi=Jx;var U3=1500,q_=class{constructor(h,v,y){this.element=h,this.bounds=this.element.getBoundingClientRect(),this.parentBounds=this.element.offsetParent.getBoundingClientRect();let T=parseFloat(window.getComputedStyle(this.element).columnGap);if(T){let n=this.bounds.left-this.parentBounds.left;this.gap=T-n}else this.gap=0;v?this.hooks=v:(this.hooks={},this.hooks.onPageLayout=new Gi,this.hooks.layout=new Gi,this.hooks.renderNode=new Gi,this.hooks.layoutNode=new Gi,this.hooks.beforeOverflow=new Gi,this.hooks.onOverflow=new Gi,this.hooks.afterOverflowRemoved=new Gi,this.hooks.onBreakToken=new Gi,this.hooks.beforeRenderResult=new Gi),this.settings=y||{},this.maxChars=this.settings.maxChars||U3,this.forceRenderBreak=!1}async renderTo(h,v,y,T=this.bounds){let n=this.getStart(v,y),R=fm(n,v),j,Y,re,me,be=!1,oe,Se=0,Re=y||new tp(n);for(this.hooks&&this.hooks.onPageLayout.trigger(h,Re,this);!re&&!oe;){if(me=R.next(),Y=j,j=me.value,re=me.done,!j){this.hooks&&this.hooks.layout.trigger(h,this);let qe=h.querySelectorAll("img");return qe.length&&await this.waitForImages(qe),oe=this.findBreakToken(h,v,T,Re),oe&&oe.equals(Re)?(console.warn("Unable to layout item: ",Y),this.hooks&&this.hooks.beforeRenderResult.trigger(void 0,h,this),new ip(void 0,new Du("Unable to layout item",[Y]))):(this.rebuildTableFromBreakToken(oe,h),this.hooks&&this.hooks.beforeRenderResult.trigger(oe,h,this),new ip(oe))}if(this.hooks&&this.hooks.layoutNode.trigger(j),be&&this.shouldBreak(j,n)){this.hooks&&this.hooks.layout.trigger(h,this);let qe=h.querySelectorAll("img");if(qe.length&&await this.waitForImages(qe),oe=this.findBreakToken(h,v,T,Re),oe?this.rebuildTableFromBreakToken(oe,h):oe=this.breakAt(j),oe&&oe.equals(Re)){console.warn("Unable to layout item: ",j);let St=oe.node&&Ru(oe.node);if(St)oe=new tp(St);else return new ip(void 0,new Du("Unable to layout item",[j]))}Se=0;break}if(j.dataset&&j.dataset.page){let qe=j.dataset.page,St=this.element.closest(".pagedjs_page");St.classList.add("pagedjs_named_page"),St.classList.add("pagedjs_"+qe+"_page"),j.dataset.splitFrom||St.classList.add("pagedjs_"+qe+"_first_page")}let tt=M_(j),yt=this.append(j,h,y,tt);if(Se+=yt.textContent.length,be||(be=E2(j)),tt||(R=fm(Ru(j,v),v)),this.forceRenderBreak){this.hooks&&this.hooks.layout.trigger(h,this),oe=this.findBreakToken(h,v,T,Re),oe?this.rebuildTableFromBreakToken(oe,h):oe=this.breakAt(j),Se=0,this.forceRenderBreak=!1;break}if(Se>=this.maxChars){this.hooks&&this.hooks.layout.trigger(h,this);let qe=h.querySelectorAll("img");if(qe.length&&await this.waitForImages(qe),oe=this.findBreakToken(h,v,T,Re),oe&&(Se=0,this.rebuildTableFromBreakToken(oe,h)),oe&&oe.equals(Re)){console.warn("Unable to layout item: ",j);let St=oe.node&&Ru(oe.node);if(St)oe=new tp(St);else return this.hooks&&this.hooks.beforeRenderResult.trigger(void 0,h,this),new ip(void 0,new Du("Unable to layout item",[j]))}}}return this.hooks&&this.hooks.beforeRenderResult.trigger(oe,h,this),new ip(oe)}breakAt(h,v=0){let y=new tp(h,v);return this.hooks.onBreakToken.triggerSync(y,void 0,h,this).forEach(n=>{typeof n<"u"&&(y=n)}),y}shouldBreak(h,v){let y=pm(h,v),T=h.parentNode,n=L_(h)&&T&&!y&&L_(T),R;return n&&(R=h.dataset.breakBefore===T.dataset.breakBefore),!R&&L_(h)||b2(h)||z_(h,y)}forceBreak(){this.forceRenderBreak=!0}getStart(h,v){let y,T=v&&v.node;return T?y=T:y=h.firstChild,y}append(h,v,y,T=!0,n=!0){let R=T2(h,!T);if(h.parentNode&&Vo(h.parentNode)){let Y=Jo(h.parentNode,v);if(Y)Y.appendChild(R);else if(n){let re=P_(h);Y=Jo(h.parentNode,re),Y?(y&&jc(y.node)&&y.offset>0&&(R.textContent=R.textContent.substring(y.offset)),Y.appendChild(R)):v.appendChild(R),v.appendChild(re)}else v.appendChild(R)}else v.appendChild(R);return R.dataset&&R.dataset.ref&&(v.indexOfRefs||(v.indexOfRefs={}),v.indexOfRefs[R.dataset.ref]=R),this.hooks.renderNode.triggerSync(R,h,this).forEach(Y=>{typeof Y<"u"&&(R=Y)}),R}rebuildTableFromBreakToken(h,v){if(!h||!h.node)return;let y=h.node,T=Vo(y)?y.closest("td"):y.parentElement.closest("td");if(T){if(!Jo(T,v,!0))return;for(;T=T.nextElementSibling;)this.append(T,v,null,!0)}}async waitForImages(h){let v=Array.from(h).map(async y=>this.awaitImageLoaded(y));await Promise.all(v)}async awaitImageLoaded(h){return new Promise(v=>{if(h.complete!==!0)h.onload=function(){let{width:y,height:T}=window.getComputedStyle(h);v(y,T)},h.onerror=function(y){let{width:T,height:n}=window.getComputedStyle(h);v(T,n,y)};else{let{width:y,height:T}=window.getComputedStyle(h);v(y,T)}})}avoidBreakInside(h,v){let y;if(h!==v){for(;h.parentNode&&(h=h.parentNode,h!==v);)if(window.getComputedStyle(h)["break-inside"]==="avoid"){y=h;break}return y}}createBreakToken(h,v,y){let T=h.startContainer,n=h.startOffset,R,j,Y,re,me;if(Vo(T))if(me=R_(T,n),Vo(me))if(j=Jo(me,v),j)R=Jo(j,y),n=0;else{let be=mm(me);if(Vo(be)||(be=be.parentElement),j=Jo(be,v),!me.nextSibling){let oe=Jo(j,y),Re=document.createTreeWalker(oe,NodeFilter.SHOW_ELEMENT).lastChild();if(!Jo(Re,v))return}R=Jo(j,y).nextSibling,n=0}else j=Jo(T,v),j||(j=Jo(mm(T),v)),Y=Jo(j,y),re=Bx(me,Y),re===0?(R=Y,n=0):(R=R_(Y,re),n=0);else{if(j=Jo(T.parentNode,v),j||(j=Jo(mm(T.parentNode),v)),Y=Jo(j,y),re=Bx(T,Y),re===-1)return;R=R_(Y,re),n+=R.textContent.indexOf(T.textContent)}if(R)return new tp(R,n)}findBreakToken(h,v,y=this.bounds,T,n=!0){let R=this.findOverflow(h,y),j,Y;if(this.hooks.onOverflow.triggerSync(R,h,y,this).forEach(me=>{typeof me<"u"&&(R=me)}),R){if(j=this.createBreakToken(R,h,v),this.hooks.onBreakToken.triggerSync(j,R,h,this).forEach(be=>{typeof be<"u"&&(j=be)}),j&&j.equals(T))return j;if(j&&j.node&&j.offset&&j.node.textContent?Y=j.node.textContent.charAt(j.offset):Y=void 0,j&&j.node&&n){let be=this.removeOverflow(R,Y);this.hooks&&this.hooks.afterOverflowRemoved.trigger(be,h,this)}}return j}hasOverflow(h,v=this.bounds){let y=h&&h.parentNode,{width:T,height:n}=h.getBoundingClientRect(),R=y?y.scrollWidth:0,j=y?y.scrollHeight:0;return Math.max(Math.floor(T),R)>Math.round(v.width)||Math.max(Math.floor(n),j)>Math.round(v.height)}findOverflow(h,v=this.bounds,y=this.gap){if(!this.hasOverflow(h,v))return;let T=Math.floor(v.left),n=Math.round(v.right+y),R=Math.round(v.top),j=Math.round(v.bottom),Y,re=fm(h.firstChild,h),me,be,oe,Se,Re,tt,yt,qe;for(;!be;)if(me=re.next(),be=me.done,oe=me.value,Re=!1,tt=!1,yt=void 0,qe=void 0,oe){let ai=T_(oe),pi=Math.round(ai.left),Cr=Math.floor(ai.right),lr=Math.round(ai.top),bt=Math.floor(ai.bottom);if(!Y&&(pi>=n||lr>=j)){let Wt=!1,li=D_(oe,"TD",h);if(li&&window.getComputedStyle(li)["break-inside"]==="avoid")yt=li.parentElement;else if(Vo(oe)){let hi=window.getComputedStyle(oe);Wt=hi.getPropertyValue("float")!=="none",Re=hi.getPropertyValue("break-inside")==="avoid",tt=oe.dataset.breakBefore==="avoid"||oe.dataset.previousBreakAfter==="avoid",yt=tt&&pm(oe,h),qe=oe.tagName==="BR"||oe.tagName==="WBR"}let Hi;if(oe.nodeName==="TR"?Hi=oe:Hi=D_(oe,"TR",h),Hi){let hi=Hi.parentElement;["TBODY","THEAD"].includes(hi.nodeName)&&window.getComputedStyle(hi).getPropertyValue("break-inside")==="avoid"&&(yt=hi);let Di=D_(Hi,"TABLE",h),kr=Di.querySelector("[colspan]");if(Di&&kr){let Si=0;for(let Ai of Array.from(Di.rows[0].cells))Si+=parseInt(Ai.getAttribute("colspan")||"1");if(Hi.cells.length!==Si){let Ai=Hi.previousElementSibling,oi;for(;Ai!==null;){oi=0;for(let mo of Array.from(Ai.cells))oi+=parseInt(mo.getAttribute("colspan")||"1");if(oi===Si)break;Ai=Ai.previousElementSibling}oi===Si&&(yt=Ai)}}}if(yt){Y=document.createRange(),Y.selectNode(yt);break}if(!qe&&!Wt&&Vo(oe)){Y=document.createRange(),Y.selectNode(oe);break}if(jc(oe)&&oe.textContent.trim().length){Y=document.createRange(),Y.selectNode(oe);break}}if(!Y&&jc(oe)&&oe.textContent.trim().length&&!A2(oe.parentNode)){let Wt=m2(oe),li;pi=0,lr=0;for(var St=0;St!=Wt.length;St++)li=Wt[St],li.width>0&&(!pi||li.left>pi)&&(pi=li.left),li.height>0&&(!lr||li.top>lr)&&(lr=li.top);if(pi>=n||lr>=j){Y=document.createRange(),Se=this.textBreak(oe,T,n,R,j),Se?Y.setStart(oe,Se):Y=void 0;break}}(Re||Cr<=n&&bt<=j)&&(me=Ru(oe,h),me&&(re=fm(me,h)))}if(Y)return Y.setEndAfter(h.lastChild),Y}findEndToken(h,v){if(h.childNodes.length===0)return;let y=h.lastChild,T;for(;y&&y.lastChild;)if(!O_(y))y=y.previousSibling;else if(O_(y.lastChild))y=y.lastChild;else{y=mm(y.lastChild);break}jc(y)&&(y.parentNode.dataset.ref?(T=C2(y),y=y.parentNode):y=y.previousSibling);let n=Jo(y,v);T&&(n=n.childNodes[T]);let R=Ru(n);return this.breakAt(R)}textBreak(h,v,y,T,n){let R=w2(h),j=0,Y=0,re=0,me=0,be,oe,Se,Re,tt;for(;!Se&&(oe=R.next(),be=oe.value,Se=oe.done,!!be);){if(Re=T_(be),j=Math.floor(Re.left),Y=Math.floor(Re.right),re=Math.floor(Re.top),me=Math.floor(Re.bottom),j>=y||re>=n){tt=be.startOffset;break}if(Y>y||me>n){let yt=S2(be),qe,St,ai;for(;!ai&&(St=yt.next(),qe=St.value,ai=St.done,!!qe);)if(Re=T_(qe),j=Math.floor(Re.left),re=Math.floor(Re.top),j>=y||re>=n){tt=qe.startOffset,Se=!0;break}}}return tt}removeOverflow(h,v){let{startContainer:y}=h,T=h.extractContents();return this.hyphenateAtBreak(y,v),T}hyphenateAtBreak(h,v){if(jc(h)){let y=h.textContent,T=y[y.length-1];(v&&/^\w|\u00AD$/.test(T)&&/^\w|\u00AD$/.test(v)||!v&&/^\w|\u00AD$/.test(T))&&(h.parentNode.classList.add("pagedjs_hyphen"),h.textContent+=this.settings.hyphenGlyph||"\u2011")}}equalTokens(h,v){return!(!h||!v||h.node&&v.node&&h.node!==v.node||h.offset&&v.offset&&h.offset!==v.offset)}};(0,_C.default)(q_.prototype);var W_=q_;var yC=Fn(Bu(),1),G_=class{constructor(h,v,y,T,n){this.pagesArea=h,this.pageTemplate=v,this.blank=y,this.width=void 0,this.height=void 0,this.hooks=T,this.settings=n||{}}create(h,v){let y=document.importNode(this.pageTemplate.content,!0),T,n;v?(this.pagesArea.insertBefore(y,v.nextElementSibling),n=Array.prototype.indexOf.call(this.pagesArea.children,v.nextElementSibling),T=this.pagesArea.children[n]):(this.pagesArea.appendChild(y),T=this.pagesArea.lastChild);let R=T.querySelector(".pagedjs_pagebox"),j=T.querySelector(".pagedjs_page_content"),Y=T.querySelector(".pagedjs_footnote_area"),re=j.getBoundingClientRect();return j.style.columnWidth=Math.round(re.width)+"px",j.style.columnGap="calc(var(--pagedjs-margin-right) + var(--pagedjs-margin-left) + var(--pagedjs-bleed-right) + var(--pagedjs-bleed-left) + var(--pagedjs-column-gap-offset))",this.width=Math.round(re.width),this.height=Math.round(re.height),this.element=T,this.pagebox=R,this.area=j,this.footnotesArea=Y,T}createWrapper(){let h=document.createElement("div");return this.area.appendChild(h),this.wrapper=h,h}index(h){this.position=h;let v=this.element,y=h+1,T=`page-${y}`;this.id=T,v.dataset.pageNumber=y,v.setAttribute("id",T),this.name&&v.classList.add("pagedjs_"+this.name+"_page"),this.blank&&v.classList.add("pagedjs_blank_page"),h===0&&v.classList.add("pagedjs_first_page"),h%2!==1?(v.classList.remove("pagedjs_left_page"),v.classList.add("pagedjs_right_page")):(v.classList.remove("pagedjs_right_page"),v.classList.add("pagedjs_left_page"))}async layout(h,v,y){this.clear(),this.startToken=v;let T=this.settings;!T.maxChars&&y&&(T.maxChars=y),this.layoutMethod=new W_(this.area,this.hooks,T);let R=(await this.layoutMethod.renderTo(this.wrapper,h,v)).breakToken;return this.addListeners(h),this.endToken=R,R}async append(h,v){if(!this.layoutMethod)return this.layout(h,v);let T=(await this.layoutMethod.renderTo(this.wrapper,h,v)).breakToken;return this.endToken=T,T}getByParent(h,v){let y;for(var T=0;T<v.length;T++)if(y=v[T],y.dataset.ref===h)return y}onOverflow(h){this._onOverflow=h}onUnderflow(h){this._onUnderflow=h}clear(){this.removeListeners(),this.wrapper&&this.wrapper.remove(),this.createWrapper()}addListeners(h){return typeof ResizeObserver<"u"?this.addResizeObserver(h):(this._checkOverflowAfterResize=this.checkOverflowAfterResize.bind(this,h),this.element.addEventListener("overflow",this._checkOverflowAfterResize,!1),this.element.addEventListener("underflow",this._checkOverflowAfterResize,!1)),this._onScroll=function(){this.listening&&(this.element.scrollLeft=0)}.bind(this),this.element.addEventListener("scroll",this._onScroll),this.listening=!0,!0}removeListeners(){this.listening=!1,typeof ResizeObserver<"u"&&this.ro?this.ro.disconnect():this.element&&(this.element.removeEventListener("overflow",this._checkOverflowAfterResize,!1),this.element.removeEventListener("underflow",this._checkOverflowAfterResize,!1)),this.element&&this.element.removeEventListener("scroll",this._onScroll)}addResizeObserver(h){let v=this.wrapper,y=v.getBoundingClientRect().height;this.ro=new ResizeObserver(T=>{this.listening&&requestAnimationFrame(()=>{for(let n of T){let R=n.contentRect;R.height>y?(this.checkOverflowAfterResize(h),y=v.getBoundingClientRect().height):R.height<y&&(this.checkUnderflowAfterResize(h),y=R.height)}})}),this.ro.observe(v)}checkOverflowAfterResize(h){if(!this.listening||!this.layoutMethod)return;let v=this.layoutMethod.findBreakToken(this.wrapper,h,this.startToken);v&&(this.endToken=v,this._onOverflow&&this._onOverflow(v))}checkUnderflowAfterResize(h){if(!this.listening||!this.layoutMethod)return;let v=this.layoutMethod.findEndToken(this.wrapper,h);v&&this._onUnderflow&&this._onUnderflow(v)}destroy(){this.removeListeners(),this.element.remove(),this.element=void 0,this.wrapper=void 0}};(0,yC.default)(G_.prototype);var Qx=G_;var e0=class{constructor(h,v){return h&&h.nodeType?this.dom=this.add(h):typeof h=="string"&&(this.dom=this.parse(h)),this.dom}parse(h,v){let T=document.createRange().createContextualFragment(h);return this.addRefs(T),T}add(h){return this.addRefs(h),h}addRefs(h){var v=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,null,!1);let y=v.nextNode();for(;y;){if(!y.hasAttribute("data-ref")){let T=Ns();y.setAttribute("data-ref",T)}y.id&&y.setAttribute("data-id",y.id),y=v.nextNode()}}find(h){return this.refs[h]}destroy(){this.refs=void 0,this.dom=void 0}},vC=e0;var SC=Fn(Bu(),1);var t0=class{constructor(h){this._q=[],this.context=h,this.tick=requestAnimationFrame,this.running=!1,this.paused=!1}enqueue(){var h,v,y,T=[].shift.call(arguments),n=arguments;if(!T)throw new Error("No Task Provided");return typeof T=="function"?(h=new A_,v=h.promise,y={task:T,args:n,deferred:h,promise:v}):y={promise:T},this._q.push(y),this.paused==!1&&!this.running&&this.run(),y.promise}dequeue(){var h,v,y;if(this._q.length&&!this.paused){if(h=this._q.shift(),v=h.task,v)return y=v.apply(this.context,h.args),y&&typeof y.then=="function"?y.then(function(){h.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){h.deferred.reject.apply(this.context,arguments)}.bind(this)):(h.deferred.resolve.apply(this.context,y),h.promise);if(h.promise)return h.promise}else return h=new A_,h.deferred.resolve(),h.promise}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new A_),this.tick.call(window,()=>{this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}),this.paused==!0&&(this.paused=!1),this.defered.promise}flush(){if(this.running)return this.running;if(this._q.length)return this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}};var xC=t0;var bC=!1,wC=!1,q3=`
<div class="pagedjs_page">
	<div class="pagedjs_sheet">
		<div class="pagedjs_bleed pagedjs_bleed-top">
			<div class="pagedjs_marks-crop"></div>
			<div class="pagedjs_marks-middle">
				<div class="pagedjs_marks-cross"></div>
			</div>
			<div class="pagedjs_marks-crop"></div>
		</div>
		<div class="pagedjs_bleed pagedjs_bleed-bottom">
			<div class="pagedjs_marks-crop"></div>
			<div class="pagedjs_marks-middle">
				<div class="pagedjs_marks-cross"></div>
			</div>		<div class="pagedjs_marks-crop"></div>
		</div>
		<div class="pagedjs_bleed pagedjs_bleed-left">
			<div class="pagedjs_marks-crop"></div>
			<div class="pagedjs_marks-middle">
				<div class="pagedjs_marks-cross"></div>
			</div>		<div class="pagedjs_marks-crop"></div>
		</div>
		<div class="pagedjs_bleed pagedjs_bleed-right">
			<div class="pagedjs_marks-crop"></div>
			<div class="pagedjs_marks-middle">
				<div class="pagedjs_marks-cross"></div>
			</div>
			<div class="pagedjs_marks-crop"></div>
		</div>
		<div class="pagedjs_pagebox">
			<div class="pagedjs_margin-top-left-corner-holder">
				<div class="pagedjs_margin pagedjs_margin-top-left-corner"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-top">
				<div class="pagedjs_margin pagedjs_margin-top-left"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-top-center"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-top-right"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-top-right-corner-holder">
				<div class="pagedjs_margin pagedjs_margin-top-right-corner"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-right">
				<div class="pagedjs_margin pagedjs_margin-right-top"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-right-middle"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-right-bottom"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-left">
				<div class="pagedjs_margin pagedjs_margin-left-top"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-left-middle"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-left-bottom"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-bottom-left-corner-holder">
				<div class="pagedjs_margin pagedjs_margin-bottom-left-corner"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-bottom">
				<div class="pagedjs_margin pagedjs_margin-bottom-left"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-bottom-center"><div class="pagedjs_margin-content"></div></div>
				<div class="pagedjs_margin pagedjs_margin-bottom-right"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_margin-bottom-right-corner-holder">
				<div class="pagedjs_margin pagedjs_margin-bottom-right-corner"><div class="pagedjs_margin-content"></div></div>
			</div>
			<div class="pagedjs_area">
				<div class="pagedjs_page_content"></div>
				<div class="pagedjs_footnote_area">
					<div class="pagedjs_footnote_content pagedjs_footnote_empty">
						<div class="pagedjs_footnote_inner_content"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>`,H_=class{constructor(h,v,y){this.settings=y||{},this.hooks={},this.hooks.beforeParsed=new Gi(this),this.hooks.filter=new Gi(this),this.hooks.afterParsed=new Gi(this),this.hooks.beforePageLayout=new Gi(this),this.hooks.onPageLayout=new Gi(this),this.hooks.layout=new Gi(this),this.hooks.renderNode=new Gi(this),this.hooks.layoutNode=new Gi(this),this.hooks.onOverflow=new Gi(this),this.hooks.afterOverflowRemoved=new Gi(this),this.hooks.onBreakToken=new Gi,this.hooks.beforeRenderResult=new Gi(this),this.hooks.afterPageLayout=new Gi(this),this.hooks.finalizePage=new Gi(this),this.hooks.afterRendered=new Gi(this),this.pages=[],this.total=0,this.q=new xC(this),this.stopped=!1,this.rendered=!1,this.content=h,this.charsPerBreak=[],this.maxChars,h&&this.flow(h,v)}setup(h){this.pagesArea=document.createElement("div"),this.pagesArea.classList.add("pagedjs_pages"),h?h.appendChild(this.pagesArea):document.querySelector("body").appendChild(this.pagesArea),this.pageTemplate=document.createElement("template"),this.pageTemplate.innerHTML=q3}async flow(h,v){let y;await this.hooks.beforeParsed.trigger(h,this),y=new vC(h),this.hooks.filter.triggerSync(y),this.source=y,this.breakToken=void 0,this.pagesArea&&this.pageTemplate?(this.q.clear(),this.removePages()):this.setup(v),this.emit("rendering",y),await this.hooks.afterParsed.trigger(y,this),await this.loadFonts();let T=await this.render(y,this.breakToken);for(;T.canceled;)this.start(),T=await this.render(y,this.breakToken);return this.rendered=!0,this.pagesArea.style.setProperty("--pagedjs-page-count",this.total),await this.hooks.afterRendered.trigger(this.pages,this),this.emit("rendered",this.pages),this}async render(h,v){let y=this.layout(h,v),T=!1,n,R=0;for(;!T;)if(n=await this.q.enqueue(()=>this.renderAsync(y)),T=n.done,wC&&(R+=1,R>=wC)){this.stop();break}return n}start(){this.rendered=!1,this.stopped=!1}stop(){this.stopped=!0}renderOnIdle(h){return new Promise(v=>{g2(async()=>{if(this.stopped)return v({done:!0,canceled:!0});let y=await h.next();this.stopped?v({done:!0,canceled:!0}):v(y)})})}async renderAsync(h){if(this.stopped)return{done:!0,canceled:!0};let v=await h.next();return this.stopped?{done:!0,canceled:!0}:v}async handleBreaks(h,v){let y=this.total+1,T=y%2===0?"left":"right",n=y%2===0?"verso":"recto",R,j,Y;y!==1&&(h&&typeof h.dataset<"u"&&typeof h.dataset.previousBreakAfter<"u"&&(R=h.dataset.previousBreakAfter),h&&typeof h.dataset<"u"&&typeof h.dataset.breakBefore<"u"&&(j=h.dataset.breakBefore),v?Y=this.addPage(!0):R&&(R==="left"||R==="right")&&R!==T?Y=this.addPage(!0):R&&(R==="verso"||R==="recto")&&R!==n?Y=this.addPage(!0):j&&(j==="left"||j==="right")&&j!==T?Y=this.addPage(!0):j&&(j==="verso"||j==="recto")&&j!==n&&(Y=this.addPage(!0)),Y&&(await this.hooks.beforePageLayout.trigger(Y,void 0,void 0,this),this.emit("page",Y),await this.hooks.afterPageLayout.trigger(Y.element,Y,void 0,this),await this.hooks.finalizePage.trigger(Y.element,Y,void 0,this),this.emit("renderedPage",Y)))}async*layout(h,v){let y=v||!1,T=[];for(;y!==void 0&&(!bC||this.total<bC);){y&&y.node?await this.handleBreaks(y.node):await this.handleBreaks(h.firstChild);let n=this.addPage();if(await this.hooks.beforePageLayout.trigger(n,h,y,this),this.emit("page",n),y=await n.layout(h,y,this.maxChars),y){let R=y.toJSON(!0);if(T.lastIndexOf(R)>-1){let j=new Du("Layout repeated",[y.node]);return console.error("Layout repeated at: ",y.node),j}else T.push(R)}await this.hooks.afterPageLayout.trigger(n.element,n,y,this),await this.hooks.finalizePage.trigger(n.element,n,void 0,this),this.emit("renderedPage",n),this.recoredCharLength(n.wrapper.textContent.length),yield y}}recoredCharLength(h){h!==0&&(this.charsPerBreak.push(h),this.charsPerBreak.length>4&&this.charsPerBreak.shift(),this.maxChars=this.charsPerBreak.reduce((v,y)=>v+y,0)/this.charsPerBreak.length)}removePages(h=0){if(!(h>=this.pages.length)){for(let v=h;v<this.pages.length;v++)this.pages[v].destroy();h>0?this.pages.splice(h):this.pages=[],this.total=this.pages.length}}addPage(h){let v=this.pages[this.pages.length-1],y=new Qx(this.pagesArea,this.pageTemplate,h,this.hooks,this.settings);return this.pages.push(y),y.create(void 0,v&&v.element),y.index(this.total),h||(y.onOverflow(T=>{if(console.warn("overflow on",y.id,T),this.rendered)return;let n=this.pages.indexOf(y)+1;this.stop(),this.breakToken=T,this.removePages(n),this.rendered===!0&&(this.rendered=!1,this.q.enqueue(async()=>{this.start(),await this.render(this.source,this.breakToken),this.rendered=!0}))}),y.onUnderflow(T=>{})),this.total=this.pages.length,y}async clonePage(h){let v=this.pages[this.pages.length-1],y=new Qx(this.pagesArea,this.pageTemplate,!1,this.hooks);this.pages.push(y),y.create(void 0,v&&v.element),y.index(this.total),await this.hooks.beforePageLayout.trigger(y,void 0,void 0,this),this.emit("page",y);for(let T of h.element.classList)T!=="pagedjs_left_page"&&T!=="pagedjs_right_page"&&y.element.classList.add(T);await this.hooks.afterPageLayout.trigger(y.element,y,void 0,this),await this.hooks.finalizePage.trigger(y.element,y,void 0,this),this.emit("renderedPage",y)}loadFonts(){let h=[];return(document.fonts||[]).forEach(v=>{if(v.status!=="loaded"){let y=v.load().then(T=>v.family,T=>(console.warn("Failed to preload font-family:",v.family),v.family));h.push(y)}}),Promise.all(h).catch(v=>{console.warn(v)})}destroy(){this.pagesArea.remove(),this.pageTemplate.remove()}};(0,SC.default)(H_.prototype);var i0=H_;var fo=Fn(fs(),1);var Cb=class{constructor(h,v){v?this.hooks=v:(this.hooks={},this.hooks.onUrl=new Gi(this),this.hooks.onAtPage=new Gi(this),this.hooks.onAtMedia=new Gi(this),this.hooks.onRule=new Gi(this),this.hooks.onDeclaration=new Gi(this),this.hooks.onSelector=new Gi(this),this.hooks.onPseudoSelector=new Gi(this),this.hooks.onContent=new Gi(this),this.hooks.onImport=new Gi(this),this.hooks.beforeTreeParse=new Gi(this),this.hooks.beforeTreeWalk=new Gi(this),this.hooks.afterTreeWalk=new Gi(this));try{this.url=new URL(h,window.location.href)}catch{this.url=new URL(window.location.href)}}async parse(h){return this.text=h,await this.hooks.beforeTreeParse.trigger(this.text,this),this.ast=fo.default.parse(this._text),await this.hooks.beforeTreeWalk.trigger(this.ast),this.replaceUrls(this.ast),this.id=Ns(),this.replaceIds(this.ast),this.imported=[],this.urls(this.ast),this.rules(this.ast),this.atrules(this.ast),await this.hooks.afterTreeWalk.trigger(this.ast,this),this.ast}insertRule(h){let v=this.ast.children.appendData(h);return this.declarations(h),v}urls(h){fo.default.walk(h,{visit:"Url",enter:(v,y,T)=>{this.hooks.onUrl.trigger(v,y,T)}})}atrules(h){fo.default.walk(h,{visit:"Atrule",enter:(v,y,T)=>{let n=fo.default.keyword(v.name).basename;n==="page"&&(this.hooks.onAtPage.trigger(v,y,T),this.declarations(v,y,T)),n==="media"&&(this.hooks.onAtMedia.trigger(v,y,T),this.declarations(v,y,T)),n==="import"&&(this.hooks.onImport.trigger(v,y,T),this.imports(v,y,T))}})}rules(h){fo.default.walk(h,{visit:"Rule",enter:(v,y,T)=>{this.hooks.onRule.trigger(v,y,T),this.declarations(v,y,T),this.onSelector(v,y,T)}})}declarations(h,v,y){fo.default.walk(h,{visit:"Declaration",enter:(T,n,R)=>{this.hooks.onDeclaration.trigger(T,n,R,{ruleNode:h,ruleItem:v,rulelist:y}),T.property==="content"&&fo.default.walk(T,{visit:"Function",enter:(j,Y,re)=>{this.hooks.onContent.trigger(j,Y,re,{declarationNode:T,dItem:n,dList:R},{ruleNode:h,ruleItem:v,rulelist:y})}})}})}onSelector(h,v,y){fo.default.walk(h,{visit:"Selector",enter:(T,n,R)=>{this.hooks.onSelector.trigger(T,n,R,{ruleNode:h,ruleItem:v,rulelist:y}),T.children.forEach(j=>{j.type==="PseudoElementSelector"&&fo.default.walk(j,{visit:"PseudoElementSelector",enter:(Y,re,me)=>{this.hooks.onPseudoSelector.trigger(Y,re,me,{selectNode:T,selectItem:n,selectList:R},{ruleNode:h,ruleItem:v,rulelist:y})}})})}})}replaceUrls(h){fo.default.walk(h,{visit:"Url",enter:(v,y,T)=>{let n=v.value.value;if(!(v.value.type==="Raw"&&n.startsWith("data:")||v.value.type==="String"&&(n.startsWith('"data:')||n.startsWith("'data:")))){let R=n.replace(/["']/g,""),j=new URL(R,this.url);v.value.value=j.toString()}}})}addScope(h,v){fo.default.walk(h,{visit:"Selector",enter:(y,T,n)=>{let R=y.children;R.prepend(R.createItem({type:"WhiteSpace",value:" "})),R.prepend(R.createItem({type:"IdSelector",name:v,loc:null,children:null}))}})}getNamedPageSelectors(h){let v={};return fo.default.walk(h,{visit:"Rule",enter:(y,T,n)=>{fo.default.walk(y,{visit:"Declaration",enter:(R,j,Y)=>{if(R.property==="page"){let re=R.value.children.first(),me=re.name,be=fo.default.generate(y.prelude);v[me]={name:me,selector:be},R.property="break-before",re.type="Identifier",re.name="always"}}})}}),v}replaceIds(h){fo.default.walk(h,{visit:"Rule",enter:(v,y,T)=>{fo.default.walk(v,{visit:"IdSelector",enter:(n,R,j)=>{let Y=n.name;n.flags=null,n.matcher="=",n.name={type:"Identifier",loc:null,name:"data-id"},n.type="AttributeSelector",n.value={type:"String",loc:null,value:`"${Y}"`}}})}})}imports(h,v,y){let T=[];fo.default.walk(h,{visit:"MediaQuery",enter:(R,j,Y)=>{fo.default.walk(R,{visit:"Identifier",enter:(re,me,be)=>{T.push(re.name)}})}}),!T.some((R,j)=>{let Y=R;return Y==="not"?(Y=T[j+1],!(Y==="screen"||Y==="speech")):Y==="screen"||Y==="speech"})&&fo.default.walk(h,{visit:"String",enter:(R,j,Y)=>{let re=R.value.replace(/["']/g,""),be=new URL(re,this.url).toString();this.imported.push(be),y.remove(v)}})}set text(h){this._text=h}get text(){return this._text}toString(h){return fo.default.generate(h||this.ast)}},dz=Cb;var hz=`
:root {
	--pagedjs-width: 8.5in;
	--pagedjs-height: 11in;
	--pagedjs-width-right: 8.5in;
	--pagedjs-height-right: 11in;
	--pagedjs-width-left: 8.5in;
	--pagedjs-height-left: 11in;
	--pagedjs-pagebox-width: 8.5in;
	--pagedjs-pagebox-height: 11in;
	--pagedjs-footnotes-height: 0mm;
	--pagedjs-margin-top: 1in;
	--pagedjs-margin-right: 1in;
	--pagedjs-margin-bottom: 1in;
	--pagedjs-margin-left: 1in;
	--pagedjs-padding-top: 0mm;
	--pagedjs-padding-right: 0mm;
	--pagedjs-padding-bottom: 0mm;
	--pagedjs-padding-left: 0mm;
	--pagedjs-border-top: 0mm;
	--pagedjs-border-right: 0mm;
	--pagedjs-border-bottom: 0mm;
	--pagedjs-border-left: 0mm;
	--pagedjs-bleed-top: 0mm;
	--pagedjs-bleed-right: 0mm;
	--pagedjs-bleed-bottom: 0mm;
	--pagedjs-bleed-left: 0mm;
	--pagedjs-bleed-right-top: 0mm;
	--pagedjs-bleed-right-right: 0mm;
	--pagedjs-bleed-right-bottom: 0mm;
	--pagedjs-bleed-right-left: 0mm;
	--pagedjs-bleed-left-top: 0mm;
	--pagedjs-bleed-left-right: 0mm;
	--pagedjs-bleed-left-bottom: 0mm;
	--pagedjs-bleed-left-left: 0mm;
	--pagedjs-crop-color: black;
	--pagedjs-crop-shadow: white;
	--pagedjs-crop-offset: 2mm;
	--pagedjs-crop-stroke: 1px;
	--pagedjs-cross-size: 5mm;
	--pagedjs-mark-cross-display: none;
	--pagedjs-mark-crop-display: none;
	--pagedjs-page-count: 0;
	--pagedjs-page-counter-increment: 1;
	--pagedjs-footnotes-count: 0;
	--pagedjs-column-gap-offset: 1000px;
}

@page {
	size: letter;
	margin: 0;
}

.pagedjs_sheet {
	box-sizing: border-box;
	width: var(--pagedjs-width);
	height: var(--pagedjs-height);
	overflow: hidden;
	position: relative;
	display: grid;
	grid-template-columns: [bleed-left] var(--pagedjs-bleed-left) [sheet-center] calc(var(--pagedjs-width) - var(--pagedjs-bleed-left) - var(--pagedjs-bleed-right)) [bleed-right] var(--pagedjs-bleed-right);
	grid-template-rows: [bleed-top] var(--pagedjs-bleed-top) [sheet-middle] calc(var(--pagedjs-height) - var(--pagedjs-bleed-top) - var(--pagedjs-bleed-bottom)) [bleed-bottom] var(--pagedjs-bleed-bottom);
}

.pagedjs_right_page .pagedjs_sheet {
	width: var(--pagedjs-width-right);
	height: var(--pagedjs-height-right);
	grid-template-columns: [bleed-left] var(--pagedjs-bleed-right-left) [sheet-center] calc(var(--pagedjs-width) - var(--pagedjs-bleed-right-left) - var(--pagedjs-bleed-right-right)) [bleed-right] var(--pagedjs-bleed-right-right);
	grid-template-rows: [bleed-top] var(--pagedjs-bleed-right-top) [sheet-middle] calc(var(--pagedjs-height) - var(--pagedjs-bleed-right-top) - var(--pagedjs-bleed-right-bottom)) [bleed-bottom] var(--pagedjs-bleed-right-bottom);
}

.pagedjs_left_page .pagedjs_sheet {
	width: var(--pagedjs-width-left);
	height: var(--pagedjs-height-left);
	grid-template-columns: [bleed-left] var(--pagedjs-bleed-left-left) [sheet-center] calc(var(--pagedjs-width) - var(--pagedjs-bleed-left-left) - var(--pagedjs-bleed-left-right)) [bleed-right] var(--pagedjs-bleed-left-right);
	grid-template-rows: [bleed-top] var(--pagedjs-bleed-left-top) [sheet-middle] calc(var(--pagedjs-height) - var(--pagedjs-bleed-left-top) - var(--pagedjs-bleed-left-bottom)) [bleed-bottom] var(--pagedjs-bleed-left-bottom);
}

.pagedjs_bleed {
	display: flex;
	align-items: center;
	justify-content: center;
	flex-wrap: nowrap;
	overflow: hidden;
}

.pagedjs_bleed-top {
	grid-column: bleed-left / -1;
	grid-row: bleed-top;
	flex-direction: row;
}

.pagedjs_bleed-bottom {
	grid-column: bleed-left / -1;
	grid-row: bleed-bottom;
	flex-direction: row;
}

.pagedjs_bleed-left {
	grid-column: bleed-left;
	grid-row: bleed-top / -1;
	flex-direction: column;
}

.pagedjs_bleed-right {
	grid-column: bleed-right;
	grid-row: bleed-top / -1;
	flex-direction: column;
}

.pagedjs_marks-crop {
	display: var(--pagedjs-mark-crop-display);
	flex-grow: 0;
	flex-shrink: 0;
	z-index: 9999999999;
}

.pagedjs_bleed-top .pagedjs_marks-crop:nth-child(1),
.pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(1) {
	width: calc(var(--pagedjs-bleed-left) - var(--pagedjs-crop-stroke));
	border-right: var(--pagedjs-crop-stroke) solid var(--pagedjs-crop-color);
	box-shadow: 1px 0px 0px 0px var(--pagedjs-crop-shadow);
}

.pagedjs_right_page .pagedjs_bleed-top .pagedjs_marks-crop:nth-child(1),
.pagedjs_right_page .pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(1) {
	width: calc(var(--pagedjs-bleed-right-left) - var(--pagedjs-crop-stroke));
}

.pagedjs_left_page .pagedjs_bleed-top .pagedjs_marks-crop:nth-child(1),
.pagedjs_left_page .pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(1) {
	width: calc(var(--pagedjs-bleed-left-left) - var(--pagedjs-crop-stroke));
}

.pagedjs_bleed-top .pagedjs_marks-crop:nth-child(3),
.pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(3) {
	width: calc(var(--pagedjs-bleed-right) - var(--pagedjs-crop-stroke));
	border-left: var(--pagedjs-crop-stroke) solid var(--pagedjs-crop-color);
	box-shadow: -1px 0px 0px 0px var(--pagedjs-crop-shadow);
}

.pagedjs_right_page .pagedjs_bleed-top .pagedjs_marks-crop:nth-child(3),
.pagedjs_right_page .pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(3) {
	width: calc(var(--pagedjs-bleed-right-right) - var(--pagedjs-crop-stroke));
}

.pagedjs_left_page .pagedjs_bleed-top .pagedjs_marks-crop:nth-child(3),
.pagedjs_left_page .pagedjs_bleed-bottom .pagedjs_marks-crop:nth-child(3) {
	width: calc(var(--pagedjs-bleed-left-right) - var(--pagedjs-crop-stroke));
}

.pagedjs_bleed-top .pagedjs_marks-crop {
	align-self: flex-start;
	height: calc(var(--pagedjs-bleed-top) - var(--pagedjs-crop-offset));
}

.pagedjs_right_page .pagedjs_bleed-top .pagedjs_marks-crop {
	height: calc(var(--pagedjs-bleed-right-top) - var(--pagedjs-crop-offset));
}

.pagedjs_left_page .pagedjs_bleed-top .pagedjs_marks-crop {
	height: calc(var(--pagedjs-bleed-left-top) - var(--pagedjs-crop-offset));
}

.pagedjs_bleed-bottom .pagedjs_marks-crop {
	align-self: flex-end;
	height: calc(var(--pagedjs-bleed-bottom) - var(--pagedjs-crop-offset));
}

.pagedjs_right_page .pagedjs_bleed-bottom .pagedjs_marks-crop {
	height: calc(var(--pagedjs-bleed-right-bottom) - var(--pagedjs-crop-offset));
}

.pagedjs_left_page .pagedjs_bleed-bottom .pagedjs_marks-crop {
	height: calc(var(--pagedjs-bleed-left-bottom) - var(--pagedjs-crop-offset));
}

.pagedjs_bleed-left .pagedjs_marks-crop:nth-child(1),
.pagedjs_bleed-right .pagedjs_marks-crop:nth-child(1) {
	height: calc(var(--pagedjs-bleed-top) - var(--pagedjs-crop-stroke));
	border-bottom: var(--pagedjs-crop-stroke) solid var(--pagedjs-crop-color);
	box-shadow: 0px 1px 0px 0px var(--pagedjs-crop-shadow);
}

.pagedjs_right_page .pagedjs_bleed-left .pagedjs_marks-crop:nth-child(1),
.pagedjs_right_page .pagedjs_bleed-right .pagedjs_marks-crop:nth-child(1) {
	height: calc(var(--pagedjs-bleed-right-top) - var(--pagedjs-crop-stroke));
}

.pagedjs_left_page .pagedjs_bleed-left .pagedjs_marks-crop:nth-child(1),
.pagedjs_left_page .pagedjs_bleed-right .pagedjs_marks-crop:nth-child(1) {
	height: calc(var(--pagedjs-bleed-left-top) - var(--pagedjs-crop-stroke));
}

.pagedjs_bleed-left .pagedjs_marks-crop:nth-child(3),
.pagedjs_bleed-right .pagedjs_marks-crop:nth-child(3) {
	height: calc(var(--pagedjs-bleed-bottom) - var(--pagedjs-crop-stroke));
	border-top: var(--pagedjs-crop-stroke) solid var(--pagedjs-crop-color);
	box-shadow: 0px -1px 0px 0px var(--pagedjs-crop-shadow);
}

.pagedjs_right_page .pagedjs_bleed-left .pagedjs_marks-crop:nth-child(3),
.pagedjs_right_page .pagedjs_bleed-right .pagedjs_marks-crop:nth-child(3) {
	height: calc(var(--pagedjs-bleed-right-bottom) - var(--pagedjs-crop-stroke));
}

.pagedjs_left_page .pagedjs_bleed-left .pagedjs_marks-crop:nth-child(3),
.pagedjs_left_page .pagedjs_bleed-right .pagedjs_marks-crop:nth-child(3) {
	height: calc(var(--pagedjs-bleed-left-bottom) - var(--pagedjs-crop-stroke));
}

.pagedjs_bleed-left .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-left) - var(--pagedjs-crop-offset));
	align-self: flex-start;
}

.pagedjs_right_page .pagedjs_bleed-left .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-right-left) - var(--pagedjs-crop-offset));
}

.pagedjs_left_page .pagedjs_bleed-left .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-left-left) - var(--pagedjs-crop-offset));
}

.pagedjs_bleed-right .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-right) - var(--pagedjs-crop-offset));
	align-self: flex-end;
}

.pagedjs_right_page .pagedjs_bleed-right .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-right-right) - var(--pagedjs-crop-offset));
}

.pagedjs_left_page .pagedjs_bleed-right .pagedjs_marks-crop {
	width: calc(var(--pagedjs-bleed-left-right) - var(--pagedjs-crop-offset));
}

.pagedjs_marks-middle {
	display: flex;
	flex-grow: 1;
	flex-shrink: 0;
	align-items: center;
	justify-content: center;
}

.pagedjs_marks-cross {
	display: var(--pagedjs-mark-cross-display);
	background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIzMi41MzdweCIgaGVpZ2h0PSIzMi41MzdweCIgdmlld0JveD0iMC4xMDQgMC4xMDQgMzIuNTM3IDMyLjUzNyIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwLjEwNCAwLjEwNCAzMi41MzcgMzIuNTM3IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iMy4zODkzIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0yOS45MzEsMTYuMzczYzAsNy40ODktNi4wNjgsMTMuNTYtMTMuNTU4LDEzLjU2Yy03LjQ4MywwLTEzLjU1Ny02LjA3Mi0xMy41NTctMTMuNTZjMC03LjQ4Niw2LjA3NC0xMy41NTQsMTMuNTU3LTEzLjU1NEMyMy44NjIsMi44MTksMjkuOTMxLDguODg3LDI5LjkzMSwxNi4zNzN6Ii8+PGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjMuMzg5MyIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiB4MT0iMC4xMDQiIHkxPSIxNi4zNzMiIHgyPSIzMi42NDIiIHkyPSIxNi4zNzMiLz48bGluZSBmaWxsPSJub25lIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iMy4zODkzIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSIxNi4zNzMiIHkxPSIwLjEwNCIgeDI9IjE2LjM3MyIgeTI9IjMyLjY0MiIvPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSIzLjM4OTMiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTI0LjUwOCwxNi4zNzNjMCw0LjQ5Ni0zLjYzOCw4LjEzNS04LjEzNSw4LjEzNWMtNC40OTEsMC04LjEzNS0zLjYzOC04LjEzNS04LjEzNWMwLTQuNDg5LDMuNjQ0LTguMTM1LDguMTM1LTguMTM1QzIwLjg2OSw4LjIzOSwyNC41MDgsMTEuODg0LDI0LjUwOCwxNi4zNzN6Ii8+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjAuNjc3OCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMjkuOTMxLDE2LjM3M2MwLDcuNDg5LTYuMDY4LDEzLjU2LTEzLjU1OCwxMy41NmMtNy40ODMsMC0xMy41NTctNi4wNzItMTMuNTU3LTEzLjU2YzAtNy40ODYsNi4wNzQtMTMuNTU0LDEzLjU1Ny0xMy41NTRDMjMuODYyLDIuODE5LDI5LjkzMSw4Ljg4NywyOS45MzEsMTYuMzczeiIvPjxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwLjY3NzgiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjAuMTA0IiB5MT0iMTYuMzczIiB4Mj0iMzIuNjQyIiB5Mj0iMTYuMzczIi8+PGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjAuNjc3OCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiB4MT0iMTYuMzczIiB5MT0iMC4xMDQiIHgyPSIxNi4zNzMiIHkyPSIzMi42NDIiLz48cGF0aCBkPSJNMjQuNTA4LDE2LjM3M2MwLDQuNDk2LTMuNjM4LDguMTM1LTguMTM1LDguMTM1Yy00LjQ5MSwwLTguMTM1LTMuNjM4LTguMTM1LTguMTM1YzAtNC40ODksMy42NDQtOC4xMzUsOC4xMzUtOC4xMzVDMjAuODY5LDguMjM5LDI0LjUwOCwxMS44ODQsMjQuNTA4LDE2LjM3MyIvPjxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSIwLjY3NzgiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgeDE9IjguMjM5IiB5MT0iMTYuMzczIiB4Mj0iMjQuNTA4IiB5Mj0iMTYuMzczIi8+PGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjAuNjc3OCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiB4MT0iMTYuMzczIiB5MT0iOC4yMzkiIHgyPSIxNi4zNzMiIHkyPSIyNC41MDgiLz48L3N2Zz4=);
  background-repeat: no-repeat;
  background-position: 50% 50%;
  background-size: var(--pagedjs-cross-size);

  z-index: 2147483647;
	width: var(--pagedjs-cross-size);
	height: var(--pagedjs-cross-size);
}

.pagedjs_pagebox {
	box-sizing: border-box;
	width: var(--pagedjs-pagebox-width);
	height: var(--pagedjs-pagebox-height);
	position: relative;
	display: grid;
	grid-template-columns: [left] var(--pagedjs-margin-left) [center] calc(var(--pagedjs-pagebox-width) - var(--pagedjs-margin-left) - var(--pagedjs-margin-right)) [right] var(--pagedjs-margin-right);
	grid-template-rows: [header] var(--pagedjs-margin-top) [page] calc(var(--pagedjs-pagebox-height) - var(--pagedjs-margin-top) - var(--pagedjs-margin-bottom)) [footer] var(--pagedjs-margin-bottom);
	grid-column: sheet-center;
	grid-row: sheet-middle;
}

.pagedjs_pagebox * {
	box-sizing: border-box;
}

.pagedjs_margin-top {
	width: calc(var(--pagedjs-pagebox-width) - var(--pagedjs-margin-left) - var(--pagedjs-margin-right));
	height: var(--pagedjs-margin-top);
	grid-column: center;
	grid-row: header;
	flex-wrap: nowrap;
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	grid-template-rows: 100%;
}

.pagedjs_margin-top-left-corner-holder {
	width: var(--pagedjs-margin-left);
	height: var(--pagedjs-margin-top);
	display: flex;
	grid-column: left;
	grid-row: header;
}

.pagedjs_margin-top-right-corner-holder {
	width: var(--pagedjs-margin-right);
	height: var(--pagedjs-margin-top);
	display: flex;
	grid-column: right;
	grid-row: header;
}

.pagedjs_margin-top-left-corner {
	width: var(--pagedjs-margin-left);
}

.pagedjs_margin-top-right-corner {
	width: var(--pagedjs-margin-right);
}

.pagedjs_margin-right {
	height: calc(var(--pagedjs-pagebox-height) - var(--pagedjs-margin-top) - var(--pagedjs-margin-bottom));
	width: var(--pagedjs-margin-right);
	right: 0;
	grid-column: right;
	grid-row: page;
	display: grid;
	grid-template-rows: repeat(3, 33.3333%);
	grid-template-columns: 100%;
}

.pagedjs_margin-bottom {
	width: calc(var(--pagedjs-pagebox-width) - var(--pagedjs-margin-left) - var(--pagedjs-margin-right));
	height: var(--pagedjs-margin-bottom);
	grid-column: center;
	grid-row: footer;
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	grid-template-rows: 100%;
}

.pagedjs_margin-bottom-left-corner-holder {
	width: var(--pagedjs-margin-left);
	height: var(--pagedjs-margin-bottom);
	display: flex;
	grid-column: left;
	grid-row: footer;
}

.pagedjs_margin-bottom-right-corner-holder {
	width: var(--pagedjs-margin-right);
	height: var(--pagedjs-margin-bottom);
	display: flex;
	grid-column: right;
	grid-row: footer;
}

.pagedjs_margin-bottom-left-corner {
	width: var(--pagedjs-margin-left);
}

.pagedjs_margin-bottom-right-corner {
	width: var(--pagedjs-margin-right);
}



.pagedjs_margin-left {
	height: calc(var(--pagedjs-pagebox-height) - var(--pagedjs-margin-top) - var(--pagedjs-margin-bottom));
	width: var(--pagedjs-margin-left);
	grid-column: left;
	grid-row: page;
	display: grid;
	grid-template-rows: repeat(3, 33.33333%);
	grid-template-columns: 100%;
}

.pagedjs_pages .pagedjs_pagebox .pagedjs_margin:not(.hasContent) {
	visibility: hidden;
}

.pagedjs_pagebox > .pagedjs_area {
	grid-column: center;
	grid-row: page;
	width: 100%;
	height: 100%;
	padding: var(--pagedjs-padding-top) var(--pagedjs-padding-right) var(--pagedjs-padding-bottom) var(--pagedjs-padding-left);
	border-top: var(--pagedjs-border-top);
	border-right: var(--pagedjs-border-right);
	border-bottom: var(--pagedjs-border-bottom);
	border-left: var(--pagedjs-border-left);
}

.pagedjs_pagebox > .pagedjs_area > .pagedjs_page_content {
	width: 100%;
	height: calc(100% - var(--pagedjs-footnotes-height));
	position: relative;
	column-fill: auto;
}

.pagedjs_pagebox > .pagedjs_area > .pagedjs_page_content > div {
	height: inherit;
}

.pagedjs_pagebox > .pagedjs_area > .pagedjs_footnote_area {
	position: relative;
	overflow: hidden;
	height: var(--pagedjs-footnotes-height);
	display: flex;
    justify-content: flex-end;
    flex-flow: column;
}

.pagedjs_pagebox > .pagedjs_area > .pagedjs_footnote_area > .pagedjs_footnote_content {
	overflow: hidden;
}

.pagedjs_pagebox > .pagedjs_area > .pagedjs_footnote_area > .pagedjs_footnote_inner_content {
	overflow: hidden;
}

.pagedjs_area [data-footnote-call] {
	all: unset;
	counter-increment: footnote;
}

.pagedjs_area [data-split-from] {
	counter-increment: unset;
	counter-reset: unset;
}

[data-footnote-call]::after {
	vertical-align: super;
	font-size: 65%;
	line-height: normal;
	content: counter(footnote);
}

@supports ( font-variant-position: super ) {
	[data-footnote-call]::after {
		vertical-align: baseline;
		font-size: 100%;
		line-height: inherit;
		font-variant-position: super;
	}
}

.pagedjs_footnote_empty {
	display: none;
}

.pagedjs_area [data-split-from] {
	counter-increment: unset;
	counter-reset: unset;
}

[data-footnote-marker] {
	text-indent: 0;
	display: list-item;
	list-style-position: inside;
}

[data-footnote-marker][data-split-from] {
	list-style: none;
}

[data-footnote-marker]:not([data-split-from]) {
	counter-increment: footnote-marker;
}

[data-footnote-marker]::marker {
	content: counter(footnote-marker) ". ";
}

[data-footnote-marker][data-split-from]::marker {
	content: unset;
}

.pagedjs_area .pagedjs_footnote_inner_content [data-note-display="inline"] {
 	display: inline;
}

.pagedjs_page {
	counter-increment: page var(--pagedjs-page-counter-increment);
	width: var(--pagedjs-width);
	height: var(--pagedjs-height);
}

.pagedjs_page.pagedjs_right_page {
	width: var(--pagedjs-width-right);
	height: var(--pagedjs-height-right);
}

.pagedjs_page.pagedjs_left_page {
	width: var(--pagedjs-width-left);
	height: var(--pagedjs-height-left);
}

.pagedjs_pages {
	counter-reset: pages var(--pagedjs-page-count) footnote var(--pagedjs-footnotes-count) footnote-marker var(--pagedjs-footnotes-count);
}

.pagedjs_pagebox .pagedjs_margin-top-left-corner,
.pagedjs_pagebox .pagedjs_margin-top-right-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-left-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-right-corner,
.pagedjs_pagebox .pagedjs_margin-top-left,
.pagedjs_pagebox .pagedjs_margin-top-right,
.pagedjs_pagebox .pagedjs_margin-bottom-left,
.pagedjs_pagebox .pagedjs_margin-bottom-right,
.pagedjs_pagebox .pagedjs_margin-top-center,
.pagedjs_pagebox .pagedjs_margin-bottom-center,
.pagedjs_pagebox .pagedjs_margin-top-center,
.pagedjs_pagebox .pagedjs_margin-bottom-center,
.pagedjs_margin-right-middle,
.pagedjs_margin-left-middle  {
	display: flex;
	align-items: center;
}

.pagedjs_margin-right-top,
.pagedjs_margin-left-top  {
	display: flex;
	align-items: flex-top;
}


.pagedjs_margin-right-bottom,
.pagedjs_margin-left-bottom  {
	display: flex;
	align-items: flex-end;
}



/*
.pagedjs_pagebox .pagedjs_margin-top-center,
.pagedjs_pagebox .pagedjs_margin-bottom-center {
	height: 100%;
	display: none;
	align-items: center;
	flex: 1 0 33%;
	margin: 0 auto;
}

.pagedjs_pagebox .pagedjs_margin-top-left-corner,
.pagedjs_pagebox .pagedjs_margin-top-right-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-right-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-left-corner {
	display: none;
	align-items: center;
}

.pagedjs_pagebox .pagedjs_margin-left-top,
.pagedjs_pagebox .pagedjs_margin-right-top {
	display: none;
	align-items: flex-start;
}

.pagedjs_pagebox .pagedjs_margin-right-middle,
.pagedjs_pagebox .pagedjs_margin-left-middle {
	display: none;
	align-items: center;
}

.pagedjs_pagebox .pagedjs_margin-left-bottom,
.pagedjs_pagebox .pagedjs_margin-right-bottom {
	display: none;
	align-items: flex-end;
}
*/

.pagedjs_pagebox .pagedjs_margin-top-left,
.pagedjs_pagebox .pagedjs_margin-top-right-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-left,
.pagedjs_pagebox .pagedjs_margin-bottom-right-corner { text-align: left; }

.pagedjs_pagebox .pagedjs_margin-top-left-corner,
.pagedjs_pagebox .pagedjs_margin-top-right,
.pagedjs_pagebox .pagedjs_margin-bottom-left-corner,
.pagedjs_pagebox .pagedjs_margin-bottom-right { text-align: right; }

.pagedjs_pagebox .pagedjs_margin-top-center,
.pagedjs_pagebox .pagedjs_margin-bottom-center,
.pagedjs_pagebox .pagedjs_margin-left-top,
.pagedjs_pagebox .pagedjs_margin-left-middle,
.pagedjs_pagebox .pagedjs_margin-left-bottom,
.pagedjs_pagebox .pagedjs_margin-right-top,
.pagedjs_pagebox .pagedjs_margin-right-middle,
.pagedjs_pagebox .pagedjs_margin-right-bottom { text-align: center; }

.pagedjs_pages .pagedjs_margin .pagedjs_margin-content {
	width: 100%;
}

.pagedjs_pages .pagedjs_margin-left .pagedjs_margin-content::after,
.pagedjs_pages .pagedjs_margin-top .pagedjs_margin-content::after,
.pagedjs_pages .pagedjs_margin-right .pagedjs_margin-content::after,
.pagedjs_pages .pagedjs_margin-bottom .pagedjs_margin-content::after {
	display: block;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-to] {
	margin-bottom: unset;
	padding-bottom: unset;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-from] {
	text-indent: unset;
	margin-top: unset;
	padding-top: unset;
	initial-letter: unset;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-from] > *::first-letter,
.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-from]::first-letter {
	color: unset;
	font-size: unset;
	font-weight: unset;
	font-family: unset;
	color: unset;
	line-height: unset;
	float: unset;
	padding: unset;
	margin: unset;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-to]:not([data-footnote-call]):after,
.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-to]:not([data-footnote-call])::after {
	content: unset;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-from]:not([data-footnote-call]):before,
.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div [data-split-from]:not([data-footnote-call])::before {
	content: unset;
}

.pagedjs_pages > .pagedjs_page > .pagedjs_sheet > .pagedjs_pagebox > .pagedjs_area > div li[data-split-from]:first-of-type {
	list-style: none;
}

/*
[data-page]:not([data-split-from]),
[data-break-before="page"]:not([data-split-from]),
[data-break-before="always"]:not([data-split-from]),
[data-break-before="left"]:not([data-split-from]),
[data-break-before="right"]:not([data-split-from]),
[data-break-before="recto"]:not([data-split-from]),
[data-break-before="verso"]:not([data-split-from])
{
	break-before: column;
}

[data-page]:not([data-split-to]),
[data-break-after="page"]:not([data-split-to]),
[data-break-after="always"]:not([data-split-to]),
[data-break-after="left"]:not([data-split-to]),
[data-break-after="right"]:not([data-split-to]),
[data-break-after="recto"]:not([data-split-to]),
[data-break-after="verso"]:not([data-split-to])
{
	break-after: column;
}
*/

.pagedjs_clear-after::after {
	content: none !important;
}

[data-align-last-split-element='justify'] {
	text-align-last: justify;
}


@media print {
	html {
		width: 100%;
		height: 100%;
		-webkit-print-color-adjust: exact;
		print-color-adjust: exact;
	}
	body {
		margin: 0;
		padding: 0;
		width: 100% !important;
		height: 100% !important;
		min-width: 100%;
		max-width: 100%;
		min-height: 100%;
		max-height: 100%;
	}
	.pagedjs_pages {
		width: auto;
		display: block !important;
		transform: none !important;
		height: 100% !important;
		min-height: 100%;
		max-height: 100%;
		overflow: visible;
	}
	.pagedjs_page {
		margin: 0;
		padding: 0;
		max-height: 100%;
		min-height: 100%;
		height: 100% !important;
		page-break-after: always;
		break-after: page;
	}
	.pagedjs_sheet {
		margin: 0;
		padding: 0;
		max-height: 100%;
		min-height: 100%;
		height: 100% !important;
	}
}
`;async function Ry(d,h={}){return new Promise(function(v,y){let T=new XMLHttpRequest;T.open(h.method||"get",d,!0);for(let n in h.headers)T.setRequestHeader(n,h.headers[n]);T.withCredentials=h.credentials==="include",T.onload=()=>{let n=T.status===0&&d.startsWith("file://")?200:T.status;v(new Response(T.responseText,{status:n}))},T.onerror=y,T.send(h.body||null)})}var Eb=class{constructor(h){this.sheets=[],this.inserted=[],this.hooks={},this.hooks.onUrl=new Gi(this),this.hooks.onAtPage=new Gi(this),this.hooks.onAtMedia=new Gi(this),this.hooks.onRule=new Gi(this),this.hooks.onDeclaration=new Gi(this),this.hooks.onContent=new Gi(this),this.hooks.onSelector=new Gi(this),this.hooks.onPseudoSelector=new Gi(this),this.hooks.onImport=new Gi(this),this.hooks.beforeTreeParse=new Gi(this),this.hooks.beforeTreeWalk=new Gi(this),this.hooks.afterTreeWalk=new Gi(this),h!==!1&&this.setup()}setup(){return this.base=this.insert(hz),this.styleEl=document.createElement("style"),document.head.appendChild(this.styleEl),this.styleSheet=this.styleEl.sheet,this.styleSheet}async add(){let h=[],v=[];for(var y=0;y<arguments.length;y++){let T;if(typeof arguments[y]=="object")for(let n in arguments[y]){let R=arguments[y];T=new Promise(function(j,Y){v.push(n),j(R[n])})}else v.push(arguments[y]),T=Ry(arguments[y]).then(n=>n.text());h.push(T)}return await Promise.all(h).then(async T=>{let n="";for(let R=0;R<T.length;R++)n=await this.convertViaSheet(T[R],v[R]),this.insert(n);return n})}async convertViaSheet(h,v){let y=new dz(v,this.hooks);await y.parse(h);for(let T of y.imported){let n=await Ry(T).then(j=>j.text()),R=await this.convertViaSheet(n,T);this.insert(R)}return this.sheets.push(y),typeof y.width<"u"&&(this.width=y.width),typeof y.height<"u"&&(this.height=y.height),typeof y.orientation<"u"&&(this.orientation=y.orientation),y.toString()}insert(h){let v=document.querySelector("head"),y=document.createElement("style");return y.setAttribute("data-pagedjs-inserted-styles","true"),y.appendChild(document.createTextNode(h)),v.appendChild(y),this.inserted.push(y),y}destroy(){this.styleEl.remove(),this.inserted.forEach(h=>{h.remove()}),this.sheets=[]}},Ab=Eb;var pO=Fn(Bu(),1);var pz=Fn(Bu(),1),Dy=class{constructor(h,v,y){let T=Object.assign({},h&&h.hooks,v&&v.hooks,y&&y.hooks);this.chunker=h,this.polisher=v,this.caller=y;for(let n in T)n in this&&T[n].register(this[n].bind(this))}};(0,pz.default)(Dy.prototype);var Nr=Dy;var Fi=Fn(fs(),1);var kb={A0:{width:{value:841,unit:"mm"},height:{value:1189,unit:"mm"}},A1:{width:{value:594,unit:"mm"},height:{value:841,unit:"mm"}},A2:{width:{value:420,unit:"mm"},height:{value:594,unit:"mm"}},A3:{width:{value:297,unit:"mm"},height:{value:420,unit:"mm"}},A4:{width:{value:210,unit:"mm"},height:{value:297,unit:"mm"}},A5:{width:{value:148,unit:"mm"},height:{value:210,unit:"mm"}},A6:{width:{value:105,unit:"mm"},height:{value:148,unit:"mm"}},A7:{width:{value:74,unit:"mm"},height:{value:105,unit:"mm"}},A8:{width:{value:52,unit:"mm"},height:{value:74,unit:"mm"}},A9:{width:{value:37,unit:"mm"},height:{value:52,unit:"mm"}},A10:{width:{value:26,unit:"mm"},height:{value:37,unit:"mm"}},B4:{width:{value:250,unit:"mm"},height:{value:353,unit:"mm"}},B5:{width:{value:176,unit:"mm"},height:{value:250,unit:"mm"}},letter:{width:{value:8.5,unit:"in"},height:{value:11,unit:"in"}},legal:{width:{value:8.5,unit:"in"},height:{value:14,unit:"in"}},ledger:{width:{value:11,unit:"in"},height:{value:17,unit:"in"}}};var Ib=class extends Nr{constructor(h,v,y){super(h,v,y),this.pages={},this.width=void 0,this.height=void 0,this.orientation=void 0,this.marginalia={}}pageModel(h){return{selector:h,name:void 0,psuedo:void 0,nth:void 0,marginalia:{},width:void 0,height:void 0,orientation:void 0,margin:{top:{},right:{},left:{},bottom:{}},padding:{top:{},right:{},left:{},bottom:{}},border:{top:{},right:{},left:{},bottom:{}},backgroundOrigin:void 0,block:{},marks:void 0,notes:void 0,added:!1}}onAtPage(h,v,y){let T,n,R="",j,Y,re,me=!1;h.prelude?(j=this.getTypeSelector(h),Y=this.getPsuedoSelector(h),re=this.getNthSelector(h),R=Fi.default.generate(h.prelude)):R="*",R in this.pages?(T=this.pages[R],n=this.replaceMarginalia(h),me=!0,T.added=!1):(T=this.pageModel(R),n=this.replaceMarginalia(h),this.pages[R]=T),T.name=j,T.psuedo=Y,T.nth=re,me?T.marginalia=Object.assign(T.marginalia,n):T.marginalia=n;let be=this.replaceNotes(h);T.notes=be;let oe=this.replaceDeclarations(h);if(oe.size&&(T.size=oe.size,T.width=oe.size.width,T.height=oe.size.height,T.orientation=oe.size.orientation,T.format=oe.size.format),oe.bleed&&oe.bleed[0]!="auto")switch(oe.bleed.length){case 4:T.bleed={top:oe.bleed[0],right:oe.bleed[1],bottom:oe.bleed[2],left:oe.bleed[3]};break;case 3:T.bleed={top:oe.bleed[0],right:oe.bleed[1],bottom:oe.bleed[2],left:oe.bleed[1]};break;case 2:T.bleed={top:oe.bleed[0],right:oe.bleed[1],bottom:oe.bleed[0],left:oe.bleed[1]};break;default:T.bleed={top:oe.bleed[0],right:oe.bleed[0],bottom:oe.bleed[0],left:oe.bleed[0]}}oe.marks&&((!oe.bleed||oe.bleed&&oe.bleed[0]==="auto")&&(T.bleed={top:{value:6,unit:"mm"},right:{value:6,unit:"mm"},bottom:{value:6,unit:"mm"},left:{value:6,unit:"mm"}}),T.marks=oe.marks),oe.margin&&(T.margin=oe.margin),oe.padding&&(T.padding=oe.padding),oe.border&&(T.border=oe.border),oe.marks&&(T.marks=oe.marks),me?T.block.children.appendList(h.block.children):T.block=h.block,y.remove(v)}afterTreeWalk(h,v){let y="*"in this.pages&&this.pages["*"].added===!1;if(this.addPageClasses(this.pages,h,v),y){let T=this.pages["*"].width,n=this.pages["*"].height,R=this.pages["*"].format,j=this.pages["*"].orientation,Y=this.pages["*"].bleed,re=this.pages["*"].marks,me,be;":left"in this.pages&&(me=this.pages[":left"].bleed),":right"in this.pages&&(be=this.pages[":right"].bleed),T&&n&&(this.width!==T||this.height!==n)&&(this.width=T,this.height=n,this.format=R,this.orientation=j,this.addRootVars(h,T,n,j,Y,be,me,re),this.addRootPage(h,this.pages["*"].size,Y,be,me),this.emit("size",{width:T,height:n,orientation:j,format:R,bleed:Y}),this.emit("atpages",this.pages))}}getTypeSelector(h){let v;return Fi.default.walk(h,{visit:"TypeSelector",enter:(y,T,n)=>{v=y.name}}),v}getPsuedoSelector(h){let v;return Fi.default.walk(h,{visit:"PseudoClassSelector",enter:(y,T,n)=>{y.name!=="nth"&&(v=y.name)}}),v}getNthSelector(h){let v;return Fi.default.walk(h,{visit:"PseudoClassSelector",enter:(y,T,n)=>{y.name==="nth"&&y.children&&(v=y.children.first().value)}}),v}replaceMarginalia(h){let v={},y=["top-left-corner","top-left","top","top-center","top-right","top-right-corner","bottom-left-corner","bottom-left","bottom","bottom-center","bottom-right","bottom-right-corner","left-top","left-middle","left","left-bottom","top-right-corner","right-top","right-middle","right","right-bottom","right-right-corner"];return Fi.default.walk(h.block,{visit:"Atrule",enter:(T,n,R)=>{let j=T.name;y.includes(j)&&(j==="top"&&(j="top-center"),j==="right"&&(j="right-middle"),j==="left"&&(j="left-middle"),j==="bottom"&&(j="bottom-center"),v[j]=T.block,R.remove(n))}}),v}replaceNotes(h){let v={};return Fi.default.walk(h.block,{visit:"Atrule",enter:(y,T,n)=>{let R=y.name;R==="footnote"&&(v[R]=y.block,n.remove(T))}}),v}replaceDeclarations(h){let v={};return Fi.default.walk(h.block,{visit:"Declaration",enter:(y,T,n)=>{let R=Fi.default.property(y.property).name;if(R==="marks")v.marks=[],Fi.default.walk(y,{visit:"Identifier",enter:j=>{v.marks.push(j.name)}}),n.remove(T);else if(R==="margin")v.margin=this.getMargins(y),n.remove(T);else if(R.indexOf("margin-")===0){let j=R.substring(7);v.margin||(v.margin={top:{},right:{},left:{},bottom:{}}),v.margin[j]=y.value.children.first(),n.remove(T)}else if(R==="padding")v.padding=this.getPaddings(y.value),n.remove(T);else if(R.indexOf("padding-")===0){let j=R.substring(8);v.padding||(v.padding={top:{},right:{},left:{},bottom:{}}),v.padding[j]=y.value.children.first(),n.remove(T)}else if(R==="border")v.border||(v.border={top:{},right:{},left:{},bottom:{}}),v.border.top=Fi.default.generate(y.value),v.border.right=Fi.default.generate(y.value),v.border.left=Fi.default.generate(y.value),v.border.bottom=Fi.default.generate(y.value),n.remove(T);else if(R.indexOf("border-")===0){v.border||(v.border={top:{},right:{},left:{},bottom:{}});let j=R.substring(7);v.border[j]=Fi.default.generate(y.value),n.remove(T)}else R==="size"?(v.size=this.getSize(y),n.remove(T)):R==="bleed"&&(v.bleed=[],Fi.default.walk(y,{enter:j=>{switch(j.type){case"String":j.value.indexOf("auto")>-1&&v.bleed.push("auto");break;case"Dimension":v.bleed.push({value:j.value,unit:j.unit});break;case"Number":v.bleed.push({value:j.value,unit:"px"});break;default:}}}),n.remove(T))}}),v}getSize(h){let v,y,T,n;return Fi.default.walk(h,{visit:"Dimension",enter:(R,j,Y)=>{let{value:re,unit:me}=R;typeof v>"u"?v={value:re,unit:me}:typeof y>"u"&&(y={value:re,unit:me})}}),Fi.default.walk(h,{visit:"String",enter:(R,j,Y)=>{let re=R.value.replace(/["|']/g,""),me=kb[re];me&&(v=me.width,y=me.height)}}),Fi.default.walk(h,{visit:"Identifier",enter:(R,j,Y)=>{let re=R.name;if(re==="landscape"||re==="portrait")T=R.name;else if(re!=="auto"){let me=kb[re];me&&(v=me.width,y=me.height),n=re}}}),{width:v,height:y,orientation:T,format:n}}getMargins(h){let v=[],y={top:{},right:{},left:{},bottom:{}};if(Fi.default.walk(h,{enter:T=>{switch(T.type){case"Dimension":v.push(T);break;case"Number":v.push({value:T.value,unit:"px"});break;default:}}}),v.length===1)for(let T in y)y[T]=v[0];else v.length===2?(y.top=v[0],y.right=v[1],y.bottom=v[0],y.left=v[1]):v.length===3?(y.top=v[0],y.right=v[1],y.bottom=v[2],y.left=v[1]):v.length===4&&(y.top=v[0],y.right=v[1],y.bottom=v[2],y.left=v[3]);return y}getPaddings(h){let v=[],y={top:{},right:{},left:{},bottom:{}};if(Fi.default.walk(h,{enter:T=>{switch(T.type){case"Dimension":v.push(T);break;case"Number":v.push({value:T.value,unit:"px"});break;default:}}}),v.length===1)for(let T in y)y[T]=v[0];else v.length===2?(y.top=v[0],y.right=v[1],y.bottom=v[0],y.left=v[1]):v.length===3?(y.top=v[0],y.right=v[1],y.bottom=v[2],y.left=v[1]):v.length===4&&(y.top=v[0],y.right=v[1],y.bottom=v[2],y.left=v[3]);return y}getBorders(h){let v={top:{},right:{},left:{},bottom:{}};return h.prop=="border"?(v.top=Fi.default.generate(h.value),v.right=Fi.default.generate(h.value),v.bottom=Fi.default.generate(h.value),v.left=Fi.default.generate(h.value)):h.prop=="border-top"?v.top=Fi.default.generate(h.value):h.prop=="border-right"?v.right=Fi.default.generate(h.value):h.prop=="border-bottom"?v.bottom=Fi.default.generate(h.value):h.prop=="border-left"&&(v.left=Fi.default.generate(h.value)),v}addPageClasses(h,v,y){if("*"in h&&h["*"].added===!1){let T=this.createPage(h["*"],v.children,y);y.insertRule(T),h["*"].added=!0}if(":left"in h&&h[":left"].added===!1){let T=this.createPage(h[":left"],v.children,y);y.insertRule(T),h[":left"].added=!0}if(":right"in h&&h[":right"].added===!1){let T=this.createPage(h[":right"],v.children,y);y.insertRule(T),h[":right"].added=!0}if(":first"in h&&h[":first"].added===!1){let T=this.createPage(h[":first"],v.children,y);y.insertRule(T),h[":first"].added=!0}if(":blank"in h&&h[":blank"].added===!1){let T=this.createPage(h[":blank"],v.children,y);y.insertRule(T),h[":blank"].added=!0}for(let T in h)if(h[T].nth&&h[T].added===!1){let n=this.createPage(h[T],v.children,y);y.insertRule(n),h[T].added=!0}for(let T in h)if(h[T].name&&h[T].added===!1){let n=this.createPage(h[T],v.children,y);y.insertRule(n),h[T].added=!0}}createPage(h,v,y){let T=this.selectorsForPage(h),n=h.block.children.copy(),R={type:"Block",loc:0,children:n},j=this.createRule(T,R);return this.addMarginVars(h.margin,n,n.first()),this.addPaddingVars(h.padding,n,n.first()),this.addBorderVars(h.border,n,n.first()),h.width&&this.addDimensions(h.width,h.height,h.orientation,n,n.first()),h.marginalia&&(this.addMarginaliaStyles(h,v,j,y),this.addMarginaliaContent(h,v,j,y)),h.notes&&this.addNotesStyles(h.notes,h,v,j,y),j}addMarginVars(h,v,y){for(let T in h)if(typeof h[T].value<"u"){let n=h[T].value+(h[T].unit||""),R=v.createItem({type:"Declaration",property:"--pagedjs-margin-"+T,value:{type:"Raw",value:n}});v.append(R,y)}}addPaddingVars(h,v,y){for(let T in h)if(typeof h[T].value<"u"){let n=h[T].value+(h[T].unit||""),R=v.createItem({type:"Declaration",property:"--pagedjs-padding-"+T,value:{type:"Raw",value:n}});v.append(R,y)}}addBorderVars(h,v,y){for(let T of Object.keys(h)){let n=h[T];if(typeof n=="string"){let R=v.createItem({type:"Declaration",property:"--pagedjs-border-"+T,value:{type:"Raw",value:n}});v.append(R,y)}}}addDimensions(h,v,y,T,n){let R,j;R=Oi(h),j=Oi(v),y&&y!=="portrait"&&([R,j]=[j,R]);let Y=this.createVariable("--pagedjs-pagebox-width",R);T.appendData(Y);let re=this.createVariable("--pagedjs-pagebox-height",j);T.appendData(re)}addMarginaliaStyles(h,v,y,T){for(let n in h.marginalia){let R=Fi.default.clone(h.marginalia[n]),j=!1;if(R.children.isEmpty())continue;Fi.default.walk(R,{visit:"Declaration",enter:(be,oe,Se)=>{if(be.property==="content"&&(be.value.children&&be.value.children.first().name==="none"?j=!1:j=!0,Se.remove(oe)),be.property==="vertical-align"&&(Fi.default.walk(be,{visit:"Identifier",enter:(Re,tt,yt)=>{let qe=Re.name;qe==="top"?Re.name="flex-start":qe==="middle"?Re.name="center":qe==="bottom"&&(Re.name="flex-end")}}),be.property="align-items"),be.property==="width"&&(n==="top-left"||n==="top-center"||n==="top-right"||n==="bottom-left"||n==="bottom-center"||n==="bottom-right")){let Re=Fi.default.clone(be);Re.property="max-width",Se.appendData(Re)}if(be.property==="height"&&(n==="left-top"||n==="left-middle"||n==="left-bottom"||n==="right-top"||n==="right-middle"||n==="right-bottom")){let Re=Fi.default.clone(be);Re.property="max-height",Se.appendData(Re)}}});let Y=this.selectorsForPageMargin(h,n),re=this.createRule(Y,R);v.appendData(re);let me=Fi.default.generate({type:"Selector",children:Y});this.marginalia[me]={page:h,selector:me,block:h.marginalia[n],hasContent:j}}}addMarginaliaContent(h,v,y,T){let n;for(let R in h.marginalia){let j=Fi.default.clone(h.marginalia[R]);if(Fi.default.walk(j,{visit:"Declaration",enter:(Se,Re,tt)=>{Se.property!=="content"&&tt.remove(Re),Se.value.children&&Se.value.children.first().name==="none"&&(n=!0)}}),j.children.isEmpty())continue;let Y=this.selectorsForPageMargin(h,R),re;Y.insertData({type:"Combinator",name:">"}),Y.insertData({type:"ClassSelector",name:"pagedjs_margin-content"}),Y.insertData({type:"Combinator",name:">"}),Y.insertData({type:"TypeSelector",name:"*"}),n?re=this.createDeclaration("display","none"):re=this.createDeclaration("display","block");let me=this.createRule(Y,[re]);T.insertRule(me);let be=this.selectorsForPageMargin(h,R);be.insertData({type:"Combinator",name:">"}),be.insertData({type:"ClassSelector",name:"pagedjs_margin-content"}),be.insertData({type:"PseudoElementSelector",name:"after",children:null});let oe=this.createRule(be,j);T.insertRule(oe)}}addRootVars(h,v,y,T,n,R,j,Y){let re=[],me=new Fi.default.List;me.insertData({type:"PseudoClassSelector",name:"root",children:null});let be,oe,Se,Re,tt,yt;if(!n)be=Oi(v),oe=Oi(y),Se=Oi(v),Re=Oi(y),tt=Oi(v),yt=Oi(y);else{be=`calc( ${Oi(v)} + ${Oi(n.left)} + ${Oi(n.right)} )`,oe=`calc( ${Oi(y)} + ${Oi(n.top)} + ${Oi(n.bottom)} )`,Se=`calc( ${Oi(v)} + ${Oi(n.left)} + ${Oi(n.right)} )`,Re=`calc( ${Oi(y)} + ${Oi(n.top)} + ${Oi(n.bottom)} )`,tt=`calc( ${Oi(v)} + ${Oi(n.left)} + ${Oi(n.right)} )`,yt=`calc( ${Oi(y)} + ${Oi(n.top)} + ${Oi(n.bottom)} )`;let Wt=this.createVariable("--pagedjs-bleed-top",Oi(n.top)),li=this.createVariable("--pagedjs-bleed-right",Oi(n.right)),Hi=this.createVariable("--pagedjs-bleed-bottom",Oi(n.bottom)),hi=this.createVariable("--pagedjs-bleed-left",Oi(n.left)),Di=this.createVariable("--pagedjs-bleed-right-top",Oi(n.top)),kr=this.createVariable("--pagedjs-bleed-right-right",Oi(n.right)),Si=this.createVariable("--pagedjs-bleed-right-bottom",Oi(n.bottom)),Ai=this.createVariable("--pagedjs-bleed-right-left",Oi(n.left)),oi=this.createVariable("--pagedjs-bleed-left-top",Oi(n.top)),mo=this.createVariable("--pagedjs-bleed-left-right",Oi(n.right)),Mi=this.createVariable("--pagedjs-bleed-left-bottom",Oi(n.bottom)),Dr=this.createVariable("--pagedjs-bleed-left-left",Oi(n.left));R&&(Di=this.createVariable("--pagedjs-bleed-right-top",Oi(R.top)),kr=this.createVariable("--pagedjs-bleed-right-right",Oi(R.right)),Si=this.createVariable("--pagedjs-bleed-right-bottom",Oi(R.bottom)),Ai=this.createVariable("--pagedjs-bleed-right-left",Oi(R.left)),Se=`calc( ${Oi(v)} + ${Oi(R.left)} + ${Oi(R.right)} )`,Re=`calc( ${Oi(y)} + ${Oi(R.top)} + ${Oi(R.bottom)} )`),j&&(oi=this.createVariable("--pagedjs-bleed-left-top",Oi(j.top)),mo=this.createVariable("--pagedjs-bleed-left-right",Oi(j.right)),Mi=this.createVariable("--pagedjs-bleed-left-bottom",Oi(j.bottom)),Dr=this.createVariable("--pagedjs-bleed-left-left",Oi(j.left)),tt=`calc( ${Oi(v)} + ${Oi(j.left)} + ${Oi(j.right)} )`,yt=`calc( ${Oi(y)} + ${Oi(j.top)} + ${Oi(j.bottom)} )`);let gn=this.createVariable("--pagedjs-width",Oi(v)),er=this.createVariable("--pagedjs-height",Oi(y));re.push(Wt,li,Hi,hi,Di,kr,Si,Ai,oi,mo,Mi,Dr,gn,er)}if(Y&&Y.forEach(Wt=>{let li=this.createVariable("--pagedjs-mark-"+Wt+"-display","block");re.push(li)}),T){let Wt=this.createVariable("--pagedjs-orientation",T);re.push(Wt),T!=="portrait"&&([be,oe]=[oe,be],[Se,Re]=[Re,Se],[tt,yt]=[yt,tt])}let qe=this.createVariable("--pagedjs-width",be),St=this.createVariable("--pagedjs-height",oe),ai=this.createVariable("--pagedjs-width-right",Se),pi=this.createVariable("--pagedjs-height-right",Re),Cr=this.createVariable("--pagedjs-width-left",tt),lr=this.createVariable("--pagedjs-height-left",yt);re.push(qe,St,ai,pi,Cr,lr);let bt=this.createRule(me,re);h.children.appendData(bt)}addNotesStyles(h,v,y,T,n){for(let R in h){let j=this.selectorsForPage(v);j.insertData({type:"Combinator",name:" "}),j.insertData({type:"ClassSelector",name:"pagedjs_"+R+"_content"});let Y=this.createRule(j,h[R]);y.appendData(Y)}}addRootPage(h,v,y,T,n){let{width:R,height:j,orientation:Y,format:re}=v,me=new Fi.default.List,be=new Fi.default.List,oe=new Fi.default.List,Se=new Fi.default.List,Re=new Fi.default.List,tt=new Fi.default.List;if(y){let qe=new Fi.default.List,St=new Fi.default.List;qe.appendData({type:"Dimension",unit:R.unit,value:R.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:y.left.unit,value:y.left.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:y.right.unit,value:y.right.value}),St.appendData({type:"Dimension",unit:j.unit,value:j.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:y.top.unit,value:y.top.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:y.bottom.unit,value:y.bottom.value}),Se.appendData({type:"Function",name:"calc",children:qe}),Se.appendData({type:"WhiteSpace",value:" "}),Se.appendData({type:"Function",name:"calc",children:St})}else re?(Se.appendData({type:"Identifier",name:re}),Y&&(Se.appendData({type:"WhiteSpace",value:" "}),Se.appendData({type:"Identifier",name:Y}))):(Se.appendData({type:"Dimension",unit:R.unit,value:R.value}),Se.appendData({type:"WhiteSpace",value:" "}),Se.appendData({type:"Dimension",unit:j.unit,value:j.value}));me.appendData({type:"Declaration",property:"size",loc:null,value:{type:"Value",children:Se}}),me.appendData({type:"Declaration",property:"margin",loc:null,value:{type:"Value",children:[{type:"Dimension",unit:"px",value:0}]}}),me.appendData({type:"Declaration",property:"padding",loc:null,value:{type:"Value",children:[{type:"Dimension",unit:"px",value:0}]}}),me.appendData({type:"Declaration",property:"padding",loc:null,value:{type:"Value",children:[{type:"Dimension",unit:"px",value:0}]}});let yt=h.children.createItem({type:"Atrule",prelude:null,name:"page",block:{type:"Block",loc:null,children:me}});if(h.children.append(yt),n){let qe=new Fi.default.List,St=new Fi.default.List;qe.appendData({type:"Dimension",unit:R.unit,value:R.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:n.left.unit,value:n.left.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:n.right.unit,value:n.right.value}),St.appendData({type:"Dimension",unit:j.unit,value:j.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:n.top.unit,value:n.top.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:n.bottom.unit,value:n.bottom.value}),Re.appendData({type:"Function",name:"calc",children:qe}),Re.appendData({type:"WhiteSpace",value:" "}),Re.appendData({type:"Function",name:"calc",children:St}),be.appendData({type:"Declaration",property:"size",loc:null,value:{type:"Value",children:Re}});let ai=h.children.createItem({type:"Atrule",prelude:null,name:"page :left",block:{type:"Block",loc:null,children:be}});h.children.append(ai)}if(T){let qe=new Fi.default.List,St=new Fi.default.List;qe.appendData({type:"Dimension",unit:R.unit,value:R.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:T.left.unit,value:T.left.value}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Operator",value:"+"}),qe.appendData({type:"WhiteSpace",value:" "}),qe.appendData({type:"Dimension",unit:T.right.unit,value:T.right.value}),St.appendData({type:"Dimension",unit:j.unit,value:j.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:T.top.unit,value:T.top.value}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Operator",value:"+"}),St.appendData({type:"WhiteSpace",value:" "}),St.appendData({type:"Dimension",unit:T.bottom.unit,value:T.bottom.value}),tt.appendData({type:"Function",name:"calc",children:qe}),tt.appendData({type:"WhiteSpace",value:" "}),tt.appendData({type:"Function",name:"calc",children:St}),oe.appendData({type:"Declaration",property:"size",loc:null,value:{type:"Value",children:tt}});let ai=h.children.createItem({type:"Atrule",prelude:null,name:"page :right",block:{type:"Block",loc:null,children:oe}});h.children.append(ai)}}getNth(h){let v=h.indexOf("n"),y=h.indexOf("+"),T=h.split("n"),n=h.split("+"),R=null,j=null;return v>-1?(R=T[0],y>-1&&(j=n[1])):j=h,{type:"Nth",loc:null,selector:null,nth:{type:"AnPlusB",loc:null,a:R,b:j}}}addPageAttributes(h,v,y){let T=[v.dataset.page];if(T&&T.length)for(let n of T)n&&(h.name=n,h.element.classList.add("pagedjs_named_page"),h.element.classList.add("pagedjs_"+n+"_page"),v.dataset.splitFrom||h.element.classList.add("pagedjs_"+n+"_first_page"))}getStartElement(h,v){let y=v&&v.node;if(!h&&!v)return;if(!y)return h.children[0];if(y.nodeType===1&&y.parentNode.nodeType===11||y.nodeType===1&&y.dataset.page)return y;let T=P_(y),n=T.querySelectorAll("[data-page]");return n.length?n[n.length-1]:T.children[0]}beforePageLayout(h,v,y,T){let n=this.getStartElement(v,y);n&&this.addPageAttributes(h,n,T.pages)}finalizePage(h,v,y,T){for(let n in this.marginalia){let R=this.marginalia[n],j=n.split(" "),Y;v.element.matches(j[0])&&R.hasContent&&(Y=v.element.querySelector(j[1]),Y.classList.add("hasContent"))}["top","bottom"].forEach(n=>{let R=v.element.querySelector(".pagedjs_margin-"+n),j=v.element.querySelector(".pagedjs_margin-"+n+"-center"),Y=v.element.querySelector(".pagedjs_margin-"+n+"-left"),re=v.element.querySelector(".pagedjs_margin-"+n+"-right"),me=j.classList.contains("hasContent"),be=Y.classList.contains("hasContent"),oe=re.classList.contains("hasContent"),Se,Re,tt;if(be&&(Re=window.getComputedStyle(Y)["max-width"]),oe&&(tt=window.getComputedStyle(re)["max-width"]),me)if(Se=window.getComputedStyle(j)["max-width"],Se==="none"||Se==="auto")if(!be&&!oe)R.style["grid-template-columns"]="0 1fr 0";else if(be)if(oe)if(Re!=="none"&&Re!=="auto")tt!=="none"&&tt!=="auto"?R.style["grid-template-columns"]=Re+" 1fr "+tt:R.style["grid-template-columns"]=Re+" 1fr "+Re;else if(tt!=="none"&&tt!=="auto")R.style["grid-template-columns"]=tt+" 1fr "+tt;else{R.style["grid-template-columns"]="auto auto 1fr",Y.style["white-space"]="nowrap",j.style["white-space"]="nowrap",re.style["white-space"]="nowrap";let yt=Y.offsetWidth,qe=j.offsetWidth,St=re.offsetWidth,ai=yt+qe+St,pi=qe*100/ai;pi>40?R.style["grid-template-columns"]="minmax(16.66%, 1fr) minmax(33%, "+pi+"%) minmax(16.66%, 1fr)":R.style["grid-template-columns"]="repeat(3, 1fr)",Y.style["white-space"]="normal",j.style["white-space"]="normal",re.style["white-space"]="normal"}else if(Re!=="none"&&Re!=="auto")R.style["grid-template-columns"]=Re+" 1fr "+Re;else{R.style["grid-template-columns"]="auto auto 1fr",Y.style["white-space"]="nowrap",j.style["white-space"]="nowrap";let yt=Y.offsetWidth,qe=j.offsetWidth,St=yt+qe,ai=qe*100/St;R.style["grid-template-columns"]="minmax(16.66%, 1fr) minmax(33%, "+ai+"%) minmax(16.66%, 1fr)",Y.style["white-space"]="normal",j.style["white-space"]="normal"}else if(tt!=="none"&&tt!=="auto")R.style["grid-template-columns"]=tt+" 1fr "+tt;else{R.style["grid-template-columns"]="auto auto 1fr",re.style["white-space"]="nowrap",j.style["white-space"]="nowrap";let yt=re.offsetWidth,qe=j.offsetWidth,St=yt+qe,ai=qe*100/St;R.style["grid-template-columns"]="minmax(16.66%, 1fr) minmax(33%, "+ai+"%) minmax(16.66%, 1fr)",re.style["white-space"]="normal",j.style["white-space"]="normal"}else Se!=="none"&&Se!=="auto"&&(be&&Re!=="none"&&Re!=="auto"?R.style["grid-template-columns"]=Re+" "+Se+" 1fr":oe&&tt!=="none"&&tt!=="auto"?R.style["grid-template-columns"]="1fr "+Se+" "+tt:R.style["grid-template-columns"]="1fr "+Se+" 1fr");else if(be)if(!oe)R.style["grid-template-columns"]="1fr 0 0";else if(Re!=="none"&&Re!=="auto")tt!=="none"&&tt!=="auto"?R.style["grid-template-columns"]=Re+" 1fr "+tt:R.style["grid-template-columns"]=Re+" 0 1fr";else if(tt!=="none"&&tt!=="auto")R.style["grid-template-columns"]="1fr 0 "+tt;else{R.style["grid-template-columns"]="auto 1fr auto",Y.style["white-space"]="nowrap",re.style["white-space"]="nowrap";let yt=Y.offsetWidth,qe=re.offsetWidth,St=yt+qe,ai=yt*100/St;R.style["grid-template-columns"]="minmax(16.66%, "+ai+"%) 0 1fr",Y.style["white-space"]="normal",re.style["white-space"]="normal"}else tt!=="none"&&tt!=="auto"?R.style["grid-template-columns"]="1fr 0 "+tt:R.style["grid-template-columns"]="0 0 1fr"}),["left","right"].forEach(n=>{let R=v.element.querySelector(".pagedjs_margin-"+n+"-middle.hasContent"),j=v.element.querySelector(".pagedjs_margin-"+n),Y=v.element.querySelector(".pagedjs_margin-"+n+"-top"),re=v.element.querySelector(".pagedjs_margin-"+n+"-bottom"),me=Y.classList.contains("hasContent"),be=re.classList.contains("hasContent"),oe,Se,Re;me&&(Se=window.getComputedStyle(Y)["max-height"]),be&&(Re=window.getComputedStyle(re)["max-height"]),R?(oe=window.getComputedStyle(R)["max-height"],oe==="none"||oe==="auto"?!me&&!be?j.style["grid-template-rows"]="0 1fr 0":me?be?Se!=="none"&&Se!=="auto"?Re!=="none"&&Re!=="auto"?j.style["grid-template-rows"]=Se+" calc(100% - "+Se+" - "+Re+") "+Re:j.style["grid-template-rows"]=Se+" calc(100% - "+Se+"*2) "+Se:Re!=="none"&&Re!=="auto"&&(j.style["grid-template-rows"]=Re+" calc(100% - "+Re+"*2) "+Re):Se!=="none"&&Se!=="auto"&&(j.style["grid-template-rows"]=Se+" calc(100% - "+Se+"*2) "+Se):Re!=="none"&&Re!=="auto"&&(j.style["grid-template-rows"]=Re+" calc(100% - "+Re+"*2) "+Re):me&&Se!=="none"&&Se!=="auto"?j.style["grid-template-rows"]=Se+" "+oe+" calc(100% - ("+Se+" + "+oe+"))":be&&Re!=="none"&&Re!=="auto"?j.style["grid-template-rows"]="1fr "+oe+" "+Re:j.style["grid-template-rows"]="calc((100% - "+oe+")/2) "+oe+" calc((100% - "+oe+")/2)"):me?be?Se!=="none"&&Se!=="auto"?Re!=="none"&&Re!=="auto"?j.style["grid-template-rows"]=Se+" 1fr "+Re:j.style["grid-template-rows"]=Se+" 0 1fr":Re!=="none"&&Re!=="auto"?j.style["grid-template-rows"]="1fr 0 "+Re:j.style["grid-template-rows"]="1fr 0 1fr":j.style["grid-template-rows"]="1fr 0 0":Re!=="none"&&Re!=="auto"?j.style["grid-template-rows"]="1fr 0 "+Re:j.style["grid-template-rows"]="0 0 1fr"})}selectorsForPage(h){let v,y,T=new Fi.default.List;return T.insertData({type:"ClassSelector",name:"pagedjs_page"}),h.name&&(T.insertData({type:"ClassSelector",name:"pagedjs_named_page"}),T.insertData({type:"ClassSelector",name:"pagedjs_"+h.name+"_page"})),h.psuedo&&!(h.name&&h.psuedo==="first")&&T.insertData({type:"ClassSelector",name:"pagedjs_"+h.psuedo+"_page"}),h.name&&h.psuedo==="first"&&T.insertData({type:"ClassSelector",name:"pagedjs_"+h.name+"_"+h.psuedo+"_page"}),h.nth&&(v=new Fi.default.List,y=this.getNth(h.nth),v.insertData(y),T.insertData({type:"PseudoClassSelector",name:"nth-of-type",children:v})),T}selectorsForPageMargin(h,v){let y=this.selectorsForPage(h);return y.insertData({type:"Combinator",name:" "}),y.insertData({type:"ClassSelector",name:"pagedjs_margin-"+v}),y}createDeclaration(h,v,y){let T=new Fi.default.List;return T.insertData({type:"Identifier",loc:null,name:v}),{type:"Declaration",loc:null,important:y,property:h,value:{type:"Value",loc:null,children:T}}}createVariable(h,v){return{type:"Declaration",loc:null,property:h,value:{type:"Raw",value:v}}}createCalculatedDimension(h,v,y,T="+"){let n=new Fi.default.List,R=new Fi.default.List;return v.forEach((j,Y)=>{R.appendData({type:"Dimension",unit:j.unit,value:j.value}),R.appendData({type:"WhiteSpace",value:" "}),Y+1<v.length&&(R.appendData({type:"Operator",value:T}),R.appendData({type:"WhiteSpace",value:" "}))}),n.insertData({type:"Function",loc:null,name:"calc",children:R}),{type:"Declaration",loc:null,important:y,property:h,value:{type:"Value",loc:null,children:n}}}createDimension(h,v,y){let T=new Fi.default.List;return T.insertData({type:"Dimension",loc:null,value:v.value,unit:v.unit}),{type:"Declaration",loc:null,important:y,property:h,value:{type:"Value",loc:null,children:T}}}createBlock(h){let v=new Fi.default.List;return h.forEach(y=>{v.insertData(y)}),{type:"Block",loc:null,children:v}}createRule(h,v){let y=new Fi.default.List;return y.insertData({type:"Selector",children:h}),Array.isArray(v)&&(v=this.createBlock(v)),{type:"Rule",prelude:{type:"SelectorList",children:y},block:v}}},fz=Ib;var Pb=Fn(fs(),1);var Lb=class extends Nr{constructor(h,v,y){super(h,v,y),this.breaks={}}onDeclaration(h,v,y,T){let n=h.property;if(n==="page"){let j=h.value.children.first().name,Y=Pb.default.generate(T.ruleNode.prelude),me={property:n,value:j,selector:Y,name:j};Y.split(",").forEach(be=>{this.breaks[be]?this.breaks[be].push(me):this.breaks[be]=[me]}),y.remove(v)}if(n==="break-before"||n==="break-after"||n==="page-break-before"||n==="page-break-after"){let j=h.value.children.first().name,Y=Pb.default.generate(T.ruleNode.prelude);n==="page-break-before"?n="break-before":n==="page-break-after"&&(n="break-after");let re={property:n,value:j,selector:Y};Y.split(",").forEach(me=>{this.breaks[me]?this.breaks[me].push(re):this.breaks[me]=[re]}),y.remove(v)}}afterParsed(h){this.processBreaks(h,this.breaks)}processBreaks(h,v){for(let T in v){let n=h.querySelectorAll(T);for(var y=0;y<n.length;y++)for(let R of v[T])if(R.property==="break-after"){let j=Dx(n[y],h);n[y].setAttribute("data-break-after",R.value),j&&j.setAttribute("data-previous-break-after",R.value)}else if(R.property==="break-before"){let j=x2(n[y],h);if(j){if(R.value==="page"&&z_(n[y],j))continue;n[y].setAttribute("data-break-before",R.value),j.setAttribute("data-next-break-before",R.value)}}else if(R.property==="page"){n[y].setAttribute("data-page",R.value);let j=Dx(n[y],h);j&&j.setAttribute("data-after-page",R.value)}else n[y].setAttribute("data-"+R.property,R.value)}}mergeBreaks(h,v){for(let y in v)y in h?h[y]=h[y].concat(v[y]):h[y]=v[y];return h}addBreakAttributes(h,v){let y=h.querySelector("[data-break-before]"),T=h.querySelector("[data-break-after]"),n=h.querySelector("[data-previous-break-after]");y&&(y.dataset.splitFrom?(v.splitFrom=y.dataset.splitFrom,h.setAttribute("data-split-from",y.dataset.splitFrom)):y.dataset.breakBefore&&y.dataset.breakBefore!=="avoid"&&(v.breakBefore=y.dataset.breakBefore,h.setAttribute("data-break-before",y.dataset.breakBefore))),T&&T.dataset&&(T.dataset.splitTo?(v.splitTo=T.dataset.splitTo,h.setAttribute("data-split-to",T.dataset.splitTo)):T.dataset.breakAfter&&T.dataset.breakAfter!=="avoid"&&(v.breakAfter=T.dataset.breakAfter,h.setAttribute("data-break-after",T.dataset.breakAfter))),n&&n.dataset&&n.dataset.previousBreakAfter&&n.dataset.previousBreakAfter!=="avoid"&&(v.previousBreakAfter=n.dataset.previousBreakAfter)}afterPageLayout(h,v){this.addBreakAttributes(h,v)}},mz=Lb;var gz=Fn(fs(),1),zb=class extends Nr{constructor(h,v,y){super(h,v,y)}onAtMedia(h,v,y){let T=this.getMediaName(h),n;T.includes("print")?(n=h.block.children,y.appendList(n),y.remove(v)):!T.includes("all")&&!T.includes("pagedjs-ignore")&&y.remove(v)}getMediaName(h){let v=[];if(!(typeof h.prelude>"u"||h.prelude.type!=="AtrulePrelude"))return gz.default.walk(h.prelude,{visit:"Identifier",enter:(y,T,n)=>{v.push(y.name)}}),v}},_z=zb;var Mb=class extends Nr{constructor(h,v,y){super(h,v,y)}afterPageLayout(h,v,y,T){let n=Array.from(h.querySelectorAll("[data-split-from]")),R=h.parentNode,j=Array.prototype.indexOf.call(R.children,h),Y;if(j===0)return;Y=R.children[j-1];let re;n.forEach(me=>{let be=me.dataset.ref;re=Y.querySelector("[data-ref='"+be+"']:not([data-split-to])"),re&&(re.dataset.splitTo=be,re.dataset.splitFrom||(re.dataset.splitOriginal=!0))}),re&&this.handleAlignment(re)}handleAlignment(h){let v=window.getComputedStyle(h),y=v["text-align"],T=v["text-align-last"];h.dataset.lastSplitElement="true",y==="justify"&&T==="auto"?h.dataset.alignLastSplitElement="justify":h.dataset.alignLastSplitElement=T}},yz=Mb;var By=Fn(fs(),1),Ob=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.counters={},this.resetCountersMap=new Map}onDeclaration(h,v,y,T){let n=h.property;if(n==="counter-increment"){this.handleIncrement(h,T);let R=!1;h.value.children.forEach(j=>{j.type&&j.type!=="WhiteSpace"&&(R=!0)}),R||y.remove(v)}else if(n==="counter-reset"){this.handleReset(h,T);let R=!1;h.value.children.forEach(j=>{j.type&&j.type!=="WhiteSpace"&&(R=!0)}),R||y.remove(v)}}afterParsed(h){this.processCounters(h,this.counters),this.scopeCounters(this.counters)}addCounter(h){return h in this.counters?this.counters[h]:(this.counters[h]={name:h,increments:{},resets:{}},this.counters[h])}handleIncrement(h,v){let y=[],T=h.value.children;return T.forEach((n,R)=>{if(n.type&&n.type==="Identifier"){let j=n.name;if(j==="page"||j.indexOf("target-counter-")===0)return;let Y,re,me;R.next&&R.next.data.type==="WhiteSpace"&&(Y=R.next),Y&&Y.next&&Y.next.data.type==="Number"&&(re=Y.next,me=parseInt(re.data.value));let be=By.default.generate(v.ruleNode.prelude),oe;j in this.counters?oe=this.counters[j]:oe=this.addCounter(j);let Se={selector:be,number:me||1};oe.increments[be]=Se,y.push(Se),T.remove(R),Y&&T.remove(Y),re&&T.remove(re)}}),y}handleReset(h,v){let y=h.value.children;y.forEach((T,n)=>{if(T.type&&T.type==="Identifier"){let R=T.name,j,Y,re;n.next&&n.next.data.type==="WhiteSpace"&&(j=n.next),j&&j.next&&(j.next.data.type==="Number"?(Y=j.next,re=parseInt(Y.data.value)):j.next.data.type==="Function"&&j.next.data.name==="var"&&(Y=j.next,re=j.next.data.children.head.data.name));let me,be,oe=v.ruleNode.prelude;v.ruleNode.type==="Atrule"&&v.ruleNode.name==="page"?be=".pagedjs_page":be=By.default.generate(oe||v.ruleNode),R==="footnote"&&this.addFootnoteMarkerCounter(h.value.children),R in this.counters?me=this.counters[R]:me=this.addCounter(R);let Se={selector:be,number:re||0};me.resets[be]=Se,be!==".pagedjs_page"&&(y.remove(n),j&&y.remove(j),Y&&y.remove(Y))}})}processCounters(h,v){let y;for(let T in v)y=this.counters[T],this.processCounterIncrements(h,y),this.processCounterResets(h,y),T!=="page"&&this.addCounterValues(h,y)}scopeCounters(h){let v=[];for(let y in h)y!=="page"&&v.push(`${h[y].name} 0`);this.insertRule(`.pagedjs_pages { counter-reset: ${v.join(" ")} page 0 pages var(--pagedjs-page-count) footnote var(--pagedjs-footnotes-count) footnote-marker var(--pagedjs-footnotes-count)}`)}insertRule(h){this.styleSheet.insertRule(h,this.styleSheet.cssRules.length)}processCounterIncrements(h,v){let y;for(let T in v.increments){y=v.increments[T];let n=h.querySelectorAll(y.selector);for(let R=0;R<n.length;R++)n[R].setAttribute("data-counter-"+v.name+"-increment",y.number),n[R].getAttribute("data-counter-increment")?n[R].setAttribute("data-counter-increment",n[R].getAttribute("data-counter-increment")+" "+v.name):n[R].setAttribute("data-counter-increment",v.name)}}processCounterResets(h,v){let y;for(let n in v.resets){y=v.resets[n];let R=h.querySelectorAll(y.selector);for(var T=0;T<R.length;T++){let j=y.number;typeof j=="string"&&j.startsWith("--")&&(j=R[T].style.getPropertyValue(j)||0),R[T].setAttribute("data-counter-"+v.name+"-reset",j),R[T].getAttribute("data-counter-reset")?R[T].setAttribute("data-counter-reset",R[T].getAttribute("data-counter-reset")+" "+v.name):R[T].setAttribute("data-counter-reset",v.name)}}}addCounterValues(h,v){let y=v.name;if(y==="page"||y==="footnote")return;let T=h.querySelectorAll("[data-counter-"+y+"-reset], [data-counter-"+y+"-increment]"),n=0,R,j,Y,re,me,be,oe;for(let Se=0;Se<T.length;Se++)R=T[Se],be=0,oe=[],R.hasAttribute("data-counter-"+y+"-reset")&&(Y=R.getAttribute("data-counter-"+y+"-reset"),re=parseInt(Y),be=re-n,oe.push(`${y} ${be}`),n=re),R.hasAttribute("data-counter-"+y+"-increment")&&(j=R.getAttribute("data-counter-"+y+"-increment"),me=parseInt(j),n+=me,R.setAttribute("data-counter-"+y+"-value",n),oe.push(`${y} ${me}`)),oe.length>0&&this.incrementCounterForElement(R,oe)}addFootnoteMarkerCounter(h){let v=[];By.default.walk(h,{visit:"Identifier",enter:(y,T,n)=>{v.push(y.name)}}),!v.includes("footnote-maker")&&(h.insertData({type:"WhiteSpace",value:" "}),h.insertData({type:"Identifier",name:"footnote-marker"}),h.insertData({type:"WhiteSpace",value:" "}),h.insertData({type:"Number",value:0}))}incrementCounterForElement(h,v){if(!h||!v||v.length===0)return;let y=h.dataset.ref,T=Array.from(this.styleSheet.cssRules).filter(R=>R.selectorText===`[data-ref="${h.dataset.ref}"]:not([data-split-from])`&&R.style[0]==="counter-increment").map(R=>R.style.counterIncrement);T.push(this.mergeIncrements(v,(R,j)=>(parseInt(R)||0)+(parseInt(j)||0)));let n=this.mergeIncrements(T,(R,j)=>j);this.insertRule(`[data-ref="${y}"]:not([data-split-from]) { counter-increment: ${n} }`)}mergeIncrements(h,v){let y={};return h.forEach(T=>{let n=T.split(" ");for(let R=0;R<n.length;R+=2)y[n[R]]=v(y[n[R]],n[R+1])}),Object.entries(y).map(([T,n])=>`${T} ${n}`).join(" ")}afterPageLayout(h,v){let y=[];h.querySelectorAll("[data-counter-page-reset]:not([data-split-from])").forEach(R=>{let j=R.dataset&&R.dataset.ref;if(!(j&&this.resetCountersMap.has(j))){j&&this.resetCountersMap.set(j,"");let Y=R.dataset.counterPageReset;y.push(`page ${Y}`)}}),h.querySelectorAll("[data-counter-footnote-reset]:not([data-split-from])").forEach(R=>{let j=R.dataset.counterFootnoteReset;y.push(`footnote ${j}`),y.push(`footnote-marker ${j}`)}),y.length&&this.styleSheet.insertRule(`[data-page-number="${h.dataset.pageNumber}"] { counter-increment: none; counter-reset: ${y.join(" ")} }`,this.styleSheet.cssRules.length)}},vz=Ob;var Rb=class extends Nr{constructor(h,v,y){super(h,v,y)}afterParsed(h){let v=h.querySelectorAll("ol");for(var y of v)this.addDataNumbers(y)}afterPageLayout(h,v,y,T){var n=h.getElementsByTagName("ol");for(var R of n)R.firstElementChild&&(R.start=R.firstElementChild.dataset.itemNum)}addDataNumbers(h){let v=1;h.hasAttribute("start")&&(v=parseInt(h.getAttribute("start"),10),isNaN(v)&&(v=1));let y=h.children;for(var T=0;T<y.length;T++)y[T].setAttribute("data-item-num",T+v)}},xz=Rb;var bz=Fn(fs(),1),Db=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.fixedElementsSelector=[],this.fixedElements=[]}onDeclaration(h,v,y,T){if(h.property==="position"&&h.value.children.first().name==="fixed"){let n=bz.default.generate(T.ruleNode.prelude);this.fixedElementsSelector.push(n),y.remove(v)}}afterParsed(h){this.fixedElementsSelector.forEach(v=>{h.querySelectorAll(`${v}`).forEach(y=>{y.style.setProperty("position","absolute"),this.fixedElements.push(y),y.remove()})})}afterPageLayout(h,v,y){this.fixedElements.forEach(T=>{let n=T.cloneNode(!0);h.querySelector(".pagedjs_pagebox").insertAdjacentElement("afterbegin",n)})}},wz=Db;var Sz=Fn(fs(),1),Bb=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.pageCounter={name:"page",increments:{},resets:{}}}onDeclaration(h,v,y,T){h.property==="counter-increment"&&this.handleIncrement(h,T)&&y.remove(v)}afterParsed(h){for(let v in this.pageCounter.increments){let y=this.pageCounter.increments[v];this.insertRule(`${y.selector} { --pagedjs-page-counter-increment: ${y.number} }`)}}handleIncrement(h,v){let y=h.value.children.first(),T=h.value.children.getSize()>1?h.value.children.last().value:1,n=y&&y.name;if(n&&n.indexOf("target-counter-")===0||n!=="page"||v.ruleNode.name==="page"&&v.ruleNode.type==="Atrule")return;let R=Sz.default.generate(v.ruleNode.prelude);return this.pageCounter.increments[R]={selector:R,number:T}}insertRule(h){this.styleSheet.insertRule(h,this.styleSheet.cssRules.length)}},Tz=Bb;var Fb=Fn(fs(),1);var Nb=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.selectors={}}onRule(h,v,y){let T=Fb.default.generate(h.prelude);if(T.match(/:(first|last|nth)-of-type/)){let n=Fb.default.generate(h.block);n=n.replace(/[{}]/g,"");let R="nth-of-type-"+Ns();T.split(",").forEach(j=>{this.selectors[j]?this.selectors[j][1]=`${this.selectors[j][1]};${n}`:this.selectors[j]=[R,n]}),y.remove(v)}}afterParsed(h){this.processSelectors(h,this.selectors)}processSelectors(h,v){for(let T in v){let n=h.querySelectorAll(T);for(var y=0;y<n.length;y++){let j=n[y].getAttribute("data-nth-of-type");j&&j!=""?(j=`${j},${v[T][0]}`,n[y].setAttribute("data-nth-of-type",j)):n[y].setAttribute("data-nth-of-type",v[T][0])}let R=`*[data-nth-of-type*='${v[T][0]}'] { ${v[T][1]}; }`;this.styleSheet.insertRule(R,this.styleSheet.cssRules.length)}}},Cz=Nb;var jb=Fn(fs(),1);var Vb=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.selectors={}}onRule(h,v,y){let T=jb.default.generate(h.prelude);if(T.match(/\+/)){let n=jb.default.generate(h.block);n=n.replace(/[{}]/g,"");let R="following-"+Ns();T.split(",").forEach(j=>{this.selectors[j]?this.selectors[j][1]=`${this.selectors[j][1]};${n}`:this.selectors[j]=[R,n]}),y.remove(v)}}afterParsed(h){this.processSelectors(h,this.selectors)}processSelectors(h,v){for(let T in v){let n=h.querySelectorAll(T);for(var y=0;y<n.length;y++){let j=n[y].getAttribute("data-following");j&&j!=""?(j=`${j},${v[T][0]}`,n[y].setAttribute("data-following",j)):n[y].setAttribute("data-following",v[T][0])}let R=`*[data-following*='${v[T][0]}'] { ${v[T][1]}; }`;this.styleSheet.insertRule(R,this.styleSheet.cssRules.length)}}},Ez=Vb;var Tp=Fn(fs(),1),Ub=class extends Nr{constructor(h,v,y){super(h,v,y),this.footnotes={},this.needsLayout=[]}onDeclaration(h,v,y,T){let n=h.property;if(n==="float"){let R=h.value.children&&h.value.children.first();if((R&&R.name)==="footnote"){let Y=Tp.default.generate(T.ruleNode.prelude);this.footnotes[Y]={selector:Y,policy:"auto",display:"block"},y.remove(v)}}if(n==="footnote-policy"){let R=h.value.children&&h.value.children.first(),j=R&&R.name;if(j){let Y=Tp.default.generate(T.ruleNode.prelude),re=this.footnotes[Y];re&&(re.policy=j)}}if(n==="footnote-display"){let R=h.value.children&&h.value.children.first(),j=R&&R.name,Y=Tp.default.generate(T.ruleNode.prelude);if(j&&this.footnotes[Y]){let re=this.footnotes[Y];re&&(re.display=j)}}}onPseudoSelector(h,v,y,T,n){let R=h.name;if(R==="footnote-marker"){let j=n.ruleNode.prelude,Y=new Tp.default.List;j.children.first().children.each(re=>{re.type!=="PseudoElementSelector"&&Y.appendData(re)}),Y.appendData({type:"AttributeSelector",name:{type:"Identifier",name:"data-footnote-marker"},flags:null,loc:null,matcher:null,value:null}),Y.appendData({type:"PseudoElementSelector",name:"marker",loc:null,children:null}),j.children.first().children=Y}if(R==="footnote-call"){let j=n.ruleNode.prelude,Y=new Tp.default.List;j.children.first().children.each(re=>{re.type!=="PseudoElementSelector"&&Y.appendData(re)}),Y.appendData({type:"AttributeSelector",name:{type:"Identifier",name:"data-footnote-call"},flags:null,loc:null,matcher:null,value:null}),Y.appendData({type:"PseudoElementSelector",name:"after",loc:null,children:null}),j.children.first().children=Y}}afterParsed(h){this.processFootnotes(h,this.footnotes)}processFootnotes(h,v){for(let T in v){let n=h.querySelectorAll(T),R,j=v[T];for(var y=0;y<n.length;y++)R=n[y],R.setAttribute("data-note","footnote"),R.setAttribute("data-break-before","avoid"),R.setAttribute("data-note-policy",j.policy||"auto"),R.setAttribute("data-note-display",j.display||"block"),this.processFootnoteContainer(R)}}processFootnoteContainer(h){let v=h.parentElement,y=v;for(;v;){if(M_(v)){y.setAttribute("data-has-notes","true");break}y=v,v=v.parentElement,v||y.setAttribute("data-has-notes","true")}}renderNode(h){if(h.nodeType==1){let v;if(!h.dataset)return;h.dataset.note==="footnote"?v=[h]:(h.dataset.hasNotes||h.querySelectorAll("[data-note='footnote']"))&&(v=h.querySelectorAll("[data-note='footnote']")),v&&v.length&&this.findVisibleFootnotes(v,h)}}findVisibleFootnotes(h,v){let y,T,n;y=v.closest(".pagedjs_page_content"),T=y.getBoundingClientRect(),n=T.left+T.width;for(let R=0;R<h.length;++R){let j=h[R];j.getBoundingClientRect().left<n&&this.moveFootnote(j,v.closest(".pagedjs_area"),!0)}}moveFootnote(h,v,y){let T=v.querySelector(".pagedjs_footnote_area"),n=T.querySelector(".pagedjs_footnote_content"),R=n.querySelector(".pagedjs_footnote_inner_content");if(!Vo(h))return;let j;if(y&&(j=this.createFootnoteCall(h)),h.removeAttribute("data-break-before"),R.querySelector(`[data-ref="${h.dataset.ref}"]`)){h.remove();return}R.appendChild(h),n.classList.contains("pagedjs_footnote_empty")&&n.classList.remove("pagedjs_footnote_empty"),h.dataset.footnoteMarker=h.dataset.ref,h.id=`note-${h.dataset.ref}`;let re=n.scrollHeight,be=v.querySelector(".pagedjs_page_content").getBoundingClientRect(),oe=be.left+be.width,Se=j&&j.getBoundingClientRect(),Re=T.getBoundingClientRect(),tt=this.marginsHeight(n),yt=this.paddingHeight(n),qe=this.borderHeight(n),St=tt+yt+qe,ai=Math.floor(Re.top);Re.height===0&&(ai-=this.marginsHeight(n,!1),ai-=this.paddingHeight(n,!1),ai-=this.borderHeight(n,!1));let pi=h.dataset.notePolicy,Cr=0,lr=0;if(j){let hi=j.previousSibling,Di=new Range;hi?Di.setStartBefore(hi):Di.setStartBefore(j),Di.setEndAfter(j);let kr=Di.getBoundingClientRect();if(Cr=kr.bottom,!pi||pi==="auto")lr=Math.ceil(kr.bottom);else if(pi==="line")lr=Math.ceil(kr.top);else if(pi==="block"){let Si=j.closest("p").previousElementSibling;Si?lr=Math.ceil(Si.getBoundingClientRect().bottom):lr=Math.ceil(kr.bottom)}}let bt=re+St-Re.height,Wt=Cr?ai-Cr:0,li=Cr?Math.floor(Re.top)-lr:0,Hi=T.querySelector("[data-note='footnote']");if(y&&Se.left>oe)h.remove();else if(!Hi&&y&&St>Wt){v.style.setProperty("--pagedjs-footnotes-height","0px");let hi=document.createElement("div");hi.appendChild(h),this.needsLayout.push(hi)}else y?Cr<Re.top-bt?v.style.setProperty("--pagedjs-footnotes-height",`${re+tt+qe}px`):(v.style.setProperty("--pagedjs-footnotes-height",`${Re.height+li}px`),R.style.height=Re.height+li-St+"px"):v.style.setProperty("--pagedjs-footnotes-height",`${re+St}px`)}createFootnoteCall(h){let v=h.parentElement,y=document.createElement("a");for(let T of h.classList)y.classList.add(`${T}`);return y.dataset.footnoteCall=h.dataset.ref,y.dataset.ref=h.dataset.ref,y.dataset.dataCounterFootnoteIncrement=1,y.href=`#note-${h.dataset.ref}`,v.insertBefore(y,h),y}afterPageLayout(h,v,y,T){let n=h.querySelector(".pagedjs_area"),R=v.footnotesArea,j=R.querySelector(".pagedjs_footnote_content"),Y=R.querySelector(".pagedjs_footnote_inner_content"),re=j.getBoundingClientRect(),{width:me}=re;Y.style.columnWidth=Math.round(me)+"px",Y.style.columnGap="calc(var(--pagedjs-margin-right) + var(--pagedjs-margin-left))";let oe=new W_(R,void 0,T.settings).findOverflow(Y,re);if(oe){let{startContainer:Se,startOffset:Re}=oe,tt;if(Vo(Se)){let lr=Se.childNodes[Re];tt=Vo(lr)&&lr.hasAttribute("data-footnote-marker")}let yt=oe.extractContents();if(!tt){let lr=yt.firstElementChild;lr.dataset.splitFrom=lr.dataset.ref,this.handleAlignment(Y.lastElementChild)}this.needsLayout.push(yt),j.style.removeProperty("height"),Y.style.removeProperty("height");let qe=Y.getBoundingClientRect(),{height:St}=qe,ai=this.marginsHeight(j),pi=this.paddingHeight(j),Cr=this.borderHeight(j);if(n.style.setProperty("--pagedjs-footnotes-height",`${St+ai+Cr+pi}px`),Y.childNodes.length===0&&j.classList.add("pagedjs_footnote_empty"),!y)T.clonePage(v);else{let lr,bt;y.node&&typeof y.node.dataset<"u"&&typeof y.node.dataset.previousBreakAfter<"u"&&(bt=y.node.dataset.previousBreakAfter),y.node&&typeof y.node.dataset<"u"&&typeof y.node.dataset.breakBefore<"u"&&(lr=y.node.dataset.breakBefore),(lr||bt)&&T.clonePage(v)}}Y.style.height="auto"}handleAlignment(h){let y=window.getComputedStyle(h)["text-align-last"];h.dataset.lastSplitElement="true",y==="auto"?h.dataset.alignLastSplitElement="justify":h.dataset.alignLastSplitElement=y}beforePageLayout(h){for(;this.needsLayout.length;){let v=this.needsLayout.shift();Array.from(v.childNodes).forEach(y=>{this.moveFootnote(y,h.element.querySelector(".pagedjs_area"),!1)})}}afterOverflowRemoved(h,v){let y=v.closest(".pagedjs_area"),T=y.querySelectorAll(".pagedjs_footnote_area [data-note='footnote']");for(let R=0;R<T.length;R++){let j=T[R];h.querySelector(`[data-footnote-call="${j.dataset.ref}"]`)&&j.remove()}let n=y.querySelector(".pagedjs_footnote_inner_content");n&&n.childNodes.length===0&&n.parentElement.classList.add("pagedjs_footnote_empty")}marginsHeight(h,v=!0){let y=window.getComputedStyle(h),T=parseInt(y.marginTop),n=parseInt(y.marginBottom),R=0;return T&&(R+=T),n&&v&&(R+=n),R}paddingHeight(h,v=!0){let y=window.getComputedStyle(h),T=parseInt(y.paddingTop),n=parseInt(y.paddingBottom),R=0;return T&&(R+=T),n&&v&&(R+=n),R}borderHeight(h,v=!0){let y=window.getComputedStyle(h),T=parseInt(y.borderTop),n=parseInt(y.borderBottom),R=0;return T&&(R+=T),n&&v&&(R+=n),R}},Az=Ub;var kz=[_z,fz,mz,yz,vz,xz,wz,Tz,Cz,Ez,Az];var qm=Fn(fs(),1),qb=class extends Nr{constructor(h,v,y){super(h,v,y),this.runningSelectors={},this.elements={}}onDeclaration(h,v,y,T){if(h.property==="position"){let n=qm.default.generate(T.ruleNode.prelude),R=h.value.children.first().name;if(R==="running"){let j;qm.default.walk(h,{visit:"Function",enter:(Y,re,me)=>{j=Y.children.first().name}}),this.runningSelectors[j]={identifier:R,value:j,selector:n}}}h.property==="content"&&qm.default.walk(h,{visit:"Function",enter:(n,R,j)=>{if(n.name.indexOf("element")>-1){let Y=qm.default.generate(T.ruleNode.prelude),re=n.name,me=n.children.first().name,be=[me],oe="first";Y.split(",").forEach(Se=>{Se=Se.replace(/::after|::before/,""),this.elements[Se]={func:re,args:be,value:me,style:oe||"first",selector:Se,fullSelector:Y}})}}})}afterParsed(h){for(let v of Object.keys(this.runningSelectors)){let y=this.runningSelectors[v],T=Array.from(h.querySelectorAll(y.selector));if(y.identifier==="running")for(let n of T)n.style.display="none"}}afterPageLayout(h){for(let v of Object.keys(this.runningSelectors)){let y=this.runningSelectors[v],T=h.querySelector(y.selector);T&&(y.identifier==="running"?y.first=T:console.warn(y.value+"needs css replacement"))}this.orderedSelectors||(this.orderedSelectors=this.orderSelectors(this.elements));for(let v of this.orderedSelectors)if(v){let y=this.elements[v],T=h.querySelector(v);if(T){let n=this.runningSelectors[y.args[0]];if(n&&n.first){T.innerHTML="";let R=n.first.cloneNode(!0);R.style.display=null,T.appendChild(R)}}}}pageWeight(h){let v=1,y=h.split(" "),T=y.length&&y[0].split(".");switch(T.shift(),T.length){case 4:/^pagedjs_[\w-]+_first_page$/.test(T[3])?v=7:(T[3]==="pagedjs_left_page"||T[3]==="pagedjs_right_page")&&(v=6);break;case 3:T[1]==="pagedjs_named_page"&&(T[2].indexOf(":nth-of-type")>-1?v=7:v=5);break;case 2:T[1]==="pagedjs_first_page"?v=4:T[1]==="pagedjs_blank_page"?v=3:(T[1]==="pagedjs_left_page"||T[1]==="pagedjs_right_page")&&(v=2);break;default:T[0].indexOf(":nth-of-type")>-1?v=4:v=1}return v}orderSelectors(h){let v=Object.keys(h),y={1:[],2:[],3:[],4:[],5:[],6:[],7:[]},T=[];for(let R of v){let j=this.pageWeight(R);y[j].unshift(R)}for(var n=1;n<=7;n++)T=T.concat(y[n]);return T}beforeTreeParse(h,v){v.text=h.replace(/element[\s]*\(([^|^#)]*)\)/g,"element-ident($1)")}},Iz=qb;var Wb=Fn(fs(),1);function Wu(d,h=`"' `){if(d!=null)return d.replace(new RegExp(`^[${h}]+`),"").replace(new RegExp(`[${h}]+$`),"").replace(/["']/g,v=>"\\"+v).replace(/[\n]/g,v=>"\\00000A")}function Pz(d){if(d!=null)return d.replace(new RegExp("::footnote-call","g"),"").replace(new RegExp("::footnote-marker","g"),"")}var Gb=class extends Nr{constructor(h,v,y){super(h,v,y),this.stringSetSelectors={},this.type,this.pageLastString}onDeclaration(h,v,y,T){if(h.property==="string-set"){let n=Wb.default.generate(T.ruleNode.prelude),R=[],j=[],Y=[];h.value.children.forEach(re=>{re.type==="Identifier"&&R.push(re.name),re.type==="Function"&&(j.push(re.name),re.children.forEach(me=>{me.type==="Identifier"&&Y.push(me.name)}))}),R.forEach((re,me)=>{let be=j[me],oe=Y[me];this.stringSetSelectors[re]={identifier:re,func:be,value:oe,selector:n}})}}onContent(h,v,y,T,n){if(h.name==="string"){let R=h.children&&h.children.first().name;this.type=h.children.last().name,h.name="var",h.children=new Wb.default.List,this.type==="first"||this.type==="last"||this.type==="start"||this.type==="first-except"?h.children.append(h.children.createItem({type:"Identifier",loc:null,name:"--pagedjs-string-"+this.type+"-"+R})):h.children.append(h.children.createItem({type:"Identifier",loc:null,name:"--pagedjs-string-first-"+R}))}}afterPageLayout(h){this.pageLastString===void 0&&(this.pageLastString={});for(let v of Object.keys(this.stringSetSelectors)){let y=this.stringSetSelectors[v],T=y.value,n=y.func,R=h.querySelectorAll(y.selector),j=v in this.pageLastString?this.pageLastString[v]:"",Y,re,me,be;if(R.length==0)Y=j,re=j,me=j,be=j;else{R.forEach(tt=>{n==="content"&&(this.pageLastString[v]=R[R.length-1].textContent),n==="attr"&&(this.pageLastString[v]=R[R.length-1].getAttribute(T)||"")}),n==="content"&&(Y=R[0].textContent),n==="attr"&&(Y=R[0].getAttribute(T)||""),n==="content"&&(re=R[R.length-1].textContent),n==="attr"&&(re=R[R.length-1].getAttribute(T)||"");let oe=R[0].getBoundingClientRect().top,Re=R[0].closest(".pagedjs_page_content").getBoundingClientRect().top;oe==Re?me=Y:me=j,be=""}h.style.setProperty(`--pagedjs-string-first-${v}`,`"${Wu(Y)}`),h.style.setProperty(`--pagedjs-string-last-${v}`,`"${Wu(re)}`),h.style.setProperty(`--pagedjs-string-start-${v}`,`"${Wu(me)}`),h.style.setProperty(`--pagedjs-string-first-except-${v}`,`"${Wu(be)}`)}}},Lz=Gb;var Wm=Fn(fs(),1),Hb=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.counterTargets={}}onContent(h,v,y,T,n){if(h.name==="target-counter"){let R=Wm.default.generate(n.ruleNode.prelude),j=h.children.first(),Y=j.name,re=Wm.default.generate(h),me=[];j.children.forEach(tt=>{tt.type==="Identifier"&&me.push(tt.name)});let be,oe,Se;h.children.forEach(tt=>{tt.type==="Identifier"&&(be?oe||(Se=Wm.default.clone(tt),oe=tt.name):be=tt.name)});let Re="target-counter-"+Ns();R.split(",").forEach(tt=>{this.counterTargets[tt]={func:Y,args:me,value:re,counter:be,style:oe,selector:tt,fullSelector:R,variable:Re}}),h.name="counter",h.children=new Wm.default.List,h.children.appendData({type:"Identifier",loc:0,name:Re}),Se&&(h.children.appendData({type:"Operator",loc:null,value:","}),h.children.appendData(Se))}}afterPageLayout(h,v,y,T){Object.keys(this.counterTargets).forEach(n=>{let R=this.counterTargets[n],j=R.selector.split(/::?/g),Y=j[0];T.pagesArea.querySelectorAll(Y+":not([data-"+R.variable+"])").forEach((me,be)=>{if(R.func!=="attr")return;let oe=C_(me,R.args),Se=T.pagesArea.querySelector(E_(oe));if(Se){let Re=Ns();me.setAttribute("data-"+R.variable,Re);let tt="";if(j.length>1&&(tt+="::"+j[1]),R.counter==="page"){let qe=T.pagesArea.querySelectorAll(".pagedjs_page"),St=0;for(let ai=0;ai<qe.length;ai++){let pi=qe[ai],Cr=window.getComputedStyle(pi),lr=Cr["counter-reset"].replace("page","").trim(),bt=Cr["counter-increment"].replace("page","").trim();if(lr!=="none"&&(St=parseInt(lr)),bt!=="none"&&(St+=parseInt(bt)),pi.contains(Se))break}this.styleSheet.insertRule(`[data-${R.variable}="${Re}"]${tt} { counter-reset: ${R.variable} ${St}; }`,this.styleSheet.cssRules.length)}else{let qe=Se.getAttribute(`data-counter-${R.counter}-value`);qe&&this.styleSheet.insertRule(`[data-${R.variable}="${Re}"]${tt} { counter-reset: ${R.variable} ${R.variable} ${parseInt(qe)}; }`,this.styleSheet.cssRules.length)}let yt=document.querySelector(`[data-${R.variable}="${Re}"]`);yt&&(yt.style.display="none",yt.clientHeight,yt.style.removeProperty("display"))}})})}},zz=Hb;var Fy=Fn(fs(),1),Zb=class extends Nr{constructor(h,v,y){super(h,v,y),this.styleSheet=v.styleSheet,this.textTargets={},this.beforeContent="",this.afterContent="",this.selector={}}onContent(h,v,y,T,n){if(h.name==="target-text"){this.selector=Fy.default.generate(n.ruleNode.prelude);let R=h.children.first(),j=h.children.last(),Y=R.name,re=Fy.default.generate(h),me=[];R.children.forEach(Se=>{Se.type==="Identifier"&&me.push(Se.name)});let be;j!==R&&(be=j.name);let oe="--pagedjs-"+Ns();this.selector.split(",").forEach(Se=>{this.textTargets[Se]={func:Y,args:me,value:re,style:be||"content",selector:Se,fullSelector:this.selector,variable:oe}}),h.name="var",h.children=new Fy.default.List,h.children.appendData({type:"Identifier",loc:0,name:oe})}}onPseudoSelector(h,v,y,T,n){n.ruleNode.block.children.forEach(R=>{h.name==="before"&&R.property==="content"?R.value.children.forEach(Y=>{Y.type==="String"&&(this.beforeContent=Y.value)}):h.name==="after"&&R.property==="content"&&R.value.children.forEach(j=>{j.type==="String"&&(this.afterContent=j.value)})})}afterParsed(h){Object.keys(this.textTargets).forEach(v=>{let y=this.textTargets[v],T=y.selector.split("::"),n=T[0],R=h.querySelectorAll(n),j;R.forEach((Y,re)=>{let me=C_(Y,y.args),be=h.querySelector(E_(me));if(be)if(y.style){this.selector=Ns(),Y.setAttribute("data-target-text",this.selector);let oe="";if(T.length>1&&(oe+="::"+T[1]),y.style==="before"||y.style==="after"){let Se=`${y.style}Content`;j=Wu(this[Se])}else j=Wu(be.textContent," ");j=y.style==="first-letter"?j.charAt(0):j,this.styleSheet.insertRule(`[data-target-text="${this.selector}"]${oe} { ${y.variable}: "${j}" }`)}else console.warn("missed target",me)})})}},Mz=Zb;var Oz=[Iz,Lz,zz,Mz];var $b=class extends Nr{constructor(h,v,y){super(h,v,y)}filter(h){B_(h,v=>this.filterEmpty(v),NodeFilter.SHOW_TEXT)}filterEmpty(h){if(h.textContent.length>1&&gm(h)){let v=h.parentNode;if(Vo(v)&&v.closest("pre"))return NodeFilter.FILTER_REJECT;let T=k_(h),n=I_(h);return n===null&&T===null?(h.textContent=" ",NodeFilter.FILTER_REJECT):n===null||T===null?NodeFilter.FILTER_ACCEPT:(h.textContent=" ",NodeFilter.FILTER_REJECT)}else return NodeFilter.FILTER_REJECT}},Rz=$b;var Xb=class extends Nr{constructor(h,v,y){super(h,v,y)}filter(h){B_(h,null,NodeFilter.SHOW_COMMENT)}},Dz=Xb;var Yb=class extends Nr{constructor(h,v,y){super(h,v,y)}filter(h){h.querySelectorAll("script").forEach(v=>{v.remove()})}},Bz=Yb;var Vz=Fn(fs(),1),Uz=Fn(jz(),1);var Jb=class extends Nr{constructor(h,v,y){super(h,v,y),this.displayRules={}}onDeclaration(h,v,y,T){if(h.property==="display"){let n=Vz.default.generate(T.ruleNode.prelude),R=h.value.children.first().name;n.split(",").forEach(j=>{this.displayRules[j]={value:R,selector:j,specificity:(0,Uz.calculateSpecificity)(j),important:h.important}})}}filter(h){let{matches:v,selectors:y}=this.sortDisplayedSelectors(h,this.displayRules);for(let n=0;n<v.length;n++){let R=v[n],j=y[n],Y=j[j.length-1].value;this.removable(R)&&Y==="none"&&(R.dataset.undisplayed="undisplayed")}let T=h.querySelectorAll("[style]");for(let n=0;n<T.length;n++){let R=T[n];this.removable(R)&&(R.dataset.undisplayed="undisplayed")}}sorter(h,v){return h.important&&!v.important?1:v.important&&!h.important?-1:h.specificity-v.specificity}sortDisplayedSelectors(h,v=[]){let y=[],T=[];for(let n in v){let R=v[n],j=R.selector,Y=[];try{try{Y=h.querySelectorAll(j)}catch{Y=h.querySelectorAll(Pz(j))}}catch{Y=[]}let re=Array.from(Y);for(let me of re)if(y.includes(me)){let be=y.indexOf(me);T[be].push(R),T[be]=T[be].sort(this.sorter)}else y.push(me),T.push([R])}return{matches:y,selectors:T}}removable(h){return!(h.style&&h.style.display!==""&&h.style.display!=="none")}},qz=Jb;var Wz=[Rz,Dz,Bz,qz];var dO=Fn(Bu(),1),hO=Fn(uO(),1),s1=[...kz,...Oz,...Wz],Vy=class{constructor(h,v,y){let T=[];s1.forEach(n=>{let R=new n(h,v,y);T.push(R),(0,hO.default)(R,this)})}};(0,dO.default)(Vy.prototype);function Uy(){for(var d=0;d<arguments.length;d++)s1.push(arguments[d])}function a1(d,h,v){return new Vy(d,h,v)}var qy=class{constructor(h){this.settings=h||{},this.polisher=new Ab(!1),this.chunker=new i0(void 0,void 0,this.settings),this.hooks={},this.hooks.beforePreview=new Gi(this),this.hooks.afterPreview=new Gi(this),this.size={width:{value:8.5,unit:"in"},height:{value:11,unit:"in"},format:void 0,orientation:void 0},this.chunker.on("page",v=>{this.emit("page",v)}),this.chunker.on("rendering",()=>{this.emit("rendering",this.chunker)})}initializeHandlers(){let h=a1(this.chunker,this.polisher,this);return h.on("size",v=>{this.size=v,this.emit("size",v)}),h.on("atpages",v=>{this.atpages=v,this.emit("atpages",v)}),h}registerHandlers(){return Uy.apply(Uy,arguments)}getParams(h){let v,y=new URL(window.location),T=new URLSearchParams(y.search);for(var n of T.entries())n[0]===h&&(v=n[1]);return v}wrapContent(){let h=document.querySelector("body"),v;return v=h.querySelector(":scope > template[data-ref='pagedjs-content']"),v||(v=document.createElement("template"),v.dataset.ref="pagedjs-content",v.innerHTML=h.innerHTML,h.innerHTML="",h.appendChild(v)),v.content}removeStyles(h=document){let v=Array.from(h.querySelectorAll("link[rel='stylesheet']:not([data-pagedjs-ignore], [media~='screen'])")),y=Array.from(h.querySelectorAll("style:not([data-pagedjs-inserted-styles], [data-pagedjs-ignore], [media~='screen'])"));return[...v,...y].sort(function(n,R){let j=n.compareDocumentPosition(R);return j===Node.DOCUMENT_POSITION_PRECEDING?1:j===Node.DOCUMENT_POSITION_FOLLOWING?-1:0}).map(n=>{if(n.nodeName==="STYLE"){let R={};return R[window.location.href]=n.textContent,n.remove(),R}if(n.nodeName==="LINK")return n.remove(),n.href;console.warn(`Unable to process: ${n}, ignoring.`)})}async preview(h,v,y){await this.hooks.beforePreview.trigger(h,y),h||(h=this.wrapContent()),v||(v=this.removeStyles()),this.polisher.setup(),this.handlers=this.initializeHandlers(),await this.polisher.add(...v);let T=performance.now(),n=await this.chunker.flow(h,y),R=performance.now();return n.performance=R-T,n.size=this.size,this.emit("rendered",n),await this.hooks.afterPreview.trigger(n.pages),n}};(0,pO.default)(qy.prototype);var l1=qy;addEventListener("DOMContentLoaded",d=>{let h=new l1,v=window.location,y=new URLSearchParams(v.search);(y.has("print")||y.has("p"))&&h.preview().then(T=>{console.log("Rendered",T.total,"pages.")})});var ra=Fn(c1()),i9=Fn(gO());function R6(d,h,v){try{return window.URL.createObjectURL(new Blob([Uint8Array.from(d.split("").map(function(y){return y.charCodeAt(0)}))],{type:h}))}catch{return"data:"+h+(v?";base64,":",")+d}}function no(d){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(d)?d:new Uint8Array(d||0),this.pos=0,this.type=0,this.length=this.buf.length}function D6(d,h,v){var y,T,n=v.buf;if(T=n[v.pos++],y=(112&T)>>4,T<128||(T=n[v.pos++],y|=(127&T)<<3,T<128)||(T=n[v.pos++],y|=(127&T)<<10,T<128)||(T=n[v.pos++],y|=(127&T)<<17,T<128)||(T=n[v.pos++],y|=(127&T)<<24,T<128)||(T=n[v.pos++],y|=(1&T)<<31,T<128))return Ap(d,y,h);throw new Error("Expected varint not more than 10 bytes")}function $c(d){return d.type===no.Bytes?d.readVarint()+d.pos:d.pos+1}function Ap(d,h,v){return v?4294967296*h+(d>>>0):4294967296*(h>>>0)+(d>>>0)}function B6(d,h){var v,y;if(d>=0?(v=d%4294967296|0,y=d/4294967296|0):(v=~(-d%4294967296),y=~(-d/4294967296),4294967295^v?v=v+1|0:(v=0,y=y+1|0)),d>=18446744073709552e3||d<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),F6(v,y,h),N6(y,h)}function F6(d,h,v){v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos]=127&d}function N6(d,h){var v=(7&d)<<4;h.buf[h.pos++]|=v|((d>>>=3)?128:0),d&&(h.buf[h.pos++]=127&d|((d>>>=7)?128:0),d&&(h.buf[h.pos++]=127&d|((d>>>=7)?128:0),d&&(h.buf[h.pos++]=127&d|((d>>>=7)?128:0),d&&(h.buf[h.pos++]=127&d|((d>>>=7)?128:0),d&&(h.buf[h.pos++]=127&d)))))}function _O(d,h,v){var y=h<=16383?1:h<=2097151?2:h<=268435455?3:Math.ceil(Math.log(h)/(7*Math.LN2));v.realloc(y);for(var T=v.pos-1;T>=d;T--)v.buf[T+y]=v.buf[T]}function j6(d,h){for(var v=0;v<d.length;v++)h.writeVarint(d[v])}function V6(d,h){for(var v=0;v<d.length;v++)h.writeSVarint(d[v])}function U6(d,h){for(var v=0;v<d.length;v++)h.writeFloat(d[v])}function q6(d,h){for(var v=0;v<d.length;v++)h.writeDouble(d[v])}function W6(d,h){for(var v=0;v<d.length;v++)h.writeBoolean(d[v])}function G6(d,h){for(var v=0;v<d.length;v++)h.writeFixed32(d[v])}function H6(d,h){for(var v=0;v<d.length;v++)h.writeSFixed32(d[v])}function Z6(d,h){for(var v=0;v<d.length;v++)h.writeFixed64(d[v])}function $6(d,h){for(var v=0;v<d.length;v++)h.writeSFixed64(d[v])}function Hy(d,h){return(d[h]|d[h+1]<<8|d[h+2]<<16)+16777216*d[h+3]}function kp(d,h,v){d[v]=h,d[v+1]=h>>>8,d[v+2]=h>>>16,d[v+3]=h>>>24}function yO(d,h){return(d[h]|d[h+1]<<8|d[h+2]<<16)+(d[h+3]<<24)}function X6(d,h,v){for(var y="",T=h;T<v;){var n=d[T],R=null,j=n>239?4:n>223?3:n>191?2:1;if(T+j>v)break;var Y,re,me;j===1?n<128&&(R=n):j===2?(192&(Y=d[T+1]))==128&&(R=(31&n)<<6|63&Y)<=127&&(R=null):j===3?(Y=d[T+1],re=d[T+2],(192&Y)==128&&(192&re)==128&&((R=(15&n)<<12|(63&Y)<<6|63&re)<=2047||R>=55296&&R<=57343)&&(R=null)):j===4&&(Y=d[T+1],re=d[T+2],me=d[T+3],(192&Y)==128&&(192&re)==128&&(192&me)==128&&((R=(15&n)<<18|(63&Y)<<12|(63&re)<<6|63&me)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,j=1):R>65535&&(R-=65536,y+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),y+=String.fromCharCode(R),T+=j}return y}function Y6(d,h,v){for(var y,T,n=0;n<h.length;n++){if((y=h.charCodeAt(n))>55295&&y<57344){if(!T){y>56319||n+1===h.length?(d[v++]=239,d[v++]=191,d[v++]=189):T=y;continue}if(y<56320){d[v++]=239,d[v++]=191,d[v++]=189,T=y;continue}y=T-55296<<10|y-56320|65536,T=null}else T&&(d[v++]=239,d[v++]=191,d[v++]=189,T=null);y<128?d[v++]=y:(y<2048?d[v++]=y>>6|192:(y<65536?d[v++]=y>>12|224:(d[v++]=y>>18|240,d[v++]=y>>12&63|128),d[v++]=y>>6&63|128),d[v++]=63&y|128)}return v}function Ip(d,h){this.x=d,this.y=h}function Pp(d,h,v,y,T){this.properties={},this.extent=v,this.type=0,this._pbf=d,this._geometry=-1,this._keys=y,this._values=T,d.readFields(K6,this,h)}function K6(d,h,v){d==1?h.id=v.readVarint():d==2?J6(v,h):d==3?h.type=v.readVarint():d==4&&(h._geometry=v.pos)}function J6(d,h){for(var v=d.readVarint()+d.pos;d.pos<v;){var y=h._keys[d.readVarint()],T=h._values[d.readVarint()];h.properties[y]=T}}function Q6(d){var h=d.length;if(h<=1)return[d];for(var v,y,T=[],n=0;n<h;n++){var R=eq(d[n]);R!==0&&(y===void 0&&(y=R<0),y===R<0?(v&&T.push(v),v=[d[n]]):v.push(d[n]))}return v&&T.push(v),T}function eq(d){for(var h,v,y=0,T=0,n=d.length,R=n-1;T<n;R=T++)h=d[T],v=d[R],y+=(v.x-h.x)*(h.y+v.y);return y}function xO(d,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(tq,this,h),this.length=this._features.length}function tq(d,h,v){d===15?h.version=v.readVarint():d===1?h.name=v.readString():d===5?h.extent=v.readVarint():d===2?h._features.push(v.pos):d===3?h._keys.push(v.readString()):d===4&&h._values.push(iq(v))}function iq(d){for(var h=null,v=d.readVarint()+d.pos;d.pos<v;){var y=d.readVarint()>>3;h=y===1?d.readString():y===2?d.readFloat():y===3?d.readDouble():y===4?d.readVarint64():y===5?d.readVarint():y===6?d.readSVarint():y===7?d.readBoolean():null}return h}function rq(d,h){this.layers=d.readFields(nq,{},h)}function nq(d,h,v){if(d===3){var y=new fq(v,v.readVarint()+v.pos);y.length&&(h[y.name]=y)}}(function(d){function h(bt){if(typeof bt!="string"&&(bt=String(bt)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(bt))throw new TypeError("Invalid character in header field name");return bt.toLowerCase()}function v(bt){return typeof bt!="string"&&(bt=String(bt)),bt}function y(bt){var Wt={next:function(){var li=bt.shift();return{done:li===void 0,value:li}}};return qe.iterable&&(Wt[Symbol.iterator]=function(){return Wt}),Wt}function T(bt){this.map={},bt instanceof T?bt.forEach(function(Wt,li){this.append(li,Wt)},this):Array.isArray(bt)?bt.forEach(function(Wt){this.append(Wt[0],Wt[1])},this):bt&&Object.getOwnPropertyNames(bt).forEach(function(Wt){this.append(Wt,bt[Wt])},this)}function n(bt){if(bt.bodyUsed)return Promise.reject(new TypeError("Already read"));bt.bodyUsed=!0}function R(bt){return new Promise(function(Wt,li){bt.onload=function(){Wt(bt.result)},bt.onerror=function(){li(bt.error)}})}function j(bt){var Wt=new FileReader,li=R(Wt);return Wt.readAsArrayBuffer(bt),li}function Y(bt){var Wt=new FileReader,li=R(Wt);return Wt.readAsText(bt),li}function re(bt){for(var Wt=new Uint8Array(bt),li=new Array(Wt.length),Hi=0;Hi<Wt.length;Hi++)li[Hi]=String.fromCharCode(Wt[Hi]);return li.join("")}function me(bt){if(bt.slice)return bt.slice(0);var Wt=new Uint8Array(bt.byteLength);return Wt.set(new Uint8Array(bt)),Wt.buffer}function be(){return this.bodyUsed=!1,this._initBody=function(bt){if(this._bodyInit=bt,bt)if(typeof bt=="string")this._bodyText=bt;else if(qe.blob&&Blob.prototype.isPrototypeOf(bt))this._bodyBlob=bt;else if(qe.formData&&FormData.prototype.isPrototypeOf(bt))this._bodyFormData=bt;else if(qe.searchParams&&URLSearchParams.prototype.isPrototypeOf(bt))this._bodyText=bt.toString();else if(qe.arrayBuffer&&qe.blob&&ai(bt))this._bodyArrayBuffer=me(bt.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!qe.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(bt)&&!pi(bt))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=me(bt)}else this._bodyText="";this.headers.get("content-type")||(typeof bt=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):qe.searchParams&&URLSearchParams.prototype.isPrototypeOf(bt)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},qe.blob&&(this.blob=function(){var bt=n(this);if(bt)return bt;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?n(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(j)}),this.text=function(){var bt=n(this);if(bt)return bt;if(this._bodyBlob)return Y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(re(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},qe.formData&&(this.formData=function(){return this.text().then(Re)}),this.json=function(){return this.text().then(JSON.parse)},this}function oe(bt){var Wt=bt.toUpperCase();return Cr.indexOf(Wt)>-1?Wt:bt}function Se(bt,Wt){Wt=Wt||{};var li=Wt.body;if(bt instanceof Se){if(bt.bodyUsed)throw new TypeError("Already read");this.url=bt.url,this.credentials=bt.credentials,Wt.headers||(this.headers=new T(bt.headers)),this.method=bt.method,this.mode=bt.mode,li||bt._bodyInit==null||(li=bt._bodyInit,bt.bodyUsed=!0)}else this.url=String(bt);if(this.credentials=Wt.credentials||this.credentials||"omit",!Wt.headers&&this.headers||(this.headers=new T(Wt.headers)),this.method=oe(Wt.method||this.method||"GET"),this.mode=Wt.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&li)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(li)}function Re(bt){var Wt=new FormData;return bt.trim().split("&").forEach(function(li){if(li){var Hi=li.split("="),hi=Hi.shift().replace(/\+/g," "),Di=Hi.join("=").replace(/\+/g," ");Wt.append(decodeURIComponent(hi),decodeURIComponent(Di))}}),Wt}function tt(bt){var Wt=new T;return bt.split(/\r?\n/).forEach(function(li){var Hi=li.split(":"),hi=Hi.shift().trim();if(hi){var Di=Hi.join(":").trim();Wt.append(hi,Di)}}),Wt}function yt(bt,Wt){Wt||(Wt={}),this.type="default",this.status="status"in Wt?Wt.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Wt?Wt.statusText:"OK",this.headers=new T(Wt.headers),this.url=Wt.url||"",this._initBody(bt)}if(!d.fetch){var qe={searchParams:"URLSearchParams"in d,iterable:"Symbol"in d&&"iterator"in Symbol,blob:"FileReader"in d&&"Blob"in d&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in d,arrayBuffer:"ArrayBuffer"in d};if(qe.arrayBuffer)var St=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],ai=function(bt){return bt&&DataView.prototype.isPrototypeOf(bt)},pi=ArrayBuffer.isView||function(bt){return bt&&St.indexOf(Object.prototype.toString.call(bt))>-1};T.prototype.append=function(bt,Wt){bt=h(bt),Wt=v(Wt);var li=this.map[bt];this.map[bt]=li?li+","+Wt:Wt},T.prototype.delete=function(bt){delete this.map[h(bt)]},T.prototype.get=function(bt){return bt=h(bt),this.has(bt)?this.map[bt]:null},T.prototype.has=function(bt){return this.map.hasOwnProperty(h(bt))},T.prototype.set=function(bt,Wt){this.map[h(bt)]=v(Wt)},T.prototype.forEach=function(bt,Wt){var li=this;for(var Hi in this.map)li.map.hasOwnProperty(Hi)&&bt.call(Wt,li.map[Hi],Hi,li)},T.prototype.keys=function(){var bt=[];return this.forEach(function(Wt,li){bt.push(li)}),y(bt)},T.prototype.values=function(){var bt=[];return this.forEach(function(Wt){bt.push(Wt)}),y(bt)},T.prototype.entries=function(){var bt=[];return this.forEach(function(Wt,li){bt.push([li,Wt])}),y(bt)},qe.iterable&&(T.prototype[Symbol.iterator]=T.prototype.entries);var Cr=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];Se.prototype.clone=function(){return new Se(this,{body:this._bodyInit})},be.call(Se.prototype),be.call(yt.prototype),yt.prototype.clone=function(){return new yt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new T(this.headers),url:this.url})},yt.error=function(){var bt=new yt(null,{status:0,statusText:""});return bt.type="error",bt};var lr=[301,302,303,307,308];yt.redirect=function(bt,Wt){if(lr.indexOf(Wt)===-1)throw new RangeError("Invalid status code");return new yt(null,{status:Wt,headers:{location:bt}})},d.Headers=T,d.Request=Se,d.Response=yt,d.fetch=function(bt,Wt){return new Promise(function(li,Hi){var hi=new Se(bt,Wt),Di=new XMLHttpRequest;Di.onload=function(){var kr={status:Di.status,statusText:Di.statusText,headers:tt(Di.getAllResponseHeaders()||"")};kr.url="responseURL"in Di?Di.responseURL:kr.headers.get("X-Request-URL");var Si="response"in Di?Di.response:Di.responseText;li(new yt(Si,kr))},Di.onerror=function(){Hi(new TypeError("Network request failed"))},Di.ontimeout=function(){Hi(new TypeError("Network request failed"))},Di.open(hi.method,hi.url,!0),hi.credentials==="include"&&(Di.withCredentials=!0),"responseType"in Di&&qe.blob&&(Di.responseType="blob"),hi.headers.forEach(function(kr,Si){Di.setRequestHeader(Si,kr)}),Di.send(hi._bodyInit===void 0?null:hi._bodyInit)})},d.fetch.polyfill=!0}})(typeof self<"u"?self:void 0);var oq=function(d,h,v,y,T){var n,R,j=8*T-y-1,Y=(1<<j)-1,re=Y>>1,me=-7,be=v?T-1:0,oe=v?-1:1,Se=d[h+be];for(be+=oe,n=Se&(1<<-me)-1,Se>>=-me,me+=j;me>0;n=256*n+d[h+be],be+=oe,me-=8);for(R=n&(1<<-me)-1,n>>=-me,me+=y;me>0;R=256*R+d[h+be],be+=oe,me-=8);if(n===0)n=1-re;else{if(n===Y)return R?NaN:1/0*(Se?-1:1);R+=Math.pow(2,y),n-=re}return(Se?-1:1)*R*Math.pow(2,n-y)},sq=function(d,h,v,y,T,n){var R,j,Y,re=8*n-T-1,me=(1<<re)-1,be=me>>1,oe=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,Se=y?0:n-1,Re=y?1:-1,tt=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(j=isNaN(h)?1:0,R=me):(R=Math.floor(Math.log(h)/Math.LN2),h*(Y=Math.pow(2,-R))<1&&(R--,Y*=2),h+=R+be>=1?oe/Y:oe*Math.pow(2,1-be),h*Y>=2&&(R++,Y/=2),R+be>=me?(j=0,R=me):R+be>=1?(j=(h*Y-1)*Math.pow(2,T),R+=be):(j=h*Math.pow(2,be-1)*Math.pow(2,T),R=0));T>=8;d[v+Se]=255&j,Se+=Re,j/=256,T-=8);for(R=R<<T|j,re+=T;re>0;d[v+Se]=255&R,Se+=Re,R/=256,re-=8);d[v+Se-Re]|=128*tt},aq={read:oq,write:sq},lq=no,Zy=aq;no.Varint=0,no.Fixed64=1,no.Bytes=2,no.Fixed32=5;var u1=4294967296,vO=1/u1;no.prototype={destroy:function(){this.buf=null},readFields:function(d,h,v){var y=this;for(v=v||this.length;this.pos<v;){var T=y.readVarint(),n=T>>3,R=y.pos;y.type=7&T,d(n,h,y),y.pos===R&&y.skip(T)}return h},readMessage:function(d,h){return this.readFields(d,h,this.readVarint()+this.pos)},readFixed32:function(){var d=Hy(this.buf,this.pos);return this.pos+=4,d},readSFixed32:function(){var d=yO(this.buf,this.pos);return this.pos+=4,d},readFixed64:function(){var d=Hy(this.buf,this.pos)+Hy(this.buf,this.pos+4)*u1;return this.pos+=8,d},readSFixed64:function(){var d=Hy(this.buf,this.pos)+yO(this.buf,this.pos+4)*u1;return this.pos+=8,d},readFloat:function(){var d=Zy.read(this.buf,this.pos,!0,23,4);return this.pos+=4,d},readDouble:function(){var d=Zy.read(this.buf,this.pos,!0,52,8);return this.pos+=8,d},readVarint:function(d){var h,v,y=this.buf;return v=y[this.pos++],h=127&v,v<128?h:(v=y[this.pos++],h|=(127&v)<<7,v<128?h:(v=y[this.pos++],h|=(127&v)<<14,v<128?h:(v=y[this.pos++],h|=(127&v)<<21,v<128?h:(v=y[this.pos],h|=(15&v)<<28,D6(h,d,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var d=this.readVarint();return d%2==1?(d+1)/-2:d/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var d=this.readVarint()+this.pos,h=X6(this.buf,this.pos,d);return this.pos=d,h},readBytes:function(){var d=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,d);return this.pos=d,h},readPackedVarint:function(d,h){var v=this,y=$c(this);for(d=d||[];this.pos<y;)d.push(v.readVarint(h));return d},readPackedSVarint:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readSVarint());return d},readPackedBoolean:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readBoolean());return d},readPackedFloat:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readFloat());return d},readPackedDouble:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readDouble());return d},readPackedFixed32:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readFixed32());return d},readPackedSFixed32:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readSFixed32());return d},readPackedFixed64:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readFixed64());return d},readPackedSFixed64:function(d){var h=this,v=$c(this);for(d=d||[];this.pos<v;)d.push(h.readSFixed64());return d},skip:function(d){var h=7&d;if(h===no.Varint)for(;this.buf[this.pos++]>127;);else if(h===no.Bytes)this.pos=this.readVarint()+this.pos;else if(h===no.Fixed32)this.pos+=4;else{if(h!==no.Fixed64)throw new Error("Unimplemented type: "+h);this.pos+=8}},writeTag:function(d,h){this.writeVarint(d<<3|h)},realloc:function(d){for(var h=this.length||16;h<this.pos+d;)h*=2;if(h!==this.length){var v=new Uint8Array(h);v.set(this.buf),this.buf=v,this.length=h}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(d){this.realloc(4),kp(this.buf,d,this.pos),this.pos+=4},writeSFixed32:function(d){this.realloc(4),kp(this.buf,d,this.pos),this.pos+=4},writeFixed64:function(d){this.realloc(8),kp(this.buf,-1&d,this.pos),kp(this.buf,Math.floor(d*vO),this.pos+4),this.pos+=8},writeSFixed64:function(d){this.realloc(8),kp(this.buf,-1&d,this.pos),kp(this.buf,Math.floor(d*vO),this.pos+4),this.pos+=8},writeVarint:function(d){if((d=+d||0)>268435455||d<0)return void B6(d,this);this.realloc(4),this.buf[this.pos++]=127&d|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=d>>>7&127)))},writeSVarint:function(d){this.writeVarint(d<0?2*-d-1:2*d)},writeBoolean:function(d){this.writeVarint(!!d)},writeString:function(d){d=String(d),this.realloc(4*d.length),this.pos++;var h=this.pos;this.pos=Y6(this.buf,d,this.pos);var v=this.pos-h;v>=128&&_O(h,v,this),this.pos=h-1,this.writeVarint(v),this.pos+=v},writeFloat:function(d){this.realloc(4),Zy.write(this.buf,d,this.pos,!0,23,4),this.pos+=4},writeDouble:function(d){this.realloc(8),Zy.write(this.buf,d,this.pos,!0,52,8),this.pos+=8},writeBytes:function(d){var h=this,v=d.length;this.writeVarint(v),this.realloc(v);for(var y=0;y<v;y++)h.buf[h.pos++]=d[y]},writeRawMessage:function(d,h){this.pos++;var v=this.pos;d(h,this);var y=this.pos-v;y>=128&&_O(v,y,this),this.pos=v-1,this.writeVarint(y),this.pos+=y},writeMessage:function(d,h,v){this.writeTag(d,no.Bytes),this.writeRawMessage(h,v)},writePackedVarint:function(d,h){this.writeMessage(d,j6,h)},writePackedSVarint:function(d,h){this.writeMessage(d,V6,h)},writePackedBoolean:function(d,h){this.writeMessage(d,W6,h)},writePackedFloat:function(d,h){this.writeMessage(d,U6,h)},writePackedDouble:function(d,h){this.writeMessage(d,q6,h)},writePackedFixed32:function(d,h){this.writeMessage(d,G6,h)},writePackedSFixed32:function(d,h){this.writeMessage(d,H6,h)},writePackedFixed64:function(d,h){this.writeMessage(d,Z6,h)},writePackedSFixed64:function(d,h){this.writeMessage(d,$6,h)},writeBytesField:function(d,h){this.writeTag(d,no.Bytes),this.writeBytes(h)},writeFixed32Field:function(d,h){this.writeTag(d,no.Fixed32),this.writeFixed32(h)},writeSFixed32Field:function(d,h){this.writeTag(d,no.Fixed32),this.writeSFixed32(h)},writeFixed64Field:function(d,h){this.writeTag(d,no.Fixed64),this.writeFixed64(h)},writeSFixed64Field:function(d,h){this.writeTag(d,no.Fixed64),this.writeSFixed64(h)},writeVarintField:function(d,h){this.writeTag(d,no.Varint),this.writeVarint(h)},writeSVarintField:function(d,h){this.writeTag(d,no.Varint),this.writeSVarint(h)},writeStringField:function(d,h){this.writeTag(d,no.Bytes),this.writeString(h)},writeFloatField:function(d,h){this.writeTag(d,no.Fixed32),this.writeFloat(h)},writeDoubleField:function(d,h){this.writeTag(d,no.Fixed64),this.writeDouble(h)},writeBooleanField:function(d,h){this.writeVarintField(d,!!h)}};var cq=Ip;Ip.prototype={clone:function(){return new Ip(this.x,this.y)},add:function(d){return this.clone()._add(d)},sub:function(d){return this.clone()._sub(d)},mult:function(d){return this.clone()._mult(d)},div:function(d){return this.clone()._div(d)},rotate:function(d){return this.clone()._rotate(d)},matMult:function(d){return this.clone()._matMult(d)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(d){return this.x===d.x&&this.y===d.y},dist:function(d){return Math.sqrt(this.distSqr(d))},distSqr:function(d){var h=d.x-this.x,v=d.y-this.y;return h*h+v*v},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith:function(d){return this.angleWithSep(d.x,d.y)},angleWithSep:function(d,h){return Math.atan2(this.x*h-this.y*d,this.x*d+this.y*h)},_matMult:function(d){var h=d[0]*this.x+d[1]*this.y,v=d[2]*this.x+d[3]*this.y;return this.x=h,this.y=v,this},_add:function(d){return this.x+=d.x,this.y+=d.y,this},_sub:function(d){return this.x-=d.x,this.y-=d.y,this},_mult:function(d){return this.x*=d,this.y*=d,this},_div:function(d){return this.x/=d,this.y/=d,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var d=this.y;return this.y=this.x,this.x=-d,this},_rotate:function(d){var h=Math.cos(d),v=Math.sin(d),y=h*this.x-v*this.y,T=v*this.x+h*this.y;return this.x=y,this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ip.convert=function(d){return d instanceof Ip?d:Array.isArray(d)?new Ip(d[0],d[1]):d};var uq=cq,dq=Pp;Pp.types=["Unknown","Point","LineString","Polygon"],Pp.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var h,v=d.readVarint()+d.pos,y=1,T=0,n=0,R=0,j=[];d.pos<v;){if(!T){var Y=d.readVarint();y=7&Y,T=Y>>3}if(T--,y===1||y===2)n+=d.readSVarint(),R+=d.readSVarint(),y===1&&(h&&j.push(h),h=[]),h.push(new uq(n,R));else{if(y!==7)throw new Error("unknown command "+y);h&&h.push(h[0].clone())}}return h&&j.push(h),j},Pp.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var h=d.readVarint()+d.pos,v=1,y=0,T=0,n=0,R=1/0,j=-1/0,Y=1/0,re=-1/0;d.pos<h;){if(!y){var me=d.readVarint();v=7&me,y=me>>3}if(y--,v===1||v===2)T+=d.readSVarint(),n+=d.readSVarint(),T<R&&(R=T),T>j&&(j=T),n<Y&&(Y=n),n>re&&(re=n);else if(v!==7)throw new Error("unknown command "+v)}return[R,Y,j,re]},Pp.prototype.toGeoJSON=function(d,h,v){function y(Se){for(var Re=0;Re<Se.length;Re++){var tt=Se[Re],yt=180-360*(tt.y+Y)/R;Se[Re]=[360*(tt.x+j)/R-180,360/Math.PI*Math.atan(Math.exp(yt*Math.PI/180))-90]}}var T,n,R=this.extent*Math.pow(2,v),j=this.extent*d,Y=this.extent*h,re=this.loadGeometry(),me=Pp.types[this.type];switch(this.type){case 1:var be=[];for(T=0;T<re.length;T++)be[T]=re[T][0];re=be,y(re);break;case 2:for(T=0;T<re.length;T++)y(re[T]);break;case 3:for(re=Q6(re),T=0;T<re.length;T++)for(n=0;n<re[T].length;n++)y(re[T][n])}re.length===1?re=re[0]:me="Multi"+me;var oe={type:"Feature",geometry:{type:me,coordinates:re},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var hq=dq,pq=xO;xO.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var h=this._pbf.readVarint()+this._pbf.pos;return new hq(this._pbf,h,this.extent,this._keys,this._values)};var fq=pq,mq=rq,gq=mq;L.SVG.Tile=L.SVG.extend({initialize:function(d,h,v){L.SVG.prototype.initialize.call(this,v),this._tileCoord=d,this._size=h,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._container.setAttribute("viewBox",[0,0,this._size.x,this._size.y].join(" ")),this._layers={}},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},onAdd:L.Util.falseFn,addTo:function(d){if(this._map=d,this.options.interactive)for(var h in this._layers){var v=this._layers[h];v._path.style.pointerEvents="auto",this._map._targets[L.stamp(v._path)]=v}},removeFrom:function(d){if(this.options.interactive)for(var h in this._layers){var v=this._layers[h];delete this._map._targets[L.stamp(v._path)]}delete this._map},_initContainer:function(){L.SVG.prototype._initContainer.call(this),L.SVG.create("rect")},_addPath:function(d){this._rootGroup.appendChild(d._path),this._layers[L.stamp(d)]=d},_updateIcon:function(d){var h=d._path=L.SVG.create("image"),v=d.options.icon,y=v.options,T=L.point(y.iconSize),n=y.iconAnchor||T&&T.divideBy(2,!0),R=d._point.subtract(n);h.setAttribute("x",R.x),h.setAttribute("y",R.y),h.setAttribute("width",T.x+"px"),h.setAttribute("height",T.y+"px"),h.setAttribute("href",y.iconUrl)}}),L.svg.tile=function(d,h,v){return new L.SVG.Tile(d,h,v)};var Gu=L.Class.extend({render:function(d,h){this._renderer=d,this.options=h,d._initPath(this),d._updateStyle(this)},updateStyle:function(d,h){this.options=h,d._updateStyle(this)},_getPixelBounds:function(){for(var d=this._parts,h=L.bounds([]),v=0;v<d.length;v++)for(var y=d[v],T=0;T<y.length;T++)h.extend(y[T]);var n=this._clickTolerance(),R=new L.Point(n,n);return h.min._subtract(R),h.max._add(R),h},_clickTolerance:L.Path.prototype._clickTolerance}),bO={_makeFeatureParts:function(d,h){var v,y=d.geometry;this._parts=[];for(var T=0;T<y.length;T++){for(var n=y[T],R=[],j=0;j<n.length;j++)v=n[j],R.push(L.point(v).scaleBy(h));this._parts.push(R)}},makeInteractive:function(){this._pxBounds=this._getPixelBounds()}},d1=L.CircleMarker.extend({includes:Gu.prototype,statics:{iconCache:{}},initialize:function(d,h){this.properties=d.properties,this._makeFeatureParts(d,h)},render:function(d,h){Gu.prototype.render.call(this,d,h),this._radius=h.radius||L.CircleMarker.prototype.options.radius,this._updatePath()},_makeFeatureParts:function(d,h){var v=d.geometry[0];typeof v[0]=="object"&&"x"in v[0]?(this._point=L.point(v[0]).scaleBy(h),this._empty=L.Util.falseFn):(this._point=L.point(v).scaleBy(h),this._empty=L.Util.falseFn)},makeInteractive:function(){this._updateBounds()},updateStyle:function(d,h){return this._radius=h.radius||this._radius,this._updateBounds(),Gu.prototype.updateStyle.call(this,d,h)},_updateBounds:function(){var d=this.options.icon;if(d){var h=L.point(d.options.iconSize),v=d.options.iconAnchor||h&&h.divideBy(2,!0),y=this._point.subtract(v);this._pxBounds=new L.Bounds(y,y.add(d.options.iconSize))}else L.CircleMarker.prototype._updateBounds.call(this)},_updatePath:function(){this.options.icon?this._renderer._updateIcon(this):L.CircleMarker.prototype._updatePath.call(this)},_getImage:function(){if(this.options.icon){var d=this.options.icon.options.iconUrl,h=d1.iconCache[d];if(!h){var v=this.options.icon;h=d1.iconCache[d]=v.createIcon()}return h}return null},_containsPoint:function(d){return this.options.icon?this._pxBounds.contains(d):L.CircleMarker.prototype._containsPoint.call(this,d)}}),_q=L.Polyline.extend({includes:[Gu.prototype,bO],initialize:function(d,h){this.properties=d.properties,this._makeFeatureParts(d,h)},render:function(d,h){h.fill=!1,Gu.prototype.render.call(this,d,h),this._updatePath()},updateStyle:function(d,h){h.fill=!1,Gu.prototype.updateStyle.call(this,d,h)}}),yq=L.Polygon.extend({includes:[Gu.prototype,bO],initialize:function(d,h){this.properties=d.properties,this._makeFeatureParts(d,h)},render:function(d,h){Gu.prototype.render.call(this,d,h),this._updatePath()}});L.VectorGrid=L.GridLayer.extend({options:{rendererFactory:L.svg.tile,vectorTileLayerStyles:{},interactive:!1},initialize:function(d){L.setOptions(this,d),L.GridLayer.prototype.initialize.apply(this,arguments),this.options.getFeatureId&&(this._vectorTiles={},this._overriddenStyles={},this.on("tileunload",function(h){var v=this._tileCoordsToKey(h.coords),y=this._vectorTiles[v];y&&this._map&&y.removeFrom(this._map),delete this._vectorTiles[v]},this)),this._dataLayerNames={}},createTile:function(d,h){var v=this.options.getFeatureId,y=this.getTileSize(),T=this.options.rendererFactory(d,y,this.options),n=this._getVectorTilePromise(d);return v&&(this._vectorTiles[this._tileCoordsToKey(d)]=T,T._features={}),n.then(function(R){for(var j in R.layers){this._dataLayerNames[j]=!0;for(var Y=R.layers[j],re=this.getTileSize().divideBy(Y.extent),me=this.options.vectorTileLayerStyles[j]||L.Path.prototype.options,be=0;be<Y.features.length;be++){var oe,Se=Y.features[be],Re=me;if(v){oe=this.options.getFeatureId(Se);var tt=this._overriddenStyles[oe];tt&&(Re=tt[j]?tt[j]:tt)}if(Re instanceof Function&&(Re=Re(Se.properties,d.z)),Re instanceof Array||(Re=[Re]),Re.length){for(var yt=this._createLayer(Se,re),qe=0;qe<Re.length;qe++){var St=L.extend({},L.Path.prototype.options,Re[qe]);yt.render(T,St),T._addPath(yt)}this.options.interactive&&yt.makeInteractive(),v&&(T._features[oe]={layerName:j,feature:yt})}}}this._map!=null&&T.addTo(this._map),L.Util.requestAnimFrame(h.bind(d,null,null))}.bind(this)),T.getContainer()},setFeatureStyle:function(d,h){this._overriddenStyles[d]=h;for(var v in this._vectorTiles){var y=this._vectorTiles[v],T=y._features,n=T[d];if(n){var R=n.feature,j=h;h[n.layerName]&&(j=h[n.layerName]),this._updateStyles(R,y,j)}}return this},resetFeatureStyle:function(d){delete this._overriddenStyles[d];for(var h in this._vectorTiles){var v=this._vectorTiles[h],y=v._features,T=y[d];if(T){var n=T.feature,R=this.options.vectorTileLayerStyles[T.layerName]||L.Path.prototype.options;this._updateStyles(n,v,R)}}return this},getDataLayerNames:function(){return Object.keys(this._dataLayerNames)},_updateStyles:function(d,h,v){(v=v instanceof Function?v(d.properties,h.getCoord().z):v)instanceof Array||(v=[v]);for(var y=0;y<v.length;y++){var T=L.extend({},L.Path.prototype.options,v[y]);d.updateStyle(h,T)}},_createLayer:function(d,h,v){var y;switch(d.type){case 1:y=new d1(d,h);break;case 2:y=new _q(d,h);break;case 3:y=new yq(d,h)}return this.options.interactive&&y.addEventParent(this),y}}),L.vectorGrid=function(d){return new L.VectorGrid(d)},L.VectorGrid.Protobuf=L.VectorGrid.extend({options:{subdomains:"abc",fetchOptions:{}},initialize:function(d,h){this._url=d,L.VectorGrid.prototype.initialize.call(this,h)},setUrl:function(d,h){return this._url=d,h||this.redraw(),this},_getSubdomain:L.TileLayer.prototype._getSubdomain,_getVectorTilePromise:function(d){var h={s:this._getSubdomain(d),x:d.x,y:d.y,z:d.z};if(this._map&&!this._map.options.crs.infinite){var v=this._globalTileRange.max.y-d.y;this.options.tms&&(h.y=v),h["-y"]=v}var y=L.Util.template(this._url,L.extend(h,this.options));return fetch(y,this.options.fetchOptions).then(function(T){return T.ok?T.blob().then(function(n){var R=new FileReader;return new Promise(function(j){R.addEventListener("loadend",function(){var Y=new lq(R.result);return j(new gq(Y))}),R.readAsArrayBuffer(n)})}):{layers:[]}}).then(function(T){for(var n in T.layers){for(var R=[],j=0;j<T.layers[n].length;j++){var Y=T.layers[n].feature(j);Y.geometry=Y.loadGeometry(),R.push(Y)}T.layers[n].features=R}return T})}}),L.vectorGrid.protobuf=function(d,h){return new L.VectorGrid.Protobuf(d,h)};var vq=R6(`"use strict";function simplify$1(e,t){var r,n,o,i,a=t*t,s=e.length,l=0,u=s-1,c=[];for(e[l][2]=1,e[u][2]=1;u;){for(n=0,r=l+1;r<u;r++)(o=getSqSegDist(e[r],e[l],e[u]))>n&&(i=r,n=o);n>a?(e[i][2]=n,c.push(l),c.push(i),l=i):(u=c.pop(),l=c.pop())}}function getSqSegDist(e,t,r){var n=t[0],o=t[1],i=r[0],a=r[1],s=e[0],l=e[1],u=i-n,c=a-o;if(0!==u||0!==c){var f=((s-n)*u+(l-o)*c)/(u*u+c*c);f>1?(n=i,o=a):f>0&&(n+=u*f,o+=c*f)}return u=s-n,c=l-o,u*u+c*c}function convert$1(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)convertFeature(r,e.features[n],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){if(null!==t.geometry){var n,o,i,a,s=t.geometry,l=s.type,u=s.coordinates,c=t.properties;if("Point"===l)e.push(create(c,1,[projectPoint(u)]));else if("MultiPoint"===l)e.push(create(c,1,project(u)));else if("LineString"===l)e.push(create(c,2,[project(u,r)]));else if("MultiLineString"===l||"Polygon"===l){for(i=[],n=0;n<u.length;n++)a=project(u[n],r),"Polygon"===l&&(a.outer=0===n),i.push(a);e.push(create(c,"Polygon"===l?3:2,i))}else if("MultiPolygon"===l){for(i=[],n=0;n<u.length;n++)for(o=0;o<u[n].length;o++)a=project(u[n][o],r),a.outer=0===o,i.push(a);e.push(create(c,3,i))}else{if("GeometryCollection"!==l)throw new Error("Input data is not a valid GeoJSON object.");for(n=0;n<s.geometries.length;n++)convertFeature(e,{geometry:s.geometries[n],properties:c},r)}}}function create(e,t,r){var n={geometry:r,type:t,tags:e||null,min:[2,1],max:[-1,0]};return calcBBox(n),n}function project(e,t){for(var r=[],n=0;n<e.length;n++)r.push(projectPoint(e[n]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n=n<0?0:n>1?1:n,[r,n,0]}function calcSize(e){for(var t,r,n=0,o=0,i=0;i<e.length-1;i++)t=r||e[i],r=e[i+1],n+=t[0]*r[1]-r[0]*t[1],o+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(n/2),e.dist=o}function calcBBox(e){var t=e.geometry,r=e.min,n=e.max;if(1===e.type)calcRingBBox(r,n,t);else for(var o=0;o<t.length;o++)calcRingBBox(r,n,t[o]);return e}function calcRingBBox(e,t,r){for(var n,o=0;o<r.length;o++)n=r[o],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1])}function transformTile(e,t){if(e.transformed)return e;var r,n,o,i=e.z2,a=e.x,s=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry;if(1===l.type)for(n=0;n<u.length;n++)u[n]=transformPoint(u[n],t,i,a,s);else for(n=0;n<u.length;n++){var c=u[n];for(o=0;o<c.length;o++)c[o]=transformPoint(c[o],t,i,a,s)}}return e.transformed=!0,e}function transformPoint(e,t,r,n,o){return[Math.round(t*(e[0]*r-n)),Math.round(t*(e[1]*r-o))]}function clip$1(e,t,r,n,o,i,a,s){if(r/=t,n/=t,a>=r&&s<=n)return e;if(a>n||s<r)return null;for(var l=[],u=0;u<e.length;u++){var c,f,p=e[u],h=p.geometry,m=p.type;if(c=p.min[o],f=p.max[o],c>=r&&f<=n)l.push(p);else if(!(c>n||f<r)){var g=1===m?clipPoints(h,r,n,o):clipGeometry(h,r,n,o,i,3===m);g.length&&l.push({geometry:g,type:m,tags:e[u].tags||null,min:p.min,max:p.max})}}return l.length?l:null}function clipPoints(e,t,r,n){for(var o=[],i=0;i<e.length;i++){var a=e[i],s=a[n];s>=t&&s<=r&&o.push(a)}return o}function clipGeometry(e,t,r,n,o,i){for(var a=[],s=0;s<e.length;s++){var l,u,c,f=0,p=0,h=null,m=e[s],g=m.area,d=m.dist,v=m.outer,y=m.length,x=[];for(u=0;u<y-1;u++)l=h||m[u],h=m[u+1],f=p||l[n],p=h[n],f<t?p>r?(x.push(o(l,h,t),o(l,h,r)),i||(x=newSlice(a,x,g,d,v))):p>=t&&x.push(o(l,h,t)):f>r?p<t?(x.push(o(l,h,r),o(l,h,t)),i||(x=newSlice(a,x,g,d,v))):p<=r&&x.push(o(l,h,r)):(x.push(l),p<t?(x.push(o(l,h,t)),i||(x=newSlice(a,x,g,d,v))):p>r&&(x.push(o(l,h,r)),i||(x=newSlice(a,x,g,d,v))));l=m[y-1],f=l[n],f>=t&&f<=r&&x.push(l),c=x[x.length-1],i&&c&&(x[0][0]!==c[0]||x[0][1]!==c[1])&&x.push(x[0]),newSlice(a,x,g,d,v)}return a}function newSlice(e,t,r,n,o){return t.length&&(t.area=r,t.dist=n,void 0!==o&&(t.outer=o),e.push(t)),[]}function wrap$1(e,t,r){var n=e,o=clip$2(e,1,-1-t,t,0,r,-1,2),i=clip$2(e,1,1-t,2+t,0,r,-1,2);return(o||i)&&(n=clip$2(e,1,-t,1+t,0,r,-1,2),o&&(n=shiftFeatureCoords(o,1).concat(n)),i&&(n=n.concat(shiftFeatureCoords(i,-1)))),n}function shiftFeatureCoords(e,t){for(var r=[],n=0;n<e.length;n++){var o,i=e[n],a=i.type;if(1===a)o=shiftCoords(i.geometry,t);else{o=[];for(var s=0;s<i.geometry.length;s++)o.push(shiftCoords(i.geometry[s],t))}r.push({geometry:o,type:a,tags:i.tags,min:[i.min[0]+t,i.min[1]],max:[i.max[0]+t,i.max[1]]})}return r}function shiftCoords(e,t){var r=[];r.area=e.area,r.dist=e.dist;for(var n=0;n<e.length;n++)r.push([e[n][0]+t,e[n][1],e[n][2]]);return r}function createTile$1(e,t,r,n,o,i){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z2:t,transformed:!1,min:[2,1],max:[-1,0]},s=0;s<e.length;s++){a.numFeatures++,addFeature(a,e[s],o,i);var l=e[s].min,u=e[s].max;l[0]<a.min[0]&&(a.min[0]=l[0]),l[1]<a.min[1]&&(a.min[1]=l[1]),u[0]>a.max[0]&&(a.max[0]=u[0]),u[1]>a.max[1]&&(a.max[1]=u[1])}return a}function addFeature(e,t,r,n){var o,i,a,s,l=t.geometry,u=t.type,c=[],f=r*r;if(1===u)for(o=0;o<l.length;o++)c.push(l[o]),e.numPoints++,e.numSimplified++;else for(o=0;o<l.length;o++)if(a=l[o],n||!(2===u&&a.dist<r||3===u&&a.area<f)){var p=[];for(i=0;i<a.length;i++)s=a[i],(n||s[2]>f)&&(p.push(s),e.numSimplified++),e.numPoints++;3===u&&rewind(p,a.outer),c.push(p)}else e.numPoints+=a.length;c.length&&e.features.push({geometry:c,type:u,tags:t.tags||null})}function rewind(e,t){signedArea(e)<0===t&&e.reverse()}function signedArea(e){for(var t,r,n=0,o=0,i=e.length,a=i-1;o<i;a=o++)t=e[o],r=e[a],n+=(r[0]-t[0])*(t[1]+r[1]);return n}function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var r=t.debug;r&&console.time("preprocess data");var n=1<<t.maxZoom,o=convert(e,t.tolerance/(n*t.extent));this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),o=wrap(o,t.buffer/t.extent,intersectX),o.length&&this.splitTile(o,0,0,0),r&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,r){return 32*((1<<e)*r+t)+e}function intersectX(e,t,r){return[r,(r-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function intersectY(e,t,r){return[(r-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],r,1]}function extend(e,t){for(var r in t)e[r]=t[r];return e}function isClippedSquare(e,t,r){var n=e.source;if(1!==n.length)return!1;var o=n[0];if(3!==o.type||o.geometry.length>1)return!1;var i=o.geometry[0].length;if(5!==i)return!1;for(var a=0;a<i;a++){var s=transform.point(o.geometry[0][a],t,e.z2,e.x,e.y);if(s[0]!==-r&&s[0]!==t+r||s[1]!==-r&&s[1]!==t+r)return!1}return!0}function feature$1(e,t){var r=t.id,n=t.bbox,o=null==t.properties?{}:t.properties,i=object(e,t);return null==r&&null==n?{type:"Feature",properties:o,geometry:i}:null==n?{type:"Feature",id:r,properties:o,geometry:i}:{type:"Feature",id:r,bbox:n,properties:o,geometry:i}}function object(e,t){function r(e,t){t.length&&t.pop();for(var r=u[e<0?~e:e],n=0,o=r.length;n<o;++n)t.push(l(r[n].slice(),n));e<0&&reverse(t,o)}function n(e){return l(e.slice())}function o(e){for(var t=[],n=0,o=e.length;n<o;++n)r(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function i(e){for(var t=o(e);t.length<4;)t.push(t[0].slice());return t}function a(e){return e.map(i)}function s(e){var t,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(s)};case"Point":t=n(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(n);break;case"LineString":t=o(e.arcs);break;case"MultiLineString":t=e.arcs.map(o);break;case"Polygon":t=a(e.arcs);break;case"MultiPolygon":t=e.arcs.map(a);break;default:return null}return{type:r,coordinates:t}}var l=transform$3(e),u=e.arcs;return s(t)}function extractArcs(e,t,r){function n(e){var t=e<0?~e:e;(c[t]||(c[t]=[])).push({i:e,g:l})}function o(e){e.forEach(n)}function i(e){e.forEach(o)}function a(e){e.forEach(i)}function s(e){switch(l=e,e.type){case"GeometryCollection":e.geometries.forEach(s);break;case"LineString":o(e.arcs);break;case"MultiLineString":case"Polygon":i(e.arcs);break;case"MultiPolygon":a(e.arcs)}}var l,u=[],c=[];return s(t),c.forEach(null==r?function(e){u.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&u.push(e[0].i)}),u}function planarRingArea(e){for(var t,r=-1,n=e.length,o=e[n-1],i=0;++r<n;)t=o,o=e[r],i+=t[0]*o[1]-t[1]*o[0];return Math.abs(i)}var simplify_1=simplify$1,convert_1=convert$1,simplify=simplify_1,tile=transformTile,point=transformPoint,transform$1={tile:tile,point:point},clip_1=clip$1,clip$2=clip_1,wrap_1=wrap$1,tile$1=createTile$1,index=geojsonvt,convert=convert_1,transform=transform$1,clip=clip_1,wrap=wrap_1,createTile=tile$1;GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,r,n,o,i,a){for(var s=this,l=[e,t,r,n],u=this.options,c=u.debug,f=null;l.length;){n=l.pop(),r=l.pop(),t=l.pop(),e=l.pop();var p=1<<t,h=toID(t,r,n),m=s.tiles[h],g=t===u.maxZoom?0:u.tolerance/(p*u.extent);if(!m&&(c>1&&console.time("creation"),m=s.tiles[h]=createTile(e,p,r,n,g,t===u.maxZoom),s.tileCoords.push({z:t,x:r,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var d="z"+t;s.stats[d]=(s.stats[d]||0)+1,s.total++}if(m.source=e,o){if(t===u.maxZoom||t===o)continue;var v=1<<o-t;if(r!==Math.floor(i/v)||n!==Math.floor(a/v))continue}else if(t===u.indexMaxZoom||m.numPoints<=u.indexMaxPoints)continue;if(u.solidChildren||!isClippedSquare(m,u.extent,u.buffer)){m.source=null,c>1&&console.time("clipping");var y,x,b,M,P,S,w=.5*u.buffer/u.extent,$=.5-w,C=.5+w,F=1+w;y=x=b=M=null,P=clip(e,p,r-w,r+C,0,intersectX,m.min[0],m.max[0]),S=clip(e,p,r+$,r+F,0,intersectX,m.min[0],m.max[0]),P&&(y=clip(P,p,n-w,n+C,1,intersectY,m.min[1],m.max[1]),x=clip(P,p,n+$,n+F,1,intersectY,m.min[1],m.max[1])),S&&(b=clip(S,p,n-w,n+C,1,intersectY,m.min[1],m.max[1]),M=clip(S,p,n+$,n+F,1,intersectY,m.min[1],m.max[1])),c>1&&console.timeEnd("clipping"),y&&l.push(y,t+1,2*r,2*n),x&&l.push(x,t+1,2*r,2*n+1),b&&l.push(b,t+1,2*r+1,2*n),M&&l.push(M,t+1,2*r+1,2*n+1)}else o&&(f=t)}return f},GeoJSONVT.prototype.getTile=function(e,t,r){var n=this,o=this.options,i=o.extent,a=o.debug,s=1<<e;t=(t%s+s)%s;var l=toID(e,t,r);if(this.tiles[l])return transform.tile(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u,c=e,f=t,p=r;!u&&c>0;)c--,f=Math.floor(f/2),p=Math.floor(p/2),u=n.tiles[toID(c,f,p)];if(!u||!u.source)return null;if(a>1&&console.log("found parent tile z%d-%d-%d",c,f,p),isClippedSquare(u,i,o.buffer))return transform.tile(u,i);a>1&&console.time("drilling down");var h=this.splitTile(u.source,c,f,p,e,t,r);if(a>1&&console.timeEnd("drilling down"),null!==h){var m=1<<e-h;l=toID(h,Math.floor(t/m),Math.floor(r/m))}return this.tiles[l]?transform.tile(this.tiles[l],i):null};var identity=function(e){return e},transform$3=function(e){if(null==(t=e.transform))return identity;var t,r,n,o=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(e,t){return t||(r=n=0),e[0]=(r+=e[0])*o+a,e[1]=(n+=e[1])*i+s,e}},bbox=function(e){function t(e){s[0]=e[0],s[1]=e[1],a(s),s[0]<l&&(l=s[0]),s[0]>c&&(c=s[0]),s[1]<u&&(u=s[1]),s[1]>f&&(f=s[1])}function r(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(r);break;case"Point":t(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(t)}}var n=e.bbox;if(!n){var o,i,a=transform$3(e),s=new Array(2),l=1/0,u=l,c=-l,f=-l;e.arcs.forEach(function(e){for(var t=-1,r=e.length;++t<r;)o=e[t],s[0]=o[0],s[1]=o[1],a(s,t),s[0]<l&&(l=s[0]),s[0]>c&&(c=s[0]),s[1]<u&&(u=s[1]),s[1]>f&&(f=s[1])});for(i in e.objects)r(e.objects[i]);n=e.bbox=[l,u,c,f]}return n},reverse=function(e,t){for(var r,n=e.length,o=n-t;o<--n;)r=e[o],e[o++]=e[n],e[n]=r},feature=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return feature$1(e,t)})}:feature$1(e,t)},stitch=function(e,t){function r(t){var r,n=e.arcs[t<0?~t:t],o=n[0];return e.transform?(r=[0,0],n.forEach(function(e){r[0]+=e[0],r[1]+=e[1]})):r=n[n.length-1],t<0?[r,o]:[o,r]}function n(e,t){for(var r in e){var n=e[r];delete t[n.start],delete n.start,delete n.end,n.forEach(function(e){o[e<0?~e:e]=1}),s.push(n)}}var o={},i={},a={},s=[],l=-1;return t.forEach(function(r,n){var o,i=e.arcs[r<0?~r:r];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++l],t[l]=r,t[n]=o)}),t.forEach(function(e){var t,n,o=r(e),s=o[0],l=o[1];if(t=a[s])if(delete a[t.end],t.push(e),t.end=l,n=i[l]){delete i[n.start];var u=n===t?t:t.concat(n);i[u.start=t.start]=a[u.end=n.end]=u}else i[t.start]=a[t.end]=t;else if(t=i[l])if(delete i[t.start],t.unshift(e),t.start=s,n=a[s]){delete a[n.end];var c=n===t?t:n.concat(t);i[c.start=n.start]=a[c.end=t.end]=c}else i[t.start]=a[t.end]=t;else t=[e],i[t.start=s]=a[t.end=l]=t}),n(a,i),n(i,a),t.forEach(function(e){o[e<0?~e:e]||s.push([e])}),s},bisect=function(e,t){for(var r=0,n=e.length;r<n;){var o=r+n>>>1;e[o]<t?r=o+1:n=o}return r},slicers={},options;onmessage=function(e){if("slice"===e.data[0]){var t=e.data[1];if(options=e.data[2],t.type&&"Topology"===t.type)for(var r in t.objects)slicers[r]=index(feature(t,t.objects[r]),options);else slicers[options.vectorTileLayerName]=index(t,options)}else if("get"===e.data[0]){var n=e.data[1],o={};for(var r in slicers){var i=slicers[r].getTile(n.z,n.x,n.y);if(i){var a={features:[],extent:options.extent,name:options.vectorTileLayerName,length:i.features.length};for(var s in i.features){var l={geometry:i.features[s].geometry,properties:i.features[s].tags,type:i.features[s].type};a.features.push(l)}o[r]=a}}postMessage({layers:o,coords:n})}};
`,"text/plain; charset=us-ascii",!1);L.VectorGrid.Slicer=L.VectorGrid.extend({options:{vectorTileLayerName:"sliced",extent:4096,maxZoom:14},initialize:function(d,v){L.VectorGrid.prototype.initialize.call(this,v);var v={};for(var y in this.options)y!=="rendererFactory"&&y!=="vectorTileLayerStyles"&&typeof this.options[y]!="function"&&(v[y]=this.options[y]);this._worker=new Worker(vq),this._worker.postMessage(["slice",d,v])},_getVectorTilePromise:function(d){var h=this,v=new Promise(function(y){h._worker.addEventListener("message",function T(n){n.data.coords&&n.data.coords.x===d.x&&n.data.coords.y===d.y&&n.data.coords.z===d.z&&(y(n.data),h._worker.removeEventListener("message",T))})});return this._worker.postMessage(["get",d]),v}}),L.vectorGrid.slicer=function(d,h){return new L.VectorGrid.Slicer(d,h)},L.Canvas.Tile=L.Canvas.extend({initialize:function(d,h,v){L.Canvas.prototype.initialize.call(this,v),this._tileCoord=d,this._size=h,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._layers={},this._drawnLayers={},this._drawing=!0,v.interactive&&(this._container.style.pointerEvents="auto")},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},getOffset:function(){return this._tileCoord.scaleBy(this._size).subtract(this._map.getPixelOrigin())},onAdd:L.Util.falseFn,addTo:function(d){this._map=d},removeFrom:function(d){delete this._map},_onClick:function(d){var h,v,y=this._map.mouseEventToLayerPoint(d).subtract(this.getOffset());for(var T in this._layers)h=this._layers[T],h.options.interactive&&h._containsPoint(y)&&!this._map._draggableMoved(h)&&(v=h);v&&(L.DomEvent.fakeStop(d),this._fireEvent([v],d))},_onMouseMove:function(d){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var h=this._map.mouseEventToLayerPoint(d).subtract(this.getOffset());this._handleMouseHover(d,h)}},_updateIcon:function(d){if(this._drawing){var h=d.options.icon,v=h.options,y=L.point(v.iconSize),T=v.iconAnchor||y&&y.divideBy(2,!0),n=d._point.subtract(T),R=this._ctx,j=d._getImage();j.complete?R.drawImage(j,n.x,n.y,y.x,y.y):L.DomEvent.on(j,"load",function(){R.drawImage(j,n.x,n.y,y.x,y.y)}),this._drawnLayers[d._leaflet_id]=d}}}),L.canvas.tile=function(d,h,v){return new L.Canvas.Tile(d,h,v)};var n9=Fn(CO());var m1={};g3(m1,{default:()=>Aq,glyphs:()=>Sq,layers:()=>Eq,metadata:()=>wq,name:()=>bq,sources:()=>Cq,sprite:()=>Tq,version:()=>xq});var xq=8,bq="versatiles-colorful",wq={license:"https://creativecommons.org/publicdomain/zero/1.0/"},Sq="https://tiles.versatiles.org/assets/glyphs/{fontstack}/{range}.pbf",Tq=[{id:"basics",url:"https://tiles.versatiles.org/assets/sprites/basics/sprites"}],Cq={"versatiles-shortbread":{attribution:'\xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',tiles:["https://tiles.versatiles.org/tiles/osm/{z}/{x}/{y}"],type:"vector",scheme:"xyz",bounds:[-180,-85.0511287798066,180,85.0511287798066],minzoom:0,maxzoom:14}},Eq=[{id:"background",type:"background",paint:{"background-color":"rgb(249,244,238)"}},{source:"versatiles-shortbread",id:"water-ocean",type:"fill","source-layer":"ocean",paint:{"fill-color":"rgb(190,221,243)"}},{source:"versatiles-shortbread",id:"land-glacier",type:"fill","source-layer":"water_polygons",filter:["all",["==","kind","glacier"]],paint:{"fill-color":"rgb(255,255,255)"}},{source:"versatiles-shortbread",id:"land-commercial",type:"fill","source-layer":"land",filter:["all",["in","kind","commercial","retail"]],paint:{"fill-color":"rgb(215,215,215)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-industrial",type:"fill","source-layer":"land",filter:["all",["in","kind","industrial","quarry","railway"]],paint:{"fill-color":"rgba(235,232,218,0.333)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-residential",type:"fill","source-layer":"land",filter:["all",["in","kind","garages","residential"]],paint:{"fill-color":"rgb(215,215,215)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-agriculture",type:"fill","source-layer":"land",filter:["all",["in","kind","brownfield","farmland","farmyard","greenfield","greenhouse_horticulture","orchard","plant_nursery","vineyard"]],paint:{"fill-color":"rgb(224,228,222)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-waste",type:"fill","source-layer":"land",filter:["all",["in","kind","landfill"]],paint:{"fill-color":"rgb(221,219,212)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-park",type:"fill","source-layer":"land",filter:["all",["in","kind","park","village_green","recreation_ground"]],paint:{"fill-color":"rgb(221,221,204)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-garden",type:"fill","source-layer":"land",filter:["all",["in","kind","allotments","garden"]],paint:{"fill-color":"rgb(221,221,204)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-burial",type:"fill","source-layer":"land",filter:["all",["in","kind","cemetery","grave_yard"]],paint:{"fill-color":"rgb(221,221,216)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-leisure",type:"fill","source-layer":"land",filter:["all",["in","kind","miniature_golf","playground","golf_course"]],paint:{"fill-color":"rgb(228,232,226)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-rock",type:"fill","source-layer":"land",filter:["all",["in","kind","bare_rock","scree","shingle"]],paint:{"fill-color":"rgb(224,228,229)"}},{source:"versatiles-shortbread",id:"land-forest",type:"fill","source-layer":"land",filter:["all",["in","kind","forest"]],paint:{"fill-color":"rgb(210,220,205)","fill-opacity":{stops:[[5,0],[6,.2]]}}},{source:"versatiles-shortbread",id:"land-grass",type:"fill","source-layer":"land",filter:["all",["in","kind","grass","grassland","meadow","wet_meadow"]],paint:{"fill-color":"rgb(224,232,221)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-vegetation",type:"fill","source-layer":"land",filter:["all",["in","kind","heath","scrub"]],paint:{"fill-color":"rgb(221,221,204)","fill-opacity":{stops:[[5,0],[6,1]]}}},{source:"versatiles-shortbread",id:"land-sand",type:"fill","source-layer":"land",filter:["all",["in","kind","beach","sand"]],paint:{"fill-color":"rgb(250,250,237)"}},{source:"versatiles-shortbread",id:"land-wetland",type:"fill","source-layer":"land",filter:["all",["in","kind","bog","marsh","string_bog","swamp"]],paint:{"fill-color":"rgb(211,230,219)"}},{source:"versatiles-shortbread",id:"water-river",type:"line","source-layer":"water_lines",filter:["all",["in","kind","river"],["!=","tunnel",!0],["!=","bridge",!0]],paint:{"line-color":"rgb(190,221,243)","line-width":{stops:[[9,0],[10,3],[15,5],[17,9],[18,20],[20,60]]}},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"water-canal",type:"line","source-layer":"water_lines",filter:["all",["in","kind","canal"],["!=","tunnel",!0],["!=","bridge",!0]],paint:{"line-color":"rgb(190,221,243)","line-width":{stops:[[9,0],[10,2],[15,4],[17,8],[18,17],[20,50]]}},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"water-stream",type:"line","source-layer":"water_lines",filter:["all",["in","kind","stream"],["!=","tunnel",!0],["!=","bridge",!0]],paint:{"line-color":"rgb(190,221,243)","line-width":{stops:[[13,0],[14,1],[15,2],[17,6],[18,12],[20,30]]}},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"water-ditch",type:"line","source-layer":"water_lines",filter:["all",["in","kind","ditch"],["!=","tunnel",!0],["!=","bridge",!0]],paint:{"line-color":"rgb(190,221,243)","line-width":{stops:[[14,0],[15,1],[17,4],[18,8],[20,20]]}},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"water-area",type:"fill","source-layer":"water_polygons",filter:["==","kind","water"],paint:{"fill-color":"rgb(190,221,243)","fill-opacity":{stops:[[4,0],[6,1]]}}},{source:"versatiles-shortbread",id:"water-area-river",type:"fill","source-layer":"water_polygons",filter:["==","kind","river"],paint:{"fill-color":"rgb(190,221,243)","fill-opacity":{stops:[[4,0],[6,1]]}}},{source:"versatiles-shortbread",id:"water-area-small",type:"fill","source-layer":"water_polygons",filter:["in","kind","reservoir","basin","dock"],paint:{"fill-color":"rgb(190,221,243)","fill-opacity":{stops:[[4,0],[6,1]]}}},{source:"versatiles-shortbread",id:"water-dam-area",type:"fill","source-layer":"dam_polygons",filter:["==","kind","dam"],paint:{"fill-color":"rgb(249,244,238)","fill-opacity":{stops:[[12,0],[13,1]]}}},{source:"versatiles-shortbread",id:"water-dam",type:"line","source-layer":"dam_lines",filter:["==","kind","dam"],paint:{"line-color":"rgb(190,221,243)"},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"water-pier-area",type:"fill","source-layer":"pier_polygons",filter:["in","kind","pier","breakwater","groyne"],paint:{"fill-color":"rgb(249,244,238)","fill-opacity":{stops:[[12,0],[13,1]]}}},{source:"versatiles-shortbread",id:"water-pier",type:"line","source-layer":"pier_lines",filter:["in","kind","pier","breakwater","groyne"],paint:{"line-color":"rgb(249,244,238)"},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"site-dangerarea",type:"fill","source-layer":"sites",filter:["in","kind","danger_area"],paint:{"fill-color":"rgb(255,0,0)","fill-outline-color":"rgb(255,0,0)","fill-opacity":.3,"fill-pattern":"basics:pattern-warning"}},{source:"versatiles-shortbread",id:"site-university",type:"fill","source-layer":"sites",filter:["in","kind","university"],paint:{"fill-color":"rgb(255,255,128)","fill-opacity":.1}},{source:"versatiles-shortbread",id:"site-college",type:"fill","source-layer":"sites",filter:["in","kind","college"],paint:{"fill-color":"rgb(255,255,128)","fill-opacity":.1}},{source:"versatiles-shortbread",id:"site-school",type:"fill","source-layer":"sites",filter:["in","kind","school"],paint:{"fill-color":"rgb(255,255,128)","fill-opacity":.1}},{source:"versatiles-shortbread",id:"site-hospital",type:"fill","source-layer":"sites",filter:["in","kind","hospital"],paint:{"fill-color":"rgb(255,102,102)","fill-opacity":.1}},{source:"versatiles-shortbread",id:"site-prison",type:"fill","source-layer":"sites",filter:["in","kind","prison"],paint:{"fill-color":"rgb(253,242,252)","fill-pattern":"basics:pattern-striped","fill-opacity":.1}},{source:"versatiles-shortbread",id:"site-parking",type:"fill","source-layer":"sites",filter:["in","kind","parking"],paint:{"fill-color":"rgb(235,232,230)"}},{source:"versatiles-shortbread",id:"site-bicycleparking",type:"fill","source-layer":"sites",filter:["in","kind","bicycle_parking"],paint:{"fill-color":"rgb(235,232,230)"}},{source:"versatiles-shortbread",id:"site-construction",type:"fill","source-layer":"sites",filter:["in","kind","construction"],paint:{"fill-color":"rgb(169,169,169)","fill-pattern":"basics:pattern-hatched_thin","fill-opacity":.1}},{source:"versatiles-shortbread",id:"airport-area",type:"fill","source-layer":"street_polygons",filter:["in","kind","runway","taxiway"],paint:{"fill-color":"rgb(255,255,255)","fill-opacity":.5}},{source:"versatiles-shortbread",id:"airport-taxiway:outline",type:"line","source-layer":"streets",filter:["==","kind","taxiway"],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[13,0],[14,2],[15,10],[16,14],[18,20],[20,40]]}},layout:{"line-join":"round"}},{source:"versatiles-shortbread",id:"airport-runway:outline",type:"line","source-layer":"streets",filter:["==","kind","runway"],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[11,0],[12,6],[13,9],[14,16],[15,24],[16,40],[17,100],[18,160],[20,300]]}},layout:{"line-join":"round"}},{source:"versatiles-shortbread",id:"airport-taxiway",type:"line","source-layer":"streets",filter:["==","kind","taxiway"],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[13,0],[14,1],[15,8],[16,12],[18,18],[20,36]]},"line-opacity":{stops:[[13,0],[14,1]]}},layout:{"line-join":"round"}},{source:"versatiles-shortbread",id:"airport-runway",type:"line","source-layer":"streets",filter:["==","kind","runway"],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[11,0],[12,5],[13,8],[14,14],[15,22],[16,38],[17,98],[18,158],[20,298]]},"line-opacity":{stops:[[11,0],[12,1]]}},layout:{"line-join":"round"}},{source:"versatiles-shortbread",id:"building:outline",type:"fill","source-layer":"buildings",paint:{"fill-color":"rgb(223,219,215)","fill-opacity":{stops:[[14,0],[15,1]]}}},{source:"versatiles-shortbread",id:"building",type:"fill","source-layer":"buildings",paint:{"fill-color":"rgb(242,234,226)","fill-opacity":{stops:[[14,0],[15,1]]},"fill-translate":[-2,-2]}},{source:"versatiles-shortbread",id:"tunnel-street-pedestrian-zone",type:"fill","source-layer":"street_polygons",filter:["all",["==","tunnel",!0],["==","kind","pedestrian"]],paint:{"fill-color":"rgb(247,247,247)","fill-opacity":{stops:[[12,0],[13,1]]}}},{source:"versatiles-shortbread",id:"tunnel-way-footway:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","footway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"hsl(288,13%,86%)"},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-steps:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","steps"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"hsl(288,13%,86%)"},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-path:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","path"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"hsl(288,13%,86%)"},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-cycleway:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","cycleway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"hsl(203,11%,87%)"},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-street-track:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","tunnel",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[14,2],[16,4],[18,18],[19,48],[20,96]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-pedestrian:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","tunnel",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-service:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[14,1],[16,3],[18,12],[19,32],[20,48]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-livingstreet:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","tunnel",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-residential:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","tunnel",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-unclassified:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","tunnel",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-tertiary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-secondary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-dasharray":[1,.3],"line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-primary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-dasharray":[1,.3],"line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-trunk-link:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-dasharray":[1,.3],"line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-motorway-link:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-dasharray":[1,.3],"line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:12},{source:"versatiles-shortbread",id:"tunnel-street-tertiary:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(222,222,222)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-secondary:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(215,215,215)","line-dasharray":[1,.3],"line-width":{stops:[[11,2],[14,5],[16,8],[18,30],[19,68],[20,138]]},"line-opacity":{stops:[[11,0],[12,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-primary:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-dasharray":[1,.3],"line-width":{stops:[[8,0],[9,1],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-trunk:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-dasharray":[1,.3],"line-width":{stops:[[7,0],[8,2],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-motorway:outline",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-dasharray":[1,.3],"line-width":{stops:[[5,0],[6,2],[10,5],[14,5],[16,14],[18,38],[19,84],[20,168]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-way-footway",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","footway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"hsl(288,33%,94%)","line-dasharray":[1,.2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-steps",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","steps"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"hsl(288,33%,94%)","line-dasharray":[1,.2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-path",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","path"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"hsl(288,33%,94%)","line-dasharray":[1,.2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-way-cycleway",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","cycleway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"hsl(203,30%,95%)","line-dasharray":[1,.2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-street-track",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[14,1],[16,3],[18,16],[19,44],[20,88]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-pedestrian",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-service",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[14,1],[16,2],[18,10],[19,28],[20,40]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-livingstreet",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-residential",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-unclassified",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-track-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)"},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-pedestrian-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-service-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)"},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-livingstreet-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-residential-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-unclassified-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bicycle","designated"],["==","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-tertiary-link",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-secondary-link",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-primary-link",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-trunk-link",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"tunnel-street-motorway-link",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:12},{source:"versatiles-shortbread",id:"tunnel-street-tertiary",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"tunnel-street-secondary",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(240,240,240)","line-width":{stops:[[11,1],[14,4],[16,6],[18,28],[19,64],[20,130]]},"line-opacity":{stops:[[11,0],[12,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"tunnel-street-primary",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(240,240,240)","line-width":{stops:[[8,0],[9,2],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[8,0],[9,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"tunnel-street-trunk",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(240,240,240)","line-width":{stops:[[7,0],[8,1],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[7,0],[8,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"tunnel-street-motorway",type:"line","source-layer":"streets",filter:["all",["==","tunnel",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(240,240,240)","line-width":{stops:[[5,0],[6,1],[10,4],[14,4],[16,12],[18,36],[19,80],[20,160]]},"line-opacity":{stops:[[5,0],[6,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"tunnel-transport-tram:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["==","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"tunnel-transport-narrowgauge:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["==","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"tunnel-transport-subway:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(166,184,199)","line-width":{stops:[[11,0],[12,1],[15,3],[16,3],[18,6],[19,8],[20,10]]},"line-opacity":{stops:[[11,0],[12,.5]]}}},{source:"versatiles-shortbread",id:"tunnel-transport-lightrail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[11,0],[12,.5]]}},minzoom:8},{source:"versatiles-shortbread",id:"tunnel-transport-lightrail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"tunnel-transport-rail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[8,0],[9,.3]]}},minzoom:8},{source:"versatiles-shortbread",id:"tunnel-transport-rail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"tunnel-transport-monorail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["==","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"tunnel-transport-funicular:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["==","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"tunnel-transport-tram",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["==","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"tunnel-transport-narrowgauge",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["==","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"tunnel-transport-subway",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(188,202,213)","line-width":{stops:[[11,0],[12,1],[15,2],[16,2],[18,5],[19,6],[20,8]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}}},{source:"versatiles-shortbread",id:"tunnel-transport-lightrail",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}},minzoom:14},{source:"versatiles-shortbread",id:"tunnel-transport-lightrail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-transport-rail",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,.3]]}},minzoom:14},{source:"versatiles-shortbread",id:"tunnel-transport-rail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["==","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"tunnel-transport-monorail",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["==","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"tunnel-transport-funicular",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["==","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"bridge",type:"fill","source-layer":"bridges",paint:{"fill-color":"rgb(244,239,233)","fill-antialias":!0,"fill-opacity":.8}},{source:"versatiles-shortbread",id:"street-pedestrian-zone",type:"fill","source-layer":"street_polygons",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["==","kind","pedestrian"]],paint:{"fill-color":"rgba(251,235,255,0.25)","fill-opacity":{stops:[[12,0],[13,1],[14,0],[15,1]]}}},{source:"versatiles-shortbread",id:"way-footway:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","footway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"way-steps:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","steps"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"way-path:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","path"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"way-cycleway:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","cycleway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(215,224,230)"},minzoom:15},{source:"versatiles-shortbread",id:"street-track:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[14,2],[16,4],[18,18],[19,48],[20,96]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-pedestrian:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-service:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[14,1],[16,3],[18,12],[19,32],[20,48]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-livingstreet:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-residential:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-unclassified:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-tertiary-link:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-secondary-link:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-primary-link:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-trunk-link:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-motorway-link:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:12},{source:"versatiles-shortbread",id:"street-tertiary:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(207,205,202)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-secondary:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-width":{stops:[[7,0],[8,1],[10,4],[14,4],[16,12],[18,36],[19,80],[20,160]]},"line-opacity":{stops:[[5,0],[6,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-primary:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-width":{stops:[[8,0],[9,1],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-trunk:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-width":{stops:[[7,0],[8,2],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"boundary-state:outline",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",4],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(250,245,240)","line-blur":2,"line-width":{stops:[[5,0],[6,2],[10,4]]},"line-opacity":.75},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"boundary-state",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",4],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(150,150,150)","line-width":{stops:[[5,0],[6,1],[10,2]]},"line-dasharray":[2,2]},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"street-motorway:outline",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(220,220,220)","line-width":{stops:[[7,0],[8,1],[10,4],[14,4],[16,12],[18,36],[19,80],[20,160]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"way-footway",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","footway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"way-steps",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","steps"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"way-path",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","path"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"way-cycleway",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","cycleway"]],layout:{"line-cap":"round"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(239,249,255)"},minzoom:15},{source:"versatiles-shortbread",id:"street-track",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[14,1],[16,3],[18,16],[19,44],[20,88]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-pedestrian",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(251,235,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,0],[14,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-service",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[14,1],[16,2],[18,10],[19,28],[20,40]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-livingstreet",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-residential",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-unclassified",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-track-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)"},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-pedestrian-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-service-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(255,255,255)"},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-livingstreet-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-residential-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-unclassified-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bicycle","designated"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-tertiary-link",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-secondary-link",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(255,238,170)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-primary-link",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(255,238,170)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-trunk-link",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(255,238,170)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:13},{source:"versatiles-shortbread",id:"street-motorway-link",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(255,204,136)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"round"},minzoom:12},{source:"versatiles-shortbread",id:"street-tertiary",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-secondary",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[7,0],[8,0],[10,3],[14,3],[16,10],[18,34],[19,78],[20,158]]},"line-opacity":{stops:[[5,0],[6,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-primary",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[8,0],[9,2],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[8,0],[9,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-trunk",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[7,0],[8,1],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[7,0],[8,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"street-motorway",type:"line","source-layer":"streets",filter:["all",["!=","bridge",!0],["!=","tunnel",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[7,0],[8,0],[10,3],[14,3],[16,10],[18,34],[19,78],[20,158]]},"line-opacity":{stops:[[5,0],[6,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"transport-tram:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"transport-narrowgauge:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"transport-subway:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(166,184,199)","line-width":{stops:[[11,0],[12,1],[15,3],[16,3],[18,6],[19,8],[20,10]]},"line-opacity":{stops:[[11,0],[12,1]]}}},{source:"versatiles-shortbread",id:"transport-lightrail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[11,0],[12,1]]}},minzoom:8},{source:"versatiles-shortbread",id:"transport-lightrail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"transport-rail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[8,0],[9,1]]}},minzoom:8},{source:"versatiles-shortbread",id:"transport-rail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"transport-monorail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"transport-funicular:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"transport-tram",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"transport-narrowgauge",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"transport-subway",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(188,202,213)","line-width":{stops:[[11,0],[12,1],[15,2],[16,2],[18,5],[19,6],[20,8]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}}},{source:"versatiles-shortbread",id:"transport-lightrail",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}},minzoom:14},{source:"versatiles-shortbread",id:"transport-lightrail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"transport-rail",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}},minzoom:14},{source:"versatiles-shortbread",id:"transport-rail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["!=","bridge",!0],["!=","tunnel",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"transport-monorail",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"transport-funicular",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["!=","bridge",!0],["!=","tunnel",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"transport-ferry",type:"line","source-layer":"ferries",minzoom:10,paint:{"line-color":"rgb(171,199,219)","line-width":{stops:[[10,1],[13,2],[14,3],[16,4],[17,6]]},"line-opacity":{stops:[[10,0],[11,1]]},"line-dasharray":[1,1]}},{source:"versatiles-shortbread",id:"bridge-way-footway:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","footway"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[15,0],[16,7],[18,10],[19,17],[20,31]]}},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-steps:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","steps"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[15,0],[16,7],[18,10],[19,17],[20,31]]}},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-path:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","path"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[15,0],[16,7],[18,10],[19,17],[20,31]]}},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-cycleway:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","cycleway"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[15,0],[16,7],[18,10],[19,17],[20,31]]}},minzoom:15},{source:"versatiles-shortbread",id:"bridge-street-track:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[14,0],[15,1]]},"line-width":{stops:[[14,3],[16,6],[18,25],[19,67],[20,134]]}}},{source:"versatiles-shortbread",id:"bridge-street-pedestrian:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-service:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[14,0],[15,1]]},"line-width":{stops:[[14,3],[16,6],[18,25],[19,67],[20,134]]}}},{source:"versatiles-shortbread",id:"bridge-street-livingstreet:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-residential:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-unclassified:bridge",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bridge",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-tertiary-link:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["==","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-secondary-link:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["==","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[12,3],[14,4],[16,10],[18,20],[20,56]]}},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-primary-link:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["==","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[12,3],[14,4],[16,10],[18,20],[20,56]]}},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-trunk-link:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["==","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[12,3],[14,4],[16,10],[18,20],[20,56]]}},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-motorway-link:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["==","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[12,3],[14,4],[16,10],[18,20],[20,56]]}},minzoom:12},{source:"versatiles-shortbread",id:"bridge-street-tertiary:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["!=","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[12,0],[13,1]]},"line-width":{stops:[[12,3],[14,4],[16,8],[18,36],[19,90],[20,179]]}}},{source:"versatiles-shortbread",id:"bridge-street-secondary:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["!=","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":{stops:[[11,0],[12,1]]},"line-width":{stops:[[11,3],[14,7],[16,11],[18,42],[19,95],[20,193]]}}},{source:"versatiles-shortbread",id:"bridge-street-primary:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["!=","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[8,0],[9,1],[10,6],[14,8],[16,17],[18,50],[19,104],[20,202]]}}},{source:"versatiles-shortbread",id:"bridge-street-trunk:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["!=","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[7,0],[8,3],[10,6],[14,8],[16,17],[18,50],[19,104],[20,202]]}}},{source:"versatiles-shortbread",id:"bridge-street-motorway:bridge",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["!=","link",!0]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"rgb(244,239,233)","line-opacity":.5,"line-width":{stops:[[5,0],[6,3],[10,7],[14,7],[16,20],[18,53],[19,118],[20,235]]}}},{source:"versatiles-shortbread",id:"bridge-street-pedestrian-zone",type:"fill","source-layer":"street_polygons",filter:["all",["==","bridge",!0],["==","kind","pedestrian"]],paint:{"fill-color":"rgb(255,255,255)","fill-opacity":{stops:[[12,0],[13,1]]}}},{source:"versatiles-shortbread",id:"bridge-way-footway:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","footway"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-steps:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","steps"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-path:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","path"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(226,212,230)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-cycleway:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","cycleway"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,5],[18,7],[19,12],[20,22]]},"line-color":"rgb(215,224,230)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-street-track:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bridge",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[14,2],[16,4],[18,18],[19,48],[20,96]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-pedestrian:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bridge",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-service:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bridge",!0]],paint:{"line-color":"rgb(221,220,218)","line-width":{stops:[[14,1],[16,3],[18,12],[19,32],[20,48]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-livingstreet:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bridge",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-residential:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bridge",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-unclassified:outline",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bridge",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-tertiary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-secondary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-primary-link:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-trunk-link:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-motorway-link:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[12,2],[14,3],[16,7],[18,14],[20,40]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:12},{source:"versatiles-shortbread",id:"bridge-street-tertiary:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(217,217,217)","line-width":{stops:[[12,2],[14,3],[16,6],[18,26],[19,64],[20,128]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-secondary:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[11,2],[14,5],[16,8],[18,30],[19,68],[20,138]]},"line-opacity":{stops:[[11,0],[12,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-primary:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[8,0],[9,1],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-trunk:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[7,0],[8,2],[10,4],[14,6],[16,12],[18,36],[19,74],[20,144]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-motorway:outline",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(233,172,119)","line-width":{stops:[[5,0],[6,2],[10,5],[14,5],[16,14],[18,38],[19,84],[20,168]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-way-footway",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","footway"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-steps",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","steps"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-path",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","path"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(251,235,255)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-way-cycleway",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","cycleway"]],layout:{"line-cap":"butt"},paint:{"line-width":{stops:[[15,0],[16,4],[18,6],[19,10],[20,20]]},"line-color":"rgb(239,249,255)"},minzoom:15},{source:"versatiles-shortbread",id:"bridge-street-track",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[14,1],[16,3],[18,16],[19,44],[20,88]]},"line-opacity":{stops:[[14,0],[15,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-pedestrian",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-service",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bridge",!0]],paint:{"line-color":"rgb(247,247,247)","line-width":{stops:[[14,1],[16,2],[18,10],[19,28],[20,40]]},"line-opacity":{stops:[[15,0],[16,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-livingstreet",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-residential",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-unclassified",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-track-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","track"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)"},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-pedestrian-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","pedestrian"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"bridge-street-service-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","service"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(255,255,255)"},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-livingstreet-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","living_street"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"bridge-street-residential-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","residential"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"bridge-street-unclassified-bicycle",type:"line","source-layer":"streets",filter:["all",["==","kind","unclassified"],["==","bicycle","designated"],["==","bridge",!0]],paint:{"line-color":"rgb(239,249,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"round"}},{source:"versatiles-shortbread",id:"bridge-street-tertiary-link",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["==","link",!0]],paint:{"line-color":"rgb(255,255,255)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-secondary-link",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-primary-link",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-trunk-link",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:13},{source:"versatiles-shortbread",id:"bridge-street-motorway-link",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["==","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,12],[20,38]]}},layout:{"line-join":"round","line-cap":"butt"},minzoom:12},{source:"versatiles-shortbread",id:"bridge-street-tertiary",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","tertiary"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[12,1],[14,2],[16,5],[18,24],[19,60],[20,120]]},"line-opacity":{stops:[[12,0],[13,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-secondary",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","secondary"],["!=","link",!0]],paint:{"line-color":"rgb(215,215,215)","line-width":{stops:[[11,1],[14,4],[16,6],[18,28],[19,64],[20,130]]},"line-opacity":{stops:[[11,0],[12,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-primary",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","primary"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[8,0],[9,2],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[8,0],[9,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-trunk",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","trunk"],["!=","link",!0]],paint:{"line-color":"rgb(215,215,215)","line-width":{stops:[[7,0],[8,1],[10,3],[14,5],[16,10],[18,34],[19,70],[20,140]]},"line-opacity":{stops:[[7,0],[8,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-street-motorway",type:"line","source-layer":"streets",filter:["all",["==","bridge",!0],["in","kind","motorway"],["!=","link",!0]],paint:{"line-color":"rgb(235,235,235)","line-width":{stops:[[7,0],[8,0],[10,3],[14,3],[16,10],[18,34],[19,78],[20,158]]},"line-opacity":{stops:[[5,0],[6,1]]}},layout:{"line-join":"round","line-cap":"butt"}},{source:"versatiles-shortbread",id:"bridge-transport-tram:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["==","bridge",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"bridge-transport-narrowgauge:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["==","bridge",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"bridge-transport-subway:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(166,184,199)","line-width":{stops:[[11,0],[12,1],[15,3],[16,3],[18,6],[19,8],[20,10]]},"line-opacity":{stops:[[11,0],[12,1]]}}},{source:"versatiles-shortbread",id:"bridge-transport-lightrail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[11,0],[12,1]]}},minzoom:8},{source:"versatiles-shortbread",id:"bridge-transport-lightrail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"bridge-transport-rail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[8,1],[13,1],[15,1],[20,14]]},"line-opacity":{stops:[[8,0],[9,1]]}},minzoom:8},{source:"versatiles-shortbread",id:"bridge-transport-rail-service:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[14,0],[15,1],[16,1],[20,14]]}},minzoom:14},{source:"versatiles-shortbread",id:"bridge-transport-monorail:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["==","bridge",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"bridge-transport-funicular:outline",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["==","bridge",!0]],minzoom:15,paint:{"line-color":"rgb(177,187,196)","line-width":{stops:[[15,0],[16,5],[18,7],[20,20]]},"line-dasharray":[.1,.5]}},{source:"versatiles-shortbread",id:"bridge-transport-tram",type:"line","source-layer":"streets",filter:["all",["in","kind","tram"],["!has","service"],["==","bridge",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"bridge-transport-narrowgauge",type:"line","source-layer":"streets",filter:["all",["in","kind","narrow_gauge"],["!has","service"],["==","bridge",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"bridge-transport-subway",type:"line","source-layer":"streets",filter:["all",["in","kind","subway"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(188,202,213)","line-width":{stops:[[11,0],[12,1],[15,2],[16,2],[18,5],[19,6],[20,8]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}}},{source:"versatiles-shortbread",id:"bridge-transport-lightrail",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}},minzoom:14},{source:"versatiles-shortbread",id:"bridge-transport-lightrail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","light_rail"],["has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"bridge-transport-rail",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["!has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[14,0],[15,1],[20,10]]},"line-dasharray":[2,2],"line-opacity":{stops:[[14,0],[15,1]]}},minzoom:14},{source:"versatiles-shortbread",id:"bridge-transport-rail-service",type:"line","source-layer":"streets",filter:["all",["in","kind","rail"],["has","service"],["==","bridge",!0]],paint:{"line-color":"rgb(197,204,211)","line-width":{stops:[[15,0],[16,1],[20,10]]},"line-dasharray":[2,2]},minzoom:15},{source:"versatiles-shortbread",id:"bridge-transport-monorail",type:"line","source-layer":"streets",filter:["all",["in","kind","monorail"],["==","bridge",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"bridge-transport-funicular",type:"line","source-layer":"streets",filter:["all",["in","kind","funicular"],["==","bridge",!0]],minzoom:13,paint:{"line-width":{stops:[[13,0],[16,1],[17,2],[18,3],[20,5]]},"line-color":"rgb(177,187,196)"}},{source:"versatiles-shortbread",id:"poi-amenity",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","amenity"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","amenity"],"arts_centre","basics:icon-art_gallery","atm","basics:icon-atm","bank","basics:icon-bank","bar","basics:icon-bar","bench","basics:icon-bench","bicycle_rental","basics:icon-bicycle_share","biergarten","basics:icon-beergarden","cafe","basics:icon-cafe","car_rental","basics:icon-car_rental","car_sharing","basics:icon-car_rental","car_wash","basics:icon-car_wash","cinema","basics:icon-cinema","college","basics:icon-college","community_centre","basics:icon-community","dentist","basics:icon-dentist","doctors","basics:icon-doctor","dog_park","basics:icon-dog_park","drinking_water","basics:icon-drinking_water","embassy","basics:icon-embassy","fast_food","basics:icon-fast_food","fire_station","basics:icon-fire_station","fountain","basics:icon-fountain","grave_yard","basics:icon-cemetery","hospital","basics:icon-hospital","hunting_stand","basics:icon-huntingstand","library","basics:icon-library","marketplace","basics:icon-marketplace","nightclub","basics:icon-nightclub","nursing_home","basics:icon-nursinghome","pharmacy","basics:icon-pharmacy","place_of_worship","basics:icon-place_of_worship","playground","basics:icon-playground","police","basics:icon-police","post_box","basics:icon-postbox","post_office","basics:icon-post","prison","basics:icon-prison","pub","basics:icon-beer","recycling","basics:icon-recycling","restaurant","basics:icon-restaurant","school","basics:icon-school","shelter","basics:icon-shelter","telephone","basics:icon-telephone","theatre","basics:icon-theatre","toilets","basics:icon-toilet","townhall","basics:icon-town_hall","vending_machine","basics:icon-vendingmachine","veterinary","basics:icon-veterinary","waste_basket","basics:icon-waste_basket",""],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-leisure",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","leisure"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","leisure"],"golf_course","basics:icon-golf","ice_rink","basics:icon-icerink","pitch","basics:icon-pitch","stadium","basics:icon-stadium","swimming_pool","basics:icon-swimming","water_park","basics:icon-waterpark","basics:icon-sports"],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-tourism",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","tourism"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","tourism"],"chalet","basics:icon-chalet","information","basics:transport-information","picnic_site","basics:icon-picnic_site","viewpoint","basics:icon-viewpoint","zoo","basics:icon-zoo",""],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-shop",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","shop"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","shop"],"alcohol","basics:icon-alcohol_shop","bakery","basics:icon-bakery","beauty","basics:icon-beauty","beverages","basics:icon-beverages","books","basics:icon-books","butcher","basics:icon-butcher","chemist","basics:icon-chemist","clothes","basics:icon-clothes","doityourself","basics:icon-doityourself","dry_cleaning","basics:icon-drycleaning","florist","basics:icon-florist","furniture","basics:icon-furniture","garden_centre","basics:icon-garden_centre","general","basics:icon-shop","gift","basics:icon-gift","greengrocer","basics:icon-greengrocer","hairdresser","basics:icon-hairdresser","hardware","basics:icon-hardware","jewelry","basics:icon-jewelry_store","kiosk","basics:icon-kiosk","laundry","basics:icon-laundry","newsagent","basics:icon-newsagent","optican","basics:icon-optician","outdoor","basics:icon-outdoor","shoes","basics:icon-shoes","sports","basics:icon-sports","stationery","basics:icon-stationery","toys","basics:icon-toys","travel_agency","basics:icon-travel_agent","video","basics:icon-video","basics:icon-shop"],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-man_made",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","man_made"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","man_made"],"lighthouse","basics:icon-lighthouse","surveillance","basics:icon-surveillance","tower","basics:icon-observation_tower","watermill","basics:icon-watermill","windmill","basics:icon-windmill",""],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-historic",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","historic"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","historic"],"artwork","basics:icon-artwork","castle","basics:icon-castle","monument","basics:icon-monument","wayside_shrine","basics:icon-shrine","basics:icon-historic"],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-emergency",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","emergency"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],"icon-image":["match",["get","emergency"],"defibrillator","basics:icon-defibrillator","fire_hydrant","basics:icon-hydrant","phone","basics:icon-emergency_phone",""],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-highway",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","highway"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"poi-office",type:"symbol","source-layer":"pois",filter:["to-boolean",["get","office"]],minzoom:16,layout:{"icon-size":{stops:[[16,.5],[19,.5],[20,1]]},"symbol-placement":"point","icon-optional":!0,"text-font":["noto_sans_regular"],visibility:"none"},paint:{"icon-opacity":{stops:[[16,0],[17,.4]]},"text-opacity":{stops:[[16,0],[17,.4]]},"icon-color":"rgb(85,85,85)","text-color":"rgb(85,85,85)"}},{source:"versatiles-shortbread",id:"boundary-country:outline",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",2],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(249,245,239)","line-blur":2,"line-width":{stops:[[2,0],[3,2],[10,8]]},"line-opacity":.75},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"boundary-country-disputed:outline",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",2],["==","disputed",!0],["!=","maritime",!0],["!=","coastline",!0]],paint:{"line-width":{stops:[[2,0],[3,2],[10,8]]},"line-opacity":.75,"line-color":"rgb(249,245,239)"}},{source:"versatiles-shortbread",id:"boundary-state:outline",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",4],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(250,245,240)","line-blur":2,"line-width":{stops:[[7,0],[8,2],[10,4]]},"line-opacity":.75},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"boundary-country",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",2],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(100,100,100)","line-width":{stops:[[2,0],[3,1],[10,4]]}},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"boundary-country-disputed",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",2],["==","disputed",!0],["!=","maritime",!0],["!=","coastline",!0]],paint:{"line-width":{stops:[[2,0],[3,1],[10,4]]},"line-color":"rgb(150,150,150)","line-dasharray":[2,1]},layout:{"line-cap":"square"}},{source:"versatiles-shortbread",id:"boundary-state",type:"line","source-layer":"boundaries",filter:["all",["==","admin_level",4],["!=","maritime",!0],["!=","disputed",!0],["!=","coastline",!0]],paint:{"line-color":"rgb(150,150,150)","line-width":{stops:[[7,0],[8,1],[10,2]]},"line-dasharray":[2,2]},layout:{"line-cap":"round","line-join":"round"}},{source:"versatiles-shortbread",id:"label-address-housenumber",type:"symbol","source-layer":"addresses",filter:["has","housenumber"],layout:{"text-field":"{housenumber}","text-font":["noto_sans_regular"],"symbol-placement":"point","text-anchor":"center","text-size":{stops:[[17,8],[19,10]]},visibility:"none"},paint:{"text-halo-color":"rgb(243,235,227)","text-halo-width":2,"text-halo-blur":1,"icon-color":"rgb(169,164,158)","text-color":"rgb(169,164,158)"},minzoom:17},{source:"versatiles-shortbread",id:"label-motorway-shield",type:"symbol","source-layer":"street_labels",filter:["==","kind","motorway"],layout:{"text-field":"{ref}","text-font":["noto_sans_bold"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[14,10],[18,12],[20,16]]}},paint:{"icon-color":"rgb(255,255,255)","text-color":"rgb(255,255,255)","text-halo-color":"rgb(255,204,136)","text-halo-width":.1,"text-halo-blur":1},minzoom:14},{source:"versatiles-shortbread",id:"label-street-pedestrian",type:"symbol","source-layer":"street_labels",filter:["==","kind","pedestrian"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-livingstreet",type:"symbol","source-layer":"street_labels",filter:["==","kind","living_street"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-residential",type:"symbol","source-layer":"street_labels",filter:["==","kind","residential"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-unclassified",type:"symbol","source-layer":"street_labels",filter:["==","kind","unclassified"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-tertiary",type:"symbol","source-layer":"street_labels",filter:["==","kind","tertiary"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-secondary",type:"symbol","source-layer":"street_labels",filter:["==","kind","secondary"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-primary",type:"symbol","source-layer":"street_labels",filter:["==","kind","primary"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-street-trunk",type:"symbol","source-layer":"street_labels",filter:["==","kind","trunk"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"symbol-placement":"line","text-anchor":"center","text-size":{stops:[[12,10],[15,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12},{source:"versatiles-shortbread",id:"label-place-neighbourhood",type:"symbol","source-layer":"place_labels",filter:["==","kind","neighbourhood"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[14,12]]},"text-transform":"uppercase"},paint:{"icon-color":"rgb(40,67,73)","text-color":"rgb(40,67,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:14},{source:"versatiles-shortbread",id:"label-place-quarter",type:"symbol","source-layer":"place_labels",filter:["==","kind","quarter"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[13,13]]},"text-transform":"uppercase"},paint:{"icon-color":"rgb(40,62,73)","text-color":"rgb(40,62,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:13},{source:"versatiles-shortbread",id:"label-place-suburb",type:"symbol","source-layer":"place_labels",filter:["==","kind","suburb"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[11,11],[13,14]]},"text-transform":"uppercase"},paint:{"icon-color":"rgb(40,57,73)","text-color":"rgb(40,57,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:11},{source:"versatiles-shortbread",id:"label-place-hamlet",type:"symbol","source-layer":"place_labels",filter:["==","kind","hamlet"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[10,11],[12,14]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:13},{source:"versatiles-shortbread",id:"label-place-village",type:"symbol","source-layer":"place_labels",filter:["==","kind","village"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[9,11],[12,14]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:11},{source:"versatiles-shortbread",id:"label-place-town",type:"symbol","source-layer":"place_labels",filter:["==","kind","town"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[8,11],[12,14]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:9},{source:"versatiles-shortbread",id:"label-boundary-state",type:"symbol","source-layer":"boundary_labels",filter:["in","admin_level",4,"4"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-transform":"uppercase","text-anchor":"top","text-offset":[0,.2],"text-padding":0,"text-optional":!0,"text-size":{stops:[[5,8],[8,12]]}},paint:{"icon-color":"rgb(61,61,77)","text-color":"rgb(61,61,77)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:5},{source:"versatiles-shortbread",id:"label-place-city",type:"symbol","source-layer":"place_labels",filter:["==","kind","city"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[7,11],[10,14]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:7},{source:"versatiles-shortbread",id:"label-place-statecapital",type:"symbol","source-layer":"place_labels",filter:["==","kind","state_capital"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[6,11],[10,15]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:6},{source:"versatiles-shortbread",id:"label-place-capital",type:"symbol","source-layer":"place_labels",filter:["==","kind","capital"],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-size":{stops:[[5,12],[10,16]]}},paint:{"icon-color":"rgb(40,48,73)","text-color":"rgb(40,48,73)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:5},{source:"versatiles-shortbread",id:"label-boundary-country-small",type:"symbol","source-layer":"boundary_labels",filter:["all",["in","admin_level",2,"2"],["<=","way_area",1e7]],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-transform":"uppercase","text-anchor":"top","text-offset":[0,.2],"text-padding":0,"text-optional":!0,"text-size":{stops:[[4,8],[5,11]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:4},{source:"versatiles-shortbread",id:"label-boundary-country-medium",type:"symbol","source-layer":"boundary_labels",filter:["all",["in","admin_level",2,"2"],["<","way_area",9e7],[">","way_area",1e7]],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-transform":"uppercase","text-anchor":"top","text-offset":[0,.2],"text-padding":0,"text-optional":!0,"text-size":{stops:[[3,8],[5,12]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:3},{source:"versatiles-shortbread",id:"label-boundary-country-large",type:"symbol","source-layer":"boundary_labels",filter:["all",["in","admin_level",2,"2"],[">=","way_area",9e7]],layout:{"text-field":"{name}","text-font":["noto_sans_regular"],"text-transform":"uppercase","text-anchor":"top","text-offset":[0,.2],"text-padding":0,"text-optional":!0,"text-size":{stops:[[2,8],[5,13]]}},paint:{"icon-color":"rgb(51,51,68)","text-color":"rgb(51,51,68)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:2},{source:"versatiles-shortbread",id:"marking-oneway",type:"symbol","source-layer":"streets",filter:["all",["==","oneway",!0],["in","kind","trunk","primary","secondary","tertiary","unclassified","residential","living_street"]],layout:{"symbol-placement":"line","symbol-spacing":175,"icon-rotate":90,"icon-rotation-alignment":"map","icon-padding":5,"symbol-avoid-edges":!0,"icon-image":"basics:marking-arrow",visibility:"none","text-font":["noto_sans_regular"]},minzoom:16,paint:{"icon-opacity":{stops:[[16,0],[17,.4],[20,.4]]},"text-opacity":{stops:[[16,0],[17,.4],[20,.4]]}}},{source:"versatiles-shortbread",id:"marking-oneway-reverse",type:"symbol","source-layer":"streets",filter:["all",["==","oneway_reverse",!0],["in","kind","trunk","primary","secondary","tertiary","unclassified","residential","living_street"]],layout:{"symbol-placement":"line","symbol-spacing":75,"icon-rotate":-90,"icon-rotation-alignment":"map","icon-padding":5,"symbol-avoid-edges":!0,"icon-image":"basics:marking-arrow",visibility:"none","text-font":["noto_sans_regular"]},minzoom:16,paint:{"icon-opacity":{stops:[[16,0],[17,.4],[20,.4]]},"text-opacity":{stops:[[16,0],[17,.4],[20,.4]]}}},{source:"versatiles-shortbread",id:"symbol-transit-bus",type:"symbol","source-layer":"public_transport",filter:["==","kind","bus_stop"],layout:{"text-field":"{name}","icon-size":{stops:[[16,.5],[18,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-bus",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:16},{source:"versatiles-shortbread",id:"symbol-transit-tram",type:"symbol","source-layer":"public_transport",filter:["==","kind","tram_stop"],layout:{"text-field":"{name}","icon-size":{stops:[[15,.5],[17,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:transport-tram",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:15},{source:"versatiles-shortbread",id:"symbol-transit-subway",type:"symbol","source-layer":"public_transport",filter:["all",["in","kind","station","halt"],["==","station","subway"]],layout:{"text-field":"{name}","icon-size":{stops:[[14,.5],[16,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-rail_metro",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:14},{source:"versatiles-shortbread",id:"symbol-transit-lightrail",type:"symbol","source-layer":"public_transport",filter:["all",["in","kind","station","halt"],["==","station","light_rail"]],layout:{"text-field":"{name}","icon-size":{stops:[[14,.5],[16,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-rail_light",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:14},{source:"versatiles-shortbread",id:"symbol-transit-station",type:"symbol","source-layer":"public_transport",filter:["all",["in","kind","station","halt"],["!in","station","light_rail","subway"]],layout:{"text-field":"{name}","icon-size":{stops:[[13,.5],[15,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-rail",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:13},{source:"versatiles-shortbread",id:"symbol-transit-airfield",type:"symbol","source-layer":"public_transport",filter:["all",["==","kind","aerodrome"],["!has","iata"]],layout:{"text-field":"{name}","icon-size":{stops:[[13,.5],[15,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-airfield",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:13},{source:"versatiles-shortbread",id:"symbol-transit-airport",type:"symbol","source-layer":"public_transport",filter:["all",["==","kind","aerodrome"],["has","iata"]],layout:{"text-field":"{name}","icon-size":{stops:[[12,.5],[14,1]]},"symbol-placement":"point","icon-keep-upright":!0,"text-font":["noto_sans_regular"],"text-size":10,"icon-anchor":"bottom","text-anchor":"top","icon-image":"basics:icon-airport",visibility:"none"},paint:{"icon-opacity":.7,"icon-color":"rgb(102,98,106)","text-color":"rgb(102,98,106)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":2,"text-halo-blur":1},minzoom:12}],Aq={version:xq,name:bq,metadata:wq,glyphs:Sq,sprite:Tq,sources:Cq,layers:Eq};var $m={};$m.wiki=ra.default.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png?lang=en",{attribution:'&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap contributors</a>'});$m.osm=ra.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>'});var g1={};g1.shortbread=ra.default.mapboxGL({style:m1});function EO(d,h,v,y,T,n,R){var j="en";document.documentElement.lang!==void 0&&(j=document.documentElement.lang);var Y={de:{zoomIn:"Vergr\xF6\xDFern",zoomOut:"Verkleinern",fullscreen:"Vollbildansicht",rotate:"Rotation zur\xFCcksetzen",rotateLeft:"90\xB0 nach links drehen",rotateRight:"90\xB0 nach rechst drehen"},en:{zoomIn:"Zoom in",zoomOut:"Zoom out",fullscreen:"Toggle full-screen"}},re;n!==void 0&&n in g1?re=g1[n]:v!==void 0&&v!==""?v in $m?re=$m[v]:re=ra.default.tileLayer(v):re=$m.osm;var me=ra.default.map(d,{layers:[re],zoomControl:!1,renderer:ra.default.svg()});ra.default.control.zoom({zoomInTitle:Y[j].zoomIn,zoomOutTitle:Y[j].zoomOut}).addTo(me),fetch(h).then(function(oe){oe.json().then(function(Se){let Re,tt={};if(T){if(typeof T!="object")try{T=JSON.parse(T)}catch{console.warn(`Can't parse marker ${T}`)}tt.icon=ra.default.icon(T)}if(y!==void 0&&y){Re=ra.default.markerClusterGroup({});let yt=ra.default.geoJSON(Se,{pointToLayer:function(qe,St){return ra.default.marker(St,tt)},onEachFeature:function(qe,St){if(qe.properties&&(qe.properties.name||qe.properties.popupContent)){let ai="";qe.properties.name&&(ai+="<h1>"+qe.properties.name+"</h1>"),qe.properties.popupContent&&(ai+=qe.properties.popupContent),St.bindPopup(ai)}}});Re.addLayer(yt)}else Re=ra.default.geoJSON(Se,{pointToLayer:function(yt,qe){return ra.default.marker(qe,tt)},onEachFeature:function(yt,qe){if(yt.properties&&(yt.properties.name||yt.properties.popupContent)){let St="";yt.properties.name&&(St+="<h1>"+yt.properties.name+"</h1>"),yt.properties.popupContent&&(St+=yt.properties.popupContent),qe.bindPopup(St)}}});if(me.addLayer(Re),R&&R.length===4){let yt=[[R[1],R[0]],[R[3],R[2]]];me.fitBounds(yt,{padding:[30,30]})}else me.fitBounds(Re.getBounds(),{padding:[30,30]})}).catch(function(Se){console.log("Could not read GeoJSON. "+Se)})}).catch(function(){console.log("Could not read data from URL.")});let be=document.getElementById(d+"-popup");return be&&be.remove(),me}window.initMap=EO;})();
/*! Bundled license information:

leaflet/dist/leaflet-src.js:
  (* @preserve
   * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
   * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
   *)

mapbox-gl/dist/mapbox-gl.js:
  (**
   * martinez v0.7.4
   * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
   *
   * @author Alex Milevski <info@w8r.name>
   * @license MIT
   * @preserve
   *)
*/
