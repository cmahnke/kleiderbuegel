{{- $context := . -}}
{{- $pages := site.AllPages -}}
{{- $op := "lt" -}}
{{- $weight := 10000 -}}
{{- if reflect.IsMap . -}}
  {{- $context = .context -}}
  {{- if isset . "pages" -}}
    {{- $pages = .pages -}}
  {{- end -}}
  {{- if isset . "op" -}}
    {{- $op = .op -}}
  {{- end -}}
  {{- if isset . "weight" -}}
    {{- $weight = .weight -}}
  {{- end -}}
{{- else -}}
  {{- errorf "[print/print-pages.html] Needs params as dict, not just context" .RelPermalink -}}
{{- end -}}

{{- $tocEntries := slice -}}
{{ $pages = where $pages ".Weight" $op $weight }}
{{- range $pages.ByWeight -}}
  {{- if eq .Params.toc false -}}
    {{- continue -}}
  {{- end -}}
  {{- $link := printf "#_%s" (replace .RelPermalink "/" "-") -}}
  {{ $tocEntries = $tocEntries | append (dict "title" .Title "href" $link) }}
{{- end -}}
{{- return $tocEntries -}}
