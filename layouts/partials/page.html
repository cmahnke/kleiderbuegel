{{- partial "check.html" . -}}

{{- partial "rail.html" . -}}
{{ $class := .Params.type }}
<div class="post {{ $class }}">
    <div class="content">
      <button class="close-hanger"></button>
      <h1 class="post-title">{{ .Title }}</h1>
      {{ if eq $class "hanger" }}
        <div class="hanger-front">
          {{- $front := .Resources.GetMatch "front*" -}}
          {{- if eq $front nil -}}
            {{- errorf "[page.html] Failed to load images for %s" .RelPermalink -}}
          {{- end -}}
          {{- $large := $front.Resize "1600x webp picture" -}}
          {{- $thumb := $front.Resize "330x webp picture" -}}
          <img class="buegel-font hanger-img" src="{{ $large.RelPermalink }}" alt="{{ .Title }}" data-thumb="{{ $thumb.RelPermalink }}" />
        </div>
        {{- $title := .Title -}}

        {{- with .Resources.GetMatch "top*" -}}
          {{- $largeTop := .Resize "1600x webp picture" -}}
          <img loading="lazy" class="buegel-top hanger-img" src="{{ $largeTop.RelPermalink }}" alt="{{ $title }}" />
          {{- with .Params.content -}}
            <div class="top-content">
              {{- . | markdownify -}}
            </div>
          {{- end }}
        {{- end }}

        {{- with .Resources.GetMatch "back*" -}}
          {{- $largeBack := .Resize "1600x webp picture" -}}
          <img loading="lazy" class="buegel-back hanger-img" src="{{ $largeBack.RelPermalink }}" alt="{{ $title }}" />
          {{- with .Params.content -}}
            <div class="back-content">
              {{- . | markdownify -}}
            </div>
          {{- end }}
        {{- end }}
      {{- end -}}
      {{- partial "post-content.html" . -}}
     </div>
    {{- if and (not .Params.hideMeta) (not .Params.metaPage) -}}
      <div class="meta">
        <div class="date">
            <a href="{{ .RelPermalink }}">
              {{- .Date | time.Format ":date_full" -}}
            </a>
        </div>
        <div class="meta-spacer">
            {{ if eq $class "hanger" }}
              {{- $hangers := (where (where .Site.Pages "Section" "post") "Params.type" "hanger").Reverse -}}
              {{- $position := 0 -}}
              {{- $search := .RelPermalink -}}
              {{- range $index, $element := $hangers -}}
                  {{- if eq $search $element.RelPermalink -}}
                      {{- $position = add $index 1 -}}
                  {{- end -}}
              {{- end -}}
              <div class="number"> {{ $position }} / {{ len $hangers }}</div>
            {{- end -}}
        </div>
        {{- partial "tags.html" . -}}
        <div class="permalink"><a href="{{ .RelPermalink }}">{{ i18n "Permalink" }}</a></div>
      </div>
    {{- end -}}
</div>
